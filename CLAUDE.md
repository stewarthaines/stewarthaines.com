# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

**PRIMARY FOCUS: `/epub` Directory**

This repository contains Stewart Haines' personal portfolio website, but the agent should focus exclusively on the `/epub` directory and its EPUB creation tools. The `/epub` directory is the main subject of development work and contains:

- EDITME.html app for creating EPUB files from plain text source
- Eleventy-powered catalog system for managing EPUB collections
- Static EPUB resources and feeds

**Root site content (index.html, portfolio projects, etc.) should be ignored unless specifically requested by the user.**

## Architecture

### EPUB Directory (Primary Focus)

- **Main entry**: `/epub/index.html` - Generated by Eleventy from `src/epub-index.njk`
- **Static resources**: EPUB files, OPDS feeds, and tools preserved as-is
- **Source structure**:
  - `src/epub-index.njk` - Main epub landing page
  - `src/_includes/` - Shared templates

### Root Site (Background/Ignore)

- Legacy static HTML portfolio site
- Preserved via Eleventy passthrough copy
- Not the focus of agent work

## Development Workflow

**Focus on EPUB Directory Development**

### Primary Workflow (EPUB Development)

- **Development**: `npm run dev` - Start development server with live reload at http://localhost:8080/`
  - **Note**: Live reload is excluded for EDITME.html files to prevent corruption of standalone apps
- **Build**: `npm run build` - Generate static site to `_site/` directory
- **Clean**: `npm run clean` - Remove build output
- **Main page**: Work in `src/epub-index.njk` for `/epub/` landing page
- **Templates**: Nunjucks (.njk) templates in `src/_includes/`

### Key URLs When Developing

- `/epub/` - Main EPUB landing page (generated from `src/epub-index.njk`)
- Static resources preserved at original paths (e.g., `/epub/georgia.epub`)

### Root Site (Background Only)

- Root site files are automatically copied via passthrough
- Generally ignore unless specifically requested by user

### Deployment

- Deploy `_site/` directory contents to web server
- Both EPUB content and root site served together

## EPUB-Specific Design Patterns

### Basic Structure

- **Main page**: Simple landing page at `/epub/` generated from `src/epub-index.njk`
- **Template**: Uses `base.njk` layout for consistent site appearance
- **Static preservation**: Original EPUB files, OPDS feeds preserved in `/epub/` root

### Layout Consistency

- **Base template**: Matches root site design with logo, navigation, and styling
- **Responsive**: Uses existing `sh2.css` for consistent appearance
- **Navigation**: Clear link back to main site

## Implementation Standards

This project follows strict accessibility and internationalization standards:

- **Accessibility**: WCAG 2.1 AA compliance required - see [docs/accessibility.md](docs/accessibility.md)
- **Internationalization**: Multi-language support with automatic detection - see [docs/internationalization.md](docs/internationalization.md)
- **Quality Gates**: Testing and review procedures - see [docs/development-workflow.md](docs/development-workflow.md)

### Translation Management

- **DO NOT manually edit JSON translation files** in `src/_data/locales/`
- **Add new translation keys to `locales/messages.pot` only**
- Translation updates to JSON files are handled by build scripts
- Focus on template code changes; translations are processed separately

**When to consult detailed docs:**

- Interactive components → accessibility.md
- Language/locale features → internationalization.md
- Code review/testing → development-workflow.md

## Screenshots and Testing

- The user will run the dev server and provide screenshot captures. Ask them to provide these as needed.

## ⚠️ CRITICAL: DO NOT ADD UNDOCUMENTED FEATURES

**WARNING: Adding features beyond documented requirements is strictly prohibited.**

When implementing accessibility improvements or any other changes:

❌ **NEVER ADD:**

- Extra UI elements not mentioned in requirements
- Additional headings or content sections
- New links or buttons beyond what's documented
- "Helpful" features not explicitly requested
- Content that changes the user experience

✅ **ONLY IMPLEMENT:**

- Exact patterns documented in `docs/accessibility.md`
- Exact patterns documented in `docs/internationalization.md`
- Specific features explicitly requested by the user
- Required HTML attributes for accessibility compliance

**Examples of prohibited additions:**

- Adding extra navigation elements beyond documented patterns

**If accessibility documentation suggests optional enhancements, ask the user before implementing them.**

This rule exists because undocumented features:

- Change the user experience without permission
- Add maintenance burden
- May conflict with existing design decisions
- Can break carefully planned user flows

**Stick to documented standards only. When in doubt, ask.**

- don't run the dev server - ask the user to run or restart it