<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF/QA6OjoAKysrABwcH" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EDITME.html</title>
    <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const xi=!1;var er=Array.isArray,Eo=Array.prototype.indexOf,Ja=Array.from,Qi=Object.defineProperty,In=Object.getOwnPropertyDescriptor,es=Object.getOwnPropertyDescriptors,ts=Object.prototype,ko=Array.prototype,la=Object.getPrototypeOf,Si=Object.isExtensible;const Kt=()=>{};function To(r){return r()}function xr(r){for(var e=0;e<r.length;e++)r[e]()}function Co(r,e){if(Array.isArray(r))return r;if(!(Symbol.iterator in r))return Array.from(r);const t=[];for(const a of r)if(t.push(a),t.length===e)break;return t}const Yt=2,ns=4,ca=8,Ka=16,mn=32,zn=64,Kr=128,$t=256,Yr=512,zt=1024,ln=2048,En=4096,pn=8192,da=16384,Fo=32768,ua=65536,rs=1<<17,as=1<<19,is=1<<20,Oa=1<<21,hn=Symbol("$state"),Io=Symbol("legacy props"),Po=Symbol("");function ss(r){return r===this.v}function os(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Ya(r){return!os(r,this.v)}function Mo(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Lo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Do(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Ro(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function zo(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Uo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ao(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Oo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let tr=!1,Wo=!1;function jo(){tr=!0}const Za=1,Qa=2,ls=4,Bo=8,No=16,$o=1,Ho=2,Vo=4,qo=8,Go=16,Xo=1,Jo=2,At=Symbol(),Ko="http://www.w3.org/1999/xhtml",cs="@attach",Yo=[];function Zo(r,e=!1){return qr(r,new Map,"",Yo)}function qr(r,e,t,a,n=null){if(typeof r=="object"&&r!==null){var i=e.get(r);if(i!==void 0)return i;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(er(r)){var s=Array(r.length);e.set(r,s),n!==null&&e.set(n,s);for(var l=0;l<r.length;l+=1){var d=r[l];l in r&&(s[l]=qr(d,e,t,a))}return s}if(la(r)===ts){s={},e.set(r,s),n!==null&&e.set(n,s);for(var u in r)s[u]=qr(r[u],e,t,a);return s}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return qr(r.toJSON(),e,t,a,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}function fa(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let rt=null;function Ei(r){rt=r}function ki(r){return ei().get(r)}function Qo(r,e){return ei().set(r,e),e}function el(r){return ei().has(r)}function Qe(r,e=!1,t){var a=rt={p:rt,c:null,d:!1,e:null,m:!1,s:r,x:null,l:null};tr&&!e&&(rt.l={s:null,u:null,r1:[],r2:Yn(!1)}),ha(()=>{a.d=!0})}function et(r){const e=rt;if(e!==null){r!==void 0&&(e.x=r);const s=e.e;if(s!==null){var t=lt,a=st;e.e=null;try{for(var n=0;n<s.length;n++){var i=s[n];xn(i.effect),cn(i.reaction),nr(i.fn)}}finally{xn(t),cn(a)}}rt=e.p,e.m=!0}return r||{}}function Dr(){return!tr||rt!==null&&rt.l===null}function ei(r){return rt===null&&fa(),rt.c??=new Map(tl(rt)||void 0)}function tl(r){let e=r.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}function Ct(r){if(typeof r!="object"||r===null||hn in r)return r;const e=la(r);if(e!==ts&&e!==ko)return r;var t=new Map,a=er(r),n=Ue(0),i=st,s=l=>{var d=st;cn(i);var u=l();return cn(d),u};return a&&t.set("length",Ue(r.length)),new Proxy(r,{defineProperty(l,d,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Uo();var c=t.get(d);return c===void 0?(c=s(()=>Ue(u.value)),t.set(d,c)):y(c,s(()=>Ct(u.value))),!0},deleteProperty(l,d){var u=t.get(d);if(u===void 0)d in l&&(t.set(d,s(()=>Ue(At))),Ta(n));else{if(a&&typeof d=="string"){var c=t.get("length"),p=Number(d);Number.isInteger(p)&&p<c.v&&y(c,p)}y(u,At),Ta(n)}return!0},get(l,d,u){if(d===hn)return r;var c=t.get(d),p=d in l;if(c===void 0&&(!p||In(l,d)?.writable)&&(c=s(()=>Ue(Ct(p?l[d]:At))),t.set(d,c)),c!==void 0){var h=o(c);return h===At?void 0:h}return Reflect.get(l,d,u)},getOwnPropertyDescriptor(l,d){var u=Reflect.getOwnPropertyDescriptor(l,d);if(u&&"value"in u){var c=t.get(d);c&&(u.value=o(c))}else if(u===void 0){var p=t.get(d),h=p?.v;if(p!==void 0&&h!==At)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return u},has(l,d){if(d===hn)return!0;var u=t.get(d),c=u!==void 0&&u.v!==At||Reflect.has(l,d);if(u!==void 0||lt!==null&&(!c||In(l,d)?.writable)){u===void 0&&(u=s(()=>Ue(c?Ct(l[d]):At)),t.set(d,u));var p=o(u);if(p===At)return!1}return c},set(l,d,u,c){var p=t.get(d),h=d in l;if(a&&d==="length")for(var v=u;v<p.v;v+=1){var m=t.get(v+"");m!==void 0?y(m,At):v in l&&(m=s(()=>Ue(At)),t.set(v+"",m))}p===void 0?(!h||In(l,d)?.writable)&&(p=s(()=>Ue(void 0)),y(p,s(()=>Ct(u))),t.set(d,p)):(h=p.v!==At,y(p,s(()=>Ct(u))));var w=Reflect.getOwnPropertyDescriptor(l,d);if(w?.set&&w.set.call(c,u),!h){if(a&&typeof d=="string"){var b=t.get("length"),k=Number(d);Number.isInteger(k)&&k>=b.v&&y(b,k+1)}Ta(n)}return!0},ownKeys(l){o(n);var d=Reflect.ownKeys(l).filter(p=>{var h=t.get(p);return h===void 0||h.v!==At});for(var[u,c]of t)c.v!==At&&!(u in l)&&d.push(u);return d},setPrototypeOf(){Ao()}})}function Ta(r,e=1){y(r,r.v+e)}function Ti(r){try{if(r!==null&&typeof r=="object"&&hn in r)return r[hn]}catch{}return r}function nl(r,e){return Object.is(Ti(r),Ti(e))}function Ln(r){var e=Yt|ln,t=st!==null&&(st.f&Yt)!==0?st:null;return lt===null||t!==null&&(t.f&$t)!==0?e|=$t:lt.f|=is,{ctx:rt,deps:null,effects:null,equals:ss,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??lt}}function se(r){const e=Ln(r);return Ts(e),e}function ue(r){const e=Ln(r);return e.equals=Ya,e}function ds(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Ht(e[t])}}function rl(r){for(var e=r.parent;e!==null;){if((e.f&Yt)===0)return e;e=e.parent}return null}function us(r){var e,t=lt;xn(rl(r));try{ds(r),e=Ps(r)}finally{xn(t)}return e}function fs(r){var e=us(r);if(r.equals(e)||(r.v=e,r.wv=Fs()),!ar){var t=(bn||(r.f&$t)!==0)&&r.deps!==null?En:zt;Zt(r,t)}}const Sr=new Map;function Yn(r,e){var t={f:0,v:r,reactions:null,equals:ss,rv:0,wv:0};return t}function Ue(r,e){const t=Yn(r);return Ts(t),t}function je(r,e=!1){const t=Yn(r);return e||(t.equals=Ya),tr&&rt!==null&&rt.l!==null&&(rt.l.s??=[]).push(t),t}function qe(r,e){return y(r,St(()=>o(r))),e}function y(r,e,t=!1){st!==null&&!tn&&Dr()&&(st.f&(Yt|Ka))!==0&&!vn?.includes(r)&&Oo();let a=t?Ct(e):e;return Er(r,a)}function Er(r,e){if(!r.equals(e)){var t=r.v;ar?Sr.set(r,e):Sr.set(r,t),r.v=e,(r.f&Yt)!==0&&((r.f&ln)!==0&&us(r),Zt(r,(r.f&$t)===0?zt:En)),r.wv=Fs(),ps(r,ln),Dr()&&lt!==null&&(lt.f&zt)!==0&&(lt.f&(mn|zn))===0&&(Gt===null?ml([r]):Gt.push(r))}return e}function ps(r,e){var t=r.reactions;if(t!==null)for(var a=Dr(),n=t.length,i=0;i<n;i++){var s=t[i],l=s.f;(l&ln)===0&&(!a&&s===lt||(Zt(s,e),(l&(zt|$t))!==0&&((l&Yt)!==0?ps(s,En):wa(s))))}}function al(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let il=!1;var Wa,hs,vs,ms,gs;function sl(){if(Wa===void 0){Wa=window,hs=document,vs=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;ms=In(e,"firstChild").get,gs=In(e,"nextSibling").get,Si(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Si(t)&&(t.__t=void 0)}}function Rr(r=""){return document.createTextNode(r)}function Zn(r){return ms.call(r)}function pa(r){return gs.call(r)}function f(r,e){return Zn(r)}function Ke(r,e){{var t=Zn(r);return t instanceof Comment&&t.data===""?pa(t):t}}function g(r,e=1,t=!1){let a=r;for(;e--;)a=pa(a);return a}function ol(r){r.textContent=""}function ws(r){lt===null&&st===null&&Do(),st!==null&&(st.f&$t)!==0&&lt===null&&Lo(),ar&&Mo()}function ll(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Un(r,e,t,a=!0){var n=lt,i={ctx:rt,deps:null,nodes_start:null,nodes_end:null,f:r|ln,first:null,fn:e,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(t)try{ga(i),i.f|=Fo}catch(d){throw Ht(i),d}else e!==null&&wa(i);var s=t&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&(is|Kr))===0;if(!s&&a&&(n!==null&&ll(i,n),st!==null&&(st.f&Yt)!==0)){var l=st;(l.effects??=[]).push(i)}return i}function cl(){return st!==null&&!tn}function ha(r){const e=Un(ca,null,!1);return Zt(e,zt),e.teardown=r,e}function kt(r){ws();var e=lt!==null&&(lt.f&mn)!==0&&rt!==null&&!rt.m;if(e){var t=rt;(t.e??=[]).push({fn:r,effect:lt,reaction:st})}else{var a=nr(r);return a}}function ys(r){return ws(),rr(r)}function dl(r){const e=Un(zn,r,!0);return()=>{Ht(e)}}function ul(r){const e=Un(zn,r,!0);return(t={})=>new Promise(a=>{t.outro?Zr(e,()=>{Ht(e),a(void 0)}):(Ht(e),a(void 0))})}function nr(r){return Un(ns,r,!1)}function ot(r,e){var t=rt,a={effect:null,ran:!1};t.l.r1.push(a),a.effect=rr(()=>{r(),!a.ran&&(a.ran=!0,y(t.l.r2,!0),St(e))})}function Pt(){var r=rt;rr(()=>{if(o(r.l.r2)){for(var e of r.l.r1){var t=e.effect;(t.f&zt)!==0&&Zt(t,En),ir(t)&&ga(t),e.ran=!1}r.l.r2.v=!1}})}function rr(r){return Un(ca,r,!0)}function U(r,e=[],t=Ln){const a=e.map(t);return An(()=>r(...a.map(o)))}function An(r,e=0){return Un(ca|Ka|e,r,!0)}function _n(r,e=!0){return Un(ca|mn,r,!0,e)}function bs(r){var e=r.teardown;if(e!==null){const t=ar,a=st;Ci(!0),cn(null);try{e.call(null)}finally{Ci(t),cn(a)}}}function _s(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var a=t.next;(t.f&zn)!==0?t.parent=null:Ht(t,e),t=a}}function fl(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&mn)===0&&Ht(e),e=t}}function Ht(r,e=!0){var t=!1;(e||(r.f&as)!==0)&&r.nodes_start!==null&&(pl(r.nodes_start,r.nodes_end),t=!0),_s(r,e&&!t),ra(r,0),Zt(r,da);var a=r.transitions;if(a!==null)for(const i of a)i.stop();bs(r);var n=r.parent;n!==null&&n.first!==null&&xs(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function pl(r,e){for(;r!==null;){var t=r===e?null:pa(r);r.remove(),r=t}}function xs(r){var e=r.parent,t=r.prev,a=r.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===r&&(e.first=a),e.last===r&&(e.last=t))}function Zr(r,e){var t=[];ti(r,t,!0),Ss(t,()=>{Ht(r),e&&e()})}function Ss(r,e){var t=r.length;if(t>0){var a=()=>--t||e();for(var n of r)n.out(a)}else e()}function ti(r,e,t){if((r.f&pn)===0){if(r.f^=pn,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var a=r.first;a!==null;){var n=a.next,i=(a.f&ua)!==0||(a.f&mn)!==0;ti(a,e,i?t:!1),a=n}}}function Qr(r){Es(r,!0)}function Es(r,e){if((r.f&pn)!==0){r.f^=pn,(r.f&zt)===0&&(r.f^=zt),ir(r)&&(Zt(r,ln),wa(r));for(var t=r.first;t!==null;){var a=t.next,n=(t.f&ua)!==0||(t.f&mn)!==0;Es(t,n?e:!1),t=a}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let kr=[],ja=[];function ks(){var r=kr;kr=[],xr(r)}function hl(){var r=ja;ja=[],xr(r)}function va(r){kr.length===0&&queueMicrotask(ks),kr.push(r)}function vl(){kr.length>0&&ks(),ja.length>0&&hl()}let Gr=!1,ea=!1,ta=null,Pn=!1,ar=!1;function Ci(r){ar=r}let wr=[];let st=null,tn=!1;function cn(r){st=r}let lt=null;function xn(r){lt=r}let vn=null;function Ts(r){st!==null&&st.f&Oa&&(vn===null?vn=[r]:vn.push(r))}let Lt=null,Bt=0,Gt=null;function ml(r){Gt=r}let Cs=1,na=0,bn=!1,yn=null;function Fs(){return++Cs}function ir(r){var e=r.f;if((e&ln)!==0)return!0;if((e&En)!==0){var t=r.deps,a=(e&$t)!==0;if(t!==null){var n,i,s=(e&Yr)!==0,l=a&&lt!==null&&!bn,d=t.length;if(s||l){var u=r,c=u.parent;for(n=0;n<d;n++)i=t[n],(s||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);s&&(u.f^=Yr),l&&c!==null&&(c.f&$t)===0&&(u.f^=$t)}for(n=0;n<d;n++)if(i=t[n],ir(i)&&fs(i),i.wv>r.wv)return!0}(!a||lt!==null&&!bn)&&Zt(r,zt)}return!1}function gl(r,e){for(var t=e;t!==null;){if((t.f&Kr)!==0)try{t.fn(r);return}catch{t.f^=Kr}t=t.parent}throw Gr=!1,r}function Fi(r){return(r.f&da)===0&&(r.parent===null||(r.parent.f&Kr)===0)}function ma(r,e,t,a){if(Gr){if(t===null&&(Gr=!1),Fi(e))throw r;return}if(t!==null&&(Gr=!0),gl(r,e),Fi(e))throw r}function Is(r,e,t=!0){var a=r.reactions;if(a!==null)for(var n=0;n<a.length;n++){var i=a[n];vn?.includes(r)||((i.f&Yt)!==0?Is(i,e,!1):e===i&&(t?Zt(i,ln):(i.f&zt)!==0&&Zt(i,En),wa(i)))}}function Ps(r){var e=Lt,t=Bt,a=Gt,n=st,i=bn,s=vn,l=rt,d=tn,u=r.f;Lt=null,Bt=0,Gt=null,bn=(u&$t)!==0&&(tn||!Pn||st===null),st=(u&(mn|zn))===0?r:null,vn=null,Ei(r.ctx),tn=!1,na++,r.f|=Oa;try{var c=(0,r.fn)(),p=r.deps;if(Lt!==null){var h;if(ra(r,Bt),p!==null&&Bt>0)for(p.length=Bt+Lt.length,h=0;h<Lt.length;h++)p[Bt+h]=Lt[h];else r.deps=p=Lt;if(!bn)for(h=Bt;h<p.length;h++)(p[h].reactions??=[]).push(r)}else p!==null&&Bt<p.length&&(ra(r,Bt),p.length=Bt);if(Dr()&&Gt!==null&&!tn&&p!==null&&(r.f&(Yt|En|ln))===0)for(h=0;h<Gt.length;h++)Is(Gt[h],r);return n!==null&&n!==r&&(na++,Gt!==null&&(a===null?a=Gt:a.push(...Gt))),c}finally{Lt=e,Bt=t,Gt=a,st=n,bn=i,vn=s,Ei(l),tn=d,r.f^=Oa}}function wl(r,e){let t=e.reactions;if(t!==null){var a=Eo.call(t,r);if(a!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[a]=t[n],t.pop())}}t===null&&(e.f&Yt)!==0&&(Lt===null||!Lt.includes(e))&&(Zt(e,En),(e.f&($t|Yr))===0&&(e.f^=Yr),ds(e),ra(e,0))}function ra(r,e){var t=r.deps;if(t!==null)for(var a=e;a<t.length;a++)wl(r,t[a])}function ga(r){var e=r.f;if((e&da)===0){Zt(r,zt);var t=lt,a=rt,n=Pn;lt=r,Pn=!0;try{(e&Ka)!==0?fl(r):_s(r),bs(r);var i=Ps(r);r.teardown=typeof i=="function"?i:null,r.wv=Cs;var s=r.deps,l;xi&&Wo&&r.f&ln}catch(d){ma(d,r,t,a||r.ctx)}finally{Pn=n,lt=t}}}function yl(){try{Ro()}catch(r){if(ta!==null)ma(r,ta,null);else throw r}}function Ms(){var r=Pn;try{var e=0;for(Pn=!0;wr.length>0;){e++>1e3&&yl();var t=wr,a=t.length;wr=[];for(var n=0;n<a;n++){var i=_l(t[n]);bl(i)}Sr.clear()}}finally{ea=!1,Pn=r,ta=null}}function bl(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var a=r[t];if((a.f&(da|pn))===0)try{ir(a)&&(ga(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?xs(a):a.fn=null))}catch(n){ma(n,a,null,a.ctx)}}}function wa(r){ea||(ea=!0,queueMicrotask(Ms));for(var e=ta=r;e.parent!==null;){e=e.parent;var t=e.f;if((t&(zn|mn))!==0){if((t&zt)===0)return;e.f^=zt}}wr.push(e)}function _l(r){for(var e=[],t=r;t!==null;){var a=t.f,n=(a&(mn|zn))!==0,i=n&&(a&zt)!==0;if(!i&&(a&pn)===0){if((a&ns)!==0)e.push(t);else if(n)t.f^=zt;else try{ir(t)&&ga(t)}catch(d){ma(d,t,null,t.ctx)}var s=t.first;if(s!==null){t=s;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}return e}function xl(r){for(var e;;){if(vl(),wr.length===0)return e;ea=!0,Ms()}}async function Ls(){await Promise.resolve(),xl()}function o(r){var e=r.f,t=(e&Yt)!==0;if(yn!==null&&yn.add(r),st!==null&&!tn){if(!vn?.includes(r)){var a=st.deps;r.rv<na&&(r.rv=na,Lt===null&&a!==null&&a[Bt]===r?Bt++:Lt===null?Lt=[r]:(!bn||!Lt.includes(r))&&Lt.push(r))}}else if(t&&r.deps===null&&r.effects===null){var n=r,i=n.parent;i!==null&&(i.f&$t)===0&&(n.f^=$t)}return t&&(n=r,ir(n)&&fs(n)),ar&&Sr.has(r)?Sr.get(r):r.v}function Sl(r){var e=yn;yn=new Set;var t=yn,a;try{if(St(r),e!==null)for(a of yn)e.add(a)}finally{yn=e}return t}function El(r){var e=Sl(()=>St(r));for(var t of e)if((t.f&rs)!==0)for(const a of t.deps||[])(a.f&Yt)===0&&Er(a,a.v);else Er(t,t.v)}function St(r){var e=tn;try{return tn=!0,r()}finally{tn=e}}const kl=-7169;function Zt(r,e){r.f=r.f&kl|e}function Ze(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(hn in r)Ba(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&hn in t&&Ba(t)}}}function Ba(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let a in r)try{Ba(r[a],e)}catch{}const t=la(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=es(t);for(let n in a){const i=a[n].get;if(i)try{i.call(r)}catch{}}}}}function Tl(){return Symbol(cs)}function Cl(r){return r.endsWith("capture")&&r!=="gotpointercapture"&&r!=="lostpointercapture"}const Fl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Il(r){return Fl.includes(r)}const Pl={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Ml(r){return r=r.toLowerCase(),Pl[r]??r}const Ll=["touchstart","touchmove"];function Dl(r){return Ll.includes(r)}function Rl(r,e){if(e){const t=document.body;r.autofocus=!0,va(()=>{document.activeElement===t&&r.focus()})}}let Ii=!1;function zl(){Ii||(Ii=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function Ds(r){var e=st,t=lt;cn(null),xn(null);try{return r()}finally{cn(e),xn(t)}}function Rs(r,e,t,a=t){r.addEventListener(e,()=>Ds(t));const n=r.__on_r;n?r.__on_r=()=>{n(),a(!0)}:r.__on_r=()=>a(!0),zl()}const zs=new Set,Na=new Set;function ni(r,e,t,a={}){function n(i){if(a.capture||mr.call(e,i),!i.cancelBubble)return Ds(()=>t?.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?va(()=>{e.addEventListener(r,n,a)}):e.addEventListener(r,n,a),n}function sn(r,e,t,a={}){var n=ni(e,r,t,a);return()=>{r.removeEventListener(e,n,a)}}function Ge(r,e,t,a,n){var i={capture:a,passive:n},s=ni(r,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ha(()=>{e.removeEventListener(r,s,i)})}function bt(r){for(var e=0;e<r.length;e++)zs.add(r[e]);for(var t of Na)t(r)}function mr(r){var e=this,t=e.ownerDocument,a=r.type,n=r.composedPath?.()||[],i=n[0]||r.target,s=0,l=r.__root;if(l){var d=n.indexOf(l);if(d!==-1&&(e===document||e===window)){r.__root=e;return}var u=n.indexOf(e);if(u===-1)return;d<=u&&(s=d)}if(i=n[s]||r.target,i!==e){Qi(r,"currentTarget",{configurable:!0,get(){return i||t}});var c=st,p=lt;cn(null),xn(null);try{for(var h,v=[];i!==null;){var m=i.assignedSlot||i.parentNode||i.host||null;try{var w=i["__"+a];if(w!=null&&(!i.disabled||r.target===i))if(er(w)){var[b,...k]=w;b.apply(i,[r,...k])}else w.call(i,r)}catch(C){h?v.push(C):h=C}if(r.cancelBubble||m===e||m===null)break;i=m}if(h){for(let C of v)queueMicrotask(()=>{throw C});throw h}}finally{r.__root=e,delete r.currentTarget,cn(c),xn(p)}}}function Ul(r){var e;e=document.head.appendChild(Rr());try{An(()=>r(e),as)}finally{}}function Us(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","\x3C!---->"),e.content}function Tr(r,e){var t=lt;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function P(r,e){var t=(e&Xo)!==0,a=(e&Jo)!==0,n,i=!r.startsWith("<!>");return()=>{n===void 0&&(n=Us(i?r:"<!>"+r),t||(n=Zn(n)));var s=a||vs?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=Zn(s),d=s.lastChild;Tr(l,d)}else Tr(s,s);return s}}function Al(r,e,t="svg"){var a=!r.startsWith("<!>"),n=`<${t}>${a?r:"<!>"+r}</${t}>`,i;return()=>{if(!i){var s=Us(n),l=Zn(s);i=Zn(l)}var d=i.cloneNode(!0);return Tr(d,d),d}}function As(r,e){return Al(r,e,"svg")}function Et(r=""){{var e=Rr(r+"");return Tr(e,e),e}}function ht(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Rr();return r.append(e,t),Tr(e,t),r}function x(r,e){r!==null&&r.before(e)}function ri(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function E(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function Ol(r,e){return Wl(r,e)}const On=new Map;function Wl(r,{target:e,anchor:t,props:a={},events:n,context:i,intro:s=!0}){sl();var l=new Set,d=p=>{for(var h=0;h<p.length;h++){var v=p[h];if(!l.has(v)){l.add(v);var m=Dl(v);e.addEventListener(v,mr,{passive:m});var w=On.get(v);w===void 0?(document.addEventListener(v,mr,{passive:m}),On.set(v,1)):On.set(v,w+1)}}};d(Ja(zs)),Na.add(d);var u=void 0,c=ul(()=>{var p=t??e.appendChild(Rr());return _n(()=>{if(i){Qe({});var h=rt;h.c=i}n&&(a.$$events=n),u=r(p,a)||{},i&&et()}),()=>{for(var h of l){e.removeEventListener(h,mr);var v=On.get(h);--v===0?(document.removeEventListener(h,mr),On.delete(h)):On.set(h,v)}Na.delete(d),p!==t&&p.parentNode?.removeChild(p)}});return jl.set(u,c),u}let jl=new WeakMap;function H(r,e,[t,a]=[0,0]){var n=r,i=null,s=null,l=At,d=t>0?ua:0,u=!1;const c=(h,v=!0)=>{u=!0,p(v,h)},p=(h,v)=>{l!==(l=h)&&(l?(i?Qr(i):v&&(i=_n(()=>v(n))),s&&Zr(s,()=>{s=null})):(s?Qr(s):v&&(s=_n(()=>v(n,[t+1,a]))),i&&Zr(i,()=>{i=null})))};An(()=>{u=!1,e(c),u||p(null,null)},d)}function It(r,e){return e}function Bl(r,e,t,a){for(var n=[],i=e.length,s=0;s<i;s++)ti(e[s].e,n,!0);var l=i>0&&n.length===0&&t!==null;if(l){var d=t.parentNode;ol(d),d.append(t),a.clear(),wn(r,e[0].prev,e[i-1].next)}Ss(n,()=>{for(var u=0;u<i;u++){var c=e[u];l||(a.delete(c.k),wn(r,c.prev,c.next)),Ht(c.e,!l)}})}function xt(r,e,t,a,n,i=null){var s=r,l={flags:e,items:new Map,first:null},d=(e&ls)!==0;if(d){var u=r;s=u.appendChild(Rr())}var c=null,p=!1,h=ue(()=>{var v=t();return er(v)?v:v==null?[]:Ja(v)});An(()=>{var v=o(h),m=v.length;p&&m===0||(p=m===0,Nl(v,l,s,n,e,a,t),i!==null&&(m===0?c?Qr(c):c=_n(()=>i(s)):c!==null&&Zr(c,()=>{c=null})),o(h))})}function Nl(r,e,t,a,n,i,s){var l=(n&Bo)!==0,d=(n&(Za|Qa))!==0,u=r.length,c=e.items,p=e.first,h=p,v,m=null,w,b=[],k=[],C,I,M,S;if(l)for(S=0;S<u;S+=1)C=r[S],I=i(C,S),M=c.get(I),M!==void 0&&(M.a?.measure(),(w??=new Set).add(M));for(S=0;S<u;S+=1){if(C=r[S],I=i(C,S),M=c.get(I),M===void 0){var O=h?h.e.nodes_start:t;m=Hl(O,e,m,m===null?e.first:m.next,C,I,S,a,n,s),c.set(I,m),b=[],k=[],h=m.next;continue}if(d&&$l(M,C,S,n),(M.e.f&pn)!==0&&(Qr(M.e),l&&(M.a?.unfix(),(w??=new Set).delete(M))),M!==h){if(v!==void 0&&v.has(M)){if(b.length<k.length){var A=k[0],$;m=A.prev;var J=b[0],Z=b[b.length-1];for($=0;$<b.length;$+=1)Pi(b[$],A,t);for($=0;$<k.length;$+=1)v.delete(k[$]);wn(e,J.prev,Z.next),wn(e,m,J),wn(e,Z,A),h=A,m=Z,S-=1,b=[],k=[]}else v.delete(M),Pi(M,h,t),wn(e,M.prev,M.next),wn(e,M,m===null?e.first:m.next),wn(e,m,M),m=M;continue}for(b=[],k=[];h!==null&&h.k!==I;)(h.e.f&pn)===0&&(v??=new Set).add(h),k.push(h),h=h.next;if(h===null)continue;M=h}b.push(M),m=M,h=M.next}if(h!==null||v!==void 0){for(var D=v===void 0?[]:Ja(v);h!==null;)(h.e.f&pn)===0&&D.push(h),h=h.next;var q=D.length;if(q>0){var R=(n&ls)!==0&&u===0?t:null;if(l){for(S=0;S<q;S+=1)D[S].a?.measure();for(S=0;S<q;S+=1)D[S].a?.fix()}Bl(e,D,R,c)}}l&&va(()=>{if(w!==void 0)for(M of w)M.a?.apply()}),lt.first=e.first&&e.first.e,lt.last=m&&m.e}function $l(r,e,t,a){(a&Za)!==0&&Er(r.v,e),(a&Qa)!==0?Er(r.i,t):r.i=t}function Hl(r,e,t,a,n,i,s,l,d,u){var c=(d&Za)!==0,p=(d&No)===0,h=c?p?je(n):Yn(n):n,v=(d&Qa)===0?s:Yn(s),m={i:v,v:h,k:i,a:null,e:null,prev:t,next:a};try{return m.e=_n(()=>l(r,h,v,u),il),m.e.prev=t&&t.e,m.e.next=a&&a.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),a!==null&&(a.prev=m,a.e.prev=m.e),m}finally{}}function Pi(r,e,t){for(var a=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==a;){var s=pa(i);n.before(i),i=s}}function wn(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function _t(r,e,t,a,n){var i=e.$$slots?.[t],s=!1;i===!0&&(i=e[t==="default"?"children":t],s=!0),i===void 0||i(r,s?()=>a:a)}function Qn(r,e,...t){var a=r,n=Kt,i;An(()=>{n!==(n=e())&&(i&&(Ht(i),i=null),i=_n(()=>n(a,...t)))},ua)}function Vl(r,e){var t=void 0,a;An(()=>{t!==(t=e())&&(a&&(Ht(a),a=null),t&&(a=_n(()=>{nr(()=>t(r))})))})}function Os(r){var e,t,a="";if(typeof r=="string"||typeof r=="number")a+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=Os(r[e]))&&(a&&(a+=" "),a+=t)}else for(t in r)r[t]&&(a&&(a+=" "),a+=t);return a}function Xr(){for(var r,e,t=0,a="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=Os(r))&&(a&&(a+=" "),a+=e);return a}function ql(r){return typeof r=="object"?Xr(r):r??""}const Mi=[...` 	
\r\f \v\uFEFF`];function Gl(r,e,t){var a=r==null?"":""+r;if(e&&(a=a?a+" "+e:e),t){for(var n in t)if(t[n])a=a?a+" "+n:n;else if(a.length)for(var i=n.length,s=0;(s=a.indexOf(n,s))>=0;){var l=s+i;(s===0||Mi.includes(a[s-1]))&&(l===a.length||Mi.includes(a[l]))?a=(s===0?"":a.substring(0,s))+a.substring(l+1):s=l}}return a===""?null:a}function Li(r,e=!1){var t=e?" !important;":";",a="";for(var n in r){var i=r[n];i!=null&&i!==""&&(a+=" "+n+": "+i+t)}return a}function Ca(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function Xl(r,e){if(e){var t="",a,n;if(Array.isArray(e)?(a=e[0],n=e[1]):a=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,s=0,l=!1,d=[];a&&d.push(...Object.keys(a).map(Ca)),n&&d.push(...Object.keys(n).map(Ca));var u=0,c=-1;const w=r.length;for(var p=0;p<w;p++){var h=r[p];if(l?h==="/"&&r[p-1]==="*"&&(l=!1):i?i===h&&(i=!1):h==="/"&&r[p+1]==="*"?l=!0:h==='"'||h==="'"?i=h:h==="("?s++:h===")"&&s--,!l&&i===!1&&s===0){if(h===":"&&c===-1)c=p;else if(h===";"||p===w-1){if(c!==-1){var v=Ca(r.substring(u,c).trim());if(!d.includes(v)){h!==";"&&p++;var m=r.substring(u,p).trim();t+=" "+m+";"}}u=p+1,c=-1}}}}return a&&(t+=Li(a)),n&&(t+=Li(n,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function nt(r,e,t,a,n,i){var s=r.__className;if(s!==t||s===void 0){var l=Gl(t,a,i);l==null?r.removeAttribute("class"):e?r.className=l:r.setAttribute("class",l),r.__className=t}else if(i&&n!==i)for(var d in i){var u=!!i[d];(n==null||u!==!!n[d])&&r.classList.toggle(d,u)}return i}function Fa(r,e={},t,a){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?r.style.removeProperty(n):r.style.setProperty(n,i,a))}}function ai(r,e,t,a){var n=r.__style;if(n!==e){var i=Xl(e,a);i==null?r.removeAttribute("style"):r.style.cssText=i,r.__style=e}else a&&(Array.isArray(a)?(Fa(r,t?.[0],a[0]),Fa(r,t?.[1],a[1],"important")):Fa(r,t,a));return a}function Dn(r,e,t){if(r.multiple){if(e==null)return;if(!er(e))return al();for(var a of r.options)a.selected=e.includes(yr(a));return}for(a of r.options){var n=yr(a);if(nl(n,e)){a.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Cr(r,e){let t=!0;nr(()=>{e&&Dn(r,St(e),t),t=!1;var a=new MutationObserver(()=>{var n=r.__value;Dn(r,n)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function Ws(r,e,t=e){var a=!0;Rs(r,"change",n=>{var i=n?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(i),yr);else{var l=r.querySelector(i)??r.querySelector("option:not([disabled])");s=l&&yr(l)}t(s)}),nr(()=>{var n=e();if(Dn(r,n,a),a&&n===void 0){var i=r.querySelector(":checked");i!==null&&(n=yr(i),t(n))}r.__value=n,a=!1}),Cr(r)}function yr(r){return"__value"in r?r.__value:r.value}const lr=Symbol("class"),cr=Symbol("style"),js=Symbol("is custom element"),Bs=Symbol("is html");function Sn(r,e){var t=ba(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Ns(r,e){var t=ba(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Jl(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function ve(r,e,t,a){var n=ba(r);n[e]!==(n[e]=t)&&(e==="loading"&&(r[Po]=t),t==null?r.removeAttribute(e):typeof t!="string"&&$s(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Kl(r,e,t,a,n=!1){var i=ba(r),s=i[js],l=!i[Bs],d=e||{},u=r.tagName==="OPTION";for(var c in e)c in t||(t[c]=null);t.class?t.class=ql(t.class):(a||t[lr])&&(t.class=null),t[cr]&&(t.style??=null);var p=$s(r);for(const I in t){let M=t[I];if(u&&I==="value"&&M==null){r.value=r.__value="",d[I]=M;continue}if(I==="class"){var h=r.namespaceURI==="http://www.w3.org/1999/xhtml";nt(r,h,M,a,e?.[lr],t[lr]),d[I]=M,d[lr]=t[lr];continue}if(I==="style"){ai(r,M,e?.[cr],t[cr]),d[I]=M,d[cr]=t[cr];continue}var v=d[I];if(M!==v){d[I]=M;var m=I[0]+I[1];if(m!=="$$")if(m==="on"){const S={},O="$$"+I;let A=I.slice(2);var w=Il(A);if(Cl(A)&&(A=A.slice(0,-7),S.capture=!0),!w&&v){if(M!=null)continue;r.removeEventListener(A,d[O],S),d[O]=null}if(M!=null)if(w)r[`__${A}`]=M,bt([A]);else{let $=function(J){d[I].call(this,J)};var C=$;d[O]=ni(A,r,$,S)}else w&&(r[`__${A}`]=void 0)}else if(I==="style")ve(r,I,M);else if(I==="autofocus")Rl(r,!!M);else if(!s&&(I==="__value"||I==="value"&&M!=null))r.value=r.__value=M;else if(I==="selected"&&u)Jl(r,M);else{var b=I;l||(b=Ml(b));var k=b==="defaultValue"||b==="defaultChecked";if(M==null&&!s&&!k)if(i[I]=null,b==="value"||b==="checked"){let S=r;const O=e===void 0;if(b==="value"){let A=S.defaultValue;S.removeAttribute(b),S.defaultValue=A,S.value=S.__value=O?A:null}else{let A=S.defaultChecked;S.removeAttribute(b),S.defaultChecked=A,S.checked=O?A:!1}}else r.removeAttribute(I);else k||p.includes(b)&&(s||typeof M!="string")?r[b]=M:typeof M!="function"&&ve(r,b,M)}}}return d}function ya(r,e,t=[],a,n=!1,i=Ln){const s=t.map(i);var l=void 0,d={},u=r.nodeName==="SELECT",c=!1;An(()=>{var p=e(...s.map(o));Kl(r,l,p,a,n),c&&u&&"value"in p&&Dn(r,p.value,!1);for(let v of Object.getOwnPropertySymbols(d))p[v]||Ht(d[v]);for(let v of Object.getOwnPropertySymbols(p)){var h=p[v];v.description===cs&&(!l||h!==l[v])&&(d[v]&&Ht(d[v]),d[v]=_n(()=>Vl(r,()=>h)))}l=p}),u&&Cr(r,()=>l.value),c=!0}function ba(r){return r.__attributes??={[js]:r.nodeName.includes("-"),[Bs]:r.namespaceURI===Ko}}var Di=new Map;function $s(r){var e=Di.get(r.nodeName);if(e)return e;Di.set(r.nodeName,e=[]);for(var t,a=r,n=Element.prototype;n!==a;){t=es(a);for(var i in t)t[i].set&&e.push(i);a=la(a)}return e}function Ia(r,e,t=e){var a=Dr();Rs(r,"input",n=>{var i=n?r.defaultValue:r.value;if(i=Pa(r)?Ma(i):i,t(i),a&&i!==(i=e())){var s=r.selectionStart,l=r.selectionEnd;r.value=i??"",l!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(l,r.value.length))}}),St(e)==null&&r.value&&t(Pa(r)?Ma(r.value):r.value),rr(()=>{var n=e();Pa(r)&&n===Ma(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function Pa(r){var e=r.type;return e==="number"||e==="range"}function Ma(r){return r===""?null:+r}function Ft(r,e,t){var a=In(r,e);a&&a.set&&(r[e]=t,ha(()=>{r[e]=null}))}function Ri(r,e){return r===e||r?.[hn]===e}function Ot(r={},e,t,a){return nr(()=>{var n,i;return rr(()=>{n=i,i=[],St(()=>{r!==t(...i)&&(e(r,...i),n&&Ri(t(...n),r)&&e(null,...n))})}),()=>{va(()=>{i&&Ri(t(...i),r)&&e(null,...i)})}}),r}function wt(r=!1){const e=rt,t=e.l.u;if(!t)return;let a=()=>Ze(e.s);if(r){let n=0,i={};const s=Ln(()=>{let l=!1;const d=e.s;for(const u in d)d[u]!==i[u]&&(i[u]=d[u],l=!0);return l&&n++,n});a=()=>o(s)}t.b.length&&ys(()=>{zi(e,a),xr(t.b)}),kt(()=>{const n=St(()=>t.m.map(To));return()=>{for(const i of n)typeof i=="function"&&i()}}),t.a.length&&kt(()=>{zi(e,a),xr(t.a)})}function zi(r,e){if(r.l.s)for(const t of r.l.s)o(t);e()}function ii(r,e,t){if(r==null)return e(void 0),t&&t(void 0),Kt;const a=St(()=>r.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const Wn=[];function Yl(r,e){return{subscribe:Jt(r,e).subscribe}}function Jt(r,e=Kt){let t=null;const a=new Set;function n(l){if(os(r,l)&&(r=l,t)){const d=!Wn.length;for(const u of a)u[1](),Wn.push(u,r);if(d){for(let u=0;u<Wn.length;u+=2)Wn[u][0](Wn[u+1]);Wn.length=0}}}function i(l){n(l(r))}function s(l,d=Kt){const u=[l,d];return a.add(u),a.size===1&&(t=e(n,i)||Kt),l(r),()=>{a.delete(u),a.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:s}}function zr(r,e,t){const a=!Array.isArray(r),n=a?[r]:r;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return Yl(t,(s,l)=>{let d=!1;const u=[];let c=0,p=Kt;const h=()=>{if(c)return;p();const m=e(a?u[0]:u,s,l);i?s(m):p=typeof m=="function"?m:Kt},v=n.map((m,w)=>ii(m,b=>{u[w]=b,c&=~(1<<w),d&&h()},()=>{c|=1<<w}));return d=!0,h(),function(){xr(v),p(),d=!1}})}function on(r){let e;return ii(r,t=>e=t)(),e}let Wr=!1,$a=Symbol();function Ye(r,e,t){const a=t[e]??={store:null,source:je(void 0),unsubscribe:Kt};if(a.store!==r&&!($a in t))if(a.unsubscribe(),a.store=r??null,r==null)a.source.v=void 0,a.unsubscribe=Kt;else{var n=!0;a.unsubscribe=ii(r,i=>{n?a.source.v=i:y(a.source,i)}),n=!1}return r&&$a in t?on(r):o(a.source)}function ut(){const r={};function e(){ha(()=>{for(var t in r)r[t].unsubscribe();Qi(r,$a,{enumerable:!1,value:!0})})}return[r,e]}function Zl(r){var e=Wr;try{return Wr=!1,[r(),Wr]}finally{Wr=e}}const Ql={get(r,e){if(!r.exclude.includes(e))return r.props[e]},set(r,e){return!1},getOwnPropertyDescriptor(r,e){if(!r.exclude.includes(e)&&e in r.props)return{enumerable:!0,configurable:!0,value:r.props[e]}},has(r,e){return r.exclude.includes(e)?!1:e in r.props},ownKeys(r){return Reflect.ownKeys(r.props).filter(e=>!r.exclude.includes(e))}};function si(r,e,t){return new Proxy({props:r,exclude:e},Ql)}function Ui(r){return r.ctx?.d??!1}function W(r,e,t,a){var n=(t&$o)!==0,i=!tr||(t&Ho)!==0,s=(t&qo)!==0,l=(t&Go)!==0,d=!1,u;s?[u,d]=Zl(()=>r[e]):u=r[e];var c=hn in r||Io in r,p=s&&(In(r,e)?.set??(c&&e in r&&(A=>r[e]=A)))||void 0,h=a,v=!0,m=!1,w=()=>(m=!0,v&&(v=!1,l?h=St(a):h=a),h);u===void 0&&a!==void 0&&(p&&i&&zo(),u=w(),p&&p(u));var b;if(i)b=()=>{var A=r[e];return A===void 0?w():(v=!0,m=!1,A)};else{var k=(n?Ln:ue)(()=>r[e]);k.f|=rs,b=()=>{var A=o(k);return A!==void 0&&(h=void 0),A===void 0?h:A}}if((t&Vo)===0&&i)return b;if(p){var C=r.$$legacy;return function(A,$){return arguments.length>0?((!i||!$||C||d)&&p($?b():A),A):b()}}var I=!1,M=!1,S=je(u),O=Ln(()=>{var A=b(),$=o(S);return I?(I=!1,M=!0,$):(M=!1,S.v=A)});return s&&o(O),n||(O.equals=Ya),function(A,$){if(yn!==null&&(I=M,b(),o(S)),arguments.length>0){const J=$?o(O):i&&s?Ct(A):A;if(!O.equals(J)){if(I=!0,y(S,J),m&&h!==void 0&&(h=J),Ui(O))return A;St(()=>o(O))}return A}return Ui(O)?O.v:o(O)}}function nn(r){rt===null&&fa(),tr&&rt.l!==null?tc(rt).m.push(r):kt(()=>{const e=St(r);if(typeof e=="function")return e})}function sr(r){rt===null&&fa(),nn(()=>()=>St(r))}function ec(r,e,{bubbles:t=!1,cancelable:a=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:a})}function Mt(){const r=rt;return r===null&&fa(),(e,t,a)=>{const n=r.s.$$events?.[e];if(n){const i=er(n)?n.slice():[n],s=ec(e,t,a);for(const l of i)l.call(r.x,s);return!s.defaultPrevented}return!0}}function tc(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const nc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(nc);jo();function rc(r){return typeof r=="function"}function oi(r){return r!==null&&typeof r=="object"}const ac=["string","number","bigint","boolean"];function Ha(r){return r==null||ac.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>Ha(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const Fr=Symbol("box"),li=Symbol("is-writable");function ic(r){return oi(r)&&Fr in r}function sc(r){return Je.isBox(r)&&li in r}function Je(r){let e=Ue(Ct(r));return{[Fr]:!0,[li]:!0,get current(){return o(e)},set current(t){y(e,t,!0)}}}function oc(r,e){const t=se(r);return e?{[Fr]:!0,[li]:!0,get current(){return o(t)},set current(a){e(a)}}:{[Fr]:!0,get current(){return r()}}}function lc(r){return Je.isBox(r)?r:rc(r)?Je.with(r):Je(r)}function cc(r){return Object.entries(r).reduce((e,[t,a])=>Je.isBox(a)?(Je.isWritableBox(a)?Object.defineProperty(e,t,{get(){return a.current},set(n){a.current=n}}):Object.defineProperty(e,t,{get(){return a.current}}),e):Object.assign(e,{[t]:a}),{})}function dc(r){return Je.isWritableBox(r)?{[Fr]:!0,get current(){return r.current}}:r}Je.from=lc;Je.with=oc;Je.flatten=cc;Je.readonly=dc;Je.isBox=ic;Je.isWritableBox=sc;function uc(...r){return function(e){for(const t of r)if(t){if(e.defaultPrevented)return;typeof t=="function"?t.call(this,e):t.current?.call(this,e)}}}function fc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var jn={},La,Ai;function pc(){if(Ai)return La;Ai=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,n=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,l=/^\s+|\s+$/g,d=`
`,u="/",c="*",p="",h="comment",v="declaration";La=function(w,b){if(typeof w!="string")throw new TypeError("First argument must be a string");if(!w)return[];b=b||{};var k=1,C=1;function I(R){var T=R.match(e);T&&(k+=T.length);var L=R.lastIndexOf(d);C=~L?R.length-L:C+R.length}function M(){var R={line:k,column:C};return function(T){return T.position=new S(R),$(),T}}function S(R){this.start=R,this.end={line:k,column:C},this.source=b.source}S.prototype.content=w;function O(R){var T=new Error(b.source+":"+k+":"+C+": "+R);if(T.reason=R,T.filename=b.source,T.line=k,T.column=C,T.source=w,!b.silent)throw T}function A(R){var T=R.exec(w);if(T){var L=T[0];return I(L),w=w.slice(L.length),T}}function $(){A(t)}function J(R){var T;for(R=R||[];T=Z();)T!==!1&&R.push(T);return R}function Z(){var R=M();if(!(u!=w.charAt(0)||c!=w.charAt(1))){for(var T=2;p!=w.charAt(T)&&(c!=w.charAt(T)||u!=w.charAt(T+1));)++T;if(T+=2,p===w.charAt(T-1))return O("End of comment missing");var L=w.slice(2,T-2);return C+=2,I(L),w=w.slice(T),C+=2,R({type:h,comment:L})}}function D(){var R=M(),T=A(a);if(T){if(Z(),!A(n))return O("property missing ':'");var L=A(i),F=R({type:v,property:m(T[0].replace(r,p)),value:L?m(L[0].replace(r,p)):p});return A(s),F}}function q(){var R=[];J(R);for(var T;T=D();)T!==!1&&(R.push(T),J(R));return R}return $(),q()};function m(w){return w?w.replace(l,p):p}return La}var Oi;function hc(){if(Oi)return jn;Oi=1;var r=jn&&jn.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(jn,"__esModule",{value:!0}),jn.default=t;var e=r(pc());function t(a,n){var i=null;if(!a||typeof a!="string")return i;var s=(0,e.default)(a),l=typeof n=="function";return s.forEach(function(d){if(d.type==="declaration"){var u=d.property,c=d.value;l?n(u,c,d):c&&(i=i||{},i[u]=c)}}),i}return jn}var vc=hc();const Wi=fc(vc),mc=Wi.default||Wi,gc=/\d/,wc=["-","_","/","."];function yc(r=""){if(!gc.test(r))return r!==r.toLowerCase()}function bc(r){const e=[];let t="",a,n;for(const i of r){const s=wc.includes(i);if(s===!0){e.push(t),t="",a=void 0;continue}const l=yc(i);if(n===!1){if(a===!1&&l===!0){e.push(t),t=i,a=l;continue}if(a===!0&&l===!1&&t.length>1){const d=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=d+i,a=l;continue}}t+=i,a=l,n=s}return e.push(t),e}function Hs(r){return r?bc(r).map(e=>xc(e)).join(""):""}function _c(r){return Sc(Hs(r||""))}function xc(r){return r?r[0].toUpperCase()+r.slice(1):""}function Sc(r){return r?r[0].toLowerCase()+r.slice(1):""}function jr(r){if(!r)return{};const e={};function t(a,n){if(a.startsWith("-moz-")||a.startsWith("-webkit-")||a.startsWith("-ms-")||a.startsWith("-o-")){e[Hs(a)]=n;return}if(a.startsWith("--")){e[a]=n;return}e[_c(a)]=n}return mc(r,t),e}function Vs(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function Ec(r,e,t,a){const n=Array.isArray(e)?e:[e];return n.forEach(i=>r.addEventListener(i,t,a)),()=>{n.forEach(i=>r.removeEventListener(i,t,a))}}function kc(r,e){const t=RegExp(r,"g");return a=>{if(typeof a!="string")throw new TypeError(`expected an argument of type string, but got ${typeof a}`);return a.match(t)?a.replace(t,e):a}}const Tc=kc(/[A-Z]/,r=>`-${r.toLowerCase()}`);function Cc(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${Tc(e)}: ${r[e]};`).join(`
`)}function qs(r={}){return Cc(r).replace(`
`," ")}const Fc={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};qs(Fc);const Ic=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],Pc=new Set(Ic);function Mc(r){return Pc.has(r)}function ci(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const a=r[t];if(a){for(const n of Object.keys(a)){const i=e[n],s=a[n],l=typeof i=="function",d=typeof s=="function";if(l&&Mc(n)){const u=i,c=s;e[n]=uc(u,c)}else if(l&&d)e[n]=Vs(i,s);else if(n==="class"){const u=Ha(i),c=Ha(s);u&&c?e[n]=Xr(i,s):u?e[n]=Xr(i):c&&(e[n]=Xr(s))}else if(n==="style"){const u=typeof i=="object",c=typeof s=="object",p=typeof i=="string",h=typeof s=="string";if(u&&c)e[n]={...i,...s};else if(u&&h){const v=jr(s);e[n]={...i,...v}}else if(p&&c){const v=jr(i);e[n]={...v,...s}}else if(p&&h){const v=jr(i),m=jr(s);e[n]={...v,...m}}else u?e[n]=i:c?e[n]=s:p?e[n]=i:h&&(e[n]=s)}else e[n]=s!==void 0?s:i}for(const n of Object.getOwnPropertySymbols(a)){const i=e[n],s=a[n];e[n]=s!==void 0?s:i}}}return typeof e.style=="object"&&(e.style=qs(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const Lc=typeof window<"u"?window:void 0;function Dc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}function Rc(r){y(r,r.v+1)}function Gs(r){let e=0,t=Yn(0),a;return()=>{cl()&&(o(t),rr(()=>(e===0&&(a=St(()=>r(()=>Rc(t)))),e+=1,()=>{Ls().then(()=>{e-=1,e===0&&(a?.(),a=void 0)})})))}}let zc=class{#e;#t;constructor(e={}){const{window:t=Lc,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=Gs(n=>{const i=sn(t,"focusin",n),s=sn(t,"focusout",n);return()=>{i(),s()}}))}get current(){return this.#t?.(),this.#e?Dc(this.#e):null}};new zc;function Uc(r){Ls().then(r)}const Ac=9;function Oc(r){return oi(r)&&r.nodeType===Ac}function Wc(r){return oi(r)&&r.constructor?.name==="VisualViewport"}function jc(r){return Oc(r)?r:Wc(r)?r.document:r?.ownerDocument??document}function Bc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class di{element;#e=se(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return o(this.#e)}set root(e){y(this.#e,e)}constructor(e){typeof e=="function"?this.element=Je.with(e):this.element=e}getDocument=()=>jc(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>Bc(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,t)=>this.getWindow().setTimeout(e,t);clearTimeout=e=>this.getWindow().clearTimeout(e)}function ui(r,e){return{[Tl()]:t=>Je.isBox(r)?(r.current=t,St(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||(r.current=null)}):(r(t),St(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||r(null)})}}function Nc({layout:r,panesArray:e,pivotIndices:t}){let a=0,n=100,i=0,s=0;const l=t[0];for(let p=0;p<e.length;p++){const h=e[p].constraints,{maxSize:v=100,minSize:m=0}=h;p===l?(a=m,n=v):(i+=m,s+=v)}const d=Math.min(n,100-i),u=Math.max(a,100-s),c=r[l];return{valueMax:d,valueMin:u,valueNow:c}}function ft(r,e="Assertion failed!"){if(!r)throw console.error(e),new Error(e)}const $c=100,fi=10;function Nt(r,e,t=fi){return Ir(r,e,t)===0}function Ir(r,e,t=fi){const a=ji(r,t),n=ji(e,t);return Math.sign(a-n)}function dr(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ji(r,e){return Number.parseFloat(r.toFixed(e))}const _a=typeof document<"u";function Hc(r){return r instanceof HTMLElement}function Xs(r){return r.type==="keydown"}function Js(r){return r.type.startsWith("mouse")}function Ks(r){return r.type.startsWith("touch")}function qn({paneConstraints:r,paneIndex:e,initialSize:t}){const a=r[e];ft(a!=null,"Pane constraints should not be null.");const{collapsedSize:n=0,collapsible:i,maxSize:s=100,minSize:l=0}=a;let d=t;return Ir(d,l)<0&&(d=Vc(d,i,n,l)),d=Math.min(s,d),Number.parseFloat(d.toFixed(fi))}function Vc(r,e,t,a){if(!e)return a;const n=(t+a)/2;return Ir(r,n)<0?t:a}function Mn(){}function qc({groupId:r,layout:e,panesArray:t,domContext:a}){const n=Ur(r,a);for(let i=0;i<t.length-1;i++){const{valueMax:s,valueMin:l,valueNow:d}=Nc({layout:e,panesArray:t,pivotIndices:[i,i+1]}),u=n[i];if(Hc(u)){const c=t[i];u.setAttribute("aria-controls",c.opts.id.current),u.setAttribute("aria-valuemax",`${Math.round(s)}`),u.setAttribute("aria-valuemin",`${Math.round(l)}`),u.setAttribute("aria-valuenow",d!=null?`${Math.round(d)}`:"")}}return()=>{for(const i of n)i.removeAttribute("aria-controls"),i.removeAttribute("aria-valuemax"),i.removeAttribute("aria-valuemin"),i.removeAttribute("aria-valuenow")}}function Ur(r,e){return _a?Array.from(e.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${r}"]`)):[]}function Ys({groupId:r,id:e,domContext:t}){return _a?Ur(r,t).findIndex(i=>i.getAttribute("data-pane-resizer-id")===e)??null:null}function Bi({groupId:r,dragHandleId:e,domContext:t}){const a=Ys({groupId:r,id:e,domContext:t});return a!=null?[a,a+1]:[-1,-1]}function Bn(r,e,t){const a=r.map(u=>u.constraints),n=$n(r,e),i=a[n],l=n===r.length-1?[n-1,n]:[n,n+1],d=t[n];return{...i,paneSize:d,pivotIndices:l}}function $n(r,e){return r.findIndex(t=>t.opts.id.current===e.opts.id.current)}function ur(r,e,t){for(let a=0;a<e.length;a++){const n=e[a],i=r[a];ft(i);const{collapsedSize:s=0,collapsible:l}=i.constraints,d=t[i.opts.id.current];if(!(d==null||n!==d))continue;t[i.opts.id.current]=n;const{onCollapse:u,onExpand:c,onResize:p}=i.callbacks;p?.(n,d),l&&(u||c)&&(c&&(d==null||d===s)&&n!==s&&c(),u&&(d==null||d!==s)&&n===s&&u())}}function Gc({panesArray:r}){const e=Array(r.length),t=r.map(i=>i.constraints);let a=0,n=100;for(let i=0;i<r.length;i++){const s=t[i];ft(s);const{defaultSize:l}=s;l!=null&&(a++,e[i]=l,n-=l)}for(let i=0;i<r.length;i++){const s=t[i];ft(s);const{defaultSize:l}=s;if(l!=null)continue;const d=r.length-a,u=n/d;a++,e[i]=u,n-=u}return e}function Xc({layout:r,paneConstraints:e}){const t=[...r],a=t.reduce((i,s)=>i+s,0);if(t.length!==e.length)throw new Error(`Invalid ${e.length} pane layout: ${t.map(i=>`${i}%`).join(", ")}`);if(!Nt(a,100))for(let i=0;i<e.length;i++){const s=t[i];ft(s!=null);const l=100/a*s;t[i]=l}let n=0;for(let i=0;i<e.length;i++){const s=t[i];ft(s!=null);const l=qn({paneConstraints:e,paneIndex:i,initialSize:s});s!==l&&(n+=s-l,t[i]=l)}if(!Nt(n,0))for(let i=0;i<e.length;i++){const s=t[i];ft(s!=null);const l=s+n,d=qn({paneConstraints:e,paneIndex:i,initialSize:l});if(s!==d&&(n-=d-s,t[i]=d,Nt(n,0)))break}return t}function Jc(r,e){if(!_a)return null;const t=e.querySelector(`[data-pane-group][data-pane-group-id="${r}"]`);return t||null}function pi(r,e){if(!_a)return null;const t=e.querySelector(`[data-pane-resizer-id="${r}"]`);return t||null}function Kc({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:n}){const i=t==="horizontal",s=pi(e,n);ft(s);const l=s.getAttribute("data-pane-group-id");ft(l);const{initialCursorPosition:d}=a,u=Zs(t,r),c=Jc(l,n);ft(c);const p=c.getBoundingClientRect(),h=i?p.width:p.height;return(u-d)/h*100}function Yc({event:r,dragHandleId:e,dir:t,initialDragState:a,keyboardResizeBy:n,domContext:i}){if(Xs(r)){const s=t==="horizontal";let l=0;r.shiftKey?l=100:n!=null?l=n:l=10;let d=0;switch(r.key){case"ArrowDown":d=s?0:l;break;case"ArrowLeft":d=s?-l:0;break;case"ArrowRight":d=s?l:0;break;case"ArrowUp":d=s?0:-l;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return a==null?0:Kc({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:i})}function Zs(r,e){const t=r==="horizontal";if(Js(e))return t?e.clientX:e.clientY;if(Ks(e)){const a=e.touches[0];return ft(a),t?a.screenX:a.screenY}else throw new Error(`Unsupported event type "${e.type}"`)}function Zc({groupId:r,handleId:e,panesArray:t,domContext:a}){const n=pi(e,a),i=Ur(r,a),s=n?i.indexOf(n):-1,l=t[s]?.opts.id.current??null,d=t[s+1]?.opts.id.current??null;return[l,d]}const Qc=typeof window<"u"?window:void 0;function ed(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class td{#e;#t;constructor(e={}){const{window:t=Qc,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=Gs(n=>{const i=sn(t,"focusin",n),s=sn(t,"focusout",n);return()=>{i(),s()}}))}get current(){return this.#t?.(),this.#e?ed(this.#e):null}}new td;function nd(r,e){switch(r){case"post":kt(e);break;case"pre":ys(e);break}}function Qs(r,e,t,a={}){const{lazy:n=!1}=a;let i=!n,s=Array.isArray(r)?[]:void 0;nd(e,()=>{const l=Array.isArray(r)?r.map(u=>u()):r();if(!i){i=!0,s=l;return}const d=St(()=>t(l,s));return s=l,d})}function br(r,e,t){Qs(r,"post",e,t)}function rd(r,e,t){Qs(r,"pre",e,t)}br.pre=rd;class ad{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return el(this.#t)}get(){const e=ki(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const t=ki(this.#t);return t===void 0?e:t}set(e){return Qo(this.#t,e)}}function fr({delta:r,layout:e,paneConstraints:t,pivotIndices:a,trigger:n}){if(Nt(r,0))return e;const i=[...e],[s,l]=a;let d=0;if(n==="keyboard"){{const c=r<0?l:s,p=t[c];if(ft(p),p.collapsible){const h=e[c];ft(h!=null);const v=t[c];ft(v);const{collapsedSize:m=0,minSize:w=0}=v;if(Nt(h,m)){const b=w-h;Ir(b,Math.abs(r))>0&&(r=r<0?0-b:b)}}}{const c=r<0?s:l,p=t[c];ft(p);const{collapsible:h}=p;if(h){const v=e[c];ft(v!=null);const m=t[c];ft(m);const{collapsedSize:w=0,minSize:b=0}=m;if(Nt(v,b)){const k=v-w;Ir(k,Math.abs(r))>0&&(r=r<0?0-k:k)}}}}{const c=r<0?1:-1;let p=r<0?l:s,h=0;for(;;){const m=e[p];ft(m!=null);const b=qn({paneConstraints:t,paneIndex:p,initialSize:100})-m;if(h+=b,p+=c,p<0||p>=t.length)break}const v=Math.min(Math.abs(r),Math.abs(h));r=r<0?0-v:v}{let p=r<0?s:l;for(;p>=0&&p<t.length;){const h=Math.abs(r)-Math.abs(d),v=e[p];ft(v!=null);const m=v-h,w=qn({paneConstraints:t,paneIndex:p,initialSize:m});if(!Nt(v,w)&&(d+=v-w,i[p]=w,d.toPrecision(3).localeCompare(Math.abs(r).toPrecision(3),void 0,{numeric:!0})>=0))break;r<0?p--:p++}}if(Nt(d,0))return e;{const c=r<0?l:s,p=e[c];ft(p!=null);const h=p+d,v=qn({paneConstraints:t,paneIndex:c,initialSize:h});if(i[c]=v,!Nt(v,h)){let m=h-v,b=r<0?l:s;for(;b>=0&&b<t.length;){const k=i[b];ft(k!=null);const C=k+m,I=qn({paneConstraints:t,paneIndex:b,initialSize:C});if(Nt(k,I)||(m-=I-k,i[b]=I),Nt(m,0))break;r>0?b--:b++}}}const u=i.reduce((c,p)=>p+c,0);return Nt(u,100)?i:e}let Va=null,Fn=null;function eo(r){switch(r){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function id(){Fn!==null&&(document.head.removeChild(Fn),Va=null,Fn=null)}function Da(r,e){if(Va===r)return;Va=r;const t=eo(r);Fn===null&&(Fn=e.createElement("style"),e.head.appendChild(Fn)),Fn.innerHTML=`*{cursor: ${t}!important;}`}function sd({defaultSize:r,dragState:e,layout:t,panesArray:a,paneIndex:n,precision:i=3}){const s=t[n];let l;return s==null?l=r??"1":a.length===1?l="1":l=s.toPrecision(i),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function Ni(r){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");r.getItem=e=>localStorage.getItem(e),r.setItem=(e,t)=>localStorage.setItem(e,t)}catch(e){console.error(e),r.getItem=()=>null,r.setItem=()=>{}}}function to(r){return`paneforge:${r}`}function no(r){return r.map(t=>t.opts.order.current?`${t.opts.order.current}:${JSON.stringify(t.constraints)}`:JSON.stringify(t.constraints)).sort().join(",")}function ro(r,e){try{const t=to(r),a=e.getItem(t),n=JSON.parse(a||"");if(typeof n=="object"&&n!==null)return n}catch{}return null}function od(r,e,t){const a=ro(r,t)||{},n=no(e);return a[n]||null}function ld(r,e,t,a,n){const i=to(r),s=no(e),l=ro(r,n)||{};l[s]={expandToSizes:Object.fromEntries(t.entries()),layout:a};try{n.setItem(i,JSON.stringify(l))}catch(d){console.error(d)}}const $i={};function cd(r,e=10){let t=null;return(...n)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...n)},e)}}function dd({autoSaveId:r,layout:e,storage:t,panesArray:a,paneSizeBeforeCollapse:n}){if(e.length===0||e.length!==a.length)return;let i=$i[r];i==null&&(i=cd(ld,$c),$i[r]=i);const s=[...a],l=new Map(n);i(r,s,l,e,t)}const gr={getItem:r=>(Ni(gr),gr.getItem(r)),setItem:(r,e)=>{Ni(gr),gr.setItem(r,e)}},hi=new ad("PaneGroup");class vi{static create(e){return hi.set(new vi(e))}opts;attachment;domContext;#e=Ue(null);get dragState(){return o(this.#e)}set dragState(e){y(this.#e,e)}#t=Ue([]);get layout(){return o(this.#t)}set layout(e){y(this.#t,e)}#r=Ue([]);get panesArray(){return o(this.#r)}set panesArray(e){y(this.#r,e)}#a=Ue(!1);get panesArrayChanged(){return o(this.#a)}set panesArrayChanged(e){y(this.#a,e,!0)}#n=Ue(Ct({}));get paneIdToLastNotifiedSizeMap(){return o(this.#n)}set paneIdToLastNotifiedSizeMap(e){y(this.#n,e,!0)}paneSizeBeforeCollapseMap=new Map;prevDelta=0;constructor(e){this.opts=e,this.attachment=ui(this.opts.ref),this.domContext=new di(this.opts.ref),br([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>qc({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray,domContext:this.domContext})),kt(()=>St(()=>this.#s())),br([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&dd({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),br(()=>this.panesArrayChanged,()=>{if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const t=this.layout;let a=null;if(this.opts.autoSaveId.current){const i=od(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);i&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(i.expandToSizes)),a=i.layout)}a==null&&(a=Gc({panesArray:this.panesArray}));const n=Xc({layout:a,paneConstraints:this.panesArray.map(i=>i.constraints)});dr(t,n)||(this.layout=n,this.opts.onLayout.current?.(n),ur(this.panesArray,n,this.paneIdToLastNotifiedSizeMap))})}setLayout=e=>{this.layout=e};registerResizeHandle=e=>t=>{t.preventDefault();const a=this.opts.direction.current,n=this.dragState,i=this.opts.id.current,s=this.opts.keyboardResizeBy.current,l=this.layout,d=this.panesArray,{initialLayout:u}=n??{},c=this.domContext.getDocument(),p=Bi({groupId:i,dragHandleId:e,domContext:this.domContext});let h=Yc({event:t,dragHandleId:e,dir:a,initialDragState:n,keyboardResizeBy:s,domContext:this.domContext});if(h===0)return;const v=a==="horizontal";c.dir==="rtl"&&v&&(h=-h);const m=d.map(k=>k.constraints),w=fr({delta:h,layout:u??l,paneConstraints:m,pivotIndices:p,trigger:Xs(t)?"keyboard":"mouse-or-touch"}),b=!dr(l,w);(Js(t)||Ks(t))&&this.prevDelta!==h&&(this.prevDelta=h,Da(b?v?"horizontal":"vertical":v?h<0?"horizontal-min":"horizontal-max":h<0?"vertical-min":"vertical-max",c)),b&&(this.setLayout(w),this.opts.onLayout.current?.(w),ur(d,w,this.paneIdToLastNotifiedSizeMap))};resizePane=(e,t)=>{const a=this.layout,n=this.panesArray,i=n.map(p=>p.constraints),{paneSize:s,pivotIndices:l}=Bn(n,e,a);ft(s!=null);const u=$n(n,e)===n.length-1?s-t:t-s,c=fr({delta:u,layout:a,paneConstraints:i,pivotIndices:l,trigger:"imperative-api"});dr(a,c)||(this.setLayout(c),this.opts.onLayout.current?.(c),ur(n,c,this.paneIdToLastNotifiedSizeMap))};startDragging=(e,t)=>{const a=this.opts.direction.current,n=this.layout,i=pi(e,this.domContext);ft(i);const s=Zs(a,t);this.dragState={dragHandleId:e,dragHandleRect:i.getBoundingClientRect(),initialCursorPosition:s,initialLayout:n}};stopDragging=()=>{id(),this.dragState=null};isPaneCollapsed=e=>{const t=this.panesArray,a=this.layout,{collapsedSize:n=0,collapsible:i,paneSize:s}=Bn(t,e,a);return i===!0&&s===n};expandPane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(m=>m.constraints),{collapsedSize:i=0,paneSize:s,minSize:l=0,pivotIndices:d}=Bn(a,e,t);if(s!==i)return;const u=this.paneSizeBeforeCollapseMap.get(e.opts.id.current),c=u!=null&&u>=l?u:l,h=$n(a,e)===a.length-1?s-c:c-s,v=fr({delta:h,layout:t,paneConstraints:n,pivotIndices:d,trigger:"imperative-api"});dr(t,v)||(this.setLayout(v),this.opts.onLayout.current?.(v),ur(a,v,this.paneIdToLastNotifiedSizeMap))};collapsePane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(p=>p.constraints),{collapsedSize:i=0,paneSize:s,pivotIndices:l}=Bn(a,e,t);if(ft(s!=null),s===i)return;this.paneSizeBeforeCollapseMap.set(e.opts.id.current,s);const u=$n(a,e)===a.length-1?s-i:i-s,c=fr({delta:u,layout:t,paneConstraints:n,pivotIndices:l,trigger:"imperative-api"});dr(t,c)||(this.layout=c,this.opts.onLayout.current?.(c),ur(a,c,this.paneIdToLastNotifiedSizeMap))};getPaneSize=e=>Bn(this.panesArray,e,this.layout).paneSize;getPaneStyle=(e,t)=>{const a=this.panesArray,n=this.layout,i=this.dragState,s=$n(a,e);return sd({defaultSize:t,dragState:i,layout:n,panesArray:a,paneIndex:s})};isPaneExpanded=e=>{const{collapsedSize:t=0,collapsible:a,paneSize:n}=Bn(this.panesArray,e,this.layout);return!a||n>t};registerPane=e=>{const t=[...this.panesArray,e];return t.sort((a,n)=>{const i=a.opts.order.current,s=n.opts.order.current;return i==null&&s==null?0:i==null?-1:s==null?1:i-s}),this.panesArray=t,this.panesArrayChanged=!0,()=>{const a=[...this.panesArray],n=$n(this.panesArray,e);n<0||(a.splice(n,1),this.panesArray=a,delete this.paneIdToLastNotifiedSizeMap[e.opts.id.current],this.panesArrayChanged=!0)}};#s=()=>{const e=this.opts.id.current,t=Ur(e,this.domContext),a=this.panesArray,n=t.map(i=>{const s=i.getAttribute("data-pane-resizer-id");if(!s)return Mn;const[l,d]=Zc({groupId:e,handleId:s,panesArray:a,domContext:this.domContext});if(l==null||d==null)return Mn;const c=Ec(i,"keydown",p=>{if(p.defaultPrevented||p.key!=="Enter")return;p.preventDefault();const h=this.panesArray,v=h.findIndex(S=>S.opts.id.current===l);if(v<0)return;const m=h[v];ft(m);const w=this.layout,b=w[v],{collapsedSize:k=0,collapsible:C,minSize:I=0}=m.constraints;if(!(b!=null&&C))return;const M=fr({delta:Nt(b,k)?I-b:k-b,layout:w,paneConstraints:h.map(S=>S.constraints),pivotIndices:Bi({groupId:e,dragHandleId:s,domContext:this.domContext}),trigger:"keyboard"});w!==M&&(this.layout=M)});return()=>{c()}});return()=>{for(const i of n)i()}};#i=se(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"},...this.attachment}));get props(){return o(this.#i)}set props(e){y(this.#i,e)}}const ud=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];class mi{static create(e){return new mi(e,hi.get())}opts;#e;attachment;domContext;#t=se(()=>this.#e.dragState?.dragHandleId===this.opts.id.current);#r=Ue(!1);resizeHandler=null;constructor(e,t){this.opts=e,this.#e=t,this.attachment=ui(this.opts.ref),this.domContext=new di(this.opts.ref),kt(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.#e.registerResizeHandle(this.opts.id.current)}),kt(()=>{const a=this.opts.ref.current;if(!a)return;const n=this.opts.disabled.current,i=this.resizeHandler,s=o(this.#t);if(n||i===null||!s)return;const l=h=>{i(h)},d=h=>{i(h)},u=()=>{a.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1)},c=this.domContext.getDocument().body,p=this.domContext.getWindow();return Vs(sn(c,"contextmenu",u),sn(c,"mousemove",l),sn(c,"touchmove",l,{passive:!1}),sn(c,"mouseleave",d),sn(p,"mouseup",u),sn(p,"touchend",u))})}#a=e=>{e.preventDefault(),!this.opts.disabled.current&&(this.#e.startDragging(this.opts.id.current,e),this.opts.onDraggingChange.current(!0))};#n=()=>{const e=this.opts.ref.current;e&&(e.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1))};#s=e=>{if(this.opts.disabled.current||!this.resizeHandler||e.defaultPrevented)return;if(ud.includes(e.key)){e.preventDefault(),this.resizeHandler(e);return}if(e.key!=="F6")return;e.preventDefault();const t=Ur(this.#e.opts.id.current,this.domContext),a=Ys({groupId:this.#e.opts.id.current,id:this.opts.id.current,domContext:this.domContext});if(a===null)return;let n=0;e.shiftKey?a>0?n=a-1:n=t.length-1:a+1<t.length?n=a+1:n=0,t[n].focus()};#i=()=>{y(this.#r,!1)};#o=()=>{y(this.#r,!0)};#l=e=>{this.#a(e)};#d=()=>{this.#n()};#u=()=>{this.#n()};#f=()=>{this.#n()};#p=e=>{this.#a(e)};#c=se(()=>({id:this.opts.id.current,role:"separator","data-direction":this.#e.opts.direction.current,"data-pane-group-id":this.#e.opts.id.current,"data-active":o(this.#t)?"pointer":o(this.#r)?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:eo(this.#e.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:this.#s,onblur:this.#i,onfocus:this.#o,onmousedown:this.#l,onmouseup:this.#d,ontouchcancel:this.#u,ontouchend:this.#f,ontouchstart:this.#p,...this.attachment}));get props(){return o(this.#c)}set props(e){y(this.#c,e)}}class gi{static create(e){return new gi(e,hi.get())}opts;group;attachment;domContext;#e=Ue("");#t=se(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current}));get callbacks(){return o(this.#t)}set callbacks(e){y(this.#t,e)}#r=se(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current}));get constraints(){return o(this.#r)}set constraints(e){y(this.#r,e)}#a=e=>{y(this.#e,e,!0),Uc(()=>{if(this.opts.ref.current){const t=this.opts.ref.current;if(!(getComputedStyle(t).transitionDuration!=="0s")){y(this.#e,"");return}const i=s=>{s.propertyName==="flex-grow"&&(y(this.#e,""),t.removeEventListener("transitionend",i))};t.addEventListener("transitionend",i)}else y(this.#e,"")})};pane={collapse:()=>{this.#a("collapsing"),this.group.collapsePane(this)},expand:()=>{this.#a("expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:e=>this.group.resizePane(this,e),getId:()=>this.opts.id.current};constructor(e,t){this.opts=e,this.group=t,this.attachment=ui(this.opts.ref),this.domContext=new di(this.opts.ref),nn(()=>this.group.registerPane(this)),br(()=>Zo(this.constraints),()=>{this.group.panesArrayChanged=!0})}#n=se(()=>this.group.isPaneCollapsed(this));#s=se(()=>o(this.#e)!==""?o(this.#e):o(this.#n)?"collapsed":"expanded");#i=se(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":o(this.#n)?"":void 0,"data-expanded":o(this.#n)?void 0:"","data-pane-state":o(this.#s),...this.attachment}));get props(){return o(this.#i)}set props(e){y(this.#i,e)}}var fd=P("<div><!></div>");function pd(r,e){const t=ri();Qe(e,!0);let a=W(e,"autoSaveId",3,null),n=W(e,"id",3,t),i=W(e,"keyboardResizeBy",3,null),s=W(e,"onLayoutChange",3,Mn),l=W(e,"storage",3,gr),d=W(e,"ref",15,null),u=si(e,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const c=vi.create({id:Je.with(()=>n()??t),ref:Je.with(()=>d(),I=>d(I)),autoSaveId:Je.with(()=>a()),direction:Je.with(()=>e.direction),keyboardResizeBy:Je.with(()=>i()),onLayout:Je.with(()=>s()),storage:Je.with(()=>l())}),p=()=>c.layout,h=c.setLayout,v=()=>c.opts.id.current,m=se(()=>ci(u,c.props));var w=ht(),b=Ke(w);{var k=I=>{var M=ht(),S=Ke(M);Qn(S,()=>e.child,()=>({props:o(m)})),x(I,M)},C=I=>{var M=fd();ya(M,()=>({...o(m)}));var S=f(M);Qn(S,()=>e.children??Kt),x(I,M)};H(b,I=>{e.child?I(k):I(C,!1)})}return x(r,w),et({getLayout:p,setLayout:h,getId:v})}var hd=P("<div><!></div>");function Hi(r,e){const t=ri();Qe(e,!0);let a=W(e,"id",3,t),n=W(e,"ref",15,null),i=W(e,"onCollapse",3,Mn),s=W(e,"onExpand",3,Mn),l=W(e,"onResize",3,Mn),d=si(e,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const u=gi.create({id:Je.with(()=>a()),ref:Je.with(()=>n(),O=>n(O)),collapsedSize:Je.with(()=>e.collapsedSize),collapsible:Je.with(()=>e.collapsible),defaultSize:Je.with(()=>e.defaultSize),maxSize:Je.with(()=>e.maxSize),minSize:Je.with(()=>e.minSize),onCollapse:Je.with(()=>i()),onExpand:Je.with(()=>s()),onResize:Je.with(()=>l()),order:Je.with(()=>e.order)}),c=u.pane.collapse,p=u.pane.expand,h=u.pane.getSize,v=u.pane.isCollapsed,m=u.pane.isExpanded,w=u.pane.resize,b=u.pane.getId,k=se(()=>ci(d,u.props));var C=ht(),I=Ke(C);{var M=O=>{var A=ht(),$=Ke(A);Qn($,()=>e.child,()=>({props:o(k)})),x(O,A)},S=O=>{var A=hd();ya(A,()=>({...o(k)}));var $=f(A);Qn($,()=>e.children??Kt),x(O,A)};H(I,O=>{e.child?O(M):O(S,!1)})}return x(r,C),et({collapse:c,expand:p,getSize:h,isCollapsed:v,isExpanded:m,resize:w,getId:b})}var vd=P("<div><!></div>");function md(r,e){const t=ri();Qe(e,!0);let a=W(e,"id",3,t),n=W(e,"ref",15,null),i=W(e,"disabled",3,!1),s=W(e,"onDraggingChange",3,Mn),l=W(e,"tabindex",3,0),d=si(e,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const u=mi.create({id:Je.with(()=>a()),ref:Je.with(()=>n(),w=>n(w)),disabled:Je.with(()=>i()),onDraggingChange:Je.with(()=>s()),tabIndex:Je.with(()=>l())}),c=se(()=>ci(d,u.props));var p=ht(),h=Ke(p);{var v=w=>{var b=ht(),k=Ke(b);Qn(k,()=>e.child,()=>({props:o(c)})),x(w,b)},m=w=>{var b=vd();ya(b,()=>({...o(c)}));var k=f(b);Qn(k,()=>e.children??Kt),x(w,b)};H(h,w=>{e.child?w(v):w(m,!1)})}x(r,p),et()}const Br={SIDEBAR_EXPANDED:"editme_sidebar_expanded",SIDEBAR_SECTION:"editme_sidebar_section"},Ra={sidebar:{isExpanded:!0,activeSection:"workspace"},isInitialized:!1};function gd(){const{subscribe:r,set:e,update:t}=Jt(Ra);return{subscribe:r,set:e,update:t,initialize(){let a=Ra.sidebar.isExpanded,n=Ra.sidebar.activeSection;try{const i=localStorage.getItem(Br.SIDEBAR_EXPANDED);i&&(a=JSON.parse(i))}catch(i){console.warn("Failed to load sidebar expanded state:",i)}try{const i=localStorage.getItem(Br.SIDEBAR_SECTION);i&&wd(i)&&(n=i)}catch(i){console.warn("Failed to load sidebar section:",i)}t(i=>({...i,sidebar:{isExpanded:a,activeSection:n},isInitialized:!0}))},toggleSidebar(){t(a=>{const n=!a.sidebar.isExpanded;try{localStorage.setItem(Br.SIDEBAR_EXPANDED,JSON.stringify(n))}catch(i){console.warn("Failed to save sidebar expanded state:",i)}return{...a,sidebar:{...a.sidebar,isExpanded:n}}})},setSidebarSection(a){t(n=>{try{localStorage.setItem(Br.SIDEBAR_SECTION,a)}catch(i){console.warn("Failed to save sidebar section:",i)}return{...n,sidebar:{...n.sidebar,activeSection:a}}})}}}function wd(r){return["workspace","metadata","manifest","navigation","spine","settings"].includes(r)}const Rn=gd();typeof window<"u"&&Rn.initialize();const Pr={en:{code:"en",name:"English",direction:"ltr",englishName:"English"},de:{code:"de",name:"Deutsch",direction:"ltr",englishName:"German"},ka:{code:"ka",name:"ქართული",direction:"ltr",englishName:"Georgian"},ar:{code:"ar",name:"العربية",direction:"rtl",englishName:"Arabic"},he:{code:"he",name:"עברית",direction:"rtl",englishName:"Hebrew"},"zh-Hant":{code:"zh-Hant",name:"繁體中文",direction:"ltr",englishName:"Traditional Chinese"},ja:{code:"ja",name:"日本語",direction:"ltr",englishName:"Japanese"}},Mr="en",yd=["ar","he"];function xa(r){return yd.includes(r)}function bd(){if(typeof navigator>"u")return Mr;const r=navigator.languages||[navigator.language];for(const e of r){if(Pr[e])return e;const t=e.split("-")[0];if(Pr[t])return t;if(t==="zh"&&["zh-TW","zh-HK","zh-MO"].includes(e))return"zh-Hant"}return Mr}const _d=`/**
 * OPFS Worker Script
 *
 * Handles OPFS sync access handle operations in a Web Worker.
 * Used primarily on Safari where sync access handles work better in workers.
 *
 * NOTE: This file MUST remain JavaScript (not TypeScript) because it gets
 * injected as a worker blob URL to support sync access handles in Safari.
 * Claude/agents should NOT convert this file to TypeScript.
 */

let opfsRoot = null;

async function getOPFSRoot() {
  if (!opfsRoot) {
    opfsRoot = await navigator.storage.getDirectory();
  }
  return opfsRoot;
}

async function ensureWorkspaceDirectory(workspaceId) {
  const root = await getOPFSRoot();
  const workspacesDir = await root.getDirectoryHandle('workspaces', { create: true });
  return await workspacesDir.getDirectoryHandle(workspaceId, { create: true });
}

async function ensureDirectoryPath(baseHandle, path) {
  const pathParts = path.split('/').filter(part => part.length > 0);
  let currentHandle = baseHandle;

  for (const part of pathParts) {
    currentHandle = await currentHandle.getDirectoryHandle(part, { create: true });
  }

  return currentHandle;
}

async function getFileHandle(workspaceId, path, create = false) {
  const workspaceHandle = await ensureWorkspaceDirectory(workspaceId);

  const pathParts = path.split('/');
  const fileName = pathParts.pop();
  const dirPath = pathParts.join('/');

  let targetDir = workspaceHandle;
  if (dirPath) {
    targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
  }

  return await targetDir.getFileHandle(fileName, { create });
}

async function createWorkspace(data) {
  try {
    await ensureWorkspaceDirectory(data.workspaceId);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteWorkspace(data) {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    await workspacesDir.removeEntry(data.workspaceId, { recursive: true });
    return { success: true };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true }; // Already deleted
    }
    return { success: false, error: error.message };
  }
}

async function listWorkspaces() {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    const workspaces = [];

    for await (const [name, handle] of workspacesDir.entries()) {
      if (handle.kind === 'directory') {
        workspaces.push(name);
      }
    }

    return { success: true, workspaces: workspaces.sort() };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true, workspaces: [] };
    }
    return { success: false, error: error.message };
  }
}

async function writeFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, true);
    const syncHandle = await fileHandle.createSyncAccessHandle();

    try {
      // Truncate the file first to ensure complete overwrite
      syncHandle.truncate(data.content.byteLength);
      syncHandle.write(data.content, { at: 0 });
      syncHandle.flush();
    } finally {
      syncHandle.close();
    }

    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function readFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, false);
    const file = await fileHandle.getFile();
    const content = await file.arrayBuffer();
    return { success: true, content };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteFile(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);

    const pathParts = data.path.split('/');
    const fileName = pathParts.pop();
    const dirPath = pathParts.join('/');

    let targetDir = workspaceHandle;
    if (dirPath) {
      targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
    }

    await targetDir.removeEntry(fileName);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function collectFiles(dirHandle, currentPath, files) {
  for await (const [name, handle] of dirHandle.entries()) {
    const fullPath = currentPath ? \`\${currentPath}/\${name}\` : name;

    if (handle.kind === 'file') {
      files.push(fullPath);
    } else if (handle.kind === 'directory') {
      await collectFiles(handle, fullPath, files);
    }
  }
}

async function listFiles(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);
    let targetDir = workspaceHandle;

    if (data.basePath) {
      try {
        targetDir = await ensureDirectoryPath(workspaceHandle, data.basePath);
      } catch (error) {
        if (error.name === 'NotFoundError') {
          return { success: true, files: [] };
        }
        throw error;
      }
    }

    const files = [];
    await collectFiles(targetDir, data.basePath || '', files);
    return { success: true, files: files.sort() };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function getQuota() {
  try {
    if ('storage' in navigator && 'estimate' in navigator.storage) {
      const estimate = await navigator.storage.estimate();
      return {
        success: true,
        quota: {
          used: estimate.usage || 0,
          available: (estimate.quota || 0) - (estimate.usage || 0),
        },
      };
    }
    return { success: true, quota: { used: 0, available: 0 } };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// Worker message handler
self.addEventListener('message', async event => {
  const { type, data, id } = event.data;
  let result;

  try {
    switch (type) {
      case 'createWorkspace':
        result = await createWorkspace(data);
        break;
      case 'deleteWorkspace':
        result = await deleteWorkspace(data);
        break;
      case 'listWorkspaces':
        result = await listWorkspaces();
        break;
      case 'writeFile':
        result = await writeFile(data);
        break;
      case 'readFile':
        result = await readFile(data);
        break;
      case 'deleteFile':
        result = await deleteFile(data);
        break;
      case 'listFiles':
        result = await listFiles(data);
        break;
      case 'getQuota':
        result = await getQuota();
        break;
      default:
        result = { success: false, error: \`Unknown operation: \${type}\` };
    }
  } catch (error) {
    result = { success: false, error: error.message };
  }

  const response = { type, result, id };
  self.postMessage(response);
});
`;class xd{worker=null;messageId=0;pendingMessages=new Map;timeout=1e4;isDestroyed=!1;constructor(){this.initWorker()}initWorker(){const e=new Blob([_d],{type:"application/javascript"}),t=URL.createObjectURL(e);this.worker=new Worker(t),this.worker.onmessage=this.handleWorkerMessage.bind(this),this.worker.onerror=this.handleWorkerError.bind(this),this.worker.onmessageerror=this.handleWorkerMessageError.bind(this),URL.revokeObjectURL(t)}handleWorkerMessage(e){const{result:t,id:a,type:n}=e.data;if(n==="readFile"&&t&&!t.success?console.warn(`⚠️ Worker readFile failed: ${t.error}`):n==="readFile"&&t&&t.content===null&&console.warn(`⚠️ Empty ArrayBuffer received for ${t.path||"unknown path"}`),this.pendingMessages.has(a)){const{resolve:i}=this.pendingMessages.get(a);this.pendingMessages.delete(a),i(t)}}handleWorkerError(e){const t=new Error(`Worker error: ${e.message||"Unknown error"}`);this.rejectAllPendingMessages(t)}handleWorkerMessageError(e){const t=new Error("Worker message error: Failed to deserialize message");this.rejectAllPendingMessages(t)}rejectAllPendingMessages(e){for(const{reject:t}of this.pendingMessages.values())t(e);this.pendingMessages.clear()}async sendMessage(e,t){if(this.isDestroyed)throw new Error("Worker terminated");if(!this.worker)throw new Error("Worker not initialized");return new Promise((a,n)=>{const i=++this.messageId;this.pendingMessages.set(i,{resolve:a,reject:n}),this.worker.postMessage({type:e,data:t,id:i}),setTimeout(()=>{this.pendingMessages.has(i)&&(this.pendingMessages.delete(i),n(new Error(`Worker operation timed out after ${this.timeout}ms`)))},this.timeout)})}setTimeout(e){this.timeout=e}async createWorkspace(e){return await this.sendMessage("createWorkspace",{workspaceId:e})}async deleteWorkspace(e){return await this.sendMessage("deleteWorkspace",{workspaceId:e})}async listWorkspaces(){return await this.sendMessage("listWorkspaces")}async writeFile(e,t,a){return await this.sendMessage("writeFile",{workspaceId:e,path:t,content:a})}async readFile(e,t){return await this.sendMessage("readFile",{workspaceId:e,path:t})}async deleteFile(e,t){return await this.sendMessage("deleteFile",{workspaceId:e,path:t})}async listFiles(e,t){return await this.sendMessage("listFiles",{workspaceId:e,basePath:t})}async getFileInfo(e,t){return await this.sendMessage("getFileInfo",{workspaceId:e,path:t})}async getQuota(){return await this.sendMessage("getQuota")}destroy(){if(this.isDestroyed)return;this.isDestroyed=!0;const e=new Error("Worker terminated");this.rejectAllPendingMessages(e),this.worker&&(this.worker.terminate(),this.worker=null)}}class Sd{capabilityCache=null;async testOPFSAvailable(){try{return"storage"in navigator&&"getDirectory"in navigator.storage}catch{return!1}}async testOPFSAsync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_async_test__",{create:!0});if(!("createWritable"in t))return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1;try{return await(await t.createWritable()).close(),await e.removeEntry("__opfs_async_test__"),!0}catch{return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_sync_test__",{create:!0});if(!("createSyncAccessHandle"in t))return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1;try{return(await t.createSyncAccessHandle()).close(),await e.removeEntry("__opfs_sync_test__"),!0}catch{return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSyncWorker(){return new Promise(e=>{try{const t=`
					(async () => {
						try {
							const root = await navigator.storage.getDirectory();
							const testHandle = await root.getFileHandle('__worker_test__', { create: true });
							if ('createSyncAccessHandle' in testHandle) {
								const syncHandle = await testHandle.createSyncAccessHandle();
								syncHandle.close();
								await root.removeEntry('__worker_test__');
								self.postMessage({ success: true });
							} else {
								self.postMessage({ success: false });
							}
						} catch (error) {
							self.postMessage({ success: false, error: error.message });
						}
					})();
				`,a=new Blob([t],{type:"application/javascript"}),n=URL.createObjectURL(a),i=new Worker(n),s=setTimeout(()=>{i.terminate(),URL.revokeObjectURL(n),e(!1)},3e3);i.onmessage=l=>{clearTimeout(s),i.terminate(),URL.revokeObjectURL(n),e(l.data.success===!0)},i.onerror=()=>{clearTimeout(s),i.terminate(),URL.revokeObjectURL(n),e(!1)}}catch{e(!1)}})}async testIndexedDB(){return new Promise(e=>{try{if(!("indexedDB"in globalThis)){e(!1);return}const t=indexedDB.open("__capability_test__",1);t.onerror=()=>{e(!1)},t.onsuccess=()=>{t.result.close(),indexedDB.deleteDatabase("__capability_test__"),e(!0)},t.onupgradeneeded=a=>{const n=a.target.result;n.objectStoreNames.contains("test")||n.createObjectStore("test")}}catch{e(!1)}})}async testStorageEstimate(){try{return!("storage"in navigator)||!("estimate"in navigator.storage)?!1:(await navigator.storage.estimate(),!0)}catch{return!1}}async detectCapabilities(){if(this.capabilityCache)return this.capabilityCache;try{const[e,t,a,n,i,s]=await Promise.all([this.testOPFSAvailable().catch(()=>!1),this.testOPFSAsync().catch(()=>!1),this.testOPFSSync().catch(()=>!1),this.testOPFSSyncWorker().catch(()=>!1),this.testIndexedDB().catch(()=>!1),this.testStorageEstimate().catch(()=>!1)]);return this.capabilityCache={opfs:e,opfsAsync:t,opfsSync:a,opfsSyncWorker:n,indexedDB:i,storageEstimate:s},this.capabilityCache}catch{return this.capabilityCache={opfs:!1,opfsAsync:!1,opfsSync:!1,opfsSyncWorker:!1,indexedDB:!1,storageEstimate:!1},this.capabilityCache}}async detectOptimalBackend(){const e=await this.detectCapabilities();if(e.opfsAsync)return"opfs-async";if(e.opfsSyncWorker)return"opfs-sync";if(e.indexedDB)return"indexeddb";throw new Error("No storage backend available")}clearCache(){this.capabilityCache=null}}class Gn{static featureDetector=new Sd;static cachedBackend=null;static async detectStorageBackend(){return await this.featureDetector.detectOptimalBackend()}static async testWorkerSyncAccessHandle(){return await this.featureDetector.testOPFSSyncWorker()}static async create(){if(Gn.cachedBackend)return Gn.cachedBackend;const e=await this.detectStorageBackend();let t;switch(e){case"opfs-sync":t=new kd;break;case"opfs-async":t=new Ed,await t.init?.();break;case"indexeddb":t=new Td,await t.init?.();break;default:throw new Error(`Unsupported backend: ${e}`)}return Gn.cachedBackend=t,t}static async getCapabilities(){return await this.featureDetector.detectCapabilities()}static clearCache(){this.featureDetector.clearCache(),Gn.cachedBackend=null}}class Ed{root=null;async init(){if(!("storage"in navigator&&"getDirectory"in navigator.storage))throw new Error("OPFS not available");this.root=await navigator.storage.getDirectory()}async ensureWorkspaceDirectory(e){if(!this.root)throw new Error("Backend not initialized");return await(await this.root.getDirectoryHandle("workspaces",{create:!0})).getDirectoryHandle(e,{create:!0})}async ensureDirectoryPath(e,t){const a=t.split("/").filter(i=>i.length>0);let n=e;for(const i of a)n=await n.getDirectoryHandle(i,{create:!0});return n}async getFileHandle(e,t,a=!1){const n=await this.ensureWorkspaceDirectory(e),i=t.split("/"),s=i.pop(),l=i.join("/");let d=n;return l&&(d=await this.ensureDirectoryPath(n,l)),await d.getFileHandle(s,{create:a})}async createWorkspace(e){await this.ensureWorkspaceDirectory(e)}async deleteWorkspace(e){if(!this.root)throw new Error("Backend not initialized");try{await(await this.root.getDirectoryHandle("workspaces")).removeEntry(e,{recursive:!0})}catch(t){if(t.name!=="NotFoundError")throw t}}async listWorkspaces(){if(!this.root)throw new Error("Backend not initialized");try{const e=await this.root.getDirectoryHandle("workspaces"),t=[];for await(const[a,n]of e.entries())n.kind==="directory"&&t.push(a);return t.sort()}catch(e){if(e.name==="NotFoundError")return[];throw e}}async writeFile(e,t,a){const n=await this.getFileHandle(e,t,!0);await this.writeFileWithFallback(n,a)}async writeFileWithFallback(e,t){try{const a=await e.createWritable();try{await a.write(t)}finally{await a.close()}}catch(a){if("createSyncAccessHandle"in e){const n=await e.createSyncAccessHandle();try{n.truncate(t.byteLength),n.write(t,{at:0}),n.flush()}finally{n.close()}}else throw a}}async readFile(e,t){return await(await(await this.getFileHandle(e,t,!1)).getFile()).arrayBuffer()}async deleteFile(e,t){const a=await this.ensureWorkspaceDirectory(e),n=t.split("/"),i=n.pop(),s=n.join("/");let l=a;s&&(l=await this.ensureDirectoryPath(a,s)),await l.removeEntry(i)}async listFiles(e,t){const a=await this.ensureWorkspaceDirectory(e);let n=a;const i=t?t.replace(/\/+$/,""):"";if(i)try{n=await this.ensureDirectoryPath(a,i)}catch(l){if(l.name==="NotFoundError")return[];throw l}const s=[];return await this.collectFiles(n,i,s),s.sort()}async getFileInfo(e,t){const n=await(await this.getFileHandle(e,t,!1)).getFile();return{size:n.size,lastModified:new Date(n.lastModified)}}async collectFiles(e,t,a){for await(const[n,i]of e.entries()){const s=t?`${t}/${n}`:n;i.kind==="file"?a.push(s):i.kind==="directory"&&await this.collectFiles(i,s,a)}}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}return{used:0,available:0}}getBackendType(){return"opfs-async"}}class kd{workerManager;constructor(){this.workerManager=new xd}async sendMessage(e,t){return await this.workerManager.sendMessage(e,t)}destroy(){this.workerManager.destroy()}async createWorkspace(e){const t=await this.workerManager.createWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to create workspace")}async deleteWorkspace(e){const t=await this.workerManager.deleteWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to delete workspace")}async listWorkspaces(){const e=await this.workerManager.listWorkspaces();if(!e.success)throw new Error(e.error?.message||"Failed to list workspaces");return e.workspaces||[]}async writeFile(e,t,a){const n=await this.workerManager.writeFile(e,t,a);if(!n.success)throw new Error(n.error?.message||"Failed to write file")}async readFile(e,t){const a=await this.workerManager.readFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to read file");const n=a.content;if(!n||!(n instanceof ArrayBuffer))return console.warn(`⚠️ Invalid ArrayBuffer received for ${t}: ${typeof n}, length: ${n?.byteLength||"undefined"}`),new ArrayBuffer(0);try{return n.byteLength===0&&console.warn(`⚠️ Empty ArrayBuffer received for ${t}`),n}catch(i){return console.warn(`⚠️ Detached ArrayBuffer received for ${t}:`,i),new ArrayBuffer(0)}}async deleteFile(e,t){const a=await this.workerManager.deleteFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to delete file")}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0,n=await this.workerManager.listFiles(e,a);if(!n.success)throw new Error(n.error?.message||"Failed to list files");return n.files||[]}async getFileInfo(e,t){const a=await this.workerManager.getFileInfo(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to get file info");return a.data?.fileInfo||{size:0,lastModified:new Date}}async getQuota(){const e=await this.workerManager.getQuota();if(!e.success)throw new Error(e.error?.message||"Failed to get quota");return e.data?.quota||{used:0,available:0}}getBackendType(){return"opfs-sync"}}class Td{db=null;dbName="editme-storage";version=1;async init(){return new Promise((e,t)=>{if(!("indexedDB"in globalThis)){t(new Error("IndexedDB not available"));return}const a=indexedDB.open(this.dbName,this.version);a.onerror=()=>{t(new Error(`Failed to open IndexedDB: ${a.error?.message}`))},a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=n=>{const i=n.target.result;if(i.objectStoreNames.contains("workspaces")||i.createObjectStore("workspaces",{keyPath:"id"}).createIndex("created","created",{unique:!1}),!i.objectStoreNames.contains("files")){const s=i.createObjectStore("files",{keyPath:["workspaceId","path"]});s.createIndex("workspaceId","workspaceId",{unique:!1}),s.createIndex("modified","modified",{unique:!1})}}})}async transaction(e,t,a){if(!this.db)throw new Error("Database not initialized");return new Promise((n,i)=>{const s=this.db.transaction(e,t);s.onerror=()=>{i(new Error(`Transaction failed: ${s.error?.message}`))},a(s).then(n).catch(i)})}async putRecord(e,t){return new Promise((a,n)=>{const i=e.put(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Put failed: ${i.error?.message}`))})}async getRecord(e,t){return new Promise((a,n)=>{const i=e.get(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`Get failed: ${i.error?.message}`))})}async deleteRecord(e,t){return new Promise((a,n)=>{const i=e.delete(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Delete failed: ${i.error?.message}`))})}async getAllRecords(e,t){return new Promise((a,n)=>{const i=e.getAll(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`GetAll failed: ${i.error?.message}`))})}async createWorkspace(e){await this.transaction(["workspaces"],"readwrite",async t=>{const a=t.objectStore("workspaces");await this.putRecord(a,{id:e,created:Date.now()})})}async deleteWorkspace(e){await this.transaction(["workspaces","files"],"readwrite",async t=>{const a=t.objectStore("workspaces"),n=t.objectStore("files"),i=n.index("workspaceId"),s=await this.getAllRecords(i,IDBKeyRange.only(e));for(const l of s)await this.deleteRecord(n,[l.workspaceId,l.path]);await this.deleteRecord(a,e)})}async listWorkspaces(){return await this.transaction(["workspaces"],"readonly",async e=>{const t=e.objectStore("workspaces");return(await this.getAllRecords(t)).map(n=>n.id).sort()})}async writeFile(e,t,a){await this.transaction(["files"],"readwrite",async n=>{const i=n.objectStore("files");await this.putRecord(i,{workspaceId:e,path:t,content:a,modified:Date.now()})})}async readFile(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return i.content})}async deleteFile(e,t){await this.transaction(["files"],"readwrite",async a=>{const n=a.objectStore("files");await this.deleteRecord(n,[e,t])})}async listFiles(e,t){return await this.transaction(["files"],"readonly",async a=>{const i=a.objectStore("files").index("workspaceId");let l=(await this.getAllRecords(i,IDBKeyRange.only(e))).map(d=>d.path);if(t){const u=t.replace(/\/+$/,"")+"/";l=l.filter(c=>c.startsWith(u))}return l.sort()})}async getFileInfo(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return{size:i.content.byteLength,lastModified:new Date(i.modified)}})}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage)try{const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}catch{}return{used:0,available:0}}getBackendType(){return"indexeddb"}}class Cd{backend=null;initialized=!1;async init(){this.initialized||(this.backend=await Gn.create(),this.initialized=!0)}isInitialized(){return this.initialized&&this.backend!==null}getBackendType(){if(!this.backend)throw new Error("Storage manager not initialized");return this.backend.getBackendType()}generateWorkspaceId(){return"workspace-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}async createWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");const t=e||this.generateWorkspaceId();return await this.backend.createWorkspace(t),t}async deleteWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteWorkspace(e)}async listWorkspaces(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listWorkspaces()}async writeFile(e,t,a){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.writeFile(e,t,a)}async readFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.readFile(e,t)}async deleteFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteFile(e,t)}async listFiles(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listFiles(e,t)}async getFileInfo(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getFileInfo(e,t)}async getQuota(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getQuota()}async writeTextFile(e,t,a){const i=new TextEncoder().encode(a).buffer;await this.writeFile(e,t,i)}async readTextFile(e,t){const a=await this.readFile(e,t);return new TextDecoder().decode(a)}async fileExists(e,t){try{return await this.readFile(e,t),!0}catch{return!1}}async getFileSize(e,t){return(await this.readFile(e,t)).byteLength}destroy(){this.backend&&"destroy"in this.backend&&this.backend.destroy(),this.backend=null,this.initialized=!1}}class Dt{static instance=null;manager;initPromise=null;constructor(){this.manager=new Cd}static getInstance(){return Dt.instance||(Dt.instance=new Dt),Dt.instance}static async getInitializedInstance(){const e=Dt.getInstance();return e.isInitialized()||await e.init(),e}static resetInstance(){Dt.instance&&(Dt.instance.destroy(),Dt.instance=null)}async init(){if(!this.manager.isInitialized()){if(this.initPromise){await this.initPromise;return}this.initPromise=this.doInit();try{await this.initPromise}finally{this.initPromise=null}}}async doInit(){await this.manager.init(),console.log("FileStorageAPI initialized with backend:",this.manager.getBackendType())}isInitialized(){return this.manager.isInitialized()}getBackendType(){return this.manager.getBackendType()}async createWorkspace(e){return await this.manager.createWorkspace(e)}async deleteWorkspace(e){await this.manager.deleteWorkspace(e)}async listWorkspaces(){return await this.manager.listWorkspaces()}async writeFile(e,t,a){await this.manager.writeFile(e,t,a)}async readFile(e,t){return await this.manager.readFile(e,t)}async deleteFile(e,t){await this.manager.deleteFile(e,t)}async renameFile(e,t,a){const n=await this.manager.readFile(e,t);await this.manager.writeFile(e,a,n),await this.manager.deleteFile(e,t)}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0;return await this.manager.listFiles(e,a)}async getFileInfo(e,t){return await this.manager.getFileInfo(e,t)}async getQuota(){return await this.manager.getQuota()}async estimateWorkspaceSize(e){const t=await this.manager.listFiles(e);let a=0;for(const n of t)try{const i=await this.manager.getFileSize(e,n);a+=i}catch{}return a}async writeTextFile(e,t,a){await this.manager.writeTextFile(e,t,a)}async readTextFile(e,t){return await this.manager.readTextFile(e,t)}async fileExists(e,t){return await this.manager.fileExists(e,t)}supportsDirectBlobURLs(){const e=this.manager.getBackendType();return e==="opfs-async"||e==="opfs-sync"}async getFile(e,t){if(!this.manager.isInitialized())throw new Error("Storage manager not initialized");const a=this.manager.getBackendType();if(a==="opfs-async")return await(await this.manager.backend.getFileHandle(e,t,!1)).getFile();if(a==="opfs-sync"){const n=await this.readFile(e,t),i=t.split("/").pop()||"file";return new File([n],i)}else throw new Error("Direct file access not supported for IndexedDB backend")}destroy(){this.manager.destroy()}}function ao(r){return new ReadableStream({start(e){e.enqueue(r),e.close()}})}function Fd(r,e="download.x"){const t=window.URL.createObjectURL(r),a=document.createElement("a");a.href=t,a.setAttribute("download",e),a.click(),window.URL.revokeObjectURL(t)}async function io(r,e){const t=r.getReader();let a=!1;const n=[];for(;!a;){const i=await t.read();a=i.done,i.value&&n.push(i.value)}return new Blob(n,{type:e})}function dn(r,e,t){const a=[];for(let n=0;n<t;n++)a.push(String.fromCharCode(r.getUint8(e+n)));return a.join("")}class Lr{#e;#t=0;#r=[];#a=[];#n=null;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const t=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([t]);if(e.compressionMethod===8){const a=new DecompressionStream("deflate-raw"),i=ao(t).pipeThrough(a);return await io(i)}else throw new Error(`Unsupported compression method: ${e.compressionMethod}`)}read(){for(;!this.#n&&this.#t<this.#e.byteLength-4;){const e=this.#e.getUint32(this.#t,!0);if(e===67324752){const t=this.readLocalFile(this.#t);t.startsAt=this.#t+30+t.fileNameLength+t.extraLength,t.extract=this.extract.bind(this,t),this.#r.push(t),this.#t=t.startsAt+t.compressedSize}else if(e===33639248){const t=this.readCentralDirectory(this.#t);this.#a.push(t),this.#t+=46+t.fileNameLength+t.extraLength+t.fileCommentLength}else if(e===101010256){this.#n=this.readEndCentralDirectory(this.#t);break}else this.#t++}}readLocalFile(e){const t=this.#e.getUint16(e+26,!0),a=this.#e.getUint16(e+28,!0);return{signature:dn(this.#e,e,4),version:this.#e.getUint16(e+4,!0),generalPurpose:this.#e.getUint16(e+6,!0),compressionMethod:this.#e.getUint16(e+8,!0),lastModifiedTime:this.#e.getUint16(e+10,!0),lastModifiedDate:this.#e.getUint16(e+12,!0),crc:this.#e.getUint32(e+14,!0),compressedSize:this.#e.getUint32(e+18,!0),uncompressedSize:this.#e.getUint32(e+22,!0),fileNameLength:t,fileName:dn(this.#e,e+30,t),extraLength:a,extra:dn(this.#e,e+30+t,a),startsAt:0,extract:()=>Promise.resolve(new Blob)}}readCentralDirectory(e){const t=this.#e.getUint16(e+28,!0),a=this.#e.getUint16(e+30,!0),n=this.#e.getUint16(e+32,!0);return{signature:dn(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:t,extraLength:a,fileCommentLength:n,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(e+42,!0),fileName:dn(this.#e,e+46,t),extra:dn(this.#e,e+46+t,a),comments:dn(this.#e,e+46+t+a,n)}}readEndCentralDirectory(e){const t=this.#e.getUint16(e+20,!0);return{signature:dn(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:t,comment:dn(this.#e,e+22,t)}}get entries(){return this.#r}}class Jn{#e=[];static _crcTable=[];constructor(){this.#e=[]}async addFile(e,t,a={}){const{compressionMethod:n=e==="mimetype"?0:8,lastModified:i=new Date}=a;let s,l,d,u,c;if(t instanceof ArrayBuffer)c=t;else if(t instanceof Uint8Array)c=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);else if(t instanceof Blob)c=await t.arrayBuffer();else if(typeof t=="string")c=new TextEncoder().encode(t).buffer;else throw new Error("Unsupported data type");if(d=c.byteLength,l=this.#s(new Uint8Array(c)),n===0)s=c,u=d;else if(n===8){const h=new CompressionStream("deflate-raw"),m=ao(c).pipeThrough(h);s=await(await io(m)).arrayBuffer(),u=s.byteLength}else throw new Error(`Unsupported compression method: ${n}`);const p={fileName:e,compressionMethod:n,lastModified:i,crc32:l,compressedSize:u,uncompressedSize:d,data:s,localHeaderOffset:0};return this.#e.push(p),this}async build(){const e=[];let t=0;const a=[...this.#e].sort((u,c)=>u.fileName==="mimetype"?-1:c.fileName==="mimetype"?1:0);for(const u of a){u.localHeaderOffset=t;const c=this.#t(u);e.push(c),t+=c.byteLength,e.push(u.data),t+=u.data.byteLength}const n=t;for(const u of a){const c=this.#r(u);e.push(c),t+=c.byteLength}const i=this.#a(this.#e.length,t-n,n);e.push(i);const s=e.reduce((u,c)=>u+c.byteLength,0),l=new Uint8Array(s);let d=0;for(const u of e)l.set(new Uint8Array(u),d),d+=u.byteLength;return l.buffer}async buildBlob(){const e=await this.build();return new Blob([e],{type:"application/zip"})}#t(e){const t=new TextEncoder().encode(e.fileName),a=30+t.length,n=new ArrayBuffer(a),i=new DataView(n),s=new Uint8Array(n);i.setUint32(0,67324752,!0),i.setUint16(4,20,!0),i.setUint16(6,0,!0),i.setUint16(8,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(10,l.time,!0),i.setUint16(12,l.date,!0),i.setUint32(14,e.crc32,!0),i.setUint32(18,e.compressedSize,!0),i.setUint32(22,e.uncompressedSize,!0),i.setUint16(26,t.length,!0),i.setUint16(28,0,!0),s.set(t,30),n}#r(e){const t=new TextEncoder().encode(e.fileName),a=46+t.length,n=new ArrayBuffer(a),i=new DataView(n),s=new Uint8Array(n);i.setUint32(0,33639248,!0),i.setUint16(4,20,!0),i.setUint16(6,20,!0),i.setUint16(8,0,!0),i.setUint16(10,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(12,l.time,!0),i.setUint16(14,l.date,!0),i.setUint32(16,e.crc32,!0),i.setUint32(20,e.compressedSize,!0),i.setUint32(24,e.uncompressedSize,!0),i.setUint16(28,t.length,!0),i.setUint16(30,0,!0),i.setUint16(32,0,!0),i.setUint16(34,0,!0),i.setUint16(36,0,!0),i.setUint32(38,0,!0),i.setUint32(42,e.localHeaderOffset,!0),s.set(t,46),n}#a(e,t,a){const n=new ArrayBuffer(22),i=new DataView(n);return i.setUint32(0,101010256,!0),i.setUint16(4,0,!0),i.setUint16(6,0,!0),i.setUint16(8,e,!0),i.setUint16(10,e,!0),i.setUint32(12,t,!0),i.setUint32(16,a,!0),i.setUint16(20,0,!0),n}#n(e){const t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),i=e.getHours(),s=e.getMinutes(),l=Math.floor(e.getSeconds()/2),d=t-1980<<9|a<<5|n,u=i<<11|s<<5|l;return{date:d,time:u}}#s(e){const t=this.#i();let a=4294967295;for(let n=0;n<e.length;n++){const i=e[n];a=a>>>8^t[(a^i)&255]}return(a^4294967295)>>>0}#i(){if(Jn._crcTable.length===0){const e=Array.from({length:256},()=>0);for(let t=0;t<256;t++){let a=t;for(let n=0;n<8;n++)a=a&1?3988292384^a>>>1:a>>>1;e[t]=a}Jn._crcTable=e}return Jn._crcTable}clear(){return this.#e=[],this}get fileCount(){return this.#e.length}getFileNames(){return this.#e.map(e=>e.fileName)}}const Nr="locales";function Id(){return new Pd}class Pd{storage=Dt.getInstance();async needsUpdate(){return!0}async extractTranslations(){let e=globalThis.__EDITME_I18N_BUNDLE__,t;if(e)try{const n=e.split(",")[1];if(!n)throw new Error("Invalid data URL format: missing base64 data");const i=atob(n),s=new Uint8Array(i.length);for(let l=0;l<i.length;l++)s[l]=i.charCodeAt(l);t=s.buffer}catch(n){throw new Error(`Failed to decode embedded translation data: ${n instanceof Error?n.message:"Unknown error"}`)}finally{delete globalThis.__EDITME_I18N_BUNDLE__}else try{const n=await fetch("/i18n-bundle.zip");if(!n.ok)throw new Error(`Failed to fetch i18n-bundle.zip: ${n.status}`);t=await n.arrayBuffer()}catch{throw new Error('Translation data not found. For single file builds, please run "npm run build" to generate a new build with embedded translations.')}let a;try{a=new Lr(t)}catch(n){throw new Error(`Failed to parse ZIP archive: ${n instanceof Error?n.message:"Unknown error"}`)}this.storage.isInitialized()||await this.storage.init(),await this.storage.createWorkspace(Nr);for(const n of a.entries){if(!n.fileName.endsWith(".json"))continue;const s=await(await n.extract()).text();try{JSON.parse(s)}catch(l){throw new Error(`Invalid JSON in ${n.fileName}: ${l instanceof Error?l.message:"Unknown error"}`)}await this.storage.writeTextFile(Nr,n.fileName,s)}}async loadTranslations(){const e={};this.storage.isInitialized()||await this.storage.init();const a=(await this.storage.listFiles(Nr)).filter(n=>n.endsWith(".json"));for(const n of a)try{const i=await this.storage.readTextFile(Nr,n);let s;s=JSON.parse(i);const d=(n.split("/").pop()||n).replace(".json",""),u={locale:d,messages:this.extractMessages(s),headers:s[""]||{}};e[d]=u}catch{}return e}extractMessages(e){const t={};for(const[a,n]of Object.entries(e)){if(a==="")continue;const i=Array.isArray(n)?n[0]:n;typeof i=="string"&&(t[a]=i)}return t}}const Rt=Jt({currentLocale:Mr,locales:Pr,catalogs:{},initialized:!1,loading:!1}),wi=zr(Rt,r=>r.currentLocale);zr(Rt,r=>r.loading);zr(Rt,r=>r.initialized);zr(wi,r=>xa(r)?"rtl":"ltr");const aa={locale:"en",messages:{Save:"Save",Cancel:"Cancel",Delete:"Delete",Edit:"Edit",File:"File",Settings:"Settings",Workspace:"Workspace",Metadata:"Metadata",Manifest:"Manifest",Navigation:"Navigation","Spine Items":"Spine Items"},headers:{}},Md=(r,e={})=>{const t=on(Rt);let n=t.catalogs[t.currentLocale]?.messages[r];if(!n&&t.currentLocale!=="en"&&(n=t.catalogs.en?.messages[r]||aa.messages[r]),n||(n=r),Object.keys(e).length>0)for(const[i,s]of Object.entries(e))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(s));return n},mt=zr(Rt,r=>(e,t={})=>{let n=r.catalogs[r.currentLocale]?.messages[e];if(!n&&r.currentLocale!=="en"&&(n=r.catalogs.en?.messages[e]||aa.messages[e]),n||(n=e),Object.keys(t).length>0)for(const[i,s]of Object.entries(t))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(s));return n});async function so(){const r=on(Rt);if(!(r.initialized||r.loading)){Rt.update(e=>({...e,loading:!0}));try{const e=Id();await e.extractTranslations();const t=await e.loadTranslations();t.en||(t.en=aa);const a=bd(),n=t[a]?a:Mr;typeof document<"u"&&(document.documentElement.setAttribute("data-dir",xa(n)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",n)),Rt.update(i=>({...i,currentLocale:n,catalogs:t,initialized:!0,loading:!1}))}catch(e){console.error("Failed to initialize i18n:",e),Rt.update(t=>({...t,currentLocale:Mr,catalogs:{en:aa},initialized:!0,loading:!1}))}}}async function Ld(r){const e=on(Rt);if(!e.initialized)throw new Error("i18n system not initialized");if(!Pr[r])throw new Error(`Unsupported locale: ${r}`);e.catalogs[r]||console.warn(`Translation catalog for ${r} not loaded, falling back to English`),typeof document<"u"&&(document.documentElement.setAttribute("data-dir",xa(r)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",r)),typeof localStorage<"u"&&localStorage.setItem("editme-locale",r),Rt.update(t=>({...t,currentLocale:r}))}function Dd(){const r=on(Rt);return Object.keys(r.locales).map(e=>r.locales[e])}const oo={translate:Md,getCurrentLocale:()=>on(wi),setLocale:Ld,getAvailableLocales:Dd,hasTranslation:(r,e)=>!!on(Rt).catalogs[r]?.messages[e],isLocaleSupported:r=>!!Pr[r],isRTL:xa,getCatalogs:()=>on(Rt).catalogs,isInitialized:()=>on(Rt).initialized,init:so},$r="editme_theme_preference",Rd={current:"light",systemPreference:"light",isInitialized:!1};function zd(){const{subscribe:r,set:e,update:t}=Jt(Rd);return{subscribe:r,set:e,update:t,initialize(){let a=null,n="light";typeof window<"u"&&window.matchMedia&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");try{const s=localStorage.getItem($r);s&&Ud(s)&&(a=s)}catch(s){console.warn("Failed to load theme preference:",s)}const i=a||n;t(s=>({...s,current:i,systemPreference:n,isInitialized:!0})),pr(i),typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{const d=l.matches?"dark":"light";t(u=>({...u,systemPreference:d})),a||(t(u=>({...u,current:d})),pr(d))})},setTheme(a){t(n=>{try{localStorage.setItem($r,a)}catch(i){console.warn("Failed to save theme preference:",i)}return pr(a),{...n,current:a}})},toggleTheme(){t(a=>{const n=a.current==="light"?"dark":"light";try{localStorage.setItem($r,n)}catch(i){console.warn("Failed to save theme preference:",i)}return pr(n),{...a,current:n}})},useSystemPreference(){t(a=>{try{localStorage.removeItem($r)}catch(n){console.warn("Failed to clear theme preference:",n)}return pr(a.systemPreference),{...a,current:a.systemPreference}})},getCurrentTheme(){return on({subscribe:r}).current}}}function Ud(r){return r==="light"||r==="dark"}function pr(r){typeof document<"u"&&document.documentElement.setAttribute("data-theme",r)}const ia=zd();typeof window<"u"&&ia.initialize();var Ad=As('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>'),Od=As('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),Wd=P('<span class="theme-toggle__label svelte-v7l3jb"> </span>'),jd=P('<button aria-label="Toggle theme"><span class="theme-toggle__icon svelte-v7l3jb" aria-hidden="true"><!></span> <!></button>');function Vi(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(ia,"$themeStore",t),i=je(),s=je();let l=W(e,"size",8,"medium"),d=W(e,"showLabel",8,!0);function u(){ia.toggleTheme()}ot(()=>n(),()=>{y(i,n().current)}),ot(()=>o(i),()=>{y(s,o(i)==="dark")}),Pt(),wt();var c=jd();let p;c.__click=u;var h=f(c),v=f(h);{var m=C=>{var I=Ad();x(C,I)},w=C=>{var I=Od();x(C,I)};H(v,C=>{o(s)?C(m):C(w,!1)})}var b=g(h,2);{var k=C=>{var I=Wd(),M=f(I);U(()=>E(M,o(s)?"Light":"Dark")),x(C,I)};H(b,C=>{d()&&C(k)})}U(C=>{p=nt(c,1,"theme-toggle svelte-v7l3jb",null,p,C),ve(c,"title",`Switch to ${o(s)?"light":"dark"} theme`)},[()=>({"theme-toggle--small":l()==="small","theme-toggle--large":l()==="large"})],ue),x(r,c),et(),a()}bt(["click"]);function Bd(){Rn.toggleSidebar()}function qi(){const r=new CustomEvent("append-spine-item",{bubbles:!0});window.dispatchEvent(r)}var Nd=P('<h2 class="sidebar-title svelte-qtftjm">SEED.html</h2> <div class="header-actions svelte-qtftjm"><!></div>',1),$d=P('<div class="header-actions compact svelte-qtftjm"><!></div>'),Hd=(r,e,t)=>e(o(t).id),Vd=P('<button><span class="section-label svelte-qtftjm"><!></span></button>'),qd=P('<div><span class="section-label svelte-qtftjm"> </span> <button><span class="append-icon svelte-qtftjm">+</span></button></div>'),Gd=P('<div><span class="section-label svelte-qtftjm"> </span> <button><span class="append-icon svelte-qtftjm">+</span></button></div>'),Xd=(r,e,t)=>e(t.id),Jd=P('<aside><div class="sidebar-header svelte-qtftjm"><button class="sidebar-toggle svelte-qtftjm"> </button> <!></div> <div class="sidebar-main svelte-qtftjm"><nav class="sidebar-nav svelte-qtftjm"><!> <!></nav> <div class="spine-items-container svelte-qtftjm"><!></div> <div class="section-content"><!> <!> <!> <!> <!></div></div> <div class="sidebar-footer svelte-qtftjm"><button><span class="section-label svelte-qtftjm"><!></span></button></div></aside>');function Kd(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"isExpanded",8,!0),s=W(e,"activeSection",8,"workspace"),l=W(e,"hasWorkspace",8,!1);const d=[{id:"workspace",icon:"🏠",label:n()("Projects")},{id:"metadata",icon:"📄",label:n()("Metadata")},{id:"manifest",icon:"📋",label:n()("Manifest")},{id:"navigation",icon:"📖",label:n()("Navigation")}],u={id:"settings",icon:"⚙️",label:n()("Settings")};function c(X){!l()&&X!=="workspace"&&X!=="settings"||Rn.setSidebarSection(X)}function p(X){return!l()&&X!=="workspace"&&X!=="settings"}function h(X){return X.slice(0,2).toUpperCase()}wt();var v=Jd();let m;var w=f(v),b=f(w);b.__click=[Bd];var k=f(b),C=g(b,2);{var I=X=>{var re=Nd(),ge=g(Ke(re),2),Ae=f(ge);Vi(Ae,{size:"small",showLabel:!1}),x(X,re)},M=X=>{var re=$d(),ge=f(re);Vi(ge,{size:"small",showLabel:!1}),x(X,re)};H(C,X=>{i()?X(I):X(M,!1)})}var S=g(w,2),O=f(S),A=f(O);xt(A,1,()=>d,It,(X,re)=>{var ge=Vd();let Ae;ge.__click=[Hd,c,re];var We=f(ge),Be=f(We);{var pe=he=>{var Ce=Et();U(Oe=>E(Ce,Oe),[()=>n()(o(re).label)],ue),x(he,Ce)},be=he=>{var Ce=Et();U(Oe=>E(Ce,Oe),[()=>h(n()(o(re).label))],ue),x(he,Ce)};H(Be,he=>{i()?he(pe):he(be,!1)})}U((he,Ce,Oe)=>{Ae=nt(ge,1,"sidebar-section svelte-qtftjm",null,Ae,he),ge.disabled=Ce,ve(ge,"aria-current",s()===o(re).id?"page":void 0),ve(ge,"title",Oe)},[()=>({active:s()===o(re).id,disabled:p(o(re).id)}),()=>p(o(re).id),()=>n()(o(re).label)],ue),x(X,ge)});var $=g(A,2);{var J=X=>{var re=qd();let ge;var Ae=f(re),We=f(Ae),Be=g(Ae,2);let pe;Be.__click=[qi],U((be,he,Ce,Oe,Ve)=>{ge=nt(re,1,"spine-section-header svelte-qtftjm",null,ge,be),E(We,he),pe=nt(Be,1,"append-button-nav svelte-qtftjm",null,pe,Ce),Be.disabled=!l(),ve(Be,"aria-label",Oe),ve(Be,"title",Ve)},[()=>({disabled:!l()}),()=>n()("Spine Items"),()=>({disabled:!l()}),()=>n()("Append Item"),()=>n()("Append Item")],ue),x(X,re)},Z=X=>{var re=Gd();let ge;var Ae=f(re),We=f(Ae),Be=g(Ae,2);let pe;Be.__click=[qi],U((be,he,Ce,Oe,Ve)=>{ge=nt(re,1,"spine-section-header compact svelte-qtftjm",null,ge,be),E(We,he),pe=nt(Be,1,"append-button-nav compact svelte-qtftjm",null,pe,Ce),Be.disabled=!l(),ve(Be,"aria-label",Oe),ve(Be,"title",Ve)},[()=>({disabled:!l()}),()=>h(n()("Spine Items")),()=>({disabled:!l()}),()=>n()("Append Item"),()=>n()("Append Item")],ue),x(X,re)};H($,X=>{i()?X(J):X(Z,!1)})}var D=g(O,2),q=f(D);_t(q,e,"sidebar-spine",{});var R=g(D,2),T=f(R);_t(T,e,"sidebar-workspace",{});var L=g(T,2);_t(L,e,"sidebar-metadata",{});var F=g(L,2);_t(F,e,"sidebar-manifest",{});var ae=g(F,2);_t(ae,e,"sidebar-navigation",{});var B=g(ae,2);_t(B,e,"sidebar-settings",{});var le=g(S,2),Se=f(le);let ze;Se.__click=[Xd,c,u];var xe=f(Se),Le=f(xe);{var de=X=>{var re=Et();U(ge=>E(re,ge),[()=>n()(u.label)],ue),x(X,re)},K=X=>{var re=Et();U(ge=>E(re,ge),[()=>h(n()(u.label))],ue),x(X,re)};H(Le,X=>{i()?X(de):X(K,!1)})}U((X,re,ge,Ae,We)=>{m=nt(v,1,"sidebar svelte-qtftjm",null,m,X),ve(b,"aria-expanded",i()),ve(b,"aria-label",re),E(k,i()?"◀️":"▶️"),ve(O,"aria-label",ge),ze=nt(Se,1,"sidebar-section svelte-qtftjm",null,ze,Ae),ve(Se,"aria-current",s()===u.id?"page":void 0),ve(Se,"title",We)},[()=>({collapsed:!i()}),()=>n()("Toggle sidebar"),()=>n()("Main navigation"),()=>({active:s()===u.id}),()=>n()(u.label)],ue),x(r,v),et(),a()}bt(["click"]);var Yd=P('<div class="pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),Zd=P('<div class="pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),Qd=P("<!> <!> <!>",1),eu=P('<div class="single-pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),tu=P('<div class="app-layout svelte-1b458cb"><!> <div class="main-content svelte-1b458cb"><!></div></div>');function nu(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(Rn,"$layoutStore",t),i=je(),s=je(),l=je();let d=W(e,"hasWorkspace",8,!1);ot(()=>(o(i),n()),()=>{(w=>{y(i,w.sidebar)})(n())}),ot(()=>o(i),()=>{y(s,o(i).isExpanded?"250px":"48px")}),ot(()=>o(i),()=>{y(l,o(i).activeSection!=="workspace"&&o(i).activeSection!=="settings")}),Pt();var u=tu(),c=f(u);Kd(c,{get isExpanded(){return o(i).isExpanded},get activeSection(){return o(i).activeSection},get hasWorkspace(){return d()},$$slots:{"sidebar-workspace":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-workspace",{}),x(w,k)},"sidebar-metadata":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-metadata",{}),x(w,k)},"sidebar-manifest":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-manifest",{}),x(w,k)},"sidebar-navigation":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-navigation",{}),x(w,k)},"sidebar-spine":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-spine",{}),x(w,k)},"sidebar-settings":(w,b)=>{var k=ht(),C=Ke(k);_t(C,e,"sidebar-settings",{}),x(w,k)}}});var p=g(c,2),h=f(p);{var v=w=>{pd(w,{direction:"horizontal",autoSaveId:"editme-content-panes",children:(b,k)=>{var C=Qd(),I=Ke(C);Hi(I,{defaultSize:50,minSize:25,children:(O,A)=>{var $=Yd(),J=f($),Z=f(J);_t(Z,e,"left-header",{});var D=g(J,2),q=f(D);_t(q,e,"left-content",{}),x(O,$)},$$slots:{default:!0}});var M=g(I,2);md(M,{});var S=g(M,2);Hi(S,{defaultSize:50,minSize:20,children:(O,A)=>{var $=Zd(),J=f($),Z=f(J);_t(Z,e,"right-header",{});var D=g(J,2),q=f(D);_t(q,e,"right-content",{}),x(O,$)},$$slots:{default:!0}}),x(b,C)},$$slots:{default:!0}})},m=w=>{var b=eu(),k=f(b),C=f(k);_t(C,e,"left-header",{});var I=g(k,2),M=f(I);_t(M,e,"left-content",{}),x(w,b)};H(h,w=>{o(l)?w(v):w(m,!1)})}U(()=>ai(u,`grid-template-columns: ${o(s)??""} 1fr`)),x(r,u),et(),a()}const Cn={CURRENT_VIEW:"editme_nav_current_view",VIEW_HISTORY:"editme_nav_view_history",VIEW_DATA:"editme_nav_view_data"},ru=20,za={currentView:"workspace",previousView:null,viewHistory:["workspace"],viewData:{},isTransitioning:!1,canNavigateBack:!1,canNavigateForward:!1},au=["workspace","metadata","manifest","navigation","spine","settings"];function iu(){const{subscribe:r,set:e,update:t}=Jt(za),a={guards:new Map,nextId:1};let n=0;return{subscribe:r,set:e,update:t,initialize(){let p=za.currentView,h=[...za.viewHistory],v={};try{const b=localStorage.getItem(Cn.CURRENT_VIEW);b&&s(b)&&(p=b);const k=localStorage.getItem(Cn.VIEW_HISTORY);if(k){const I=JSON.parse(k);Array.isArray(I)&&I.every(s)&&(h=I)}const C=localStorage.getItem(Cn.VIEW_DATA);if(C){const I=JSON.parse(C);typeof I=="object"&&I!==null&&(v=I)}}catch(b){console.warn("Failed to load navigation state:",b)}n=h.length-1;const m=n>0,w=!1;t(b=>({...b,currentView:p,previousView:h.length>1?h[h.length-2]:null,viewHistory:h,viewData:v,canNavigateBack:m,canNavigateForward:w,isInitialized:!0})),c(p),Rn.subscribe(({sidebar:b})=>{let k=null;this.subscribe(I=>{k=I.currentView})(),b.activeSection!==k&&(navigator.userAgent.includes("Firefox")?queueMicrotask(()=>{this.navigateTo(b.activeSection,{replaceHistory:!0})}):this.navigateTo(b.activeSection,{replaceHistory:!0}))})},async navigateTo(p,h={}){if(!s(p))return console.error("Invalid view type:",p),!1;const v=i();if(v.currentView===p&&!h.force)return!0;t(m=>({...m,isTransitioning:!0}));try{if(!h.force&&!await l(v.currentView,p))return t(w=>({...w,isTransitioning:!1})),!1;if(v.currentView==="spine"&&p!=="spine"){const m=new CustomEvent("clear-spine-selection");window.dispatchEvent(m)}return await d(p,h),!0}catch(m){return console.error("Navigation error:",m),t(w=>({...w,isTransitioning:!1})),!1}},async canNavigate(p){const h=i(),v=p||h.currentView;if(!s(v))return!1;try{return await l(h.currentView,v)}catch(m){return console.error("Guard execution error:",m),!1}},async goBack(){const p=i();if(!p.canNavigateBack||n<=0)return!1;const h=p.viewHistory[n-1];return!h||!await l(p.currentView,h)?!1:(n--,await u(h,{isHistoryNavigation:!0}),!0)},async goForward(){const p=i();if(!p.canNavigateForward||n>=p.viewHistory.length-1)return!1;const h=p.viewHistory[n+1];return!h||!await l(p.currentView,h)?!1:(n++,await u(h,{isHistoryNavigation:!0}),!0)},setViewData(p,h){if(!s(p)){console.error("Invalid view type for setViewData:",p);return}t(v=>{const m={...v.viewData,[p]:h};try{localStorage.setItem(Cn.VIEW_DATA,JSON.stringify(m))}catch(w){console.warn("Failed to save view data:",w)}return{...v,viewData:m}})},getViewData(p){return s(p)?i().viewData[p]||null:(console.error("Invalid view type for getViewData:",p),null)},clearViewData(p){if(!s(p)){console.error("Invalid view type for clearViewData:",p);return}t(h=>{const v={...h.viewData};delete v[p];try{localStorage.setItem(Cn.VIEW_DATA,JSON.stringify(v))}catch(m){console.warn("Failed to save view data:",m)}return{...h,viewData:v}})},addNavigationGuard(p){const h=`guard_${a.nextId++}`;return a.guards.set(h,p),h},removeNavigationGuard(p){return a.guards.delete(p)}};function i(){let p;return r(h=>p=h)(),p}function s(p){return au.includes(p)}async function l(p,h){const v=Array.from(a.guards.values());for(const m of v)try{if(!await m(p,h))return!1}catch(w){return console.error("Navigation guard error:",w),!1}return!0}async function d(p,h){const v=i();h.viewData&&t(w=>({...w,viewData:{...w.viewData,[p]:h.viewData}}));let m=[...v.viewHistory];h.replaceHistory?(m[m.length-1]=p,n=m.length-1):(m=m.slice(0,n+1),m.push(p),n=m.length-1,m.length>ru&&(m=m.slice(-20),n=m.length-1)),await u(p,{newHistory:m})}async function u(p,h={}){const v=i(),m=h.newHistory||v.viewHistory,w=n>0,b=n<m.length-1;t(k=>({...k,currentView:p,previousView:k.currentView,viewHistory:m,canNavigateBack:w,canNavigateForward:b,isTransitioning:!1}));try{localStorage.setItem(Cn.CURRENT_VIEW,p),localStorage.setItem(Cn.VIEW_HISTORY,JSON.stringify(m))}catch(k){console.warn("Failed to save navigation state:",k)}h.isHistoryNavigation||c(p)}function c(p){try{Rn.setSidebarSection(p)}catch(h){console.warn("Failed to sync to layout store:",h)}}}const yt=iu();typeof window<"u"&&yt.initialize();const su=(r,e)=>{console.log("🎯 WorkspaceActionBar: Create New button clicked!"),e("createNewRequested"),console.log("🎯 WorkspaceActionBar: createNewRequested event dispatched")},ou=(r,e)=>{e("loadEpubRequested")};var lu=P('<div class="workspace-action-bar svelte-4wg9d"><h3 class="section-title svelte-4wg9d"> </h3> <div class="action-buttons svelte-4wg9d"><button type="button" class="action-button primary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">➕</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button> <button type="button" class="action-button secondary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">📁</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button></div></div>');function cu(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=Mt();let s=W(e,"isLoading",8,!1);wt();var l=lu(),d=f(l),u=f(d),c=g(d,2),p=f(c);p.__click=[su,i];var h=g(f(p),2),v=f(h),m=f(v),w=g(v,2),b=f(w),k=g(p,2);k.__click=[ou,i];var C=g(f(k),2),I=f(C),M=f(I),S=g(I,2),O=f(S);U((A,$,J,Z,D,q,R)=>{E(u,A),p.disabled=s(),ve(p,"aria-label",$),E(m,J),E(b,Z),k.disabled=s(),ve(k,"aria-label",D),E(M,q),E(O,R)},[()=>n()("Get Started"),()=>n()("Create a new minimal EPUB project"),()=>n()("Create New"),()=>n()("Start fresh"),()=>n()("Load an existing EPUB file for editing"),()=>n()("Load EPUB"),()=>n()("Import file")],ue),x(r,l),et(),a()}bt(["click"]);const du=(r,e,t)=>{r.stopPropagation(),e("deleteRequested",{workspaceId:t().id})},uu=(r,e)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e())};var fu=P('<span class="workspace-icon error svelte-ijd5ei">⚠️</span>'),pu=P('<span class="workspace-icon svelte-ijd5ei" aria-hidden="true">📖</span>'),hu=P('<span class="workspace-author-inline svelte-ijd5ei"> </span>'),vu=P('<span class="current-badge svelte-ijd5ei"> </span>'),mu=P('<div role="button" tabindex="0"><div class="workspace-main svelte-ijd5ei"><div class="workspace-icon-container svelte-ijd5ei"><!></div> <div class="workspace-info svelte-ijd5ei"><div class="workspace-header svelte-ijd5ei"><h3 class="workspace-title svelte-ijd5ei"> <!> <!></h3> <span class="workspace-time svelte-ijd5ei"> </span></div> <div class="workspace-meta svelte-ijd5ei"><span class="workspace-language svelte-ijd5ei"> </span> <span class="meta-separator svelte-ijd5ei">•</span> <span class="workspace-stats svelte-ijd5ei"> <!> <!></span></div></div></div> <div class="workspace-actions svelte-ijd5ei"><button type="button" class="delete-button svelte-ijd5ei"><span aria-hidden="true">🗑️</span></button></div></div>');function gu(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=Mt();let s=W(e,"workspace",8),l=W(e,"isCurrent",8,!1),d=W(e,"hasError",8,!1);const u=()=>{i("selected",{workspaceId:s().id})},c=de=>{const X=new Date().getTime()-de.getTime(),re=Math.floor(X/(1e3*60*60)),ge=Math.floor(re/24);return re<1?n()("Just now"):re<24?n()("{count}h ago",{count:re}):ge===1?n()("1 day ago"):ge<7?n()("{count} days ago",{count:ge}):n()("{count}w ago",{count:Math.floor(ge/7)})},p=de=>{if(de===0)return"0 B";const K=1024,X=["B","KB","MB","GB"],re=Math.floor(Math.log(de)/Math.log(K));return parseFloat((de/Math.pow(K,re)).toFixed(1))+" "+X[re]};wt();var h=mu();let v;h.__click=u,h.__keydown=[uu,u];var m=f(h),w=f(m),b=f(w);{var k=de=>{var K=fu();U((X,re)=>{ve(K,"aria-label",X),ve(K,"title",re)},[()=>n()("Error"),()=>n()("Project has errors")],ue),x(de,K)},C=de=>{var K=pu();x(de,K)};H(b,de=>{d()||s().hasError?de(k):de(C,!1)})}var I=g(w,2),M=f(I),S=f(M),O=f(S),A=g(O);{var $=de=>{var K=hu(),X=f(K);U(()=>E(X,`- ${s().author??""}`)),x(de,K)};H(A,de=>{s().author&&de($)})}var J=g(A,2);{var Z=de=>{var K=vu(),X=f(K);U((re,ge)=>{ve(K,"aria-label",re),E(X,ge)},[()=>n()("Currently open"),()=>n()("Current")],ue),x(de,K)};H(J,de=>{l()&&de(Z)})}var D=g(S,2),q=f(D),R=g(M,2),T=f(R),L=f(T),F=g(T,4),ae=f(F),B=g(ae);{var le=de=>{var K=Et();U(X=>E(K,`• ${X??""}`),[()=>p(s().totalSize)],ue),x(de,K)};H(B,de=>{s().totalSize>0&&de(le)})}var Se=g(B,2);{var ze=de=>{var K=Et();U(X=>E(K,`• ${X??""}`),[()=>s().extensionIds.join(", ")],ue),x(de,K)};H(Se,de=>{s().extensionIds&&s().extensionIds.length>0&&de(ze)})}var xe=g(m,2),Le=f(xe);Le.__click=[du,i,s],U((de,K,X,re,ge,Ae)=>{v=nt(h,1,"workspace-item svelte-ijd5ei",null,v,de),ve(h,"aria-label",K),E(O,`${s().title??""} `),E(q,X),E(L,s().language),E(ae,`${s().fileCount??""}
          ${re??""} `),ve(Le,"aria-label",ge),ve(Le,"title",Ae)},[()=>({current:l(),error:d()||s().hasError}),()=>n()("Open project: {title}",{title:s().title}),()=>c(s().lastModified),()=>n()("files"),()=>n()("Delete project: {title}",{title:s().title}),()=>n()("Delete project")],ue),x(r,h),et(),a()}bt(["click","keydown"]);var wu=P('<button type="button" class="clear-search svelte-1cps7l">×</button>'),yu=P('<div class="search-container svelte-1cps7l"><div class="search-input-wrapper svelte-1cps7l"><input type="search" class="search-input svelte-1cps7l"/> <!></div></div>'),bu=P('<div class="loading-state svelte-1cps7l"><div class="skeleton-item svelte-1cps7l" aria-hidden="true"></div> <div class="skeleton-item svelte-1cps7l" aria-hidden="true"></div> <div class="skeleton-item svelte-1cps7l" aria-hidden="true"></div> <p class="loading-text svelte-1cps7l"> </p></div>'),_u=P('<div class="empty-state svelte-1cps7l"><div class="empty-icon svelte-1cps7l" aria-hidden="true">📚</div> <h4 class="empty-title svelte-1cps7l"> </h4> <p class="empty-description svelte-1cps7l"> </p> <div class="empty-tips svelte-1cps7l"><h5 class="tips-title svelte-1cps7l"> </h5> <ul class="tips-list svelte-1cps7l"><li class="svelte-1cps7l"> </li> <li class="svelte-1cps7l"> </li> <li class="svelte-1cps7l"> </li></ul></div></div>'),xu=P('<div class="no-results svelte-1cps7l"><div class="no-results-icon svelte-1cps7l" aria-hidden="true">🔍</div> <h4 class="no-results-title svelte-1cps7l"> </h4> <p class="no-results-description svelte-1cps7l"> </p> <button type="button" class="clear-search-button svelte-1cps7l"> </button></div>'),Su=P('<div class="search-results-info svelte-1cps7l"><p class="results-text svelte-1cps7l"> </p></div>'),Eu=P('<div class="workspace-grid svelte-1cps7l"></div> <!>',1),ku=P('<div class="workspace-list svelte-1cps7l"><div class="list-header svelte-1cps7l"><!></div> <div class="list-content svelte-1cps7l"><!></div></div>');function Tu(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=je(),s=je(),l=Mt();let d=W(e,"workspaces",24,()=>[]),u=W(e,"currentWorkspaceId",8,null),c=W(e,"isLoading",8,!1),p=je("");const h=J=>{l("workspaceSelected",J.detail)},v=J=>{l("workspaceDeleted",J.detail)},m=J=>{l("packageRequested",J.detail)},w=J=>{const Z=J.target;y(p,Z.value)},b=()=>{y(p,"")};ot(()=>(Ze(d()),o(p)),()=>{y(i,d().filter(J=>{if(!o(p))return!0;const Z=o(p).toLowerCase();return J.title.toLowerCase().includes(Z)||J.author?.toLowerCase().includes(Z)||J.language.toLowerCase().includes(Z)}))}),ot(()=>o(i),()=>{y(s,[...o(i)].sort((J,Z)=>Z.lastModified.getTime()-J.lastModified.getTime()))}),Pt(),wt();var k=ku(),C=f(k),I=f(C);{var M=J=>{var Z=yu(),D=f(Z),q=f(D),R=g(q,2);{var T=L=>{var F=wu();U(ae=>ve(F,"aria-label",ae),[()=>n()("Clear search")],ue),Ge("click",F,b),x(L,F)};H(R,L=>{o(p)&&L(T)})}U((L,F)=>{ve(q,"placeholder",L),Sn(q,o(p)),ve(q,"aria-label",F)},[()=>n()("Search projects…"),()=>n()("Search projects")],ue),Ge("input",q,w),x(J,Z)};H(I,J=>{d().length>0&&J(M)})}var S=g(C,2),O=f(S);{var A=J=>{var Z=bu(),D=g(f(Z),6),q=f(D);U(R=>E(q,R),[()=>n()("Loading projects…")],ue),x(J,Z)},$=(J,Z)=>{{var D=R=>{var T=_u(),L=g(f(T),2),F=f(L),ae=g(L,2),B=f(ae),le=g(ae,2),Se=f(le),ze=f(Se),xe=g(Se,2),Le=f(xe),de=f(Le),K=g(Le,2),X=f(K),re=g(K,2),ge=f(re);U((Ae,We,Be,pe,be,he)=>{E(F,Ae),E(B,We),E(ze,Be),E(de,pe),E(X,be),E(ge,he)},[()=>n()("No projects yet"),()=>n()("Get started by creating your first EPUB"),()=>n()("Quick Start Tips:"),()=>n()("Create New: Start with a template or blank project"),()=>n()("Import EPUB: Convert existing .epub files to edit"),()=>n()("All your work is saved automatically")],ue),x(R,T)},q=(R,T)=>{{var L=ae=>{var B=xu(),le=g(f(B),2),Se=f(le),ze=g(le,2),xe=f(ze),Le=g(ze,2),de=f(Le);U((K,X,re)=>{E(Se,K),E(xe,X),E(de,re)},[()=>n()("No projects found"),()=>n()('No projects match your search for "{query}"',{query:o(p)}),()=>n()("Clear search")],ue),Ge("click",Le,b),x(ae,B)},F=ae=>{var B=Eu(),le=Ke(B);xt(le,5,()=>o(s),xe=>xe.id,(xe,Le)=>{const de=ue(()=>o(Le).id===u()),K=ue(()=>o(Le).hasError||!1);gu(xe,{get workspace(){return o(Le)},get isCurrent(){return o(de)},get hasError(){return o(K)},$$events:{selected:h,deleteRequested:v,packageRequested:m}})});var Se=g(le,2);{var ze=xe=>{var Le=Su(),de=f(Le),K=f(de);U(X=>E(K,X),[()=>n()("Showing {filtered} of {total} workspaces",{filtered:o(i).length,total:d().length})],ue),x(xe,Le)};H(Se,xe=>{o(p)&&o(i).length<d().length&&xe(ze)})}x(ae,B)};H(R,ae=>{o(i).length===0?ae(L):ae(F,!1)},T)}};H(J,R=>{d().length===0?R(D):R(q,!1)},Z)}};H(O,J=>{c()?J(A):J($,!1)})}x(r,k),et(),a()}function fn(){return new Date().toISOString().replace(/\.\d{3}Z$/,"Z")}class gt{static parseContainerXml(e){try{if(!globalThis.DOMParser)return{error:"DOMParser not available"};const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return{error:"Invalid XML in container.xml"};const i=a.querySelector("rootfile");if(!i)return{error:"No rootfile element found in container.xml"};const s=i.getAttribute("full-path");return s?s.endsWith(".opf")?{rootfilePath:s}:{error:`Rootfile does not appear to be an OPF file: ${s}`}:{error:"No full-path attribute found in rootfile element"}}catch(t){return{error:`Failed to parse container.xml: ${t instanceof Error?t.message:"Unknown error"}`}}}static validateXML(e){try{if(!globalThis.DOMParser)return{isValid:!1,error:"DOMParser not available"};const n=new DOMParser().parseFromString(e,"application/xml").querySelector("parsererror");return n?{isValid:!1,error:n.textContent||"Unknown XML parsing error"}:{isValid:!0}}catch(t){return{isValid:!1,error:t instanceof Error?t.message:"XML validation failed"}}}static parseOPFMetadata(e){const t="http://purl.org/dc/elements/1.1/",a=e.getElementsByTagNameNS(t,"title"),n=e.getElementsByTagNameNS(t,"language"),i=e.getElementsByTagNameNS(t,"identifier");if(a.length===0||!a[0].textContent?.trim())throw new Error("Missing required dc:title in OPF metadata");if(n.length===0||!n[0].textContent?.trim())throw new Error("Missing required dc:language in OPF metadata");if(i.length===0||!i[0].textContent?.trim())throw new Error("Missing required dc:identifier in OPF metadata");let s=e.getElementsByTagNameNS(t,"creator");s.length===0&&(s=e.querySelectorAll("dc\\:creator, creator"));let l=e.getElementsByTagNameNS(t,"contributor");l.length===0&&(l=e.querySelectorAll("dc\\:contributor, contributor"));let d=e.getElementsByTagNameNS(t,"subject");d.length===0&&(d=e.querySelectorAll("dc\\:subject, subject"));const u=e.getElementsByTagNameNS(t,"publisher"),c=e.getElementsByTagNameNS(t,"date"),p=e.getElementsByTagNameNS(t,"description"),h=e.getElementsByTagNameNS(t,"rights"),v=e.getElementsByTagNameNS(t,"source"),m=e.getElementsByTagNameNS(t,"relation"),w=e.getElementsByTagNameNS(t,"coverage"),b=e.getElementsByTagNameNS(t,"type"),k=e.getElementsByTagNameNS(t,"format"),C=e.querySelectorAll('meta[property="dcterms:modified"]'),I=Array.from(s).map(O=>O.textContent?.trim()).filter(Boolean),M=Array.from(l).map(O=>O.textContent?.trim()).filter(Boolean),S=Array.from(d).map(O=>O.textContent?.trim()).filter(Boolean);return{title:a[0].textContent.trim(),language:n[0].textContent.trim(),identifier:i[0].textContent.trim(),creator:I.length>0?I:void 0,contributor:M.length>0?M:void 0,publisher:u.length>0?u[0].textContent?.trim():void 0,date:c.length>0?c[0].textContent?.trim():void 0,description:p.length>0?p[0].textContent?.trim():void 0,subject:S.length>0?S:void 0,rights:h.length>0?h[0].textContent?.trim():void 0,source:v.length>0?v[0].textContent?.trim():void 0,relation:m.length>0?m[0].textContent?.trim():void 0,coverage:w.length>0?w[0].textContent?.trim():void 0,type:b.length>0?b[0].textContent?.trim():void 0,format:k.length>0?k[0].textContent?.trim():void 0,modifiedDate:C.length>0?C[0].textContent?.trim():void 0}}static parseOPFDocument(e){const t=this.validateXML(e);if(!t.isValid)throw new Error(`Invalid OPF XML: ${t.error}`);const n=new DOMParser().parseFromString(e,"application/xml"),s=n.querySelector("package")?.getAttribute("version")||"2.0",l=this.parseOPFMetadata(n),d=[];n.querySelectorAll("manifest item").forEach(m=>{const w=m.getAttribute("id"),b=m.getAttribute("href"),k=m.getAttribute("media-type");if(w&&b&&k){const C=m.getAttribute("properties"),I=m.getAttribute("fallback");d.push({id:w,href:b,mediaType:k,properties:C?C.split(" "):void 0,fallback:I||void 0})}});const c=[];n.querySelectorAll("spine itemref").forEach(m=>{const w=m.getAttribute("idref");if(w){const b=m.getAttribute("linear"),k=m.getAttribute("properties");c.push({idref:w,linear:b!=="no",properties:k?k.split(" "):void 0})}});const h=[];return n.querySelectorAll("guide reference").forEach(m=>{const w=m.getAttribute("type"),b=m.getAttribute("href");if(w&&b){const k=m.getAttribute("title");h.push({type:w,href:b,title:k||void 0})}}),{metadata:l,manifest:d,spine:c,guide:h.length>0?h:void 0,version:s}}static generateOPFXML(e){const{metadata:t,manifest:a,spine:n,guide:i,version:s}=e,l=c=>c.replace(/[<>&'"]/g,p=>{switch(p){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&apos;";default:return p}}),d=a.find(c=>c.id==="uuid")?.id||"uuid";let u=`<?xml version="1.0" encoding="utf-8"?>
<package version="${s}" xmlns="http://www.idpf.org/2007/opf" unique-identifier="${d}">
  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
    <dc:title>${l(t.title)}</dc:title>
    <dc:language>${l(t.language)}</dc:language>
    <dc:identifier id="${d}">${l(t.identifier)}</dc:identifier>`;return t.creator&&t.creator.length>0&&t.creator.forEach(c=>{u+=`
    <dc:creator>${l(c)}</dc:creator>`}),t.contributor&&t.contributor.length>0&&t.contributor.forEach(c=>{u+=`
    <dc:contributor>${l(c)}</dc:contributor>`}),t.publisher&&(u+=`
    <dc:publisher>${l(t.publisher)}</dc:publisher>`),t.date&&(u+=`
    <dc:date>${l(t.date)}</dc:date>`),t.description&&(u+=`
    <dc:description>${l(t.description)}</dc:description>`),t.subject&&t.subject.length>0&&t.subject.forEach(c=>{u+=`
    <dc:subject>${l(c)}</dc:subject>`}),t.rights&&(u+=`
    <dc:rights>${l(t.rights)}</dc:rights>`),t.source&&(u+=`
    <dc:source>${l(t.source)}</dc:source>`),t.relation&&(u+=`
    <dc:relation>${l(t.relation)}</dc:relation>`),t.coverage&&(u+=`
    <dc:coverage>${l(t.coverage)}</dc:coverage>`),t.type&&(u+=`
    <dc:type>${l(t.type)}</dc:type>`),t.format&&(u+=`
    <dc:format>${l(t.format)}</dc:format>`),t.modifiedDate&&(u+=`
    <meta property="dcterms:modified">${l(t.modifiedDate)}</meta>`),u+=`
  </metadata>
  <manifest>`,a.forEach(c=>{u+=`
    <item id="${l(c.id)}" href="${l(c.href)}" media-type="${l(c.mediaType)}"`,c.properties&&c.properties.length>0&&(u+=` properties="${l(c.properties.join(" "))}"`),c.fallback&&(u+=` fallback="${l(c.fallback)}"`),u+=" />"}),u+=`
  </manifest>
  <spine>`,n.forEach(c=>{u+=`
    <itemref idref="${l(c.idref)}"`,c.linear===!1&&(u+=' linear="no"'),c.properties&&c.properties.length>0&&(u+=` properties="${l(c.properties.join(" "))}"`),u+=" />"}),u+=`
  </spine>`,i&&i.length>0&&(u+=`
  <guide>`,i.forEach(c=>{u+=`
    <reference type="${l(c.type)}" href="${l(c.href)}"`,c.title&&(u+=` title="${l(c.title)}"`),u+=" />"}),u+=`
  </guide>`),u+=`
</package>`,u}static detectEPUBVersion(e){try{if(!globalThis.DOMParser)return;const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return;const i=a.querySelector("package");if(i){const s=i.getAttribute("version");if(s)return s.startsWith("2.")?"EPUB 2.0":s.startsWith("3.")?"EPUB 3.0":`EPUB ${s}`}return a.querySelector("[properties]")||a.querySelector("[epub\\:type]")?"EPUB 3.0":"EPUB 2.0"}catch{return}}static parseRootfilePath(e){const t=e.match(/<rootfile[^>]+full-path\s*=\s*["']([^"']+)["'][^>]*>/i);if(!t)throw new Error("Could not find rootfile path in container.xml");return t[1]}static generateContainerXML(e="OEBPS/content.opf"){return`<?xml version="1.0" encoding="UTF-8"?>
<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">
  <rootfiles>
    <rootfile full-path="${e}" media-type="application/oebps-package+xml"/>
  </rootfiles>
</container>`}static validateManifestSpineConsistency(e,t){const a=[],n=new Set(e.map(i=>i.id));return t.forEach((i,s)=>{n.has(i.idref)||a.push(`Spine item ${s} references non-existent manifest item: ${i.idref}`)}),a}}const Cu={"application/xhtml+xml":"Text/","text/html":"Text/","text/css":"Styles/","text/javascript":"Scripts/","application/javascript":"Scripts/","image/jpeg":"Images/","image/png":"Images/","image/gif":"Images/","image/svg+xml":"Images/","image/webp":"Images/","audio/mpeg":"Audio/","audio/ogg":"Audio/","audio/wav":"Audio/","audio/mp4":"Audio/","video/mp4":"Video/","video/webm":"Video/","video/ogg":"Video/","font/ttf":"Fonts/","font/otf":"Fonts/","font/woff":"Fonts/","font/woff2":"Fonts/","application/font-woff":"Fonts/","application/pdf":"Misc/","text/plain":"Text/"};function Fu(r){const e=r.split(";")[0].trim().toLowerCase();return Cu[e]||""}function qa(r,e){return Fu(e)+r}class yi{static getArrayField(e,t){const a=e[t];return Array.isArray(a)?a:[]}static getStringField(e,t){const a=e[t];return typeof a=="string"?a:void 0}static getRequiredStringField(e,t){const a=e[t];return typeof a=="string"?a:""}static isArrayField(e){return["creator","contributor","subject","accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard"].includes(e)}static isStringField(e){return["title","language","identifier","publisher","date","description","rights","source","relation","coverage","type","format","modifiedDate","epubVersion","renditionLayout","pageProgressionDirection","renditionOrientation","renditionSpread","accessibilitySummary"].includes(e)}static updateArrayField(e,t,a){const n=yi.getArrayField(e,t),i=a(n);return{...e,[t]:i}}static updateStringField(e,t,a){return{...e,[t]:a}}}const Iu={html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",css:"text/css",js:"application/javascript",txt:"text/plain",json:"application/json",opf:"application/oebps-package+xml",ncx:"application/x-dtbncx+xml",epub:"application/epub+zip",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",gz:"application/gzip",zip:"application/zip"};function lo(r){const e=r.split(".").pop()?.toLowerCase();return Iu[e||""]||"application/octet-stream"}function co(r){const e=r.startsWith("SOURCE/")?r.substring(7):r;return e==="settings.json"?"settings":e.startsWith("text/")?"text":e.startsWith("scripts/")?"script":e.startsWith("extensions/")?"extension":"other"}function Pu(r){if(!r||typeof r!="string"||r.trim()==="")return!1;let e=r.trim();if(e=e.replace(/\\/g,"/"),!e.startsWith("SOURCE/")||e.startsWith("/")||/^[A-Za-z]:/.test(e)||e.includes(".."))return!1;const t=e.split("/").pop()?.toLowerCase()||"",a=["con","aux","prn","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],n=t.split(".")[0];return!(a.includes(n)||t===".ds_store"||t==="thumbs.db")}function Xn(r){return!r||typeof r!="string"?!1:r.startsWith("SOURCE/")&&r.length>7}function Mu(r){const e={isValid:!0,errors:[],warnings:[]};if(!r||r.trim()==="")return e.isValid=!1,e.errors.push("Empty settings"),e;let t;try{t=JSON.parse(r)}catch(i){e.isValid=!1;const s=`Invalid JSON syntax: ${i}`;return e.errors.push(s),e}const a=["version"];for(const i of a)i in t?(t[i]===null||t[i]===void 0)&&(e.isValid=!1,e.errors.push(`Field '${i}' cannot be null or undefined`)):(e.isValid=!1,e.errors.push(`Missing required field: ${i}`));"is_draft"in t&&typeof t.is_draft!="boolean"&&(e.isValid=!1,e.errors.push('Field "is_draft" must be a boolean')),"draft_id"in t&&typeof t.draft_id!="number"&&(e.isValid=!1,e.errors.push('Field "draft_id" must be a number')),"text_transform"in t&&typeof t.text_transform!="string"&&(e.isValid=!1,e.errors.push('Field "text_transform" must be a string')),"dom_transforms"in t&&!Array.isArray(t.dom_transforms)&&(e.isValid=!1,e.errors.push('Field "dom_transforms" must be an array')),"version"in t&&typeof t.version!="string"&&(e.isValid=!1,e.errors.push('Field "version" must be a string'));const n=["is_draft","draft_id","text_transform","dom_transforms","version"];for(const i in t)n.includes(i)||e.warnings.push(`Unknown field: ${i}`);return e}async function Lu(r,e){const a=(await r.listFiles(e)).filter(i=>Xn(i)),n={totalFiles:a.length,totalSize:0,directories:{text:0,scripts:0,extensions:0},hasSettingsFile:!1};for(const i of a){try{const s=await r.readFile(e,i);n.totalSize+=s.byteLength}catch{continue}i==="SOURCE/settings.json"&&(n.hasSettingsFile=!0),i.startsWith("SOURCE/text/")?n.directories.text++:i.startsWith("SOURCE/scripts/")?n.directories.scripts++:i.startsWith("SOURCE/extensions/")&&n.directories.extensions++}return n}function Du(r){if(!r||typeof r!="string")return"";let e=r.trim();return e=e.replace(/\\/g,"/"),e=e.replace(/\/+/g,"/"),e=e.split("/").filter(n=>n!=="."&&n!=="").join("/"),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e}const Ru={is_draft:!1,draft_id:1,text_transform:"markdown-transform.js",dom_transforms:["custom-dom.js"],version:"1.0.0"};class uo{constructor(e){this.fileStorage=e}async createSourceZip(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Error(`Workspace ${e} not found`);const n=(await this.fileStorage.listFiles(e)).filter(s=>Xn(s));if(n.length===0)return null;const i=new Jn;for(const s of n)try{const l=await this.fileStorage.readFile(e,s);await i.addFile(s,l)}catch(l){throw new Error(`Failed to read file ${s}: ${l}`)}try{return await i.buildBlob()}catch(s){throw new Error(`ZIP creation failed: ${s}`)}}catch(t){throw t instanceof Error?t:new Error(`Failed to create SOURCE.zip: ${t}`)}}async extractSourceZip(e,t){try{const a=await t.arrayBuffer(),n=new Lr(a);for(const i of n.entries){const s=Du(i.fileName);if(!Pu(s))throw new Error(`Invalid file path: ${i.fileName}`);try{const d=await(await i.extract()).arrayBuffer();await this.fileStorage.writeFile(e,s,d)}catch(l){throw new Error(`Failed to write file ${s}: ${l}`)}}}catch(a){throw a instanceof Error?a:new Error(`Failed to extract SOURCE.zip: ${a}`)}}async hasSourceFiles(e){try{return(await this.fileStorage.listFiles(e)).filter(n=>Xn(n)).length>0}catch(t){throw new Error(`Failed to check SOURCE/ files: ${t}`)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e)).filter(i=>Xn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const s=await this.fileStorage.readFile(e,i),l={path:i,size:s.byteLength,type:co(i)};n.push(l)}catch{continue}return n}catch(t){throw new Error(`Failed to list SOURCE/ files: ${t}`)}}async initializeSourceStructure(e){try{const t="SOURCE/settings.json";if(!await this.fileStorage.fileExists(e,t)){const a=JSON.stringify(Ru,null,2);await this.fileStorage.writeTextFile(e,t,a)}}catch(t){throw new Error(`Failed to initialize SOURCE/ structure: ${t}`)}}async validateSourceStructure(e){const t={isValid:!0,errors:[],warnings:[],fileCount:0,totalSize:0,hasSettings:!1};try{const n=(await this.fileStorage.listFiles(e)).filter(i=>Xn(i));t.fileCount=n.length;for(const i of n)try{const s=await this.fileStorage.readFile(e,i);if(t.totalSize+=s.byteLength,i==="SOURCE/settings.json"){t.hasSettings=!0;const d=new TextDecoder().decode(s),u=Mu(d);u.isValid||(t.isValid=!1,t.errors.push(...u.errors.map(c=>`Invalid settings.json format: ${c}`))),t.warnings.push(...u.warnings)}const l=i.substring(7);!l.includes("/")&&i!=="SOURCE/settings.json"&&t.warnings.push(`Unexpected file in SOURCE/ root: ${l}`)}catch{continue}t.hasSettings||t.warnings.push("Missing settings.json file")}catch(a){t.isValid=!1,t.errors.push(`Failed to validate SOURCE/ structure: ${a}`)}return t}async getSourceDirectoryStats(e){try{return await Lu(this.fileStorage,e)}catch(t){throw new Error(`Failed to get SOURCE/ directory statistics: ${t}`)}}}class bi{fileStorage;sourceManager;constructor(){this.fileStorage=Dt.getInstance(),this.sourceManager=new uo(this.fileStorage)}async packageEPUB(e,t={}){const a=Date.now();try{const n=await this.readWorkspaceFiles(e);if(n.length===0)return{success:!1,error:"Workspace is empty"};const i=await this.extractMetadata(n),s=new Jn,l=n.reduce((p,h)=>p+h.size,0);let d=0;for(let p=0;p<n.length;p++){const h=n[p],v=this.optimizeCompression(h.path,h.content);await s.addFile(h.path,h.content,{compressionMethod:v.method,lastModified:new Date}),d+=h.size,t.progressCallback?.({phase:"compressing",currentFile:h.path,processedFiles:p+1,totalFiles:n.length,currentBytes:d,totalBytes:l})}t.progressCallback?.({phase:"writing",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l});const u=await s.buildBlob(),c=this.generateFilename(i);return t.progressCallback?.({phase:"complete",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l}),{success:!0,blob:u,filename:c,totalSize:l,compressedSize:u.size,fileCount:n.length,processingTime:Date.now()-a}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error",processingTime:Date.now()-a}}}async readWorkspaceFiles(e){const t=await this.fileStorage.listFiles(e),a=t.filter(s=>s.startsWith("SOURCE/")),n=t.filter(s=>!s.startsWith("SOURCE/")),i=[];for(const s of n)try{const l=await this.fileStorage.readFile(e,s);i.push({path:s,content:l,size:l.byteLength,mimeType:lo(s)})}catch(l){console.warn(`Failed to read file ${s}:`,l)}if(a.length>0)try{const s=await this.sourceManager.createSourceZip(e);if(s){const l=await s.arrayBuffer();i.push({path:"SOURCE.zip",content:l,size:l.byteLength,mimeType:"application/zip"})}}catch(s){console.warn("Failed to create SOURCE.zip:",s)}return i}async extractMetadata(e){const t=e.find(c=>c.path==="META-INF/container.xml");if(!t)throw new Error("Missing META-INF/container.xml file - invalid EPUB structure");const a=new TextDecoder,n=a.decode(t.content),i=gt.parseRootfilePath(n),s=e.find(c=>c.path===i);if(!s)throw new Error(`Missing OPF file at path: ${i}`);const l=a.decode(s.content),u=new DOMParser().parseFromString(l,"application/xml");return gt.parseOPFMetadata(u)}optimizeCompression(e,t){if(e==="mimetype")return{method:0,reason:"EPUB compliance requirement"};const a=e.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","mp3","mp4","webp","zip"].includes(a||"")?{method:0,reason:"Already compressed format"}:["html","xhtml","xml","css","js","txt","opf","ncx"].includes(a||"")?{method:8,reason:"Text-based content compresses well"}:{method:8,reason:"Default compression"}}generateFilename(e){const t=this.sanitizeFilename(e.title||"Untitled"),a=e.creator?.[0]?this.sanitizeFilename(e.creator[0]):null,n=new Date().toISOString().split("T")[0],i=[t];return a&&i.push(a),i.push(n),`${i.join(" - ")}.epub`}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,50)}downloadEPUB(e,t){Fd(e,t)}}var zu=P('<div class="error-banner svelte-9tke9n"><span class="error-icon svelte-9tke9n" aria-hidden="true">⚠️</span> <span class="error-text svelte-9tke9n"> </span> <button type="button" class="retry-button svelte-9tke9n"> </button></div>'),Uu=P('<div class="unsaved-indicator svelte-9tke9n"><span class="indicator-icon svelte-9tke9n" aria-hidden="true">⚠️</span> <span> </span></div>'),Au=P('<div class="workspace-view svelte-9tke9n"><main class="view-content svelte-9tke9n"><!> <!>  <!> <!></main></div>');function Ou(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=()=>Ye(wi,"$currentLocale",t);let s=W(e,"onWorkspaceChange",3,null),l=W(e,"currentWorkspaceId",3,null),d=Ue(Ct([])),u=Ue(null),c=Ue(!1),p=Ue(null),h=Ue(!1),v=Ue(""),m=Ue(!1);const w=new bi;kt(()=>{l()&&o(d).length>0?y(u,o(d).find(K=>K.id===l())||null,!0):y(u,null)});const b=async K=>{if(K){y(u,o(d).find(X=>X.id===K)||null,!0),localStorage.setItem("currentWorkspace",K);try{await e.onLoadWorkspace(K)}catch(X){console.error("Failed to load workspace:",X)}}else y(u,null),localStorage.removeItem("currentWorkspace");s()&&s()(K),e.onWorkspaceChanged?.(K)},k=()=>{},C=async()=>{try{y(c,!0),y(p,null),y(d,await e.onListWorkspaces(),!0),k()}catch(K){console.error("Failed to load workspaces:",K),y(p,n()("Failed to load projects"),!0),y(d,[],!0)}finally{y(c,!1)}},I=()=>({title:"Untitled Book Project",identifier:crypto.randomUUID(),creator:["Unknown"]}),M=async()=>{try{y(c,!0);const K=i(),X=I(),re=await e.onCreateWorkspace({title:X.title||"Untitled Book Project",language:K});console.log("✅ Workspace created:",re),await C(),await b(re),e.onNavigationRequested?.("metadata",re),e.onWorkspaceOpened?.(re)}catch(K){console.error("Failed to create workspace:",K),alert(n()("Failed to create workspace: {error}",{error:K instanceof Error?K.message:"Unknown error"}))}finally{y(c,!1)}},S=async()=>{try{y(c,!0),await e.onEpubImportRequested(),await C()}catch(K){console.error("Failed to import EPUB:",K),alert(n()("Failed to import EPUB: {error}",{error:K instanceof Error?K.message:"Unknown error"}))}finally{y(c,!1)}},O=async K=>{const{workspaceId:X}=K.detail;try{await b(X),e.onSmartNavigationRequested?.(X),e.onWorkspaceOpened?.(X)}catch(re){console.error("Failed to open workspace:",re),alert(n()("Failed to open workspace: {error}",{error:re instanceof Error?re.message:"Unknown error"}))}},A=async K=>{const{workspaceId:X}=K.detail,re=o(d).find(Ae=>Ae.id===X);if(!(!re||!confirm(n()('Delete "{title}"? This cannot be undone.',{title:re.title}))))try{y(c,!0),await e.onDeleteWorkspace(X),await C(),l()===X&&await b(null)}catch(Ae){console.error("Failed to delete workspace:",Ae),alert(n()("Failed to delete workspace: {error}",{error:Ae instanceof Error?Ae.message:"Unknown error"}))}finally{y(c,!1)}},$=async K=>{const{workspaceId:X}=K.detail;if(o(d).find(ge=>ge.id===X))try{y(m,!0);const ge=await w.packageEPUB(X,{progressCallback:Ae=>{console.log(`Packaging progress: ${Ae.phase} - ${Ae.processedFiles}/${Ae.totalFiles} files`)}});if(ge.success&&ge.blob&&ge.filename)w.downloadEPUB(ge.blob,ge.filename),console.log(`✅ Successfully packaged and downloaded: ${ge.filename}`);else throw new Error(ge.error||"Unknown packaging error")}catch(ge){console.error("Failed to package EPUB:",ge),alert(n()("Failed to package EPUB: {error}",{error:ge instanceof Error?ge.message:"Unknown error"}))}finally{y(m,!1)}};async function J(){return o(h)?window.confirm(n()("You have unsaved project changes. Continue?")):!0}function Z(K){}function D(){}function q(){return{currentWorkspaceId:l(),hasUnsavedChanges:o(h)}}async function R(K){K.currentWorkspaceId&&await b(K.currentWorkspaceId),K.hasUnsavedChanges!==void 0&&y(h,K.hasUnsavedChanges,!0)}const T=()=>{C()};nn(async()=>{y(v,yt.addNavigationGuard(J),!0),window.addEventListener("workspace-list-refresh",T),await C()}),sr(()=>{o(v)&&yt.removeNavigationGuard(o(v)),window.removeEventListener("workspace-list-refresh",T)});var L=Au(),F=f(L),ae=f(F);cu(ae,{get isLoading(){return o(c)},$$events:{createNewRequested:M,loadEpubRequested:S}});var B=g(ae,2);{var le=K=>{var X=zu(),re=g(f(X),2),ge=f(re),Ae=g(re,2);Ae.__click=C;var We=f(Ae);U(Be=>{E(ge,o(p)),E(We,Be)},[()=>n()("Retry")]),x(K,X)};H(B,K=>{o(p)&&K(le)})}var Se=g(B,2);const ze=se(()=>o(c)||o(m));Tu(Se,{get workspaces(){return o(d)},get currentWorkspaceId(){return l()},get isLoading(){return o(ze)},$$events:{workspaceSelected:O,workspaceDeleted:A,packageRequested:$}});var xe=g(Se,2);{var Le=K=>{var X=Uu(),re=g(f(X),2),ge=f(re);U(Ae=>E(ge,Ae),[()=>n()("You have unsaved changes")]),x(K,X)};H(xe,K=>{o(h)&&K(Le)})}x(r,L);var de=et({canLeave:J,onViewEnter:Z,onViewLeave:D,getViewData:q,setViewData:R});return a(),de}bt(["click"]);var Wu=P('<span class="error-indicator svelte-z75kp3">!</span>'),ju=P('<button><span class="tab-label svelte-z75kp3"> </span> <!></button>');function Bu(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=Mt();let s=W(e,"id",8,""),l=W(e,"label",8,""),d=W(e,"active",8,!1),u=W(e,"errorCount",8,0),c=W(e,"disabled",8,!1);const p=()=>{c()||i("click",{tabId:s()})},h=I=>{(I.key==="Enter"||I.key===" ")&&!c()&&(I.preventDefault(),i("click",{tabId:s()}))};wt();var v=ju();let m;var w=f(v),b=f(w),k=g(w,2);{var C=I=>{var M=Wu();U(S=>ve(M,"aria-label",S),[()=>n()("validation.errorsCount",{count:u()})],ue),x(I,M)};H(k,I=>{u()>0&&I(C)})}U(I=>{m=nt(v,1,"metadata-tab svelte-z75kp3",null,m,I),v.disabled=c(),ve(v,"aria-controls",`metadata-panel-${s()??""}`),ve(v,"id",`metadata-tab-${s()??""}`),E(b,l())},[()=>({active:d(),"has-errors":u()>0,disabled:c()})],ue),Ge("click",v,p),Ge("keydown",v,h),x(r,v),et(),a()}var Nu=P('<div class="metadata-tab-bar svelte-1pzcjt6" tabindex="-1"></div>');function $u(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=Mt();let s=W(e,"activeTab",8,"basic"),l=W(e,"validationErrors",24,()=>[]),d=W(e,"tabs",24,()=>[{id:"basic",label:n()("metadata.tab.basic")},{id:"advanced",label:n()("metadata.tab.advanced")},{id:"publication",label:n()("metadata.tab.publication")},{id:"accessibility",label:n()("metadata.tab.accessibility")}]);const u=v=>{const m=c(v);return l().filter(w=>m.includes(w.field)).length},c=v=>{switch(v){case"basic":return["title","language","identifier","creator"];case"advanced":return["publisher","date","description","subject","rights","source","relation","coverage","type","format","contributor"];case"publication":return["series","seriesPosition","epubVersion","uniqueIdentifierScheme","primaryCreatorFileAs","creatorRoles"];case"accessibility":return["accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard","accessibilitySummary","accessibilityCertification","accessibilityCertifier"];default:return[]}},p=v=>{i("tabClick",v.detail)};wt();var h=Nu();xt(h,5,d,It,(v,m)=>{const w=ue(()=>s()===o(m).id),b=ue(()=>u(o(m).id));Bu(v,{get id(){return o(m).id},get label(){return o(m).label},get active(){return o(w)},get errorCount(){return o(b)},$$events:{click:p}})}),x(r,h),et(),a()}const Hu=(r,e)=>{e("change",{value:r.target.value})};var Vu=P('<span class="field-error svelte-cp96ig" role="alert"> </span>'),qu=P("<label><!></label>"),Gu=P('<div class="metadata-field svelte-cp96ig"><!> <input type="text"/></div>');function en(r,e){Qe(e,!1);const t=je(),a=Mt();let n=W(e,"value",8,""),i=W(e,"placeholder",8,""),s=W(e,"required",8,!1),l=W(e,"disabled",8,!1),d=W(e,"error",8,""),u=W(e,"label",8,""),c=W(e,"id",8,"");const p=C=>{a("blur",{value:C.target.value})},h=()=>{a("focus",{field:c()})};ot(()=>(Ze(s()),Ze(n())),()=>{y(t,s()&&(!n()||n().trim()===""))}),Pt(),wt();var v=Gu(),m=f(v);{var w=C=>{var I=qu();let M;var S=f(I);{var O=$=>{var J=Vu(),Z=f(J);U(()=>{ve(J,"id",`${c()??""}-error`),E(Z,d())}),x($,J)},A=$=>{var J=Et();U(()=>E(J,u())),x($,J)};H(S,$=>{d()?$(O):$(A,!1)})}U($=>{ve(I,"for",c()),M=nt(I,1,"field-label svelte-cp96ig",null,M,$)},[()=>({"needs-attention":o(t)})],ue),x(C,I)};H(m,C=>{u()&&C(w)})}var b=g(m,2);let k;b.__input=[Hu,a],U(C=>{ve(b,"id",c()),Sn(b,n()),ve(b,"placeholder",i()),b.required=s(),b.disabled=l(),k=nt(b,1,"field-input svelte-cp96ig",null,k,C),ve(b,"aria-describedby",d()?`${c()}-error`:void 0),ve(b,"aria-invalid",!!d())},[()=>({error:!!d(),"needs-attention":o(t)})],ue),Ge("blur",b,p),Ge("focus",b,h),x(r,v),et()}bt(["input"]);const Xu=(r,e)=>{const t=r.target;e("change",{value:t.value})};var Ju=P('<div class="field-error svelte-bssb4o" role="alert"> </div>'),Ku=P("<label><!></label>"),Yu=P("<option> </option>"),Zu=P("<option> </option>"),Qu=P('<div class="metadata-field svelte-bssb4o"><!> <select><!><!></select></div>');function Hn(r,e){Qe(e,!1);const t=je(),a=Mt();let n=W(e,"value",8,""),i=W(e,"options",24,()=>[]),s=W(e,"required",8,!1),l=W(e,"disabled",8,!1),d=W(e,"error",8,""),u=W(e,"label",8,""),c=W(e,"id",8,""),p=W(e,"placeholder",8,"");const h=A=>{const $=A.target;a("blur",{value:$.value})},v=()=>{a("focus",{field:c()})};ot(()=>(Ze(s()),Ze(n())),()=>{y(t,s()&&(!n()||n().trim()===""))}),Pt(),wt();var m=Qu(),w=f(m);{var b=A=>{var $=Ku();let J;var Z=f($);{var D=R=>{var T=Ju(),L=f(T);U(()=>{ve(T,"id",`${c()??""}-error`),E(L,d())}),x(R,T)},q=R=>{var T=Et();U(()=>E(T,u())),x(R,T)};H(Z,R=>{d()?R(D):R(q,!1)})}U(R=>{ve($,"for",c()),J=nt($,1,"field-label svelte-bssb4o",null,J,R)},[()=>({"needs-attention":o(t)})],ue),x(A,$)};H(w,A=>{u()&&A(b)})}var k=g(w,2);Cr(k,n);var C;let I;k.__change=[Xu,a];var M=f(k);{var S=A=>{var $=Yu();$.value=$.__value="";var J=f($);U(()=>E(J,p())),x(A,$)};H(M,A=>{p()&&A(S)})}var O=g(M);xt(O,1,i,It,(A,$)=>{var J=Zu(),Z={},D=f(J);U(()=>{Z!==(Z=o($).value)&&(J.value=(J.__value=o($).value)??""),E(D,o($).label)}),x(A,J)}),U(A=>{ve(k,"id",c()),C!==(C=n())&&(k.value=(k.__value=n())??"",Dn(k,n())),k.required=s(),k.disabled=l(),I=nt(k,1,"field-select svelte-bssb4o",null,I,A),ve(k,"aria-describedby",d()?`${c()}-error`:void 0),ve(k,"aria-invalid",!!d())},[()=>({error:!!d(),"needs-attention":o(t)})],ue),Ge("blur",k,h),Ge("focus",k,v),x(r,m),et()}bt(["change"]);var ef=P('<span class="required svelte-1c704qf">*</span>'),tf=P("<label> <!></label>"),nf=P('<div class="field-error svelte-1c704qf" role="alert"> </div>'),rf=P('<div class="metadata-field svelte-1c704qf"><!> <textarea></textarea> <!></div>');function af(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=je(),s=Mt();let l=W(e,"value",8,""),d=W(e,"placeholder",8,""),u=W(e,"required",8,!1),c=W(e,"disabled",8,!1),p=W(e,"error",8,""),h=W(e,"label",8,""),v=W(e,"id",8,""),m=W(e,"rows",8,4);const w=J=>{s("change",{value:J.target.value})},b=J=>{s("blur",{value:J.target.value})},k=()=>{s("focus",{field:v()})};ot(()=>(Ze(u()),Ze(l())),()=>{y(i,u()&&(!l()||l().trim()===""))}),Pt(),wt();var C=rf(),I=f(C);{var M=J=>{var Z=tf();let D;var q=f(Z),R=g(q);{var T=L=>{var F=ef();U(ae=>ve(F,"aria-label",ae),[()=>n()("Required field")],ue),x(L,F)};H(R,L=>{u()&&L(T)})}U(L=>{ve(Z,"for",v()),D=nt(Z,1,"field-label svelte-1c704qf",null,D,L),E(q,`${h()??""} `)},[()=>({"needs-attention":o(i)})],ue),x(J,Z)};H(I,J=>{h()&&J(M)})}var S=g(I,2);let O;var A=g(S,2);{var $=J=>{var Z=nf(),D=f(Z);U(()=>{ve(Z,"id",`${v()??""}-error`),E(D,p())}),x(J,Z)};H(A,J=>{p()&&J($)})}U(J=>{ve(S,"id",v()),Sn(S,l()),ve(S,"placeholder",d()),S.required=u(),S.disabled=c(),ve(S,"rows",m()),O=nt(S,1,"field-textarea svelte-1c704qf",null,O,J),ve(S,"aria-describedby",p()?`${v()}-error`:void 0),ve(S,"aria-invalid",!!p())},[()=>({error:!!p(),"needs-attention":o(i)})],ue),Ge("input",S,w),Ge("blur",S,b),Ge("focus",S,k),x(r,C),et(),a()}const sf=(r,e)=>{e.ongenerateIdentifier?.(new CustomEvent("generateIdentifier"))};var of=P('<div class="array-item svelte-1nofkco"><!> <button type="button" class="remove-button svelte-1nofkco">×</button></div>'),lf=(r,e)=>e("creator"),cf=P('<div class="basic-info-fields svelte-1nofkco" tabindex="-1"><div class="form-columns svelte-1nofkco" tabindex="-1"><div class="column svelte-1nofkco" tabindex="-1"><fieldset class="field-group svelte-1nofkco" tabindex="-1"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <div class="identifier-field svelte-1nofkco"><!> <button type="button" class="generate-button svelte-1nofkco"> </button></div></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <div class="array-field svelte-1nofkco"><!> <button type="button" class="add-button svelte-1nofkco"> </button></div></fieldset></div> <div class="column svelte-1nofkco"><fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div></div></div>');function df(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"metadata",19,()=>({title:"",language:"",identifier:""})),s=W(e,"validationErrors",19,()=>[]),l=W(e,"saving",3,!1),d=Ue(Ct([]));kt(()=>{y(d,i().creator||[],!0)});const u=[{value:"en",label:"English"},{value:"de",label:"Deutsch"},{value:"es",label:"Español"},{value:"fr",label:"Français"},{value:"it",label:"Italiano"},{value:"pt",label:"Português"},{value:"ja",label:"日本語"},{value:"zh",label:"中文"},{value:"ar",label:"العربية"},{value:"he",label:"עברית"},{value:"ka",label:"ქართული"}],c=[{value:"reflowable",label:n()("Reflowable")},{value:"pre-paginated",label:n()("Pre-paginated")}],p=[{value:"default",label:n()("Default")},{value:"ltr",label:n()("Left to Right")},{value:"rtl",label:n()("Right to Left")}],h=[{value:"auto",label:n()("Auto")},{value:"landscape",label:n()("Landscape")},{value:"portrait",label:n()("Portrait")}],v=[{value:"auto",label:n()("Auto")},{value:"none",label:n()("None")},{value:"both",label:n()("Both")}],m=_=>{const G=s().find(te=>te.field===_);return G?G.message:""},w=(_,G)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:_,value:G}}))},b=(_,G)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:_,value:G}}))},k=_=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:_}}))},C=(_,G)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:_,index:G}}))},I=(_,G,te)=>{o(d)[G]=te,w(_,o(d))};var M=cf(),S=f(M),O=f(S),A=f(O),$=f(A),J=f($),Z=g($,2);const D=se(()=>n()("Title")),q=se(()=>i().title||""),R=se(()=>n()("Enter book title")),T=se(()=>m("title"));en(Z,{id:"title",get label(){return o(D)},get value(){return o(q)},get placeholder(){return o(R)},required:!0,get error(){return o(T)},$$events:{change:_=>w("title",_.detail.value),blur:_=>b("title",_.detail.value)}});var L=g(Z,2);const F=se(()=>n()("Language")),ae=se(()=>i().language||""),B=se(()=>n()("Select language")),le=se(()=>m("language"));Hn(L,{id:"language",get label(){return o(F)},get value(){return o(ae)},get options(){return u},get placeholder(){return o(B)},required:!0,get error(){return o(le)},$$events:{change:_=>w("language",_.detail.value),blur:_=>b("language",_.detail.value)}});var Se=g(L,2),ze=f(Se);const xe=se(()=>n()("Identifier")),Le=se(()=>i().identifier||""),de=se(()=>n()("Enter a unique identifier")),K=se(()=>m("identifier"));en(ze,{id:"identifier",get label(){return o(xe)},get value(){return o(Le)},get placeholder(){return o(de)},required:!0,get error(){return o(K)},$$events:{change:_=>w("identifier",_.detail.value),blur:_=>b("identifier",_.detail.value)}});var X=g(ze,2);X.__click=[sf,e];var re=f(X),ge=g(A,2),Ae=f(ge),We=f(Ae),Be=g(Ae,2),pe=f(Be);xt(pe,17,()=>o(d),It,(_,G,te)=>{var Ee=of(),De=f(Ee);const z=se(()=>n()("Author name")),ee=se(()=>m(`creator[${te}]`));en(De,{id:`creator-${te}`,get value(){return o(G)},get placeholder(){return o(z)},get error(){return o(ee)},$$events:{change:Me=>I("creator",te,Me.detail.value),blur:()=>b("creator",o(d))}});var ie=g(De,2);ie.__click=()=>C("creator",te),U(Me=>{ie.disabled=l(),ve(ie,"aria-label",Me)},[()=>n()("Remove author")]),x(_,Ee)});var be=g(pe,2);be.__click=[lf,k];var he=f(be),Ce=g(O,2),Oe=f(Ce),Ve=f(Oe),tt=f(Ve),ct=g(Ve,2);const at=se(()=>i().description||""),fe=se(()=>n()("Enter book description")),ke=se(()=>m("description"));af(ct,{id:"description",label:void 0,get value(){return o(at)},get placeholder(){return o(fe)},get error(){return o(ke)},rows:3,$$events:{change:_=>w("description",_.detail.value),blur:_=>b("description",_.detail.value)}});var _e=g(Oe,2),Ne=f(_e),N=f(Ne),V=g(Ne,2);const Y=se(()=>n()("Layout")),Q=se(()=>i().renditionLayout||"reflowable"),me=se(()=>m("renditionLayout"));Hn(V,{id:"renditionLayout",get label(){return o(Y)},get value(){return o(Q)},get options(){return c},get error(){return o(me)},$$events:{change:_=>w("renditionLayout",_.detail.value),blur:_=>b("renditionLayout",_.detail.value)}});var j=g(V,2);const oe=se(()=>n()("Page Progression")),ne=se(()=>i().pageProgressionDirection||"default"),we=se(()=>m("pageProgressionDirection"));Hn(j,{id:"pageProgressionDirection",get label(){return o(oe)},get value(){return o(ne)},get options(){return p},get error(){return o(we)},$$events:{change:_=>w("pageProgressionDirection",_.detail.value),blur:_=>b("pageProgressionDirection",_.detail.value)}});var ye=g(j,2);const Ie=se(()=>n()("Orientation")),Te=se(()=>i().renditionOrientation||"auto"),Fe=se(()=>m("renditionOrientation"));Hn(ye,{id:"renditionOrientation",get label(){return o(Ie)},get value(){return o(Te)},get options(){return h},get error(){return o(Fe)},$$events:{change:_=>w("renditionOrientation",_.detail.value),blur:_=>b("renditionOrientation",_.detail.value)}});var ce=g(ye,2);const Re=se(()=>n()("Spread")),$e=se(()=>i().renditionSpread||"auto"),Pe=se(()=>m("renditionSpread"));Hn(ce,{id:"renditionSpread",get label(){return o(Re)},get value(){return o($e)},get options(){return v},get error(){return o(Pe)},$$events:{change:_=>w("renditionSpread",_.detail.value),blur:_=>b("renditionSpread",_.detail.value)}}),U((_,G,te,Ee,De,z)=>{E(J,_),X.disabled=l(),E(re,G),E(We,te),be.disabled=l(),E(he,Ee),E(tt,De),E(N,z)},[()=>n()("Essential Information"),()=>n()("Generate"),()=>n()("Authors"),()=>n()("Add Author"),()=>n()("Description"),()=>n()("Rendition Properties")]),x(r,M),et(),a()}bt(["click"]);var uf=P('<span class="required svelte-14vfa0w">*</span>'),ff=P("<label> <!></label>"),pf=P('<button type="button" class="today-button svelte-14vfa0w"> </button>'),hf=P('<div class="field-error svelte-14vfa0w" role="alert"> </div>'),vf=P('<div class="metadata-field svelte-14vfa0w"><!> <div class="date-input-wrapper svelte-14vfa0w"><input type="date"/> <!></div> <!></div>');function mf(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=je(),s=Mt();let l=W(e,"value",8,""),d=W(e,"required",8,!1),u=W(e,"disabled",8,!1),c=W(e,"error",8,""),p=W(e,"label",8,""),h=W(e,"id",8,"");const v=D=>{s("change",{value:D.target.value})},m=D=>{s("blur",{value:D.target.value})},w=()=>{s("focus",{field:h()})},b=()=>{const D=new Date().toISOString().split("T")[0];s("change",{value:D}),s("blur",{value:D})};ot(()=>(Ze(d()),Ze(l())),()=>{y(i,d()&&(!l()||l().trim()===""))}),Pt(),wt();var k=vf(),C=f(k);{var I=D=>{var q=ff();let R;var T=f(q),L=g(T);{var F=ae=>{var B=uf();U(le=>ve(B,"aria-label",le),[()=>n()("Required field")],ue),x(ae,B)};H(L,ae=>{d()&&ae(F)})}U(ae=>{ve(q,"for",h()),R=nt(q,1,"field-label svelte-14vfa0w",null,R,ae),E(T,`${p()??""} `)},[()=>({"needs-attention":o(i)})],ue),x(D,q)};H(C,D=>{p()&&D(I)})}var M=g(C,2),S=f(M);let O;var A=g(S,2);{var $=D=>{var q=pf(),R=f(q);U((T,L)=>{ve(q,"aria-label",T),E(R,L)},[()=>n()("Set to today"),()=>n()("Today")],ue),Ge("click",q,b),x(D,q)};H(A,D=>{u()||D($)})}var J=g(M,2);{var Z=D=>{var q=hf(),R=f(q);U(()=>{ve(q,"id",`${h()??""}-error`),E(R,c())}),x(D,q)};H(J,D=>{c()&&D(Z)})}U(D=>{ve(S,"id",h()),Sn(S,l()),S.required=d(),S.disabled=u(),O=nt(S,1,"field-input svelte-14vfa0w",null,O,D),ve(S,"aria-describedby",c()?`${h()}-error`:void 0),ve(S,"aria-invalid",!!c())},[()=>({error:!!c(),"needs-attention":o(i)})],ue),Ge("input",S,v),Ge("blur",S,m),Ge("focus",S,w),x(r,k),et(),a()}var gf=P('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">×</button></div>'),wf=(r,e)=>e("subject"),yf=P('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">×</button></div>'),bf=(r,e)=>e("contributor"),_f=P('<div class="advanced-fields svelte-fuok1"><div class="form-columns svelte-fuok1"><div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div> <div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset></div></div></div>');function xf(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"metadata",19,()=>({title:"",language:"",identifier:""})),s=W(e,"validationErrors",19,()=>[]),l=W(e,"saving",3,!1);const d=[{value:"",label:n()("Select content type")},{value:"fiction",label:n()("Fiction")},{value:"non-fiction",label:n()("Non-fiction")},{value:"poetry",label:n()("Poetry")},{value:"drama",label:n()("Drama")},{value:"biography",label:n()("Biography")},{value:"textbook",label:n()("Textbook")},{value:"reference",label:n()("Reference")},{value:"children",label:n()("Children")}],u=_=>{const G=s().find(te=>te.field===_);return G?G.message:""},c=(_,G)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:_,value:G}}))},p=(_,G)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:_,value:G}}))},h=_=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:_}}))},v=(_,G)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:_,index:G}}))},m=(_,G,te)=>{const De=[...yi.getArrayField(i(),_)];De[G]=te,c(_,De)};var w=_f(),b=f(w),k=f(b),C=f(k),I=f(C),M=f(I),S=g(I,2);const O=se(()=>n()("Publisher")),A=se(()=>i().publisher||""),$=se(()=>n()("Enter publisher name")),J=se(()=>u("publisher"));en(S,{id:"publisher",get label(){return o(O)},get value(){return o(A)},get placeholder(){return o($)},get error(){return o(J)},$$events:{change:_=>c("publisher",_.detail.value),blur:_=>p("publisher",_.detail.value)}});var Z=g(S,2);const D=se(()=>n()("Publication Date")),q=se(()=>i().date||""),R=se(()=>u("date"));mf(Z,{id:"date",get label(){return o(D)},get value(){return o(q)},get error(){return o(R)},$$events:{change:_=>c("date",_.detail.value),blur:_=>p("date",_.detail.value)}});var T=g(Z,2);const L=se(()=>n()("Rights")),F=se(()=>i().rights||""),ae=se(()=>n()("Enter copyright information")),B=se(()=>u("rights"));en(T,{id:"rights",get label(){return o(L)},get value(){return o(F)},get placeholder(){return o(ae)},get error(){return o(B)},$$events:{change:_=>c("rights",_.detail.value),blur:_=>p("rights",_.detail.value)}});var le=g(T,2);const Se=se(()=>n()("Content Type")),ze=se(()=>i().type||""),xe=se(()=>n()("Select content type")),Le=se(()=>u("type"));Hn(le,{id:"type",get label(){return o(Se)},get value(){return o(ze)},get options(){return d},get placeholder(){return o(xe)},get error(){return o(Le)},$$events:{change:_=>c("type",_.detail.value),blur:_=>p("type",_.detail.value)}});var de=g(C,2),K=f(de),X=f(K),re=g(K,2);const ge=se(()=>n()("Source")),Ae=se(()=>i().source||""),We=se(()=>n()("Enter source information")),Be=se(()=>u("source"));en(re,{id:"source",get label(){return o(ge)},get value(){return o(Ae)},get placeholder(){return o(We)},get error(){return o(Be)},$$events:{change:_=>c("source",_.detail.value),blur:_=>p("source",_.detail.value)}});var pe=g(re,2);const be=se(()=>n()("Relation")),he=se(()=>i().relation||""),Ce=se(()=>n()("Enter related work information")),Oe=se(()=>u("relation"));en(pe,{id:"relation",get label(){return o(be)},get value(){return o(he)},get placeholder(){return o(Ce)},get error(){return o(Oe)},$$events:{change:_=>c("relation",_.detail.value),blur:_=>p("relation",_.detail.value)}});var Ve=g(pe,2);const tt=se(()=>n()("Coverage")),ct=se(()=>i().coverage||""),at=se(()=>n()("Enter spatial or temporal coverage")),fe=se(()=>u("coverage"));en(Ve,{id:"coverage",get label(){return o(tt)},get value(){return o(ct)},get placeholder(){return o(at)},get error(){return o(fe)},$$events:{change:_=>c("coverage",_.detail.value),blur:_=>p("coverage",_.detail.value)}});var ke=g(Ve,2);const _e=se(()=>n()("Format")),Ne=se(()=>i().format||""),N=se(()=>n()("Enter format information")),V=se(()=>u("format"));en(ke,{id:"format",get label(){return o(_e)},get value(){return o(Ne)},get placeholder(){return o(N)},get error(){return o(V)},$$events:{change:_=>c("format",_.detail.value),blur:_=>p("format",_.detail.value)}});var Y=g(k,2),Q=f(Y),me=f(Q),j=f(me),oe=g(me,2),ne=f(oe);xt(ne,17,()=>i().subject||[],It,(_,G,te)=>{var Ee=gf(),De=f(Ee);const z=se(()=>n()("Subject or keyword")),ee=se(()=>u(`subject[${te}]`));en(De,{id:`subject-${te}`,get value(){return o(G)},get placeholder(){return o(z)},get error(){return o(ee)},$$events:{change:Me=>m("subject",te,Me.detail.value),blur:()=>p("subject",i().subject)}});var ie=g(De,2);ie.__click=()=>v("subject",te),U(Me=>{ie.disabled=l(),ve(ie,"aria-label",Me)},[()=>n()("Remove subject")]),x(_,Ee)});var we=g(ne,2);we.__click=[wf,h];var ye=f(we),Ie=g(Q,2),Te=f(Ie),Fe=f(Te),ce=g(Te,2),Re=f(ce);xt(Re,17,()=>i().contributor||[],It,(_,G,te)=>{var Ee=yf(),De=f(Ee);const z=se(()=>n()("Contributor name")),ee=se(()=>u(`contributor[${te}]`));en(De,{id:`contributor-${te}`,get value(){return o(G)},get placeholder(){return o(z)},get error(){return o(ee)},$$events:{change:Me=>m("contributor",te,Me.detail.value),blur:()=>p("contributor",i().contributor)}});var ie=g(De,2);ie.__click=()=>v("contributor",te),U(Me=>{ie.disabled=l(),ve(ie,"aria-label",Me)},[()=>n()("Remove contributor")]),x(_,Ee)});var $e=g(Re,2);$e.__click=[bf,h];var Pe=f($e);U((_,G,te,Ee,De,z)=>{E(M,_),E(X,G),E(j,te),we.disabled=l(),E(ye,Ee),E(Fe,De),$e.disabled=l(),E(Pe,z)},[()=>n()("Publication"),()=>n()("Additional Information"),()=>n()("Subjects"),()=>n()("Add Subject"),()=>n()("Contributors"),()=>n()("Add Contributor")]),x(r,w),et(),a()}bt(["click"]);class un extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="MetadataServiceError"}}class Gi extends un{constructor(e,t,a){super(e,"VALIDATION_FAILED",a),this.validationResults=t,this.name="MetadataValidationError"}}class Sf{constructor(e){this.workspaceService=e}loadMetadata(e){return e.opf.metadata}async updateField(e,t,a){try{const n={[t]:a},i=this.validateMetadataUpdates(n);if(i.some(s=>s.type==="error"))throw new Gi("Field validation failed",i,e.id);return await this.workspaceService.updateMetadata(e,n)}catch(n){throw n instanceof un?n:new un(`Failed to update field ${String(t)}: ${n instanceof Error?n.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async updateMetadata(e,t){try{const a=this.validateMetadataUpdates(t);if(a.filter(i=>i.type==="error").length>0)throw new Gi("Metadata validation failed",a,e.id);return await this.workspaceService.updateMetadata(e,t)}catch(a){throw a instanceof un?a:new un(`Failed to update metadata: ${a instanceof Error?a.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async addArrayItem(e,t,a=""){try{const n=e.opf.metadata[t]||[],i={[t]:[...n,a||this.getDefaultArrayValue(t)]};return await this.workspaceService.updateMetadata(e,i)}catch(n){throw new un(`Failed to add ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_ADD_ERROR",e.id)}}async removeArrayItem(e,t,a){try{const n=e.opf.metadata[t]||[];if(a<0||a>=n.length)throw new un(`Invalid index ${a} for ${t} array`,"INVALID_INDEX",e.id);const i=[...n];i.splice(a,1);const s={[t]:i};return await this.workspaceService.updateMetadata(e,s)}catch(n){throw n instanceof un?n:new un(`Failed to remove ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_REMOVE_ERROR",e.id)}}validateMetadata(e){const t=[];return e.title?.trim()||t.push({field:"title",message:"Title is required",type:"error"}),e.language?.trim()||t.push({field:"language",message:"Language is required",type:"error"}),e.identifier?.trim()||t.push({field:"identifier",message:"Identifier is required",type:"error"}),e.language&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)&&t.push({field:"language",message:'Invalid language code format (use ISO 639-1, e.g., "en" or "en-US")',type:"warning"}),e.title&&e.title.length>200&&t.push({field:"title",message:"Title should be under 200 characters",type:"warning"}),e.creator&&e.creator.some(a=>!a.trim())&&t.push({field:"creator",message:"Creator entries cannot be empty",type:"warning"}),t}validateMetadataUpdates(e){const t=[];return e.title!==void 0&&!e.title.trim()&&t.push({field:"title",message:"Title cannot be empty",type:"error"}),e.language!==void 0&&(e.language.trim()?/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)||t.push({field:"language",message:"Invalid language code format",type:"warning"}):t.push({field:"language",message:"Language cannot be empty",type:"error"})),e.identifier!==void 0&&!e.identifier.trim()&&t.push({field:"identifier",message:"Identifier cannot be empty",type:"error"}),t}getDefaultArrayValue(e){switch(e){case"creator":return"Unknown Author";case"contributor":return"Unknown Contributor";case"subject":return"New Subject";default:return""}}}var Ef=P('<div class="loading-state svelte-17s3g49"><p> </p></div>'),kf=(r,e)=>y(e,null),Tf=P('<div class="error-state svelte-17s3g49"><p class="error-message svelte-17s3g49"> </p> <button type="button" class="retry-button svelte-17s3g49"> </button></div>'),Cf=P('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),Ff=P('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),If=P('<div class="tab-panel svelte-17s3g49" tabindex="-1"><!></div>'),Pf=P('<div class="metadata-editor svelte-17s3g49"><div class="pane-header svelte-17s3g49" tabindex="-1"><!></div> <div class="pane-content svelte-17s3g49" tabindex="-1"><!></div></div>');function Mf(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=Mt();let s=W(e,"workspace",15,null),l=se(()=>s()?.opf.metadata??{title:"",language:"",identifier:""}),d=se(()=>e.metadataService.validateMetadata(o(l))),u=se(()=>!s()),c=Ue("basic"),p=Ue(!1),h=Ue(null),v=se(()=>[{id:"basic",label:n()("Basic Info")},{id:"advanced",label:n()("Advanced")},{id:"publication",label:n()("Publication Details")},{id:"accessibility",label:n()("Accessibility")}]);const m=R=>{switch(R){case"basic":return["title","language","identifier","creator"];case"advanced":return["publisher","date","description","subject","rights","source","relation","coverage","type","format","contributor"];case"publication":return["series","seriesPosition","epubVersion","uniqueIdentifierScheme","primaryCreatorFileAs","creatorRoles"];case"accessibility":return["accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard","accessibilitySummary","accessibilityCertification","accessibilityCertifier"];default:return[]}},w=(R,T)=>{const L=m(R);return o(d).filter(F=>L.includes(F.field))},b=R=>{},k=async R=>{const{field:T,value:L}=R.detail;if(s())try{s(await e.metadataService.updateField(s(),T,L)),i("metadataChanged",{field:T,value:L}),y(h,null)}catch(F){console.error(`Failed to save field ${T}:`,F),y(h,n()("Failed to save metadata field"),!0)}},C=async R=>{const{field:T}=R.detail;if(s())try{y(p,!0),(T==="creator"||T==="subject"||T==="contributor")&&(s(await e.metadataService.addArrayItem(s(),T)),i("metadataChanged",{field:T,value:s().opf.metadata[T]})),y(h,null)}catch(L){console.error(`Failed to add ${T}:`,L),y(h,n()("Failed to add metadata item"),!0)}finally{y(p,!1)}},I=async R=>{const{field:T,index:L}=R.detail;if(s())try{y(p,!0),(T==="creator"||T==="subject"||T==="contributor")&&(s(await e.metadataService.removeArrayItem(s(),T,L)),i("metadataChanged",{field:T,value:s().opf.metadata[T]})),y(h,null)}catch(F){console.error(`Failed to remove ${T}:`,F),y(h,n()("Failed to remove metadata item"),!0)}finally{y(p,!1)}},M=async()=>{const R=`urn:uuid:${crypto.randomUUID()}`;await k({detail:{field:"identifier",value:R}})},S=async R=>{const T=R.detail.tabId;if(w(o(c),o(l)).length>0){alert(n()("Please fix errors before switching tabs"));return}y(c,T,!0)};var O=Pf(),A=f(O),$=f(A);$u($,{get activeTab(){return o(c)},get validationErrors(){return o(d)},get tabs(){return o(v)},$$events:{tabClick:S}});var J=g(A,2),Z=f(J);{var D=R=>{var T=Ef(),L=f(T),F=f(L);U(ae=>E(F,ae),[()=>n()("Loading metadata…")]),x(R,T)},q=(R,T)=>{{var L=ae=>{var B=Tf(),le=f(B),Se=f(le),ze=g(le,2);ze.__click=[kf,h];var xe=f(ze);U(Le=>{E(Se,o(h)),E(xe,Le)},[()=>n()("Retry")]),x(ae,B)},F=ae=>{var B=If(),le=f(B);{var Se=xe=>{df(xe,{get metadata(){return o(l)},get validationErrors(){return o(d)},get saving(){return o(p)},onfieldChange:b,onfieldSave:k,onarrayAdd:C,onarrayRemove:I,ongenerateIdentifier:M})},ze=(xe,Le)=>{{var de=X=>{xf(X,{get metadata(){return o(l)},get validationErrors(){return o(d)},get saving(){return o(p)},onfieldChange:b,onfieldSave:k,onarrayAdd:C,onarrayRemove:I})},K=(X,re)=>{{var ge=We=>{var Be=Cf(),pe=f(Be),be=f(pe),he=g(pe,2),Ce=f(he);U((Oe,Ve,tt)=>{E(be,Oe),E(Ce,`${Ve??""} - ${tt??""}`)},[()=>n()("Coming Soon"),()=>n()("Publication Details"),()=>n()("Series information, EPUB version, and publication-specific metadata")]),x(We,Be)},Ae=(We,Be)=>{{var pe=be=>{var he=Ff(),Ce=f(he),Oe=f(Ce),Ve=g(Ce,2),tt=f(Ve);U((ct,at,fe)=>{E(Oe,ct),E(tt,`${at??""} - ${fe??""}`)},[()=>n()("Coming Soon"),()=>n()("Accessibility"),()=>n()("Accessibility features, hazards, and certification information")]),x(be,he)};H(We,be=>{o(c)==="accessibility"&&be(pe)},Be)}};H(X,We=>{o(c)==="publication"?We(ge):We(Ae,!1)},re)}};H(xe,X=>{o(c)==="advanced"?X(de):X(K,!1)},Le)}};H(le,xe=>{o(c)==="basic"?xe(Se):xe(ze,!1)})}U(()=>{ve(B,"id",`metadata-panel-${o(c)??""}`),ve(B,"aria-labelledby",`metadata-tab-${o(c)??""}`)}),x(ae,B)};H(R,ae=>{o(h)?ae(L):ae(F,!1)},T)}};H(Z,R=>{o(u)?R(D):R(q,!1)})}x(r,O),et(),a()}bt(["click"]);var Lf=P('<div class="coming-soon-badge svelte-skhkuy"><span class="badge-text">Phase 3</span></div>'),Df=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Rf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),zf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Uf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Af=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Of=(r,e)=>e("demo_action_1"),Wf=(r,e)=>e("demo_action_2"),jf=()=>yt.navigateTo("workspace"),Bf=P('<div class="last-action svelte-skhkuy"><span class="action-icon svelte-skhkuy">✨</span> <span> </span></div>'),Nf=P('<div class="placeholder-view svelte-skhkuy"><header class="view-header svelte-skhkuy"><div class="header-content svelte-skhkuy"><span class="view-icon svelte-skhkuy"> </span> <div class="header-text svelte-skhkuy"><h2 class="svelte-skhkuy"> </h2> <p class="svelte-skhkuy"> </p></div></div> <!></header> <main class="view-content svelte-skhkuy"><div class="placeholder-content svelte-skhkuy"><div class="placeholder-icon svelte-skhkuy"><span class="large-icon svelte-skhkuy"> </span></div> <h3 class="svelte-skhkuy"> </h3> <p class="placeholder-description svelte-skhkuy"> </p> <div class="feature-preview svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <ul class="feature-list svelte-skhkuy"><!></ul></div> <div class="demo-actions svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <div class="action-buttons svelte-skhkuy"><button class="btn btn-primary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button></div></div> <!></div></main></div>');function Hr(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"viewType",8,"Unknown"),s=W(e,"title",8,"View"),l=W(e,"description",8,"This view will be implemented in Phase 3."),d=W(e,"icon",8,"📄"),u=W(e,"comingSoon",8,!0),c,p=je({});function h(_e){_e&&y(p,{...o(p),..._e});const Ne=yt.getViewData(i());Ne&&y(p,Ne)}function v(){yt.setViewData(i(),o(p))}function m(){return o(p)}function w(_e){y(p,{...o(p),..._e})}async function b(){return!0}nn(()=>{c=yt.addNavigationGuard(b),h()}),sr(()=>{c&&yt.removeNavigationGuard(c),v()});function k(_e){console.log(`${i()} action:`,_e),qe(p,o(p).lastAction=_e),qe(p,o(p).actionTime=new Date().toISOString()),yt.setViewData(i(),o(p))}wt();var C=Nf(),I=f(C),M=f(I),S=f(M),O=f(S),A=g(S,2),$=f(A),J=f($),Z=g($,2),D=f(Z),q=g(M,2);{var R=_e=>{var Ne=Lf();x(_e,Ne)};H(q,_e=>{u()&&_e(R)})}var T=g(I,2),L=f(T),F=f(L),ae=f(F),B=f(ae),le=g(F,2),Se=f(le),ze=g(le,2),xe=f(ze),Le=g(ze,2),de=f(Le),K=f(de),X=g(de,2),re=f(X);{var ge=_e=>{var Ne=Df(),N=Ke(Ne),V=f(N),Y=g(N,2),Q=f(Y),me=g(Y,2),j=f(me),oe=g(me,2),ne=f(oe);U((we,ye,Ie,Te)=>{E(V,`📋 ${we??""}`),E(Q,`🔍 ${ye??""}`),E(j,`📁 ${Ie??""}`),E(ne,`👁️ ${Te??""}`)},[()=>n()("File listing and management"),()=>n()("Search and filter files"),()=>n()("Add/remove manifest items"),()=>n()("Preview file contents")],ue),x(_e,Ne)},Ae=(_e,Ne)=>{{var N=Y=>{var Q=Rf(),me=Ke(Q),j=f(me),oe=g(me,2),ne=f(oe),we=g(oe,2),ye=f(we),Ie=g(we,2),Te=f(Ie);U((Fe,ce,Re,$e)=>{E(j,`📖 ${Fe??""}`),E(ne,`🔗 ${ce??""}`),E(ye,`📝 ${Re??""}`),E(Te,`🎯 ${$e??""}`)},[()=>n()("Table of contents editing"),()=>n()("Navigation link management"),()=>n()("TOC structure editing"),()=>n()("Auto-generation from spine")],ue),x(Y,Q)},V=(Y,Q)=>{{var me=oe=>{var ne=zf(),we=Ke(ne),ye=f(we),Ie=g(we,2),Te=f(Ie),Fe=g(Ie,2),ce=f(Fe),Re=g(Fe,2),$e=f(Re);U((Pe,_,G,te)=>{E(ye,`📚 ${Pe??""}`),E(Te,`🔄 ${_??""}`),E(ce,`📄 ${G??""}`),E($e,`🔗 ${te??""}`)},[()=>n()("Chapter ordering interface"),()=>n()("Drag-and-drop reordering"),()=>n()("Spine item management"),()=>n()("Link to source files")],ue),x(oe,ne)},j=(oe,ne)=>{{var we=Ie=>{var Te=Uf(),Fe=Ke(Te),ce=f(Fe),Re=g(Fe,2),$e=f(Re),Pe=g(Re,2),_=f(Pe),G=g(Pe,2),te=f(G);U((Ee,De,z,ee)=>{E(ce,`⚙️ ${Ee??""}`),E($e,`🎨 ${De??""}`),E(_,`💾 ${z??""}`),E(te,`🔧 ${ee??""}`)},[()=>n()("Application preferences"),()=>n()("Theme and UI settings"),()=>n()("Export/import settings"),()=>n()("Advanced configurations")],ue),x(Ie,Te)},ye=Ie=>{var Te=Af(),Fe=Ke(Te),ce=f(Fe),Re=g(Fe,2),$e=f(Re),Pe=g(Re,2),_=f(Pe),G=g(Pe,2),te=f(G);U((Ee,De,z,ee)=>{E(ce,`🚀 ${Ee??""}`),E($e,`📊 ${De??""}`),E(_,`🔄 ${z??""}`),E(te,`💡 ${ee??""}`)},[()=>n()("Enhanced functionality"),()=>n()("Improved user interface"),()=>n()("Seamless integration"),()=>n()("New capabilities")],ue),x(Ie,Te)};H(oe,Ie=>{i()==="settings"?Ie(we):Ie(ye,!1)},ne)}};H(Y,oe=>{i()==="spine"?oe(me):oe(j,!1)},Q)}};H(_e,Y=>{i()==="navigation"?Y(N):Y(V,!1)},Ne)}};H(re,_e=>{i()==="manifest"?_e(ge):_e(Ae,!1)})}var We=g(Le,2),Be=f(We),pe=f(Be),be=g(Be,2),he=f(be);he.__click=[Of,k];var Ce=f(he),Oe=g(he,2);Oe.__click=[Wf,k];var Ve=f(Oe),tt=g(Oe,2);tt.__click=[jf];var ct=f(tt),at=g(We,2);{var fe=_e=>{var Ne=Bf(),N=g(f(Ne),2),V=f(N);U((Y,Q,me)=>E(V,`${Y??""}: ${o(p).lastAction??""}
            ${Q??""}
            ${me??""}`),[()=>n()("Last action"),()=>n()("at"),()=>new Date(o(p).actionTime).toLocaleTimeString()],ue),x(_e,Ne)};H(at,_e=>{o(p).lastAction&&_e(fe)})}U((_e,Ne,N,V,Y,Q,me)=>{E(O,d()),E(J,s()),E(D,l()),E(B,d()),E(Se,_e),E(xe,Ne),E(K,`${N??""}:`),E(pe,`${V??""}:`),E(Ce,Y),E(Ve,Q),E(ct,me)},[()=>n()("Coming Soon"),()=>n()("The {title} interface will be implemented in Phase 3 of the EDITME development. This will include full content management capabilities.",{title:s().toLowerCase()}),()=>n()("Planned Features"),()=>n()("Navigation Demo"),()=>n()("Demo Action 1"),()=>n()("Demo Action 2"),()=>n()("Back to Projects")],ue),x(r,C),Ft(e,"onViewEnter",h),Ft(e,"onViewLeave",v),Ft(e,"getViewData",m),Ft(e,"setViewData",w),Ft(e,"canLeave",b);var ke=et({onViewEnter:h,onViewLeave:v,getViewData:m,setViewData:w,canLeave:b});return a(),ke}bt(["click"]);function $f(r,e){e.onPaneToggle?.()}function Hf(r,e){e.onForceUpdate?.()}var Vf=P('<div class="status-indicator transforming svelte-1o393xc" title="Transform in progress"><div class="status-spinner svelte-1o393xc"></div> <span class="svelte-1o393xc">Transforming...</span></div>'),qf=P('<div class="status-indicator error svelte-1o393xc" title="Transform error"><span class="status-icon svelte-1o393xc">⚠️</span> <span class="svelte-1o393xc">Error</span></div>'),Gf=P('<div class="status-indicator error svelte-1o393xc" title="Syntax error prevents transform"><span class="status-icon svelte-1o393xc">⚠️</span> <span class="svelte-1o393xc">Syntax Error</span></div>'),Xf=P('<div class="status-indicator warning svelte-1o393xc"><span class="status-icon svelte-1o393xc">⚠️</span> <span class="svelte-1o393xc"> </span></div>'),Jf=P('<div class="status-indicator success svelte-1o393xc" title="Transform successful"><span class="status-icon svelte-1o393xc">✅</span> <span class="svelte-1o393xc"> </span></div>'),Kf=(r,e)=>e(2,r),Yf=P('<option class="svelte-1o393xc"> </option>'),Zf=P('<div class="pane-error-overlay svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">⚠️</span> <span class="error-message svelte-1o393xc"> </span></div>'),Qf=P('<div class="editor-pane pane-2 svelte-1o393xc"><div class="pane-header svelte-1o393xc"><select class="file-selector svelte-1o393xc" aria-label="Select file for pane 2"><option disabled class="svelte-1o393xc">Select file...</option><!></select></div> <div class="textarea-container svelte-1o393xc"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 2 content"></textarea> <!></div></div>'),ep=(r,e)=>e(1,r),tp=P('<option class="svelte-1o393xc"> </option>'),np=P('<div class="pane-error-overlay svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">⚠️</span> <span class="error-message svelte-1o393xc"> </span></div>'),rp=P('<details class="error-stack svelte-1o393xc"><summary class="svelte-1o393xc">Stack Trace</summary> <pre class="svelte-1o393xc"> </pre></details>'),ap=P('<div class="error-display svelte-1o393xc"><div class="error-header svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">🚨</span> <strong class="svelte-1o393xc"> </strong></div> <div class="error-message svelte-1o393xc"> </div> <!></div>'),ip=P('<li class="svelte-1o393xc"> </li>'),sp=P('<div class="warnings-display svelte-1o393xc"><div class="warnings-header svelte-1o393xc"><span class="warning-icon svelte-1o393xc" aria-hidden="true">⚠️</span> <strong class="svelte-1o393xc"> </strong></div> <ul class="warnings-list svelte-1o393xc"></ul></div>'),op=P('<div class="editor-pane-container svelte-1o393xc"><div class="editor-header svelte-1o393xc"><div class="editor-controls svelte-1o393xc"><button type="button" class="pane-toggle-btn svelte-1o393xc"><span class="toggle-icon svelte-1o393xc" aria-hidden="true"> </span> <span class="toggle-label svelte-1o393xc"> </span></button></div> <div class="editor-status svelte-1o393xc"><!> <button type="button" class="force-update-btn svelte-1o393xc" title="Force immediate preview update">🔄</button></div></div> <div class="editor-content svelte-1o393xc"><div><!> <div class="editor-pane pane-1 svelte-1o393xc"><div class="pane-header svelte-1o393xc"><select class="file-selector svelte-1o393xc" aria-label="Select file for pane 1"><option disabled class="svelte-1o393xc">Select file...</option><!></select></div> <div class="textarea-container svelte-1o393xc"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 1 content"></textarea> <!></div></div></div></div> <!> <!></div>');function lp(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(C(),"$pane1FileStore",t),i=()=>Ye(I(),"$pane2FileStore",t),s=()=>Ye(mt,"$t",t);let l=W(e,"transformError",3,null),d=W(e,"transformWarnings",19,()=>[]),u=W(e,"isTransforming",3,!1),c=W(e,"executionTime",3,0),p=W(e,"availableFiles1",19,()=>[]),h=W(e,"availableFiles2",19,()=>[]),v=W(e,"editorMode",3,"single"),m=W(e,"pane1SelectedFile",3,""),w=W(e,"pane2SelectedFile",3,""),b=W(e,"pane1Error",15),k=W(e,"pane2Error",15),C=W(e,"pane1FileStore",3,null),I=W(e,"pane2FileStore",3,null);W(e,"onPreviewClick",3,null);function M(j,oe){const ne=oe.target,ye=(j===1?p():h()).find(Ie=>Ie.value===ne.value);ye&&e.onFileSelect?.(j,ye.path,ye.type)}function S(j){const oe=j.target.value;if(!C()){console.warn("🚫 No file store available for input in pane 1");return}const ne=e.contentService.validateFileContent(oe,m());if(ne){b(ne);return}else b(null);C().updateContent(oe)}function O(j){const oe=j.target.value;if(!I()){console.warn("🚫 No file store available for input in pane 2");return}const ne=e.contentService.validateFileContent(oe,w());if(ne){k(ne);return}else k(null);I().updateContent(oe)}function A(j){return j.includes("css")?"syntax-css":j.includes("javascript")||j.includes("js")||j.includes("transform")?"syntax-js":"syntax-text"}function $(j){return j.includes("css")||j.includes("javascript")||j.includes("js")||j.includes("transform")}function J(j){return j==="text"?`Enter your chapter content here...

This will be transformed to XHTML using your configured text transform script.`:j.includes("css")?`/* Stylesheet content */

body {
  /* Your styles here */
}`:j.includes("javascript")||j.includes("js")?`// JavaScript content

(function() {
  // Your code here
})();`:j.includes("transform")?`// Transform script

function transform(input) {
  // Your transform logic here
  return input;
}`:""}function Z(j){return j<1e3?`${j}ms`:`${(j/1e3).toFixed(1)}s`}let D=Ue(void 0),q=Ue(void 0);function R(j){let oe=j.trim();return oe=oe.split("").map(ne=>{const we=ne.charCodeAt(0);return we===8217||we===8216?"'":we===8221||we===8220?'"':ne}).join(""),oe=oe.replace(/[""„‚]/g,'"'),oe=oe.replace(/\s+/g," "),oe}function T(j){const{text:oe}=j;let ne=null,we="";if(C()&&m()&&o(D)&&n()?.content?(ne=o(D),we=n().content):I()&&w()&&o(q)&&i()?.content&&(ne=o(q),we=i().content),!ne||!we)return;const ye=oe.trim(),Ie=R(ye),Te=we.toLowerCase(),Fe=Ie.toLowerCase();let ce=Te.indexOf(Fe);if(ce!==-1){L(ne,ce,ce+Ie.length);return}if(ye.length>=8){const Re=ye.toLowerCase();if(ce=Te.indexOf(Re),ce!==-1){L(ne,ce,ce+ye.length);return}}}function L(j,oe,ne){j.focus(),j.setSelectionRange(oe,ne);const ye=j.value.substring(0,oe).split(`
`).length-1,Ie=parseInt(getComputedStyle(j).lineHeight)||20,Te=ye*Ie;j.scrollTop=Math.max(0,Te-j.clientHeight/2)}var F=op(),ae=f(F),B=f(ae),le=f(B);le.__click=[$f,e];var Se=f(le),ze=f(Se),xe=g(Se,2),Le=f(xe),de=g(B,2),K=f(de);{var X=j=>{var oe=Vf();x(j,oe)},re=(j,oe)=>{{var ne=ye=>{var Ie=qf();x(ye,Ie)},we=(ye,Ie)=>{{var Te=ce=>{var Re=Gf();x(ce,Re)},Fe=(ce,Re)=>{{var $e=_=>{var G=Xf(),te=g(f(G),2),Ee=f(te);U(()=>{ve(G,"title",`${d().length} warnings`),E(Ee,`${d().length??""} warnings`)}),x(_,G)},Pe=_=>{var G=Jf(),te=g(f(G),2),Ee=f(te);U(De=>E(Ee,De),[()=>Z(c())]),x(_,G)};H(ce,_=>{d().length>0?_($e):_(Pe,!1)},Re)}};H(ye,ce=>{b()||k()?ce(Te):ce(Fe,!1)},Ie)}};H(j,ye=>{l()&&l().stage!=="syntax-validation"?ye(ne):ye(we,!1)},oe)}};H(K,j=>{u()?j(X):j(re,!1)})}var ge=g(K,2);ge.__click=[Hf,e];var Ae=g(ae,2),We=f(Ae);let Be;var pe=f(We);{var be=j=>{var oe=Qf(),ne=f(oe),we=f(ne);Cr(we,w);var ye;we.__change=[Kf,M];var Ie=f(we);Ie.value=Ie.__value="";var Te=g(Ie);xt(Te,17,h,It,(_,G)=>{var te=Yf(),Ee={},De=f(te);U(()=>{Ee!==(Ee=o(G).value)&&(te.value=(te.__value=o(G).value)??""),E(De,o(G).label)}),x(_,te)});var Fe=g(ne,2),ce=f(Fe);let Re;ce.__input=O,Ot(ce,_=>y(q,_),()=>o(q));var $e=g(ce,2);{var Pe=_=>{var G=Zf(),te=g(f(G),2),Ee=f(te);U(()=>E(Ee,k())),x(_,G)};H($e,_=>{k()&&_(Pe)})}U((_,G,te,Ee)=>{ye!==(ye=w())&&(we.value=(we.__value=w())??"",Dn(we,w())),Re=nt(ce,1,`content-textarea ${_??""}`,"svelte-1o393xc",Re,G),Sn(ce,I()&&i()?.content||""),ve(ce,"placeholder",te),ve(ce,"spellcheck",w()==="text"),ve(ce,"dir",Ee),ce.dir=ce.dir},[()=>A(w()),()=>({"has-error":k()}),()=>J(w()),()=>$(w())?"ltr":void 0]),x(j,oe)};H(pe,j=>{v()==="dual"&&j(be)})}var he=g(pe,2),Ce=f(he),Oe=f(Ce);Cr(Oe,m);var Ve;Oe.__change=[ep,M];var tt=f(Oe);tt.value=tt.__value="";var ct=g(tt);xt(ct,17,p,It,(j,oe)=>{var ne=tp(),we={},ye=f(ne);U(()=>{we!==(we=o(oe).value)&&(ne.value=(ne.__value=o(oe).value)??""),E(ye,o(oe).label)}),x(j,ne)});var at=g(Ce,2),fe=f(at);let ke;fe.__input=S,Ot(fe,j=>y(D,j),()=>o(D));var _e=g(fe,2);{var Ne=j=>{var oe=np(),ne=g(f(oe),2),we=f(ne);U(()=>E(we,b())),x(j,oe)};H(_e,j=>{b()&&j(Ne)})}var N=g(Ae,2);{var V=j=>{var oe=ap(),ne=f(oe),we=g(f(ne),2),ye=f(we),Ie=g(ne,2),Te=f(Ie),Fe=g(Ie,2);{var ce=Re=>{var $e=rp(),Pe=g(f($e),2),_=f(Pe);U(()=>E(_,l().stack)),x(Re,$e)};H(Fe,Re=>{l().stack&&Re(ce)})}U(()=>{E(ye,`Transform Error (${l().stage??""})`),E(Te,l().message)}),x(j,oe)};H(N,j=>{l()&&l().stage!=="syntax-validation"&&j(V)})}var Y=g(N,2);{var Q=j=>{var oe=sp(),ne=f(oe),we=g(f(ne),2),ye=f(we),Ie=g(ne,2);xt(Ie,21,d,It,(Te,Fe)=>{var ce=ip(),Re=f(ce);U(()=>E(Re,o(Fe))),x(Te,ce)}),U(()=>E(ye,`${d().length??""} Warnings`)),x(j,oe)};H(Y,j=>{d().length>0&&j(Q)})}U((j,oe,ne,we,ye,Ie)=>{ve(le,"title",v()==="single"?"Add second editor pane":"Switch to single pane"),E(ze,v()==="single"?"⊞":"⊟"),E(Le,j),ge.disabled=u(),Be=nt(We,1,"editor-panes svelte-1o393xc",null,Be,oe),Ve!==(Ve=m())&&(Oe.value=(Oe.__value=m())??"",Dn(Oe,m())),ke=nt(fe,1,`content-textarea ${ne??""}`,"svelte-1o393xc",ke,we),Sn(fe,C()&&n()?.content||""),ve(fe,"placeholder",ye),ve(fe,"spellcheck",m()==="text"),ve(fe,"dir",Ie),fe.dir=fe.dir},[()=>v()==="single"?s()("Add Pane"):s()("Single Pane"),()=>({"dual-mode":v()==="dual"}),()=>A(m()),()=>({"has-error":b()}),()=>J(m()),()=>$(m())?"ltr":void 0]),x(r,F);var me=et({findAndSelectText:T});return a(),me}bt(["click","change","input"]);function cp(r,e,t,a){y(e,o(e)==="portrait"?"landscape":"portrait",!0),t(o(a))}function dp(r,e,t,a,n,i){console.log("🔄 CLICK EVENT FIRED! toggleSourceView() called"),console.log("🔄 Current showSource state:",o(e));const s=o(e);y(e,!o(e)),console.log("🔄 State toggled from",s,"to",o(e)),o(e)||(console.log("🔄 About to call updatePreviewContent and re-apply device settings"),setTimeout(()=>{console.log("🔄 updatePreviewContent called"),t(a()),n(o(i))},0)),console.log("🔄 toggleSourceView completed")}var up=P('<button type="button" class="orientation-toggle svelte-32psnf" title="Toggle orientation" aria-label="Toggle device orientation"> </button>'),fp=(r,e)=>e(r.target.value),pp=P('<option class="svelte-32psnf"> </option>'),hp=P('<optgroup class="svelte-32psnf"></optgroup>'),vp=P('<div class="transform-status transforming svelte-32psnf"><div class="status-spinner svelte-32psnf"></div> <span class="svelte-32psnf">Transforming content...</span></div>'),mp=P('<div class="transform-status error svelte-32psnf"><span class="status-icon svelte-32psnf">🚨</span> <span class="svelte-32psnf"> </span></div>'),gp=P('<div class="transform-status warning svelte-32psnf"><span class="status-icon svelte-32psnf">⚠️</span> <span class="svelte-32psnf"> </span></div>'),wp=P('<div class="source-view svelte-32psnf"><pre class="source-code svelte-32psnf" dir="ltr"> </pre></div>'),yp=P('<details class="svelte-32psnf"><summary class="svelte-32psnf">Stack Trace</summary> <pre class="error-stack svelte-32psnf"> </pre></details>'),bp=P('<div class="preview-error svelte-32psnf"><div class="error-content svelte-32psnf"><h3 class="svelte-32psnf">Transform Error</h3> <p class="svelte-32psnf"><strong class="svelte-32psnf">Stage:</strong> </p> <p class="svelte-32psnf"><strong class="svelte-32psnf">Message:</strong> </p> <!></div></div>'),_p=P('<iframe class="preview-iframe svelte-32psnf" title="XHTML Preview"></iframe>'),xp=P('<div class="preview-empty svelte-32psnf"><div class="empty-content svelte-32psnf"><span class="empty-icon svelte-32psnf" aria-hidden="true">📝</span> <h3 class="svelte-32psnf">No Content</h3> <p class="svelte-32psnf">Start typing in the editor to see your XHTML preview here.</p></div></div>'),Sp=P('<div class="preview-viewport svelte-32psnf"><div class="preview-frame-wrapper svelte-32psnf"><div><!></div></div></div>'),Ep=P('<span class="update-time svelte-32psnf"> </span>'),kp=P('<span class="content-size svelte-32psnf"> </span>'),Tp=P('<span class="warning-count svelte-32psnf"> </span>'),Cp=P('<div class="preview-pane-container svelte-32psnf"><div class="preview-header svelte-32psnf"><div class="preview-title svelte-32psnf"><button title="Toggle source view"> </button></div> <div class="preview-controls svelte-32psnf"><!>  <select class="device-selector svelte-32psnf"></select></div></div> <!> <div class="preview-content svelte-32psnf"><!></div> <div class="preview-footer svelte-32psnf"><div class="meta-info svelte-32psnf"><!> <!> <!></div></div></div>');function Fp(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=()=>Ye(O,"$lastUpdateTime",t);let s=W(e,"xhtmlContent",3,""),l=W(e,"isTransforming",3,!1),d=W(e,"transformError",3,null),u=W(e,"transformWarnings",19,()=>[]);W(e,"executionTime",3,0);let c=W(e,"onPreviewClick",3,null);const p=[{id:"desktop",name:"Fill",width:"100%",height:"100%",icon:"🖥️",category:"responsive"},{id:"galaxy-s23",name:"Pocket",width:"360px",height:"800px",icon:"📱",category:"commute"},{id:"iphone",name:"Standard",width:"375px",height:"667px",icon:"📱",category:"commute"},{id:"pixel-7",name:"Large",width:"393px",height:"851px",icon:"📱",category:"commute"},{id:"iphone-plus",name:"Plus",width:"414px",height:"736px",icon:"📱",category:"commute"},{id:"ipad",name:"Compact",width:"768px",height:"1024px",icon:"📱",category:"home"},{id:"galaxy-tab-s9",name:"Large",width:"800px",height:"1280px",icon:"📱",category:"home"},{id:"ipad-air",name:"Extra Large",width:"820px",height:"1180px",icon:"📱",category:"home"},{id:"kindle",name:"Standard",width:"600px",height:"800px",icon:"📚",category:"travel"},{id:"kobo-clara-2e",name:"Large",width:"758px",height:"1024px",icon:"📚",category:"travel"}],h=N=>{switch(N){case"responsive":return n()("Responsive");case"commute":return n()("Commute (phone)");case"home":return n()("Home (tablet)");case"travel":return n()("Travel (e-ink)");default:return N}},v=N=>{switch(N.name){case"Fill":return n()("Fill");case"Pocket":return n()("Pocket");case"Standard":return n()("Standard");case"Large":return n()("Large");case"Plus":return n()("Plus");case"Compact":return n()("Compact");case"Extra Large":return n()("Extra Large");default:return N.name}};let m=Ue("desktop"),w=Ue("portrait"),b=Ue(!1),k=Ue(void 0),C=Ue(void 0),I=Ue(void 0),M=Ue(1),S=Ue(null);const O=Jt(Date.now()),A=se(()=>{const N={};for(const V of p)N[V.category]||(N[V.category]=[]),N[V.category].push(V);return N});kt(()=>{Z(s())});function $(N){try{const V=N.documentElement,Y=V.scrollTop||N.body.scrollTop,Q=V.clientWidth/2,me=Math.min(100,V.clientHeight/4),j=N.elementFromPoint(Q,me);if(!j||j===N.body||j===V)return{element:null,id:null,offset:Y};let oe=j;for(;oe&&oe!==N.body;){if(oe.id){const Ie=oe.getBoundingClientRect(),Te=Y-(Ie.top+Y-me);return{element:oe,id:oe.id,offset:Te}}oe=oe.parentElement}const ne=j.tagName.toLowerCase(),ye=Array.from(N.querySelectorAll(ne)).indexOf(j);if(ye>=0){const Ie=j.getBoundingClientRect(),Te=Y-(Ie.top+Y-me);return{element:j,id:`${ne}[${ye}]`,offset:Te}}return{element:null,id:null,offset:Y}}catch(V){return console.warn("Failed to find scroll anchor:",V),null}}function J(N,V,Y){if(!V){N.documentElement.scrollTop=Y,N.body&&(N.body.scrollTop=Y);return}try{let Q=null;if(V.id)if(V.id.includes("[")&&V.id.includes("]")){const[me,j]=V.id.split("["),oe=parseInt(j.replace("]",""),10);Q=N.querySelectorAll(me)[oe]||null}else Q=N.getElementById(V.id);if(Q){if(Q.scrollIntoView({behavior:"instant",block:"start"}),V.offset!==0){const me=N.documentElement.scrollTop||N.body?.scrollTop||0,j=Math.max(0,me+V.offset);N.documentElement.scrollTop=j,N.body&&(N.body.scrollTop=j)}}else N.documentElement.scrollTop=Y,N.body&&(N.body.scrollTop=Y)}catch(Q){console.warn("Failed to restore scroll position:",Q),N.documentElement.scrollTop=Y,N.body&&(N.body.scrollTop=Y)}}function Z(N){if(!(!o(k)||!N))try{const V=o(k).contentDocument;if(!V)return;const Y=V.documentElement.scrollTop||V.body?.scrollTop||0,Q=Y>0?$(V):null;y(S,{anchor:Q,fallbackScrollTop:Y},!0),V.open(),V.write(N),V.close(),O.set(Date.now())}catch(V){console.error("Failed to update preview content:",V)}}function D(N){const V=parseInt(N.width.replace("px","")),Y=parseInt(N.height.replace("px",""));return o(w)==="landscape"?{width:Y,height:V}:{width:V,height:Y}}function q(N){if(N.id==="desktop")return 1;try{if(!o(I))return 1;const V=o(I).getBoundingClientRect(),Y=Math.max(200,V.width-40),Q=Math.max(200,V.height-40),{width:me,height:j}=D(N),oe=Y/Q,ne=me/j;let we;return oe>ne?we=Q/j:we=Y/me,Math.min(Math.max(we,.1),2)}catch(V){return console.warn("Failed to calculate optimal scale:",V),1}}function R(N){y(m,N,!0);const V=p.find(Y=>Y.id===N);if(V&&o(C)){const Y=o(C).parentElement;V.id==="desktop"?(o(C).style.width="100%",o(C).style.height="100%",o(C).style.maxWidth="none",o(C).style.maxHeight="none",Y&&(Y.style.width="100%",Y.style.height="100%"),y(M,1)):setTimeout(()=>{if(o(C)){const Q=q(V),{width:me,height:j}=D(V);o(C).style.width=me+"px",o(C).style.height=j+"px",o(C).style.maxWidth=me+"px",o(C).style.maxHeight=j+"px",Y&&(Y.style.width=Math.round(me*Q)+"px",Y.style.height=Math.round(j*Q)+"px"),y(M,Q,!0)}},0)}}function T(N){return new Date(N).toLocaleTimeString()}function L(N){const V=o(k)?.contentDocument;if(!V)return 0;try{const Y=V.createTreeWalker(V.body,NodeFilter.SHOW_TEXT,null);let Q=0,me;for(;(me=Y.nextNode())&&!N.contains(me);)Q+=me.textContent?.length||0;return Q}catch(Y){return console.warn("Failed to estimate document position:",Y),0}}function F(N){if(!c())return;const V=N.target;if(!V)return;const Y=V.closest("p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th")||V,Q=Y.textContent?.trim();if(!(!Q||Q.length<8)&&!(Q.length>500))try{const me=L(Y),j=Y.tagName.toLowerCase();c()({text:Q,documentPosition:me,elementType:j})}catch(me){console.warn("Failed to handle preview click:",me)}}function ae(N){N.addEventListener("click",F);const V=N.createElement("style");V.textContent=`
      body {
        /* margin: 0; */
        /* padding: 0; */
        /* font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; */
        /* line-height: 1.6; */
      }

      /* Ensure images are responsive */
      img {
        max-width: 100%;
        height: auto;
      }

      /* Add some visual feedback for empty content */
      body:empty::before {
        content: 'No content to preview';
        color: #666;
        font-style: italic;
        display: block;
        text-align: center;
        padding: 2rem;
      }

      /* Indicate clickable text elements */
      p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th {
        cursor: pointer;
      }

      /* Visual feedback on hover */
      p:hover, h1:hover, h2:hover, h3:hover, h4:hover, h5:hover, h6:hover,
      div:hover, span:hover, li:hover, blockquote:hover, td:hover, th:hover {
        /* background-color: rgba(59, 130, 246, 0.1); */
        outline: 1px solid rgba(59, 130, 246, 0.3);
        outline-offset: 1px;
      }
    `,N.head.appendChild(V)}function B(){if(o(k)?.contentDocument){const N=o(k).contentDocument;ae(N),o(S)&&requestAnimationFrame(()=>{J(N,o(S).anchor,o(S).fallbackScrollTop),y(S,null)})}}let le=null;nn(()=>{R(o(m)),typeof ResizeObserver<"u"&&(le=new ResizeObserver(()=>{setTimeout(()=>{R(o(m))},400)}),o(I)&&le.observe(o(I)));const N=()=>{setTimeout(()=>R(o(m)),400)};return window.addEventListener("resize",N),()=>{le?.disconnect(),window.removeEventListener("resize",N)}});var Se=Cp(),ze=f(Se),xe=f(ze),Le=f(xe);let de;Le.__click=[dp,b,Z,s,R,m];var K=f(Le),X=g(xe,2),re=f(X);{var ge=N=>{var V=up();V.__click=[cp,w,R,m];var Y=f(V);U(()=>E(Y,o(w)==="portrait"?"▭":"▯")),x(N,V)};H(re,N=>{o(m)!=="desktop"&&N(ge)})}var Ae=g(re,2);Ae.__change=[fp,R],xt(Ae,21,()=>Object.entries(o(A)),It,(N,V)=>{var Y=se(()=>Co(o(V),2));let Q=()=>o(Y)[0],me=()=>o(Y)[1];var j=hp();xt(j,21,me,It,(oe,ne)=>{var we=pp(),ye={},Ie=f(we);U(Te=>{ye!==(ye=o(ne).id)&&(we.value=(we.__value=o(ne).id)??""),E(Ie,`${o(ne).icon??""}
                ${Te??""}`)},[()=>v(o(ne))]),x(oe,we)}),U(oe=>ve(j,"label",oe),[()=>h(Q())]),x(N,j)});var We=g(ze,2);{var Be=N=>{var V=vp();x(N,V)},pe=(N,V)=>{{var Y=me=>{var j=mp(),oe=g(f(j),2),ne=f(oe);U(()=>E(ne,`Transform failed: ${d().message??""}`)),x(me,j)},Q=(me,j)=>{{var oe=ne=>{var we=gp(),ye=g(f(we),2),Ie=f(ye);U(()=>E(Ie,`${u().length??""} warnings`)),x(ne,we)};H(me,ne=>{u().length>0&&ne(oe)},j)}};H(N,me=>{d()?me(Y):me(Q,!1)},V)}};H(We,N=>{l()?N(Be):N(pe,!1)})}var be=g(We,2),he=f(be);{var Ce=N=>{var V=wp(),Y=f(V),Q=f(Y);U(()=>{E(Q,s()||"\x3C!-- No content generated yet -->"),Y.dir=Y.dir}),x(N,V)},Oe=N=>{var V=Sp(),Y=f(V),Q=f(Y);let me,j;var oe=f(Q);{var ne=ye=>{var Ie=bp(),Te=f(Ie),Fe=g(f(Te),2),ce=g(f(Fe)),Re=g(Fe,2),$e=g(f(Re)),Pe=g(Re,2);{var _=G=>{var te=yp(),Ee=g(f(te),2),De=f(Ee);U(()=>E(De,d().stack)),x(G,te)};H(Pe,G=>{d().stack&&G(_)})}U(()=>{E(ce,` ${d().stage??""}`),E($e,` ${d().message??""}`)}),x(ye,Ie)},we=(ye,Ie)=>{{var Te=ce=>{var Re=_p();Ot(Re,$e=>y(k,$e),()=>o(k)),Ge("load",Re,B),x(ce,Re)},Fe=ce=>{var Re=xp();x(ce,Re)};H(ye,ce=>{s()?ce(Te):ce(Fe,!1)},Ie)}};H(oe,ye=>{d()?ye(ne):ye(we,!1)})}Ot(Q,ye=>y(C,ye),()=>o(C)),U(ye=>{me=nt(Q,1,"preview-frame-container svelte-32psnf",null,me,ye),j=ai(Q,"",j,{transform:o(m)!=="desktop"?`scale(${o(M)})`:"none","transform-origin":"top left"})},[()=>({"device-frame":o(m)!=="desktop"})]),x(N,V)};H(he,N=>{o(b)?N(Ce):N(Oe,!1)})}Ot(be,N=>y(I,N),()=>o(I));var Ve=g(be,2),tt=f(Ve),ct=f(tt);{var at=N=>{var V=Ep(),Y=f(V);U(Q=>E(Y,`Updated: ${Q??""}`),[()=>T(i())]),x(N,V)};H(ct,N=>{i()&&N(at)})}var fe=g(ct,2);{var ke=N=>{var V=kp(),Y=f(V);U(Q=>E(Y,`${Q??""}KB`),[()=>Math.round(s().length/1024)]),x(N,V)};H(fe,N=>{s()&&N(ke)})}var _e=g(fe,2);{var Ne=N=>{var V=Tp(),Y=f(V);U(()=>E(Y,`${u().length??""} warnings`)),x(N,V)};H(_e,N=>{u().length>0&&N(Ne)})}U((N,V)=>{de=nt(Le,1,"view-toggle svelte-32psnf",null,de,N),E(K,o(b)?"👁️":"📄"),ve(Ae,"aria-label",V)},[()=>({active:o(b)}),()=>n()("Select device preset")]),Ws(Ae,()=>o(m),N=>y(m,N)),x(r,Se),et(),a()}bt(["click","change"]);function Xi(r,e="Text"){return r.startsWith("../")||r.startsWith("./")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")||r.startsWith("/")?r:e&&e!==""?`../${r}`:r}function Ua(r,e="Text"){return!r.startsWith("../")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")?r:e&&e!==""&&r.startsWith("../")?r.substring(3):r}class Ip{constructor(e,t,a,n,i,s){this.workspaceId=e,this.fileStorage=t,this.extensionManager=a,this.blobURLManager=n,this.transformEngine=i,this.settingsService=s}async executeTransform(e,t=3e3){try{const a=await this.loadTransformScripts();return await this.transformEngine.setTransformScripts(a),await this.transformEngine.executeTransform(e,t)}catch(a){return{success:!1,error:{stage:"communication",message:String(a?.message||a)}}}}async loadTransformScripts(){try{const e={textTransform:"",domTransforms:[]};if(this.settingsService){const t=await this.settingsService.loadEPUBSettings(this.workspaceId);if(t.text_transform)try{e.textTransform=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${t.text_transform}`)}catch{console.warn(`Failed to load text transform script: ${t.text_transform}`)}if(t.dom_transforms&&t.dom_transforms.length>0){e.domTransforms=[];for(const a of t.dom_transforms)try{const n=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${a}`);e.domTransforms.push(n)}catch{console.warn(`Failed to load DOM transform script: ${a}`)}}}return e}catch(e){throw new Error(`Failed to load transform scripts: ${e instanceof Error?e.message:String(e)}`)}}async setDebugMode(e){try{await this.transformEngine.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async ping(e={}){return await this.transformEngine.ping({data:e})}cleanup(){}}class Pp{transformPipeline;debounceTimer;currentContent;isTransforming=!1;lastTransformTime=0;workspaceId;fileStorage;extensionManager;blobURLManager;workspaceService;settingsService;transformEngine;config;onPreviewUpdate;onError;spineItemId;spineItem;constructor(e,t,a,n,i,s,l,d,u,c,p,h){this.workspaceId=e,this.fileStorage=a,this.extensionManager=n,this.blobURLManager=i,this.workspaceService=s,this.settingsService=l,this.transformEngine=d,this.config=u,this.onPreviewUpdate=c,this.onError=p,this.spineItemId=t,this.spineItem=h,this.transformPipeline=new Ip(e,a,n,i,d,l),this.currentContent={text:""},this.blobURLManager.setActiveWorkspace(e)}async initialize(){await this.transformPipeline.loadTransformScripts()}updateContent(e,t){this.currentContent[e]=t,this.debounceRender()}async loadInitialContent(){try{try{this.currentContent.text=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/text/${this.spineItemId}.txt`)}catch{this.currentContent.text=""}this.debounceRender()}catch(e){this.handleError("initialization",e)}}getCurrentContent(){return{...this.currentContent}}debounceRender(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.renderPreview()},this.config.debounceMs)}async renderPreview(){if(this.isTransforming){this.debounceRender();return}this.isTransforming=!0;const e=performance.now();try{this.config.autoSave&&await this.autoSaveChangedContent();const t=await this.transformPipeline.executeTransform(this.currentContent.text,this.config.transformTimeout);if(!t.success){this.handleError("transform",t.error);return}const a=await this.generateChapterMetadata(),n=this.generateXHTML(t.html||"",a);this.config.persistToManifest&&await this.saveXHTMLToManifest(n);const i=await this.blobURLManager.processXHTMLForPreview(n),s=performance.now()-e;this.lastTransformTime=s,this.onPreviewUpdate({xhtml:i,warnings:t.warnings||[],executionTime:Math.round(s),timestamp:Date.now()})}catch(t){this.handleError("preview",t)}finally{this.isTransforming=!1}}async autoSaveChangedContent(){const e={success:!0,savedFiles:[],errors:[]},t={path:`SOURCE/text/${this.spineItemId}.txt`,content:this.currentContent.text,type:"text"};if(t.content.trim())try{await this.fileStorage.writeTextFile(this.workspaceId,t.path,t.content),e.savedFiles.push(t.path)}catch(a){e.success=!1,e.errors.push({file:t.path,error:a instanceof Error?a.message:String(a)})}return e}async saveXHTMLToManifest(e){try{const t=await this.workspaceService.loadWorkspace(this.workspaceId),a=t.opf.manifest.find(i=>i.id===this.spineItemId);if(!a){console.warn(`Manifest item not found for spine item: ${this.spineItemId}`);return}const n=this.resolveManifestPath(a.href,t.pathInfo.basePath);await this.workspaceService.writeFile(this.workspaceId,n,e),await this.updateSVGProperty(e,t,a)}catch(t){console.warn("Failed to save XHTML to manifest:",t)}}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}detectInlineSVG(e){try{return new DOMParser().parseFromString(e,"text/html").querySelectorAll("svg").length>0}catch(t){return console.warn("Failed to parse XHTML for SVG detection:",t),!1}}async updateSVGProperty(e,t,a){try{if(a.mediaType!=="application/xhtml+xml")return;const n=this.detectInlineSVG(e),i=a.properties||[],s=i.includes("svg");if(n&&!s)await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:[...i,"svg"]});else if(!n&&s){const l=i.filter(d=>d!=="svg");await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:l.length>0?l:void 0})}}catch(n){console.warn("Failed to update SVG property:",n)}}async generateChapterMetadata(){const e=this.spineItemId;let t="en";try{t=(await this.workspaceService.loadWorkspace(this.workspaceId))?.opf?.metadata?.language||"en"}catch(i){console.warn("Could not load workspace language, using default:",i)}const a=[],n=[];try{const i=await this.workspaceService.loadWorkspace(this.workspaceId);i.opf.manifest.filter(s=>s.mediaType==="text/css").forEach(s=>{a.push(s.href)}),i.opf.manifest.filter(s=>s.mediaType==="text/javascript"||s.mediaType==="application/javascript").forEach(s=>{n.push(s.href)})}catch{}return{title:e,language:t,stylesheets:a,scripts:n}}generateXHTML(e,t){const a=t.stylesheets.map(i=>`  <link rel="stylesheet" type="text/css" href="${this.escapeHtml(Xi(i))}" />`).join(`
`),n=t.scripts.map(i=>`  <script src="${this.escapeHtml(Xi(i))}"><\/script>`).join(`
`);return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="${this.escapeHtml(t.language)}" lang="${this.escapeHtml(t.language)}">
<head>
  <title>${this.escapeHtml(t.title)}</title>
${a}
${n}
</head>
<body>
${e}
</body>
</html>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}handleError(e,t){const a={stage:e,message:t?.message||(typeof t=="string"?t:"Unknown error"),stack:t?.stack};this.onError({error:a,stage:e,timestamp:Date.now()})}getStats(){return{isTransforming:this.isTransforming,lastTransformTime:this.lastTransformTime,contentLength:{text:this.currentContent.text.length}}}async forcePreviewUpdate(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),await this.renderPreview()}async setDebugMode(e){try{await this.transformPipeline.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async pingTransformPipeline(){try{return await this.transformPipeline.ping({timestamp:Date.now()}),!0}catch(e){return console.warn("Transform pipeline ping failed:",e),!1}}async switchToSpineItem(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.isTransforming=!1,this.lastTransformTime=0,this.spineItemId=e,this.spineItem=t,this.currentContent={text:""};try{await this.loadInitialContent()}catch(a){console.warn("Failed to load initial content for spine item switch:",a)}}cleanup(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.transformPipeline.cleanup(),this.blobURLManager.cleanup(),this.isTransforming=!1,this.lastTransformTime=0}}function Mp(r,e,t,a,n,i,s,l,d={},u,c,p){const v={...{debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0},...d};return new Pp(r,e,t,a,n,i,s,l,v,u,c,p)}const Lp={debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0};class _r extends Error{constructor(e,t){super(e),this.code=t,this.name="BlobURLError"}}class Vr extends _r{constructor(e,t){super(`Blob URL capacity exceeded: ${e}/${t}`,"CAPACITY_EXCEEDED")}}class Ji extends _r{constructor(e,t){super(e,"XHTML_PROCESSING_ERROR"),this.originalError=t}}class fo{activeWorkspaceId=null;registry;fileStorage;basePath;supportsDirectBlobs;onCapacityReached;constructor(e){this.fileStorage=e.fileStorage,this.basePath=e.basePath,this.onCapacityReached=e.onCapacityReached,this.registry={urls:new Map,created:new Map,count:0,maxCount:e.maxBlobURLs||100},this.supportsDirectBlobs=this.fileStorage.supportsDirectBlobURLs()}setActiveWorkspace(e){this.activeWorkspaceId!==e&&(this.cleanup(),this.activeWorkspaceId=e)}async createBlobURL(e){if(this.registry.count>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.registry.count,this.registry.maxCount);if(this.registry.urls.has(e))return this.registry.urls.get(e);if(!this.activeWorkspaceId)throw new _r("No active workspace set","NO_WORKSPACE");const t=this.resolveManifestPath(e);try{let a;const n=e.toLowerCase().endsWith(".css");if(this.supportsDirectBlobs&&!n){const i=await this.fileStorage.getFile(this.activeWorkspaceId,t),s=this.getMimeType(e),l=new File([i],i.name,{type:s});a=URL.createObjectURL(l)}else{let i;if(n){const d=await this.fileStorage.readTextFile(this.activeWorkspaceId,t),u=await this.processCSSFontURLs(d);i=new TextEncoder().encode(u).buffer}else i=await this.fileStorage.readFile(this.activeWorkspaceId,t);const s=this.getMimeType(e),l=new Blob([i],{type:s});a=URL.createObjectURL(l)}return this.addToRegistry(e,a),a}catch(a){throw new _r(`Failed to create blob URL for ${e}: ${a instanceof Error?a.message:String(a)}`,"CREATION_FAILED")}}createBlobFromContent(e,t){const a=new Blob([e],{type:t});return URL.createObjectURL(a)}async processXHTMLForPreview(e){if(this.isAtCapacity())throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);try{const a=new DOMParser().parseFromString(e,"application/xhtml+xml");if(a.documentElement&&a.documentElement.tagName==="parsererror")throw new Ji("Invalid XHTML content");const n=this.findAssetElements(a);for(const s of n)await this.processAssetElement(s);return new XMLSerializer().serializeToString(a)}catch(t){throw t instanceof _r?t:new Ji(`XHTML processing failed: ${t instanceof Error?t.message:String(t)}`,t instanceof Error?t:new Error(String(t)))}}revokeBlobURL(e){URL.revokeObjectURL(e),this.removeFromRegistry(e)}revokeFileBlob(e){const t=this.registry.urls.get(e);t&&this.revokeBlobURL(t)}cleanup(){for(const e of this.registry.urls.values())URL.revokeObjectURL(e);this.registry.urls.clear(),this.registry.created.clear(),this.registry.count=0}getMimeType(e){return lo(e)}isResourcePath(e){return!e.startsWith("http")&&!e.startsWith("data:")&&!e.startsWith("blob:")&&!e.startsWith("/")&&!e.startsWith("ftp:")&&!e.startsWith("mailto:")&&!e.startsWith("tel:")&&!e.startsWith("file:")&&!e.startsWith("about:")&&!e.startsWith("javascript:")&&!e.startsWith("//")&&e.trim().length>0}getBlobURLCount(){return this.registry.count}isAtCapacity(){return this.registry.count>=this.registry.maxCount}resolveManifestPath(e){return this.basePath?`${this.basePath}/${e}`:e}findAssetElements(e){const t=[],a=["script[src]","link[href]","a[href]","audio[src]","video[src]","video[poster]","img[src]","object[data]","image[href]","*[data-src]"];for(const n of a){const i=e.querySelectorAll(n);t.push(...Array.from(i))}return t}async processAssetElement(e){let t;if(e.hasAttribute("src"))t="src";else if(e.hasAttribute("href"))t="href";else if(e.hasAttribute("data"))t="data";else if(e.hasAttribute("poster"))t="poster";else if(e.hasAttribute("data-src"))t="data-src";else return;const a=e.getAttribute(t);if(!(!a||!this.isResourcePath(a)))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);const n=Ua(a),i=await this.createBlobURL(n);e.setAttribute(t,i)}catch(n){this.handleMissingAsset(e,a,n)}}handleMissingAsset(e,t,a){const n=e.tagName.toLowerCase(),i=Ua(t),s=this.resolveManifestPath(i);if(["img","video","audio","object","image"].includes(n)){console.warn(`Missing image: ${s} (referenced by <${n}> element)`);const l=e.hasAttribute("src")?"src":e.hasAttribute("href")?"href":"data";e.setAttribute(l,this.getErrorIconSVG()),e.setAttribute("alt",`Missing: ${t}`)}else["script","link"].includes(n)&&console.warn(`Missing asset: ${s} (referenced by <${n}> element)`)}getErrorIconSVG(){return`data:image/svg+xml,${encodeURIComponent(`
      <svg width="24" height="24" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" fill="#f44336" stroke="#d32f2f"/>
        <text x="12" y="16" text-anchor="middle" fill="white" font-size="12">!</text>
      </svg>
    `)}`}addToRegistry(e,t){this.registry.urls.set(e,t),this.registry.created.set(e,new Date),this.registry.count++}removeFromRegistry(e){for(const[t,a]of this.registry.urls.entries())if(a===e){this.registry.urls.delete(t),this.registry.created.delete(t),this.registry.count--;break}}async processCSSFontURLs(e){const t=/url\(\s*(['"]?)(.*?)\1\s*\)/g;let a=e;const n=Array.from(e.matchAll(t));for(const i of n){const s=i[0],l=i[1],d=i[2];if(this.isResourcePath(d))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);const u=Ua(d),c=await this.createBlobURL(u),p=`url(${l}${c}${l})`;a=a.replace(s,p)}catch(u){console.warn(`Failed to process CSS url(${d}):`,u)}}return a}getLoadedGlobals(){return{}}}class hr extends Error{constructor(e,t){super(e),this.code=t,this.name="SettingsServiceError"}}class Kn{constructor(e,t,a,n){this.fileStorage=e,this.extensionManager=t,this.themeStore=a,this.i18nStore=n}static GLOBAL_SETTINGS_KEY="editme_global_settings";static SUPPORTED_LOCALES=new Set(["en","de","ar","he","ja","ka","zh-hant","fr","es","it","pt","ru","pl","nl","sv"]);static VALID_THEMES=new Set(["light","dark","system"]);loadGlobalSettings(){try{if(typeof localStorage>"u")return this.getDefaultGlobalSettings();const e=localStorage.getItem(Kn.GLOBAL_SETTINGS_KEY);if(!e)return this.getDefaultGlobalSettings();const t=JSON.parse(e);if(typeof t!="object"||!t)return this.getDefaultGlobalSettings();const a=this.getDefaultGlobalSettings();return{theme:this.isValidTheme(t.theme)?t.theme:a.theme,locale:this.isValidLocale(t.locale)?t.locale:a.locale,editor_font_size:this.isValidFontSize(t.editor_font_size)?t.editor_font_size:a.editor_font_size}}catch{return this.getDefaultGlobalSettings()}}saveGlobalSettings(e){try{if(typeof localStorage>"u")return;localStorage.setItem(Kn.GLOBAL_SETTINGS_KEY,JSON.stringify(e)),e.theme==="system"?this.themeStore.useSystemPreference():this.themeStore.setTheme(e.theme),this.i18nStore.setLocale(e.locale)}catch(t){throw new hr(`Failed to save global settings: ${t instanceof Error?t.message:"Unknown error"}`,"GLOBAL_SETTINGS_SAVE_ERROR")}}getDefaultGlobalSettings(){return{theme:"system",locale:"en",editor_font_size:14}}async loadWorkspaceSettings(e){try{const t=await this.fileStorage.readTextFile(e,".workspace-metadata.json"),a=JSON.parse(t),n=this.getDefaultWorkspaceSettings();return{bust_cache:a.bust_cache??n.bust_cache,draft_id:a.draft_id??n.draft_id,editor:{preview_delay_ms:a.editor?.preview_delay_ms??n.editor.preview_delay_ms,advanced_mode:a.editor?.advanced_mode??n.editor.advanced_mode}}}catch{return this.getDefaultWorkspaceSettings()}}async saveWorkspaceSettings(e,t){try{let a={};try{const i=await this.fileStorage.readTextFile(e,".workspace-metadata.json");a=JSON.parse(i)}catch{}const n={...a,bust_cache:t.bust_cache,draft_id:t.draft_id,editor:t.editor};await this.fileStorage.writeTextFile(e,".workspace-metadata.json",JSON.stringify(n,null,2))}catch(a){throw new hr(`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`,"WORKSPACE_SETTINGS_SAVE_ERROR")}}getDefaultWorkspaceSettings(){return{bust_cache:!1,draft_id:0,editor:{preview_delay_ms:500,advanced_mode:!1}}}async loadEPUBSettings(e){try{const t=await this.fileStorage.readTextFile(e,"SOURCE/settings.json"),a=JSON.parse(t),n=this.getDefaultEPUBSettings();return{text_transform:a.text_transform??n.text_transform,dom_transforms:a.dom_transforms??n.dom_transforms,spine_basename:a.spine_basename??n.spine_basename,cover:a.cover?{template:a.cover.template??"default",background_color:a.cover.background_color??"#ffffff",text_color:a.cover.text_color??"#000000",font_family:a.cover.font_family??"serif"}:void 0}}catch{return this.getDefaultEPUBSettings()}}async saveEPUBSettings(e,t){try{await this.fileStorage.writeTextFile(e,"SOURCE/settings.json",JSON.stringify(t,null,2))}catch(a){throw new hr(`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_SETTINGS_SAVE_ERROR")}}getDefaultEPUBSettings(){return{text_transform:"SOURCE/scripts/transformText.js",dom_transforms:["SOURCE/scripts/transformDom.js"],spine_basename:"chapter"}}async incrementDraftId(e){const t=await this.loadWorkspaceSettings(e),a=t.draft_id+1;return await this.saveWorkspaceSettings(e,{...t,draft_id:a}),a}generateDraftTitle(e,t){return`${e} (Draft ${t})`}extractDraftInfo(e){const t=e.match(/^(.+?)\s+\(Draft\s+(\d+)\)$/);return t?{baseTitle:t[1],draftId:parseInt(t[2],10)}:{baseTitle:e,draftId:null}}async getAvailableTransforms(e){try{return await this.extensionManager.getAvailableTransforms(e)}catch(t){throw new hr(`Failed to get available transforms: ${t instanceof Error?t.message:"Unknown error"}`,"TRANSFORM_DISCOVERY_ERROR")}}async resolveTransformScripts(e,t){try{let a=null;const n=[];if(t.text_transform)try{a=await this.fileStorage.readTextFile(e,t.text_transform)}catch{}for(const i of t.dom_transforms)try{const s=await this.fileStorage.readTextFile(e,i);n.push(s)}catch{}return{textTransform:a,domTransforms:n}}catch(a){throw new hr(`Failed to resolve transform scripts: ${a instanceof Error?a.message:"Unknown error"}`,"TRANSFORM_RESOLUTION_ERROR")}}validateGlobalSettings(e){const t=[],a=[];return e.theme!==void 0&&!this.isValidTheme(e.theme)&&t.push(`Invalid theme: ${e.theme}`),e.locale!==void 0&&!this.isValidLocale(e.locale)&&a.push(`Unsupported locale: ${e.locale}`),e.editor_font_size!==void 0&&!this.isValidFontSize(e.editor_font_size)&&t.push("Font size must be between 8-32 pixels"),{isValid:t.length===0,errors:t,warnings:a}}validateWorkspaceSettings(e){const t=[],a=[];if(e.draft_id!==void 0&&(e.draft_id<0||!Number.isInteger(e.draft_id))&&t.push("Draft ID must be a non-negative integer"),e.editor){const{preview_delay_ms:n}=e.editor;n!==void 0&&(n<100||n>2e3)&&t.push("Preview delay must be between 100-2000ms")}return{isValid:t.length===0,errors:t,warnings:a}}validateEPUBSettings(e){const t=[],a=[];if(e.text_transform!==void 0&&e.text_transform&&(e.text_transform.startsWith("SOURCE/")||t.push("Text transform must start with SOURCE/")),e.dom_transforms!==void 0)for(const n of e.dom_transforms)n.startsWith("SOURCE/")||t.push(`DOM transform must start with SOURCE/: ${n}`);if(e.spine_basename!==void 0&&!e.spine_basename.trim()&&t.push("Spine basename cannot be empty"),e.cover){const{background_color:n,text_color:i}=e.cover;n&&!this.isValidColor(n)&&t.push("Invalid background color format"),i&&!this.isValidColor(i)&&t.push("Invalid text color format")}return{isValid:t.length===0,errors:t,warnings:a}}isValidTheme(e){return Kn.VALID_THEMES.has(e)}isValidLocale(e){return typeof e=="string"&&e.length>0}isValidFontSize(e){return typeof e=="number"&&e>=8&&e<=32&&Number.isInteger(e)}isValidColor(e){return/^#[0-9A-Fa-f]{6}$/.test(e)}}function Dp(r){let e=r;return e.endsWith(".js")&&(e=e.slice(0,-3)),e.endsWith(".min")&&(e=e.slice(0,-4)),e=e.replace(/[-@](?:v?\d+[\.\-]\d+|\d+[\.\-]\d+)(?:[\.\-]\w+)*$/i,""),Ga(e)}function Ga(r){return r.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function Rp(r){const e=r.name.toLowerCase();return e.endsWith(".js")?r.size===0?{isValid:!1,fileType:"javascript",error:"JavaScript file cannot be empty"}:r.size>50*1024*1024?{isValid:!1,fileType:"javascript",error:"JavaScript file too large (max 50MB)"}:{isValid:!0,fileType:"javascript"}:e==="license.txt"||e==="license"?r.size>1024*1024?{isValid:!1,fileType:"license",error:"License file too large (max 1MB)"}:{isValid:!0,fileType:"license"}:{isValid:!1,fileType:"unknown",error:"Invalid file type: only JavaScript (.js) and license files are supported"}}function Vn(r){const e=r.slice().sort((a,n)=>a.name.localeCompare(n.name)),t=r.reduce((a,n)=>a+n.size,0);return{files:e,totalSize:t}}function Xa(r,e){return r.totalSize!==e.totalSize||r.files.length!==e.files.length?!1:r.files.every((t,a)=>t.name===e.files[a].name&&t.size===e.files[a].size)}function zp(r){return!(!r||r.length===0||r.length>100||!/^[a-z0-9-]+$/.test(r)||r.startsWith("-")||r.endsWith("-")||/^-+$/.test(r))}const Ut="extensions-cache";class Up{constructor(e){this.fileStorage=e}async listCachedExtensions(){try{const e=await this.fileStorage.listFiles(Ut),t=new Set;for(const n of e){const i=n.split("/");i.length>=2&&t.add(i[0])}const a=[];for(const n of t)try{const i=await this.getExtensionInfo(n);a.push(i)}catch{}return a.sort((n,i)=>n.name.localeCompare(i.name))}catch(e){if(e instanceof Error&&e.message.includes("not found"))return[];throw e}}async getExtensionInfo(e){const a=(await this.fileStorage.listFiles(Ut)).filter(s=>s.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);const n=[];let i=0;for(const s of a){const l=s.split("/").pop(),u={size:(await this.fileStorage.readFile(Ut,s)).byteLength};let c;if(l.endsWith(".js"))c="javascript";else if(l.toLowerCase().includes("license"))c="license";else continue;n.push({filename:s.replace(`${e}/`,""),size:u.size,type:c}),i+=u.size}if(n.length===0)throw new Error(`Extension '${e}' has no valid files`);return{name:e,files:n,totalSize:i,location:"cache"}}async cacheExtension(e,t){if(await this.hasConflict(e,t))throw new Error(`Extension '${e}' already cached with different content`);for(const[n,i]of t.entries()){const s=`${e}/${n}`;await this.fileStorage.writeFile(Ut,s,i)}}async copyToWorkspace(e,t){const n=(await this.fileStorage.listFiles(Ut)).filter(i=>i.startsWith(e+"/"));if(n.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const i of n){const s=await this.fileStorage.readFile(Ut,i),l=`SOURCE/extensions/${i}`;await this.fileStorage.writeFile(t,l,s)}}async deleteExtension(e){const a=(await this.fileStorage.listFiles(Ut)).filter(n=>n.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const n of a)await this.fileStorage.deleteFile(Ut,n)}async hasConflict(e,t){try{const a=await this.getExtensionInfo(e),n=Vn(Array.from(t.keys()).map(s=>({name:s,size:t.get(s).byteLength}))),i=Vn(a.files.map(s=>({name:s.filename,size:s.size})));return!Xa(n,i)}catch{return!1}}async getExtensionSignature(e){try{const a=(await this.fileStorage.listFiles(Ut)).filter(i=>i.startsWith(e+"/"));if(a.length===0)return null;const n=[];for(const i of a){const s=i.split("/").pop();if(s.endsWith(".js")||s.toLowerCase().includes("license"))try{const l=await this.fileStorage.getFileInfo(Ut,i);n.push({name:s,size:l.size})}catch{const l=await this.fileStorage.readFile(Ut,i);n.push({name:s,size:l.byteLength})}}return Vn(n)}catch{return null}}async addToCache(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=new Map;for(const s of n){const l=s.replace(`SOURCE/extensions/${t}/`,""),d=await this.fileStorage.readFile(e,s);i.set(l,d)}await this.cacheExtension(t,i)}async removeFromCache(e){await this.deleteExtension(e)}get cacheWorkspaceId(){return Ut}async importFromCache(e,t){if((await this.fileStorage.listFiles(t)).some(i=>i.startsWith(`SOURCE/extensions/${e}/`)))throw new Error(`Extension '${e}' already exists in workspace`);await this.copyToWorkspace(e,t)}async deleteCachedExtension(e){await this.deleteExtension(e)}async isCached(e){try{return await this.getExtensionInfo(e),!0}catch{return!1}}async compareExtensions(e,t,a){try{const i=(await this.fileStorage.listFiles(e)).filter(c=>c.startsWith(`SOURCE/extensions/${t}/`)),l=(await this.fileStorage.listFiles(Ut)).filter(c=>c.startsWith(`${a}/`));if(i.length!==l.length)return!0;const d=await this.createWorkspaceSignature(e,t,i),u=await this.createCacheSignature(a,l);return!Xa(d,u)}catch{return!0}}async createWorkspaceSignature(e,t,a){const n=[];for(const i of a){const s=i.replace(`SOURCE/extensions/${t}/`,""),l=i.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license")){const d=await this.fileStorage.readFile(e,i);n.push({name:s,size:d.byteLength})}}return Vn(n)}async createCacheSignature(e,t){const a=[];for(const n of t){const i=n.replace(`${e}/`,""),s=n.split("/").pop();if(s.endsWith(".js")||s.toLowerCase().includes("license")){const l=await this.fileStorage.readFile(Ut,n);a.push({name:i,size:l.byteLength})}}return Vn(a)}async getCacheStats(){const e=await this.listCachedExtensions(),t={};for(const a of e)t[a.name]=a.files.length;return{totalExtensions:e.length,totalSize:e.reduce((a,n)=>a+n.totalSize,0),extensionCount:t}}}class _i{constructor(e){if(this.fileStorage=e,!e)throw new Error("FileStorageAPI is required");this.cache=new Up(e)}cache;get extensionCache(){return this.cache}async importExtension(e,t,a){const n=Ga(a);if(!zp(n))throw new Error(`Invalid extension name: '${a}' contains illegal characters`);const i=this.validateExtensionFile(t);if(!i.isValid)throw new Error(i.error);if((await this.listWorkspaceExtensions(e)).some(c=>c.name===n))throw new Error(`Extension '${n}' already exists in workspace`);const l=await t.arrayBuffer(),d=`SOURCE/extensions/${n}/${t.name}`;await this.fileStorage.writeFile(e,d,l);const u=new Map([[t.name,l]]);try{await this.cache.cacheExtension(n,u)}catch{}return{name:n,files:[{filename:t.name,size:t.size,type:i.fileType}],totalSize:t.size,location:"workspace"}}async addFileToExtension(e,t,a){const n=this.validateExtensionFile(a);if(!n.isValid)throw new Error(n.error);if(!(await this.listWorkspaceExtensions(e)).some(u=>u.name===t))throw new Error(`Extension '${t}' does not exist in workspace`);const s=`SOURCE/extensions/${t}/${a.name}`;if(await this.fileStorage.fileExists(e,s))throw new Error(`File '${a.name}' already exists in extension '${t}'`);const d=await a.arrayBuffer();await this.fileStorage.writeFile(e,s,d);try{const u=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,u)}catch{}}async listWorkspaceExtensions(e){try{const a=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith("SOURCE/extensions/")),n=new Set;for(const s of a){const l=s.split("/");l.length>=3&&n.add(l[2])}const i=[];for(const s of n)try{const l=await this.getWorkspaceExtensionInfo(e,s);i.push(l)}catch{}return i.sort((s,l)=>s.name.localeCompare(l.name))}catch(t){if(t instanceof Error&&t.message.includes("not found"))return[];throw t}}async deleteWorkspaceExtension(e,t){const n=(await this.fileStorage.listFiles(e)).filter(i=>i.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);for(const i of n)await this.fileStorage.deleteFile(e,i)}async listCachedExtensions(){return this.cache.listCachedExtensions()}async importFromCache(e,t){if(!(await this.cache.listCachedExtensions()).some(i=>i.name===t))throw new Error(`Extension '${t}' not found in cache`);if((await this.listWorkspaceExtensions(e)).some(i=>i.name===t))throw new Error(`Extension '${t}' already exists in workspace`);await this.cache.copyToWorkspace(t,e)}async deleteCachedExtension(e){await this.cache.deleteExtension(e)}async cacheExtension(e,t){if(!(await this.fileStorage.listFiles(e)).some(l=>l.startsWith(`SOURCE/extensions/${t}/`)))throw new Error(`Extension '${t}' does not exist in workspace`);const i=await this.cache.getExtensionSignature(t);if(i){const l=await this.getWorkspaceExtensionSignature(e,t);if(Xa(i,l))return;throw new Error(`Extension '${t}' already cached with different content`)}const s=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,s)}async scanAndCacheExtensions(e){const t=await this.listWorkspaceExtensions(e),a={successCount:0,totalScanned:t.length,conflicts:[],errors:[]};for(const n of t)try{const i=await this.getWorkspaceExtensionFiles(e,n.name);if(await this.cache.hasConflict(n.name,i)){a.conflicts.push(n.name);continue}await this.cache.cacheExtension(n.name,i),a.successCount++}catch(i){a.errors.push({extensionName:n.name,reason:"storage",message:i instanceof Error?i.message:"Unknown error"})}return a}detectExtensionName(e){return Dp(e)}validateExtensionFile(e){return Rp(e)}normalizeExtensionName(e){return Ga(e)}compareExtensions(e,t){const a=e.name||"unknown",n=t.name||"unknown";if(a!==n||e.totalSize!==t.totalSize||e.files.length!==t.files.length)return!1;const i=e.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name)),s=t.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name));return i.every((l,d)=>{const u=s[d],c=l.filename||l.name,p=u.filename||u.name;return c===p&&l.size===u.size})}sanitizeFilename(e){return e.replace(/\.\.\//g,"").replace(/\.\.\\/g,"").replace(/[<>:"/\\|?*\x00-\x1f]/g,"-").replace(/^\.+/,"").replace(/\.+$/,"").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255)}async getWorkspaceExtensionSignature(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];for(const s of n){const l=s.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license"))try{const d=await this.fileStorage.getFileInfo(e,s);i.push({name:l,size:d.size})}catch{const d=await this.fileStorage.readFile(e,s);i.push({name:l,size:d.byteLength})}}return Vn(i)}async getWorkspaceExtensionInfo(e,t){const n=(await this.fileStorage.listFiles(e)).filter(l=>l.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];let s=0;for(const l of n){const d=l.split("/").pop(),c={size:(await this.fileStorage.readFile(e,l)).byteLength};let p;if(d.endsWith(".js"))p="javascript";else if(d.toLowerCase().includes("license"))p="license";else continue;i.push({filename:d,size:c.size,type:p}),s+=c.size}return{name:t,files:i,totalSize:s,location:"workspace"}}async getWorkspaceExtensionFiles(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`)),i=new Map;for(const s of n){const l=s.split("/").pop(),d=await this.fileStorage.readFile(e,s);i.set(l,d)}return i}async getAvailableTransforms(e){const t=[];try{const a=await this.fileStorage.listFiles(e),n=a.filter(s=>s.startsWith("SOURCE/")&&s.endsWith(".js"));for(const s of n){const l=s.split("/").pop()||"";(l.includes("transform")||l.includes("Transform")||l==="transformText.js"||l==="transformDom.js")&&t.push({path:s,extensionName:`Transform: ${l}`,fileName:l})}const i=a.filter(s=>s.startsWith("SOURCE/extensions/")&&s.endsWith(".js")&&(s.includes("transform")||s.includes("Transform")));for(const s of i){const l=s.split("/"),d=l.pop()||"",u=l[2]||"Unknown Extension";t.push({path:s,extensionName:u,fileName:d})}}catch(a){console.warn("Failed to get available transforms:",a)}return t}}const Jr=new Set;let Ki=0;function po(r,e=""){if(Jr.has(r))throw new Error(`Editor ID "${r}" is already in use`);Jr.add(r);function t(){return Ki++,Date.now()+Ki*.001}const a=Jt({content:e,isEmpty:e.trim()==="",lastUpdated:t()}),n=[];function i(c){typeof c=="string"&&a.update(p=>({content:c,isEmpty:c.trim()==="",lastUpdated:t()}))}function s(){a.update(c=>({content:"",isEmpty:!0,lastUpdated:t()}))}function l(){let c="";return a.subscribe(h=>{c=h.content})(),c}function d(c){const p=a.subscribe(c);return n.push(p),()=>{p();const h=n.indexOf(p);h>-1&&n.splice(h,1)}}function u(){n.forEach(c=>c()),n.length=0,Jr.delete(r)}return{subscribe:d,updateContent:i,reset:s,getContent:l,destroy:u}}function Ap(){Jr.clear()}var Op=P('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>'),Wp=P('<div class="error-state svelte-19lb94x"><span class="error-icon svelte-19lb94x">⚠️</span> <p> </p></div>'),jp=P('<div class="empty-state svelte-19lb94x"><div class="empty-icon svelte-19lb94x">📚</div> <h3 class="svelte-19lb94x"> </h3> <p class="svelte-19lb94x"> </p></div>'),Bp=P('<div data-spine-view="" class="spine-editor-wrapper svelte-19lb94x"><!></div>'),Np=P('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>');function $p(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=()=>Ye(le,"$transformError",t),s=()=>Ye(B,"$transformWarnings",t),l=()=>Ye(Se,"$isTransforming",t),d=()=>Ye(ze,"$executionTime",t);let u=W(e,"workspace",8),c=W(e,"workspaceService",8),p=W(e,"spineService",8),h=W(e,"contentService",8),v=W(e,"selectedItemId",12,null),m=W(e,"transformEngine",8),w=je(null),b=je(!1),k=je(null),C,I,M,S,O,A=je(!1),$=je(null),J={text:""},Z=[],D=je([]),q=je([]),R=je(null),T=!1,L=je(),F=je({mode:"single",pane1:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""},pane2:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""}});const ae=Jt(""),B=Jt([]),le=Jt(null),Se=Jt(!1),ze=Jt(0);let xe=je(null),Le=je(null),de=new Map,K=je(null),X=je(null),re=je(null);const ge=Mt();function Ae(z){he(),v()&&ce()}function We(){}function Be(){return{selectedItemId:v(),selectedItem:o(w)}}function pe(z){z.selectedItemId&&(v(z.selectedItemId),ce())}async function be(){return!0}async function he(){if(!o(A))try{I=Dt.getInstance(),M=new _i(I),S=new fo({fileStorage:I,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),O=new Kn(I,M,ia,oo),y(A,!0)}catch(z){y(k,z instanceof Error?z.message:"Failed to initialize services"),console.error("Failed to initialize spine editor services:",z)}}function Ce(){if(o(F).mode==="single")y(D,Z),y(q,Z);else{const z=o(F).pane1.fileType==="text",ee=o(F).pane2.fileType==="text";y(D,Z.filter(ie=>!(ie.type==="text"&&ee))),y(q,Z.filter(ie=>!(ie.type==="text"&&z)))}}async function Oe(){if(!(!v()||!o(A)))try{const z=[{value:"text",label:"Text Content",path:`SOURCE/text/${v()}.txt`,href:`SOURCE/text/${v()}.txt`,type:"text"}];try{const ee=await I.listFiles(u().id,"OEBPS/Styles");for(const ie of ee)if(ie.endsWith(".css")){const Me=ie.split("/").pop()?.replace(".css","")||ie,He=ie.startsWith("OEBPS/")?ie.substring(6):ie;z.push({value:`css-${Me}`,label:`CSS: ${Me}`,path:ie,href:He,type:"css"})}}catch{}try{const ee=await I.listFiles(u().id,"OEBPS/Scripts");for(const ie of ee)if(ie.endsWith(".js")){const Me=ie.split("/").pop()?.replace(".js","")||ie,He=ie.startsWith("OEBPS/")?ie.substring(6):ie;z.push({value:`js-${Me}`,label:`JS: ${Me}`,path:ie,href:He,type:"javascript"})}}catch{}try{const ee=await I.listFiles(u().id,"SOURCE/scripts");for(const ie of ee)if(ie.endsWith(".js")){const Me=ie.split("/").pop()?.replace(".js","")||ie;z.push({value:`transform-${Me}`,label:`Transform: ${Me}`,path:ie,href:ie,type:"transform"})}}catch{}Z=z,Ce()}catch(z){console.error("Failed to load available files:",z),Z=[{value:"text",label:"Text Content",path:`SOURCE/text/${v()}.txt`,href:`SOURCE/text/${v()}.txt`,type:"text"}],Ce()}}async function Ve(z,ee,ie){const Me=z.path,He=`file-content-${Me.replace(/[^a-zA-Z0-9]/g,"-")}`;let Xe="";try{const dt=await ie.readFile(ee,Me);Xe=new TextDecoder().decode(dt)}catch{}const it=po(He,Xe);let vt;return it.subscribe(dt=>{o($)&&(clearTimeout(vt),vt=setTimeout(async()=>{try{await ie.writeFile(ee,z.path,dt.content),z.type==="text"?o($).updateContent("text",dt.content):["css","javascript","transform"].includes(z.type)&&(z.href&&S&&S.revokeFileBlob(z.href),o($).forcePreviewUpdate())}catch(Wt){console.error("Auto-save failed:",Wt)}},300))}),it}async function tt(z,ee,ie){try{const Me=z.path;if(de.has(Me))return de.get(Me);const He=await Ve(z,ee,ie);return de.has(Me)?(He.destroy(),de.get(Me)):(de.set(Me,He),He)}catch(Me){return console.error(`Failed to get/create file store for ${z.path}:`,Me),null}}async function ct(){if(!(!v()||!o(A)))try{if(await Oe(),!o(w)||o(w).id!==v()){console.warn("⚠️ Spine item synchronization issue:",{selectedItemId:v(),selectedItemActualId:o(w)?.id,selectedItem:o(w)});return}o($)?await o($).switchToSpineItem(v(),o(w)):(y($,Mp(u().id,v(),I,M,S,c(),O,m(),Lp,we,ye,o(w))),await o($).initialize(),await o($).loadInitialContent()),J=o($).getCurrentContent(),await at()}catch(z){y(k,z instanceof Error?z.message:"Failed to initialize spine editor"),console.error("Failed to initialize spine editor:",z)}}async function at(){if(Z.length===0)return;const z=yt.getViewData("spine");if(z&&(z.pane1||z.pane2))await oe(z);else{const ee=Z.find(ie=>ie.type==="text");if(ee){const ie=fe(ee.type);qe(F,o(F).mode="single"),qe(F,o(F).pane1={filePath:ee.path,fileHref:ee.href,fileType:ee.type,contentType:ie,selectedFileValue:ee.value,content:""}),console.warn("restoreOrInitializePaneContent bypassed loadFileIntoPane for text content"),j()}}o($)&&await o($).forcePreviewUpdate()}function fe(z){return z==="text"?"text":null}function ke(z){return z==="text"}async function _e(z){const{pane:ee,filePath:ie,fileType:Me}=z.detail,He=Z.find(rn=>rn.path===ie);if(!He)return;const Xe=He.href,it=He.value,vt=`pane${ee}`,dt=fe(Me);qe(F,o(F)[vt]={filePath:ie,fileHref:Xe,fileType:Me,contentType:dt,selectedFileValue:it,content:""}),y(ee===1?xe:Le,null),ee===2&&o(F).mode==="single"&&qe(F,o(F).mode="dual"),j();const Wt=await tt(He,u().id,c());Wt?y(ee===1?K:X,Wt):console.error("❌ Failed to create file store for:",ie),Ce()}function Ne(z){if(!z||z.trim()==="")return null;try{return new Function(z),null}catch(ee){return ee instanceof SyntaxError?`JavaScript syntax error: ${ee.message}`:`JavaScript validation error: ${ee instanceof Error?ee.message:String(ee)}`}}function N(z){const{pane:ee,content:ie}=z.detail,Me=`pane${ee}`;qe(F,o(F)[Me].content=ie);const{contentType:He,filePath:Xe,fileHref:it,fileType:vt}=o(F)[Me];if((vt.includes("javascript")||vt.includes("js")||vt==="transform")&&ie.trim()){const dt=Ne(ie);if(dt){y(ee===1?xe:Le,dt);return}else y(ee===1?xe:Le,null)}else y(ee===1?xe:Le,null);He&&o($)&&(J[He]=ie,o($).updateContent(He,ie)),Xe&&Q(Xe,it,ie)}async function V(){const z=o(F).mode==="single"?"dual":"single";if(z==="dual"){let ee=null;if(o(F).pane1.fileType==="text"&&o(F).pane2.fileType==="text"?(ee=Z.find(ie=>ie.type!=="text"),console.log("🔄 Text conflict resolved: moving pane 2 from text to",ee?.label||"empty")):(!o(F).pane2.selectedFileValue||o(F).pane2.selectedFileValue==="")&&(ee=Z[0]),ee){qe(F,o(F).pane2={selectedFileValue:ee.value,filePath:ee.path,fileType:ee.type,fileHref:ee.href,contentType:"text",content:""});try{const ie=await tt(ee,u().id,c());ie&&y(X,ie)}catch(ie){console.error("Failed to create store for pane 2 default selection:",ie)}}}qe(F,o(F).mode=z),j(),Ce()}let Y=new Map;function Q(z,ee,ie){const Me=Y.get(z);Me&&clearTimeout(Me);const He=setTimeout(async()=>{try{if(!me(z,ie))return;await I.writeTextFile(u().id,z,ie),S&&(z.includes("/Styles/")||z.includes("/Scripts/"))&&(S.revokeFileBlob(ee),o($)&&o($).forcePreviewUpdate())}catch{}finally{Y.delete(z)}},500);Y.set(z,He)}function me(z,ee){if(z.includes("SOURCE/text/")&&v()){const ie=`SOURCE/text/${v()}.txt`;if(z!==ie)return!1;if(ee.includes("chapter")||ee.includes("Chapter")){const Me=z.match(/chapter(\d+)/)?.[1];if(Me&&ee.toLowerCase().includes("chapter")&&!ee.toLowerCase().includes(`chapter ${Me}`)&&!ee.toLowerCase().includes(`chapter${Me}`))return!1}}return!0}function j(){const z={pane1:o(F).pane1.fileType?{fileType:o(F).pane1.fileType,selectedFile:o(F).pane1.filePath}:null,pane2:o(F).pane2.fileType?{fileType:o(F).pane2.fileType,selectedFile:o(F).pane2.filePath}:null,mode:o(F).mode};yt.setViewData("spine",z)}async function oe(z){qe(F,o(F).mode=z.mode),z.pane1&&await ne(1,z.pane1),z.pane2&&await ne(2,z.pane2)}async function ne(z,ee){const{fileType:ie,selectedFile:Me,content:He}=ee;let Xe;if(ie==="text"?Xe=Z.find(it=>it.type==="text"):Me?(Xe=Z.find(it=>it.path===Me),Xe||(Xe=Z.find(it=>it.type===ie))):Xe=Z.find(it=>it.type===ie),Xe){const it=fe(Xe.type),vt=`pane${z}`;qe(F,o(F)[vt]={filePath:Xe.path,fileHref:Xe.href,fileType:Xe.type,contentType:it,selectedFileValue:Xe.value,content:""});const dt=await tt(Xe,u().id,c());dt?y(z===1?K:X,dt):console.error("❌ Pane restoration failed - could not create store for:",Xe.path)}}function we(z){ae.set(z.xhtml),B.set(z.warnings),le.set(null),Se.set(!1),ze.set(z.executionTime),ge("previewUpdate",{xhtmlContent:z.xhtml,isTransforming:!1,transformError:null,transformWarnings:z.warnings,executionTime:z.executionTime,spineItemId:v()})}function ye(z){le.set(z.error),Se.set(!1),ge("previewUpdate",{xhtmlContent:"",isTransforming:!1,transformError:z.error,transformWarnings:[],executionTime:0,spineItemId:v()})}async function Ie(){if(o($)){Se.set(!0);try{await o($).forcePreviewUpdate()}catch(z){ye({error:{stage:"manual-update",message:z instanceof Error?z.message:"Manual update failed"}})}}}function Te(z){o(L)&&typeof o(L).findAndSelectText=="function"&&o(L).findAndSelectText(z.detail)}let Fe=null;async function ce(){if(!(!v()||!p())&&!T){if(Fe)try{await Fe}catch{}T=!0,Fe=Re();try{await Fe}finally{Fe=null,T=!1}}}async function Re(){y(b,!0),y(k,null);try{const ee=(await p().loadSpineItems(u())).find(Xe=>Xe.id===v())||null,ie=o(w)?.id,Me=ee?.id,He=ie&&Me&&ie!==Me;y(w,ee),o(w)&&o(A)&&(He?await $e():await ct())}catch(z){y(k,z instanceof Error?z.message:"Failed to load spine item")}finally{y(b,!1)}}async function $e(){try{await Oe(),await Pe(),await ct()}catch(z){y(k,z instanceof Error?z.message:"Failed to switch spine item")}}async function Pe(){for(const[z,ee]of Y)clearTimeout(ee);if(Y.clear(),JSON.parse(JSON.stringify(o(F))),o(F).pane1.fileType&&ke(o(F).pane1.fileType)){o(F).pane1.filePath;const z=`SOURCE/text/${v()}.txt`;qe(F,o(F).pane1.filePath=z),qe(F,o(F).pane1.fileHref=z)}if(o(F).pane2.fileType&&ke(o(F).pane2.fileType)){o(F).pane2.filePath;const z=`SOURCE/text/${v()}.txt`;qe(F,o(F).pane2.filePath=z),qe(F,o(F).pane2.fileHref=z)}}nn(()=>{C=yt.addNavigationGuard(be),Ae()}),sr(()=>{for(const[z,ee]of de)ee.destroy();de.clear(),C&&yt.removeNavigationGuard(C)}),ot(()=>(Ze(u()),o(re),Ze(m())),()=>{if(u()?.id&&(o(re)===null||u().id!==o(re))){for(const[z,ee]of de)ee.destroy();de.clear(),y(K,null),y(X,null),Ap(),m().setWorkspaceExtensions(u().id).catch(z=>{console.error("Failed to load workspace extensions:",z)})}y(re,u()?.id||null)}),ot(()=>(Ze(v()),o(R),Ze(u()),Ze(p()),o(A)),()=>{v()!==o(R)&&(y(R,v()),u()&&p()&&(o(A)||he(),v()?ce():(y(w,null),y(k,null),y($,null))))}),Pt(),wt();var _=ht(),G=Ke(_);{var te=z=>{var ee=Op(),ie=g(f(ee),2),Me=f(ie);U(He=>E(Me,He),[()=>n()("Loading spine item...")],ue),x(z,ee)},Ee=(z,ee)=>{{var ie=He=>{var Xe=Wp(),it=g(f(Xe),2),vt=f(it);U(()=>E(vt,o(k))),x(He,Xe)},Me=(He,Xe)=>{{var it=dt=>{var Wt=jp(),rn=g(f(Wt),2),or=f(rn),Qt=g(rn,2),Vt=f(Qt);U((kn,Tt)=>{E(or,kn),E(Vt,Tt)},[()=>n()("No spine item selected"),()=>n()("Select a spine item from the sidebar to start editing")],ue),x(dt,Wt)},vt=(dt,Wt)=>{{var rn=Qt=>{var Vt=Bp(),kn=f(Vt);Ot(lp(kn,{get availableFiles1(){return o(D)},get availableFiles2(){return o(q)},get transformError(){return i()},get transformWarnings(){return s()},get isTransforming(){return l()},get executionTime(){return d()},get editorMode(){return o(F).mode},get pane1SelectedFile(){return o(F).pane1.selectedFileValue},get pane2SelectedFile(){return o(F).pane2.selectedFileValue},get pane1FileStore(){return o(K)},get pane2FileStore(){return o(X)},get contentService(){return h()},onPaneToggle:()=>V(),onFileSelect:(Tt,Tn,Ar)=>_e({detail:{pane:Tt,filePath:Tn,fileType:Ar}}),onContentChange:(Tt,Tn)=>N({detail:{pane:Tt,content:Tn}}),onForceUpdate:()=>Ie(),get pane1Error(){return o(xe)},set pane1Error(Tt){y(xe,Tt)},get pane2Error(){return o(Le)},set pane2Error(Tt){y(Le,Tt)},$$legacy:!0}),Tt=>y(L,Tt),()=>o(L)),Ge("preview-click",Vt,Te),x(Qt,Vt)},or=Qt=>{var Vt=Np(),kn=g(f(Vt),2),Tt=f(kn);U(Tn=>E(Tt,Tn),[()=>n()("Initializing editor...")],ue),x(Qt,Vt)};H(dt,Qt=>{o(w)&&o(A)&&o($)?Qt(rn):Qt(or,!1)},Wt)}};H(He,dt=>{v()?dt(vt,!1):dt(it)},Xe)}};H(z,He=>{o(k)?He(ie):He(Me,!1)},ee)}};H(G,z=>{o(b)?z(te):z(Ee,!1)})}x(r,_),Ft(e,"onViewEnter",Ae),Ft(e,"onViewLeave",We),Ft(e,"getViewData",Be),Ft(e,"setViewData",pe),Ft(e,"canLeave",be);var De=et({onViewEnter:Ae,onViewLeave:We,getViewData:Be,setViewData:pe,canLeave:be});return a(),De}async function Hp(r,e,t,a){if(!e.workspaceId||!o(t))return;const i=r.target.checked,s={...o(t),editor:{preview_delay_ms:o(t).editor?.preview_delay_ms??500,advanced_mode:i}};y(t,s,!0);try{await e.settingsService.saveWorkspaceSettings(e.workspaceId,s),e.onSettingsChanged?.()}catch(l){y(a,l instanceof Error?l.message:"Failed to save settings",!0),y(t,{...o(t),editor:{preview_delay_ms:o(t).editor?.preview_delay_ms??500,advanced_mode:!i}},!0)}}var Vp=P('<p class="no-workspace-message svelte-1cp4vip">Please select a workspace to configure settings.</p>'),qp=P('<p class="loading-message svelte-1cp4vip">Loading settings...</p>'),Gp=P('<div class="error-message svelte-1cp4vip" role="alert"><strong>Error:</strong> </div>'),Xp=P("<p>Loading extensions...</p>"),Jp=P("<p>No extensions installed.</p>"),Kp=(r,e,t)=>e(o(t).name),Yp=P('<li class="extension-item svelte-1cp4vip"><span class="extension-name svelte-1cp4vip"> </span> <button type="button" class="svelte-1cp4vip">Remove</button></li>'),Zp=P('<ul class="extensions-list svelte-1cp4vip"></ul>'),Qp=P('<div class="settings-content svelte-1cp4vip"><section class="workspace-settings svelte-1cp4vip"><h2 class="svelte-1cp4vip">Project Settings</h2> <div class="setting-group svelte-1cp4vip"><label class="setting-label svelte-1cp4vip"><input type="checkbox" class="svelte-1cp4vip"/> <span class="setting-text svelte-1cp4vip">Advanced Mode</span></label> <p class="setting-description svelte-1cp4vip">Enable advanced editing features and additional controls for power users.</p></div></section> <section class="extensions-settings svelte-1cp4vip"><h2 class="svelte-1cp4vip">Extensions</h2> <div class="extension-import svelte-1cp4vip"><label for="extension-file" class="svelte-1cp4vip">Import JavaScript Extension:</label> <input id="extension-file" type="file" accept=".js" class="svelte-1cp4vip"/></div> <!></section></div>'),eh=P('<div class="settings-view svelte-1cp4vip"><div class="settings-header svelte-1cp4vip"><h1 class="svelte-1cp4vip">Settings</h1> <!></div> <!> <!></div>');function th(r,e){Qe(e,!0);let t=Ue(null),a=Ue(!1),n=Ue(null),i=Ue(Ct([])),s=Ue(!1);kt(()=>{if(!e.workspaceId||!e.settingsService)return;(async()=>{y(a,!0),y(n,null);try{y(t,await e.settingsService.loadWorkspaceSettings(e.workspaceId),!0)}catch(S){y(n,S instanceof Error?S.message:"Failed to load settings",!0),y(t,e.settingsService.getDefaultWorkspaceSettings(),!0)}finally{y(a,!1)}})()}),kt(()=>{if(!e.workspaceId)return;(async()=>{y(s,!0);try{y(i,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0)}catch(S){console.error("Failed to load extensions:",S),y(i,[],!0)}finally{y(s,!1)}})()});async function l(M){const S=M.target,O=S.files?.[0];if(!(!O||!e.workspaceId))try{const A=e.extensionManager.detectExtensionName(O.name);await e.extensionManager.importExtension(e.workspaceId,O,A),y(i,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId),S.value=""}catch(A){console.error("Failed to import extension:",A),y(n,A instanceof Error?A.message:"Failed to import extension",!0)}}async function d(M){if(e.workspaceId)try{await e.extensionManager.deleteWorkspaceExtension(e.workspaceId,M),y(i,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId)}catch(S){console.error("Failed to remove extension:",S),y(n,S instanceof Error?S.message:"Failed to remove extension",!0)}}const u=se(()=>o(t)?.editor?.advanced_mode??!1),c=se(()=>e.workspaceId!==null&&o(t)!==null);var p=eh(),h=f(p),v=g(f(h),2);{var m=M=>{var S=Vp();x(M,S)},w=(M,S)=>{{var O=A=>{var $=qp();x(A,$)};H(M,A=>{o(a)&&A(O)},S)}};H(v,M=>{e.workspaceId?M(w,!1):M(m)})}var b=g(h,2);{var k=M=>{var S=Gp(),O=g(f(S));U(()=>E(O,` ${o(n)??""}`)),x(M,S)};H(b,M=>{o(n)&&M(k)})}var C=g(b,2);{var I=M=>{var S=Qp(),O=f(S),A=g(f(O),2),$=f(A),J=f($);J.__change=[Hp,e,t,n];var Z=g(O,2),D=g(f(Z),2),q=g(f(D),2);q.__change=l;var R=g(D,2);{var T=F=>{var ae=Xp();x(F,ae)},L=(F,ae)=>{{var B=Se=>{var ze=Jp();x(Se,ze)},le=Se=>{var ze=Zp();xt(ze,21,()=>o(i),It,(xe,Le)=>{var de=Yp(),K=f(de),X=f(K),re=g(K,2);re.__click=[Kp,d,Le],U(()=>{E(X,o(Le).name),re.disabled=o(s)}),x(xe,de)}),x(Se,ze)};H(F,Se=>{o(i).length===0?Se(B):Se(le,!1)},ae)}};H(R,F=>{o(s)?F(T):F(L,!1)})}U(()=>{Ns(J,o(u)),J.disabled=o(a),q.disabled=o(s)}),x(M,S)};H(C,M=>{o(c)&&M(I)})}x(r,p),et()}bt(["change","click"]);function nh(r,e){(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e()())}var rh=P('<div><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M2 5h12v1H2zm0 5h12v1H2z"></path></svg></div>'),ah=(r,e)=>{r.stopPropagation(),e()()},ih=(r,e)=>{r.stopPropagation(),e(r)},sh=(r,e)=>{r.stopPropagation(),e()()},oh=(r,e)=>{r.stopPropagation(),e(r)},lh=P('<div class="move-buttons svelte-7qzgln" aria-label="Reorder controls"><button class="move-button svelte-7qzgln">↑</button> <button class="move-button svelte-7qzgln">↓</button></div>'),ch=P('<span class="error-indicator svelte-7qzgln" aria-label="Validation error">⚠️</span>'),dh=P('<div role="button" tabindex="0"><!> <span class="chapter-id svelte-7qzgln"> </span> <!> <!></div>');function uh(r,e){Qe(e,!1);const t=je(),a=je();let n=W(e,"item",8);const i=0;let s=W(e,"isSelected",8,!1),l=W(e,"isExpanded",8,!0),d=W(e,"compact",8,!1),u=W(e,"dragHandleProps",24,()=>({})),c=W(e,"isFirstItem",8,!1),p=W(e,"isLastItem",8,!1),h=W(e,"onSelect",8),v=W(e,"onMoveUp",8),m=W(e,"onMoveDown",8);async function w(q){if(q.key==="Enter"||q.key===" "){q.preventDefault(),await v()();const R=document.querySelector(`[aria-label="Move ${n().id} up"]`);R&&R.focus()}}async function b(q){if(q.key==="Enter"||q.key===" "){q.preventDefault(),await m()();const R=document.querySelector(`[aria-label="Move ${n().id} down"]`);if(R&&!R.disabled)R.focus();else{const T=document.querySelector(`[aria-label="Move ${n().id} up"]`);T&&T.focus()}}}function k(q){const R=q.match(/^(\w+)[-_]?(\d+)$/i);if(R){const[,F,ae]=R;return F.charAt(0).toUpperCase()+ae}const T=q.split(/[\s\-_]+/).filter(F=>F.length>0);if(T.length>1)return T.map(F=>F.charAt(0).toUpperCase()).join("");const L=q.trim();return L.length<=3?L.toUpperCase():L.length<=6?L.slice(0,3):L.slice(0,2)}ot(()=>(Ze(s()),Ze(d())),()=>{y(t,s()&&!d())}),ot(()=>(Ze(d()),Ze(n())),()=>{y(a,d()?k(n().id):n().id)}),Pt(),wt();var C=dh();let I;C.__click=function(...q){h()?.apply(this,q)},C.__keydown=[nh,h];var M=f(C);{var S=q=>{var R=rh();ya(R,()=>({class:"drag-handle",...u(),tabindex:"-1","aria-hidden":"true"}),void 0,"svelte-7qzgln"),x(q,R)};H(M,q=>{!d()&&l()&&q(S)})}var O=g(M,2),A=f(O),$=g(O,2);{var J=q=>{var R=lh(),T=f(R);T.__click=[ah,v],T.__keydown=[ih,w];var L=g(T,2);L.__click=[sh,m],L.__keydown=[oh,b],U(()=>{T.disabled=c(),ve(T,"aria-label",`Move ${n().id} up`),ve(T,"title",`Move ${n().id} up`),L.disabled=p(),ve(L,"aria-label",`Move ${n().id} down`),ve(L,"title",`Move ${n().id} down`)}),x(q,R)};H($,q=>{o(t)&&q(J)})}var Z=g($,2);{var D=q=>{var R=ch();x(q,R)};H(Z,q=>{!d()&&(!n().hasSourceFile||!n().linear)&&q(D)})}return U(q=>{I=nt(C,1,"spine-item svelte-7qzgln",null,I,q),ve(C,"aria-pressed",s()),ve(C,"aria-label",`${n().id}${n().hasSourceFile?"":", has validation error"}`),E(A,o(a))},[()=>({compact:d(),selected:s(),"has-error":n().hasSourceFile===!1||!n().linear})],ue),x(r,C),Ft(e,"index",i),et({index:i})}bt(["click","keydown"]);async function fh(r,e,t,a,n){if(!(!e()||!t()))try{y(a,!0),await t()(e().id)}catch(i){console.error("Failed to package EPUB:",i),alert(n()("Failed to package EPUB: {error}",{error:i instanceof Error?i.message:"Unknown error"}))}finally{y(a,!1)}}var ph=P('<div class="loading svelte-1d5i0rj"><p> </p></div>'),hh=P('<div class="error svelte-1d5i0rj"><p> </p> <button class="retry-button svelte-1d5i0rj"> </button></div>'),vh=P('<div class="spine-item-wrapper svelte-1d5i0rj" role="listitem"><!></div>'),mh=P('<div class="spine-list svelte-1d5i0rj" role="list"></div>'),gh=P('<div class="empty-state svelte-1d5i0rj"><p> </p> <button class="retry-button svelte-1d5i0rj"> </button></div>'),wh=P('<div class="empty-state svelte-1d5i0rj"><p> </p></div>'),yh=P('<div class="package-epub-section svelte-1d5i0rj"><button class="package-epub-button svelte-1d5i0rj"><!></button></div>'),bh=P('<div class="spine-sidebar svelte-1d5i0rj"><!> <!></div>');function _h(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=je();let s=W(e,"workspace",12,null),l=W(e,"spineService",8),d=W(e,"selectedItemId",8,null),u=W(e,"isExpanded",8,!0),c=W(e,"onWorkspaceUpdate",8,null),p=W(e,"onPackageRequested",8,null),h=je([]),v=je(!0),m=je(null),w=!1,b=je(!1);nn(()=>{const B=()=>{M()};return window.addEventListener("append-spine-item",B),()=>{window.removeEventListener("append-spine-item",B)}});async function k(){s()&&l()&&await C()}async function C(){if(s()){y(v,!0),y(m,null);try{const B=await l().loadSpineItems(s());y(h,B)}catch(B){console.error("❌ SpineSidebar: Error loading spine items:",B),y(m,B instanceof Error?B.message:"Failed to load spine items"),y(h,[])}finally{y(v,!1)}}}function I(B){const le=new CustomEvent("select-spine-item",{detail:{itemId:B},bubbles:!0});window.dispatchEvent(le)}async function M(){if(s())try{y(v,!0);const B=await l().addChapter(s(),{title:"New Chapter",linear:!0,createSourceFile:!0});s(B.updatedWorkspace),c()&&c()(s()),await C(),I(B.newChapter.id)}catch(B){y(m,B instanceof Error?B.message:"Failed to create chapter")}finally{y(v,!1)}}async function S(B){if(!(w||B===0||!s())){w=!0;try{const le=await l().moveChapterUp(s(),B);s(le.updatedWorkspace),c()&&c()(s()),y(h,le.newOrder),A(o(h)[B-1].id,B,B-1)}catch{await C()}finally{w=!1}}}async function O(B){if(!(w||B===o(h).length-1||!s())){w=!0;try{const le=await l().moveChapterDown(s(),B);s(le.updatedWorkspace),c()&&c()(s()),y(h,le.newOrder),A(o(h)[B+1].id,B,B+1)}catch{await C()}finally{w=!1}}}function A(B,le,Se){const ze=`${B} moved from position ${le+1} to position ${Se+1}`,xe=document.createElement("div");xe.setAttribute("role","status"),xe.setAttribute("aria-live","polite"),xe.style.position="absolute",xe.style.left="-10000px",xe.textContent=ze,document.body.appendChild(xe),setTimeout(()=>xe.remove(),1e3)}function $(B,le){o(i)&&(B.dataTransfer.effectAllowed="move",B.dataTransfer.setData("text/plain",le.toString()))}function J(B){o(i)&&(B.preventDefault(),B.dataTransfer.dropEffect="move")}async function Z(B,le){if(!o(i)||w)return;B.preventDefault();const Se=parseInt(B.dataTransfer.getData("text/plain"),10);if(Se!==le&&s()){w=!0;try{const ze=await l().reorderItems(s(),Se,le);s(ze.updatedWorkspace),c()&&c()(s()),y(h,ze.newOrder),A(o(h)[le].id,Se,le)}catch{await C()}finally{w=!1}}}ot(()=>Ze(u()),()=>{y(i,u())}),ot(()=>(Ze(s()),Ze(l())),()=>{s()&&l()?C():s()||(y(h,[]),y(v,!1),y(m,null))}),Pt(),wt();var D=bh(),q=f(D);{var R=B=>{var le=ph(),Se=f(le),ze=f(Se);U(xe=>E(ze,xe),[()=>n()("Loading spine items…")],ue),x(B,le)},T=(B,le)=>{{var Se=xe=>{var Le=hh(),de=f(Le),K=f(de),X=g(de,2);X.__click=C;var re=f(X);U(ge=>{E(K,o(m)),E(re,ge)},[()=>n()("Retry")],ue),x(xe,Le)},ze=(xe,Le)=>{{var de=X=>{var re=mh();xt(re,7,()=>o(h),ge=>ge.id,(ge,Ae,We)=>{var Be=vh(),pe=f(Be);const be=ue(()=>d()===o(Ae).id),he=ue(()=>!u()),Ce=ue(()=>o(We)===0),Oe=ue(()=>o(We)===o(h).length-1);uh(pe,{get item(){return o(Ae)},get index(){return o(We)},get isSelected(){return o(be)},get isExpanded(){return o(i)},get compact(){return o(he)},get isFirstItem(){return o(Ce)},get isLastItem(){return o(Oe)},onSelect:()=>I(o(Ae).id),onMoveUp:async()=>await S(o(We)),onMoveDown:async()=>await O(o(We)),dragHandleProps:{draggable:!0,"data-drag-handle":!0}}),U(()=>ve(Be,"draggable",o(i))),Ge("dragstart",Be,Ve=>$(Ve,o(We))),Ge("dragover",Be,J),Ge("drop",Be,Ve=>Z(Ve,o(We))),x(ge,Be)}),x(X,re)},K=(X,re)=>{{var ge=We=>{var Be=gh(),pe=f(Be),be=f(pe),he=g(pe,2);he.__click=C;var Ce=f(he);U((Oe,Ve)=>{E(be,Oe),E(Ce,Ve)},[()=>n()("No spine items yet"),()=>n()("Refresh")],ue),x(We,Be)},Ae=We=>{var Be=wh(),pe=f(Be),be=f(pe);U(he=>E(be,he),[()=>n()("No project selected")],ue),x(We,Be)};H(X,We=>{s()&&!o(v)?We(ge):We(Ae,!1)},re)}};H(xe,X=>{o(h).length>0?X(de):X(K,!1)},Le)}};H(B,xe=>{o(m)?xe(Se):xe(ze,!1)},le)}};H(q,B=>{o(v)?B(R):B(T,!1)})}var L=g(q,2);{var F=B=>{var le=yh(),Se=f(le);Se.__click=[fh,s,p,b,n];var ze=f(Se);{var xe=de=>{var K=Et();U(X=>E(K,X),[()=>n()("Packaging...")],ue),x(de,K)},Le=de=>{var K=Et();U(X=>E(K,X),[()=>n()("Package EPUB")],ue),x(de,K)};H(ze,de=>{o(b)?de(xe):de(Le,!1)})}U(de=>{Se.disabled=o(b),ve(Se,"title",de)},[()=>n()("Package EPUB")],ue),x(B,le)};H(L,B=>{s()&&B(F)})}x(r,D),Ft(e,"refreshSpineItems",k);var ae=et({refreshSpineItems:k});return a(),ae}bt(["click"]);const xh=(r,e)=>{const t=r.target;y(e,t.value)},Sh=(r,e)=>{o(e)?.click()},Eh=(r,e)=>{e("itemCreate",{mode:"create-text"})},kh=(r,e,t,a)=>{e()&&t()==="manifest"&&a("itemEdit",{item:e()})},Th=(r,e)=>{y(e,"")};var Ch=P('<button type="button" class="clear-filter-button svelte-8hsxjr">×</button>'),Fh=P('<div class="drag-overlay svelte-8hsxjr"><div class="drag-message svelte-8hsxjr"><p class="svelte-8hsxjr"> </p></div></div>'),Ih=P('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),Ph=P('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),Mh=P('<div class="empty-state svelte-8hsxjr"><!></div>'),Lh=(r,e)=>e("id"),Dh=(r,e)=>e("href"),Rh=(r,e)=>e("size"),zh=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr"> </span></div></td></tr>'),Uh=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Source Files</span></div></td></tr>'),Ah=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Package Files</span></div></td></tr>'),Oh=(r,e,t,a)=>e(o(t),o(a)),Wh=(r,e,t,a)=>e(r,o(t),o(a)),jh=P('<span class="property-tag svelte-8hsxjr"> </span>'),Bh=P('<div class="properties-list svelte-8hsxjr"></div>'),Nh=P('<!> <!> <!> <tr tabindex="0"><td class="id-cell svelte-8hsxjr"><span class="item-id svelte-8hsxjr" dir="ltr"> </span></td><td class="href-cell svelte-8hsxjr"><span class="item-href svelte-8hsxjr" dir="ltr"> </span></td><td class="size-cell svelte-8hsxjr"> </td><td class="properties-cell svelte-8hsxjr"><!></td><!></tr>',1),$h=P('<table class="manifest-table svelte-8hsxjr"><thead><tr><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"> </th></tr></thead><tbody></tbody></table>'),Hh=P('<div class="manifest-table-container svelte-8hsxjr"><div role="toolbar" tabindex="0"><div class="filter-section svelte-8hsxjr"><label for="manifest-filter" class="filter-label svelte-8hsxjr"> </label> <div class="filter-input-container svelte-8hsxjr"><input id="manifest-filter" type="text" class="filter-input svelte-8hsxjr"/> <!></div></div> <div class="action-buttons svelte-8hsxjr"><button type="button" class="action-button secondary svelte-8hsxjr"> </button> <button type="button" class="action-button primary svelte-8hsxjr"> </button> <button type="button" class="action-button secondary svelte-8hsxjr"> </button></div> <input type="file" multiple accept="*/*" style="display: none;"/> <!></div> <div class="table-container svelte-8hsxjr"><!></div></div>');function Vh(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t),i=je(),s=je(),l=je();let d=W(e,"manifestItems",24,()=>[]),u=W(e,"sourceItems",24,()=>[]),c=W(e,"advancedMode",8,!0),p=W(e,"validationErrors",24,()=>[]),h=W(e,"selectedItem",8,null),v=W(e,"selectedItemType",8,null),m=W(e,"loading",8,!1);const w=Mt();let b=je(""),k=je(!1),C=je(),I=je("id"),M=je("asc");const S=fe=>{o(I)===fe?y(M,o(M)==="asc"?"desc":"asc"):(y(I,fe),y(M,"asc"))},O=(fe,ke)=>{w("itemSelect",{item:fe,type:ke==="source-zip"?"source":ke})},A=(fe,ke,_e)=>{(fe.key==="Enter"||fe.key===" ")&&(fe.preventDefault(),O(ke,_e))},$=(fe,ke)=>{if(!h())return!1;const _e=ke==="source-zip"?"source":ke;return v()!==_e?!1:ke==="manifest"?fe.id===h().id:fe.path===h().path},J=fe=>p().filter(ke=>ke.itemId===fe.id),Z=fe=>J(fe).length>0,D=fe=>{if(!fe)return"-";const ke=["B","KB","MB","GB"];let _e=fe,Ne=0;for(;_e>=1024&&Ne<ke.length-1;)_e/=1024,Ne++;return`${_e.toFixed(Ne===0?0:1)} ${ke[Ne]}`},q=fe=>o(I)!==fe?"↕":o(M)==="asc"?"↑":"↓",R=fe=>{const ke=fe.target;ke.files&&ke.files.length>0&&(w("fileUpload",{files:ke.files}),ke.value="")},T=fe=>{fe.preventDefault(),y(k,!0)},L=fe=>{fe.preventDefault(),y(k,!1)},F=fe=>{fe.preventDefault(),y(k,!1),fe.dataTransfer?.files&&fe.dataTransfer.files.length>0&&w("fileUpload",{files:fe.dataTransfer.files})};ot(()=>(Ze(d()),Ze(c()),Ze(u())),()=>{y(i,[...d().map(fe=>({...fe,_type:"manifest"})),{name:"content.opf",path:"content.opf",size:void 0,_type:"opf"},...c()?u().map(fe=>({...fe,_type:"source"})):[],...c()?[]:[{name:"SOURCE.zip",path:"SOURCE.zip",size:void 0,_type:"source-zip",isPlaceholder:!0}]])}),ot(()=>(o(i),o(b)),()=>{y(s,o(i).filter(fe=>{if(!o(b))return!0;const ke=o(b).toLowerCase();if(fe._type==="manifest"){const _e=fe;return _e.id.toLowerCase().includes(ke)||_e.href.toLowerCase().includes(ke)||_e.properties?.some(Ne=>Ne.toLowerCase().includes(ke))||!1}else if(fe._type==="source"){const _e=fe;return _e.name.toLowerCase().includes(ke)||_e.path.toLowerCase().includes(ke)}else if(fe._type==="source-zip"){const _e=fe;return _e.name.toLowerCase().includes(ke)||_e.path.toLowerCase().includes(ke)}else{const _e=fe;return _e.name.toLowerCase().includes(ke)||_e.path.toLowerCase().includes(ke)}}))}),ot(()=>(o(s),o(I),o(M)),()=>{y(l,(()=>{const fe=o(s).filter(V=>V._type==="manifest"),ke=o(s).filter(V=>V._type==="source"),_e=o(s).filter(V=>V._type==="source-zip"),Ne=o(s).filter(V=>V._type==="opf"),N=V=>[...V].sort((Y,Q)=>{let me="",j="";return o(I)==="id"?(me=Y._type==="manifest"?Y.id:(Y._type==="source"||Y._type==="source-zip",Y.name),j=Q._type==="manifest"?Q.id:(Q._type==="source"||Q._type==="source-zip",Q.name)):o(I)==="href"?(me=Y._type==="manifest"?Y.href:(Y._type==="source"||Y._type==="source-zip",Y.path),j=Q._type==="manifest"?Q.href:(Q._type==="source"||Q._type==="source-zip",Q.path)):o(I)==="size"&&(me=Y.size||0,j=Q.size||0),me<j?o(M)==="asc"?-1:1:me>j?o(M)==="asc"?1:-1:0});return[...N(fe),...N(ke),...N(Ne),...N(_e)]})())}),Pt(),wt();var ae=Hh(),B=f(ae);let le;var Se=f(B),ze=f(Se),xe=f(ze),Le=g(ze,2),de=f(Le);de.__input=[xh,b];var K=g(de,2);{var X=fe=>{var ke=Ch();ke.__click=[Th,b],U(_e=>ve(ke,"aria-label",_e),[()=>n()("Clear filter")],ue),x(fe,ke)};H(K,fe=>{o(b)&&fe(X)})}var re=g(Se,2),ge=f(re);ge.__click=[kh,h,v,w];var Ae=f(ge),We=g(ge,2);We.__click=[Sh,C];var Be=f(We),pe=g(We,2);pe.__click=[Eh,w];var be=f(pe),he=g(re,2);he.__change=R,Ot(he,fe=>y(C,fe),()=>o(C));var Ce=g(he,2);{var Oe=fe=>{var ke=Fh(),_e=f(ke),Ne=f(_e),N=f(Ne);U(V=>E(N,V),[()=>n()("Drop files here to add them to the manifest")],ue),x(fe,ke)};H(Ce,fe=>{o(k)&&fe(Oe)})}var Ve=g(B,2),tt=f(Ve);{var ct=fe=>{var ke=Mh(),_e=f(ke);{var Ne=V=>{var Y=Ih(),Q=Ke(Y),me=f(Q),j=g(Q,2),oe=f(j);U((ne,we)=>{E(me,ne),E(oe,we)},[()=>n()("No items match your filter"),()=>n()("Try adjusting your search terms")],ue),x(V,Y)},N=V=>{var Y=Ph(),Q=Ke(Y),me=f(Q),j=g(Q,2),oe=f(j);U((ne,we)=>{E(me,ne),E(oe,we)},[()=>n()("No manifest items found"),()=>n()("Create your first item using the buttons above")],ue),x(V,Y)};H(_e,V=>{o(b)?V(Ne):V(N,!1)})}x(fe,ke)},at=fe=>{var ke=$h(),_e=f(ke),Ne=f(_e),N=f(Ne),V=f(N);V.__click=[Lh,S];var Y=f(V),Q=g(N),me=f(Q);me.__click=[Dh,S];var j=f(me),oe=g(Q),ne=f(oe);ne.__click=[Rh,S];var we=f(ne),ye=g(oe),Ie=f(ye),Te=g(_e);xt(Te,5,()=>o(l),It,(Fe,ce,Re)=>{var $e=Nh();const Pe=ue(()=>o(ce)._type),_=ue(()=>$(o(ce),o(Pe))),G=ue(()=>o(Pe)==="manifest"?Z(o(ce)):!1),te=ue(()=>Re>0?o(l)[Re-1]._type:null),Ee=ue(()=>o(Pe)==="source"&&o(te)==="manifest"),De=ue(()=>o(Pe)==="source-zip"&&o(te)==="opf"),z=ue(()=>o(Pe)==="opf"&&(o(te)==="manifest"||o(te)==="source"));var ee=Ke($e);{var ie=pt=>{var jt=zh(),Sa=f(jt),Ea=f(Sa),Or=f(Ea),ka=f(Or);U(So=>E(ka,So),[()=>n()("SOURCE.zip")],ue),x(pt,jt)};H(ee,pt=>{o(Ee)&&pt(ie)})}var Me=g(ee,2);{var He=pt=>{var jt=Uh();x(pt,jt)};H(Me,pt=>{o(De)&&pt(He)})}var Xe=g(Me,2);{var it=pt=>{var jt=Ah();x(pt,jt)};H(Xe,pt=>{o(z)&&pt(it)})}var vt=g(Xe,2);let dt;vt.__click=[Oh,O,ce,Pe],vt.__keydown=[Wh,A,ce,Pe];var Wt=f(vt),rn=f(Wt),or=f(rn),Qt=g(Wt),Vt=f(Qt),kn=f(Vt),Tt=g(Qt),Tn=f(Tt),Ar=g(Tt),wo=f(Ar);{var yo=pt=>{var jt=Bh();xt(jt,5,()=>o(ce).properties||[],It,(Sa,Ea)=>{var Or=jh(),ka=f(Or);U(()=>E(ka,o(Ea))),x(Sa,Or)}),x(pt,jt)},bo=pt=>{var jt=Et("-");x(pt,jt)};H(wo,pt=>{o(Pe)==="manifest"&&o(ce).properties&&(o(ce).properties?.length??0)>0?pt(yo):pt(bo,!1)})}var _o=g(Ar);{var xo=pt=>{};H(_o,pt=>{o(Pe)==="manifest"&&pt(xo)})}U((pt,jt)=>{dt=nt(vt,1,"manifest-row svelte-8hsxjr",null,dt,pt),ve(vt,"aria-selected",o(_)),E(or,o(Pe)==="manifest"?o(ce).id:(o(Pe)==="source"||o(Pe)==="source-zip")&&o(ce).name||o(ce).name),rn.dir=rn.dir,E(kn,o(Pe)==="manifest"?o(ce).href:(o(Pe)==="source"||o(Pe)==="source-zip")&&o(ce).path||o(ce).path),Vt.dir=Vt.dir,E(Tn,jt)},[()=>({selected:o(_),error:o(G),"source-item":o(Pe)==="source","source-zip-item":o(Pe)==="source-zip","opf-item":o(Pe)==="opf"}),()=>D(o(ce).size)],ue),x(Fe,$e)}),U((Fe,ce,Re,$e,Pe,_,G,te,Ee,De)=>{ve(V,"aria-label",Fe),E(Y,`${ce??""}
                ${Re??""}`),ve(me,"aria-label",$e),E(j,`${Pe??""}
                ${_??""}`),ve(ne,"aria-label",G),E(we,`${te??""}
                ${Ee??""}`),E(Ie,De)},[()=>n()("Sort by ID"),()=>n()("ID"),()=>q("id"),()=>n()("Sort by path"),()=>n()("Path"),()=>q("href"),()=>n()("Sort by size"),()=>n()("Size"),()=>q("size"),()=>n()("Properties")],ue),x(fe,ke)};H(tt,fe=>{o(l).length===0?fe(ct):fe(at,!1)})}U((fe,ke,_e,Ne,N,V,Y)=>{le=nt(B,1,"manifest-toolbar svelte-8hsxjr",null,le,fe),ve(B,"aria-label",ke),E(xe,`${_e??""}:`),ve(de,"placeholder",Ne),Sn(de,o(b)),de.disabled=m(),ge.disabled=!h()||v()!=="manifest",E(Ae,`✏️ ${N??""}`),We.disabled=m(),E(Be,`📁 ${V??""}`),pe.disabled=m(),E(be,`📝 ${Y??""}`)},[()=>({"drag-active":o(k)}),()=>n()("Manifest actions"),()=>n()("Filter"),()=>n()("Filter by ID, path, or media type..."),()=>n()("Edit Item"),()=>n()("Load File"),()=>n()("Create Text File")],ue),Ge("dragover",B,T),Ge("dragleave",B,L),Ge("drop",B,F),x(r,ae),et(),a()}bt(["input","click","change","keydown"]);class ho{static generateItemId(e){return!e||e.trim()===""?"item":e.replace(/\.[^/.]+$/,"").toLowerCase().replace(/[^a-z0-9_-]/g,"_").replace(/^[0-9]/,"item_$&").replace(/^[^a-z_]/,"item").replace(/^_+|_+$/g,"")||"item"}static detectMediaType(e,t){const a=this.getFileExtension(e).toLowerCase(),i={xhtml:"application/xhtml+xml",html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",txt:"text/plain",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",bmp:"image/bmp",ico:"image/x-icon",mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",m4a:"audio/mp4",aac:"audio/aac",flac:"audio/flac",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",avi:"video/x-msvideo",mov:"video/quicktime",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2",eot:"application/vnd.ms-fontobject",pdf:"application/pdf",epub:"application/epub+zip",zip:"application/zip"}[a];return i||(t&&t.byteLength>0?this.detectMediaTypeFromContent(t):"application/octet-stream")}static detectMediaTypeFromContent(e){const t=new Uint8Array(e);if(t.length>=8){if(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71)return"image/png";if(t[0]===255&&t[1]===216&&t[2]===255)return"image/jpeg";if(t[0]===71&&t[1]===73&&t[2]===70&&t[3]===56)return"image/gif";if(t[0]===37&&t[1]===80&&t[2]===68&&t[3]===70)return"application/pdf";if(t[0]===80&&t[1]===75&&(t[2]===3||t[2]===5))return"application/zip"}try{const a=new TextDecoder("utf-8",{fatal:!0}).decode(e);return a.includes("<?xml")?"application/xml":a.includes("<html")||a.includes("<!DOCTYPE html")?"text/html":"text/plain"}catch{}return"application/octet-stream"}static getMediaTypeCategories(){return{text:[{mediaType:"application/xhtml+xml",extensions:["xhtml"],description:"XHTML Document",isEpubCore:!0},{mediaType:"text/html",extensions:["html","htm"],description:"HTML Document"},{mediaType:"text/css",extensions:["css"],description:"CSS Stylesheet",isEpubCore:!0},{mediaType:"application/javascript",extensions:["js"],description:"JavaScript"},{mediaType:"application/json",extensions:["json"],description:"JSON Data"},{mediaType:"text/plain",extensions:["txt"],description:"Plain Text"},{mediaType:"application/xml",extensions:["xml"],description:"XML Document"}],image:[{mediaType:"image/jpeg",extensions:["jpg","jpeg"],description:"JPEG Image",isEpubCore:!0},{mediaType:"image/png",extensions:["png"],description:"PNG Image",isEpubCore:!0},{mediaType:"image/gif",extensions:["gif"],description:"GIF Image",isEpubCore:!0},{mediaType:"image/svg+xml",extensions:["svg"],description:"SVG Image",isEpubCore:!0},{mediaType:"image/webp",extensions:["webp"],description:"WebP Image"},{mediaType:"image/bmp",extensions:["bmp"],description:"Bitmap Image"}],audio:[{mediaType:"audio/mpeg",extensions:["mp3"],description:"MP3 Audio",isEpubCore:!0},{mediaType:"audio/mp4",extensions:["m4a"],description:"MP4 Audio",isEpubCore:!0},{mediaType:"audio/ogg",extensions:["ogg"],description:"OGG Audio"},{mediaType:"audio/wav",extensions:["wav"],description:"WAV Audio"},{mediaType:"audio/aac",extensions:["aac"],description:"AAC Audio"}],video:[{mediaType:"video/mp4",extensions:["mp4"],description:"MP4 Video",isEpubCore:!0},{mediaType:"video/webm",extensions:["webm"],description:"WebM Video"},{mediaType:"video/ogg",extensions:["ogv"],description:"OGG Video"},{mediaType:"video/quicktime",extensions:["mov"],description:"QuickTime Video"}],application:[{mediaType:"font/ttf",extensions:["ttf"],description:"TrueType Font",isEpubCore:!0},{mediaType:"font/otf",extensions:["otf"],description:"OpenType Font",isEpubCore:!0},{mediaType:"font/woff",extensions:["woff"],description:"WOFF Font",isEpubCore:!0},{mediaType:"font/woff2",extensions:["woff2"],description:"WOFF2 Font",isEpubCore:!0},{mediaType:"application/pdf",extensions:["pdf"],description:"PDF Document"},{mediaType:"application/zip",extensions:["zip"],description:"ZIP Archive"},{mediaType:"application/octet-stream",extensions:[],description:"Binary Data"}]}}static createBlobUrl(e,t){const a=typeof e=="string"?new Blob([e],{type:t}):new Blob([e],{type:t});return URL.createObjectURL(a)}static revokeBlobUrl(e){URL.revokeObjectURL(e)}static formatFileSize(e){if(e===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+a[n]}static getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1):""}static sanitizeFileName(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}}var qh=P('<p class="file-info svelte-ziknnq"> </p>'),Gh=P('<div class="form-group svelte-ziknnq"><label for="file-input" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="file-input" type="file" class="file-input svelte-ziknnq" required/> <!></div>'),Xh=P('<p class="error-message svelte-ziknnq"> </p>'),Jh=P('<p class="error-message svelte-ziknnq"> </p>'),Kh=P("<option> </option>"),Yh=P('<p class="error-message svelte-ziknnq"> </p>'),Zh=P('<label class="checkbox-label svelte-ziknnq"><input type="checkbox" class="checkbox-input svelte-ziknnq"/> </label>'),Qh=P('<div class="form-group svelte-ziknnq"><label for="text-content" class="form-label svelte-ziknnq"> </label> <textarea id="text-content" class="form-textarea svelte-ziknnq" rows="10"></textarea> <p class="field-help svelte-ziknnq"> </p></div>'),ev=P('<div class="modal-overlay svelte-ziknnq" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-content svelte-ziknnq"><div class="modal-header svelte-ziknnq"><h2 id="modal-title" class="svelte-ziknnq"><!></h2> <button type="button" class="close-button svelte-ziknnq">×</button></div> <form class="modal-form svelte-ziknnq"><div class="form-body svelte-ziknnq"><!> <div class="form-group svelte-ziknnq"><label for="item-id" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-id" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-href" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-href" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-mediatype" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <select id="item-mediatype" required><option> </option><!></select> <!></div> <div class="form-group svelte-ziknnq"><fieldset class="checkbox-fieldset svelte-ziknnq"><legend class="form-label svelte-ziknnq"> </legend> <div class="checkbox-group svelte-ziknnq"></div></fieldset></div> <!></div> <div class="modal-footer svelte-ziknnq"><button type="button" class="cancel-button svelte-ziknnq"> </button> <button type="submit" class="save-button svelte-ziknnq"><!></button></div></form></div></div>');function tv(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"itemEditorMode",8,"create-text"),s=W(e,"item",8,null),l=W(e,"validationErrors",24,()=>[]);const d=Mt();let u=je(),c=je({id:"",href:"",mediaType:"",properties:[]}),p=je(""),h=je(),v=je(null);const m=[{value:"application/xhtml+xml",label:"XHTML"},{value:"text/html",label:"HTML"},{value:"text/css",label:"CSS"},{value:"text/javascript",label:"JavaScript"},{value:"text/plain",label:"Plain Text"},{value:"image/jpeg",label:"JPEG Image"},{value:"image/png",label:"PNG Image"},{value:"image/svg+xml",label:"SVG Image"},{value:"audio/mpeg",label:"MP3 Audio"},{value:"audio/ogg",label:"OGG Audio"},{value:"video/mp4",label:"MP4 Video"},{value:"video/webm",label:"WebM Video"},{value:"application/pdf",label:"PDF"},{value:"application/epub+zip",label:"EPUB"}],w=[{value:"cover-image",label:"Cover Image"},{value:"mathml",label:"MathML"},{value:"nav",label:"Navigation"},{value:"remote-resources",label:"Remote Resources"},{value:"scripted",label:"Scripted"},{value:"svg",label:"SVG"}],b=()=>{d("close")},k=_=>{_.target===o(u)&&b()},C=_=>{_.key==="Escape"&&_.target===o(u)&&b()},I=_=>{_.key==="Escape"&&b()},M=_=>{const G=_.target;if(G.files&&G.files.length>0){y(v,G.files[0]),o(c).id||qe(c,o(c).id=o(v).name.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"));const te=o(v).type,Ee=ho.detectMediaType(o(v).name),De=!te||te==="application/octet-stream",z=Ee.startsWith("font/"),ee=De||z?Ee:te;o(c).href||qe(c,o(c).href=qa(o(v).name,ee)),o(c).mediaType||qe(c,o(c).mediaType=ee)}},S=_=>{if(_.preventDefault(),!o(c).id||!o(c).href||!o(c).mediaType){alert(n()("Please fill in all required fields"));return}const G={id:o(c).id,href:o(c).href,mediaType:o(c).mediaType,properties:o(c).properties?.filter(te=>te.length>0)};d("save",{item:G,textContent:o(p),selectedFile:o(v)})},O=(_,G)=>{G?qe(c,o(c).properties=[...o(c).properties||[],_]):qe(c,o(c).properties=(o(c).properties||[]).filter(te=>te!==_))},A=()=>{if(o(c).href){const _=o(c).href.split("/").pop()||"";qe(c,o(c).id=_.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"))}},$=()=>{if(o(c).id&&!o(c).href){const _=J(o(c).mediaType||""),G=o(c).id+_;qe(c,o(c).href=qa(G,o(c).mediaType||""))}},J=_=>({"application/xhtml+xml":".xhtml","text/html":".html","text/css":".css","text/javascript":".js","text/plain":".txt","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/svg+xml":".svg","audio/mpeg":".mp3","audio/ogg":".ogg","video/mp4":".mp4","video/webm":".webm","application/pdf":".pdf"})[_]||".dat",Z=_=>{const G=l().find(te=>te.field===_);return G?G.message:null},D=_=>l().some(G=>G.field===_);ot(()=>(Ze(i()),Ze(s())),()=>{if(i()==="edit"&&s()&&"id"in s()){const _=s();y(c,{id:_.id,href:_.href,mediaType:_.mediaType,properties:_.properties||[]})}else y(c,{id:"",href:"",mediaType:i()==="create-text"?"text/plain":"",properties:[]})}),Pt(),wt();var q=ev();Ge("keydown",Wa,I);var R=f(q),T=f(R),L=f(T),F=f(L);{var ae=_=>{var G=Et();U(te=>E(G,te),[()=>n()("Create Text File")],ue),x(_,G)},B=(_,G)=>{{var te=De=>{var z=Et();U(ee=>E(z,ee),[()=>n()("Upload File")],ue),x(De,z)},Ee=De=>{var z=Et();U(ee=>E(z,ee),[()=>n()("Edit Manifest Item")],ue),x(De,z)};H(_,De=>{i()==="create-file"?De(te):De(Ee,!1)},G)}};H(F,_=>{i()==="create-text"?_(ae):_(B,!1)})}var le=g(L,2),Se=g(T,2),ze=f(Se),xe=f(ze);{var Le=_=>{var G=Gh(),te=f(G),Ee=f(te),De=g(te,2);Ot(De,ie=>y(h,ie),()=>o(h));var z=g(De,2);{var ee=ie=>{var Me=qh(),He=f(Me);U((Xe,it)=>E(He,`${Xe??""}: ${o(v).name??""} (${it??""} KB)`),[()=>n()("Selected"),()=>(o(v).size/1024).toFixed(1)],ue),x(ie,Me)};H(z,ie=>{o(v)&&ie(ee)})}U(ie=>E(Ee,`${ie??""} `),[()=>n()("Select File")],ue),Ge("change",De,M),x(_,G)};H(xe,_=>{i()==="create-file"&&_(Le)})}var de=g(xe,2),K=f(de),X=f(K),re=g(K,2);let ge;var Ae=g(re,2);{var We=_=>{var G=Xh(),te=f(G);U(Ee=>E(te,Ee),[()=>Z("id")],ue),x(_,G)};H(Ae,_=>{Z("id")&&_(We)})}var Be=g(de,2),pe=f(Be),be=f(pe),he=g(pe,2);let Ce;var Oe=g(he,2);{var Ve=_=>{var G=Jh(),te=f(G);U(Ee=>E(te,Ee),[()=>Z("href")],ue),x(_,G)};H(Oe,_=>{Z("href")&&_(Ve)})}var tt=g(Be,2),ct=f(tt),at=f(ct),fe=g(ct,2);U(()=>{o(c),El(()=>{n()})});let ke;var _e=f(fe);_e.value=_e.__value="";var Ne=f(_e),N=g(_e);xt(N,1,()=>m,It,(_,G)=>{var te=Kh(),Ee={},De=f(te);U(()=>{Ee!==(Ee=o(G).value)&&(te.value=(te.__value=o(G).value)??""),E(De,o(G).label)}),x(_,te)});var V=g(fe,2);{var Y=_=>{var G=Yh(),te=f(G);U(Ee=>E(te,Ee),[()=>Z("mediaType")],ue),x(_,G)};H(V,_=>{Z("mediaType")&&_(Y)})}var Q=g(tt,2),me=f(Q),j=f(me),oe=f(j),ne=g(j,2);xt(ne,5,()=>w,It,(_,G)=>{var te=Zh(),Ee=f(te),De=g(Ee);U(z=>{Ns(Ee,z),E(De,` ${o(G).label??""}`)},[()=>o(c).properties?.includes(o(G).value)||!1],ue),Ge("change",Ee,z=>O(o(G).value,z.currentTarget.checked)),x(_,te)});var we=g(Q,2);{var ye=_=>{var G=Qh(),te=f(G),Ee=f(te),De=g(te,2),z=g(De,2),ee=f(z);U((ie,Me,He)=>{E(Ee,ie),ve(De,"placeholder",Me),E(ee,He)},[()=>n()("Initial Content"),()=>n()("Enter the initial content for this text file…"),()=>n()("You can edit the content later in the main editor")],ue),Ia(De,()=>o(p),ie=>y(p,ie)),x(_,G)};H(we,_=>{i()==="create-text"&&_(ye)})}var Ie=g(ze,2),Te=f(Ie),Fe=f(Te),ce=g(Te,2),Re=f(ce);{var $e=_=>{var G=Et();U(te=>E(G,te),[()=>n()("Create Text File")],ue),x(_,G)},Pe=(_,G)=>{{var te=De=>{var z=Et();U(ee=>E(z,ee),[()=>n()("Upload File")],ue),x(De,z)},Ee=De=>{var z=Et();U(ee=>E(z,ee),[()=>n()("Save Changes")],ue),x(De,z)};H(_,De=>{i()==="create-file"?De(te):De(Ee,!1)},G)}};H(Re,_=>{i()==="create-text"?_($e):_(Pe,!1)})}Ot(q,_=>y(u,_),()=>o(u)),U((_,G,te,Ee,De,z,ee,ie,Me,He,Xe,it)=>{ve(le,"aria-label",_),E(X,`${G??""} `),ge=nt(re,1,"form-input svelte-ziknnq",null,ge,te),ve(re,"placeholder",Ee),re.dir=re.dir,E(be,`${De??""} `),Ce=nt(he,1,"form-input svelte-ziknnq",null,Ce,z),ve(he,"placeholder",ee),he.dir=he.dir,E(at,`${ie??""} `),ke=nt(fe,1,"form-select svelte-ziknnq",null,ke,Me),E(Ne,He),E(oe,Xe),E(Fe,it)},[()=>n()("Close"),()=>n()("ID"),()=>({error:D("id")}),()=>n()("Unique identifier for this item"),()=>n()("File Path"),()=>({error:D("href")}),()=>n()("OEBPS/filename.ext"),()=>n()("Media Type"),()=>({error:D("mediaType")}),()=>n()("Select media type…"),()=>n()("EPUB Properties"),()=>n()("Cancel")],ue),Ge("click",le,b),Ia(re,()=>o(c).id,_=>qe(c,o(c).id=_)),Ge("blur",re,$),Ia(he,()=>o(c).href,_=>qe(c,o(c).href=_)),Ge("blur",he,A),Ws(fe,()=>o(c).mediaType,_=>qe(c,o(c).mediaType=_)),Ge("click",Te,b),Ge("submit",Se,S),Ge("click",q,k),Ge("keydown",q,C),x(r,q),et(),a()}var nv=P('<div class="loading-state svelte-12tyyls"><p> </p></div>'),rv=P('<div class="error-state svelte-12tyyls"><p class="error-message svelte-12tyyls"> </p> <button type="button" class="retry-button svelte-12tyyls"> </button></div>'),av=P("<!> <!>",1);function iv(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"workspace",7,null),s=W(e,"advancedMode",3,!0),l=Ue(Ct([])),d=Ue(Ct([])),u=Ue(null),c=Ue(null),p=Ue(Ct([])),h=Ue(!0),v=Ue(null),m=Ue(!1),w=Ue("create-text");const b=async()=>{if(i())try{y(h,!0),y(v,null);const T=i().opf.manifest,L=await Promise.all(T.map(async F=>{try{const ae=i().pathInfo.basePath?`${i().pathInfo.basePath}/${F.href}`:F.href,B=await e.workspaceService.getFileInfo(i().id,ae);return{...F,size:B.size}}catch{return F}}));if(y(l,L,!0),s())try{y(d,await e.workspaceService.listSourceFiles(i()),!0)}catch(F){console.warn("Failed to load SOURCE items:",F),y(d,[],!0)}else y(d,[],!0);y(p,[],!0)}catch{y(v,n()("Failed to load manifest"),!0)}finally{y(h,!1)}},k=T=>{y(u,T.detail.item,!0),y(c,T.detail.type,!0),e.onItemSelect?.({item:T.detail.item,type:T.detail.type})},C=T=>{y(w,T.detail.mode,!0),y(m,!0)},I=T=>{y(u,T.detail.item,!0),y(c,"manifest"),y(w,"edit"),y(m,!0)},M=async T=>{if(!(!i()||!confirm(n()("Are you sure you want to delete this item?"))))try{i(await e.workspaceService.removeManifestItem(i(),T.detail.itemId)),await b(),o(u)&&"id"in o(u)&&o(u).id===T.detail.itemId&&(y(u,null),y(c,null))}catch{y(v,n()("Failed to delete item"),!0)}},S=async T=>{if(i())try{const{item:L}=T.detail;if(o(w)==="edit"&&o(u)&&"id"in o(u))i(await e.workspaceService.updateManifestItem(i(),o(u).id,L));else if(o(w)==="create-text"){i(await e.workspaceService.addManifestItem(i(),L));const F=L.href.startsWith(i().pathInfo.basePath+"/")?L.href:`${i().pathInfo.basePath}/${L.href}`;await e.workspaceService.writeFile(i().id,F,"")}y(m,!1),await b()}catch{y(v,n()("Failed to save item"),!0)}},O=async T=>{if(!i())return;const L=T.detail.files,F=[],ae=[];for(const B of L)try{const le=B.type,Se=ho.detectMediaType(B.name),ze=!le||le==="application/octet-stream",xe=Se.startsWith("font/"),Le=ze||xe?Se:le,de={href:qa(B.name,Le),mediaType:Le};i(await e.workspaceService.addManifestItem(i(),de));const K=`${i().pathInfo.basePath}/${de.href}`;if(B.type.startsWith("text/")||B.type.includes("json")||B.type.includes("xml")){const X=await B.text();await e.workspaceService.writeFile(i().id,K,X)}else{const X=await B.arrayBuffer();await e.workspaceService.writeBinaryFile(i().id,K,X)}F.push(B.name)}catch(le){console.warn(`Failed to upload ${B.name}:`,le),ae.push({name:B.name,error:le instanceof Error?le.message:"Unknown error"})}await b(),ae.length===0?console.log(`Successfully uploaded ${F.length} files:`,F):F.length===0?(y(v,n()("Failed to upload all files"),!0),console.error("Upload failures:",ae)):(console.log(`Uploaded ${F.length} files successfully:`,F),console.warn(`Failed to upload ${ae.length} files:`,ae),y(v,n()("Some files failed to upload - see console for details"),!0))},A=()=>{y(m,!1)};nn(b),kt(()=>{i()&&b()}),kt(()=>{i()&&(s()?e.workspaceService.listSourceFiles(i()).then(T=>{y(d,T,!0)}).catch(T=>{console.warn("Failed to load SOURCE items:",T),y(d,[],!0)}):y(d,[],!0))}),kt(()=>{i()&&b()});var $=av(),J=Ke($);{var Z=T=>{var L=nv(),F=f(L),ae=f(F);U(B=>E(ae,B),[()=>n()("Loading manifest…")]),x(T,L)},D=(T,L)=>{{var F=B=>{var le=rv(),Se=f(le),ze=f(Se),xe=g(Se,2);xe.__click=b;var Le=f(xe);U(de=>{E(ze,o(v)),E(Le,de)},[()=>n()("Retry")]),x(B,le)},ae=B=>{Vh(B,{get manifestItems(){return o(l)},get sourceItems(){return o(d)},get advancedMode(){return s()},get validationErrors(){return o(p)},get selectedItem(){return o(u)},get selectedItemType(){return o(c)},$$events:{itemSelect:k,itemCreate:C,itemEdit:I,itemDelete:M,fileUpload:O}})};H(T,B=>{o(v)?B(F):B(ae,!1)},L)}};H(J,T=>{o(h)?T(Z):T(D,!1)})}var q=g(J,2);{var R=T=>{const L=se(()=>o(w)==="edit"?o(u):null);tv(T,{get itemEditorMode(){return o(w)},get item(){return o(L)},get validationErrors(){return o(p)},$$events:{save:S,close:A}})};H(q,T=>{o(m)&&T(R)})}x(r,$),et(),a()}bt(["click"]);var sv=P('<div class="no-selection svelte-xcscli"><p class="svelte-xcscli"> </p> <p class="no-selection-subtitle svelte-xcscli"> </p></div>'),ov=P('<div class="loading-state svelte-xcscli"><p> </p></div>'),lv=P('<div class="error-state svelte-xcscli"><p class="error-message svelte-xcscli"> </p> <button type="button" class="retry-button svelte-xcscli"> </button></div>'),cv=P('<button type="button" class="action-button edit-button svelte-xcscli"> </button>'),dv=P('<button type="button" class="action-button delete-button svelte-xcscli"> </button>'),uv=P('<div class="preview-error svelte-xcscli"><p> </p></div>'),fv=P('<div class="text-preview svelte-xcscli"><pre class="text-content svelte-xcscli"> </pre></div>'),pv=P('<div class="image-preview svelte-xcscli"><img class="preview-image svelte-xcscli"/></div>'),hv=P('<div class="audio-preview svelte-xcscli"><audio controls class="preview-audio svelte-xcscli"><source/> </audio></div>'),vv=P('<div class="video-preview svelte-xcscli"><video controls class="preview-video svelte-xcscli"><track kind="captions"/> <source/> </video></div>',2),mv=P('<div class="binary-preview svelte-xcscli"><p> </p> <p class="binary-info svelte-xcscli"> </p></div>'),gv=P('<div class="content-header svelte-xcscli"><span class="content-type-icon svelte-xcscli"> </span> <span class="content-type svelte-xcscli"> </span></div> <!>',1),wv=P('<div class="preview-content svelte-xcscli"><div class="preview-header svelte-xcscli"><div class="preview-actions svelte-xcscli"><!> <button type="button" class="action-button download-button svelte-xcscli"> </button> <!></div></div> <div class="preview-body svelte-xcscli"><!></div></div>'),yv=P('<div class="manifest-preview svelte-xcscli"><!></div>');function bv(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(mt,"$t",t);let i=W(e,"selectedItem",8,null),s=W(e,"selectedItemType",8,null),l=W(e,"workspace",8,null),d=W(e,"workspaceService",8);const u=Mt();let c=je(null),p=je(!1),h=je(null),v=null;const m=D=>D.startsWith("text/")||D.includes("json")||D.includes("xml")||D.includes("javascript"),w=D=>D.startsWith("image/"),b=D=>D.includes("css")||D.includes("javascript")||D.includes("json")||D.includes("xml")||D.startsWith("text/css")||D.startsWith("text/javascript")||D.startsWith("application/json")||D.startsWith("application/xml")||D.startsWith("application/xhtml+xml"),k=()=>{v&&(URL.revokeObjectURL(v),v=null)};sr(()=>{k()});const C=async()=>{if(!i()||!s()||!d()||!l()){y(c,null),k();return}try{if(y(p,!0),y(h,null),k(),s()==="manifest"){const D=i(),q=D.href.startsWith(l().pathInfo.basePath+"/")?D.href:`${l().pathInfo.basePath}/${D.href}`;try{let R;try{R=await d().readFile(l().id,q)}catch{R=await d().readFile(l().id,D.href)}const T=m(D.mediaType),L=w(D.mediaType);let F,ae,B;if(T)F=new TextDecoder("utf-8").decode(R),B="text";else if(L){const le=new Blob([R],{type:D.mediaType});ae=URL.createObjectURL(le),v=ae,B="image"}else B="binary";y(c,{itemId:D.id,mediaType:D.mediaType,contentType:B,textContent:F,previewUrl:ae,metadata:{characterCount:F?F.length:void 0,lineCount:F?F.split(`
`).length:void 0,wordCount:F?F.split(/\s+/).filter(le=>le.length>0).length:void 0}})}catch{y(c,{itemId:D.id,mediaType:D.mediaType,contentType:"binary",error:"Failed to load content"})}}else if(s()==="source"){const D=i();try{const q=await d().readFile(l().id,D.path),R=m(D.mediaType||"text/plain");let T;R&&(T=new TextDecoder("utf-8").decode(q)),y(c,{itemId:D.path,mediaType:D.mediaType||"text/plain",contentType:R?"text":"binary",textContent:T,metadata:{characterCount:T?T.length:void 0,lineCount:T?T.split(`
`).length:void 0,wordCount:T?T.split(/\s+/).filter(L=>L.length>0).length:void 0}})}catch{y(c,{itemId:D.path,mediaType:D.mediaType||"text/plain",contentType:"text",error:"Failed to load SOURCE file content"})}}else if(s()==="opf"){const D=i();try{const q=await d().readFile(l().id,l().pathInfo.rootfilePath),T=new TextDecoder("utf-8").decode(q);y(c,{itemId:D.name,mediaType:"application/xml",contentType:"text",textContent:T,metadata:{characterCount:T.length,lineCount:T.split(`
`).length,wordCount:T.split(/\s+/).filter(L=>L.length>0).length}})}catch{y(c,{itemId:D.name,mediaType:"application/xml",contentType:"text",error:"Failed to load content.opf file"})}}}catch{y(h,n()("Failed to load content preview")),y(c,null)}finally{y(p,!1)}},I=()=>{i()&&s()==="manifest"&&u("itemEdit",{item:i()})},M=()=>{i()&&s()==="manifest"&&u("itemDelete",{itemId:i().id})},S=async()=>{if(!(!i()||!d()||!l()))try{let D,q,R;if(s()==="manifest"){const ae=i(),B=ae.href.startsWith(l().pathInfo.basePath+"/")?ae.href:`${l().pathInfo.basePath}/${ae.href}`;try{D=await d().readFile(l().id,B)}catch{D=await d().readFile(l().id,ae.href)}q=ae.href.split("/").pop()||ae.id,R=ae.mediaType}else if(s()==="source"){const ae=i();D=await d().readFile(l().id,ae.path),q=ae.name||ae.path.split("/").pop()||"source-file",R=ae.mediaType||"application/octet-stream"}else if(s()==="opf"){const ae=i();D=await d().readFile(l().id,l().pathInfo.rootfilePath),q="content.opf",R="application/xml"}else return;const T=new Blob([D],{type:R}),L=URL.createObjectURL(T),F=document.createElement("a");F.href=L,F.download=q,F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(L)}catch(D){console.error("Download failed:",D)}},O=D=>{switch(D){case"text":return"📄";case"image":return"🖼️";case"audio":return"🎵";case"video":return"🎥";default:return"📦"}};ot(()=>(Ze(i()),Ze(s()),Ze(d()),Ze(l())),()=>{i()&&s()&&d()&&l()&&C()}),Pt(),wt();var A=yv(),$=f(A);{var J=D=>{var q=sv(),R=f(q),T=f(R),L=g(R,2),F=f(L);U((ae,B)=>{E(T,ae),E(F,B)},[()=>n()("Select an item to preview its content"),()=>n()("Click on any row in the table to see details")],ue),x(D,q)},Z=(D,q)=>{{var R=L=>{var F=ov(),ae=f(F),B=f(ae);U(le=>E(B,le),[()=>n()("Loading preview…")],ue),x(L,F)},T=(L,F)=>{{var ae=le=>{var Se=lv(),ze=f(Se),xe=f(ze),Le=g(ze,2),de=f(Le);U(K=>{E(xe,o(h)),E(de,K)},[()=>n()("Retry")],ue),Ge("click",Le,C),x(le,Se)},B=le=>{var Se=wv(),ze=f(Se),xe=f(ze),Le=f(xe);{var de=pe=>{var be=cv(),he=f(be);U(Ce=>E(he,Ce),[()=>n()("Edit")],ue),Ge("click",be,I),x(pe,be)};H(Le,pe=>{s()==="manifest"&&pe(de)})}var K=g(Le,2),X=f(K),re=g(K,2);{var ge=pe=>{var be=dv(),he=f(be);U(Ce=>E(he,Ce),[()=>n()("Delete")],ue),Ge("click",be,M),x(pe,be)};H(re,pe=>{s()==="manifest"&&pe(ge)})}var Ae=g(ze,2),We=f(Ae);{var Be=pe=>{var be=gv(),he=Ke(be),Ce=f(he),Oe=f(Ce),Ve=g(Ce,2),tt=f(Ve),ct=g(he,2);{var at=ke=>{var _e=uv(),Ne=f(_e),N=f(Ne);U(V=>E(N,`${V??""}: ${o(c).error??""}`),[()=>n()("Preview Error")],ue),x(ke,_e)},fe=(ke,_e)=>{{var Ne=V=>{var Y=fv(),Q=f(Y),me=f(Q);U(j=>{ve(Q,"dir",j),E(me,o(c).textContent),Q.dir=Q.dir},[()=>b(o(c).mediaType)?"ltr":void 0],ue),x(V,Y)},N=(V,Y)=>{{var Q=j=>{var oe=pv(),ne=f(oe);U(()=>{ve(ne,"src",o(c).previewUrl),ve(ne,"alt",s()==="manifest"?i().id:i().name)}),x(j,oe)},me=(j,oe)=>{{var ne=ye=>{var Ie=hv(),Te=f(Ie),Fe=f(Te),ce=g(Fe);U(Re=>{ve(Fe,"src",o(c).previewUrl),ve(Fe,"type",o(c).mediaType),E(ce,` ${Re??""}`)},[()=>n()("Your browser does not support the audio element.")],ue),x(ye,Ie)},we=(ye,Ie)=>{{var Te=ce=>{var Re=vv(),$e=f(Re),Pe=g(f($e),2),_=g(Pe);U(G=>{ve(Pe,"src",o(c).previewUrl),ve(Pe,"type",o(c).mediaType),E(_,` ${G??""}`)},[()=>n()("Your browser does not support the video element.")],ue),x(ce,Re)},Fe=ce=>{var Re=mv(),$e=f(Re),Pe=f($e),_=g($e,2),G=f(_);U((te,Ee)=>{E(Pe,te),E(G,Ee)},[()=>n()("Binary file - preview not available"),()=>n()("Use the download button to access the file")],ue),x(ce,Re)};H(ye,ce=>{o(c).contentType==="video"&&o(c).previewUrl?ce(Te):ce(Fe,!1)},Ie)}};H(j,ye=>{o(c).contentType==="audio"&&o(c).previewUrl?ye(ne):ye(we,!1)},oe)}};H(V,j=>{o(c).contentType==="image"&&o(c).previewUrl?j(Q):j(me,!1)},Y)}};H(ke,V=>{o(c).contentType==="text"&&o(c).textContent?V(Ne):V(N,!1)},_e)}};H(ct,ke=>{o(c).error?ke(at):ke(fe,!1)})}U(ke=>{E(Oe,ke),E(tt,o(c).mediaType)},[()=>O(o(c).contentType)],ue),x(pe,be)};H(We,pe=>{o(c)&&pe(Be)})}U(pe=>E(X,pe),[()=>n()("Download")],ue),Ge("click",K,S),x(le,Se)};H(L,le=>{o(h)?le(ae):le(B,!1)},F)}};H(D,L=>{o(p)?L(R):L(T,!1)},q)}};H($,D=>{i()?D(Z,!1):D(J)})}x(r,A),et(),a()}var _v=P(`<div class="outline-editor"><textarea class="outline-editor__textarea" aria-label="Navigation content editor" aria-describedby="editor-help" spellcheck="false" aria-multiline="true"></textarea> <div id="editor-help" class="sr-only">Enter navigation content in plain text. Leave empty to auto-generate from chapter titles.
    Press Ctrl+Enter (Cmd+Enter on Mac) to save navigation content.</div></div>`);function xv(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(s(),"$editorStore",t),i=je();let s=W(e,"editorStore",8),l=W(e,"placeholder",8,"Navigation content will be auto-generated from your chapters...");const d=Mt();let u;function c(v){const m=v.target;clearTimeout(u),u=setTimeout(()=>{s().updateContent(m.value),d("contentChanged",{editorId:"outline-nav",timestamp:Date.now(),isEmpty:m.value.trim()===""})},300)}sr(()=>{clearTimeout(u)}),ot(()=>n(),()=>{y(i,n().content)}),Pt(),wt();var p=_v(),h=f(p);U(()=>{Sn(h,o(i)),ve(h,"placeholder",l())}),Ge("input",h,c),x(r,p),et(),a()}class vr{static async generateFromSpine(e,t,a,n){n||(n={rootfilePath:"OEBPS/content.opf",basePath:"OEBPS",opfFileName:"content.opf"});const i={includeUntitled:!0,titleStrategy:"heading",documentTitle:"Table of Contents",cssClasses:{}},s=[];let l=1;for(const c of e)if(c.href)try{const p=`${n.basePath}/${c.href}`,h=await t.readFile(a,p),v=new TextDecoder().decode(h),m=this.extractTitleFromXHTML(v,c.href,l,"heading");if(m||i.includeUntitled){const w={href:c.href,title:m||`Chapter ${l}`};s.push(w)}l++}catch(p){if(p instanceof Error&&p.message.includes("Workspace not found"))throw p;continue}return{xhtmlContent:this.generateNavigationXHTML(s,i.documentTitle,i.cssClasses),metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}static async processUserContent(e,t,a,n){const i={validationLevel:"strict",errorHandling:"throw",documentTitle:"Navigation",...n};try{let l=(await t.transformText(e,a,"nav")).transformedText||"";return(!l||!l.includes('<?xml version="1.0" encoding="UTF-8"?>'))&&(l=this.generateNavigationXHTML([],i.documentTitle)),{xhtmlContent:l,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}catch(s){if(i.errorHandling==="throw")throw s;return{xhtmlContent:this.generateNavigationXHTML([],i.documentTitle),metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}}static extractTitleFromXHTML(e,t,a,n){const s=new DOMParser().parseFromString(e,"application/xml");if(s.querySelector("parsererror"))throw new Error("Malformed XHTML");if(!s.querySelector("html"))throw new Error("Invalid XHTML structure");const u=s.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const h of u){const v=h.textContent?.trim();if(v)return v}const p=s.querySelector("title")?.textContent?.trim();return p||this.getFallbackTitle(t,a,n)}static getFallbackTitle(e,t,a){return a==="filename"?(e.split("/").pop()||"").replace(/\.[^/.]+$/,"")||null:a==="fallback"?`Chapter ${t}`:null}static generateNavigationXHTML(e,t="Table of Contents",a={}){const n=e.map(l=>`      <li><a href="${l.href}">${this.escapeXML(l.title)}</a></li>`).join(`
`),i=a.nav?` class="${a.nav}"`:"",s=a.list?` class="${a.list}"`:"";return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeXML(t)}</title>
  <meta charset="UTF-8"/>
</head>
<body>
  <nav epub:type="toc" role="navigation"${i}>
    <h1>${this.escapeXML(t)}</h1>
    <ol${s}>
${n}
    </ol>
  </nav>
</body>
</html>`}static escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}}var Sv=P('<div class="outline-view svelte-vjoxn9" role="group" aria-label="Navigation editor"><div aria-live="polite" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <div aria-live="assertive" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <!></div>');function Ev(r,e){Qe(e,!1);const[t,a]=ut(),n=()=>Ye(p,"$outlineStore",t);let i=W(e,"workspace",8),s=W(e,"workspaceService",8),l=W(e,"spineService",8),d=W(e,"transformPipeline",8,void 0);const u=Mt(),c=`outline-nav-${Date.now()}-${Math.random().toString(36).substring(2,8)}`,p=po(c);let h=!1,v=null;async function m(L){try{L?await w():await b()}catch(F){u("error",{message:F instanceof Error?F.message:"Unknown error occurred",stage:L?"generation":"transform"})}}async function w(){try{const L=await l().loadSpineItems(i()),F=await vr.generateFromSpine(L,s(),i().id,i().pathInfo);u("previewUpdate",{xhtml:F.xhtmlContent})}catch(L){console.error("Failed to generate navigation from spine:",L),u("error",{message:L instanceof Error?L.message:"Failed to generate navigation",stage:"generation"})}}async function b(){const L=p.getContent();if(!d()){console.warn("TransformPipeline not available - falling back to auto-generation"),await w();return}try{const F=await vr.processUserContent(L,d(),i().id);u("previewUpdate",{xhtml:F.xhtmlContent,warnings:[]})}catch(F){console.error("Failed to process user content:",F),u("error",{message:F instanceof Error?F.message:"Failed to process navigation content",stage:"transform"})}}async function k(){await J();try{const L="SOURCE/text/nav.txt";if(await s().fileExists(i().id,L)){const ae=await s().readFile(i().id,L),B=new TextDecoder().decode(ae);p.updateContent(B)}else p.updateContent("")}catch(L){console.error("Failed to load navigation content:",L),u("error",{message:L instanceof Error?L.message:"Failed to load navigation content",stage:"generation"})}}async function C(){await J();try{const L=p.getContent();await s().writeFile(i().id,"SOURCE/text/nav.txt",L);let ae;if(L.trim()===""){const le=await l().loadSpineItems(i());ae=await vr.generateFromSpine(le,s(),i().id,i().pathInfo)}else if(d())ae=await vr.processUserContent(L,d(),i().id);else{console.warn("TransformPipeline not available - using auto-generation instead of user content");const le=await l().loadSpineItems(i());ae=await vr.generateFromSpine(le,s(),i().id,i().pathInfo)}await s().writeFile(i().id,"OEBPS/nav.xhtml",ae.xhtmlContent)}catch(L){console.error("Failed to save navigation content:",L),u("error",{message:L instanceof Error?L.message:"Failed to save navigation content",stage:"save"})}}function I(L){}let M=je(),S=je();async function O(L){if(L.key==="Enter"&&(L.ctrlKey||L.metaKey)){L.preventDefault();try{await C(),o(M)&&(qe(M,o(M).textContent="Navigation saved successfully"),setTimeout(()=>{qe(M,o(M).textContent="")},3e3))}catch(F){o(S)&&(qe(S,o(S).textContent=`Save failed: ${F instanceof Error?F.message:"Unknown error"}`),setTimeout(()=>{qe(S,o(S).textContent="")},5e3))}}}nn(async()=>{v||(v=A()),await v}),sr(()=>{h=!1,v=null,p.destroy(),u("destroyed",{timestamp:Date.now()})});async function A(){try{h=!0,u("ready",{timestamp:Date.now()}),await k()}catch(L){console.error("Failed to initialize OutlineView:",L),u("error",{message:L instanceof Error?L.message:"Failed to initialize component",stage:"generation"})}}function $(){return h}async function J(){if(!h){if(v){await v;return}throw new Error("Component not mounted")}}ot(()=>n(),()=>{n().lastUpdated&&m(n().isEmpty)}),Pt(),wt();var Z=Sv(),D=f(Z);Ot(D,L=>y(M,L),()=>o(M));var q=g(D,2);Ot(q,L=>y(S,L),()=>o(S));var R=g(q,2);xv(R,{get editorStore(){return p},placeholder:"Navigation content will be auto-generated from your chapters...",$$events:{contentChanged:I}}),Ge("keydown",Z,O),x(r,Z),Ft(e,"loadNavigationContent",k),Ft(e,"saveNavigationContent",C),Ft(e,"isReady",$),Ft(e,"waitForReady",J);var T=et({loadNavigationContent:k,saveNavigationContent:C,isReady:$,waitForReady:J});return a(),T}var kv=P('<div><div class="content-preview__container svelte-166aukc"><div class="content-preview__letterbox svelte-166aukc"><iframe class="content-preview__iframe svelte-166aukc" title="Content Preview"></iframe></div></div></div>');function Tv(r,e){Qe(e,!1);let t=W(e,"content",8),a=W(e,"deviceSize",8,"responsive"),n=W(e,"orientation",8,"portrait"),i=W(e,"fontSizeAdjustment",8,0),s=W(e,"fontFamily",8,"default"),l=W(e,"class",8,"");const d={"old-iphone":{width:375,height:667,fontSize:16,margin:12,lineHeight:1.4},"recent-iphone":{width:390,height:844,fontSize:17,margin:14,lineHeight:1.4},"large-iphone":{width:430,height:932,fontSize:18,margin:16,lineHeight:1.4},"small-tablet":{width:744,height:1133,fontSize:20,margin:20,lineHeight:1.5},"medium-tablet":{width:820,height:1180,fontSize:22,margin:24,lineHeight:1.5},"large-tablet":{width:1024,height:1366,fontSize:24,margin:28,lineHeight:1.5}};let u=je(),c=je(),p=je();function h(O,A){if(O==="responsive")return null;const $=d[O];return A==="landscape"?{width:$.height,height:$.width}:{width:$.width,height:$.height}}function v(O,A){if(O==="responsive")return"";const $=d[O];return`body {
      font-size: ${$.fontSize+A}px;
      margin: ${$.margin}px;
      line-height: ${$.lineHeight};
    }`}function m(O,A,$,J){if(!O)return;const Z=O.contentDocument;if(!Z)return;const D=Z.head.querySelector(".device-injected-styles");D&&D.remove();let q="";if(q+=v(A,J),q){const R=Z.createElement("style");R.className="device-injected-styles",R.textContent=q;const T=Z.head.querySelector('style, link[rel="stylesheet"]');T?Z.head.insertBefore(R,T):Z.head.appendChild(R)}}function w(O,A){const $=O.width/A.width,J=O.height/A.height;return Math.min($,J)}function b(){if(!o(u)||!o(c)||!o(p))return;const O=h(a(),n());if(!O){qe(c,o(c).style.transform=""),qe(c,o(c).style.width="100%"),qe(c,o(c).style.height="100%"),qe(p,o(p).style.width="100%"),qe(p,o(p).style.height="100%");return}const A=o(u).getBoundingClientRect(),$=w(A,O);qe(p,o(p).style.width=`${O.width}px`),qe(p,o(p).style.height=`${O.height}px`),qe(c,o(c).style.transform=`scale(${$})`),qe(c,o(c).style.transformOrigin="center"),qe(c,o(c).style.width=`${O.width}px`),qe(c,o(c).style.height=`${O.height}px`)}function k(){o(p)&&m(o(p),a(),s(),i())}nn(()=>{b();let O=null;return typeof ResizeObserver<"u"&&(O=new ResizeObserver(()=>{b()})),o(u)&&O&&O.observe(o(u)),()=>{O&&O.disconnect()}}),ot(()=>(o(p),Ze(t())),()=>{o(p)&&t()&&qe(p,o(p).srcdoc=t())}),ot(()=>(o(u),o(c),o(p)),()=>{o(u)&&o(c)&&o(p)&&b()}),ot(()=>(o(p),Ze(a()),Ze(s()),Ze(i())),()=>{o(p)&&m(o(p),a(),s(),i())}),Pt(),wt();var C=kv(),I=f(C),M=f(I),S=f(M);Ot(S,O=>y(p,O),()=>o(p)),Ot(I,O=>y(c,O),()=>o(c)),Ot(C,O=>y(u,O),()=>o(u)),U(()=>{nt(C,1,`content-preview ${l()??""}`,"svelte-166aukc"),ve(S,"srcdoc",t())}),Ge("load",S,k),x(r,C),et()}class Xt extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="WorkspaceServiceError"}}class Cv extends Xt{constructor(e){super(`Workspace not found: ${e}. Please check workspace ID.`,"WORKSPACE_NOT_FOUND",e),this.name="WorkspaceNotFoundError"}}class Fv extends Xt{constructor(e,t){super(`OPF file corrupted in workspace ${e}: ${t}. Try reimporting the EPUB.`,"OPF_CORRUPTED",e),this.name="OPFCorruptedError"}}class an extends Xt{constructor(e,t){super(e,"VALIDATION_ERROR"),this.context=t,this.name="ValidationError",this.context=t}}class vo{constructor(e){this.fileStorage=e,this.extensionManager=new _i(e)}extensionManager;async createWorkspace(e){const t=this.generateWorkspaceId(),a={...e,modifiedDate:fn()};await this.fileStorage.createWorkspace(t);const n={version:"3.0",metadata:{...a,epubVersion:"3.0"},manifest:[],spine:[],guide:[]};return await this.createEPUBStructure(t,n),{id:t,opf:n,pathInfo:{rootfilePath:"OEBPS/content.opf",basePath:"OEBPS",opfFileName:"content.opf"}}}async populateWithContent(e,t){for(const s of t.assets)await this.fileStorage.writeTextFile(e,s.path,s.content);for(const s of t.chapters)await this.fileStorage.writeTextFile(e,`SOURCE/text/${s.fileName}`,s.content),await this.fileStorage.writeTextFile(e,`OEBPS/Text/${s.id}.xhtml`,s.xhtmlContent);const a=await this.loadWorkspace(e),n={...a.opf,manifest:[...a.opf.manifest,...t.manifestUpdates],spine:[...a.opf.spine,...t.spineUpdates]},i=gt.generateOPFXML(n);return await this.fileStorage.writeTextFile(e,a.pathInfo.rootfilePath,i),{...a,opf:n}}async loadWorkspace(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Cv(e);const a=await this.getWorkspacePathInfo(e),n=await this.fileStorage.readTextFile(e,a.rootfilePath);let i;try{i=gt.parseOPFDocument(n)}catch(s){throw new Fv(e,s instanceof Error?s.message:"Unknown parsing error")}return{id:e,opf:i,pathInfo:a}}catch(t){throw t instanceof Xt?t:new Xt(`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e)}}async saveWorkspace(e){const t={...e},a=gt.generateOPFXML(t.opf);return await this.fileStorage.writeTextFile(e.id,e.pathInfo.rootfilePath,a),t}async deleteWorkspace(e){try{await this.fileStorage.deleteWorkspace(e)}catch(t){if(t instanceof Error&&!t.message.includes("not found"))throw new Xt(`Failed to delete workspace: ${t.message}`,"DELETE_ERROR",e)}}async updateMetadata(e,t){this.validateMetadataUpdates(t);const a={...e,opf:{...e.opf,metadata:{...e.opf.metadata,...t}}};return await this.saveWorkspace(a)}async addManifestItem(e,t){if(!t.href)throw new an("Manifest item must have href");const a=t.id||this.generateManifestId(t.href,new Set(e.opf.manifest.map(s=>s.id)));if(e.opf.manifest.some(s=>s.id===a))throw new an(`Manifest item with ID '${a}' already exists`);const n={id:a,href:t.href,mediaType:t.mediaType||this.detectMediaType(t.href),properties:t.properties,fallback:t.fallback};let i={...e,opf:{...e.opf,manifest:[...e.opf.manifest,n],metadata:{...e.opf.metadata,modifiedDate:fn()}}};return(n.mediaType==="text/javascript"||n.mediaType==="application/javascript")&&(i=this.addScriptedPropertiesToChapters(i)),await this.saveWorkspace(i)}async removeManifestItem(e,t){const a=e.opf.manifest.findIndex(l=>l.id===t);if(a===-1)throw new an(`Manifest item with ID '${t}' not found`);const n=e.opf.manifest[a],i=n.mediaType==="text/javascript"||n.mediaType==="application/javascript";try{const l=this.resolveManifestPath(n.href,e.pathInfo.basePath);await this.fileStorage.deleteFile(e.id,l)}catch(l){console.warn(`Failed to delete file for manifest item ${t}:`,l)}let s={...e,opf:{...e.opf,manifest:e.opf.manifest.filter(l=>l.id!==t),spine:e.opf.spine.filter(l=>l.idref!==t),metadata:{...e.opf.metadata,modifiedDate:fn()}}};return i&&(s=this.addScriptedPropertiesToChapters(s)),await this.saveWorkspace(s)}async updateManifestItem(e,t,a){const n=e.opf.manifest.findIndex(c=>c.id===t);if(n===-1)throw new an(`Manifest item with ID '${t}' not found`);const i=e.opf.manifest[n];if(a.href&&a.href!==i.href){const c=this.resolveManifestPath(i.href,e.pathInfo.basePath),p=this.resolveManifestPath(a.href,e.pathInfo.basePath);if(await this.fileStorage.fileExists(e.id,c))try{await this.fileStorage.renameFile(e.id,c,p)}catch(h){throw new Xt(`Failed to move file from ${i.href} to ${a.href}: ${h instanceof Error?h.message:"Unknown error"}`,"FILE_MOVE_ERROR",e.id)}}const s=i.mediaType==="text/javascript"||i.mediaType==="application/javascript",l=a.mediaType==="text/javascript"||a.mediaType==="application/javascript",d=[...e.opf.manifest];d[n]={...d[n],...a,id:t};let u={...e,opf:{...e.opf,manifest:d,metadata:{...e.opf.metadata,modifiedDate:fn()}}};return s!==l&&(u=this.addScriptedPropertiesToChapters(u)),await this.saveWorkspace(u)}async updateSpineOrder(e,t){const a=new Set(e.opf.manifest.map(l=>l.id)),n=t.filter(l=>!a.has(l));if(n.length>0)throw new an(`Spine items reference missing manifest items: ${n.join(", ")}`);const i=t.map(l=>({idref:l})),s={...e,opf:{...e.opf,spine:i,metadata:{...e.opf.metadata,modifiedDate:fn()}}};return await this.saveWorkspace(s)}async addSpineItem(e,t,a){if(!e.opf.manifest.some(l=>l.id===t.idref))throw new an(`Referenced manifest item not found: ${t.idref}`);if(e.opf.spine.some(l=>l.idref===t.idref))throw new an(`Spine item with idref '${t.idref}' already exists`);const n=[...e.opf.spine],i=a??n.length;n.splice(i,0,t);const s={...e,opf:{...e.opf,spine:n,metadata:{...e.opf.metadata,modifiedDate:fn()}}};return await this.saveWorkspace(s)}async removeSpineItem(e,t){if(e.opf.spine.findIndex(i=>i.idref===t)===-1)throw new an(`Spine item with idref '${t}' not found`);const n={...e,opf:{...e.opf,spine:e.opf.spine.filter(i=>i.idref!==t),metadata:{...e.opf.metadata,modifiedDate:fn()}}};return await this.saveWorkspace(n)}async listWorkspaces(){const e=await this.fileStorage.listWorkspaces(),t=[];for(const a of e)try{const n=await this.loadWorkspace(a),i=await this.fileStorage.listFiles(a),s=0;let l;try{l=(await this.fileStorage.getFileInfo(a,n.pathInfo.rootfilePath)).lastModified}catch{l=n.opf.metadata.modifiedDate?new Date(n.opf.metadata.modifiedDate):new Date}let d;try{const u=await this.extensionManager.listWorkspaceExtensions(a);u.length>0&&(d=u.map(c=>c.name))}catch{}t.push({id:a,title:n.opf.metadata.title,language:n.opf.metadata.language,lastModified:l,fileCount:i.length,totalSize:s,author:n.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0",extensionIds:d})}catch{continue}return t}async workspaceExists(e){try{return(await this.fileStorage.listWorkspaces()).includes(e)}catch{return!1}}async loadChapterContents(e,t){const a=[];for(const n of t){const i=e.opf.manifest.find(l=>l.id===n),s=e.opf.spine.find(l=>l.idref===n);if(!(!i||!s))try{const l=this.resolveManifestPath(i.href,e.pathInfo.basePath),d=await this.fileStorage.readTextFile(e.id,l);a.push({id:n,href:i.href,xhtmlContent:d,linear:s.linear??!0,mediaType:i.mediaType||"application/xhtml+xml"})}catch{continue}}return a}async loadAllLinearChapterContents(e){const t=e.opf.spine.filter(a=>a.linear!==!1).map(a=>a.idref);return this.loadChapterContents(e,t)}generateWorkspaceId(){return"workspace-"+crypto.randomUUID()}async createEPUBStructure(e,t){await this.fileStorage.writeTextFile(e,"mimetype","application/epub+zip");const a=gt.generateContainerXML();await this.fileStorage.writeTextFile(e,"META-INF/container.xml",a);const n=gt.generateOPFXML(t);await this.fileStorage.writeTextFile(e,"OEBPS/content.opf",n)}async getWorkspacePathInfo(e){try{const t=await this.fileStorage.readTextFile(e,"META-INF/container.xml"),a=gt.parseContainerXml(t);if(a.error)throw new Error(a.error);const n=a.rootfilePath,i=n.lastIndexOf("/");if(i===-1)return{rootfilePath:n,basePath:"",opfFileName:n};const s=n.substring(0,i),l=n.substring(i+1);return{rootfilePath:n,basePath:s,opfFileName:l}}catch(t){throw new Xt(`Failed to parse workspace container.xml: ${t instanceof Error?t.message:"Unknown error"}`,"INVALID_CONTAINER_STRUCTURE",e)}}validateMetadataUpdates(e){if(e.title!==void 0&&e.title.trim()==="")throw new an("Title cannot be empty");if(e.language!==void 0&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language))throw new an("Invalid language code format")}addScriptedPropertiesToChapters(e){const t=e.opf.manifest.some(n=>n.mediaType==="text/javascript"||n.mediaType==="application/javascript"),a=e.opf.manifest.map(n=>{if(n.mediaType==="application/xhtml+xml"&&n.id!=="nav"&&!n.properties?.includes("nav")){const i=n.properties||[],s=i.includes("scripted");if(t&&!s)return{...n,properties:[...i,"scripted"]};if(!t&&s){const l=i.filter(d=>d!=="scripted");return{...n,properties:l.length>0?l:void 0}}}return n});return{...e,opf:{...e.opf,manifest:a}}}generateManifestId(e,t){const i=(e.split("/").pop()||"item").replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"-").replace(/^[^a-zA-Z]/,"item-").toLowerCase();let s=i,l=1;for(;t.has(s);)s=`${i}-${l++}`;return s}detectMediaType(e){const t=e.split(".").pop()?.toLowerCase()||"";return{xhtml:"application/xhtml+xml",html:"application/xhtml+xml",css:"text/css",js:"application/javascript",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",mp3:"audio/mpeg",mp4:"video/mp4",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2"}[t]||"application/octet-stream"}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}async fileExists(e,t){try{return await this.fileStorage.readFile(e,t),!0}catch{return!1}}async readFile(e,t){try{return await this.fileStorage.readFile(e,t)}catch(a){throw new Xt(`Failed to read file ${t}: ${a instanceof Error?a.message:"Unknown error"}`,"READ_FILE_ERROR",e)}}async writeFile(e,t,a){try{const i=new TextEncoder().encode(a),s=new ArrayBuffer(i.length);new Uint8Array(s).set(i),await this.fileStorage.writeFile(e,t,s)}catch(n){throw new Xt(`Failed to write file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_FILE_ERROR",e)}}async writeBinaryFile(e,t,a){try{await this.fileStorage.writeFile(e,t,a)}catch(n){throw new Xt(`Failed to write binary file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_BINARY_FILE_ERROR",e)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e.id)).filter(i=>Xn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const s=await this.fileStorage.getFileInfo(e.id,i),l={path:i,name:i.split("/").pop()||i,type:"file",size:s.size,modified:s.lastModified,mediaType:this.detectMediaTypeForSource(i)};n.push(l)}catch{continue}return n}catch(t){throw new Xt(`Failed to list SOURCE files: ${t instanceof Error?t.message:"Unknown error"}`,"LIST_SOURCE_FILES_ERROR",e.id)}}detectMediaTypeForSource(e){const t=e.split(".").pop()?.toLowerCase()||"",a=co(e),n={txt:"text/plain",md:"text/markdown",json:"application/json",js:"application/javascript",ts:"application/typescript",css:"text/css",html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",py:"text/x-python",sh:"application/x-sh"};return n[t]||"text/plain"}async getFileInfo(e,t){return await this.fileStorage.getFileInfo(e,t)}}class Yi{static validateSyntax(e){if(!e.trim())return null;try{const t=new Function(e);try{const a={console:{log:()=>{},warn:()=>{},error:()=>{}},window:{},document:{querySelector:()=>null,createElement:()=>({}),addEventListener:()=>{}},setTimeout:()=>0,setInterval:()=>0,clearTimeout:()=>{},clearInterval:()=>{},fetch:()=>Promise.resolve(),Math,JSON,Date,Array,Object,String,Number,Boolean,RegExp};return t.call(a),null}catch(a){return a instanceof ReferenceError?`JavaScript reference error: ${a.message}`:a instanceof TypeError?`JavaScript type error: ${a.message}`:`JavaScript runtime error: ${a instanceof Error?a.message:String(a)}`}}catch(t){return t instanceof SyntaxError?`JavaScript syntax error: ${t.message}`:`JavaScript validation error: ${t instanceof Error?t.message:String(t)}`}}static shouldValidate(e){return e.includes("javascript")||e.includes("js")}}const Iv=`/* Universal CSS for all locales with EPUB reading system compatibility */

body {
  /* System fonts with enhanced stack for global language support */
  font-family:
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    'Noto Sans',
    'Liberation Sans',
    sans-serif;
  font-display: swap; /* Better loading performance */

  /* Enhanced typography for reading contexts */
  font-size: 1.125rem; /* Slightly larger base for better readability */
  line-height: 1.6;

  /* Progressive enhancement: physical properties first, then logical */
  margin-left: auto;
  margin-right: auto;
  padding: 1em;
  max-width: 65ch;

  /* Modern logical properties with feature query protection */
}

@supports (margin-inline: auto) {
  body {
    margin-left: unset;
    margin-right: unset;
    max-width: unset;
    margin-inline: auto;
    max-inline-size: 65ch;
  }
}

/* Additional language-specific adjustments */
:lang(ja),
:lang(ko),
:lang(zh) {
  line-height: 1.8; /* Better spacing for CJK characters */
}

:lang(ar),
:lang(he) {
  line-height: 1.7; /* Improved RTL script readability */
}

/* Enhanced text flow and hyphenation */
body {
  hyphens: auto;
  -webkit-hyphens: auto;
  -ms-hyphens: auto;
}

/* Inherits direction from html[dir] set by i18n system */
body {
  direction: inherit;
}

/* Headings with progressive enhancement for logical spacing */
h1,
h2,
h3,
h4,
h5,
h6 {
  /* Physical properties first for compatibility */
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  margin-left: 0;
  margin-right: 0;
  font-weight: 600;
  line-height: 1.2;
}

@supports (margin-block-start: 1.5em) {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: unset;
    margin-bottom: unset;
    margin-left: unset;
    margin-right: unset;
    margin-block-start: 1.5em;
    margin-block-end: 0.5em;
    margin-inline: 0;
  }
}

h1 {
  font-size: 2em;
  padding-bottom: 0.25em;
}

h2 {
  font-size: 1.5em;
}

h3 {
  font-size: 1.25em;
}

/* Paragraphs with progressive enhancement */
p {
  /* Physical properties first */
  margin-bottom: 1em;
  text-align: left; /* Will be overridden for RTL */
}

/* RTL-specific physical fallback */
[data-dir='rtl'] p {
  text-align: right;
}

/* Lists with progressive enhancement */
ul,
ol {
  /* Physical properties first */
  margin-top: 1em;
  margin-bottom: 1em;
  padding-left: 2em;
}

li {
  margin-bottom: 0.5em;
}

/* Blockquotes with progressive enhancement */
blockquote {
  /* Physical properties first */
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  margin-left: 2em;
  margin-right: 0;
  padding-left: 1em;
  font-style: italic;
}

/* Code blocks with progressive enhancement */
pre,
code {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
  font-size: 0.875em;
}

pre {
  padding: 1em;
  border-radius: 4px;
  overflow-x: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

code {
  padding-left: 0.25em;
  padding-right: 0.25em;
  border-radius: 2px;
}

/* Images with progressive enhancement */
img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Strong and emphasis with universal styling */
strong {
  font-weight: 600;
}

em {
  font-style: italic;
}
`,Zi=`/**
 * Universal Text Transform Script
 *
 * Converts markdown text to HTML without any locale-specific logic.
 * Works identically for all languages, scripts, and text directions.
 */

/**
 * Convert simple markdown to well-formed XHTML
 * @param {string} markdown - Markdown text
 * @returns {string} Valid XHTML output
 */
function transformText(markdown) {
  // Split content into blocks (separated by double newlines)
  const blocks = markdown.split(/\\n\\s*\\n/).filter(block => block.trim());
  const htmlBlocks = [];

  for (const block of blocks) {
    const trimmedBlock = block.trim();
    if (!trimmedBlock) continue;

    // Check if block is a header
    const headerMatch = trimmedBlock.match(/^(#{1,6})\\s+(.+)$/);
    if (headerMatch) {
      const level = headerMatch[1].length;
      const text = processInlineFormatting(headerMatch[2]);
      htmlBlocks.push(\`<h\${level}>\${text}</h\${level}>\`);
    } else {
      // Process as paragraph content
      let paragraphContent = processInlineFormatting(trimmedBlock);
      // Convert single newlines to <br/> within paragraphs
      paragraphContent = paragraphContent.replace(/\\n/g, '<br/>');
      htmlBlocks.push(\`<p>\${paragraphContent}</p>\`);
    }
  }

  return htmlBlocks.join('\\n');
}

/**
 * Process inline formatting (bold, italic) within text
 * @param {string} text - Text to process
 * @returns {string} Text with inline HTML tags
 */
function processInlineFormatting(text) {
  let result = text;
  
  // Bold and italic (process bold first to handle overlap correctly)
  result = result.replace(/\\*\\*\\*(.*?)\\*\\*\\*/g, '<strong><em>$1</em></strong>');
  result = result.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');
  result = result.replace(/\\*(.*?)\\*/g, '<em>$1</em>');
  
  return result;
}

// Export for use in EPUB transform pipeline
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { transformText };
}
`,Pv=`/**
 * Universal DOM Transform Script
 *
 * Adds ID attributes to H2 elements to make them usable as URL fragments
 * in nav.xhtml for table of contents linking. Works universally across
 * all languages without any locale-specific logic.
 */

/**
 * Transform DOM by adding IDs to H2 headings for navigation
 * @param {Document} htmlDocument - HTML document to transform
 * @returns {Document} Transformed document with H2 IDs
 */
function transformDOM(htmlDocument) {
  try {
    // Find all H2 elements in the document
    const h2Elements = htmlDocument.querySelectorAll('h2');

    h2Elements.forEach((h2, index) => {
      // Skip if already has an ID
      if (h2.getAttribute('id')) {
        return;
      }

      // Generate ID from text content or use fallback
      const text = h2.textContent || '';
      let id = text
        .toLowerCase()
        .replace(/[^a-z0-9\\s-]/g, '') // Remove special characters
        .replace(/\\s+/g, '-') // Replace spaces with hyphens
        .replace(/-+/g, '-') // Collapse multiple hyphens
        .replace(/^-|-$/g, '') // Remove leading/trailing hyphens
        .substring(0, 50); // Limit length

      // Fallback if no usable text
      if (!id) {
        id = \`heading-\${index + 1}\`;
      }

      // Ensure ID is unique in document
      let finalId = id;
      let counter = 1;
      while (htmlDocument.getElementById(finalId)) {
        finalId = \`\${id}-\${counter}\`;
        counter++;
      }

      // Set the ID attribute
      h2.setAttribute('id', finalId);
    });

    return htmlDocument;
  } catch (error) {
    console.error('DOM transform error:', error);
    return htmlDocument;
  }
}

// Export for use in EPUB transform pipeline
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { transformDOM };
}
`;class mo extends Error{constructor(e,t){super(e),this.code=t,this.name="ContentServiceError"}}class Mv extends mo{constructor(e){super(`Unsupported locale: ${e}`,"UNSUPPORTED_LOCALE"),this.name="UnsupportedLocaleError"}}class sa{constructor(e,t){this.transformExecutor=e,this.i18nSystem=t}static SUPPORTED_LOCALES=new Set(["en","es","fr","de","it","pt","nl","sv","da","no","fi","ru","pl","cs","hu","ro","bg","hr","sk","sl","et","lv","lt","el","tr","ar","he","fa","ur","hi","bn","ta","te","ml","kn","gu","pa","or","as","ne","si","my","km","lo","vi","th","id","ms","tl","zh","ja","ko"]);static RTL_LOCALES=new Set(["ar","he","fa","ur"]);async generateSampleContentData(e="en"){try{const t=await this.generateLocalizedContent(e),{chapters:a,isRTL:n}=t,i=[];for(const c of a){const p=await this.transformContent(c.content),h=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="${e}"${n?' dir="rtl"':""}>
<head>
  <title>${c.title}</title>
  <link rel="stylesheet" type="text/css" href="../Styles/page.css"/>
</head>
<body>
  ${p.xhtml}
</body>
</html>`;i.push({id:c.id,title:c.title,fileName:`${c.id}.txt`,content:c.content,xhtmlContent:h})}const s=this.generateNavigationContent(a,e,n),l=[{path:"OEBPS/Styles/page.css",content:Iv},{path:"SOURCE/scripts/transformText.js",content:Zi},{path:"SOURCE/scripts/transformDom.js",content:Pv},{path:"SOURCE/settings.json",content:JSON.stringify({version:"1.0.0",text_transform:"transformText.js",dom_transforms:["transformDom.js"]},null,2)},{path:"OEBPS/Text/nav.xhtml",content:s}],d=[{id:"page-css",href:"Styles/page.css",mediaType:"text/css"},{id:"nav",href:"Text/nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]},...a.map(c=>({id:c.id,href:`Text/${c.id}.xhtml`,mediaType:"application/xhtml+xml"}))],u=a.map(c=>({idref:c.id}));return{chapters:i,assets:l,manifestUpdates:d,spineUpdates:u}}catch(t){throw new mo(`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,"SAMPLE_CONTENT_ERROR")}}generateNavigationContent(e,t,a){const n=this.i18nSystem.translate("navigation.title")||"Navigation",i=this.i18nSystem.translate("navigation.tableOfContents")||"Table of Contents",s=e.map(l=>{const d=this.i18nSystem.translate(`content.${l.id}`)||l.title;return`      <li><a href="${l.id}.xhtml">${this.escapeHtml(d)}</a></li>`}).join(`
`);return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="${t}"${a?' dir="rtl"':""}>
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" id="toc">
    <h1>${this.escapeHtml(i)}</h1>
    <ol>
${s}
    </ol>
  </nav>
</body>
</html>`}async transformContent(e,t){const a=Date.now(),n=[];try{const i=await this.transformExecutor.executeTextTransform(Zi,"transformText.js",e,t||{},{timeoutMs:5e3}),s=Date.now()-a;return{xhtml:i,warnings:n,transformTime:s}}catch(i){const s=Date.now()-a,l=i instanceof Error?i.message:"Unknown transform error";return{xhtml:`<p>${this.escapeHtml(e)}</p>`,warnings:[l],transformTime:s}}}async previewContent(e,t){const a=await this.transformContent(e,t);return{previewHtml:a.xhtml,warnings:a.warnings}}generateNavigationFromContent(e){const a=e.filter(s=>s.linear).map(s=>{const l=this.extractTitleFromXHTML(s.xhtmlContent)||s.id;return`    <li><a href="${s.href}">${this.escapeHtml(l)}</a></li>`}).join(`
`),n=this.i18nSystem.translate("navigation.tableOfContents");return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(n)}</h1>
    <ol>
${a}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}processUserNavigation(e){const t=this.i18nSystem.translate("navigation.tableOfContents");if(!e.trim())return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(t)}</h1>
    <ol></ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}};const n=this.parseNavigationEntries(e).map(s=>`    <li><a href="${s.href}">${this.escapeHtml(s.title)}</a></li>`).join(`
`);return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(t)}</h1>
    <ol>
${n}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}async generateLocalizedContent(e){if(!sa.SUPPORTED_LOCALES.has(e))throw new Mv(e);const t=sa.RTL_LOCALES.has(e),a=await this.generateLocalizedMetadata(e),n=await this.generateLocalizedChapters(e);return{locale:e,metadata:a,chapters:n,isRTL:t,pageProgressionDirection:t?"rtl":"ltr"}}async generateLocalizedMetadata(e){const t=this.i18nSystem.translate("sample.title"),a=this.i18nSystem.translate("sample.author"),n=this.i18nSystem.translate("sample.description");return{title:t||"Sample Book",language:e,identifier:`urn:uuid:sample-${Date.now()}`,creator:[a||"Sample Author"],description:n||"A sample book for demonstration purposes",modifiedDate:fn()}}async generateLocalizedChapters(e){return[{id:"chapter1",title:this.i18nSystem.translate("content.chapter1")||"Chapter 1",content:this.generateSampleChapterContent(e,1),linear:!0,mediaType:"application/xhtml+xml"},{id:"chapter2",title:this.i18nSystem.translate("content.chapter2")||"Chapter 2",content:this.generateSampleChapterContent(e,2),linear:!0,mediaType:"application/xhtml+xml"}]}extractTitleFromXHTML(e){try{const a=new DOMParser().parseFromString(e,"text/xml"),n=["h1","h2","h3","h4","h5","h6"];for(const i of n){const s=a.querySelector(i);if(s&&s.textContent?.trim())return s.textContent.trim()}return null}catch{return null}}parseNavigationEntries(e){const t=[],a=e.split(`
`);for(const n of a){const i=n.trim();if(!i||i.startsWith("#"))continue;const s=i.match(/\[([^\]]+)\]\(([^)]+)\)/);if(s){t.push({title:s[1],href:s[2]});continue}const l=i.match(/^(.+?)\s*-\s*(.+)$/);if(l){t.push({title:l[1].trim(),href:l[2].trim()});continue}const d=i.match(/^-\s*(.+)$/);if(d){const u=d[1].trim();t.push({title:u,href:`Text/${u.toLowerCase().replace(/\s+/g,"_")}.xhtml`})}}return t}generateSampleChapterContent(e,t){return`
${`# ${this.i18nSystem.translate(`content.chapter${t}`)||`Chapter ${t}`}`}

This is sample content for demonstration purposes.

## Section 1

Here is some **bold text** and *italic text*.

## Section 2

Here is more sample content with additional paragraphs to demonstrate the transformation process.

This concludes the sample chapter.
    `.trim()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}validateFileContent(e,t){return Yi.shouldValidate(t)?Yi.validateSyntax(e):null}}class go{fileStorage;constructor(){this.fileStorage=Dt.getInstance()}async unpackEPUB(e,t){try{this.fileStorage.isInitialized()||await this.fileStorage.init();const a=await e.arrayBuffer(),n=new Lr(a),i=await this.validateEPUBStructure(n);if(!i.isValid)return{success:!1,error:`Invalid EPUB structure: ${i.errors.join(", ")}`};const s=await this.extractToWorkspace(n,t);return{success:s.success,workspaceId:t,extractedFiles:s.extractedFiles,totalSize:s.totalBytes,processedFiles:s.extractedFiles.length,error:s.errors.length>0?s.errors.join("; "):void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}}async validateEPUBStructure(e){const t=[],a=[];let n,i,s;const l=e.entries.map(d=>d.fileName);if(!l.includes("mimetype"))t.push("Missing required mimetype file");else try{const d=e.entries.find(u=>u.fileName==="mimetype");if(d){const c=await(await d.extract()).text();c.trim()!=="application/epub+zip"&&t.push(`Invalid mimetype content: "${c.trim()}" (expected "application/epub+zip")`)}}catch{t.push("Failed to read mimetype file content")}if(!l.includes("META-INF/container.xml"))t.push("Missing required META-INF/container.xml file");else try{const d=e.entries.find(u=>u.fileName==="META-INF/container.xml");if(d){const c=await(await d.extract()).text(),p=gt.validateXML(c);if(!p.isValid)t.push(`Invalid XML in container.xml: ${p.error}`);else{const h=gt.parseContainerXml(c);if(h.error)t.push(h.error);else if(h.rootfilePath){i=h.rootfilePath;const v=i.split("/");v.length>1&&(s=v.slice(0,-1).join("/")),l.includes(i)||t.push(`Rootfile specified in container.xml not found: ${i}`)}}}}catch{t.push("Failed to parse META-INF/container.xml")}e.entries.length===0&&t.push("Empty ZIP file");for(const d of l)d.includes("..")&&t.push(`Invalid file path with directory traversal: ${d}`),d.startsWith("/")&&a.push(`Absolute path found: ${d}`);if(i&&l.includes(i))try{const d=e.entries.find(u=>u.fileName===i);if(d){const c=await(await d.extract()).text(),p=gt.validateXML(c);p.isValid?(n=gt.detectEPUBVersion(c),n||a.push("Could not detect EPUB version from OPF file")):t.push(`Invalid XML in OPF file (${i}): ${p.error}`)}}catch{t.push(`Failed to read or parse OPF file: ${i}`)}return s&&l.filter(u=>u.startsWith(s+"/")).length===0&&a.push(`No files found in package directory: ${s}/`),{isValid:t.length===0,errors:t,warnings:a,detectedVersion:n,rootfilePath:i,packageDirectory:s}}async extractToWorkspace(e,t){const a=[],n=[],i=[];let s=0;try{await this.fileStorage.createWorkspace(t)}catch(u){if(u instanceof Error&&!u.message.includes("already exists"))return i.push(`Failed to create workspace: ${u.message}`),{success:!1,extractedFiles:a,totalBytes:s,skippedFiles:n,errors:i}}const l=new uo(this.fileStorage);let d=null;for(const u of e.entries)try{if(u.fileName.endsWith("/"))continue;if(u.fileName==="SOURCE.zip"||u.fileName.endsWith("/SOURCE.zip")){d=u;continue}const p=await(await u.extract()).arrayBuffer();await this.fileStorage.writeFile(t,u.fileName,p),a.push(u.fileName),s+=p.byteLength}catch(c){const p=c instanceof Error?c.message:"Unknown error";i.push(`Failed to extract ${u.fileName}: ${p}`),n.push(u.fileName)}if(d)try{const u=await d.extract();await l.extractSourceZip(t,u),a.push("SOURCE.zip (extracted to SOURCE/ directory)"),s+=u.size}catch(u){const c=u instanceof Error?u.message:"Unknown error";i.push(`Failed to extract SOURCE.zip: ${c}`),n.push(d.fileName)}return{success:i.length===0,extractedFiles:a,totalBytes:s,skippedFiles:n,errors:i}}async analyzeEPUB(e){try{const t=await e.arrayBuffer(),a=new Lr(t),n=await this.validateEPUBStructure(a),i=a.entries.map(l=>l.fileName).filter(l=>!l.endsWith("/")).sort(),s=a.entries.reduce((l,d)=>l+d.uncompressedSize,0);return{isValid:n.isValid,fileCount:i.length,totalSize:s,validation:n,fileList:i}}catch(t){return{isValid:!1,fileCount:0,totalSize:0,validation:{isValid:!1,errors:[t instanceof Error?t.message:"Failed to analyze EPUB"],warnings:[]},fileList:[]}}}destroy(){this.fileStorage.destroy()}}class Nn extends Error{constructor(e,t){super(e),this.code=t,this.name="EPUBProcessorError"}}class Lv{constructor(e){this.fileStorage=e,this.epubUnpacker=new go,this.epubPackager=new bi}epubUnpacker;epubPackager;async unpackEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubUnpacker.unpackEPUB(e,t)}catch(a){throw new Nn(`Failed to unpack EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_UNPACK_ERROR")}}async validateEPUBStructure(e){try{const t=new Lr(e);return await this.epubUnpacker.validateEPUBStructure(t)}catch(t){return{isValid:!1,errors:[`Validation failed: ${t instanceof Error?t.message:"Unknown error"}`],warnings:[]}}}async packageEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubPackager.packageEPUB(e,t)}catch(a){throw new Nn(`Failed to package EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_PACKAGE_ERROR")}}parseOPFDocument(e){try{return gt.parseOPFDocument(e)}catch(t){throw new Nn(`Failed to parse OPF document: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_PARSE_ERROR")}}generateOPFXML(e){try{return gt.generateOPFXML(e)}catch(t){throw new Nn(`Failed to generate OPF XML: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_GENERATE_ERROR")}}validateXML(e){return gt.validateXML(e)}parseOPFMetadata(e){try{if(!globalThis.DOMParser)throw new Error("DOMParser not available");const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))throw new Error("Invalid OPF XML");return gt.parseOPFMetadata(a)}catch(t){throw new Nn(`Failed to parse OPF metadata: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_METADATA_PARSE_ERROR")}}parseContainerXML(e){return gt.parseContainerXml(e)}generateContainerXML(e="OEBPS/content.opf"){return gt.generateContainerXML(e)}detectEPUBVersion(e){return gt.detectEPUBVersion(e)}validateManifestSpineConsistency(e,t){return gt.validateManifestSpineConsistency(e,t)}parseRootfilePath(e){try{return gt.parseRootfilePath(e)}catch(t){throw new Nn(`Failed to parse rootfile path: ${t instanceof Error?t.message:"Unknown error"}`,"ROOTFILE_PARSE_ERROR")}}}const gn={WORKSPACE_ID:"editme_app_workspace_id",SPINE_ITEM_ID:"editme_app_spine_item_id"};class Dv{constructor(e,t,a,n,i,s,l,d=!1){this.skipReactiveEffects=d,this.fileStorage=e,this.transformEngine=l,this.extensionManager=n,this.settingsService=new Kn(e,n,i,s),this.epubProcessor=new Lv(e),this.workspaceService=new vo(e),this.contentService=new sa(t,a),this.loadGlobalSettings(),d||this.setupReactiveEffects()}fileStorage;transformEngine;extensionManager;workspaceService;contentService;settingsService;epubProcessor;#e=Ue(null);get workspace(){return o(this.#e)}set workspace(e){y(this.#e,e,!0)}#t=Ue(null);get selectedChapterId(){return o(this.#t)}set selectedChapterId(e){y(this.#t,e,!0)}#r=Ue(null);get selectedManifestItemId(){return o(this.#r)}set selectedManifestItemId(e){y(this.#r,e,!0)}#a=Ue(!1);get initialized(){return o(this.#a)}set initialized(e){y(this.#a,e,!0)}#n=Ue(!1);get isLoading(){return o(this.#n)}set isLoading(e){y(this.#n,e,!0)}#s=Ue(null);get errorMessage(){return o(this.#s)}set errorMessage(e){y(this.#s,e,!0)}#i=Ue(null);get globalSettings(){return o(this.#i)}set globalSettings(e){y(this.#i,e,!0)}#o=Ue(null);get workspaceSettings(){return o(this.#o)}set workspaceSettings(e){y(this.#o,e,!0)}#l=Ue(null);get epubSettings(){return o(this.#l)}set epubSettings(e){y(this.#l,e,!0)}get hasWorkspace(){return this.workspace!==null}get isWorkspaceReady(){return this.initialized&&this.workspace!==null}get currentWorkspaceId(){return this.workspace?.id||null}get workspaceInfo(){return this.workspace?{id:this.workspace.id,title:this.workspace.opf.metadata.title,language:this.workspace.opf.metadata.language,lastModified:new Date,fileCount:this.workspace.opf.manifest.length,totalSize:0,author:this.workspace.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0"}:null}get selectedChapter(){if(!this.workspace||!this.selectedChapterId)return null;const e=this.workspace.opf.manifest.find(t=>t.id===this.selectedChapterId);return e?{id:e.id,href:e.href,xhtmlContent:"",linear:!0,mediaType:e.mediaType||"application/xhtml+xml"}:null}get navigationItems(){return this.workspace?this.workspace.opf.spine.map((e,t)=>{const a=this.workspace.opf.manifest.find(n=>n.id===e.idref);return{id:e.idref,title:a?.id||`Chapter ${t+1}`,href:a?.href||"",order:t}}):[]}get availableChapters(){return this.workspace?this.workspace.opf.manifest.filter(e=>e.mediaType==="application/xhtml+xml").map(e=>({id:e.id,title:e.id,href:e.href})):[]}get currentTheme(){return this.globalSettings?.theme||"system"}get currentLocale(){return this.globalSettings?.locale||"en"}get editorFontSize(){return this.globalSettings?.editor_font_size||14}get isDraftMode(){return(this.workspaceSettings?.draft_id||0)>0}get currentDraftId(){return this.workspaceSettings?.draft_id||0}get isAdvancedMode(){return this.workspaceSettings?.editor?.advanced_mode??!1}getTransformEngine(){return this.transformEngine}getContentService(){return this.contentService}getSettingsService(){return this.settingsService}getExtensionManager(){return this.extensionManager}setupReactiveEffects(){dl(()=>{kt(()=>{this.workspace?.id?(this.loadWorkspaceSettings(this.workspace.id),this.loadEPUBSettings(this.workspace.id)):(this.workspaceSettings=null,this.epubSettings=null)}),kt(()=>{this.errorMessage&&setTimeout(()=>{this.errorMessage=null},5e3)})})}async initialize(){try{this.isLoading=!0,this.errorMessage=null,this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.restoreWorkspaceState(),this.initialized=!0}catch(e){throw this.errorMessage=`Failed to initialize: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async listWorkspaces(){try{return this.isLoading=!0,this.errorMessage=null,await this.workspaceService.listWorkspaces()}catch(e){throw this.errorMessage=`Failed to list workspaces: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async createWorkspace(e,t="en"){try{this.isLoading=!0,this.errorMessage=null;const a=await this.workspaceService.createWorkspace({title:e,language:t,identifier:`urn:uuid:${crypto.randomUUID()}`}),n=await this.contentService.generateSampleContentData(t),i=await this.workspaceService.populateWithContent(a.id,n);return this.workspace=i,a.id}catch(a){throw this.errorMessage=`Failed to create workspace: ${a instanceof Error?a.message:"Unknown error"}`,a}finally{this.isLoading=!1}}async loadWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.loadWorkspace(e),this.selectedChapterId=null,this.selectedManifestItemId=null,this.persistWorkspaceId(e)}catch(t){throw this.errorMessage=`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async saveWorkspace(){if(!this.workspace)throw new Error("No workspace to save");try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.saveWorkspace(this.workspace)}catch(e){throw this.errorMessage=`Failed to save workspace: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async deleteWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,await this.workspaceService.deleteWorkspace(e),this.workspace?.id===e&&(this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.clearPersistedState())}catch(t){throw this.errorMessage=`Failed to delete workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}selectChapter(e){this.selectedChapterId=e,this.persistSpineItemId(e)}selectManifestItem(e){this.selectedManifestItemId=e}async generateSampleContent(e="en"){if(!this.workspace)throw new Error("No workspace loaded");try{this.isLoading=!0,this.errorMessage=null;const t=await this.contentService.generateLocalizedContent(e);this.workspace.opf.metadata={...this.workspace.opf.metadata,...t.metadata},t.chapters.forEach((a,n)=>{const i={id:`chapter${n+1}`,href:`Text/${a.title}.xhtml`,mediaType:"application/xhtml+xml"};this.workspace.opf.manifest.push(i),this.workspace.opf.spine.push({idref:i.id,linear:!0})}),await this.saveWorkspace()}catch(t){throw this.errorMessage=`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}loadGlobalSettings(){try{this.globalSettings=this.settingsService.loadGlobalSettings()}catch(e){console.warn("Failed to load global settings:",e),this.globalSettings=this.settingsService.getDefaultGlobalSettings()}}updateGlobalSettings(e){if(!this.globalSettings)return;const t={...this.globalSettings,...e};try{this.settingsService.saveGlobalSettings(t),this.globalSettings=t}catch(a){this.errorMessage=`Failed to save global settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadWorkspaceSettings(e){try{this.workspaceSettings=await this.settingsService.loadWorkspaceSettings(e)}catch(t){console.warn("Failed to load workspace settings:",t),this.workspaceSettings=this.settingsService.getDefaultWorkspaceSettings()}}async updateWorkspaceSettings(e){if(!this.workspace||!this.workspaceSettings)return;const t={...this.workspaceSettings,...e};try{await this.settingsService.saveWorkspaceSettings(this.workspace.id,t),this.workspaceSettings=t}catch(a){this.errorMessage=`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadEPUBSettings(e){try{this.epubSettings=await this.settingsService.loadEPUBSettings(e)}catch(t){console.warn("Failed to load EPUB settings:",t),this.epubSettings=this.settingsService.getDefaultEPUBSettings()}}async updateEPUBSettings(e){if(!this.workspace||!this.epubSettings)return;const t={...this.epubSettings,...e};try{await this.settingsService.saveEPUBSettings(this.workspace.id,t),this.epubSettings=t}catch(a){this.errorMessage=`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`}}async incrementDraftId(){if(this.workspace)try{const e=await this.settingsService.incrementDraftId(this.workspace.id);this.workspaceSettings&&(this.workspaceSettings.draft_id=e);const t=this.settingsService.extractDraftInfo(this.workspace.opf.metadata.title).baseTitle;this.workspace.opf.metadata.title=this.settingsService.generateDraftTitle(t,e)}catch(e){this.errorMessage=`Failed to increment draft ID: ${e instanceof Error?e.message:"Unknown error"}`}}async packageEPUB(){if(!this.workspace)throw new Error("No workspace to package");try{this.isLoading=!0,this.errorMessage=null;const e=await this.epubProcessor.packageEPUB(this.workspace.id,{compressionLevel:"balanced",validateStructure:!0,progressCallback:t=>{console.log("Package progress:",t)}});if(!e.success)throw new Error(e.error||"Package failed");return e.blob||null}catch(e){throw this.errorMessage=`Failed to package EPUB: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async unpackEPUB(e){try{this.isLoading=!0,this.errorMessage=null;const t=await this.epubProcessor.unpackEPUB(e,`workspace-${Date.now()}`);if(!t.success)throw new Error(t.error||"Unpack failed");const a=t.workspaceId;return await this.loadWorkspace(a),a}catch(t){throw this.errorMessage=`Failed to unpack EPUB: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async restoreWorkspaceState(){try{const e=localStorage.getItem(gn.WORKSPACE_ID);if(e){await this.loadWorkspace(e);const t=localStorage.getItem(gn.SPINE_ITEM_ID);t&&(this.selectedChapterId=t)}}catch(e){console.warn("Failed to restore workspace state:",e),this.clearPersistedState()}}persistWorkspaceId(e){try{e?localStorage.setItem(gn.WORKSPACE_ID,e):localStorage.removeItem(gn.WORKSPACE_ID)}catch(t){console.warn("Failed to persist workspace ID:",t)}}persistSpineItemId(e){try{e?localStorage.setItem(gn.SPINE_ITEM_ID,e):localStorage.removeItem(gn.SPINE_ITEM_ID)}catch(t){console.warn("Failed to persist spine item ID:",t)}}clearPersistedState(){try{localStorage.removeItem(gn.WORKSPACE_ID),localStorage.removeItem(gn.SPINE_ITEM_ID)}catch(e){console.warn("Failed to clear persisted state:",e)}}cleanup(){this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.initialized=!1,this.isLoading=!1,this.errorMessage=null}}class Aa extends Error{stage;scriptName;line;column;hasCustomStack;constructor(e){super(e.message),this.name="TransformError",this.stage=e.stage,this.scriptName=e.scriptName,this.line=e.line,this.column=e.column,this.hasCustomStack=!!e.stack,e.stack&&(this.stack=e.stack)}toUserMessage(){let a=`${{loading:"Script Loading",text:"Text Transform",dom:"DOM Transform",template:"Template Generation"}[this.stage]} Error: ${this.message}`;return this.scriptName&&(a+=`
Script: ${this.scriptName}`),this.line!==void 0&&(a+=`
Line ${this.line}`),this.column!==void 0&&(a+=`
Column ${this.column}`),a}getErrorDetails(){return{stage:this.stage,message:this.message,scriptName:this.scriptName,line:this.line,column:this.column,stack:this.hasCustomStack?this.stack:void 0,userMessage:this.toUserMessage()}}}class oa{static DEFAULT_TIMEOUT_MS=2e3;async executeTextTransform(e,t,a,n,i={}){const s=i.timeoutMs||oa.DEFAULT_TIMEOUT_MS;return new Promise((l,d)=>{const u=setTimeout(()=>{d(new Aa({stage:"text",message:`Transform execution timed out after ${s}ms`,scriptName:t}))},s);try{const c=this.createSandboxedGlobals(i.globals),p=this.executeFunctionInSandbox(e,"transformText",[a,n],c,t);clearTimeout(u),l(typeof p=="string"?p:String(p))}catch(c){clearTimeout(u),d(this.createTransformError(c,"text",t))}})}async executeDOMTransform(e,t,a,n={}){const i=n.timeoutMs||oa.DEFAULT_TIMEOUT_MS;return new Promise((s,l)=>{const d=setTimeout(()=>{l(new Aa({stage:"dom",message:`Transform execution timed out after ${i}ms`,scriptName:t}))},i);try{const u=a.cloneNode(!0),c=this.createSandboxedGlobals(n.globals),p=this.executeFunctionInSandbox(e,"transformDOM",[u],c,t);clearTimeout(d),p instanceof Document?s(p):s(u)}catch(u){clearTimeout(d),l(this.createTransformError(u,"dom",t))}})}createSandboxedGlobals(e={}){const t={console,JSON,Math,Date,RegExp,String,Number,Boolean,Array,Object,document:typeof document<"u"?document:void 0,...e};return["eval","Function","setTimeout","setInterval","clearTimeout","clearInterval","setImmediate","clearImmediate","XMLHttpRequest","fetch","import","require","process","global","globalThis"].forEach(n=>{delete t[n]}),t}executeFunctionInSandbox(e,t,a,n,i){const s=Object.keys(n),l=Object.values(n),d=`(function(${s.join(", ")}) {
        ${e}

        if (typeof ${t} !== 'function') {
          throw new Error('Function ${t} is not defined or not a function');
        }

        return ${t};
      })`;return new Function("return "+d)()(...l)(...a)}createTransformError(e,t,a){const n=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;let s,l;if(i){const d=i.match(/at.*:(\d+):(\d+)/);d&&(s=parseInt(d[1],10),l=parseInt(d[2],10))}return new Aa({stage:t,message:n,scriptName:a,line:s,column:l,stack:i})}}const Rv=`/**
 * Transform Execution Environment Styles
 * 
 * Minimal styling for the iframe transform execution environment.
 * Focus on functionality over appearance since this is primarily
 * for sandboxed script execution.
 */

/* Reset and base styles */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
               'Helvetica Neue', Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: #333;
  background: #fff;
}

/* Status display */
.transform-status {
  padding: 12px 16px;
  margin-bottom: 16px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  display: none;
  border: 1px solid transparent;
}

.transform-status.visible {
  display: block;
}

/* Status variants */
.transform-status.info {
  background: #e3f2fd;
  color: #0d47a1;
  border-color: #bbdefb;
}

.transform-status.success {
  background: #e8f5e8;
  color: #2e7d32;
  border-color: #c8e6c9;
}

.transform-status.error {
  background: #ffebee;
  color: #c62828;
  border-color: #ffcdd2;
}

.transform-status.warning {
  background: #fff8e1;
  color: #f57f17;
  border-color: #ffecb3;
}

/* Debug information (hidden by default) */
.debug-info {
  margin-top: 20px;
  padding: 12px;
  background: #f5f5f5;
  border-radius: 4px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  color: #666;
  display: none;
}

.debug-info.visible {
  display: block;
}

/* Error details */
.error-details {
  margin-top: 8px;
  padding: 8px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 3px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  white-space: pre-wrap;
  word-break: break-word;
}

/* Minimal responsive adjustments */
@media (max-width: 480px) {
  body {
    padding: 12px;
  }
  
  .transform-status {
    padding: 8px 12px;
    margin-bottom: 12px;
    font-size: 13px;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .transform-status.info {
    background: #000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.success {
    background: #006600;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.error {
    background: #cc0000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.warning {
    background: #cc6600;
    color: #fff;
    border-color: #fff;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}`,zv=`/**
 * Transform Script Execution Engine
 *
 * Provides sandboxed execution of text and DOM transform scripts
 * with timeout protection and comprehensive error handling.
 *
 * This script runs inside the iframe and communicates with the parent
 * window via postMessage for security and isolation.
 */

/**
 * Transform execution environment with sandboxing and error handling
 */
class TransformExecutionEngine {
  constructor() {
    this.textTransformScript = '';
    this.domTransformScripts = [];
    this.loadedExtensionScripts = [];
    this.debugMode = false;
    this.messageHandlers = new Map();

    this.init();
  }

  /**
   * Initialize the execution environment
   */
  init() {
    this.setupMessageHandling();
    this.setupErrorHandling();
    this.signalReady();
  }

  /**
   * Set up message handling from parent window
   */
  setupMessageHandling() {
    window.addEventListener('message', event => {
      this.handleParentMessage(event.data);
    });

    // Register message handlers
    this.messageHandlers.set('SET_TRANSFORM_SCRIPTS', this.setTransformScripts.bind(this));
    this.messageHandlers.set('SET_EXTENSION_SCRIPTS', this.setExtensionScripts.bind(this));
    this.messageHandlers.set('EXECUTE_TRANSFORM', this.executeTransform.bind(this));
    this.messageHandlers.set('SET_DEBUG_MODE', this.setDebugMode.bind(this));
    this.messageHandlers.set('PING', this.handlePing.bind(this));
  }

  /**
   * Set up global error handling
   */
  setupErrorHandling() {
    window.addEventListener('error', event => {
      console.error('Global error in transform iframe:', event.error);
      this.notifyParent('GLOBAL_ERROR', {
        message: event.error?.message || 'Unknown global error',
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack,
      });
    });

    window.addEventListener('unhandledrejection', event => {
      console.error('Unhandled promise rejection in transform iframe:', event.reason);
      this.notifyParent('UNHANDLED_REJECTION', {
        message: event.reason?.message || 'Unhandled promise rejection',
        stack: event.reason?.stack,
      });
    });
  }

  /**
   * Signal ready state to parent window
   */
  signalReady() {
    this.updateStatus('Transform execution environment ready', 'success');
    this.notifyParent('IFRAME_READY');

    if (this.debugMode) {
      this.debugLog('TransformExecutionEngine initialized');
    }
  }

  /**
   * Handle incoming messages from parent window
   */
  handleParentMessage(message) {
    if (!message || typeof message !== 'object') {
      return;
    }

    const { type, payload, messageId } = message;

    if (this.debugMode) {
      this.debugLog(\`Received message: \${type}\`, payload);
    }

    try {
      const handler = this.messageHandlers.get(type);
      if (handler) {
        handler(payload, messageId);
      } else {
        console.warn('Unknown message type received:', type);
        this.respondToParent(messageId, {
          success: false,
          error: { stage: 'communication', message: \`Unknown message type: \${type}\` },
        });
      }
    } catch (error) {
      console.error('Error handling message:', error);
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'communication',
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : undefined,
        },
      });
    }
  }

  /**
   * Set transform scripts content
   */
  setTransformScripts(scripts, messageId) {
    try {
      this.textTransformScript = scripts.textTransform || '';
      this.domTransformScripts = scripts.domTransforms || [];

      const textScriptLength = this.textTransformScript.length;
      const domScriptCount = this.domTransformScripts.length;

      this.updateStatus(
        \`Loaded text transform (\${textScriptLength} chars) and \${domScriptCount} DOM transforms\`,
        'success'
      );

      if (this.debugMode) {
        this.debugLog('Transform scripts updated', {
          textTransform: textScriptLength > 0,
          domTransformCount: domScriptCount,
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'script-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load extension scripts dynamically into iframe context
   */
  async setExtensionScripts(scripts, messageId) {
    try {
      // Clear any previously loaded extension scripts
      this.clearLoadedExtensions();

      const scriptCount = scripts.length;
      this.updateStatus(\`Loading \${scriptCount} extension scripts...\`, 'info');

      // Load each script sequentially to avoid race conditions
      for (const script of scripts) {
        await this.loadExtensionScript(script.name, script.blobUrl);
      }

      this.updateStatus(\`Successfully loaded \${scriptCount} extension libraries\`, 'success');

      if (this.debugMode) {
        this.debugLog('Extension scripts loaded', {
          scriptCount,
          scripts: scripts.map(s => s.name),
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.updateStatus(\`Failed to load extension scripts: \${error.message}\`, 'error');
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'extension-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load a single extension script
   */
  async loadExtensionScript(name, blobUrl) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = blobUrl;

      // Set ID for easy identification in browser inspector
      // Convert name to valid HTML ID (replace invalid characters)
      const scriptId = \`extension-\${name.replace(/[^a-zA-Z0-9-_]/g, '-')}\`;
      script.id = scriptId;

      script.onload = () => {
        if (this.debugMode) {
          this.debugLog(\`Loaded extension script: \${name} (id: \${scriptId})\`);
        }
        // Clean up blob URL after loading
        URL.revokeObjectURL(blobUrl);
        resolve();
      };
      script.onerror = error => {
        URL.revokeObjectURL(blobUrl);
        reject(new Error(\`Failed to load extension script \${name}: \${error}\`));
      };

      // Add script to head to execute
      document.head.appendChild(script);

      // Store reference for cleanup
      if (!this.loadedExtensionScripts) {
        this.loadedExtensionScripts = [];
      }
      this.loadedExtensionScripts.push(script);
    });
  }

  /**
   * Clear previously loaded extension scripts
   */
  clearLoadedExtensions() {
    if (this.loadedExtensionScripts) {
      for (const script of this.loadedExtensionScripts) {
        if (script.parentNode) {
          script.parentNode.removeChild(script);
        }
      }
      this.loadedExtensionScripts = [];
    }
  }

  /**
   * Execute the complete transform pipeline
   */
  async executeTransform(request, messageId) {
    const { plainText, timeout = 3000 } = request;
    const startTime = performance.now();

    try {
      this.updateStatus('Executing transform pipeline...', 'info');

      if (this.debugMode) {
        this.debugLog('Starting transform execution', {
          plainTextLength: plainText.length,
          timeout,
          hasTextTransform: this.textTransformScript.length > 0,
          domTransformCount: this.domTransformScripts.length,
        });
      }

      // Step 1: Execute text transform
      let html = plainText;
      if (this.textTransformScript.trim()) {
        html = await this.executeTextTransformWithTimeout(plainText, timeout);

        if (this.debugMode) {
          this.debugLog('Text transform completed', {
            inputLength: plainText.length,
            outputLength: html.length,
          });
        }
      }

      // Step 2: Execute DOM transforms in sequence
      if (this.domTransformScripts.length > 0) {
        html = await this.executeDOMTransformsWithTimeout(html, timeout);

        if (this.debugMode) {
          this.debugLog('DOM transforms completed', {
            transformCount: this.domTransformScripts.length,
            finalLength: html.length,
          });
        }
      }

      const executionTime = performance.now() - startTime;
      this.updateStatus(\`Transform completed in \${executionTime.toFixed(2)}ms\`, 'success');

      this.respondToParent(messageId, {
        success: true,
        html,
        executionTime: Math.round(executionTime),
      });
    } catch (error) {
      const executionTime = performance.now() - startTime;
      this.updateStatus(
        \`Transform failed: \${error instanceof Error ? error.message : String(error)}\`,
        'error'
      );

      if (this.debugMode) {
        console.error('Transform execution failed', {
          error: error instanceof Error ? error.message : String(error),
          stage: error && typeof error === 'object' && 'stage' in error ? error.stage : 'unknown',
          executionTime: Math.round(executionTime),
        });
      }

      this.respondToParent(messageId, {
        success: false,
        error,
        executionTime: Math.round(executionTime),
      });
    }
  }

  /**
   * Execute text transform with timeout protection
   * @param {any} plainText
   * @param {any} timeout
   */
  executeTextTransformWithTimeout(plainText, timeout) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`Text transform execution timed out after \${timeout}ms\`);
        error.stage = 'text-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeTextTransformSync(plainText);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'text';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute text transform synchronously
   * @param {any} plainText
   */
  executeTextTransformSync(plainText) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${this.textTransformScript}

      if (typeof transformText !== 'function') {
        throw new Error('transformText function is not defined in script');
      }

      return transformText;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with input text
    const result = transformFunction(plainText);

    // Ensure result is a string
    return typeof result === 'string' ? result : String(result);
  }

  /**
   * Execute DOM transforms with timeout protection
   * @param {any} html
   * @param {any} timeout
   */
  executeDOMTransformsWithTimeout(html, timeout) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`DOM transform execution timed out after \${timeout}ms\`);
        error.stage = 'dom-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeDOMTransformsSync(html);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'dom';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute DOM transforms synchronously with direct live DOM when layout is needed
   * @param {any} html
   */
  executeDOMTransformsSync(html) {
    // Check if any transform scripts need layout calculations
    const needsLayout = this.checkIfLayoutNeeded();

    if (this.debugMode) {
      this.debugLog(\`DOM transform mode decision: needsLayout=\${needsLayout}\`, {
        scriptCount: this.domTransformScripts.length,
        scriptsWithLayout: this.domTransformScripts.filter(script =>
          script.includes('getElementLayout')
        ).length,
      });
    }

    if (needsLayout) {
      // Use live DOM approach for layout-dependent transforms
      return this.executeDOMTransformsWithLiveDOM(html);
    } else {
      // Use standard parsed document approach for simple transforms
      return this.executeDOMTransformsWithParsedDOM(html);
    }
  }

  /**
   * Check if transform scripts need layout calculations
   */
  checkIfLayoutNeeded() {
    // Simple heuristic: check if any scripts mention getElementLayout
    return this.domTransformScripts.some(script => script.includes('getElementLayout'));
  }

  /**
   * Execute DOM transforms using live DOM for layout calculations
   */
  executeDOMTransformsWithLiveDOM(html) {
    const tempContainer = this.createLiveDOMContainer();

    try {
      // Put content directly in live DOM
      tempContainer.innerHTML = html;

      if (this.debugMode) {
        this.debugLog('Live DOM container created:', {
          innerHTML: tempContainer.innerHTML.substring(0, 200) + '...',
          elementCount: tempContainer.querySelectorAll('*').length,
          containerWidth: tempContainer.offsetWidth,
          containerHeight: tempContainer.offsetHeight,
          firstElementInfo: tempContainer.firstElementChild
            ? {
                tagName: tempContainer.firstElementChild.tagName,
                offsetWidth: tempContainer.firstElementChild.offsetWidth,
                offsetHeight: tempContainer.firstElementChild.offsetHeight,
                textContent: tempContainer.firstElementChild.textContent?.substring(0, 50),
              }
            : 'no first element',
        });
      }

      // Execute transforms on live DOM elements
      for (let i = 0; i < this.domTransformScripts.length; i++) {
        try {
          // Pass the live container as a document-like object
          const mockDocument = this.createMockDocument(tempContainer);
          this.executeSingleDOMTransform(mockDocument, this.domTransformScripts[i], i);
        } catch (error) {
          if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
          throw error;
        }
      }

      // Return the transformed HTML from live DOM
      return tempContainer.innerHTML;
    } finally {
      this.cleanupTempAttachment(tempContainer);
    }
  }

  /**
   * Execute DOM transforms using parsed DOM (traditional approach)
   */
  executeDOMTransformsWithParsedDOM(html) {
    // Parse HTML to DOM document
    const parser = new DOMParser();
    let document = parser.parseFromString(
      \`<!DOCTYPE html><html><head></head><body>\${html}</body></html>\`,
      'text/html'
    );

    // Execute each DOM transform in sequence
    for (let i = 0; i < this.domTransformScripts.length; i++) {
      try {
        document = this.executeSingleDOMTransform(document, this.domTransformScripts[i], i);
      } catch (error) {
        if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
        throw error;
      }
    }

    // Return transformed HTML content with XHTML compliance
    const serializer = new XMLSerializer();
    const fullBodySerialization = serializer.serializeToString(document.body);
    return fullBodySerialization.replace(/^<body[^>]*>|<\\/body>$/g, '');
  }

  /**
   * Create a live DOM container for layout calculations
   */
  createLiveDOMContainer() {
    const container = document.createElement('div');
    container.id = 'transform-live-container';

    // Set styles via JavaScript properties instead of CSS strings
    // This works better in iframe environments
    const style = container.style;
    style.position = 'fixed';
    style.top = '0px';
    style.left = '0px';
    style.width = '800px';
    style.minHeight = '600px';
    style.visibility = 'hidden';
    style.pointerEvents = 'none';
    style.fontFamily = 'Georgia, serif';
    style.fontSize = '16px';
    style.lineHeight = '1.6';
    style.color = 'black';
    style.backgroundColor = 'white';
    style.display = 'block';
    style.boxSizing = 'border-box';
    style.padding = '20px';

    document.body.appendChild(container);

    // Force layout calculation by accessing offsetWidth immediately
    const forceLayout1 = container.offsetWidth;

    // Try a different approach if that didn't work - temporarily make visible
    if (forceLayout1 === 0) {
      style.visibility = 'visible';
      style.opacity = '0';
      const forceLayout2 = container.offsetWidth;
      style.visibility = 'hidden';
      style.opacity = '1';

      if (this.debugMode) {
        this.debugLog('Container had zero width, tried visibility workaround', {
          beforeWorkaround: forceLayout1,
          afterWorkaround: forceLayout2,
        });
      }
    }

    if (this.debugMode) {
      this.debugLog('Created live DOM container for layout calculations', {
        offsetWidth: container.offsetWidth,
        offsetHeight: container.offsetHeight,
        clientWidth: container.clientWidth,
        clientHeight: container.clientHeight,
        computedWidth: window.getComputedStyle(container).width,
        computedDisplay: window.getComputedStyle(container).display,
        parentElement: container.parentElement ? container.parentElement.tagName : 'none',
        documentBody: document.body ? 'exists' : 'missing',
      });
    }

    return container;
  }

  /**
   * Create a mock document object that uses the live container as its body
   */
  createMockDocument(container) {
    return {
      body: container,
      querySelector: selector => container.querySelector(selector),
      querySelectorAll: selector => container.querySelectorAll(selector),
      createElement: tagName => document.createElement(tagName),
      // Add other document methods as needed
    };
  }

  /**
   * Clean up temporary DOM container
   */
  cleanupTempAttachment(container) {
    if (container && container.parentNode) {
      container.parentNode.removeChild(container);

      if (this.debugMode) {
        this.debugLog('Cleaned up temporary DOM container');
      }
    }
  }

  /**
   * Execute a single DOM transform script
   * @param {any} document
   * @param {any} script
   * @param {any} index
   */
  executeSingleDOMTransform(document, script, index) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${script}

      if (typeof transformDOM !== 'function') {
        throw new Error('transformDOM function is not defined in script \${index}');
      }

      return transformDOM;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with document
    const result = transformFunction(document);

    // Ensure result is a Document, return original if not
    return result instanceof Document ? result : document;
  }

  /**
   * Create safe execution environment with restricted globals
   */
  createSafeExecutionEnvironment() {
    // Start with safe browser APIs
    const safeGlobals = {
      // Safe JavaScript built-ins
      console,
      JSON,
      Math,
      Date,
      RegExp,
      String,
      Number,
      Boolean,
      Array,
      Object,
      parseInt,
      parseFloat,
      isNaN,
      isFinite,

      // Safe DOM APIs (document is special-cased for transforms)
      document: typeof document !== 'undefined' ? document : undefined,
      DOMParser: typeof DOMParser !== 'undefined' ? DOMParser : undefined,

      // Layout calculation utilities for attached DOM elements
      getElementLayout: this.createLayoutUtility(),

      // Extension libraries are available as native window globals after dynamic loading
    };

    // Explicitly remove dangerous globals that could break sandbox
    const dangerousGlobals = [
      'eval',
      'Function',
      'setTimeout',
      'setInterval',
      'clearTimeout',
      'clearInterval',
      'setImmediate',
      'clearImmediate',
      'requestAnimationFrame',
      'XMLHttpRequest',
      'fetch',
      'WebSocket',
      'EventSource',
      'import',
      'require',
      'process',
      'global',
      'globalThis',
      'window',
      'self',
      'parent',
      'top',
      'frames',
      'location',
      'history',
      'navigator',
      'localStorage',
      'sessionStorage',
      'indexedDB',
      'Worker',
      'SharedWorker',
    ];

    dangerousGlobals.forEach(dangerous => {
      delete safeGlobals[dangerous];
    });

    return safeGlobals;
  }

  /**
   * Create layout calculation utility for transform scripts
   */
  createLayoutUtility() {
    return element => {
      // Check if this is a real DOM element in the browser
      if (!element || !element.getBoundingClientRect) {
        if (this.debugMode) {
          this.debugLog('Layout requested for non-live element, returning defaults');
        }
        return {
          width: 0,
          height: 0,
          offsetWidth: 0,
          offsetHeight: 0,
          clientWidth: 0,
          clientHeight: 0,
          scrollWidth: 0,
          scrollHeight: 0,
          isAttached: false,
        };
      }

      // Element is live DOM - calculate real layout information
      const computedStyle = window.getComputedStyle(element);
      const rect = element.getBoundingClientRect();

      const layout = {
        // Dimensions from getBoundingClientRect (actual rendered size)
        width: rect.width,
        height: rect.height,

        // Element properties (includes padding/border/scrollbars)
        offsetWidth: element.offsetWidth,
        offsetHeight: element.offsetHeight,

        // Client dimensions (content + padding, excludes scrollbars/border)
        clientWidth: element.clientWidth,
        clientHeight: element.clientHeight,

        // Scroll dimensions (total content size)
        scrollWidth: element.scrollWidth,
        scrollHeight: element.scrollHeight,

        // Computed styles (useful for layout calculations)
        marginLeft: parseInt(computedStyle.marginLeft, 10) || 0,
        marginRight: parseInt(computedStyle.marginRight, 10) || 0,
        marginTop: parseInt(computedStyle.marginTop, 10) || 0,
        marginBottom: parseInt(computedStyle.marginBottom, 10) || 0,

        paddingLeft: parseInt(computedStyle.paddingLeft, 10) || 0,
        paddingRight: parseInt(computedStyle.paddingRight, 10) || 0,
        paddingTop: parseInt(computedStyle.paddingTop, 10) || 0,
        paddingBottom: parseInt(computedStyle.paddingBottom, 10) || 0,

        borderLeftWidth: parseInt(computedStyle.borderLeftWidth, 10) || 0,
        borderRightWidth: parseInt(computedStyle.borderRightWidth, 10) || 0,
        borderTopWidth: parseInt(computedStyle.borderTopWidth, 10) || 0,
        borderBottomWidth: parseInt(computedStyle.borderBottomWidth, 10) || 0,

        // Position information
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,

        // Attachment status
        isAttached: true,
      };

      if (this.debugMode) {
        this.debugLog('Layout calculated for live DOM element', {
          tagName: element.tagName,
          width: layout.width,
          height: layout.height,
          isAttached: layout.isAttached,
        });
      }

      return layout;
    };
  }

  /**
   * Enhance error object with additional context
   */
  enhanceError(error) {
    const enhanced = {
      message: error && error.message ? error.message : 'Unknown error',
      stage: error && error.stage ? error.stage : 'unknown',
      stack: error && error.stack ? error.stack : undefined,
    };

    // Try to extract line/column information from stack trace
    if (error && error.stack) {
      const lineMatch = error.stack.match(/at.*:(\\d+):(\\d+)/);
      if (lineMatch) {
        enhanced.line = parseInt(lineMatch[1], 10);
        enhanced.column = parseInt(lineMatch[2], 10);
      }
    }

    return enhanced;
  }

  /**
   * Set debug mode
   * @param {any} enabled
   * @param {any} messageId
   */
  setDebugMode(enabled, messageId) {
    this.debugMode = Boolean(enabled);
    this.updateStatus(\`Debug mode \${this.debugMode ? 'enabled' : 'disabled'}\`, 'info');
    this.respondToParent(messageId, { success: true, debugMode: this.debugMode });
  }

  /**
   * Handle ping message for connectivity testing
   * @param {any} payload
   * @param {any} messageId
   */
  handlePing(payload, messageId) {
    const timestamp = Date.now();
    this.respondToParent(messageId, {
      success: true,
      pong: true,
      timestamp,
      payload,
    });
  }

  /**
   * Update status display in iframe
   * @param {any} message
   * @param {string} type
   */
  updateStatus(message, type = 'info') {
    const statusElement = document.getElementById('status');
    if (statusElement) {
      statusElement.textContent = message;
      statusElement.className = \`transform-status visible \${type}\`;
    }

    if (this.debugMode) {
      console.log(\`[\${type.toUpperCase()}] \${message}\`);
    }
  }

  /**
   * Send notification to parent window (no response expected)
   * @param {any} type
   * @param {any} payload
   */
  notifyParent(type, payload = {}) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ type, payload }, '*');
    }
  }

  /**
   * Respond to parent window message
   * @param {any} messageId
   * @param {any} result
   */
  respondToParent(messageId, result) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage(
        {
          type: 'TRANSFORM_RESULT',
          messageId,
          payload: {
            result: result,
          },
        },
        '*'
      );
    }
  }

  /**
   * Debug logging utility
   * @param {any} message
   * @param {any} data
   */
  debugLog(message, data = null) {
    if (this.debugMode) {
      const timestamp = new Date().toISOString();
      console.log(\`[DEBUG \${timestamp}] \${message}\`, data || '');
    }
  }
}

// Initialize the transform execution engine when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    new TransformExecutionEngine();
  });
} else {
  new TransformExecutionEngine();
}
`;class Uv{constructor(e,t){this.extensionManager=t,this.blobURLManager=e}iframe=null;messageId=0;pendingMessages=new Map;blobURLManager;async initialize(){this.iframe=this.createPersistentIframe(),document.body.appendChild(this.iframe),window.addEventListener("message",this.handleMessage.bind(this)),await this.waitForReady()}async setTransformScripts(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_TRANSFORM_SCRIPTS",e)}async executeTransform(e,t=3e3){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("EXECUTE_TRANSFORM",{plainText:e,timeout:t})}async setDebugMode(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_DEBUG_MODE",e)}async ping(e){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("PING",e)}async setWorkspaceExtensions(e){if(this.extensionManager)try{const t=await this.loadExtensionScripts(e);await this.sendMessage("SET_EXTENSION_SCRIPTS",t)}catch(t){console.error("Failed to load workspace extensions:",t)}}async loadExtensionScripts(e){if(!this.extensionManager)return[];const t=await this.extensionManager.listWorkspaceExtensions(e),a=[];for(const n of t)try{const i=n.files.filter(s=>s.type==="javascript");for(const s of i){const l=`SOURCE/extensions/${n.name}/${s.filename}`,u=await Dt.getInstance().readFile(e,l),c="application/javascript",p=new Blob([u],{type:c}),h=URL.createObjectURL(p);a.push({name:`${n.name}/${s.filename}`,blobUrl:h})}}catch(i){console.warn(`Failed to load extension ${n.name}:`,i)}return a}cleanup(){for(const[e,t]of this.pendingMessages)clearTimeout(t.timeout),t.reject(new Error("Transform engine shutting down"));this.pendingMessages.clear(),this.iframe&&(this.iframe.remove(),this.iframe=null),window.removeEventListener("message",this.handleMessage.bind(this))}createPersistentIframe(){const e=document.createElement("iframe");e.style.visibility="hidden",e.style.position="absolute",e.style.left="-9999px",e.style.top="0px",e.style.width="800px",e.style.height="600px";const t=this.createIframeDocument(),a=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(a);return e.src=n,e.onload=()=>{URL.revokeObjectURL(n)},e}createIframeDocument(){return`<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Transform Engine</title>
  <style>
${Rv}
  </style>
</head>
<body>
  <div id="status" class="transform-status">Transform engine initializing...</div>
  <script>
${zv}
  <\/script>
</body>
</html>`}async sendMessage(e,t){const a=++this.messageId;return new Promise((n,i)=>{const s=setTimeout(()=>{this.pendingMessages.delete(a),i(new Error(`Message timeout: ${e}`))},5e3);this.pendingMessages.set(a,{resolve:l=>{clearTimeout(s),n(l)},reject:l=>{clearTimeout(s),i(l)},timeout:s}),this.iframe?.contentWindow?this.iframe.contentWindow.postMessage({type:e,payload:t,messageId:a},"*"):(this.pendingMessages.delete(a),clearTimeout(s),i(new Error("Iframe not available")))})}handleMessage(e){if(e.source!==this.iframe?.contentWindow)return;const{type:t,messageId:a,payload:n}=e.data;if(t==="TRANSFORM_RESULT"&&a){const i=this.pendingMessages.get(a);if(i)if(this.pendingMessages.delete(a),n?.result?.success)i.resolve(n.result);else{const s=n?.result?.error||{message:"Unknown transform error"},l={stage:s.stage||"unknown",message:String(s.message||s||"Transform failed"),line:s.line,column:s.column,stack:s.stack};i.reject(l)}}else t==="IFRAME_READY"||(t==="GLOBAL_ERROR"||t==="UNHANDLED_REJECTION")&&console.error(`Transform engine ${t.toLowerCase()}:`,n)}waitForReady(){return new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("Transform engine initialization timeout"))},1e4),n=i=>{i.source===this.iframe?.contentWindow&&i.data.type==="IFRAME_READY"&&(clearTimeout(a),window.removeEventListener("message",n),e())};window.addEventListener("message",n)})}}class qt extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="SpineServiceError"}}class Av{constructor(e){this.workspaceService=e}async loadSpineItems(e){try{const t=[];for(const a of e.opf.spine){const n=e.opf.manifest.find(l=>l.id===a.idref);if(!n)continue;const i=`SOURCE/text/${n.id}.txt`,s=await this.workspaceService.fileExists(e.id,i);t.push({idref:n.id,linear:a.linear??!0,id:n.id,href:n.href,mediaType:n.mediaType,sourcePath:s?i:void 0,hasSourceFile:s})}return t}catch(t){throw new qt(`Failed to load spine items: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e.id)}}async addChapter(e,t){try{const a=this.generateUniqueChapterId(e),n=`Text/${a}.xhtml`,i={id:a,href:n,mediaType:"application/xhtml+xml"};let s=await this.workspaceService.addManifestItem(e,i);const l={idref:a,linear:t.linear??!0};s=await this.workspaceService.addSpineItem(s,l,t.insertIndex);const d=this.generateChapterXHTML(t.title);await this.workspaceService.writeFile(e.id,n,d);let u=!1,c;if(t.createSourceFile){c=`SOURCE/text/${a}.txt`;const h=`# ${t.title}

Your chapter content goes here...`;await this.workspaceService.writeFile(e.id,c,h),u=!0}const p={idref:a,linear:t.linear??!0,id:a,href:n,mediaType:"application/xhtml+xml",sourcePath:u?c:void 0,hasSourceFile:u};return{updatedWorkspace:s,newChapter:p}}catch(a){throw new qt(`Failed to add chapter: ${a instanceof Error?a.message:"Unknown error"}`,"ADD_CHAPTER_ERROR",e.id)}}async moveChapterUp(e,t){try{if(t<=0)throw new qt("Cannot move first chapter up","INVALID_MOVE",e.id);const a=await this.loadSpineItems(e);if(t>=a.length)throw new qt("Invalid chapter index","INVALID_INDEX",e.id);const n=[...a];return[n[t-1],n[t]]=[n[t],n[t-1]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(s=>s.id)),newOrder:n}}catch(a){throw a instanceof qt?a:new qt(`Failed to move chapter up: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async moveChapterDown(e,t){try{const a=await this.loadSpineItems(e);if(t<0||t>=a.length-1)throw new qt("Cannot move last chapter down","INVALID_MOVE",e.id);const n=[...a];return[n[t],n[t+1]]=[n[t+1],n[t]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(s=>s.id)),newOrder:n}}catch(a){throw a instanceof qt?a:new qt(`Failed to move chapter down: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async reorderItems(e,t,a){try{const n=await this.loadSpineItems(e);if(t<0||t>=n.length||a<0||a>=n.length)throw new qt("Invalid reorder indices","INVALID_INDEX",e.id);const i=[...n],[s]=i.splice(t,1);return i.splice(a,0,s),{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,i.map(d=>d.id)),newOrder:i}}catch(n){throw n instanceof qt?n:new qt(`Failed to reorder items: ${n instanceof Error?n.message:"Unknown error"}`,"REORDER_ERROR",e.id)}}generateUniqueChapterId(e){const t=new Set(e.opf.manifest.map(i=>i.id));let a=1,n=`chapter${a.toString().padStart(2,"0")}`;for(;t.has(n);)a++,n=`chapter${a.toString().padStart(2,"0")}`;return n}generateChapterXHTML(e){return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
    <title>${e}</title>
    <link rel="stylesheet" type="text/css" href="../Styles/styles.css"/>
</head>
<body>
    <section class="chapter">
        <h1>${e}</h1>
        <p>Your chapter content goes here...</p>
    </section>
</body>
</html>`}}var Ov=P('<div class="error-state svelte-1pwtvzx"><h2 class="svelte-1pwtvzx">Transform Engine Failed</h2> <p class="svelte-1pwtvzx"> </p> <p class="svelte-1pwtvzx">Please refresh the page to try again.</p></div>'),Wv=P('<div class="loading-state svelte-1pwtvzx"><div class="spinner svelte-1pwtvzx"></div> <p>Initializing transform engine...</p></div>'),jv=P('<div class="loading-state svelte-1pwtvzx"><div class="spinner svelte-1pwtvzx"></div> <p>Initializing application...</p></div>'),Bv=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),Nv=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),$v=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),Hv=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),Vv=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),qv=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),Gv=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p> <p class="current-view-info svelte-1pwtvzx"> <strong> </strong></p></div>');function Xv(r,e){Qe(e,!0);const[t,a]=ut(),n=()=>Ye(yt,"$navigationStore",t),i=()=>Ye(Rn,"$layoutStore",t),s=()=>Ye(mt,"$t",t);let l;const d={setTheme:()=>{},useSystemPreference:()=>{},getCurrentTheme:()=>"system"},u={setLocale:()=>{},getCurrentLocale:()=>"en"},c=Dt.getInstance(),p=new oa,h=new vo(c),v=new Av(h),m=new Sf(h),w=new bi,b=new go;let k,C=null,I=Ue(!1),M=Ue(null),S=Ue(null),O=se(()=>n().currentView),A=se(()=>i().sidebar.isExpanded),$=se(()=>o(S)?.currentWorkspaceId),J=se(()=>o(S)?.selectedChapterId),Z=se(()=>o(S)?.initialized||!1),D=se(()=>o(S)?.workspace),q=se(()=>{const pe=o(D)?.opf?.metadata?.title;return pe?`${pe}`:"EDITME"}),R=Ue(null),T=Ue(null),L=Ue(null),F=Ue(Ct({xhtmlContent:"",isTransforming:!1,transformError:null,transformWarnings:[],executionTime:0,spineItemId:null}));const ae=pe=>{y(R,pe.item,!0),y(T,pe.type,!0)},B=async pe=>{const{field:be}=pe.detail;(be==="creator"||be==="title"||be==="language")&&window.dispatchEvent(new CustomEvent("workspace-list-refresh"))},le=pe=>{y(L,pe.detail.xhtml,!0)},Se=pe=>{y(F,{xhtmlContent:pe.detail.xhtmlContent,isTransforming:pe.detail.isTransforming,transformError:pe.detail.transformError,transformWarnings:pe.detail.transformWarnings,executionTime:pe.detail.executionTime,spineItemId:pe.detail.spineItemId},!0)},ze=pe=>{const be=document.querySelector("[data-spine-view]");be&&be.dispatchEvent(new CustomEvent("preview-click",{detail:pe,bubbles:!0}))},xe=async pe=>{if(!(!o(D)||!o(S)||!confirm(s()("Are you sure you want to delete this item?"))))try{const he=await h.removeManifestItem(o(D),pe.detail.itemId);o(S).workspace=he,o(R)&&o(R).id===pe.detail.itemId&&(y(R,null),y(T,null))}catch(he){console.error("Failed to delete manifest item:",he)}},Le=async(pe,be)=>{if(!o(S)){console.error("AppState not initialized");return}try{let he;if(pe)he=pe;else if(be){console.log(`Downloading EPUB from: ${be}`);const tt=await fetch(be);if(!tt.ok)throw new Error(`Failed to download EPUB: ${tt.status} ${tt.statusText}`);const ct=await tt.blob(),at=de(be);he=new File([ct],at,{type:"application/epub+zip"})}else he=await K();const Ce="workspace-"+crypto.randomUUID();console.log(`Importing EPUB: ${he.name} to workspace: ${Ce}`);const Oe=await b.unpackEPUB(he,Ce);if(!Oe.success)throw new Error(Oe.error||"Failed to unpack EPUB");console.log(`✅ Successfully imported EPUB: ${Oe.extractedFiles?.length} files extracted`),await o(S).loadWorkspace(Ce);const Ve=o(S).workspace?.opf?.spine?.[0];Ve?(o(S).selectChapter(Ve.idref),yt.navigateTo("spine")):yt.navigateTo("metadata"),location.hash=""}catch(he){console.error("Failed to import EPUB:",he);const Ce=he instanceof Error?he.message:"Unknown error";alert(`Failed to import EPUB: ${Ce}`)}},de=pe=>{try{const Ce=new URL(pe).pathname.split("/").pop()||"imported-epub.epub";return Ce.endsWith(".epub")?Ce:`${Ce}.epub`}catch{return"imported-epub.epub"}},K=()=>new Promise((pe,be)=>{const he=document.createElement("input");he.type="file",he.accept=".epub",he.onchange=Ce=>{const Oe=Ce.target.files?.[0];Oe?pe(Oe):be(new Error("No file selected"))},he.oncancel=()=>{be(new Error("File selection cancelled"))},he.click()}),X=pe=>{if(!o(S))return;const be=o(S).workspace?.opf?.spine?.[0];be?(o(S).selectChapter(be.idref),yt.navigateTo("spine")):yt.navigateTo("metadata")},re=async pe=>{if(o(D))try{const be=await h.updateMetadata(o(D),{modifiedDate:fn()});o(S)&&(o(S).workspace=be);const he=await w.packageEPUB(pe,{progressCallback:Ce=>{console.log(`Packaging progress: ${Ce.phase} - ${Ce.processedFiles}/${Ce.totalFiles} files`)}});if(he.success&&he.blob&&he.filename)w.downloadEPUB(he.blob,he.filename),console.log(`✅ Successfully packaged and downloaded: ${he.filename}`);else throw new Error(he.error||"Unknown packaging error")}catch(be){throw console.error("Failed to package EPUB:",be),be}};nn(()=>{(async()=>{try{await c.init(),l=new _i(c),k=new fo({fileStorage:c,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),C=new Uv(k,l),await C.initialize(),y(I,!0),y(S,new Dv(c,p,oo,l,d,u,C),!0),await o(S).initialize()}catch(Ce){console.error("Failed to initialize app:",Ce),y(M,Ce instanceof Error?Ce.message:"Initialization failed",!0)}})();const pe=Ce=>{if(!o(S))return;const Oe=Ce;o(S).selectChapter(Oe.detail.itemId),yt.navigateTo("spine")},be=()=>{o(S)&&o(S).selectChapter(null)},he=()=>{const Ce=window.location.hash.slice(1);if(Ce.startsWith("http"))try{const Oe=decodeURIComponent(Ce);console.log(`Hash change detected: importing EPUB from ${Oe}`),Le(void 0,Oe)}catch(Oe){console.error("Failed to decode URL from hash:",Oe),alert("Invalid URL in hash fragment")}};return window.location.hash&&he(),window.addEventListener("select-spine-item",pe),window.addEventListener("clear-spine-selection",be),window.addEventListener("hashchange",he),()=>{window.removeEventListener("select-spine-item",pe),window.removeEventListener("clear-spine-selection",be),window.removeEventListener("hashchange",he),o(S)?.cleanup(),C?.cleanup()}});var ge=ht();Ul(pe=>{U(()=>hs.title=o(q))});var Ae=Ke(ge);{var We=pe=>{var be=Ov(),he=g(f(be),2),Ce=f(he);U(()=>E(Ce,o(M))),x(pe,be)},Be=(pe,be)=>{{var he=Oe=>{var Ve=Wv();x(Oe,Ve)},Ce=(Oe,Ve)=>{{var tt=at=>{var fe=jv();x(at,fe)},ct=at=>{const fe=se(()=>!!o($));nu(at,{get hasWorkspace(){return o(fe)},$$slots:{"sidebar-spine":(ke,_e)=>{var Ne=ht(),N=Ke(Ne);{var V=Q=>{var me=Bv(),j=f(me),oe=f(j);U(ne=>E(oe,ne),[()=>s()("Loading project…")]),x(Q,me)},Y=(Q,me)=>{{var j=ne=>{var we=Nv(),ye=f(we),Ie=f(ye);U(Te=>E(Ie,Te),[()=>s()("No project selected")]),x(ne,we)},oe=(ne,we)=>{{var ye=Te=>{_h(Te,{get workspace(){return o(D)},get spineService(){return v},get selectedItemId(){return o(J)},get isExpanded(){return o(A)},onWorkspaceUpdate:Fe=>{o(S)&&(o(S).workspace=Fe)},onPackageRequested:re})},Ie=Te=>{var Fe=$v(),ce=f(Fe),Re=f(ce);U($e=>E(Re,$e),[()=>s()("Loading project…")]),x(Te,Fe)};H(ne,Te=>{o(D)?Te(ye):Te(Ie,!1)},we)}};H(Q,ne=>{o(D)?ne(oe,!1):ne(j)},me)}};H(N,Q=>{o(Z)?Q(Y,!1):Q(V)})}x(ke,Ne)},"left-content":(ke,_e)=>{var Ne=ht(),N=Ke(Ne);{var V=Q=>{Ou(Q,{onListWorkspaces:()=>o(S)?.listWorkspaces()??Promise.resolve([]),onCreateWorkspace:me=>o(S)?.createWorkspace(me.title,me.language)??Promise.resolve(""),onDeleteWorkspace:me=>o(S)?.deleteWorkspace(me)??Promise.resolve(),onLoadWorkspace:me=>o(S)?.loadWorkspace(me)??Promise.resolve(),onEpubImportRequested:Le,get currentWorkspaceId(){return o($)},onNavigationRequested:me=>{yt.navigateTo(me)},onSmartNavigationRequested:X,onWorkspaceOpened:()=>{},onWorkspaceChanged:()=>{}})},Y=(Q,me)=>{{var j=ne=>{var we=ht(),ye=Ke(we);{var Ie=Fe=>{Mf(Fe,{get metadataService(){return m},get workspace(){return o(S).workspace},set workspace(ce){o(S).workspace=ce},$$events:{metadataChanged:B}})},Te=Fe=>{const ce=se(()=>s()("EPUB Metadata")),Re=se(()=>s()("Configure publication metadata and details"));Hr(Fe,{viewType:"metadata",get title(){return o(ce)},get description(){return o(Re)},icon:"📝"})};H(ye,Fe=>{o(Z)&&o(D)&&o(S)?Fe(Ie):Fe(Te,!1)})}x(ne,we)},oe=(ne,we)=>{{var ye=Te=>{var Fe=ht(),ce=Ke(Fe);{var Re=Pe=>{iv(Pe,{get workspace(){return o(D)},get workspaceService(){return h},get advancedMode(){return o(S).isAdvancedMode},onItemSelect:ae})},$e=Pe=>{const _=se(()=>s()("File Manifest")),G=se(()=>s()("Manage EPUB files and resources"));Hr(Pe,{viewType:"manifest",get title(){return o(_)},get description(){return o(G)},icon:"📋"})};H(ce,Pe=>{o(Z)&&o(D)?Pe(Re):Pe($e,!1)})}x(Te,Fe)},Ie=(Te,Fe)=>{{var ce=$e=>{var Pe=ht(),_=Ke(Pe);{var G=Ee=>{Ev(Ee,{get workspace(){return o(D)},get workspaceService(){return h},get spineService(){return v},$$events:{previewUpdate:le}})},te=Ee=>{const De=se(()=>s()("Table of Contents")),z=se(()=>s()("Loading project…"));Hr(Ee,{viewType:"navigation",get title(){return o(De)},get description(){return o(z)},icon:"📖"})};H(_,Ee=>{o(Z)&&o(D)?Ee(G):Ee(te,!1)})}x($e,Pe)},Re=($e,Pe)=>{{var _=te=>{var Ee=ht(),De=Ke(Ee);{var z=ie=>{const Me=se(()=>o(S).getTransformEngine()),He=se(()=>o(S).getContentService());$p(ie,{get workspace(){return o(D)},get workspaceService(){return h},get spineService(){return v},get selectedItemId(){return o(J)},get transformEngine(){return o(Me)},get contentService(){return o(He)},$$events:{previewUpdate:Se}})},ee=ie=>{const Me=se(()=>s()("Spine Items")),He=se(()=>s()("Loading project…"));Hr(ie,{viewType:"spine",get title(){return o(Me)},get description(){return o(He)},icon:"📚"})};H(De,ie=>{o(Z)&&o(D)&&o(S)?ie(z):ie(ee,!1)})}x(te,Ee)},G=(te,Ee)=>{{var De=ee=>{const ie=se(()=>o(S).getSettingsService()),Me=se(()=>o(S).getExtensionManager()),He=se(()=>o(S).getTransformEngine());th(ee,{get settingsService(){return o(ie)},get extensionManager(){return o(Me)},get transformEngine(){return o(He)},get workspaceId(){return o(S).currentWorkspaceId},onSettingsChanged:()=>{o(S)?.currentWorkspaceId&&o(S).loadWorkspaceSettings(o(S).currentWorkspaceId)}})},z=ee=>{var ie=Hv(),Me=f(ie),He=f(Me),Xe=g(Me,2),it=f(Xe);U((vt,dt)=>{E(He,vt),E(it,`${dt??""}: ${o(O)??""}`)},[()=>s()("Unknown View"),()=>s()("View type")]),x(ee,ie)};H(te,ee=>{o(O)==="settings"?ee(De):ee(z,!1)},Ee)}};H($e,te=>{o(O)==="spine"?te(_):te(G,!1)},Pe)}};H(Te,$e=>{o(O)==="navigation"?$e(ce):$e(Re,!1)},Fe)}};H(ne,Te=>{o(O)==="manifest"?Te(ye):Te(Ie,!1)},we)}};H(Q,ne=>{o(O)==="metadata"?ne(j):ne(oe,!1)},me)}};H(N,Q=>{o(O)==="workspace"&&o(Z)?Q(V):Q(Y,!1)})}x(ke,Ne)},"right-content":(ke,_e)=>{var Ne=ht(),N=Ke(Ne);{var V=Q=>{bv(Q,{get selectedItem(){return o(R)},get selectedItemType(){return o(T)},get workspace(){return o(D)},get workspaceService(){return h},$$events:{itemDelete:xe}})},Y=(Q,me)=>{{var j=ne=>{var we=ht(),ye=Ke(we);{var Ie=Fe=>{Tv(Fe,{get content(){return o(L)}})},Te=Fe=>{var ce=Vv(),Re=f(ce),$e=f(Re),Pe=g(Re,2),_=f(Pe);U((G,te)=>{E($e,G),E(_,te)},[()=>s()("Navigation Preview"),()=>s()("Generating navigation from chapters...")]),x(Fe,ce)};H(ye,Fe=>{o(L)?Fe(Ie):Fe(Te,!1)})}x(ne,we)},oe=(ne,we)=>{{var ye=Te=>{var Fe=ht(),ce=Ke(Fe);{var Re=Pe=>{Fp(Pe,{get xhtmlContent(){return o(F).xhtmlContent},get isTransforming(){return o(F).isTransforming},get transformError(){return o(F).transformError},get transformWarnings(){return o(F).transformWarnings},get executionTime(){return o(F).executionTime},get spineItemId(){return o(F).spineItemId},onPreviewClick:ze})},$e=Pe=>{var _=qv(),G=f(_),te=f(G),Ee=g(G,2),De=f(Ee);U((z,ee)=>{E(te,z),E(De,ee)},[()=>s()("Spine Preview"),()=>s()("Select a spine item to see the preview here")]),x(Pe,_)};H(ce,Pe=>{o(F).spineItemId?Pe(Re):Pe($e,!1)})}x(Te,Fe)},Ie=Te=>{var Fe=Gv(),ce=f(Fe),Re=f(ce),$e=g(ce,2),Pe=f($e),_=g($e,2),G=f(_),te=g(G),Ee=f(te);U((De,z,ee)=>{E(Re,De),E(Pe,z),E(G,`${ee??""}: `),E(Ee,o(O))},[()=>s()("Preview Pane"),()=>s()("Content preview will appear here based on the current view"),()=>s()("Current view")]),x(Te,Fe)};H(ne,Te=>{o(O)==="spine"?Te(ye):Te(Ie,!1)},we)}};H(Q,ne=>{o(O)==="navigation"?ne(j):ne(oe,!1)},me)}};H(N,Q=>{o(O)==="manifest"&&o(Z)&&o(D)?Q(V):Q(Y,!1)})}x(ke,Ne)}}})};H(Oe,at=>{o(S)?at(ct,!1):at(tt)},Ve)}};H(pe,Oe=>{o(I)?Oe(Ce,!1):Oe(he)},be)}};H(Ae,pe=>{o(M)?pe(We):pe(Be,!1)})}x(r,ge),et(),a()}so().catch(r=>{console.error("Failed to initialize i18n:",r)});Ol(Xv,{target:document.getElementById("app")});</script>
    <style rel="stylesheet" crossorigin>:root{--color-neutral-50: #ffffff;--color-neutral-100: #f8f8f8;--color-neutral-200: #f0f0f0;--color-neutral-300: #e0e0e0;--color-neutral-400: #cccccc;--color-neutral-500: #999999;--color-neutral-600: #666666;--color-neutral-700: #444444;--color-neutral-800: #333333;--color-neutral-900: #222222;--color-neutral-950: #000000;--color-primary-50: #f0f0ff;--color-primary-100: #e6e6ff;--color-primary-200: #ccccff;--color-primary-300: #9999ff;--color-primary-400: #6666ff;--color-primary-500: #3333ff;--color-primary-600: #0000ee;--color-primary-700: #0000cc;--color-primary-800: #0000aa;--color-primary-900: #000088;--color-primary-950: #000066;--color-success-50: #f0fdf4;--color-success-100: #e6f5e6;--color-success-200: #cceecc;--color-success-300: #99dd99;--color-success-400: #66cc66;--color-success-500: #33bb33;--color-success-600: #22aa22;--color-success-700: #118811;--color-success-800: #006600;--color-success-900: #005500;--color-success-950: #004400;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-200: #fde68a;--color-warning-300: #fcd34d;--color-warning-400: #fbbf24;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-warning-800: #92400e;--color-warning-900: #78350f;--color-warning-950: #451a03;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-200: #fecaca;--color-error-300: #fca5a5;--color-error-400: #f87171;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-error-800: #991b1b;--color-error-900: #7f1d1d;--color-error-950: #450a0a;--color-white: #ffffff;--color-black: #000000;--color-transparent: transparent;--color-link-visited: #551a8b;--color-craigslist-bg: #f0f0f0;--color-craigslist-border: #ccc;--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-craigslist-bg);--color-bg-tertiary: var(--color-neutral-100);--color-bg-quaternary: var(--color-neutral-200);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-text-link-visited: var(--color-link-visited);--color-border-default: var(--color-craigslist-border);--color-border-strong: var(--color-neutral-400);--color-border-subtle: var(--color-neutral-300);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-success-600);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-primary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-neutral-100);--color-sidebar-item-active: var(--color-neutral-200);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-neutral-100);--color-button-primary-bg-hover: var(--color-neutral-200);--color-button-primary-text: var(--color-text-primary);--color-button-primary-border: var(--color-neutral-400);--color-button-secondary-bg: var(--color-white);--color-button-secondary-bg-hover: var(--color-neutral-100);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-success-600);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-input-border-active: var(--color-success-600);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-forced-bg: Canvas;--color-forced-text: CanvasText;--color-forced-border: ButtonBorder;--color-forced-link: LinkText;--color-forced-visited: VisitedText;--color-forced-active: ActiveText;--color-forced-button-face: ButtonFace;--color-forced-button-text: ButtonText;--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-forced-text);--color-bg-primary: var(--color-forced-bg);--color-border-default: var(--color-forced-border);--color-text-link: var(--color-forced-link);--color-focus: var(--color-forced-active)}}:root{--space-0: 0;--space-px: 1px;--space-0-5: .125rem;--space-1: .25rem;--space-1-5: .375rem;--space-2: .5rem;--space-2-5: .625rem;--space-3: .75rem;--space-3-5: .875rem;--space-4: 1rem;--space-5: 1.25rem;--space-6: 1.5rem;--space-7: 1.75rem;--space-8: 2rem;--space-9: 2.25rem;--space-10: 2.5rem;--space-11: 2.75rem;--space-12: 3rem;--space-14: 3.5rem;--space-16: 4rem;--space-20: 5rem;--space-24: 6rem;--space-28: 7rem;--space-32: 8rem;--space-36: 9rem;--space-40: 10rem;--space-44: 11rem;--space-48: 12rem;--space-52: 13rem;--space-56: 14rem;--space-60: 15rem;--space-64: 16rem;--space-72: 18rem;--space-80: 20rem;--space-96: 24rem;--spacing-component-xs: var(--space-0-5);--spacing-component-sm: var(--space-1);--spacing-component-md: var(--space-2);--spacing-component-lg: var(--space-3);--spacing-component-xl: var(--space-4);--spacing-layout-xs: var(--space-1);--spacing-layout-sm: var(--space-2);--spacing-layout-md: var(--space-3);--spacing-layout-lg: var(--space-4);--spacing-layout-xl: var(--space-6);--spacing-content-xs: var(--space-2);--spacing-content-sm: var(--space-3);--spacing-content-md: var(--space-4);--spacing-content-lg: var(--space-5);--spacing-content-xl: var(--space-6);--layout-sidebar-width-expanded: 250px;--layout-sidebar-width-collapsed: 40px;--layout-header-height: 60px;--layout-header-padding: var(--space-4);--layout-content-padding: var(--space-3);--layout-content-max-width: 960px;--layout-content-gap: var(--space-2);--layout-panel-padding-block: var(--space-3);--layout-panel-padding-inline: var(--space-3);--layout-panel-gap: var(--space-2);--layout-panel-border-radius: var(--radius-none);--layout-resize-handle-width: 4px;--layout-resize-handle-hover-width: 6px;--form-field-spacing: var(--space-2);--form-group-spacing: var(--space-3);--form-section-spacing: var(--space-4);--list-item-padding-block: var(--space-1);--list-item-padding-inline: var(--space-1);--list-item-gap: var(--space-1);--list-section-gap: var(--space-3);--card-padding-block: var(--space-3);--card-padding-inline: var(--space-3);--card-gap: var(--space-2);--card-header-padding-block: var(--space-2);--card-header-padding-inline: var(--space-2);--button-padding-inline: var(--space-2);--button-padding-block: var(--space-1);--button-gap: var(--space-1);--layout-direction: ltr;--content-align-start: left;--content-align-end: right;--focus-ring-width: 2px;--focus-ring-offset: 2px;--focus-ring-style: solid;--touch-target-min: 44px;--touch-target-spacing: var(--space-2);--sr-only-clip: rect(0, 0, 0, 0);--radius-none: 0;--radius-xs: .0625rem;--radius-sm: .125rem;--radius-md: .1875rem;--radius-lg: .25rem;--radius-xl: .375rem;--radius-2xl: .5rem;--radius-3xl: .75rem;--radius-full: 9999px;--radius-button: var(--radius-sm);--radius-input: var(--radius-xs);--radius-card: var(--radius-none);--radius-panel: var(--radius-none);--radius-modal: var(--radius-sm);--radius-tooltip: var(--radius-none);--breakpoint-sm: 640px;--breakpoint-md: 768px;--breakpoint-lg: 1024px;--breakpoint-xl: 1280px;--breakpoint-2xl: 1536px;--container-sm: 640px;--container-md: 768px;--container-lg: 1024px;--container-xl: 1280px;--container-2xl: 1536px;--container-full: 100%}[data-dir=rtl]{--layout-direction: rtl;--content-align-start: right;--content-align-end: left}:root{--font-sans: Helvetica, Arial, sans-serif;--font-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;--font-serif: Georgia, "Times New Roman", Times, serif;--text-xs: .6875rem;--text-sm: .8125rem;--text-base: .875rem;--text-lg: 1rem;--text-xl: 1.125rem;--text-2xl: 1.25rem;--text-3xl: 1.5rem;--text-4xl: 1.875rem;--text-5xl: 2.25rem;--text-6xl: 3rem;--text-7xl: 3.75rem;--text-8xl: 4.5rem;--text-9xl: 6rem;--font-thin: 100;--font-extralight: 200;--font-light: 300;--font-normal: 400;--font-medium: 500;--font-semibold: 600;--font-bold: 700;--font-extrabold: 800;--font-black: 900;--leading-none: 1;--leading-tight: 1.2;--leading-snug: 1.3;--leading-normal: 1.4;--leading-relaxed: 1.5;--leading-loose: 1.6;--leading-xs: 1rem;--leading-sm: 1.25rem;--leading-base: 1.5rem;--leading-lg: 1.75rem;--leading-xl: 1.75rem;--leading-2xl: 2rem;--leading-3xl: 2.25rem;--leading-4xl: 2.5rem;--leading-5xl: 1;--leading-6xl: 1;--leading-7xl: 1;--leading-8xl: 1;--leading-9xl: 1;--tracking-tighter: -.05em;--tracking-tight: -.025em;--tracking-normal: 0em;--tracking-wide: .025em;--tracking-wider: .05em;--tracking-widest: .1em;--text-display-2xl: var(--text-5xl);--text-display-xl: var(--text-4xl);--text-display-lg: var(--text-3xl);--text-display-md: var(--text-2xl);--text-display-sm: var(--text-xl);--text-heading-2xl: var(--text-4xl);--text-heading-xl: var(--text-3xl);--text-heading-lg: var(--text-2xl);--text-heading-md: var(--text-xl);--text-heading-sm: var(--text-lg);--text-heading-xs: var(--text-base);--text-body-xl: var(--text-xl);--text-body-lg: var(--text-lg);--text-body-md: var(--text-base);--text-body-sm: var(--text-sm);--text-body-xs: var(--text-xs);--text-label-lg: var(--text-sm);--text-label-md: var(--text-xs);--text-label-sm: var(--text-xs);--button-text-lg: var(--text-base);--button-text-md: var(--text-sm);--button-text-sm: var(--text-xs);--button-font-weight: var(--font-normal);--button-letter-spacing: var(--tracking-normal);--input-text-size: var(--text-base);--input-font-weight: var(--font-normal);--input-letter-spacing: var(--tracking-normal);--input-placeholder-weight: var(--font-normal);--nav-text-size: var(--text-base);--nav-font-weight: var(--font-normal);--nav-letter-spacing: var(--tracking-normal);--sidebar-text-size: var(--text-sm);--sidebar-font-weight: var(--font-normal);--sidebar-heading-weight: var(--font-semibold);--sidebar-letter-spacing: var(--tracking-normal);--code-text-size: var(--text-sm);--code-font-family: var(--font-mono);--code-font-weight: var(--font-normal);--code-letter-spacing: var(--tracking-normal);--code-line-height: var(--leading-relaxed);--caption-text-size: var(--text-xs);--caption-font-weight: var(--font-normal);--caption-letter-spacing: var(--tracking-normal);--caption-line-height: var(--leading-normal);--text-decoration-none: none;--text-decoration-underline: underline;--text-decoration-line-through: line-through;--link-text-decoration: underline;--link-text-decoration-hover: underline;--link-underline-offset: .1em;--text-transform-none: none;--text-transform-uppercase: uppercase;--text-transform-lowercase: lowercase;--text-transform-capitalize: capitalize;--editor-font-family: var(--font-serif);--editor-text-size: var(--text-base);--editor-line-height: var(--leading-relaxed);--editor-letter-spacing: var(--tracking-normal);--editor-font-weight: var(--font-normal);--preview-font-family: var(--font-serif);--preview-text-size: var(--text-base);--preview-line-height: var(--leading-relaxed);--preview-letter-spacing: var(--tracking-normal);--metadata-font-family: var(--font-sans);--metadata-text-size: var(--text-sm);--metadata-line-height: var(--leading-normal);--metadata-label-weight: var(--font-medium)}:root{--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-none: none;--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);--z-base: 0;--z-raised: 10;--z-overlay: 20;--z-sticky: 30;--z-fixed: 40;--z-dropdown: 1000;--z-tooltip: 1100;--z-modal-backdrop: 1200;--z-modal: 1300;--z-popover: 1400;--z-toast: 1500;--z-loading: 1600;--z-maximum: 9999;--elevation-card-flat: var(--shadow-none);--elevation-card-raised: var(--shadow-sm);--elevation-card-floating: var(--shadow-md);--elevation-card-elevated: var(--shadow-lg);--elevation-panel-flat: var(--shadow-none);--elevation-panel-inset: var(--shadow-inner);--elevation-panel-raised: var(--shadow-sm);--elevation-panel-floating: var(--shadow-lg);--elevation-button-flat: var(--shadow-none);--elevation-button-raised: var(--shadow-sm);--elevation-button-hover: var(--shadow-md);--elevation-button-active: var(--shadow-xs);--elevation-input-flat: var(--shadow-none);--elevation-input-inset: var(--shadow-inner);--elevation-input-focus: var(--shadow-focus-primary);--elevation-nav-flat: var(--shadow-none);--elevation-nav-floating: var(--shadow-md);--elevation-nav-sticky: var(--shadow-sm);--elevation-modal-backdrop: var(--shadow-none);--elevation-modal: var(--shadow-2xl);--elevation-tooltip: var(--shadow-lg);--elevation-dropdown: var(--shadow-lg);--elevation-sidebar: var(--shadow-sm);--elevation-sidebar-floating: var(--shadow-md);--elevation-header: var(--shadow-sm);--elevation-header-floating: var(--shadow-md);--elevation-content-primary: var(--shadow-none);--elevation-content-secondary: var(--shadow-sm);--elevation-resize-handle: var(--shadow-none);--elevation-resize-handle-hover: var(--shadow-sm);--border-width-0: 0;--border-width-1: 1px;--border-width-2: 2px;--border-width-4: 4px;--border-width-8: 8px;--border-style-solid: solid;--border-style-dashed: dashed;--border-style-dotted: dotted;--border-style-none: none;--border-default: var(--border-width-1) var(--border-style-solid) var(--color-border-default);--border-strong: var(--border-width-1) var(--border-style-solid) var(--color-border-strong);--border-accent: var(--border-width-1) var(--border-style-solid) var(--color-border-accent);--border-focus: var(--border-width-2) var(--border-style-solid) var(--color-border-focus);--opacity-0: 0;--opacity-5: .05;--opacity-10: .1;--opacity-20: .2;--opacity-25: .25;--opacity-30: .3;--opacity-40: .4;--opacity-50: .5;--opacity-60: .6;--opacity-70: .7;--opacity-75: .75;--opacity-80: .8;--opacity-90: .9;--opacity-95: .95;--opacity-100: 1;--opacity-disabled: var(--opacity-50);--opacity-hover: var(--opacity-80);--opacity-loading: var(--opacity-60);--opacity-overlay: var(--opacity-50);--opacity-backdrop: var(--opacity-75)}:root{--duration-instant: 0ms;--duration-fast: .15s;--duration-normal: .25s;--duration-slow: .35s;--duration-slower: .5s;--duration-slowest: .75s;--duration-tooltip: var(--duration-fast);--duration-button-hover: var(--duration-fast);--duration-input-focus: var(--duration-fast);--duration-dropdown: var(--duration-normal);--duration-modal: var(--duration-normal);--duration-sidebar-toggle: var(--duration-normal);--duration-theme-switch: var(--duration-normal);--duration-page-transition: var(--duration-slow);--duration-loading: var(--duration-slower);--ease-linear: linear;--ease-in: cubic-bezier(.4, 0, 1, 1);--ease-out: cubic-bezier(0, 0, .2, 1);--ease-in-out: cubic-bezier(.4, 0, .2, 1);--ease-elastic: cubic-bezier(.68, -.55, .265, 1.55);--ease-bounce: cubic-bezier(.175, .885, .32, 1.275);--ease-smooth: cubic-bezier(.25, .1, .25, 1);--ease-sharp: cubic-bezier(.4, 0, .6, 1);--ease-ui-out: var(--ease-out);--ease-ui-in: var(--ease-in);--ease-ui-in-out: var(--ease-in-out);--ease-ui-smooth: var(--ease-smooth);--transition-colors: color var(--duration-fast) var(--ease-ui-out), background-color var(--duration-fast) var(--ease-ui-out), border-color var(--duration-fast) var(--ease-ui-out);--transition-opacity: opacity var(--duration-fast) var(--ease-ui-out);--transition-transform: transform var(--duration-fast) var(--ease-ui-out);--transition-shadow: box-shadow var(--duration-fast) var(--ease-ui-out);--transition-size: width var(--duration-normal) var(--ease-ui-out), height var(--duration-normal) var(--ease-ui-out);--transition-button: var(--transition-colors), var(--transition-shadow), transform var(--duration-button-hover) var(--ease-ui-out);--transition-input: var(--transition-colors), border-color var(--duration-input-focus) var(--ease-ui-out), box-shadow var(--duration-input-focus) var(--ease-ui-out);--transition-panel: var(--transition-colors), var(--transition-shadow);--transition-modal: opacity var(--duration-modal) var(--ease-ui-out), transform var(--duration-modal) var(--ease-ui-out);--transition-dropdown: opacity var(--duration-dropdown) var(--ease-ui-out), transform var(--duration-dropdown) var(--ease-ui-out);--transition-sidebar: width var(--duration-sidebar-toggle) var(--ease-ui-out);--transition-resize: all var(--duration-fast) var(--ease-ui-out);--transition-theme: background-color var(--duration-theme-switch) var(--ease-ui-out), color var(--duration-theme-switch) var(--ease-ui-out), border-color var(--duration-theme-switch) var(--ease-ui-out), box-shadow var(--duration-theme-switch) var(--ease-ui-out);--animation-spin: spin 1s linear infinite;--animation-ping: ping 1s cubic-bezier(0, 0, .2, 1) infinite;--animation-pulse: pulse 2s cubic-bezier(.4, 0, .6, 1) infinite;--animation-bounce: bounce 1s infinite;--animation-fade-in: fadeIn var(--duration-normal) var(--ease-ui-out);--animation-slide-in-up: slideInUp var(--duration-normal) var(--ease-ui-out);--animation-slide-in-down: slideInDown var(--duration-normal) var(--ease-ui-out);--animation-slide-in-left: slideInLeft var(--duration-normal) var(--ease-ui-out);--animation-slide-in-right: slideInRight var(--duration-normal) var(--ease-ui-out);--animation-scale-in: scaleIn var(--duration-normal) var(--ease-ui-out);--animation-fade-out: fadeOut var(--duration-normal) var(--ease-ui-in);--animation-slide-out-up: slideOutUp var(--duration-normal) var(--ease-ui-in);--animation-slide-out-down: slideOutDown var(--duration-normal) var(--ease-ui-in);--animation-slide-out-left: slideOutLeft var(--duration-normal) var(--ease-ui-in);--animation-slide-out-right: slideOutRight var(--duration-normal) var(--ease-ui-in);--animation-scale-out: scaleOut var(--duration-normal) var(--ease-ui-in);@media (prefers-reduced-motion: reduce){:root{--duration-fast: 50ms;--duration-normal: .1s;--duration-slow: .15s;--duration-slower: .2s;--duration-slowest: .25s;--ease-ui-out: ease;--ease-ui-in: ease;--ease-ui-in-out: ease;--ease-ui-smooth: ease;--animation-spin: none;--animation-ping: none;--animation-pulse: none;--animation-bounce: none}}--layout-transition-duration: var(--duration-normal);--layout-transition-easing: var(--ease-ui-out);--nav-transition-duration: var(--duration-fast);--nav-transition-easing: var(--ease-ui-out);--content-transition-duration: var(--duration-normal);--content-transition-easing: var(--ease-ui-out);--interactive-hover-duration: var(--duration-fast);--interactive-focus-duration: var(--duration-fast);--interactive-active-duration: var(--duration-instant)}*,*:before,*:after{transition:var(--transition-theme)}.theme-initializing *,.theme-initializing *:before,.theme-initializing *:after{transition:none!important}:root{color-scheme:light}[data-theme=dark]{color-scheme:dark}[data-theme=auto]{color-scheme:light dark}::-webkit-scrollbar-track{background:var(--color-bg-secondary)}::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-full)}::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}*{scrollbar-width:thin;scrollbar-color:var(--color-border-strong) var(--color-bg-secondary)}::selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}::-moz-selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}*:focus{outline:none}*:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex]:focus-visible{box-shadow:var(--shadow-focus-primary)}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-black);--color-text-secondary: var(--color-neutral-800);--color-bg-primary: var(--color-white);--color-border-default: var(--color-neutral-900);--color-border-focus: var(--color-primary-900)}[data-theme=dark]{--color-text-primary: var(--color-white);--color-text-secondary: var(--color-neutral-200);--color-bg-primary: var(--color-black);--color-border-default: var(--color-white);--color-border-focus: var(--color-primary-300)}}@media print{*{color:#000!important;background:#fff!important;box-shadow:none!important}button,.nav,.sidebar,[role=navigation]{display:none!important}}@media (prefers-reduced-motion: reduce){*,*:before,*:after{transition:none!important;animation:none!important}*:focus-visible{transition:box-shadow .1s ease!important}}.theme-loading{visibility:hidden}.theme-loaded{visibility:visible}.theme-ready{transition:var(--transition-theme)}a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex="0"]:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}[data-theme=light]{--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-neutral-100);--color-bg-tertiary: var(--color-neutral-200);--color-bg-quaternary: var(--color-neutral-300);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-border-default: var(--color-neutral-200);--color-border-strong: var(--color-neutral-300);--color-border-subtle: var(--color-neutral-100);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-300);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-primary-500);--color-border-hover: var(--color-neutral-300);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-secondary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-bg-tertiary);--color-sidebar-item-active: var(--color-bg-accent);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-interactive-primary);--color-button-primary-bg-hover: var(--color-interactive-primary-hover);--color-button-primary-text: var(--color-text-inverse);--color-button-secondary-bg: var(--color-interactive-secondary);--color-button-secondary-bg-hover: var(--color-interactive-secondary-hover);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-border-focus);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb;--color-surface-disabled: var(--color-neutral-100);--color-text-disabled: var(--color-neutral-400);--color-surface-hover: var(--color-neutral-50);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);color-scheme:light}@media (prefers-color-scheme: light){:root:not([data-theme]){color-scheme:light}}[data-theme=dark]{--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);--color-border-hover: var(--color-neutral-600);--color-interactive-primary: var(--color-primary-500);--color-interactive-primary-hover: var(--color-primary-400);--color-interactive-primary-active: var(--color-primary-600);--color-interactive-secondary: var(--color-neutral-800);--color-interactive-secondary-hover: var(--color-neutral-700);--color-interactive-secondary-active: var(--color-neutral-600);--color-interactive-disabled: var(--color-neutral-700);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-neutral-900);--color-surface-secondary: var(--color-neutral-800);--color-surface-tertiary: var(--color-neutral-700);--color-surface-overlay: rgba(0, 0, 0, .8);--color-surface-elevated: var(--color-neutral-800);--color-sidebar-bg: var(--color-neutral-900);--color-sidebar-border: var(--color-neutral-700);--color-sidebar-item-hover: var(--color-neutral-800);--color-sidebar-item-active: var(--color-neutral-700);--color-sidebar-text: var(--color-neutral-100);--color-sidebar-text-secondary: var(--color-neutral-400);--color-button-primary-bg: var(--color-primary-600);--color-button-primary-bg-hover: var(--color-primary-500);--color-button-primary-text: var(--color-white);--color-button-secondary-bg: var(--color-neutral-800);--color-button-secondary-bg-hover: var(--color-neutral-700);--color-button-secondary-text: var(--color-neutral-100);--color-button-secondary-border: var(--color-neutral-600);--color-input-bg: var(--color-neutral-800);--color-input-border: var(--color-neutral-600);--color-input-border-focus: var(--color-primary-400);--color-input-text: var(--color-neutral-100);--color-input-placeholder: var(--color-neutral-400);--color-status-success: var(--color-success-400);--color-status-warning: var(--color-warning-400);--color-status-error: var(--color-error-400);--color-status-info: var(--color-primary-400);--color-focus: var(--color-primary-400);--color-focus-ring: var(--color-primary-300);--color-error-text: #fca5a5;--color-error-bg: var(--color-error-950);--color-success-text: #86efac;--color-success-bg: var(--color-success-950);--color-warning-text: #fcd34d;--color-warning-bg: var(--color-warning-950);--color-surface-disabled: var(--color-neutral-800);--color-text-disabled: var(--color-neutral-500);--color-surface-hover: var(--color-neutral-700);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .3);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .4), 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .4), 0 2px 4px rgba(0, 0, 0, .3);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4), 0 4px 6px rgba(0, 0, 0, .2);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .4), 0 10px 10px rgba(0, 0, 0, .2);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .6);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .4);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .4);--shadow-success: 0 4px 14px rgba(34, 197, 94, .4);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .4);--shadow-error: 0 4px 14px rgba(239, 68, 68, .4);--shadow-focus-primary: 0 0 0 3px rgba(96, 165, 250, .3);--shadow-focus-success: 0 0 0 3px rgba(74, 222, 128, .3);--shadow-focus-warning: 0 0 0 3px rgba(251, 191, 36, .3);--shadow-focus-error: 0 0 0 3px rgba(248, 113, 113, .3)}@media (prefers-color-scheme: dark){:root:not([data-theme]){--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);color-scheme:dark}}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.inline-grid{display:inline-grid}.table{display:table}.table-cell{display:table-cell}.table-row{display:table-row}.hidden{display:none}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.inset-auto{inset:auto}.inset-inline-0{inset-inline:0}.inset-inline-auto{inset-inline:auto}.inset-block-0{inset-block:0}.inset-block-auto{inset-block:auto}.start-0{inset-inline-start:0}.start-auto{inset-inline-start:auto}.end-0{inset-inline-end:0}.end-auto{inset-inline-end:auto}.top-0{inset-block-start:0}.top-auto{inset-block-start:auto}.bottom-0{inset-block-end:0}.bottom-auto{inset-block-end:auto}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.flex-wrap-reverse{flex-wrap:wrap-reverse}.flex-nowrap{flex-wrap:nowrap}.flex-1{flex:1 1 0%}.flex-auto{flex:1 1 auto}.flex-initial{flex:0 1 auto}.flex-none{flex:none}.flex-grow{flex-grow:1}.flex-grow-0{flex-grow:0}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.justify-evenly{justify-content:space-evenly}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-evenly{align-content:space-evenly}.self-auto{align-self:auto}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-stretch{align-self:stretch}.self-baseline{align-self:baseline}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.grid-cols-none{grid-template-columns:none}.grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}.grid-rows-3{grid-template-rows:repeat(3,minmax(0,1fr))}.grid-rows-4{grid-template-rows:repeat(4,minmax(0,1fr))}.grid-rows-5{grid-template-rows:repeat(5,minmax(0,1fr))}.grid-rows-6{grid-template-rows:repeat(6,minmax(0,1fr))}.grid-rows-none{grid-template-rows:none}.col-auto{grid-column:auto}.col-span-1{grid-column:span 1 / span 1}.col-span-2{grid-column:span 2 / span 2}.col-span-3{grid-column:span 3 / span 3}.col-span-4{grid-column:span 4 / span 4}.col-span-5{grid-column:span 5 / span 5}.col-span-6{grid-column:span 6 / span 6}.col-span-full{grid-column:1 / -1}.row-auto{grid-row:auto}.row-span-1{grid-row:span 1 / span 1}.row-span-2{grid-row:span 2 / span 2}.row-span-3{grid-row:span 3 / span 3}.row-span-4{grid-row:span 4 / span 4}.row-span-5{grid-row:span 5 / span 5}.row-span-6{grid-row:span 6 / span 6}.row-span-full{grid-row:1 / -1}.gap-0{gap:0}.gap-1{gap:var(--space-1)}.gap-2{gap:var(--space-2)}.gap-3{gap:var(--space-3)}.gap-4{gap:var(--space-4)}.gap-5{gap:var(--space-5)}.gap-6{gap:var(--space-6)}.gap-8{gap:var(--space-8)}.gap-10{gap:var(--space-10)}.gap-12{gap:var(--space-12)}.gap-x-0{column-gap:0}.gap-x-1{column-gap:var(--space-1)}.gap-x-2{column-gap:var(--space-2)}.gap-x-3{column-gap:var(--space-3)}.gap-x-4{column-gap:var(--space-4)}.gap-x-5{column-gap:var(--space-5)}.gap-x-6{column-gap:var(--space-6)}.gap-x-8{column-gap:var(--space-8)}.gap-y-0{row-gap:0}.gap-y-1{row-gap:var(--space-1)}.gap-y-2{row-gap:var(--space-2)}.gap-y-3{row-gap:var(--space-3)}.gap-y-4{row-gap:var(--space-4)}.gap-y-5{row-gap:var(--space-5)}.gap-y-6{row-gap:var(--space-6)}.gap-y-8{row-gap:var(--space-8)}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-clip{overflow:clip}.overflow-visible{overflow:visible}.overflow-scroll{overflow:scroll}.overflow-x-auto{overflow-x:auto}.overflow-x-hidden{overflow-x:hidden}.overflow-x-clip{overflow-x:clip}.overflow-x-visible{overflow-x:visible}.overflow-x-scroll{overflow-x:scroll}.overflow-y-auto{overflow-y:auto}.overflow-y-hidden{overflow-y:hidden}.overflow-y-clip{overflow-y:clip}.overflow-y-visible{overflow-y:visible}.overflow-y-scroll{overflow-y:scroll}.container{width:100%;margin-left:auto;margin-right:auto}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.box-border{box-sizing:border-box}.box-content{box-sizing:content-box}.float-start{float:inline-start}.float-end{float:inline-end}.float-none{float:none}.clear-start{clear:inline-start}.clear-end{clear:inline-end}.clear-both{clear:both}.clear-none{clear:none}.isolate{isolation:isolate}.isolation-auto{isolation:auto}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.object-fill{object-fit:fill}.object-none{object-fit:none}.object-scale-down{object-fit:scale-down}.object-bottom{object-position:bottom}.object-center{object-position:center}.object-start{object-position:left}.object-start-bottom{object-position:left bottom}.object-start-top{object-position:left top}.object-end{object-position:right}.object-end-bottom{object-position:right bottom}.object-end-top{object-position:right top}.object-top{object-position:top}[data-dir=rtl] .object-start{object-position:right}[data-dir=rtl] .object-start-bottom{object-position:right bottom}[data-dir=rtl] .object-start-top{object-position:right top}[data-dir=rtl] .object-end{object-position:left}[data-dir=rtl] .object-end-bottom{object-position:left bottom}[data-dir=rtl] .object-end-top{object-position:left top}.text-start{text-align:start}.text-end{text-align:end}.text-center{text-align:center}.text-justify{text-align:justify}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:var(--sr-only-clip);white-space:nowrap;border:0}.sr-only-focusable:focus,.sr-only-focusable:active{position:static;width:auto;height:auto;padding:inherit;margin:inherit;overflow:visible;clip:auto;white-space:inherit}.focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.touch-target{min-width:var(--touch-target-min);min-height:var(--touch-target-min)}.m-0{margin:0}.m-1{margin:var(--space-1)}.m-2{margin:var(--space-2)}.m-3{margin:var(--space-3)}.m-4{margin:var(--space-4)}.m-5{margin:var(--space-5)}.m-6{margin:var(--space-6)}.m-8{margin:var(--space-8)}.m-auto{margin:auto}.mx-0{margin-inline:0}.mx-1{margin-inline:var(--space-1)}.mx-2{margin-inline:var(--space-2)}.mx-3{margin-inline:var(--space-3)}.mx-4{margin-inline:var(--space-4)}.mx-5{margin-inline:var(--space-5)}.mx-6{margin-inline:var(--space-6)}.mx-8{margin-inline:var(--space-8)}.mx-auto{margin-inline:auto}.my-0{margin-block:0}.my-1{margin-block:var(--space-1)}.my-2{margin-block:var(--space-2)}.my-3{margin-block:var(--space-3)}.my-4{margin-block:var(--space-4)}.my-5{margin-block:var(--space-5)}.my-6{margin-block:var(--space-6)}.my-8{margin-block:var(--space-8)}.my-auto{margin-block:auto}.ms-0{margin-inline-start:0}.ms-1{margin-inline-start:var(--space-1)}.ms-2{margin-inline-start:var(--space-2)}.ms-3{margin-inline-start:var(--space-3)}.ms-4{margin-inline-start:var(--space-4)}.ms-5{margin-inline-start:var(--space-5)}.ms-6{margin-inline-start:var(--space-6)}.ms-8{margin-inline-start:var(--space-8)}.ms-auto{margin-inline-start:auto}.me-0{margin-inline-end:0}.me-1{margin-inline-end:var(--space-1)}.me-2{margin-inline-end:var(--space-2)}.me-3{margin-inline-end:var(--space-3)}.me-4{margin-inline-end:var(--space-4)}.me-5{margin-inline-end:var(--space-5)}.me-6{margin-inline-end:var(--space-6)}.me-8{margin-inline-end:var(--space-8)}.me-auto{margin-inline-end:auto}.mt-0{margin-block-start:0}.mt-1{margin-block-start:var(--space-1)}.mt-2{margin-block-start:var(--space-2)}.mt-3{margin-block-start:var(--space-3)}.mt-4{margin-block-start:var(--space-4)}.mt-5{margin-block-start:var(--space-5)}.mt-6{margin-block-start:var(--space-6)}.mt-8{margin-block-start:var(--space-8)}.mt-auto{margin-block-start:auto}.mb-0{margin-block-end:0}.mb-1{margin-block-end:var(--space-1)}.mb-2{margin-block-end:var(--space-2)}.mb-3{margin-block-end:var(--space-3)}.mb-4{margin-block-end:var(--space-4)}.mb-5{margin-block-end:var(--space-5)}.mb-6{margin-block-end:var(--space-6)}.mb-8{margin-block-end:var(--space-8)}.mb-auto{margin-block-end:auto}.p-0{padding:0}.p-1{padding:var(--space-1)}.p-2{padding:var(--space-2)}.p-3{padding:var(--space-3)}.p-4{padding:var(--space-4)}.p-5{padding:var(--space-5)}.p-6{padding:var(--space-6)}.p-8{padding:var(--space-8)}.px-0{padding-inline:0}.px-1{padding-inline:var(--space-1)}.px-2{padding-inline:var(--space-2)}.px-3{padding-inline:var(--space-3)}.px-4{padding-inline:var(--space-4)}.px-5{padding-inline:var(--space-5)}.px-6{padding-inline:var(--space-6)}.px-8{padding-inline:var(--space-8)}.py-0{padding-block:0}.py-1{padding-block:var(--space-1)}.py-2{padding-block:var(--space-2)}.py-3{padding-block:var(--space-3)}.py-4{padding-block:var(--space-4)}.py-5{padding-block:var(--space-5)}.py-6{padding-block:var(--space-6)}.py-8{padding-block:var(--space-8)}.ps-0{padding-inline-start:0}.ps-1{padding-inline-start:var(--space-1)}.ps-2{padding-inline-start:var(--space-2)}.ps-3{padding-inline-start:var(--space-3)}.ps-4{padding-inline-start:var(--space-4)}.ps-5{padding-inline-start:var(--space-5)}.ps-6{padding-inline-start:var(--space-6)}.ps-8{padding-inline-start:var(--space-8)}.pe-0{padding-inline-end:0}.pe-1{padding-inline-end:var(--space-1)}.pe-2{padding-inline-end:var(--space-2)}.pe-3{padding-inline-end:var(--space-3)}.pe-4{padding-inline-end:var(--space-4)}.pe-5{padding-inline-end:var(--space-5)}.pe-6{padding-inline-end:var(--space-6)}.pe-8{padding-inline-end:var(--space-8)}.pt-0{padding-block-start:0}.pt-1{padding-block-start:var(--space-1)}.pt-2{padding-block-start:var(--space-2)}.pt-3{padding-block-start:var(--space-3)}.pt-4{padding-block-start:var(--space-4)}.pt-5{padding-block-start:var(--space-5)}.pt-6{padding-block-start:var(--space-6)}.pt-8{padding-block-start:var(--space-8)}.pb-0{padding-block-end:0}.pb-1{padding-block-end:var(--space-1)}.pb-2{padding-block-end:var(--space-2)}.pb-3{padding-block-end:var(--space-3)}.pb-4{padding-block-end:var(--space-4)}.pb-5{padding-block-end:var(--space-5)}.pb-6{padding-block-end:var(--space-6)}.pb-8{padding-block-end:var(--space-8)}.input{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);transition:border-color .15s ease-in-out}.input:focus{outline:none;border-color:var(--color-input-border-focus)}.input::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.input-sm{padding:var(--space-0-5) var(--space-1);font-size:var(--text-xs)}.input-lg{padding:var(--space-2) var(--space-3);font-size:var(--text-lg)}.textarea{display:block;width:100%;min-height:120px;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);resize:vertical;transition:border-color .15s ease-in-out}.textarea:focus{outline:none;border-color:var(--color-input-border-focus)}.textarea::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.select{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);padding-inline-end:var(--space-6);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right var(--space-2) center;background-size:1em;border:1px solid var(--color-input-border);border-radius:var(--radius-input);appearance:none;cursor:pointer;transition:border-color .15s ease-in-out}.select:focus{outline:none;border-color:var(--color-input-border-focus)}[data-dir=rtl] .select{background-position:left var(--space-2) center}.checkbox,.radio{display:inline-block;width:1rem;height:1rem;margin:0;margin-inline-end:var(--space-1);vertical-align:middle;background-color:var(--color-input-bg);border:1px solid var(--color-input-border);appearance:none;cursor:pointer;transition:all .15s ease-in-out}.checkbox{border-radius:var(--radius-xs)}.radio{border-radius:var(--radius-full)}.checkbox:checked,.radio:checked{background-color:var(--color-primary-600);border-color:var(--color-primary-600)}.checkbox:checked:after{content:"";display:block;width:100%;height:100%;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='20 6 9 17 4 12'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:center;background-size:.75rem}.radio:checked:after{content:"";display:block;width:100%;height:100%;background:#fff;border-radius:var(--radius-full);transform:scale(.4)}.checkbox:focus,.radio:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.label{display:inline-block;margin-block-end:var(--space-1);font-size:var(--text-label-md);font-weight:var(--font-medium);color:var(--color-text-primary)}.label-required:after{content:" *";color:var(--color-error-600)}.form-group{margin-block-end:var(--form-field-spacing)}.form-section{margin-block-end:var(--form-section-spacing);padding-block-end:var(--form-section-spacing);border-block-end:1px solid var(--color-border-default)}.form-section:last-child{margin-block-end:0;padding-block-end:0;border-block-end:none}.field-help{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-text-secondary)}.field-error{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-error-text)}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--button-gap);padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--button-text-md);font-weight:var(--button-font-weight);line-height:var(--leading-tight);text-align:center;text-decoration:none;color:var(--color-button-primary-text);background-color:var(--color-button-primary-bg);border:1px solid var(--color-button-primary-border);border-radius:var(--radius-button);cursor:pointer;transition:all .15s ease-in-out;user-select:none}.btn:hover{background-color:var(--color-button-primary-bg-hover)}.btn:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{color:var(--color-text-primary);background-color:var(--color-neutral-100);border-color:var(--color-neutral-400)}.btn-primary:hover{background-color:var(--color-neutral-200)}.btn-secondary{color:var(--color-button-secondary-text);background-color:var(--color-button-secondary-bg);border-color:var(--color-button-secondary-border)}.btn-secondary:hover{background-color:var(--color-button-secondary-bg-hover)}.btn-link{padding:0;color:var(--color-text-link);background-color:transparent;border:none;text-decoration:var(--link-text-decoration)}.btn-link:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover);background-color:transparent}.btn-sm{padding:var(--space-0-5) var(--space-1-5);font-size:var(--button-text-sm)}.btn-lg{padding:var(--space-2) var(--space-4);font-size:var(--button-text-lg)}fieldset{margin:0;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md)}legend{padding-inline:var(--space-1);font-size:var(--text-sm);font-weight:var(--font-medium);color:var(--color-text-primary)}.form-inline{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2)}.form-inline .form-group{margin-block-end:0;flex:1 1 auto}.form-inline .input,.form-inline .select{width:auto}.input-craigslist:focus,.textarea-craigslist:focus,.select-craigslist:focus{border-color:var(--color-success-600)}.btn-minimal{padding:var(--space-1) var(--space-2);color:var(--color-text-primary);background-color:var(--color-neutral-100);border:1px solid var(--color-neutral-400);border-radius:var(--radius-sm)}.btn-minimal:hover{background-color:var(--color-neutral-200)}.btn-text{padding:0;color:var(--color-text-link);background:none;border:none;text-decoration:underline;cursor:pointer}.btn-text:hover{color:var(--color-text-link-hover)}*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:none;text-size-adjust:none}:root[data-dir=rtl]{direction:rtl}:root[data-dir=ltr]{direction:ltr}body{min-height:100vh;line-height:var(--leading-normal);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:var(--font-sans);font-size:var(--text-base);color:var(--color-text-primary);background-color:var(--color-bg-secondary)}img,picture,video,canvas,svg{display:block;max-width:100%;height:auto}input,button,textarea,select{font:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}h1,h2,h3,h4,h5,h6{font-weight:var(--font-bold);line-height:var(--leading-tight);color:var(--color-text-primary)}h1{font-size:var(--text-heading-2xl);margin-block-end:var(--space-4)}h2{font-size:var(--text-heading-xl);margin-block-end:var(--space-3)}h3{font-size:var(--text-heading-lg);margin-block-end:var(--space-3)}h4{font-size:var(--text-heading-md);margin-block-end:var(--space-2)}h5{font-size:var(--text-heading-sm);margin-block-end:var(--space-2)}h6{font-size:var(--text-heading-xs);margin-block-end:var(--space-2)}p{margin-block-end:var(--space-3)}p:last-child{margin-block-end:0}a{color:var(--color-text-link);text-decoration:var(--link-text-decoration);text-underline-offset:var(--link-underline-offset);transition:color .15s ease-in-out}a:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover)}a:visited{color:var(--color-text-link-visited)}a:focus{outline:2px solid var(--color-focus);outline-offset:2px}ul,ol{margin-block-end:var(--space-3);padding-inline-start:var(--space-5)}ul ul,ul ol,ol ul,ol ol{margin-block-end:0}li{margin-block-end:var(--space-1)}li:last-child{margin-block-end:0}table{width:100%;border-collapse:collapse;margin-block-end:var(--space-4)}th,td{padding:var(--space-2);text-align:start;border-block-end:1px solid var(--color-border-default)}th{font-weight:var(--font-semibold);background-color:var(--color-bg-tertiary)}code,kbd,samp,pre{font-family:var(--font-mono);font-size:var(--code-text-size)}code{padding:var(--space-0-5) var(--space-1);background-color:var(--color-bg-tertiary);border-radius:var(--radius-xs)}pre{overflow-x:auto;padding:var(--space-3);margin-block-end:var(--space-4);background-color:var(--color-bg-tertiary);border-radius:var(--radius-sm)}pre code{padding:0;background-color:transparent}blockquote{padding-inline-start:var(--space-4);margin-block-end:var(--space-4);border-inline-start:3px solid var(--color-border-strong);color:var(--color-text-secondary)}hr{height:0;margin-block:var(--space-6);border:0;border-block-start:1px solid var(--color-border-default)}:focus-visible{outline:2px solid var(--color-focus);outline-offset:2px}::selection{background-color:var(--color-primary-200);color:var(--color-text-primary)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--color-bg-tertiary)}::-webkit-scrollbar-thumb{background:var(--color-neutral-400);border-radius:var(--radius-sm)}::-webkit-scrollbar-thumb:hover{background:var(--color-neutral-500)}.skip-link{position:absolute;top:-40px;left:0;padding:var(--space-2) var(--space-4);background:var(--color-bg-primary);color:var(--color-text-link);text-decoration:none;z-index:100}.skip-link:focus{top:0}@media (prefers-reduced-motion: reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}#app{margin:0;padding:0;width:100vw;height:100vh;overflow:hidden;display:flex;flex-direction:column}body:not(.sb-show-main){overflow:hidden}html{height:100%}html,body{margin:0;padding:0}.theme-toggle.svelte-v7l3jb{display:inline-flex;align-items:center;gap:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-3);background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;outline:none;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.theme-toggle.svelte-v7l3jb:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.theme-toggle.svelte-v7l3jb:active{transform:translateY(0);box-shadow:none}.theme-toggle--small.svelte-v7l3jb{padding-block:var(--space-1);padding-inline:var(--space-2);font-size:var(--text-xs);gap:var(--space-1)}.theme-toggle--large.svelte-v7l3jb{padding-block:var(--space-3);padding-inline:var(--space-4);font-size:var(--text-base);gap:var(--space-3)}.theme-toggle__icon.svelte-v7l3jb{display:flex;align-items:center;justify-content:center;inline-size:1.2em;block-size:1.2em;flex-shrink:0}.theme-toggle__icon.svelte-v7l3jb svg:where(.svelte-v7l3jb){inline-size:100%;block-size:100%}.theme-toggle__label.svelte-v7l3jb{white-space:nowrap}.theme-toggle--small.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1em;block-size:1em}.theme-toggle--large.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1.4em;block-size:1.4em}@media (prefers-contrast: high){.theme-toggle.svelte-v7l3jb{border:2px solid var(--color-forced-border)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:3px solid var(--color-forced-active)}}@media (prefers-reduced-motion: reduce){.theme-toggle.svelte-v7l3jb{transition:none}.theme-toggle.svelte-v7l3jb:hover,.theme-toggle.svelte-v7l3jb:active{transform:none}}.sidebar.svelte-qtftjm{--sidebar-width: 250px;--sidebar-collapsed-width: 48px;inline-size:100%;background:var(--color-sidebar-bg);display:flex;flex-direction:column;overflow-x:visible;overflow-y:hidden;block-size:100vh;position:relative}.sidebar.collapsed.svelte-qtftjm{inline-size:100%}.sidebar-header.svelte-qtftjm{display:flex;align-items:center;padding-block:var(--space-1);padding-inline:var(--space-2);border-block-end:1px solid var(--color-border-default);background:var(--color-bg-primary);flex-shrink:0;min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-qtftjm{background:none;border:none;font-size:var(--text-lg);cursor:pointer;padding-block:var(--space-2);padding-inline:var(--space-2);border-radius:var(--radius-sm);transition:background-color var(--duration-fast) ease;display:flex;align-items:center;justify-content:center;inline-size:32px;block-size:32px;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-qtftjm:hover{background:var(--color-interactive-secondary-hover)}.sidebar-toggle.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.sidebar-title.svelte-qtftjm{margin:0;margin-inline-start:var(--space-2);font-size:var(--text-sm);font-weight:var(--font-normal);color:var(--color-text-secondary);flex:1}.header-actions.svelte-qtftjm{display:flex;align-items:center;gap:var(--space-1);margin-inline-start:var(--space-2)}.header-actions.compact.svelte-qtftjm{margin-inline-start:0;justify-content:center}.sidebar-main.svelte-qtftjm{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;background:var(--color-bg-secondary)}.sidebar-nav.svelte-qtftjm{padding-block:0;padding-inline:0;flex-shrink:0}.sidebar-footer.svelte-qtftjm{flex-shrink:0;background:var(--color-bg-secondary);border-top:1px solid var(--color-border-default)}.sidebar-section.svelte-qtftjm{inline-size:100%;background:transparent;border:none;display:flex;align-items:center;padding-block:var(--space-2);padding-inline:var(--space-2);cursor:pointer;transition:background-color .1s ease;text-align:start;color:var(--color-text-link);min-block-size:var(--touch-target-min);font-size:var(--text-sm);outline:none;position:relative}.sidebar-section.svelte-qtftjm:hover{text-decoration:underline}.sidebar-section.svelte-qtftjm:hover:not(.active){background:var(--color-bg-tertiary)}.sidebar-section.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.sidebar .sidebar-section.active{background:var(--color-bg-primary)!important;color:var(--color-text-primary)!important;font-weight:var(--font-normal)!important;border-top:1px solid var(--color-border-default)!important;border-bottom:1px solid var(--color-border-default)!important;border-right:1px solid var(--color-bg-primary)!important;margin-inline-end:-1px!important;position:relative!important;z-index:1!important}.sidebar .sidebar-section.active .section-label{text-decoration:none!important}.spine-section-header.svelte-qtftjm{display:flex;align-items:center;justify-content:space-between;padding-block:var(--space-2);padding-inline:var(--space-2);min-block-size:var(--touch-target-min);color:var(--color-text-primary);background:transparent}.spine-section-header.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-sm);font-weight:var(--font-normal)}.spine-section-header.compact.svelte-qtftjm{justify-content:center;flex-direction:column;gap:var(--space-1);padding-block:var(--space-1)}.spine-section-header.compact.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-xs);text-align:center}.append-button-nav.svelte-qtftjm{display:flex;align-items:center;justify-content:center;inline-size:var(--touch-target-min);block-size:var(--touch-target-min);border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.append-button-nav.svelte-qtftjm:hover{background:var(--color-bg-tertiary);color:var(--color-text-primary)}.append-button-nav.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.append-button-nav.compact.svelte-qtftjm{inline-size:var(--touch-target-min);block-size:var(--touch-target-min);font-size:var(--text-xs)}.append-icon.svelte-qtftjm{font-size:var(--text-sm);font-weight:var(--font-medium)}.spine-items-container.svelte-qtftjm{flex:1}.section-label.svelte-qtftjm{font-size:var(--text-base);font-weight:var(--font-normal)}.sidebar.collapsed.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.sidebar.collapsed.svelte-qtftjm .sidebar-section:where(.svelte-qtftjm){justify-content:center;padding-inline:var(--space-1)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar{inline-size:6px}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.sidebar.svelte-qtftjm{--sidebar-width: 250px}.sidebar.collapsed.svelte-qtftjm{--sidebar-width: 48px}@media (prefers-contrast: high){.sidebar.svelte-qtftjm{border-inline-end:2px solid var(--color-forced-border)}.sidebar-header.svelte-qtftjm{border-block-end:2px solid var(--color-forced-border)}.sidebar-section.active.svelte-qtftjm{border-inline-end:4px solid var(--color-forced-active)}}[dir=rtl] .sidebar-toggle.svelte-qtftjm{transform:scaleX(-1)}.sidebar-section.svelte-qtftjm:disabled,.sidebar-section.disabled.svelte-qtftjm{opacity:.5;cursor:not-allowed;color:var(--color-text-disabled, var(--color-text-tertiary))}.sidebar-section.svelte-qtftjm:disabled:hover,.sidebar-section.disabled.svelte-qtftjm:hover{text-decoration:none;background:transparent}.spine-section-header.disabled.svelte-qtftjm{opacity:.5}.spine-section-header.disabled.svelte-qtftjm .section-label:where(.svelte-qtftjm){color:var(--color-text-disabled, var(--color-text-tertiary))}.append-button-nav.svelte-qtftjm:disabled,.append-button-nav.disabled.svelte-qtftjm{opacity:.5;cursor:not-allowed;background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.append-button-nav.svelte-qtftjm:disabled:hover,.append-button-nav.disabled.svelte-qtftjm:hover{background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.app-layout.svelte-1b458cb{display:grid;height:100vh;width:100vw;margin:0;padding:0}.main-content.svelte-1b458cb{min-inline-size:0;overflow:hidden}.pane-container.svelte-1b458cb{display:flex;flex-direction:column;height:100%}.pane-header.svelte-1b458cb{flex-shrink:0;border-block-end:1px solid var(--color-border-default);background:var(--color-bg-secondary);min-block-size:40px;display:flex;align-items:center;padding-inline:var(--space-4);padding-block:0}.pane-content.svelte-1b458cb{flex:1;overflow:auto;background:var(--color-bg-primary)}.single-pane-container.svelte-1b458cb{display:flex;flex-direction:column;height:100%}[data-pane-resizer]{background:var(--color-border-default);inline-size:4px;cursor:col-resize;transition:background-color var(--duration-fast) ease}[data-pane-resizer]:hover{background:var(--color-border-strong)}[data-pane-resizer][data-resize-handle-active]{background:var(--color-border-accent)}[data-pane-resizer]:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}@media (prefers-contrast: high){.pane-header.svelte-1b458cb{border-block-end:2px solid var(--color-forced-border)}}.workspace-action-bar.svelte-4wg9d{margin-block-end:var(--space-6)}.section-title.svelte-4wg9d{margin:0 0 var(--space-4) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.action-buttons.svelte-4wg9d{display:grid;grid-template-columns:repeat(auto-fit,minmax(15em,1fr));gap:var(--space-4)}.action-button.svelte-4wg9d{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:2px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-family:inherit;cursor:pointer;transition:all var(--duration-normal) ease;text-align:left;min-height:80px;position:relative}.action-button.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);transform:translateY(-2px);box-shadow:var(--shadow-md)}.action-button.svelte-4wg9d:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.action-button.primary.svelte-4wg9d{border-color:var(--color-primary);background-color:var(--color-primary);color:var(--color-surface)}.action-button.primary.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-hover)}.action-button.svelte-4wg9d:disabled{opacity:.6;cursor:not-allowed;transform:none}.action-button.svelte-4wg9d:disabled:hover{border-color:var(--color-border-default);background-color:var(--color-surface-primary);transform:none;box-shadow:none}.action-button.primary.svelte-4wg9d:disabled:hover{border-color:var(--color-primary);background-color:var(--color-primary)}.button-icon.svelte-4wg9d{font-size:2rem;flex-shrink:0}.button-content.svelte-4wg9d{display:flex;flex-direction:column;gap:var(--space-1);flex:1;min-width:0}.button-title.svelte-4wg9d{font-size:var(--text-base);font-weight:600;line-height:1.2}.button-subtitle.svelte-4wg9d{font-size:var(--text-sm);opacity:.8;line-height:1.2}.action-button.primary.svelte-4wg9d .button-subtitle:where(.svelte-4wg9d){opacity:.9}.action-button.svelte-4wg9d:disabled .button-icon:where(.svelte-4wg9d){opacity:.5}@media (max-width: 768px){.action-buttons.svelte-4wg9d{grid-template-columns:1fr;gap:var(--space-3)}.action-button.svelte-4wg9d{min-height:70px;padding:var(--space-3)}.button-icon.svelte-4wg9d{font-size:1.5rem}}@media (max-width: 480px){.action-button.svelte-4wg9d{flex-direction:column;text-align:center;gap:var(--space-2);min-height:90px}.button-content.svelte-4wg9d{align-items:center}}.workspace-item.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);cursor:pointer;transition:all var(--duration-fast) ease;margin-block-end:var(--space-3);min-height:44px}.workspace-item.svelte-ijd5ei:hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);box-shadow:var(--shadow-sm)}.workspace-item.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.workspace-item.current.svelte-ijd5ei{border-color:var(--color-primary);background-color:var(--color-primary-surface)}.workspace-item.current.svelte-ijd5ei:hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-surface-hover)}.workspace-item.error.svelte-ijd5ei{border-color:var(--color-warning);background-color:var(--color-warning-surface)}.workspace-item.error.svelte-ijd5ei:hover{border-color:var(--color-warning-hover)}.workspace-main.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);flex:1;min-width:0}.workspace-icon-container.svelte-ijd5ei{flex-shrink:0}.workspace-icon.svelte-ijd5ei{font-size:1.5rem;display:block}.workspace-icon.error.svelte-ijd5ei{font-size:1.25rem;color:var(--color-warning)}.workspace-info.svelte-ijd5ei{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--space-1)}.workspace-header.svelte-ijd5ei{display:flex;align-items:center;justify-content:space-between;gap:var(--space-2)}.workspace-title.svelte-ijd5ei{margin:0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;gap:var(--space-2);flex:1;min-width:0}.current-badge.svelte-ijd5ei{font-size:var(--text-xs);font-weight:500;padding:2px var(--space-1);background-color:var(--color-primary);color:var(--color-surface);border-radius:var(--radius-xs);flex-shrink:0}.workspace-time.svelte-ijd5ei{font-size:var(--text-sm);color:var(--color-text-secondary);flex-shrink:0}.workspace-meta.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-1);font-size:var(--text-sm);color:var(--color-text-secondary);overflow:hidden}.workspace-author-inline.svelte-ijd5ei{color:var(--color-text-secondary);font-weight:400}.meta-separator.svelte-ijd5ei{flex-shrink:0;opacity:.6}.workspace-language.svelte-ijd5ei{flex-shrink:0;text-transform:uppercase;font-weight:500}.workspace-stats.svelte-ijd5ei{flex-shrink:0}.workspace-actions.svelte-ijd5ei{display:flex;gap:var(--space-2);flex-shrink:0}.delete-button.svelte-ijd5ei{min-width:44px;min-height:44px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-secondary);color:var(--color-text-secondary);font-size:1.25rem;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.delete-button.svelte-ijd5ei:hover{border-color:var(--color-error);background-color:var(--color-error-surface);color:var(--color-error)}.delete-button.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-error);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}@media (max-width: 640px){.workspace-item.svelte-ijd5ei{padding:var(--space-3)}.workspace-header.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-1)}.workspace-time.svelte-ijd5ei{order:-1;align-self:flex-end}.workspace-meta.svelte-ijd5ei{flex-wrap:wrap}.workspace-stats.svelte-ijd5ei{flex:1 0 100%;margin-block-start:var(--space-1)}}@media (max-width: 480px){.workspace-main.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-2)}.workspace-icon-container.svelte-ijd5ei{align-self:center}.workspace-info.svelte-ijd5ei{width:100%}.workspace-actions.svelte-ijd5ei{align-self:center}}.workspace-list.svelte-1cps7l{display:flex;flex-direction:column;gap:var(--space-4)}.list-header.svelte-1cps7l{display:flex;flex-direction:column;gap:var(--space-3)}.search-container.svelte-1cps7l{display:flex;justify-content:flex-end}.search-input-wrapper.svelte-1cps7l{position:relative;max-width:300px;width:100%}.search-input.svelte-1cps7l{width:100%;padding:var(--space-2) var(--space-3);padding-inline-end:var(--space-8);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-size:var(--text-sm);transition:all var(--duration-fast) ease}.search-input.svelte-1cps7l:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.search-input.svelte-1cps7l::placeholder{color:var(--color-text-tertiary)}.clear-search.svelte-1cps7l{position:absolute;top:50%;inset-inline-end:var(--space-2);transform:translateY(-50%);width:24px;height:24px;border:none;border-radius:var(--radius-sm);background-color:var(--color-surface-tertiary);color:var(--color-text-secondary);font-size:1rem;font-weight:700;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.clear-search.svelte-1cps7l:hover{background-color:var(--color-surface-hover);color:var(--color-text-primary)}.list-content.svelte-1cps7l{min-height:200px}.loading-state.svelte-1cps7l{display:flex;flex-direction:column;gap:var(--space-3)}.skeleton-item.svelte-1cps7l{height:80px;background-color:var(--color-surface-tertiary);border-radius:var(--radius-md);animation:svelte-1cps7l-pulse 2s infinite;opacity:.6}@keyframes svelte-1cps7l-pulse{0%,to{opacity:.6}50%{opacity:.8}}.loading-text.svelte-1cps7l{text-align:center;color:var(--color-text-secondary);font-style:italic;margin:var(--space-4) 0 0 0}.empty-state.svelte-1cps7l{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.empty-icon.svelte-1cps7l{font-size:4rem;margin-block-end:var(--space-4);display:block}.empty-title.svelte-1cps7l{margin:0 0 var(--space-2) 0;font-size:var(--text-xl);font-weight:600;color:var(--color-text-primary)}.empty-description.svelte-1cps7l{margin:0 0 var(--space-6) 0;font-size:var(--text-base)}.empty-tips.svelte-1cps7l{max-width:400px;margin:0 auto;text-align:left}.tips-title.svelte-1cps7l{margin:0 0 var(--space-2) 0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary)}.tips-list.svelte-1cps7l{margin:0;padding-inline-start:var(--space-4);list-style-type:disc}.tips-list.svelte-1cps7l li:where(.svelte-1cps7l){margin-block-end:var(--space-1);font-size:var(--text-sm);line-height:1.5}.no-results.svelte-1cps7l{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.no-results-icon.svelte-1cps7l{font-size:3rem;margin-block-end:var(--space-4);display:block;opacity:.6}.no-results-title.svelte-1cps7l{margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.no-results-description.svelte-1cps7l{margin:0 0 var(--space-4) 0;font-size:var(--text-base)}.clear-search-button.svelte-1cps7l{padding:var(--space-2) var(--space-4);border:1px solid var(--color-primary);border-radius:var(--radius-md);background-color:transparent;color:var(--color-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.clear-search-button.svelte-1cps7l:hover{background-color:var(--color-primary);color:var(--color-surface)}.workspace-grid.svelte-1cps7l{display:flex;flex-direction:column;gap:0}.search-results-info.svelte-1cps7l{margin-block-start:var(--space-4);padding-block-start:var(--space-4);border-block-start:1px solid var(--color-border-default)}.results-text.svelte-1cps7l{margin:0;text-align:center;font-size:var(--text-sm);color:var(--color-text-secondary);font-style:italic}@media (max-width: 768px){.list-header.svelte-1cps7l{gap:var(--space-2)}.search-container.svelte-1cps7l{justify-content:stretch}.search-input-wrapper.svelte-1cps7l{max-width:none}.empty-state.svelte-1cps7l{padding:var(--space-6) var(--space-2)}.empty-icon.svelte-1cps7l{font-size:3rem}.empty-tips.svelte-1cps7l{text-align:center}}.workspace-view.svelte-9tke9n{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-content.svelte-9tke9n{flex:1;padding:var(--space-6);overflow-y:auto}.error-banner.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);margin-block-end:var(--space-6);background-color:var(--color-error-surface);color:var(--color-error);border:1px solid var(--color-error);border-radius:var(--radius-md)}.error-icon.svelte-9tke9n{font-size:1.25rem;flex-shrink:0}.error-text.svelte-9tke9n{flex:1;font-weight:500}.retry-button.svelte-9tke9n{padding:var(--space-2) var(--space-3);border:1px solid var(--color-error);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-error);font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:44px}.retry-button.svelte-9tke9n:hover{background-color:var(--color-error);color:var(--color-surface)}.retry-button.svelte-9tke9n:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.unsaved-indicator.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);margin-block-start:var(--space-6);background-color:var(--color-warning-surface);color:var(--color-warning);border:1px solid var(--color-warning);border-radius:var(--radius-md);font-size:var(--text-sm)}.indicator-icon.svelte-9tke9n{font-size:var(--text-base);flex-shrink:0}@media (max-width: 768px){.view-content.svelte-9tke9n{padding:var(--space-4)}}.metadata-tab.svelte-z75kp3{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;border:none;border-block-end:2px solid transparent;background-color:transparent;color:var(--color-text-secondary);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;white-space:nowrap}.metadata-tab.svelte-z75kp3:hover:not(.disabled){color:var(--color-text-primary);background-color:var(--color-surface-hover)}.metadata-tab.svelte-z75kp3:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-radius:var(--radius-sm)}.metadata-tab.active.svelte-z75kp3{color:var(--color-primary);border-block-end-color:var(--color-primary);background-color:var(--color-surface-primary)}.metadata-tab.has-errors.svelte-z75kp3{color:var(--color-error)}.metadata-tab.has-errors.active.svelte-z75kp3{border-block-end-color:var(--color-error)}.metadata-tab.disabled.svelte-z75kp3{color:var(--color-text-disabled);cursor:not-allowed}.tab-label.svelte-z75kp3{flex:1}.error-indicator.svelte-z75kp3{display:inline-flex;align-items:center;justify-content:center;width:1.25rem;height:1.25rem;border-radius:50%;background-color:var(--color-error);color:var(--color-surface);font-size:.75rem;font-weight:700;line-height:1}[dir=rtl] .metadata-tab.svelte-z75kp3{flex-direction:row-reverse}.metadata-tab-bar.svelte-1pzcjt6{display:flex;border-block-end:1px solid var(--color-border-default);background-color:var(--color-surface-primary);overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none}.metadata-tab-bar.svelte-1pzcjt6::-webkit-scrollbar{display:none}@media (max-width: 480px){.metadata-tab-bar.svelte-1pzcjt6{flex-wrap:wrap}}.metadata-field.svelte-cp96ig{margin-block-end:1rem}.field-label.svelte-cp96ig{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-cp96ig{color:var(--color-success-600)}.field-input.svelte-cp96ig{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-cp96ig:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-cp96ig:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-cp96ig{border-color:var(--color-error)}.field-input.error.svelte-cp96ig:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-cp96ig{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-cp96ig:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-cp96ig{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-bssb4o{margin-block-end:1rem}.field-label.svelte-bssb4o{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-bssb4o{color:var(--color-success-600)}.field-select.svelte-bssb4o{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;cursor:pointer}.field-select.svelte-bssb4o:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-select.svelte-bssb4o:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-select.error.svelte-bssb4o{border-color:var(--color-error)}.field-select.error.svelte-bssb4o:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-select.needs-attention.svelte-bssb4o{border-color:var(--color-success-600)}.field-select.needs-attention.svelte-bssb4o:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-bssb4o{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-1c704qf{margin-block-end:1rem}.field-label.svelte-1c704qf{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-1c704qf{color:var(--color-success-600)}.required.svelte-1c704qf{color:var(--color-error);margin-inline-start:.25rem}.field-textarea.svelte-1c704qf{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;resize:vertical;font-family:inherit;line-height:1.5;field-sizing:content;min-height:calc(4.5em + 1.5rem)}.field-textarea.svelte-1c704qf:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-textarea.svelte-1c704qf:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed;resize:none}.field-textarea.error.svelte-1c704qf{border-color:var(--color-error)}.field-textarea.error.svelte-1c704qf:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-textarea.needs-attention.svelte-1c704qf{border-color:var(--color-success-600)}.field-textarea.needs-attention.svelte-1c704qf:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-1c704qf{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.basic-info-fields.svelte-1nofkco{padding:1.5rem}.form-columns.svelte-1nofkco{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-1nofkco{grid-template-columns:1fr 1fr}}.column.svelte-1nofkco{min-width:0}.field-group.svelte-1nofkco{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-1nofkco:last-child{margin-block-end:0}.group-title.svelte-1nofkco{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.identifier-field.svelte-1nofkco{display:flex;gap:.5rem;align-items:flex-end}.identifier-field.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.generate-button.svelte-1nofkco{padding:.75rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap;height:fit-content}.generate-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.generate-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.generate-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.array-field.svelte-1nofkco{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-1nofkco{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-1nofkco .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-1nofkco .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-1nofkco .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-1nofkco .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-1nofkco{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-1nofkco:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-1nofkco{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.metadata-field.svelte-14vfa0w{margin-block-end:1rem}.field-label.svelte-14vfa0w{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-14vfa0w{color:var(--color-success-600)}.required.svelte-14vfa0w{color:var(--color-error);margin-inline-start:.25rem}.date-input-wrapper.svelte-14vfa0w{display:flex;gap:.5rem;align-items:center}.field-input.svelte-14vfa0w{flex:1;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-14vfa0w:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-14vfa0w{border-color:var(--color-error)}.field-input.error.svelte-14vfa0w:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-14vfa0w{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-14vfa0w:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.today-button.svelte-14vfa0w{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.today-button.svelte-14vfa0w:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.today-button.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-error.svelte-14vfa0w{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.advanced-fields.svelte-fuok1{padding:1.5rem}.form-columns.svelte-fuok1{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-fuok1{grid-template-columns:1fr 1fr}}.column.svelte-fuok1{min-width:0}.field-group.svelte-fuok1{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-fuok1:last-child{margin-block-end:0}.group-title.svelte-fuok1{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.array-field.svelte-fuok1{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-fuok1{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-fuok1 .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-fuok1 .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-fuok1 .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-fuok1 .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-fuok1 .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-fuok1{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-fuok1:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-fuok1{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-fuok1:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.metadata-editor.svelte-17s3g49{display:flex;flex-direction:column;height:100%;background-color:var(--color-surface-primary)}.pane-header.svelte-17s3g49{flex-shrink:0;border-block-end:1px solid var(--color-border-default)}.pane-content.svelte-17s3g49{flex:1;overflow-y:auto;background-color:var(--color-bg-primary)}.tab-panel.svelte-17s3g49{height:100%}.loading-state.svelte-17s3g49,.error-state.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-17s3g49{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-17s3g49{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-17s3g49:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-17s3g49:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.placeholder-panel.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.placeholder-panel.svelte-17s3g49 p:where(.svelte-17s3g49):first-child{font-size:1.125rem;font-weight:600;margin-block-end:.5rem}.placeholder-description.svelte-17s3g49{font-size:.875rem;opacity:.8}.placeholder-view.svelte-skhkuy{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-header.svelte-skhkuy{display:flex;align-items:center;justify-content:space-between;padding:var(--space-6);border-bottom:1px solid var(--color-border-default);background-color:var(--color-bg-secondary)}.header-content.svelte-skhkuy{display:flex;align-items:center;gap:var(--space-3)}.view-icon.svelte-skhkuy{font-size:var(--text-2xl)}.header-text.svelte-skhkuy h2:where(.svelte-skhkuy){margin:0 0 var(--space-1) 0;font-size:var(--text-xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.header-text.svelte-skhkuy p:where(.svelte-skhkuy){margin:0;font-size:var(--text-sm);color:var(--color-text-secondary)}.coming-soon-badge.svelte-skhkuy{padding:var(--space-1) var(--space-2);background-color:var(--color-accent);color:#fff;border-radius:var(--radius-md);font-size:var(--text-xs);font-weight:var(--font-medium)}.view-content.svelte-skhkuy{flex:1;overflow-y:auto;display:flex;align-items:center;justify-content:center;padding:var(--space-6)}.placeholder-content.svelte-skhkuy{max-width:600px;text-align:center}.placeholder-icon.svelte-skhkuy{margin-bottom:var(--space-6)}.large-icon.svelte-skhkuy{font-size:4rem;opacity:.6}.placeholder-content.svelte-skhkuy h3:where(.svelte-skhkuy){margin:0 0 var(--space-4) 0;font-size:var(--text-2xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.placeholder-description.svelte-skhkuy{margin:0 0 var(--space-8) 0;font-size:var(--text-base);color:var(--color-text-secondary);line-height:var(--leading-relaxed)}.feature-preview.svelte-skhkuy{margin-bottom:var(--space-8);text-align:left}.feature-preview.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary);text-align:center}.feature-list.svelte-skhkuy{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--space-2)}.feature-list.svelte-skhkuy li:where(.svelte-skhkuy){padding:var(--space-2);background-color:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-size:var(--text-sm);color:var(--color-text-primary)}.demo-actions.svelte-skhkuy{margin-bottom:var(--space-6)}.demo-actions.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary)}.action-buttons.svelte-skhkuy{display:flex;gap:var(--space-3);justify-content:center;flex-wrap:wrap}.btn.svelte-skhkuy{display:inline-flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-4);border:none;border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;text-decoration:none}.btn-primary.svelte-skhkuy{color:var(--color-text-inverse)}.btn-primary.svelte-skhkuy:hover{background-color:var(--color-accent-dark, var(--color-accent));transform:translateY(-1px);box-shadow:var(--shadow-sm)}.btn-secondary.svelte-skhkuy{background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default)}.btn-secondary.svelte-skhkuy:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover)}.last-action.svelte-skhkuy{display:flex;align-items:center;justify-content:center;gap:var(--space-2);padding:var(--space-3);background-color:var(--color-success-bg, #d4edda);color:var(--color-success-text, #155724);border:1px solid var(--color-success-border, #c3e6cb);border-radius:var(--radius-md);font-size:var(--text-sm)}.action-icon.svelte-skhkuy{font-size:var(--text-base)}.editor-pane-container.svelte-1o393xc{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.editor-header.svelte-1o393xc{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.editor-controls.svelte-1o393xc{display:flex;gap:var(--space-2)}.pane-toggle-btn.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-2) var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);cursor:pointer;transition:all var(--duration-fast) ease;font-size:var(--text-sm);font-weight:var(--font-medium)}.pane-toggle-btn.svelte-1o393xc:hover{background:var(--color-bg-hover);border-color:var(--color-accent-primary)}.pane-toggle-btn.svelte-1o393xc:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.toggle-icon.svelte-1o393xc{font-size:var(--text-base);font-weight:700}.toggle-label.svelte-1o393xc{font-size:var(--text-sm)}.editor-status.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-2)}.status-indicator.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:var(--font-medium)}.status-indicator.transforming.svelte-1o393xc{background:var(--color-info-bg);color:var(--color-info-text)}.status-indicator.error.svelte-1o393xc{background:var(--color-error-bg);color:var(--color-error-text)}.status-indicator.warning.svelte-1o393xc{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-indicator.success.svelte-1o393xc{background:var(--color-success-bg);color:var(--color-success-text)}.status-spinner.svelte-1o393xc{width:12px;height:12px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-1o393xc-spin var(--duration-normal) linear infinite}@keyframes svelte-1o393xc-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.force-update-btn.svelte-1o393xc{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm);transition:all var(--duration-fast) ease}.force-update-btn.svelte-1o393xc:hover:not(:disabled){background:var(--color-bg-hover)}.force-update-btn.svelte-1o393xc:disabled{opacity:.5;cursor:not-allowed}.editor-content.svelte-1o393xc{flex:1;overflow:hidden}.editor-panes.svelte-1o393xc{display:flex;flex-direction:column;height:100%}.editor-pane.svelte-1o393xc{display:flex;flex-direction:column;flex:1;min-height:0}.editor-panes.dual-mode.svelte-1o393xc .editor-pane:where(.svelte-1o393xc){flex:1}.pane-2.svelte-1o393xc{border-bottom:1px solid var(--color-border-default)}.pane-header.svelte-1o393xc{padding:var(--space-2);background:var(--color-bg-tertiary);border-bottom:1px solid var(--color-border-default)}.file-selector.svelte-1o393xc{width:100%;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer}.file-selector.svelte-1o393xc:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.textarea-container.svelte-1o393xc{flex:1;padding:var(--space-2);overflow:hidden;position:relative}.content-textarea.svelte-1o393xc{width:100%;height:100%;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background:var(--color-bg-primary);color:var(--color-text-primary);font-family:var(--font-mono);font-size:var(--text-sm);line-height:var(--leading-relaxed);resize:none;outline:none}.content-textarea.svelte-1o393xc:focus{border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.content-textarea.has-error.svelte-1o393xc{border-color:var(--color-error-border)}.content-textarea.has-error.svelte-1o393xc:focus{border-color:var(--color-error-border);box-shadow:0 0 0 var(--focus-ring-width) var(--color-error-text)}.pane-error-overlay.svelte-1o393xc{position:absolute;bottom:var(--space-3);left:var(--space-3);right:var(--space-3);display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-3);background:var(--color-error-bg);border:1px solid var(--color-error-border);border-radius:var(--radius-sm);color:var(--color-error-text);font-size:var(--text-sm);box-shadow:0 2px 8px #00000026;z-index:10}.pane-error-overlay.svelte-1o393xc .error-icon:where(.svelte-1o393xc){font-size:var(--text-base);flex-shrink:0}.pane-error-overlay.svelte-1o393xc .error-message:where(.svelte-1o393xc){flex:1;font-family:var(--font-mono)}.error-display.svelte-1o393xc,.warnings-display.svelte-1o393xc{margin:var(--space-2);padding:var(--space-3);border-radius:var(--radius-md)}.error-display.svelte-1o393xc{background:var(--color-error-bg);border:1px solid var(--color-error-border);color:var(--color-error-text)}.warnings-display.svelte-1o393xc{background:var(--color-warning-bg);border:1px solid var(--color-warning-border);color:var(--color-warning-text)}.error-header.svelte-1o393xc,.warnings-header.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2)}.error-message.svelte-1o393xc{font-family:var(--font-mono);font-size:var(--text-sm)}.error-stack.svelte-1o393xc{margin-top:var(--space-2)}.error-stack.svelte-1o393xc pre:where(.svelte-1o393xc){font-family:var(--font-mono);font-size:var(--text-xs);overflow-x:auto;margin:var(--space-1) 0 0}.warnings-list.svelte-1o393xc{margin:0;padding-left:var(--space-4);font-size:var(--text-sm)}.warnings-list.svelte-1o393xc li:where(.svelte-1o393xc){margin-bottom:var(--space-1)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-1o393xc{animation:none}.pane-toggle-btn.svelte-1o393xc,.force-update-btn.svelte-1o393xc{transition:none}}.preview-pane-container.svelte-32psnf{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.preview-header.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.preview-title.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);font-weight:var(--font-medium);color:var(--color-text-primary)}.preview-controls.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2)}.orientation-toggle.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;margin-right:var(--space-2);min-width:32px;display:inline-flex;align-items:center;justify-content:center}.orientation-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.orientation-toggle.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.device-selector.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-xs);cursor:pointer}.device-selector.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.view-toggle.svelte-32psnf{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm)}.view-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.view-toggle.active.svelte-32psnf{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary)}.transform-status.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2);font-size:var(--text-sm);font-weight:var(--font-medium)}.transform-status.transforming.svelte-32psnf{background:var(--color-info-bg);color:var(--color-info-text)}.transform-status.error.svelte-32psnf{background:var(--color-error-bg);color:var(--color-error-text)}.transform-status.warning.svelte-32psnf{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-spinner.svelte-32psnf{width:16px;height:16px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-32psnf-spin var(--duration-normal) linear infinite}@keyframes svelte-32psnf-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.preview-content.svelte-32psnf{flex:1;overflow:hidden;background:var(--color-bg-primary)}.source-view.svelte-32psnf{height:100%;overflow:auto}.source-code.svelte-32psnf{margin:0;padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-xs);line-height:var(--leading-relaxed);color:var(--color-text-primary);background:var(--color-bg-primary);white-space:pre-wrap}.preview-viewport.svelte-32psnf{height:100%;display:flex;justify-content:center;align-items:center;background-color:var(--color-bg-tertiary)}.preview-frame-wrapper.svelte-32psnf{position:relative}.preview-frame-container.svelte-32psnf{width:100%;height:100%;border:1px solid var(--color-border-default);border-radius:var(--radius-md);overflow:hidden}.preview-frame-container.device-frame.svelte-32psnf{box-shadow:var(--shadow-lg);border:2px solid var(--color-border-strong)}.preview-iframe.svelte-32psnf{width:100%;height:100%;border:none;background:#fff}.preview-error.svelte-32psnf,.preview-empty.svelte-32psnf{display:flex;align-items:center;justify-content:center;height:100%;padding:var(--space-4)}.error-content.svelte-32psnf,.empty-content.svelte-32psnf{text-align:center;max-width:400px}.error-content.svelte-32psnf{color:var(--color-error-text)}.error-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg)}.error-content.svelte-32psnf p:where(.svelte-32psnf){margin:var(--space-1) 0;font-size:var(--text-sm)}.error-stack.svelte-32psnf{font-family:var(--font-mono);font-size:var(--text-xs);text-align:left;background:var(--color-bg-secondary);padding:var(--space-2);border-radius:var(--radius-sm);margin-top:var(--space-2);overflow-x:auto}.empty-content.svelte-32psnf{color:var(--color-text-secondary)}.empty-icon.svelte-32psnf{font-size:var(--text-4xl);display:block;margin-bottom:var(--space-3)}.empty-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);color:var(--color-text-primary)}.empty-content.svelte-32psnf p:where(.svelte-32psnf){margin:0;font-size:var(--text-sm)}.preview-footer.svelte-32psnf{padding:var(--space-2);border-top:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.meta-info.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;font-size:var(--text-xs);color:var(--color-text-tertiary)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf){margin-right:var(--space-3)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf):last-child{margin-right:0}.warning-count.svelte-32psnf{color:var(--color-warning-text);background:var(--color-warning-bg);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-32psnf{animation:none}.view-toggle.svelte-32psnf{transition:none}}@media (prefers-contrast: high){.preview-frame-container.svelte-32psnf{border:2px solid var(--color-forced-border)}}.loading-state.svelte-19lb94x,.error-state.svelte-19lb94x,.empty-state.svelte-19lb94x{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:var(--space-8);background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-19lb94x{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-19lb94x-spin 1s linear infinite;margin-bottom:var(--space-4)}@keyframes svelte-19lb94x-spin{to{transform:rotate(360deg)}}.error-icon.svelte-19lb94x{font-size:var(--text-2xl);margin-bottom:var(--space-3)}.error-state.svelte-19lb94x{color:var(--color-error-text)}.empty-icon.svelte-19lb94x{font-size:3rem;opacity:.5;margin-bottom:var(--space-4)}.empty-state.svelte-19lb94x h3:where(.svelte-19lb94x){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:var(--font-medium)}.empty-state.svelte-19lb94x p:where(.svelte-19lb94x){margin:0;color:var(--color-text-secondary);font-size:var(--text-sm)}.spine-editor-wrapper.svelte-19lb94x{height:100%;display:flex;flex-direction:column}@media (prefers-reduced-motion: reduce){.spinner.svelte-19lb94x{animation:none}}.settings-view.svelte-1cp4vip{padding:1rem;max-width:100%;width:100%;margin:0}.settings-header.svelte-1cp4vip h1:where(.svelte-1cp4vip){margin:0 0 .5rem;font-size:1.5rem;font-weight:600}.no-workspace-message.svelte-1cp4vip,.loading-message.svelte-1cp4vip{color:var(--text-muted, #666);font-style:italic}.error-message.svelte-1cp4vip{background:var(--error-bg, #fee);color:var(--error-text, #c33);padding:.75rem;border-radius:.25rem;border:1px solid var(--error-border, #fcc);margin-bottom:1rem}.settings-content.svelte-1cp4vip{display:grid;grid-template-columns:1fr 1fr;gap:2rem;max-width:1000px;margin:0 auto}@media (max-width: 768px){.settings-content.svelte-1cp4vip{grid-template-columns:1fr}}section.svelte-1cp4vip{border:1px solid var(--border-color, #ddd);border-radius:.5rem;padding:1.5rem}section.svelte-1cp4vip h2:where(.svelte-1cp4vip){margin:0 0 1rem;font-size:1.25rem;font-weight:500;color:var(--text-primary, #333)}.setting-group.svelte-1cp4vip{margin-bottom:1rem}.setting-label.svelte-1cp4vip{display:flex;align-items:flex-start;gap:.5rem;cursor:pointer}.setting-label.svelte-1cp4vip input[type=checkbox]:where(.svelte-1cp4vip){margin-top:.125rem;cursor:pointer}.setting-text.svelte-1cp4vip{font-weight:500;color:var(--text-primary, #333)}.setting-description.svelte-1cp4vip{margin:.5rem 0 0 1.75rem;color:var(--text-muted, #666);font-size:.875rem;line-height:1.4}.extension-import.svelte-1cp4vip{margin-bottom:1.5rem}.extension-import.svelte-1cp4vip label:where(.svelte-1cp4vip){display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary, #333)}.extension-import.svelte-1cp4vip input[type=file]:where(.svelte-1cp4vip){width:100%;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;cursor:pointer}.extension-import.svelte-1cp4vip input[type=file]:where(.svelte-1cp4vip):disabled{opacity:.6;cursor:not-allowed}.extensions-list.svelte-1cp4vip{list-style:none;padding:0;margin:0}.extension-item.svelte-1cp4vip{display:flex;align-items:center;justify-content:space-between;padding:.75rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;margin-bottom:.5rem;background:var(--bg-primary, #fff)}.extension-name.svelte-1cp4vip{font-weight:500;color:var(--text-primary, #333)}.extension-item.svelte-1cp4vip button:where(.svelte-1cp4vip){background:var(--error-bg, #dc3545);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.875rem}.extension-item.svelte-1cp4vip button:where(.svelte-1cp4vip):hover:not(:disabled){background:var(--error-hover, #c82333)}.extension-item.svelte-1cp4vip button:where(.svelte-1cp4vip):disabled{opacity:.6;cursor:not-allowed}.settings-content.svelte-1cp4vip:has([disabled]:where(.svelte-1cp4vip)){opacity:.6;pointer-events:none}.setting-label.svelte-1cp4vip:focus-within .setting-text:where(.svelte-1cp4vip){outline:2px solid var(--focus-color, #007acc);outline-offset:2px}input[type=checkbox].svelte-1cp4vip:focus-visible{outline:2px solid var(--focus-color, #007acc);outline-offset:2px}.spine-item.svelte-7qzgln{display:flex;align-items:center;gap:var(--space-1);border-top:1px solid transparent;border-bottom:1px solid transparent;padding-block:var(--space-2);padding-inline-start:var(--space-2);padding-inline-end:var(--space-2);border-radius:0;cursor:pointer;transition:background-color var(--duration-fast) ease;min-block-size:var(--touch-target-min);position:relative;background:transparent}.spine-item.svelte-7qzgln:hover:not(.selected){background:var(--color-bg-tertiary)}.spine-item.svelte-7qzgln:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);position:relative;z-index:1}.spine-item.selected.svelte-7qzgln{background:var(--color-bg-primary);border-top:1px solid var(--color-border-default);border-bottom:1px solid var(--color-border-default);margin-inline-start:calc(var(--space-2) * -1);margin-inline-end:0;padding-inline-start:calc(var(--space-2) * 2);padding-inline-end:var(--space-2)}.spine-item.compact.svelte-7qzgln{padding-block:2px;padding-inline:var(--space-1);justify-content:center;min-block-size:var( --touch-target-min )}.spine-item.compact.selected.svelte-7qzgln{margin-inline:0;padding-inline:var(--space-1)}.spine-item.compact.svelte-7qzgln .chapter-id:where(.svelte-7qzgln){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.drag-handle.svelte-7qzgln{flex-shrink:0;display:flex;align-items:center;justify-content:center;inline-size:20px;block-size:20px;color:var(--color-text-tertiary);cursor:grab}.drag-handle.svelte-7qzgln:active{cursor:grabbing}.chapter-id.svelte-7qzgln{flex:1;font-size:var(--text-sm);color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.error-indicator.svelte-7qzgln{flex-shrink:0;font-size:var(--text-sm);color:var(--color-status-warning)}.move-buttons.svelte-7qzgln{display:flex;gap:var(--space-1);margin-inline-start:auto}.move-button.svelte-7qzgln{display:flex;align-items:center;justify-content:center;inline-size:28px;block-size:28px;border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.move-button.svelte-7qzgln:hover:not(:disabled){background:var(--color-interactive-secondary-hover);color:var(--color-text-primary)}.move-button.svelte-7qzgln:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.move-button.svelte-7qzgln:disabled{opacity:.5;cursor:not-allowed;color:var(--color-text-tertiary)}@media (prefers-contrast: high){.spine-item.selected.svelte-7qzgln{border:2px solid var(--color-forced-active)}.error-indicator.svelte-7qzgln{font-weight:700}}.spine-sidebar.svelte-1d5i0rj{display:flex;flex-direction:column;block-size:100%;gap:var(--space-2);background:var(--color-bg-secondary);padding:0;padding-inline-end:0}.loading.svelte-1d5i0rj,.error.svelte-1d5i0rj,.empty-state.svelte-1d5i0rj{padding:var(--space-2);text-align:center;color:var(--color-text-secondary);font-size:var(--text-sm)}.error.svelte-1d5i0rj{color:var(--color-status-error)}.retry-button.svelte-1d5i0rj{margin-block-start:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.retry-button.svelte-1d5i0rj:hover{background:var(--color-interactive-secondary-hover);border-color:var(--color-border-strong)}.retry-button.svelte-1d5i0rj:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.spine-list.svelte-1d5i0rj{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;gap:0;list-style:none;padding:0;margin:0}.spine-list.svelte-1d5i0rj>*{border:none}.spine-item-wrapper.svelte-1d5i0rj{transition:transform var(--duration-fast) ease;border:none;outline:none}.spine-item-wrapper[draggable=true].svelte-1d5i0rj:active{opacity:.8;transform:scale(.98)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar{inline-size:6px}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.package-epub-section.svelte-1d5i0rj{padding:var(--space-3);border-top:1px solid var(--color-border-default);margin-top:auto}.package-epub-button.svelte-1d5i0rj{width:100%;padding:var(--space-2) var(--space-3);border:1px solid var(--color-button-primary-bg);border-radius:var(--radius-sm);background-color:var(--color-button-primary-bg);color:#fff;font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:36px}.package-epub-button.svelte-1d5i0rj:hover:not(:disabled){background-color:var(--color-button-primary-bg-hover);border-color:var(--color-button-primary-bg-hover)}.package-epub-button.svelte-1d5i0rj:disabled{opacity:.6;cursor:not-allowed}.package-epub-button.svelte-1d5i0rj:focus-visible{outline:none;border-color:var(--color-button-primary-bg);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.manifest-table-container.svelte-8hsxjr{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.manifest-toolbar.svelte-8hsxjr{display:flex;align-items:center;justify-content:space-between;padding:1rem;background-color:var(--color-surface-primary);border-block-end:1px solid var(--color-border-default);position:relative;min-height:3rem;flex-shrink:0}.filter-section.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;flex:1;max-width:400px}.filter-label.svelte-8hsxjr{font-size:.875rem;font-weight:500;color:var(--color-text-secondary);white-space:nowrap}.filter-input-container.svelte-8hsxjr{position:relative;flex:1}.filter-input.svelte-8hsxjr{width:100%;padding:.5rem .75rem;padding-inline-end:2rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.filter-input.svelte-8hsxjr:focus{outline:none;border-color:var(--color-focus-ring);box-shadow:0 0 0 2px var(--color-focus-ring)}.filter-input.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.filter-input.svelte-8hsxjr::placeholder{color:var(--color-text-placeholder)}.clear-filter-button.svelte-8hsxjr{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.25rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.clear-filter-button.svelte-8hsxjr:hover{color:var(--color-text-primary)}.clear-filter-button.svelte-8hsxjr:focus{outline:none;color:var(--color-text-primary)}.action-buttons.svelte-8hsxjr{display:flex;gap:.5rem}.action-button.svelte-8hsxjr{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.action-button.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.action-button.primary.svelte-8hsxjr{background-color:var(--color-primary);color:var(--color-surface);border-color:var(--color-primary)}.action-button.primary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.action-button.secondary.svelte-8hsxjr{background-color:var(--color-surface);color:var(--color-text-primary)}.action-button.secondary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-secondary-hover);border-color:var(--color-interactive-secondary-hover)}.drag-overlay.svelte-8hsxjr{position:absolute;inset:0;background-color:rgba(var(--color-primary-rgb),.1);border:2px dashed var(--color-primary);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;z-index:10}.drag-message.svelte-8hsxjr{padding:1rem;background-color:var(--color-surface);border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.drag-message.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:0;font-size:.875rem;color:var(--color-text-primary);text-align:center}.drag-active.svelte-8hsxjr{background-color:rgba(var(--color-primary-rgb),.05)}.table-container.svelte-8hsxjr{flex:1;overflow:auto}.empty-state.svelte-8hsxjr{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.empty-state.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:.5rem 0}.empty-state-subtitle.svelte-8hsxjr{font-size:.875rem;opacity:.8}.manifest-table.svelte-8hsxjr{width:100%;border-collapse:collapse;font-size:.875rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .75rem;text-align:left;border-bottom:1px solid var(--color-border-default)}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr){background-color:var(--color-surface-secondary);font-weight:600;color:var(--color-text-primary);position:sticky;top:0;z-index:1}.sort-button.svelte-8hsxjr{background:none;border:none;font-size:inherit;font-weight:inherit;color:inherit;cursor:pointer;padding:0;display:flex;align-items:center;gap:.25rem}.sort-button.svelte-8hsxjr:hover{color:var(--color-interactive-primary)}.sort-button.svelte-8hsxjr:focus{outline:none;color:var(--color-interactive-primary)}.manifest-row.svelte-8hsxjr{cursor:pointer;transition:background-color .15s ease;position:relative}.manifest-row.svelte-8hsxjr:hover{background-color:var(--color-surface-hover)}.manifest-row.svelte-8hsxjr:focus:not(.selected){outline:2px solid var(--color-focus-ring);outline-offset:-2px;background-color:var(--color-surface-hover)}.manifest-row.selected.svelte-8hsxjr:focus{outline:2px solid var(--color-focus-ring);outline-offset:-2px}.manifest-row.selected.svelte-8hsxjr{background-color:var(--color-bg-accent)}.manifest-row.error.svelte-8hsxjr{background-color:var(--color-bg-error)}.manifest-row.source-zip-item.svelte-8hsxjr{opacity:.8;font-style:italic;background-color:var(--color-bg-muted, rgba(0, 0, 0, .05))}.manifest-row.source-zip-item.svelte-8hsxjr .item-id:where(.svelte-8hsxjr),.manifest-row.source-zip-item.svelte-8hsxjr .item-href:where(.svelte-8hsxjr){color:var(--color-text-secondary)}.source-separator.svelte-8hsxjr{background-color:var(--color-bg-secondary)}.separator-cell.svelte-8hsxjr{padding:.75rem;border-bottom:2px solid var(--color-border-strong);border-top:1px solid var(--color-border-default)}.separator-content.svelte-8hsxjr{display:flex;align-items:center;justify-content:flex-start}.separator-label.svelte-8hsxjr{font-size:.8125rem;font-weight:600;color:var(--color-text-secondary);letter-spacing:.05em}.id-cell.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;max-width:200px}.item-id.svelte-8hsxjr{font-weight:500;word-break:break-word}.href-cell.svelte-8hsxjr{max-width:300px}.item-href.svelte-8hsxjr{font-family:var(--font-mono);font-size:.8125rem;word-break:break-all}.size-cell.svelte-8hsxjr{text-align:right;color:var(--color-text-secondary)}.properties-list.svelte-8hsxjr{display:flex;flex-wrap:wrap;gap:.25rem}.property-tag.svelte-8hsxjr{background-color:var(--color-bg-accent);color:var(--color-primary);padding:.125rem .375rem;border-radius:var(--radius-xs);font-size:.75rem;font-weight:500}.action-button.svelte-8hsxjr{padding:.375rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .15s ease;min-width:32px;height:32px;display:flex;align-items:center;justify-content:center}.action-button.svelte-8hsxjr:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-8hsxjr:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}@media (max-width: 768px){.manifest-toolbar.svelte-8hsxjr{flex-direction:column;gap:1rem;align-items:stretch}.filter-section.svelte-8hsxjr{max-width:none}.action-buttons.svelte-8hsxjr{justify-content:center}.manifest-table.svelte-8hsxjr{font-size:.8125rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .25rem}.href-cell.svelte-8hsxjr{max-width:150px}.properties-list.svelte-8hsxjr{flex-direction:column}}.modal-overlay.svelte-ziknnq{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content.svelte-ziknnq{background-color:var(--color-surface-primary);border-radius:var(--radius-modal);box-shadow:var(--elevation-modal);max-width:600px;width:90%;max-height:90vh;display:flex;flex-direction:column}.modal-header.svelte-ziknnq{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;border-bottom:1px solid var(--color-border-default)}.modal-header.svelte-ziknnq h2:where(.svelte-ziknnq){margin:0;font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.close-button.svelte-ziknnq{background:none;border:none;font-size:1.5rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.close-button.svelte-ziknnq:hover{color:var(--color-text-primary)}.close-button.svelte-ziknnq:focus{outline:none;color:var(--color-text-primary)}.modal-form.svelte-ziknnq{display:flex;flex-direction:column;height:100%}.form-body.svelte-ziknnq{flex:1;overflow-y:auto;padding:1.5rem}.form-group.svelte-ziknnq{margin-bottom:1.5rem}.form-label.svelte-ziknnq{display:block;margin-bottom:.5rem;font-weight:500;color:var(--color-text-primary)}.required.svelte-ziknnq{color:var(--color-error-text)}.form-input.svelte-ziknnq,.form-select.svelte-ziknnq,.form-textarea.svelte-ziknnq{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-input-bg);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.form-input.svelte-ziknnq:focus,.form-select.svelte-ziknnq:focus,.form-textarea.svelte-ziknnq:focus{outline:none;border-color:var(--color-input-border-focus);box-shadow:0 0 0 2px var(--color-focus)}.form-input.error.svelte-ziknnq,.form-select.error.svelte-ziknnq{border-color:var(--color-error-text)}.form-input.svelte-ziknnq::placeholder,.form-textarea.svelte-ziknnq::placeholder{color:var(--color-input-placeholder)}.file-input.svelte-ziknnq{width:100%;padding:.75rem;border:2px dashed var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-bg-secondary);cursor:pointer;transition:border-color .2s ease}.file-input.svelte-ziknnq:hover{border-color:var(--color-interactive-primary)}.file-input.svelte-ziknnq:focus{outline:none;border-color:var(--color-focus)}.file-info.svelte-ziknnq{margin-top:.5rem;font-size:.875rem;color:var(--color-text-secondary)}.checkbox-fieldset.svelte-ziknnq{border:none;margin:0;padding:0}.checkbox-fieldset.svelte-ziknnq .form-label:where(.svelte-ziknnq){display:block;margin-bottom:.5rem;font-weight:500}.checkbox-group.svelte-ziknnq{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.checkbox-label.svelte-ziknnq{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--color-text-primary);cursor:pointer}.checkbox-input.svelte-ziknnq{width:1rem;height:1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-input-bg);cursor:pointer}.checkbox-input.svelte-ziknnq:checked{background-color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.checkbox-input.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}.error-message.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-error-text)}.field-help.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-text-secondary)}.modal-footer.svelte-ziknnq{display:flex;gap:.75rem;justify-content:flex-end;padding:1.5rem;border-top:1px solid var(--color-border-default)}.cancel-button.svelte-ziknnq,.save-button.svelte-ziknnq{padding:.75rem 1.5rem;border:1px solid var(--color-border-default);border-radius:var(--radius-button);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-button.svelte-ziknnq{background-color:var(--color-button-secondary-bg);color:var(--color-text-primary)}.cancel-button.svelte-ziknnq:hover{background-color:var(--color-button-secondary-bg-hover);border-color:var(--color-border-default)}.save-button.svelte-ziknnq{background-color:var(--color-interactive-primary);color:var(--color-white);border-color:var(--color-interactive-primary)}.save-button.svelte-ziknnq:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.cancel-button.svelte-ziknnq:focus,.save-button.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}@media (max-width: 768px){.modal-content.svelte-ziknnq{width:95%;max-height:95vh}.modal-header.svelte-ziknnq,.form-body.svelte-ziknnq{padding:1rem}.modal-footer.svelte-ziknnq{padding:1rem;flex-direction:column}.checkbox-group.svelte-ziknnq{grid-template-columns:1fr}}.loading-state.svelte-12tyyls,.error-state.svelte-12tyyls{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-12tyyls{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-12tyyls{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-12tyyls:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-12tyyls:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.manifest-preview.svelte-xcscli{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.no-selection.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.no-selection.svelte-xcscli p:where(.svelte-xcscli){margin:.5rem 0}.no-selection-subtitle.svelte-xcscli{font-size:.875rem;opacity:.8}.loading-state.svelte-xcscli,.error-state.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-xcscli{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-xcscli{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-xcscli:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.preview-content.svelte-xcscli{height:100%;display:flex;flex-direction:column}.preview-header.svelte-xcscli{flex-shrink:0;padding:1rem;border-bottom:1px solid var(--color-border-default);background-color:var(--color-surface-secondary);display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.preview-body.svelte-xcscli{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column}.content-header.svelte-xcscli{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.content-type-icon.svelte-xcscli{font-size:1.25rem}.content-type.svelte-xcscli{font-family:var(--font-mono);font-size:.875rem;color:var(--color-text-secondary)}.preview-error.svelte-xcscli{color:var(--color-error);padding:1rem;background-color:var(--color-error-subtle);border-radius:var(--radius-sm);margin-bottom:1rem}.text-preview.svelte-xcscli{flex:1}.text-content.svelte-xcscli{background-color:var(--color-surface-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1rem;font-family:var(--font-mono);font-size:.8125rem;line-height:1.4;overflow:auto;white-space:pre-wrap;word-wrap:break-word}.image-preview.svelte-xcscli,.audio-preview.svelte-xcscli,.video-preview.svelte-xcscli{margin-bottom:1rem}.preview-image.svelte-xcscli{max-width:100%;height:auto;border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.preview-audio.svelte-xcscli{width:100%;max-width:400px}.preview-video.svelte-xcscli{width:100%;max-width:600px;height:auto;border-radius:var(--radius-sm)}.binary-preview.svelte-xcscli{padding:1rem;background-color:var(--color-surface-secondary);border-radius:var(--radius-sm);text-align:center;color:var(--color-text-secondary);margin-bottom:1rem}.binary-info.svelte-xcscli{font-size:.875rem;margin-top:.5rem}.preview-actions.svelte-xcscli{flex-shrink:0;display:flex;gap:.5rem;align-items:flex-start}.action-button.svelte-xcscli{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.action-button.svelte-xcscli:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.download-button.svelte-xcscli:hover{color:var(--color-interactive-secondary);border-color:var(--color-interactive-secondary)}.edit-button.svelte-xcscli:hover{color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.delete-button.svelte-xcscli:hover{color:var(--color-error);border-color:var(--color-error)}.outline-editor{display:flex;flex-direction:column;height:100%;width:100%}.outline-editor__textarea{flex:1;min-height:200px;padding:var(--spacing-4);font-family:var(--font-family-mono);font-size:var(--font-size-base);line-height:var(--line-height-relaxed);border:1px solid var(--color-border-subtle);border-radius:var(--border-radius-md);background-color:var(--color-surface);color:var(--color-text-primary);resize:none;overflow-y:auto;transition:border-color var(--transition-fast)}.outline-editor__textarea:focus{outline:none;border-color:var(--color-border-focus);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus-ring)}.outline-editor__textarea::placeholder{color:var(--color-text-subtle);font-style:italic}@media (prefers-contrast: high){.outline-editor__textarea{border-width:2px}.outline-editor__textarea:focus{border-color:var(--color-text-primary);box-shadow:0 0 0 calc(var(--focus-ring-width) + 1px) var(--color-focus-ring)}}@media (prefers-reduced-motion: reduce){.outline-editor__textarea{transition:none}}@media (max-width: 768px){.outline-editor__textarea{min-height:44px;padding:var(--spacing-3);font-size:var(--font-size-lg)}}[data-theme=dark] .outline-editor__textarea{background-color:var(--color-surface-elevated);border-color:var(--color-border-subtle)}[data-theme=dark] .outline-editor__textarea:focus{border-color:var(--color-border-focus)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.outline-view.svelte-vjoxn9{height:100%;width:100%}.sr-only.svelte-vjoxn9{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.content-preview.svelte-166aukc{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:#000;overflow:hidden}.content-preview__container.svelte-166aukc{transform-origin:center;width:100%;height:100%}.content-preview__letterbox.svelte-166aukc{background:#000;display:flex;justify-content:center;align-items:center;width:100%;height:100%}.content-preview__iframe.svelte-166aukc{border:none;background:#fff;min-width:320px;min-height:400px}.loading-state.svelte-1pwtvzx,.error-state.svelte-1pwtvzx{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:2rem;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-1pwtvzx{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-1pwtvzx-spin 1s linear infinite;margin-bottom:1rem}@keyframes svelte-1pwtvzx-spin{to{transform:rotate(360deg)}}.error-state.svelte-1pwtvzx{color:var(--color-error-text)}.error-state.svelte-1pwtvzx h2:where(.svelte-1pwtvzx){margin:0 0 1rem;font-size:1.5rem;font-weight:600}.error-state.svelte-1pwtvzx p:where(.svelte-1pwtvzx){margin:.5rem 0;font-size:1rem}@media (prefers-reduced-motion: reduce){.spinner.svelte-1pwtvzx{animation:none}}.placeholder-content.svelte-1pwtvzx{padding:1rem;color:var(--color-text-secondary)}.placeholder-content.svelte-1pwtvzx h3:where(.svelte-1pwtvzx){margin:0 0 .5rem;font-size:1rem;font-weight:600}.placeholder-content.svelte-1pwtvzx p:where(.svelte-1pwtvzx){margin:0;font-size:.875rem;opacity:.8}.current-view-info.svelte-1pwtvzx{margin-top:1rem!important;padding:.5rem;background:var(--color-bg-secondary);border-radius:4px;font-size:.75rem!important}</style>
  <script>window.__EDITME_I18N_BUNDLE__ = 'data:application/zip;base64,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';</script></head>
  <body>
    <div id="app"></div>
  </body>
</html>
