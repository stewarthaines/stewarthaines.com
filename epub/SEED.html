<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF/QA6OjoAKysrABwcH" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEED.html</title>
    <link rel="manifest" href="manifest.json" />
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js');
      }
    </script>
    <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Ti=!1;var nr=Array.isArray,Io=Array.prototype.indexOf,Za=Array.from,rs=Object.defineProperty,Mn=Object.getOwnPropertyDescriptor,as=Object.getOwnPropertyDescriptors,is=Object.prototype,Fo=Array.prototype,ua=Object.getPrototypeOf,Ci=Object.isExtensible;const Zt=()=>{};function Po(r){return r()}function Er(r){for(var e=0;e<r.length;e++)r[e]()}function Mo(r,e){if(Array.isArray(r))return r;if(!(Symbol.iterator in r))return Array.from(r);const t=[];for(const a of r)if(t.push(a),t.length===e)break;return t}const Qt=2,ss=4,fa=8,Qa=16,gn=32,On=64,Qr=128,qt=256,ea=512,Ot=1024,cn=2048,kn=4096,hn=8192,pa=16384,Lo=32768,ha=65536,os=1<<17,ls=1<<19,cs=1<<20,ja=1<<21,vn=Symbol("$state"),Do=Symbol("legacy props"),Ro=Symbol("");function ds(r){return r===this.v}function us(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function ei(r){return!us(r,this.v)}function Uo(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ao(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Oo(r){throw new Error("https://svelte.dev/e/effect_orphan")}function zo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Wo(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function No(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function jo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Bo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let rr=!1,$o=!1;function Ho(){rr=!0}const ti=1,ni=2,fs=4,qo=8,Vo=16,Go=1,Xo=2,Ko=4,Yo=8,Jo=16,Zo=1,Qo=2,Wt=Symbol(),el="http://www.w3.org/1999/xhtml",ps="@attach",tl=[];function nl(r,e=!1){return Xr(r,new Map,"",tl)}function Xr(r,e,t,a,n=null){if(typeof r=="object"&&r!==null){var i=e.get(r);if(i!==void 0)return i;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(nr(r)){var s=Array(r.length);e.set(r,s),n!==null&&e.set(n,s);for(var l=0;l<r.length;l+=1){var d=r[l];l in r&&(s[l]=Xr(d,e,t,a))}return s}if(ua(r)===is){s={},e.set(r,s),n!==null&&e.set(n,s);for(var u in r)s[u]=Xr(r[u],e,t,a);return s}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return Xr(r.toJSON(),e,t,a,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}function va(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let lt=null;function Ii(r){lt=r}function Fi(r){return ri().get(r)}function rl(r,e){return ri().set(r,e),e}function al(r){return ri().has(r)}function Qe(r,e=!1,t){var a=lt={p:lt,c:null,d:!1,e:null,m:!1,s:r,x:null,l:null};rr&&!e&&(lt.l={s:null,u:null,r1:[],r2:Qn(!1)}),ga(()=>{a.d=!0})}function et(r){const e=lt;if(e!==null){r!==void 0&&(e.x=r);const s=e.e;if(s!==null){var t=ut,a=dt;e.e=null;try{for(var n=0;n<s.length;n++){var i=s[n];Sn(i.effect),dn(i.reaction),ar(i.fn)}}finally{Sn(t),dn(a)}}lt=e.p,e.m=!0}return r||{}}function Rr(){return!rr||lt!==null&&lt.l===null}function ri(r){return lt===null&&va(),lt.c??=new Map(il(lt)||void 0)}function il(r){let e=r.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}function Ct(r){if(typeof r!="object"||r===null||vn in r)return r;const e=ua(r);if(e!==is&&e!==Fo)return r;var t=new Map,a=nr(r),n=Ue(0),i=dt,s=l=>{var d=dt;dn(i);var u=l();return dn(d),u};return a&&t.set("length",Ue(r.length)),new Proxy(r,{defineProperty(l,d,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&No();var c=t.get(d);return c===void 0?(c=s(()=>Ue(u.value)),t.set(d,c)):y(c,s(()=>Ct(u.value))),!0},deleteProperty(l,d){var u=t.get(d);if(u===void 0)d in l&&(t.set(d,s(()=>Ue(Wt))),Fa(n));else{if(a&&typeof d=="string"){var c=t.get("length"),p=Number(d);Number.isInteger(p)&&p<c.v&&y(c,p)}y(u,Wt),Fa(n)}return!0},get(l,d,u){if(d===vn)return r;var c=t.get(d),p=d in l;if(c===void 0&&(!p||Mn(l,d)?.writable)&&(c=s(()=>Ue(Ct(p?l[d]:Wt))),t.set(d,c)),c!==void 0){var h=o(c);return h===Wt?void 0:h}return Reflect.get(l,d,u)},getOwnPropertyDescriptor(l,d){var u=Reflect.getOwnPropertyDescriptor(l,d);if(u&&"value"in u){var c=t.get(d);c&&(u.value=o(c))}else if(u===void 0){var p=t.get(d),h=p?.v;if(p!==void 0&&h!==Wt)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return u},has(l,d){if(d===vn)return!0;var u=t.get(d),c=u!==void 0&&u.v!==Wt||Reflect.has(l,d);if(u!==void 0||ut!==null&&(!c||Mn(l,d)?.writable)){u===void 0&&(u=s(()=>Ue(c?Ct(l[d]):Wt)),t.set(d,u));var p=o(u);if(p===Wt)return!1}return c},set(l,d,u,c){var p=t.get(d),h=d in l;if(a&&d==="length")for(var v=u;v<p.v;v+=1){var m=t.get(v+"");m!==void 0?y(m,Wt):v in l&&(m=s(()=>Ue(Wt)),t.set(v+"",m))}p===void 0?(!h||Mn(l,d)?.writable)&&(p=s(()=>Ue(void 0)),y(p,s(()=>Ct(u))),t.set(d,p)):(h=p.v!==Wt,y(p,s(()=>Ct(u))));var w=Reflect.getOwnPropertyDescriptor(l,d);if(w?.set&&w.set.call(c,u),!h){if(a&&typeof d=="string"){var b=t.get("length"),k=Number(d);Number.isInteger(k)&&k>=b.v&&y(b,k+1)}Fa(n)}return!0},ownKeys(l){o(n);var d=Reflect.ownKeys(l).filter(p=>{var h=t.get(p);return h===void 0||h.v!==Wt});for(var[u,c]of t)c.v!==Wt&&!(u in l)&&d.push(u);return d},setPrototypeOf(){jo()}})}function Fa(r,e=1){y(r,r.v+e)}function Pi(r){try{if(r!==null&&typeof r=="object"&&vn in r)return r[vn]}catch{}return r}function sl(r,e){return Object.is(Pi(r),Pi(e))}function Rn(r){var e=Qt|cn,t=dt!==null&&(dt.f&Qt)!==0?dt:null;return ut===null||t!==null&&(t.f&qt)!==0?e|=qt:ut.f|=cs,{ctx:lt,deps:null,effects:null,equals:ds,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??ut}}function oe(r){const e=Rn(r);return Ms(e),e}function de(r){const e=Rn(r);return e.equals=ei,e}function hs(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Vt(e[t])}}function ol(r){for(var e=r.parent;e!==null;){if((e.f&Qt)===0)return e;e=e.parent}return null}function vs(r){var e,t=ut;Sn(ol(r));try{hs(r),e=Us(r)}finally{Sn(t)}return e}function ms(r){var e=vs(r);if(r.equals(e)||(r.v=e,r.wv=Ds()),!sr){var t=(xn||(r.f&qt)!==0)&&r.deps!==null?kn:Ot;en(r,t)}}const kr=new Map;function Qn(r,e){var t={f:0,v:r,reactions:null,equals:ds,rv:0,wv:0};return t}function Ue(r,e){const t=Qn(r);return Ms(t),t}function Ne(r,e=!1){const t=Qn(r);return e||(t.equals=ei),rr&&lt!==null&&lt.l!==null&&(lt.l.s??=[]).push(t),t}function Xe(r,e){return y(r,Tt(()=>o(r))),e}function y(r,e,t=!1){dt!==null&&!rn&&Rr()&&(dt.f&(Qt|Qa))!==0&&!mn?.includes(r)&&Bo();let a=t?Ct(e):e;return Tr(r,a)}function Tr(r,e){if(!r.equals(e)){var t=r.v;sr?kr.set(r,e):kr.set(r,t),r.v=e,(r.f&Qt)!==0&&((r.f&cn)!==0&&vs(r),en(r,(r.f&qt)===0?Ot:kn)),r.wv=Ds(),gs(r,cn),Rr()&&ut!==null&&(ut.f&Ot)!==0&&(ut.f&(gn|On))===0&&(Kt===null?yl([r]):Kt.push(r))}return e}function gs(r,e){var t=r.reactions;if(t!==null)for(var a=Rr(),n=t.length,i=0;i<n;i++){var s=t[i],l=s.f;(l&cn)===0&&(!a&&s===ut||(en(s,e),(l&(Ot|qt))!==0&&((l&Qt)!==0?gs(s,kn):xa(s))))}}function ll(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let cl=!1;var Ba,ws,ys,bs,xs;function dl(){if(Ba===void 0){Ba=window,ws=document,ys=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;bs=Mn(e,"firstChild").get,xs=Mn(e,"nextSibling").get,Ci(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Ci(t)&&(t.__t=void 0)}}function Ur(r=""){return document.createTextNode(r)}function on(r){return bs.call(r)}function ma(r){return xs.call(r)}function f(r,e){return on(r)}function Ze(r,e){{var t=on(r);return t instanceof Comment&&t.data===""?ma(t):t}}function g(r,e=1,t=!1){let a=r;for(;e--;)a=ma(a);return a}function ul(r){r.textContent=""}function _s(r){ut===null&&dt===null&&Oo(),dt!==null&&(dt.f&qt)!==0&&ut===null&&Ao(),sr&&Uo()}function fl(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function zn(r,e,t,a=!0){var n=ut,i={ctx:lt,deps:null,nodes_start:null,nodes_end:null,f:r|cn,first:null,fn:e,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(t)try{ba(i),i.f|=Lo}catch(d){throw Vt(i),d}else e!==null&&xa(i);var s=t&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&(cs|Qr))===0;if(!s&&a&&(n!==null&&fl(i,n),dt!==null&&(dt.f&Qt)!==0)){var l=dt;(l.effects??=[]).push(i)}return i}function pl(){return dt!==null&&!rn}function ga(r){const e=zn(fa,null,!1);return en(e,Ot),e.teardown=r,e}function xt(r){_s();var e=ut!==null&&(ut.f&gn)!==0&&lt!==null&&!lt.m;if(e){var t=lt;(t.e??=[]).push({fn:r,effect:ut,reaction:dt})}else{var a=ar(r);return a}}function Ss(r){return _s(),ir(r)}function hl(r){const e=zn(On,r,!0);return()=>{Vt(e)}}function vl(r){const e=zn(On,r,!0);return(t={})=>new Promise(a=>{t.outro?ta(e,()=>{Vt(e),a(void 0)}):(Vt(e),a(void 0))})}function ar(r){return zn(ss,r,!1)}function ft(r,e){var t=lt,a={effect:null,ran:!1};t.l.r1.push(a),a.effect=ir(()=>{r(),!a.ran&&(a.ran=!0,y(t.l.r2,!0),Tt(e))})}function Mt(){var r=lt;ir(()=>{if(o(r.l.r2)){for(var e of r.l.r1){var t=e.effect;(t.f&Ot)!==0&&en(t,kn),or(t)&&ba(t),e.ran=!1}r.l.r2.v=!1}})}function ir(r){return zn(fa,r,!0)}function R(r,e=[],t=Rn){const a=e.map(t);return Wn(()=>r(...a.map(o)))}function Wn(r,e=0){return zn(fa|Qa|e,r,!0)}function _n(r,e=!0){return zn(fa|gn,r,!0,e)}function Es(r){var e=r.teardown;if(e!==null){const t=sr,a=dt;Mi(!0),dn(null);try{e.call(null)}finally{Mi(t),dn(a)}}}function ks(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var a=t.next;(t.f&On)!==0?t.parent=null:Vt(t,e),t=a}}function ml(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&gn)===0&&Vt(e),e=t}}function Vt(r,e=!0){var t=!1;(e||(r.f&ls)!==0)&&r.nodes_start!==null&&(Ts(r.nodes_start,r.nodes_end),t=!0),ks(r,e&&!t),sa(r,0),en(r,pa);var a=r.transitions;if(a!==null)for(const i of a)i.stop();Es(r);var n=r.parent;n!==null&&n.first!==null&&Cs(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function Ts(r,e){for(;r!==null;){var t=r===e?null:ma(r);r.remove(),r=t}}function Cs(r){var e=r.parent,t=r.prev,a=r.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===r&&(e.first=a),e.last===r&&(e.last=t))}function ta(r,e){var t=[];ai(r,t,!0),Is(t,()=>{Vt(r),e&&e()})}function Is(r,e){var t=r.length;if(t>0){var a=()=>--t||e();for(var n of r)n.out(a)}else e()}function ai(r,e,t){if((r.f&hn)===0){if(r.f^=hn,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var a=r.first;a!==null;){var n=a.next,i=(a.f&ha)!==0||(a.f&gn)!==0;ai(a,e,i?t:!1),a=n}}}function na(r){Fs(r,!0)}function Fs(r,e){if((r.f&hn)!==0){r.f^=hn,(r.f&Ot)===0&&(r.f^=Ot),or(r)&&(en(r,cn),xa(r));for(var t=r.first;t!==null;){var a=t.next,n=(t.f&ha)!==0||(t.f&gn)!==0;Fs(t,n?e:!1),t=a}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let Cr=[],$a=[];function Ps(){var r=Cr;Cr=[],Er(r)}function gl(){var r=$a;$a=[],Er(r)}function wa(r){Cr.length===0&&queueMicrotask(Ps),Cr.push(r)}function wl(){Cr.length>0&&Ps(),$a.length>0&&gl()}let Kr=!1,ra=!1,aa=null,Ln=!1,sr=!1;function Mi(r){sr=r}let br=[];let dt=null,rn=!1;function dn(r){dt=r}let ut=null;function Sn(r){ut=r}let mn=null;function Ms(r){dt!==null&&dt.f&ja&&(mn===null?mn=[r]:mn.push(r))}let Rt=null,$t=0,Kt=null;function yl(r){Kt=r}let Ls=1,ia=0,xn=!1,bn=null;function Ds(){return++Ls}function or(r){var e=r.f;if((e&cn)!==0)return!0;if((e&kn)!==0){var t=r.deps,a=(e&qt)!==0;if(t!==null){var n,i,s=(e&ea)!==0,l=a&&ut!==null&&!xn,d=t.length;if(s||l){var u=r,c=u.parent;for(n=0;n<d;n++)i=t[n],(s||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);s&&(u.f^=ea),l&&c!==null&&(c.f&qt)===0&&(u.f^=qt)}for(n=0;n<d;n++)if(i=t[n],or(i)&&ms(i),i.wv>r.wv)return!0}(!a||ut!==null&&!xn)&&en(r,Ot)}return!1}function bl(r,e){for(var t=e;t!==null;){if((t.f&Qr)!==0)try{t.fn(r);return}catch{t.f^=Qr}t=t.parent}throw Kr=!1,r}function Li(r){return(r.f&pa)===0&&(r.parent===null||(r.parent.f&Qr)===0)}function ya(r,e,t,a){if(Kr){if(t===null&&(Kr=!1),Li(e))throw r;return}if(t!==null&&(Kr=!0),bl(r,e),Li(e))throw r}function Rs(r,e,t=!0){var a=r.reactions;if(a!==null)for(var n=0;n<a.length;n++){var i=a[n];mn?.includes(r)||((i.f&Qt)!==0?Rs(i,e,!1):e===i&&(t?en(i,cn):(i.f&Ot)!==0&&en(i,kn),xa(i)))}}function Us(r){var e=Rt,t=$t,a=Kt,n=dt,i=xn,s=mn,l=lt,d=rn,u=r.f;Rt=null,$t=0,Kt=null,xn=(u&qt)!==0&&(rn||!Ln||dt===null),dt=(u&(gn|On))===0?r:null,mn=null,Ii(r.ctx),rn=!1,ia++,r.f|=ja;try{var c=(0,r.fn)(),p=r.deps;if(Rt!==null){var h;if(sa(r,$t),p!==null&&$t>0)for(p.length=$t+Rt.length,h=0;h<Rt.length;h++)p[$t+h]=Rt[h];else r.deps=p=Rt;if(!xn)for(h=$t;h<p.length;h++)(p[h].reactions??=[]).push(r)}else p!==null&&$t<p.length&&(sa(r,$t),p.length=$t);if(Rr()&&Kt!==null&&!rn&&p!==null&&(r.f&(Qt|kn|cn))===0)for(h=0;h<Kt.length;h++)Rs(Kt[h],r);return n!==null&&n!==r&&(ia++,Kt!==null&&(a===null?a=Kt:a.push(...Kt))),c}finally{Rt=e,$t=t,Kt=a,dt=n,xn=i,mn=s,Ii(l),rn=d,r.f^=ja}}function xl(r,e){let t=e.reactions;if(t!==null){var a=Io.call(t,r);if(a!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[a]=t[n],t.pop())}}t===null&&(e.f&Qt)!==0&&(Rt===null||!Rt.includes(e))&&(en(e,kn),(e.f&(qt|ea))===0&&(e.f^=ea),hs(e),sa(e,0))}function sa(r,e){var t=r.deps;if(t!==null)for(var a=e;a<t.length;a++)xl(r,t[a])}function ba(r){var e=r.f;if((e&pa)===0){en(r,Ot);var t=ut,a=lt,n=Ln;ut=r,Ln=!0;try{(e&Qa)!==0?ml(r):ks(r),Es(r);var i=Us(r);r.teardown=typeof i=="function"?i:null,r.wv=Ls;var s=r.deps,l;Ti&&$o&&r.f&cn}catch(d){ya(d,r,t,a||r.ctx)}finally{Ln=n,ut=t}}}function _l(){try{zo()}catch(r){if(aa!==null)ya(r,aa,null);else throw r}}function As(){var r=Ln;try{var e=0;for(Ln=!0;br.length>0;){e++>1e3&&_l();var t=br,a=t.length;br=[];for(var n=0;n<a;n++){var i=El(t[n]);Sl(i)}kr.clear()}}finally{ra=!1,Ln=r,aa=null}}function Sl(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var a=r[t];if((a.f&(pa|hn))===0)try{or(a)&&(ba(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?Cs(a):a.fn=null))}catch(n){ya(n,a,null,a.ctx)}}}function xa(r){ra||(ra=!0,queueMicrotask(As));for(var e=aa=r;e.parent!==null;){e=e.parent;var t=e.f;if((t&(On|gn))!==0){if((t&Ot)===0)return;e.f^=Ot}}br.push(e)}function El(r){for(var e=[],t=r;t!==null;){var a=t.f,n=(a&(gn|On))!==0,i=n&&(a&Ot)!==0;if(!i&&(a&hn)===0){if((a&ss)!==0)e.push(t);else if(n)t.f^=Ot;else try{or(t)&&ba(t)}catch(d){ya(d,t,null,t.ctx)}var s=t.first;if(s!==null){t=s;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}return e}function kl(r){for(var e;;){if(wl(),br.length===0)return e;ra=!0,As()}}async function Os(){await Promise.resolve(),kl()}function o(r){var e=r.f,t=(e&Qt)!==0;if(bn!==null&&bn.add(r),dt!==null&&!rn){if(!mn?.includes(r)){var a=dt.deps;r.rv<ia&&(r.rv=ia,Rt===null&&a!==null&&a[$t]===r?$t++:Rt===null?Rt=[r]:(!xn||!Rt.includes(r))&&Rt.push(r))}}else if(t&&r.deps===null&&r.effects===null){var n=r,i=n.parent;i!==null&&(i.f&qt)===0&&(n.f^=qt)}return t&&(n=r,or(n)&&ms(n)),sr&&kr.has(r)?kr.get(r):r.v}function Tl(r){var e=bn;bn=new Set;var t=bn,a;try{if(Tt(r),e!==null)for(a of bn)e.add(a)}finally{bn=e}return t}function Cl(r){var e=Tl(()=>Tt(r));for(var t of e)if((t.f&os)!==0)for(const a of t.deps||[])(a.f&Qt)===0&&Tr(a,a.v);else Tr(t,t.v)}function Tt(r){var e=rn;try{return rn=!0,r()}finally{rn=e}}const Il=-7169;function en(r,e){r.f=r.f&Il|e}function rt(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(vn in r)Ha(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&vn in t&&Ha(t)}}}function Ha(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let a in r)try{Ha(r[a],e)}catch{}const t=ua(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=as(t);for(let n in a){const i=a[n].get;if(i)try{i.call(r)}catch{}}}}}function Fl(){return Symbol(ps)}function Pl(r){return r.endsWith("capture")&&r!=="gotpointercapture"&&r!=="lostpointercapture"}const Ml=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Ll(r){return Ml.includes(r)}const Dl={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Rl(r){return r=r.toLowerCase(),Dl[r]??r}const Ul=["touchstart","touchmove"];function Al(r){return Ul.includes(r)}function Ol(r,e){if(e){const t=document.body;r.autofocus=!0,wa(()=>{document.activeElement===t&&r.focus()})}}let Di=!1;function zl(){Di||(Di=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function zs(r){var e=dt,t=ut;dn(null),Sn(null);try{return r()}finally{dn(e),Sn(t)}}function Ws(r,e,t,a=t){r.addEventListener(e,()=>zs(t));const n=r.__on_r;n?r.__on_r=()=>{n(),a(!0)}:r.__on_r=()=>a(!0),zl()}const Ns=new Set,qa=new Set;function ii(r,e,t,a={}){function n(i){if(a.capture||wr.call(e,i),!i.cancelBubble)return zs(()=>t?.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?wa(()=>{e.addEventListener(r,n,a)}):e.addEventListener(r,n,a),n}function sn(r,e,t,a={}){var n=ii(e,r,t,a);return()=>{r.removeEventListener(e,n,a)}}function Ke(r,e,t,a,n){var i={capture:a,passive:n},s=ii(r,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ga(()=>{e.removeEventListener(r,s,i)})}function _t(r){for(var e=0;e<r.length;e++)Ns.add(r[e]);for(var t of qa)t(r)}function wr(r){var e=this,t=e.ownerDocument,a=r.type,n=r.composedPath?.()||[],i=n[0]||r.target,s=0,l=r.__root;if(l){var d=n.indexOf(l);if(d!==-1&&(e===document||e===window)){r.__root=e;return}var u=n.indexOf(e);if(u===-1)return;d<=u&&(s=d)}if(i=n[s]||r.target,i!==e){rs(r,"currentTarget",{configurable:!0,get(){return i||t}});var c=dt,p=ut;dn(null),Sn(null);try{for(var h,v=[];i!==null;){var m=i.assignedSlot||i.parentNode||i.host||null;try{var w=i["__"+a];if(w!=null&&(!i.disabled||r.target===i))if(nr(w)){var[b,...k]=w;b.apply(i,[r,...k])}else w.call(i,r)}catch(I){h?v.push(I):h=I}if(r.cancelBubble||m===e||m===null)break;i=m}if(h){for(let I of v)queueMicrotask(()=>{throw I});throw h}}finally{r.__root=e,delete r.currentTarget,dn(c),Sn(p)}}}function Wl(r){var e;e=document.head.appendChild(Ur());try{Wn(()=>r(e),ls)}finally{}}function si(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","\x3C!---->"),e.content}function er(r,e){var t=ut;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function P(r,e){var t=(e&Zo)!==0,a=(e&Qo)!==0,n,i=!r.startsWith("<!>");return()=>{n===void 0&&(n=si(i?r:"<!>"+r),t||(n=on(n)));var s=a||ys?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=on(s),d=s.lastChild;er(l,d)}else er(s,s);return s}}function Nl(r,e,t="svg"){var a=!r.startsWith("<!>"),n=`<${t}>${a?r:"<!>"+r}</${t}>`,i;return()=>{if(!i){var s=si(n),l=on(s);i=on(l)}var d=i.cloneNode(!0);return er(d,d),d}}function js(r,e){return Nl(r,e,"svg")}function Et(r=""){{var e=Ur(r+"");return er(e,e),e}}function ht(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Ur();return r.append(e,t),er(e,t),r}function _(r,e){r!==null&&r.before(e)}function oi(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function x(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function jl(r,e){return Bl(r,e)}const Nn=new Map;function Bl(r,{target:e,anchor:t,props:a={},events:n,context:i,intro:s=!0}){dl();var l=new Set,d=p=>{for(var h=0;h<p.length;h++){var v=p[h];if(!l.has(v)){l.add(v);var m=Al(v);e.addEventListener(v,wr,{passive:m});var w=Nn.get(v);w===void 0?(document.addEventListener(v,wr,{passive:m}),Nn.set(v,1)):Nn.set(v,w+1)}}};d(Za(Ns)),qa.add(d);var u=void 0,c=vl(()=>{var p=t??e.appendChild(Ur());return _n(()=>{if(i){Qe({});var h=lt;h.c=i}n&&(a.$$events=n),u=r(p,a)||{},i&&et()}),()=>{for(var h of l){e.removeEventListener(h,wr);var v=Nn.get(h);--v===0?(document.removeEventListener(h,wr),Nn.delete(h)):Nn.set(h,v)}qa.delete(d),p!==t&&p.parentNode?.removeChild(p)}});return $l.set(u,c),u}let $l=new WeakMap;function j(r,e,[t,a]=[0,0]){var n=r,i=null,s=null,l=Wt,d=t>0?ha:0,u=!1;const c=(h,v=!0)=>{u=!0,p(v,h)},p=(h,v)=>{l!==(l=h)&&(l?(i?na(i):v&&(i=_n(()=>v(n))),s&&ta(s,()=>{s=null})):(s?na(s):v&&(s=_n(()=>v(n,[t+1,a]))),i&&ta(i,()=>{i=null})))};Wn(()=>{u=!1,e(c),u||p(null,null)},d)}function It(r,e){return e}function Hl(r,e,t,a){for(var n=[],i=e.length,s=0;s<i;s++)ai(e[s].e,n,!0);var l=i>0&&n.length===0&&t!==null;if(l){var d=t.parentNode;ul(d),d.append(t),a.clear(),yn(r,e[0].prev,e[i-1].next)}Is(n,()=>{for(var u=0;u<i;u++){var c=e[u];l||(a.delete(c.k),yn(r,c.prev,c.next)),Vt(c.e,!l)}})}function kt(r,e,t,a,n,i=null){var s=r,l={flags:e,items:new Map,first:null},d=(e&fs)!==0;if(d){var u=r;s=u.appendChild(Ur())}var c=null,p=!1,h=de(()=>{var v=t();return nr(v)?v:v==null?[]:Za(v)});Wn(()=>{var v=o(h),m=v.length;p&&m===0||(p=m===0,ql(v,l,s,n,e,a,t),i!==null&&(m===0?c?na(c):c=_n(()=>i(s)):c!==null&&ta(c,()=>{c=null})),o(h))})}function ql(r,e,t,a,n,i,s){var l=(n&qo)!==0,d=(n&(ti|ni))!==0,u=r.length,c=e.items,p=e.first,h=p,v,m=null,w,b=[],k=[],I,C,L,E;if(l)for(E=0;E<u;E+=1)I=r[E],C=i(I,E),L=c.get(C),L!==void 0&&(L.a?.measure(),(w??=new Set).add(L));for(E=0;E<u;E+=1){if(I=r[E],C=i(I,E),L=c.get(C),L===void 0){var N=h?h.e.nodes_start:t;m=Gl(N,e,m,m===null?e.first:m.next,I,C,E,a,n,s),c.set(C,m),b=[],k=[],h=m.next;continue}if(d&&Vl(L,I,E,n),(L.e.f&hn)!==0&&(na(L.e),l&&(L.a?.unfix(),(w??=new Set).delete(L))),L!==h){if(v!==void 0&&v.has(L)){if(b.length<k.length){var z=k[0],H;m=z.prev;var W=b[0],O=b[b.length-1];for(H=0;H<b.length;H+=1)Ri(b[H],z,t);for(H=0;H<k.length;H+=1)v.delete(k[H]);yn(e,W.prev,O.next),yn(e,m,W),yn(e,O,z),h=z,m=O,E-=1,b=[],k=[]}else v.delete(L),Ri(L,h,t),yn(e,L.prev,L.next),yn(e,L,m===null?e.first:m.next),yn(e,m,L),m=L;continue}for(b=[],k=[];h!==null&&h.k!==C;)(h.e.f&hn)===0&&(v??=new Set).add(h),k.push(h),h=h.next;if(h===null)continue;L=h}b.push(L),m=L,h=L.next}if(h!==null||v!==void 0){for(var T=v===void 0?[]:Za(v);h!==null;)(h.e.f&hn)===0&&T.push(h),h=h.next;var G=T.length;if(G>0){var U=(n&fs)!==0&&u===0?t:null;if(l){for(E=0;E<G;E+=1)T[E].a?.measure();for(E=0;E<G;E+=1)T[E].a?.fix()}Hl(e,T,U,c)}}l&&wa(()=>{if(w!==void 0)for(L of w)L.a?.apply()}),ut.first=e.first&&e.first.e,ut.last=m&&m.e}function Vl(r,e,t,a){(a&ti)!==0&&Tr(r.v,e),(a&ni)!==0?Tr(r.i,t):r.i=t}function Gl(r,e,t,a,n,i,s,l,d,u){var c=(d&ti)!==0,p=(d&Vo)===0,h=c?p?Ne(n):Qn(n):n,v=(d&ni)===0?s:Qn(s),m={i:v,v:h,k:i,a:null,e:null,prev:t,next:a};try{return m.e=_n(()=>l(r,h,v,u),cl),m.e.prev=t&&t.e,m.e.next=a&&a.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),a!==null&&(a.prev=m,a.e.prev=m.e),m}finally{}}function Ri(r,e,t){for(var a=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==a;){var s=ma(i);n.before(i),i=s}}function yn(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Xl(r,e,t=!1,a=!1,n=!1){var i=r,s="";R(()=>{var l=ut;if(s!==(s=e()??"")&&(l.nodes_start!==null&&(Ts(l.nodes_start,l.nodes_end),l.nodes_start=l.nodes_end=null),s!=="")){var d=s+"";t?d=`<svg>${d}</svg>`:a&&(d=`<math>${d}</math>`);var u=si(d);if((t||a)&&(u=on(u)),er(on(u),u.lastChild),t||a)for(;on(u);)i.before(on(u));else i.before(u)}})}function St(r,e,t,a,n){var i=e.$$slots?.[t],s=!1;i===!0&&(i=e[t==="default"?"children":t],s=!0),i===void 0||i(r,s?()=>a:a)}function tr(r,e,...t){var a=r,n=Zt,i;Wn(()=>{n!==(n=e())&&(i&&(Vt(i),i=null),i=_n(()=>n(a,...t)))},ha)}function Kl(r,e){var t=void 0,a;Wn(()=>{t!==(t=e())&&(a&&(Vt(a),a=null),t&&(a=_n(()=>{ar(()=>t(r))})))})}function Bs(r){var e,t,a="";if(typeof r=="string"||typeof r=="number")a+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=Bs(r[e]))&&(a&&(a+=" "),a+=t)}else for(t in r)r[t]&&(a&&(a+=" "),a+=t);return a}function Yr(){for(var r,e,t=0,a="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=Bs(r))&&(a&&(a+=" "),a+=e);return a}function Yl(r){return typeof r=="object"?Yr(r):r??""}const Ui=[...` 	
\r\fÂ \v\uFEFF`];function Jl(r,e,t){var a=r==null?"":""+r;if(e&&(a=a?a+" "+e:e),t){for(var n in t)if(t[n])a=a?a+" "+n:n;else if(a.length)for(var i=n.length,s=0;(s=a.indexOf(n,s))>=0;){var l=s+i;(s===0||Ui.includes(a[s-1]))&&(l===a.length||Ui.includes(a[l]))?a=(s===0?"":a.substring(0,s))+a.substring(l+1):s=l}}return a===""?null:a}function Ai(r,e=!1){var t=e?" !important;":";",a="";for(var n in r){var i=r[n];i!=null&&i!==""&&(a+=" "+n+": "+i+t)}return a}function Pa(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function Zl(r,e){if(e){var t="",a,n;if(Array.isArray(e)?(a=e[0],n=e[1]):a=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,s=0,l=!1,d=[];a&&d.push(...Object.keys(a).map(Pa)),n&&d.push(...Object.keys(n).map(Pa));var u=0,c=-1;const w=r.length;for(var p=0;p<w;p++){var h=r[p];if(l?h==="/"&&r[p-1]==="*"&&(l=!1):i?i===h&&(i=!1):h==="/"&&r[p+1]==="*"?l=!0:h==='"'||h==="'"?i=h:h==="("?s++:h===")"&&s--,!l&&i===!1&&s===0){if(h===":"&&c===-1)c=p;else if(h===";"||p===w-1){if(c!==-1){var v=Pa(r.substring(u,c).trim());if(!d.includes(v)){h!==";"&&p++;var m=r.substring(u,p).trim();t+=" "+m+";"}}u=p+1,c=-1}}}}return a&&(t+=Ai(a)),n&&(t+=Ai(n,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function st(r,e,t,a,n,i){var s=r.__className;if(s!==t||s===void 0){var l=Jl(t,a,i);l==null?r.removeAttribute("class"):e?r.className=l:r.setAttribute("class",l),r.__className=t}else if(i&&n!==i)for(var d in i){var u=!!i[d];(n==null||u!==!!n[d])&&r.classList.toggle(d,u)}return i}function Ma(r,e={},t,a){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?r.style.removeProperty(n):r.style.setProperty(n,i,a))}}function li(r,e,t,a){var n=r.__style;if(n!==e){var i=Zl(e,a);i==null?r.removeAttribute("style"):r.style.cssText=i,r.__style=e}else a&&(Array.isArray(a)?(Ma(r,t?.[0],a[0]),Ma(r,t?.[1],a[1],"important")):Ma(r,t,a));return a}function Un(r,e,t){if(r.multiple){if(e==null)return;if(!nr(e))return ll();for(var a of r.options)a.selected=e.includes(xr(a));return}for(a of r.options){var n=xr(a);if(sl(n,e)){a.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Ir(r,e){let t=!0;ar(()=>{e&&Un(r,Tt(e),t),t=!1;var a=new MutationObserver(()=>{var n=r.__value;Un(r,n)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function $s(r,e,t=e){var a=!0;Ws(r,"change",n=>{var i=n?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(i),xr);else{var l=r.querySelector(i)??r.querySelector("option:not([disabled])");s=l&&xr(l)}t(s)}),ar(()=>{var n=e();if(Un(r,n,a),a&&n===void 0){var i=r.querySelector(":checked");i!==null&&(n=xr(i),t(n))}r.__value=n,a=!1}),Ir(r)}function xr(r){return"__value"in r?r.__value:r.value}const cr=Symbol("class"),dr=Symbol("style"),Hs=Symbol("is custom element"),qs=Symbol("is html");function En(r,e){var t=Sa(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Vs(r,e){var t=Sa(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Ql(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function pe(r,e,t,a){var n=Sa(r);n[e]!==(n[e]=t)&&(e==="loading"&&(r[Ro]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Gs(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function ec(r,e,t,a,n=!1){var i=Sa(r),s=i[Hs],l=!i[qs],d=e||{},u=r.tagName==="OPTION";for(var c in e)c in t||(t[c]=null);t.class?t.class=Yl(t.class):(a||t[cr])&&(t.class=null),t[dr]&&(t.style??=null);var p=Gs(r);for(const C in t){let L=t[C];if(u&&C==="value"&&L==null){r.value=r.__value="",d[C]=L;continue}if(C==="class"){var h=r.namespaceURI==="http://www.w3.org/1999/xhtml";st(r,h,L,a,e?.[cr],t[cr]),d[C]=L,d[cr]=t[cr];continue}if(C==="style"){li(r,L,e?.[dr],t[dr]),d[C]=L,d[dr]=t[dr];continue}var v=d[C];if(L!==v){d[C]=L;var m=C[0]+C[1];if(m!=="$$")if(m==="on"){const E={},N="$$"+C;let z=C.slice(2);var w=Ll(z);if(Pl(z)&&(z=z.slice(0,-7),E.capture=!0),!w&&v){if(L!=null)continue;r.removeEventListener(z,d[N],E),d[N]=null}if(L!=null)if(w)r[`__${z}`]=L,_t([z]);else{let H=function(W){d[C].call(this,W)};var I=H;d[N]=ii(z,r,H,E)}else w&&(r[`__${z}`]=void 0)}else if(C==="style")pe(r,C,L);else if(C==="autofocus")Ol(r,!!L);else if(!s&&(C==="__value"||C==="value"&&L!=null))r.value=r.__value=L;else if(C==="selected"&&u)Ql(r,L);else{var b=C;l||(b=Rl(b));var k=b==="defaultValue"||b==="defaultChecked";if(L==null&&!s&&!k)if(i[C]=null,b==="value"||b==="checked"){let E=r;const N=e===void 0;if(b==="value"){let z=E.defaultValue;E.removeAttribute(b),E.defaultValue=z,E.value=E.__value=N?z:null}else{let z=E.defaultChecked;E.removeAttribute(b),E.defaultChecked=z,E.checked=N?z:!1}}else r.removeAttribute(C);else k||p.includes(b)&&(s||typeof L!="string")?r[b]=L:typeof L!="function"&&pe(r,b,L)}}}return d}function _a(r,e,t=[],a,n=!1,i=Rn){const s=t.map(i);var l=void 0,d={},u=r.nodeName==="SELECT",c=!1;Wn(()=>{var p=e(...s.map(o));ec(r,l,p,a,n),c&&u&&"value"in p&&Un(r,p.value,!1);for(let v of Object.getOwnPropertySymbols(d))p[v]||Vt(d[v]);for(let v of Object.getOwnPropertySymbols(p)){var h=p[v];v.description===ps&&(!l||h!==l[v])&&(d[v]&&Vt(d[v]),d[v]=_n(()=>Kl(r,()=>h)))}l=p}),u&&Ir(r,()=>l.value),c=!0}function Sa(r){return r.__attributes??={[Hs]:r.nodeName.includes("-"),[qs]:r.namespaceURI===el}}var Oi=new Map;function Gs(r){var e=Oi.get(r.nodeName);if(e)return e;Oi.set(r.nodeName,e=[]);for(var t,a=r,n=Element.prototype;n!==a;){t=as(a);for(var i in t)t[i].set&&e.push(i);a=ua(a)}return e}function Jr(r,e,t=e){var a=Rr();Ws(r,"input",n=>{var i=n?r.defaultValue:r.value;if(i=La(r)?Da(i):i,t(i),a&&i!==(i=e())){var s=r.selectionStart,l=r.selectionEnd;r.value=i??"",l!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(l,r.value.length))}}),Tt(e)==null&&r.value&&t(La(r)?Da(r.value):r.value),ir(()=>{var n=e();La(r)&&n===Da(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function La(r){var e=r.type;return e==="number"||e==="range"}function Da(r){return r===""?null:+r}function Pt(r,e,t){var a=Mn(r,e);a&&a.set&&(r[e]=t,ga(()=>{r[e]=null}))}function zi(r,e){return r===e||r?.[vn]===e}function Nt(r={},e,t,a){return ar(()=>{var n,i;return ir(()=>{n=i,i=[],Tt(()=>{r!==t(...i)&&(e(r,...i),n&&zi(t(...n),r)&&e(null,...n))})}),()=>{wa(()=>{i&&zi(t(...i),r)&&e(null,...i)})}}),r}function gt(r=!1){const e=lt,t=e.l.u;if(!t)return;let a=()=>rt(e.s);if(r){let n=0,i={};const s=Rn(()=>{let l=!1;const d=e.s;for(const u in d)d[u]!==i[u]&&(i[u]=d[u],l=!0);return l&&n++,n});a=()=>o(s)}t.b.length&&Ss(()=>{Wi(e,a),Er(t.b)}),xt(()=>{const n=Tt(()=>t.m.map(Po));return()=>{for(const i of n)typeof i=="function"&&i()}}),t.a.length&&xt(()=>{Wi(e,a),Er(t.a)})}function Wi(r,e){if(r.l.s)for(const t of r.l.s)o(t);e()}function ci(r,e,t){if(r==null)return e(void 0),t&&t(void 0),Zt;const a=Tt(()=>r.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const jn=[];function tc(r,e){return{subscribe:Jt(r,e).subscribe}}function Jt(r,e=Zt){let t=null;const a=new Set;function n(l){if(us(r,l)&&(r=l,t)){const d=!jn.length;for(const u of a)u[1](),jn.push(u,r);if(d){for(let u=0;u<jn.length;u+=2)jn[u][0](jn[u+1]);jn.length=0}}}function i(l){n(l(r))}function s(l,d=Zt){const u=[l,d];return a.add(u),a.size===1&&(t=e(n,i)||Zt),l(r),()=>{a.delete(u),a.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:s}}function Ar(r,e,t){const a=!Array.isArray(r),n=a?[r]:r;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return tc(t,(s,l)=>{let d=!1;const u=[];let c=0,p=Zt;const h=()=>{if(c)return;p();const m=e(a?u[0]:u,s,l);i?s(m):p=typeof m=="function"?m:Zt},v=n.map((m,w)=>ci(m,b=>{u[w]=b,c&=~(1<<w),d&&h()},()=>{c|=1<<w}));return d=!0,h(),function(){Er(v),p(),d=!1}})}function ln(r){let e;return ci(r,t=>e=t)(),e}let Nr=!1,Va=Symbol();function Ye(r,e,t){const a=t[e]??={store:null,source:Ne(void 0),unsubscribe:Zt};if(a.store!==r&&!(Va in t))if(a.unsubscribe(),a.store=r??null,r==null)a.source.v=void 0,a.unsubscribe=Zt;else{var n=!0;a.unsubscribe=ci(r,i=>{n?a.source.v=i:y(a.source,i)}),n=!1}return r&&Va in t?ln(r):o(a.source)}function ot(){const r={};function e(){ga(()=>{for(var t in r)r[t].unsubscribe();rs(r,Va,{enumerable:!1,value:!0})})}return[r,e]}function nc(r){var e=Nr;try{return Nr=!1,[r(),Nr]}finally{Nr=e}}const rc={get(r,e){if(!r.exclude.includes(e))return r.props[e]},set(r,e){return!1},getOwnPropertyDescriptor(r,e){if(!r.exclude.includes(e)&&e in r.props)return{enumerable:!0,configurable:!0,value:r.props[e]}},has(r,e){return r.exclude.includes(e)?!1:e in r.props},ownKeys(r){return Reflect.ownKeys(r.props).filter(e=>!r.exclude.includes(e))}};function di(r,e,t){return new Proxy({props:r,exclude:e},rc)}function Ni(r){return r.ctx?.d??!1}function B(r,e,t,a){var n=(t&Go)!==0,i=!rr||(t&Xo)!==0,s=(t&Yo)!==0,l=(t&Jo)!==0,d=!1,u;s?[u,d]=nc(()=>r[e]):u=r[e];var c=vn in r||Do in r,p=s&&(Mn(r,e)?.set??(c&&e in r&&(z=>r[e]=z)))||void 0,h=a,v=!0,m=!1,w=()=>(m=!0,v&&(v=!1,l?h=Tt(a):h=a),h);u===void 0&&a!==void 0&&(p&&i&&Wo(),u=w(),p&&p(u));var b;if(i)b=()=>{var z=r[e];return z===void 0?w():(v=!0,m=!1,z)};else{var k=(n?Rn:de)(()=>r[e]);k.f|=os,b=()=>{var z=o(k);return z!==void 0&&(h=void 0),z===void 0?h:z}}if((t&Ko)===0&&i)return b;if(p){var I=r.$$legacy;return function(z,H){return arguments.length>0?((!i||!H||I||d)&&p(H?b():z),z):b()}}var C=!1,L=!1,E=Ne(u),N=Rn(()=>{var z=b(),H=o(E);return C?(C=!1,L=!0,H):(L=!1,E.v=z)});return s&&o(N),n||(N.equals=ei),function(z,H){if(bn!==null&&(C=L,b(),o(E)),arguments.length>0){const W=H?o(N):i&&s?Ct(z):z;if(!N.equals(W)){if(C=!0,y(E,W),m&&h!==void 0&&(h=W),Ni(N))return z;Tt(()=>o(N))}return z}return Ni(N)?N.v:o(N)}}function an(r){lt===null&&va(),rr&&lt.l!==null?ic(lt).m.push(r):xt(()=>{const e=Tt(r);if(typeof e=="function")return e})}function lr(r){lt===null&&va(),an(()=>()=>Tt(r))}function ac(r,e,{bubbles:t=!1,cancelable:a=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:a})}function Lt(){const r=lt;return r===null&&va(),(e,t,a)=>{const n=r.s.$$events?.[e];if(n){const i=nr(n)?n.slice():[n],s=ac(e,t,a);for(const l of i)l.call(r.x,s);return!s.defaultPrevented}return!0}}function ic(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const sc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(sc);Ho();function oc(r){return typeof r=="function"}function ui(r){return r!==null&&typeof r=="object"}const lc=["string","number","bigint","boolean"];function Ga(r){return r==null||lc.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>Ga(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const Fr=Symbol("box"),fi=Symbol("is-writable");function cc(r){return ui(r)&&Fr in r}function dc(r){return nt.isBox(r)&&fi in r}function nt(r){let e=Ue(Ct(r));return{[Fr]:!0,[fi]:!0,get current(){return o(e)},set current(t){y(e,t,!0)}}}function uc(r,e){const t=oe(r);return e?{[Fr]:!0,[fi]:!0,get current(){return o(t)},set current(a){e(a)}}:{[Fr]:!0,get current(){return r()}}}function fc(r){return nt.isBox(r)?r:oc(r)?nt.with(r):nt(r)}function pc(r){return Object.entries(r).reduce((e,[t,a])=>nt.isBox(a)?(nt.isWritableBox(a)?Object.defineProperty(e,t,{get(){return a.current},set(n){a.current=n}}):Object.defineProperty(e,t,{get(){return a.current}}),e):Object.assign(e,{[t]:a}),{})}function hc(r){return nt.isWritableBox(r)?{[Fr]:!0,get current(){return r.current}}:r}nt.from=fc;nt.with=uc;nt.flatten=pc;nt.readonly=hc;nt.isBox=cc;nt.isWritableBox=dc;function vc(...r){return function(e){for(const t of r)if(t){if(e.defaultPrevented)return;typeof t=="function"?t.call(this,e):t.current?.call(this,e)}}}function mc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Bn={},Ra,ji;function gc(){if(ji)return Ra;ji=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,n=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,l=/^\s+|\s+$/g,d=`
`,u="/",c="*",p="",h="comment",v="declaration";Ra=function(w,b){if(typeof w!="string")throw new TypeError("First argument must be a string");if(!w)return[];b=b||{};var k=1,I=1;function C(U){var F=U.match(e);F&&(k+=F.length);var D=U.lastIndexOf(d);I=~D?U.length-D:I+U.length}function L(){var U={line:k,column:I};return function(F){return F.position=new E(U),H(),F}}function E(U){this.start=U,this.end={line:k,column:I},this.source=b.source}E.prototype.content=w;function N(U){var F=new Error(b.source+":"+k+":"+I+": "+U);if(F.reason=U,F.filename=b.source,F.line=k,F.column=I,F.source=w,!b.silent)throw F}function z(U){var F=U.exec(w);if(F){var D=F[0];return C(D),w=w.slice(D.length),F}}function H(){z(t)}function W(U){var F;for(U=U||[];F=O();)F!==!1&&U.push(F);return U}function O(){var U=L();if(!(u!=w.charAt(0)||c!=w.charAt(1))){for(var F=2;p!=w.charAt(F)&&(c!=w.charAt(F)||u!=w.charAt(F+1));)++F;if(F+=2,p===w.charAt(F-1))return N("End of comment missing");var D=w.slice(2,F-2);return I+=2,C(D),w=w.slice(F),I+=2,U({type:h,comment:D})}}function T(){var U=L(),F=z(a);if(F){if(O(),!z(n))return N("property missing ':'");var D=z(i),M=U({type:v,property:m(F[0].replace(r,p)),value:D?m(D[0].replace(r,p)):p});return z(s),M}}function G(){var U=[];W(U);for(var F;F=T();)F!==!1&&(U.push(F),W(U));return U}return H(),G()};function m(w){return w?w.replace(l,p):p}return Ra}var Bi;function wc(){if(Bi)return Bn;Bi=1;var r=Bn&&Bn.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.default=t;var e=r(gc());function t(a,n){var i=null;if(!a||typeof a!="string")return i;var s=(0,e.default)(a),l=typeof n=="function";return s.forEach(function(d){if(d.type==="declaration"){var u=d.property,c=d.value;l?n(u,c,d):c&&(i=i||{},i[u]=c)}}),i}return Bn}var yc=wc();const $i=mc(yc),bc=$i.default||$i,xc=/\d/,_c=["-","_","/","."];function Sc(r=""){if(!xc.test(r))return r!==r.toLowerCase()}function Ec(r){const e=[];let t="",a,n;for(const i of r){const s=_c.includes(i);if(s===!0){e.push(t),t="",a=void 0;continue}const l=Sc(i);if(n===!1){if(a===!1&&l===!0){e.push(t),t=i,a=l;continue}if(a===!0&&l===!1&&t.length>1){const d=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=d+i,a=l;continue}}t+=i,a=l,n=s}return e.push(t),e}function Xs(r){return r?Ec(r).map(e=>Tc(e)).join(""):""}function kc(r){return Cc(Xs(r||""))}function Tc(r){return r?r[0].toUpperCase()+r.slice(1):""}function Cc(r){return r?r[0].toLowerCase()+r.slice(1):""}function jr(r){if(!r)return{};const e={};function t(a,n){if(a.startsWith("-moz-")||a.startsWith("-webkit-")||a.startsWith("-ms-")||a.startsWith("-o-")){e[Xs(a)]=n;return}if(a.startsWith("--")){e[a]=n;return}e[kc(a)]=n}return bc(r,t),e}function Ks(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function Ic(r,e,t,a){const n=Array.isArray(e)?e:[e];return n.forEach(i=>r.addEventListener(i,t,a)),()=>{n.forEach(i=>r.removeEventListener(i,t,a))}}function Fc(r,e){const t=RegExp(r,"g");return a=>{if(typeof a!="string")throw new TypeError(`expected an argument of type string, but got ${typeof a}`);return a.match(t)?a.replace(t,e):a}}const Pc=Fc(/[A-Z]/,r=>`-${r.toLowerCase()}`);function Mc(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${Pc(e)}: ${r[e]};`).join(`
`)}function Ys(r={}){return Mc(r).replace(`
`," ")}const Lc={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};Ys(Lc);const Dc=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],Rc=new Set(Dc);function Uc(r){return Rc.has(r)}function pi(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const a=r[t];if(a){for(const n of Object.keys(a)){const i=e[n],s=a[n],l=typeof i=="function",d=typeof s=="function";if(l&&Uc(n)){const u=i,c=s;e[n]=vc(u,c)}else if(l&&d)e[n]=Ks(i,s);else if(n==="class"){const u=Ga(i),c=Ga(s);u&&c?e[n]=Yr(i,s):u?e[n]=Yr(i):c&&(e[n]=Yr(s))}else if(n==="style"){const u=typeof i=="object",c=typeof s=="object",p=typeof i=="string",h=typeof s=="string";if(u&&c)e[n]={...i,...s};else if(u&&h){const v=jr(s);e[n]={...i,...v}}else if(p&&c){const v=jr(i);e[n]={...v,...s}}else if(p&&h){const v=jr(i),m=jr(s);e[n]={...v,...m}}else u?e[n]=i:c?e[n]=s:p?e[n]=i:h&&(e[n]=s)}else e[n]=s!==void 0?s:i}for(const n of Object.getOwnPropertySymbols(a)){const i=e[n],s=a[n];e[n]=s!==void 0?s:i}}}return typeof e.style=="object"&&(e.style=Ys(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const Ac=typeof window<"u"?window:void 0;function Oc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}function zc(r){y(r,r.v+1)}function Js(r){let e=0,t=Qn(0),a;return()=>{pl()&&(o(t),ir(()=>(e===0&&(a=Tt(()=>r(()=>zc(t)))),e+=1,()=>{Os().then(()=>{e-=1,e===0&&(a?.(),a=void 0)})})))}}let Wc=class{#e;#t;constructor(e={}){const{window:t=Ac,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=Js(n=>{const i=sn(t,"focusin",n),s=sn(t,"focusout",n);return()=>{i(),s()}}))}get current(){return this.#t?.(),this.#e?Oc(this.#e):null}};new Wc;function Nc(r){Os().then(r)}const jc=9;function Bc(r){return ui(r)&&r.nodeType===jc}function $c(r){return ui(r)&&r.constructor?.name==="VisualViewport"}function Hc(r){return Bc(r)?r:$c(r)?r.document:r?.ownerDocument??document}function qc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class hi{element;#e=oe(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return o(this.#e)}set root(e){y(this.#e,e)}constructor(e){typeof e=="function"?this.element=nt.with(e):this.element=e}getDocument=()=>Hc(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>qc(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,t)=>this.getWindow().setTimeout(e,t);clearTimeout=e=>this.getWindow().clearTimeout(e)}function vi(r,e){return{[Fl()]:t=>nt.isBox(r)?(r.current=t,Tt(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||(r.current=null)}):(r(t),Tt(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||r(null)})}}function Vc({layout:r,panesArray:e,pivotIndices:t}){let a=0,n=100,i=0,s=0;const l=t[0];for(let p=0;p<e.length;p++){const h=e[p].constraints,{maxSize:v=100,minSize:m=0}=h;p===l?(a=m,n=v):(i+=m,s+=v)}const d=Math.min(n,100-i),u=Math.max(a,100-s),c=r[l];return{valueMax:d,valueMin:u,valueNow:c}}function vt(r,e="Assertion failed!"){if(!r)throw console.error(e),new Error(e)}const Gc=100,mi=10;function Ht(r,e,t=mi){return Pr(r,e,t)===0}function Pr(r,e,t=mi){const a=Hi(r,t),n=Hi(e,t);return Math.sign(a-n)}function ur(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Hi(r,e){return Number.parseFloat(r.toFixed(e))}const Ea=typeof document<"u";function Xc(r){return r instanceof HTMLElement}function Zs(r){return r.type==="keydown"}function Qs(r){return r.type.startsWith("mouse")}function eo(r){return r.type.startsWith("touch")}function Xn({paneConstraints:r,paneIndex:e,initialSize:t}){const a=r[e];vt(a!=null,"Pane constraints should not be null.");const{collapsedSize:n=0,collapsible:i,maxSize:s=100,minSize:l=0}=a;let d=t;return Pr(d,l)<0&&(d=Kc(d,i,n,l)),d=Math.min(s,d),Number.parseFloat(d.toFixed(mi))}function Kc(r,e,t,a){if(!e)return a;const n=(t+a)/2;return Pr(r,n)<0?t:a}function Dn(){}function Yc({groupId:r,layout:e,panesArray:t,domContext:a}){const n=Or(r,a);for(let i=0;i<t.length-1;i++){const{valueMax:s,valueMin:l,valueNow:d}=Vc({layout:e,panesArray:t,pivotIndices:[i,i+1]}),u=n[i];if(Xc(u)){const c=t[i];u.setAttribute("aria-controls",c.opts.id.current),u.setAttribute("aria-valuemax",`${Math.round(s)}`),u.setAttribute("aria-valuemin",`${Math.round(l)}`),u.setAttribute("aria-valuenow",d!=null?`${Math.round(d)}`:"")}}return()=>{for(const i of n)i.removeAttribute("aria-controls"),i.removeAttribute("aria-valuemax"),i.removeAttribute("aria-valuemin"),i.removeAttribute("aria-valuenow")}}function Or(r,e){return Ea?Array.from(e.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${r}"]`)):[]}function to({groupId:r,id:e,domContext:t}){return Ea?Or(r,t).findIndex(i=>i.getAttribute("data-pane-resizer-id")===e)??null:null}function qi({groupId:r,dragHandleId:e,domContext:t}){const a=to({groupId:r,id:e,domContext:t});return a!=null?[a,a+1]:[-1,-1]}function $n(r,e,t){const a=r.map(u=>u.constraints),n=qn(r,e),i=a[n],l=n===r.length-1?[n-1,n]:[n,n+1],d=t[n];return{...i,paneSize:d,pivotIndices:l}}function qn(r,e){return r.findIndex(t=>t.opts.id.current===e.opts.id.current)}function fr(r,e,t){for(let a=0;a<e.length;a++){const n=e[a],i=r[a];vt(i);const{collapsedSize:s=0,collapsible:l}=i.constraints,d=t[i.opts.id.current];if(!(d==null||n!==d))continue;t[i.opts.id.current]=n;const{onCollapse:u,onExpand:c,onResize:p}=i.callbacks;p?.(n,d),l&&(u||c)&&(c&&(d==null||d===s)&&n!==s&&c(),u&&(d==null||d!==s)&&n===s&&u())}}function Jc({panesArray:r}){const e=Array(r.length),t=r.map(i=>i.constraints);let a=0,n=100;for(let i=0;i<r.length;i++){const s=t[i];vt(s);const{defaultSize:l}=s;l!=null&&(a++,e[i]=l,n-=l)}for(let i=0;i<r.length;i++){const s=t[i];vt(s);const{defaultSize:l}=s;if(l!=null)continue;const d=r.length-a,u=n/d;a++,e[i]=u,n-=u}return e}function Zc({layout:r,paneConstraints:e}){const t=[...r],a=t.reduce((i,s)=>i+s,0);if(t.length!==e.length)throw new Error(`Invalid ${e.length} pane layout: ${t.map(i=>`${i}%`).join(", ")}`);if(!Ht(a,100))for(let i=0;i<e.length;i++){const s=t[i];vt(s!=null);const l=100/a*s;t[i]=l}let n=0;for(let i=0;i<e.length;i++){const s=t[i];vt(s!=null);const l=Xn({paneConstraints:e,paneIndex:i,initialSize:s});s!==l&&(n+=s-l,t[i]=l)}if(!Ht(n,0))for(let i=0;i<e.length;i++){const s=t[i];vt(s!=null);const l=s+n,d=Xn({paneConstraints:e,paneIndex:i,initialSize:l});if(s!==d&&(n-=d-s,t[i]=d,Ht(n,0)))break}return t}function Qc(r,e){if(!Ea)return null;const t=e.querySelector(`[data-pane-group][data-pane-group-id="${r}"]`);return t||null}function gi(r,e){if(!Ea)return null;const t=e.querySelector(`[data-pane-resizer-id="${r}"]`);return t||null}function ed({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:n}){const i=t==="horizontal",s=gi(e,n);vt(s);const l=s.getAttribute("data-pane-group-id");vt(l);const{initialCursorPosition:d}=a,u=no(t,r),c=Qc(l,n);vt(c);const p=c.getBoundingClientRect(),h=i?p.width:p.height;return(u-d)/h*100}function td({event:r,dragHandleId:e,dir:t,initialDragState:a,keyboardResizeBy:n,domContext:i}){if(Zs(r)){const s=t==="horizontal";let l=0;r.shiftKey?l=100:n!=null?l=n:l=10;let d=0;switch(r.key){case"ArrowDown":d=s?0:l;break;case"ArrowLeft":d=s?-l:0;break;case"ArrowRight":d=s?l:0;break;case"ArrowUp":d=s?0:-l;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return a==null?0:ed({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:i})}function no(r,e){const t=r==="horizontal";if(Qs(e))return t?e.clientX:e.clientY;if(eo(e)){const a=e.touches[0];return vt(a),t?a.screenX:a.screenY}else throw new Error(`Unsupported event type "${e.type}"`)}function nd({groupId:r,handleId:e,panesArray:t,domContext:a}){const n=gi(e,a),i=Or(r,a),s=n?i.indexOf(n):-1,l=t[s]?.opts.id.current??null,d=t[s+1]?.opts.id.current??null;return[l,d]}const rd=typeof window<"u"?window:void 0;function ad(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class id{#e;#t;constructor(e={}){const{window:t=rd,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=Js(n=>{const i=sn(t,"focusin",n),s=sn(t,"focusout",n);return()=>{i(),s()}}))}get current(){return this.#t?.(),this.#e?ad(this.#e):null}}new id;function sd(r,e){switch(r){case"post":xt(e);break;case"pre":Ss(e);break}}function ro(r,e,t,a={}){const{lazy:n=!1}=a;let i=!n,s=Array.isArray(r)?[]:void 0;sd(e,()=>{const l=Array.isArray(r)?r.map(u=>u()):r();if(!i){i=!0,s=l;return}const d=Tt(()=>t(l,s));return s=l,d})}function _r(r,e,t){ro(r,"post",e,t)}function od(r,e,t){ro(r,"pre",e,t)}_r.pre=od;class ld{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return al(this.#t)}get(){const e=Fi(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const t=Fi(this.#t);return t===void 0?e:t}set(e){return rl(this.#t,e)}}function pr({delta:r,layout:e,paneConstraints:t,pivotIndices:a,trigger:n}){if(Ht(r,0))return e;const i=[...e],[s,l]=a;let d=0;if(n==="keyboard"){{const c=r<0?l:s,p=t[c];if(vt(p),p.collapsible){const h=e[c];vt(h!=null);const v=t[c];vt(v);const{collapsedSize:m=0,minSize:w=0}=v;if(Ht(h,m)){const b=w-h;Pr(b,Math.abs(r))>0&&(r=r<0?0-b:b)}}}{const c=r<0?s:l,p=t[c];vt(p);const{collapsible:h}=p;if(h){const v=e[c];vt(v!=null);const m=t[c];vt(m);const{collapsedSize:w=0,minSize:b=0}=m;if(Ht(v,b)){const k=v-w;Pr(k,Math.abs(r))>0&&(r=r<0?0-k:k)}}}}{const c=r<0?1:-1;let p=r<0?l:s,h=0;for(;;){const m=e[p];vt(m!=null);const b=Xn({paneConstraints:t,paneIndex:p,initialSize:100})-m;if(h+=b,p+=c,p<0||p>=t.length)break}const v=Math.min(Math.abs(r),Math.abs(h));r=r<0?0-v:v}{let p=r<0?s:l;for(;p>=0&&p<t.length;){const h=Math.abs(r)-Math.abs(d),v=e[p];vt(v!=null);const m=v-h,w=Xn({paneConstraints:t,paneIndex:p,initialSize:m});if(!Ht(v,w)&&(d+=v-w,i[p]=w,d.toPrecision(3).localeCompare(Math.abs(r).toPrecision(3),void 0,{numeric:!0})>=0))break;r<0?p--:p++}}if(Ht(d,0))return e;{const c=r<0?l:s,p=e[c];vt(p!=null);const h=p+d,v=Xn({paneConstraints:t,paneIndex:c,initialSize:h});if(i[c]=v,!Ht(v,h)){let m=h-v,b=r<0?l:s;for(;b>=0&&b<t.length;){const k=i[b];vt(k!=null);const I=k+m,C=Xn({paneConstraints:t,paneIndex:b,initialSize:I});if(Ht(k,C)||(m-=C-k,i[b]=C),Ht(m,0))break;r>0?b--:b++}}}const u=i.reduce((c,p)=>p+c,0);return Ht(u,100)?i:e}let Xa=null,Pn=null;function ao(r){switch(r){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function cd(){Pn!==null&&(document.head.removeChild(Pn),Xa=null,Pn=null)}function Ua(r,e){if(Xa===r)return;Xa=r;const t=ao(r);Pn===null&&(Pn=e.createElement("style"),e.head.appendChild(Pn)),Pn.innerHTML=`*{cursor: ${t}!important;}`}function dd({defaultSize:r,dragState:e,layout:t,panesArray:a,paneIndex:n,precision:i=3}){const s=t[n];let l;return s==null?l=r??"1":a.length===1?l="1":l=s.toPrecision(i),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function Vi(r){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");r.getItem=e=>localStorage.getItem(e),r.setItem=(e,t)=>localStorage.setItem(e,t)}catch(e){console.error(e),r.getItem=()=>null,r.setItem=()=>{}}}function io(r){return`paneforge:${r}`}function so(r){return r.map(t=>t.opts.order.current?`${t.opts.order.current}:${JSON.stringify(t.constraints)}`:JSON.stringify(t.constraints)).sort().join(",")}function oo(r,e){try{const t=io(r),a=e.getItem(t),n=JSON.parse(a||"");if(typeof n=="object"&&n!==null)return n}catch{}return null}function ud(r,e,t){const a=oo(r,t)||{},n=so(e);return a[n]||null}function fd(r,e,t,a,n){const i=io(r),s=so(e),l=oo(r,n)||{};l[s]={expandToSizes:Object.fromEntries(t.entries()),layout:a};try{n.setItem(i,JSON.stringify(l))}catch(d){console.error(d)}}const Gi={};function pd(r,e=10){let t=null;return(...n)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...n)},e)}}function hd({autoSaveId:r,layout:e,storage:t,panesArray:a,paneSizeBeforeCollapse:n}){if(e.length===0||e.length!==a.length)return;let i=Gi[r];i==null&&(i=pd(fd,Gc),Gi[r]=i);const s=[...a],l=new Map(n);i(r,s,l,e,t)}const yr={getItem:r=>(Vi(yr),yr.getItem(r)),setItem:(r,e)=>{Vi(yr),yr.setItem(r,e)}},wi=new ld("PaneGroup");class yi{static create(e){return wi.set(new yi(e))}opts;attachment;domContext;#e=Ue(null);get dragState(){return o(this.#e)}set dragState(e){y(this.#e,e)}#t=Ue([]);get layout(){return o(this.#t)}set layout(e){y(this.#t,e)}#r=Ue([]);get panesArray(){return o(this.#r)}set panesArray(e){y(this.#r,e)}#a=Ue(!1);get panesArrayChanged(){return o(this.#a)}set panesArrayChanged(e){y(this.#a,e,!0)}#n=Ue(Ct({}));get paneIdToLastNotifiedSizeMap(){return o(this.#n)}set paneIdToLastNotifiedSizeMap(e){y(this.#n,e,!0)}paneSizeBeforeCollapseMap=new Map;prevDelta=0;constructor(e){this.opts=e,this.attachment=vi(this.opts.ref),this.domContext=new hi(this.opts.ref),_r([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>Yc({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray,domContext:this.domContext})),xt(()=>Tt(()=>this.#s())),_r([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&hd({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),_r(()=>this.panesArrayChanged,()=>{if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const t=this.layout;let a=null;if(this.opts.autoSaveId.current){const i=ud(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);i&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(i.expandToSizes)),a=i.layout)}a==null&&(a=Jc({panesArray:this.panesArray}));const n=Zc({layout:a,paneConstraints:this.panesArray.map(i=>i.constraints)});ur(t,n)||(this.layout=n,this.opts.onLayout.current?.(n),fr(this.panesArray,n,this.paneIdToLastNotifiedSizeMap))})}setLayout=e=>{this.layout=e};registerResizeHandle=e=>t=>{t.preventDefault();const a=this.opts.direction.current,n=this.dragState,i=this.opts.id.current,s=this.opts.keyboardResizeBy.current,l=this.layout,d=this.panesArray,{initialLayout:u}=n??{},c=this.domContext.getDocument(),p=qi({groupId:i,dragHandleId:e,domContext:this.domContext});let h=td({event:t,dragHandleId:e,dir:a,initialDragState:n,keyboardResizeBy:s,domContext:this.domContext});if(h===0)return;const v=a==="horizontal";c.dir==="rtl"&&v&&(h=-h);const m=d.map(k=>k.constraints),w=pr({delta:h,layout:u??l,paneConstraints:m,pivotIndices:p,trigger:Zs(t)?"keyboard":"mouse-or-touch"}),b=!ur(l,w);(Qs(t)||eo(t))&&this.prevDelta!==h&&(this.prevDelta=h,Ua(b?v?"horizontal":"vertical":v?h<0?"horizontal-min":"horizontal-max":h<0?"vertical-min":"vertical-max",c)),b&&(this.setLayout(w),this.opts.onLayout.current?.(w),fr(d,w,this.paneIdToLastNotifiedSizeMap))};resizePane=(e,t)=>{const a=this.layout,n=this.panesArray,i=n.map(p=>p.constraints),{paneSize:s,pivotIndices:l}=$n(n,e,a);vt(s!=null);const u=qn(n,e)===n.length-1?s-t:t-s,c=pr({delta:u,layout:a,paneConstraints:i,pivotIndices:l,trigger:"imperative-api"});ur(a,c)||(this.setLayout(c),this.opts.onLayout.current?.(c),fr(n,c,this.paneIdToLastNotifiedSizeMap))};startDragging=(e,t)=>{const a=this.opts.direction.current,n=this.layout,i=gi(e,this.domContext);vt(i);const s=no(a,t);this.dragState={dragHandleId:e,dragHandleRect:i.getBoundingClientRect(),initialCursorPosition:s,initialLayout:n}};stopDragging=()=>{cd(),this.dragState=null};isPaneCollapsed=e=>{const t=this.panesArray,a=this.layout,{collapsedSize:n=0,collapsible:i,paneSize:s}=$n(t,e,a);return i===!0&&s===n};expandPane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(m=>m.constraints),{collapsedSize:i=0,paneSize:s,minSize:l=0,pivotIndices:d}=$n(a,e,t);if(s!==i)return;const u=this.paneSizeBeforeCollapseMap.get(e.opts.id.current),c=u!=null&&u>=l?u:l,h=qn(a,e)===a.length-1?s-c:c-s,v=pr({delta:h,layout:t,paneConstraints:n,pivotIndices:d,trigger:"imperative-api"});ur(t,v)||(this.setLayout(v),this.opts.onLayout.current?.(v),fr(a,v,this.paneIdToLastNotifiedSizeMap))};collapsePane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(p=>p.constraints),{collapsedSize:i=0,paneSize:s,pivotIndices:l}=$n(a,e,t);if(vt(s!=null),s===i)return;this.paneSizeBeforeCollapseMap.set(e.opts.id.current,s);const u=qn(a,e)===a.length-1?s-i:i-s,c=pr({delta:u,layout:t,paneConstraints:n,pivotIndices:l,trigger:"imperative-api"});ur(t,c)||(this.layout=c,this.opts.onLayout.current?.(c),fr(a,c,this.paneIdToLastNotifiedSizeMap))};getPaneSize=e=>$n(this.panesArray,e,this.layout).paneSize;getPaneStyle=(e,t)=>{const a=this.panesArray,n=this.layout,i=this.dragState,s=qn(a,e);return dd({defaultSize:t,dragState:i,layout:n,panesArray:a,paneIndex:s})};isPaneExpanded=e=>{const{collapsedSize:t=0,collapsible:a,paneSize:n}=$n(this.panesArray,e,this.layout);return!a||n>t};registerPane=e=>{const t=[...this.panesArray,e];return t.sort((a,n)=>{const i=a.opts.order.current,s=n.opts.order.current;return i==null&&s==null?0:i==null?-1:s==null?1:i-s}),this.panesArray=t,this.panesArrayChanged=!0,()=>{const a=[...this.panesArray],n=qn(this.panesArray,e);n<0||(a.splice(n,1),this.panesArray=a,delete this.paneIdToLastNotifiedSizeMap[e.opts.id.current],this.panesArrayChanged=!0)}};#s=()=>{const e=this.opts.id.current,t=Or(e,this.domContext),a=this.panesArray,n=t.map(i=>{const s=i.getAttribute("data-pane-resizer-id");if(!s)return Dn;const[l,d]=nd({groupId:e,handleId:s,panesArray:a,domContext:this.domContext});if(l==null||d==null)return Dn;const c=Ic(i,"keydown",p=>{if(p.defaultPrevented||p.key!=="Enter")return;p.preventDefault();const h=this.panesArray,v=h.findIndex(E=>E.opts.id.current===l);if(v<0)return;const m=h[v];vt(m);const w=this.layout,b=w[v],{collapsedSize:k=0,collapsible:I,minSize:C=0}=m.constraints;if(!(b!=null&&I))return;const L=pr({delta:Ht(b,k)?C-b:k-b,layout:w,paneConstraints:h.map(E=>E.constraints),pivotIndices:qi({groupId:e,dragHandleId:s,domContext:this.domContext}),trigger:"keyboard"});w!==L&&(this.layout=L)});return()=>{c()}});return()=>{for(const i of n)i()}};#i=oe(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"},...this.attachment}));get props(){return o(this.#i)}set props(e){y(this.#i,e)}}const vd=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];class bi{static create(e){return new bi(e,wi.get())}opts;#e;attachment;domContext;#t=oe(()=>this.#e.dragState?.dragHandleId===this.opts.id.current);#r=Ue(!1);resizeHandler=null;constructor(e,t){this.opts=e,this.#e=t,this.attachment=vi(this.opts.ref),this.domContext=new hi(this.opts.ref),xt(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.#e.registerResizeHandle(this.opts.id.current)}),xt(()=>{const a=this.opts.ref.current;if(!a)return;const n=this.opts.disabled.current,i=this.resizeHandler,s=o(this.#t);if(n||i===null||!s)return;const l=h=>{i(h)},d=h=>{i(h)},u=()=>{a.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1)},c=this.domContext.getDocument().body,p=this.domContext.getWindow();return Ks(sn(c,"contextmenu",u),sn(c,"mousemove",l),sn(c,"touchmove",l,{passive:!1}),sn(c,"mouseleave",d),sn(p,"mouseup",u),sn(p,"touchend",u))})}#a=e=>{e.preventDefault(),!this.opts.disabled.current&&(this.#e.startDragging(this.opts.id.current,e),this.opts.onDraggingChange.current(!0))};#n=()=>{const e=this.opts.ref.current;e&&(e.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1))};#s=e=>{if(this.opts.disabled.current||!this.resizeHandler||e.defaultPrevented)return;if(vd.includes(e.key)){e.preventDefault(),this.resizeHandler(e);return}if(e.key!=="F6")return;e.preventDefault();const t=Or(this.#e.opts.id.current,this.domContext),a=to({groupId:this.#e.opts.id.current,id:this.opts.id.current,domContext:this.domContext});if(a===null)return;let n=0;e.shiftKey?a>0?n=a-1:n=t.length-1:a+1<t.length?n=a+1:n=0,t[n].focus()};#i=()=>{y(this.#r,!1)};#o=()=>{y(this.#r,!0)};#l=e=>{this.#a(e)};#d=()=>{this.#n()};#u=()=>{this.#n()};#f=()=>{this.#n()};#p=e=>{this.#a(e)};#c=oe(()=>({id:this.opts.id.current,role:"separator","data-direction":this.#e.opts.direction.current,"data-pane-group-id":this.#e.opts.id.current,"data-active":o(this.#t)?"pointer":o(this.#r)?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:ao(this.#e.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:this.#s,onblur:this.#i,onfocus:this.#o,onmousedown:this.#l,onmouseup:this.#d,ontouchcancel:this.#u,ontouchend:this.#f,ontouchstart:this.#p,...this.attachment}));get props(){return o(this.#c)}set props(e){y(this.#c,e)}}class xi{static create(e){return new xi(e,wi.get())}opts;group;attachment;domContext;#e=Ue("");#t=oe(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current}));get callbacks(){return o(this.#t)}set callbacks(e){y(this.#t,e)}#r=oe(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current}));get constraints(){return o(this.#r)}set constraints(e){y(this.#r,e)}#a=e=>{y(this.#e,e,!0),Nc(()=>{if(this.opts.ref.current){const t=this.opts.ref.current;if(!(getComputedStyle(t).transitionDuration!=="0s")){y(this.#e,"");return}const i=s=>{s.propertyName==="flex-grow"&&(y(this.#e,""),t.removeEventListener("transitionend",i))};t.addEventListener("transitionend",i)}else y(this.#e,"")})};pane={collapse:()=>{this.#a("collapsing"),this.group.collapsePane(this)},expand:()=>{this.#a("expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:e=>this.group.resizePane(this,e),getId:()=>this.opts.id.current};constructor(e,t){this.opts=e,this.group=t,this.attachment=vi(this.opts.ref),this.domContext=new hi(this.opts.ref),an(()=>this.group.registerPane(this)),_r(()=>nl(this.constraints),()=>{this.group.panesArrayChanged=!0})}#n=oe(()=>this.group.isPaneCollapsed(this));#s=oe(()=>o(this.#e)!==""?o(this.#e):o(this.#n)?"collapsed":"expanded");#i=oe(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":o(this.#n)?"":void 0,"data-expanded":o(this.#n)?void 0:"","data-pane-state":o(this.#s),...this.attachment}));get props(){return o(this.#i)}set props(e){y(this.#i,e)}}var md=P("<div><!></div>");function gd(r,e){const t=oi();Qe(e,!0);let a=B(e,"autoSaveId",3,null),n=B(e,"id",3,t),i=B(e,"keyboardResizeBy",3,null),s=B(e,"onLayoutChange",3,Dn),l=B(e,"storage",3,yr),d=B(e,"ref",15,null),u=di(e,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const c=yi.create({id:nt.with(()=>n()??t),ref:nt.with(()=>d(),C=>d(C)),autoSaveId:nt.with(()=>a()),direction:nt.with(()=>e.direction),keyboardResizeBy:nt.with(()=>i()),onLayout:nt.with(()=>s()),storage:nt.with(()=>l())}),p=()=>c.layout,h=c.setLayout,v=()=>c.opts.id.current,m=oe(()=>pi(u,c.props));var w=ht(),b=Ze(w);{var k=C=>{var L=ht(),E=Ze(L);tr(E,()=>e.child,()=>({props:o(m)})),_(C,L)},I=C=>{var L=md();_a(L,()=>({...o(m)}));var E=f(L);tr(E,()=>e.children??Zt),_(C,L)};j(b,C=>{e.child?C(k):C(I,!1)})}return _(r,w),et({getLayout:p,setLayout:h,getId:v})}var wd=P("<div><!></div>");function Xi(r,e){const t=oi();Qe(e,!0);let a=B(e,"id",3,t),n=B(e,"ref",15,null),i=B(e,"onCollapse",3,Dn),s=B(e,"onExpand",3,Dn),l=B(e,"onResize",3,Dn),d=di(e,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const u=xi.create({id:nt.with(()=>a()),ref:nt.with(()=>n(),N=>n(N)),collapsedSize:nt.with(()=>e.collapsedSize),collapsible:nt.with(()=>e.collapsible),defaultSize:nt.with(()=>e.defaultSize),maxSize:nt.with(()=>e.maxSize),minSize:nt.with(()=>e.minSize),onCollapse:nt.with(()=>i()),onExpand:nt.with(()=>s()),onResize:nt.with(()=>l()),order:nt.with(()=>e.order)}),c=u.pane.collapse,p=u.pane.expand,h=u.pane.getSize,v=u.pane.isCollapsed,m=u.pane.isExpanded,w=u.pane.resize,b=u.pane.getId,k=oe(()=>pi(d,u.props));var I=ht(),C=Ze(I);{var L=N=>{var z=ht(),H=Ze(z);tr(H,()=>e.child,()=>({props:o(k)})),_(N,z)},E=N=>{var z=wd();_a(z,()=>({...o(k)}));var H=f(z);tr(H,()=>e.children??Zt),_(N,z)};j(C,N=>{e.child?N(L):N(E,!1)})}return _(r,I),et({collapse:c,expand:p,getSize:h,isCollapsed:v,isExpanded:m,resize:w,getId:b})}var yd=P("<div><!></div>");function bd(r,e){const t=oi();Qe(e,!0);let a=B(e,"id",3,t),n=B(e,"ref",15,null),i=B(e,"disabled",3,!1),s=B(e,"onDraggingChange",3,Dn),l=B(e,"tabindex",3,0),d=di(e,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const u=bi.create({id:nt.with(()=>a()),ref:nt.with(()=>n(),w=>n(w)),disabled:nt.with(()=>i()),onDraggingChange:nt.with(()=>s()),tabIndex:nt.with(()=>l())}),c=oe(()=>pi(d,u.props));var p=ht(),h=Ze(p);{var v=w=>{var b=ht(),k=Ze(b);tr(k,()=>e.child,()=>({props:o(c)})),_(w,b)},m=w=>{var b=yd();_a(b,()=>({...o(c)}));var k=f(b);tr(k,()=>e.children??Zt),_(w,b)};j(h,w=>{e.child?w(v):w(m,!1)})}_(r,p),et()}const Br={SIDEBAR_EXPANDED:"editme_sidebar_expanded",SIDEBAR_SECTION:"editme_sidebar_section"},Aa={sidebar:{isExpanded:!0,activeSection:"about"},isInitialized:!1};function xd(){const{subscribe:r,set:e,update:t}=Jt(Aa);return{subscribe:r,set:e,update:t,initialize(){let a=Aa.sidebar.isExpanded,n=Aa.sidebar.activeSection;try{const i=localStorage.getItem(Br.SIDEBAR_EXPANDED);i&&(a=JSON.parse(i))}catch(i){console.warn("Failed to load sidebar expanded state:",i)}try{const i=localStorage.getItem(Br.SIDEBAR_SECTION);i&&_d(i)&&(n=i)}catch(i){console.warn("Failed to load sidebar section:",i)}t(i=>({...i,sidebar:{isExpanded:a,activeSection:n},isInitialized:!0}))},toggleSidebar(){t(a=>{const n=!a.sidebar.isExpanded;try{localStorage.setItem(Br.SIDEBAR_EXPANDED,JSON.stringify(n))}catch(i){console.warn("Failed to save sidebar expanded state:",i)}return{...a,sidebar:{...a.sidebar,isExpanded:n}}})},setSidebarSection(a){t(n=>{try{localStorage.setItem(Br.SIDEBAR_SECTION,a)}catch(i){console.warn("Failed to save sidebar section:",i)}return{...n,sidebar:{...n.sidebar,activeSection:a}}})}}}function _d(r){return["about","workspace","metadata","manifest","navigation","spine","settings"].includes(r)}const An=xd();typeof window<"u"&&An.initialize();const Mr={en:{code:"en",name:"English",direction:"ltr",englishName:"English"},de:{code:"de",name:"Deutsch",direction:"ltr",englishName:"German"},ka:{code:"ka",name:"á¥áá áá£áá",direction:"ltr",englishName:"Georgian"},ar:{code:"ar",name:"Ø§ÙØ¹Ø±Ø¨ÙØ©",direction:"rtl",englishName:"Arabic"},he:{code:"he",name:"×¢××¨××ª",direction:"rtl",englishName:"Hebrew"},"zh-Hant":{code:"zh-Hant",name:"ç¹é«ä¸­æ",direction:"ltr",englishName:"Traditional Chinese"},ja:{code:"ja",name:"æ¥æ¬èª",direction:"ltr",englishName:"Japanese"}},Lr="en",Sd=["ar","he"];function ka(r){return Sd.includes(r)}function Ed(){if(typeof navigator>"u")return Lr;const r=navigator.languages||[navigator.language];for(const e of r){if(Mr[e])return e;const t=e.split("-")[0];if(Mr[t])return t;if(t==="zh"&&["zh-TW","zh-HK","zh-MO"].includes(e))return"zh-Hant"}return Lr}const kd=`/**
 * OPFS Worker Script
 *
 * Handles OPFS sync access handle operations in a Web Worker.
 * Used primarily on Safari where sync access handles work better in workers.
 *
 * NOTE: This file MUST remain JavaScript (not TypeScript) because it gets
 * injected as a worker blob URL to support sync access handles in Safari.
 * Claude/agents should NOT convert this file to TypeScript.
 */

let opfsRoot = null;

async function getOPFSRoot() {
  if (!opfsRoot) {
    opfsRoot = await navigator.storage.getDirectory();
  }
  return opfsRoot;
}

async function ensureWorkspaceDirectory(workspaceId) {
  const root = await getOPFSRoot();
  const workspacesDir = await root.getDirectoryHandle('workspaces', { create: true });
  return await workspacesDir.getDirectoryHandle(workspaceId, { create: true });
}

async function ensureDirectoryPath(baseHandle, path) {
  const pathParts = path.split('/').filter(part => part.length > 0);
  let currentHandle = baseHandle;

  for (const part of pathParts) {
    currentHandle = await currentHandle.getDirectoryHandle(part, { create: true });
  }

  return currentHandle;
}

async function getFileHandle(workspaceId, path, create = false) {
  const workspaceHandle = await ensureWorkspaceDirectory(workspaceId);

  const pathParts = path.split('/');
  const fileName = pathParts.pop();
  const dirPath = pathParts.join('/');

  let targetDir = workspaceHandle;
  if (dirPath) {
    targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
  }

  return await targetDir.getFileHandle(fileName, { create });
}

async function createWorkspace(data) {
  try {
    await ensureWorkspaceDirectory(data.workspaceId);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteWorkspace(data) {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    await workspacesDir.removeEntry(data.workspaceId, { recursive: true });
    return { success: true };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true }; // Already deleted
    }
    return { success: false, error: error.message };
  }
}

async function listWorkspaces() {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    const workspaces = [];

    for await (const [name, handle] of workspacesDir.entries()) {
      if (handle.kind === 'directory') {
        workspaces.push(name);
      }
    }

    return { success: true, workspaces: workspaces.sort() };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true, workspaces: [] };
    }
    return { success: false, error: error.message };
  }
}

async function writeFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, true);
    const syncHandle = await fileHandle.createSyncAccessHandle();

    try {
      // Truncate the file first to ensure complete overwrite
      syncHandle.truncate(data.content.byteLength);
      syncHandle.write(data.content, { at: 0 });
      syncHandle.flush();
    } finally {
      syncHandle.close();
    }

    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function readFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, false);
    const file = await fileHandle.getFile();
    const content = await file.arrayBuffer();
    return { success: true, content };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteFile(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);

    const pathParts = data.path.split('/');
    const fileName = pathParts.pop();
    const dirPath = pathParts.join('/');

    let targetDir = workspaceHandle;
    if (dirPath) {
      targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
    }

    await targetDir.removeEntry(fileName);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function collectFiles(dirHandle, currentPath, files) {
  for await (const [name, handle] of dirHandle.entries()) {
    const fullPath = currentPath ? \`\${currentPath}/\${name}\` : name;

    if (handle.kind === 'file') {
      files.push(fullPath);
    } else if (handle.kind === 'directory') {
      await collectFiles(handle, fullPath, files);
    }
  }
}

async function listFiles(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);
    let targetDir = workspaceHandle;

    if (data.basePath) {
      try {
        targetDir = await ensureDirectoryPath(workspaceHandle, data.basePath);
      } catch (error) {
        if (error.name === 'NotFoundError') {
          return { success: true, files: [] };
        }
        throw error;
      }
    }

    const files = [];
    await collectFiles(targetDir, data.basePath || '', files);
    return { success: true, files: files.sort() };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function getQuota() {
  try {
    if ('storage' in navigator && 'estimate' in navigator.storage) {
      const estimate = await navigator.storage.estimate();
      return {
        success: true,
        quota: {
          used: estimate.usage || 0,
          available: (estimate.quota || 0) - (estimate.usage || 0),
        },
      };
    }
    return { success: true, quota: { used: 0, available: 0 } };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// Worker message handler
self.addEventListener('message', async event => {
  const { type, data, id } = event.data;
  let result;

  try {
    switch (type) {
      case 'createWorkspace':
        result = await createWorkspace(data);
        break;
      case 'deleteWorkspace':
        result = await deleteWorkspace(data);
        break;
      case 'listWorkspaces':
        result = await listWorkspaces();
        break;
      case 'writeFile':
        result = await writeFile(data);
        break;
      case 'readFile':
        result = await readFile(data);
        break;
      case 'deleteFile':
        result = await deleteFile(data);
        break;
      case 'listFiles':
        result = await listFiles(data);
        break;
      case 'getQuota':
        result = await getQuota();
        break;
      default:
        result = { success: false, error: \`Unknown operation: \${type}\` };
    }
  } catch (error) {
    result = { success: false, error: error.message };
  }

  const response = { type, result, id };
  self.postMessage(response);
});
`;class Td{worker=null;messageId=0;pendingMessages=new Map;timeout=1e4;isDestroyed=!1;constructor(){this.initWorker()}initWorker(){const e=new Blob([kd],{type:"application/javascript"}),t=URL.createObjectURL(e);this.worker=new Worker(t),this.worker.onmessage=this.handleWorkerMessage.bind(this),this.worker.onerror=this.handleWorkerError.bind(this),this.worker.onmessageerror=this.handleWorkerMessageError.bind(this),URL.revokeObjectURL(t)}handleWorkerMessage(e){const{result:t,id:a,type:n}=e.data;if(n==="readFile"&&t&&!t.success?console.warn(`â ï¸ Worker readFile failed: ${t.error}`):n==="readFile"&&t&&t.content===null&&console.warn(`â ï¸ Empty ArrayBuffer received for ${t.path||"unknown path"}`),this.pendingMessages.has(a)){const{resolve:i}=this.pendingMessages.get(a);this.pendingMessages.delete(a),i(t)}}handleWorkerError(e){const t=new Error(`Worker error: ${e.message||"Unknown error"}`);this.rejectAllPendingMessages(t)}handleWorkerMessageError(e){const t=new Error("Worker message error: Failed to deserialize message");this.rejectAllPendingMessages(t)}rejectAllPendingMessages(e){for(const{reject:t}of this.pendingMessages.values())t(e);this.pendingMessages.clear()}async sendMessage(e,t){if(this.isDestroyed)throw new Error("Worker terminated");if(!this.worker)throw new Error("Worker not initialized");return new Promise((a,n)=>{const i=++this.messageId;this.pendingMessages.set(i,{resolve:a,reject:n}),this.worker.postMessage({type:e,data:t,id:i}),setTimeout(()=>{this.pendingMessages.has(i)&&(this.pendingMessages.delete(i),n(new Error(`Worker operation timed out after ${this.timeout}ms`)))},this.timeout)})}setTimeout(e){this.timeout=e}async createWorkspace(e){return await this.sendMessage("createWorkspace",{workspaceId:e})}async deleteWorkspace(e){return await this.sendMessage("deleteWorkspace",{workspaceId:e})}async listWorkspaces(){return await this.sendMessage("listWorkspaces")}async writeFile(e,t,a){return await this.sendMessage("writeFile",{workspaceId:e,path:t,content:a})}async readFile(e,t){return await this.sendMessage("readFile",{workspaceId:e,path:t})}async deleteFile(e,t){return await this.sendMessage("deleteFile",{workspaceId:e,path:t})}async listFiles(e,t){return await this.sendMessage("listFiles",{workspaceId:e,basePath:t})}async getFileInfo(e,t){return await this.sendMessage("getFileInfo",{workspaceId:e,path:t})}async getQuota(){return await this.sendMessage("getQuota")}destroy(){if(this.isDestroyed)return;this.isDestroyed=!0;const e=new Error("Worker terminated");this.rejectAllPendingMessages(e),this.worker&&(this.worker.terminate(),this.worker=null)}}class Cd{capabilityCache=null;async testOPFSAvailable(){try{return"storage"in navigator&&"getDirectory"in navigator.storage}catch{return!1}}async testOPFSAsync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_async_test__",{create:!0});if(!("createWritable"in t))return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1;try{return await(await t.createWritable()).close(),await e.removeEntry("__opfs_async_test__"),!0}catch{return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_sync_test__",{create:!0});if(!("createSyncAccessHandle"in t))return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1;try{return(await t.createSyncAccessHandle()).close(),await e.removeEntry("__opfs_sync_test__"),!0}catch{return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSyncWorker(){return new Promise(e=>{try{const t=`
					(async () => {
						try {
							const root = await navigator.storage.getDirectory();
							const testHandle = await root.getFileHandle('__worker_test__', { create: true });
							if ('createSyncAccessHandle' in testHandle) {
								const syncHandle = await testHandle.createSyncAccessHandle();
								syncHandle.close();
								await root.removeEntry('__worker_test__');
								self.postMessage({ success: true });
							} else {
								self.postMessage({ success: false });
							}
						} catch (error) {
							self.postMessage({ success: false, error: error.message });
						}
					})();
				`,a=new Blob([t],{type:"application/javascript"}),n=URL.createObjectURL(a),i=new Worker(n),s=setTimeout(()=>{i.terminate(),URL.revokeObjectURL(n),e(!1)},3e3);i.onmessage=l=>{clearTimeout(s),i.terminate(),URL.revokeObjectURL(n),e(l.data.success===!0)},i.onerror=()=>{clearTimeout(s),i.terminate(),URL.revokeObjectURL(n),e(!1)}}catch{e(!1)}})}async testIndexedDB(){return new Promise(e=>{try{if(!("indexedDB"in globalThis)){e(!1);return}const t=indexedDB.open("__capability_test__",1);t.onerror=()=>{e(!1)},t.onsuccess=()=>{t.result.close(),indexedDB.deleteDatabase("__capability_test__"),e(!0)},t.onupgradeneeded=a=>{const n=a.target.result;n.objectStoreNames.contains("test")||n.createObjectStore("test")}}catch{e(!1)}})}async testStorageEstimate(){try{return!("storage"in navigator)||!("estimate"in navigator.storage)?!1:(await navigator.storage.estimate(),!0)}catch{return!1}}async detectCapabilities(){if(this.capabilityCache)return this.capabilityCache;try{const[e,t,a,n,i,s]=await Promise.all([this.testOPFSAvailable().catch(()=>!1),this.testOPFSAsync().catch(()=>!1),this.testOPFSSync().catch(()=>!1),this.testOPFSSyncWorker().catch(()=>!1),this.testIndexedDB().catch(()=>!1),this.testStorageEstimate().catch(()=>!1)]);return this.capabilityCache={opfs:e,opfsAsync:t,opfsSync:a,opfsSyncWorker:n,indexedDB:i,storageEstimate:s},this.capabilityCache}catch{return this.capabilityCache={opfs:!1,opfsAsync:!1,opfsSync:!1,opfsSyncWorker:!1,indexedDB:!1,storageEstimate:!1},this.capabilityCache}}async detectOptimalBackend(){const e=await this.detectCapabilities();if(e.opfsAsync)return"opfs-async";if(e.opfsSyncWorker)return"opfs-sync";if(e.indexedDB)return"indexeddb";throw new Error("No storage backend available")}clearCache(){this.capabilityCache=null}}class Kn{static featureDetector=new Cd;static cachedBackend=null;static async detectStorageBackend(){return await this.featureDetector.detectOptimalBackend()}static async testWorkerSyncAccessHandle(){return await this.featureDetector.testOPFSSyncWorker()}static async create(){if(Kn.cachedBackend)return Kn.cachedBackend;const e=await this.detectStorageBackend();let t;switch(e){case"opfs-sync":t=new Fd;break;case"opfs-async":t=new Id,await t.init?.();break;case"indexeddb":t=new Pd,await t.init?.();break;default:throw new Error(`Unsupported backend: ${e}`)}return Kn.cachedBackend=t,t}static async getCapabilities(){return await this.featureDetector.detectCapabilities()}static clearCache(){this.featureDetector.clearCache(),Kn.cachedBackend=null}}class Id{root=null;async init(){if(!("storage"in navigator&&"getDirectory"in navigator.storage))throw new Error("OPFS not available");this.root=await navigator.storage.getDirectory()}async ensureWorkspaceDirectory(e){if(!this.root)throw new Error("Backend not initialized");return await(await this.root.getDirectoryHandle("workspaces",{create:!0})).getDirectoryHandle(e,{create:!0})}async ensureDirectoryPath(e,t){const a=t.split("/").filter(i=>i.length>0);let n=e;for(const i of a)n=await n.getDirectoryHandle(i,{create:!0});return n}async getFileHandle(e,t,a=!1){const n=await this.ensureWorkspaceDirectory(e),i=t.split("/"),s=i.pop(),l=i.join("/");let d=n;return l&&(d=await this.ensureDirectoryPath(n,l)),await d.getFileHandle(s,{create:a})}async createWorkspace(e){await this.ensureWorkspaceDirectory(e)}async deleteWorkspace(e){if(!this.root)throw new Error("Backend not initialized");try{await(await this.root.getDirectoryHandle("workspaces")).removeEntry(e,{recursive:!0})}catch(t){if(t.name!=="NotFoundError")throw t}}async listWorkspaces(){if(!this.root)throw new Error("Backend not initialized");try{const e=await this.root.getDirectoryHandle("workspaces"),t=[];for await(const[a,n]of e.entries())n.kind==="directory"&&t.push(a);return t.sort()}catch(e){if(e.name==="NotFoundError")return[];throw e}}async writeFile(e,t,a){const n=await this.getFileHandle(e,t,!0);await this.writeFileWithFallback(n,a)}async writeFileWithFallback(e,t){try{const a=await e.createWritable();try{await a.write(t)}finally{await a.close()}}catch(a){if("createSyncAccessHandle"in e){const n=await e.createSyncAccessHandle();try{n.truncate(t.byteLength),n.write(t,{at:0}),n.flush()}finally{n.close()}}else throw a}}async readFile(e,t){return await(await(await this.getFileHandle(e,t,!1)).getFile()).arrayBuffer()}async deleteFile(e,t){const a=await this.ensureWorkspaceDirectory(e),n=t.split("/"),i=n.pop(),s=n.join("/");let l=a;s&&(l=await this.ensureDirectoryPath(a,s)),await l.removeEntry(i)}async listFiles(e,t){const a=await this.ensureWorkspaceDirectory(e);let n=a;const i=t?t.replace(/\/+$/,""):"";if(i)try{n=await this.ensureDirectoryPath(a,i)}catch(l){if(l.name==="NotFoundError")return[];throw l}const s=[];return await this.collectFiles(n,i,s),s.sort()}async getFileInfo(e,t){const n=await(await this.getFileHandle(e,t,!1)).getFile();return{size:n.size,lastModified:new Date(n.lastModified)}}async collectFiles(e,t,a){for await(const[n,i]of e.entries()){const s=t?`${t}/${n}`:n;i.kind==="file"?a.push(s):i.kind==="directory"&&await this.collectFiles(i,s,a)}}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}return{used:0,available:0}}getBackendType(){return"opfs-async"}}class Fd{workerManager;constructor(){this.workerManager=new Td}async sendMessage(e,t){return await this.workerManager.sendMessage(e,t)}destroy(){this.workerManager.destroy()}async createWorkspace(e){const t=await this.workerManager.createWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to create workspace")}async deleteWorkspace(e){const t=await this.workerManager.deleteWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to delete workspace")}async listWorkspaces(){const e=await this.workerManager.listWorkspaces();if(!e.success)throw new Error(e.error?.message||"Failed to list workspaces");return e.workspaces||[]}async writeFile(e,t,a){const n=await this.workerManager.writeFile(e,t,a);if(!n.success)throw new Error(n.error?.message||"Failed to write file")}async readFile(e,t){const a=await this.workerManager.readFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to read file");const n=a.content;if(!n||!(n instanceof ArrayBuffer))return console.warn(`â ï¸ Invalid ArrayBuffer received for ${t}: ${typeof n}, length: ${n?.byteLength||"undefined"}`),new ArrayBuffer(0);try{return n.byteLength===0&&console.warn(`â ï¸ Empty ArrayBuffer received for ${t}`),n}catch(i){return console.warn(`â ï¸ Detached ArrayBuffer received for ${t}:`,i),new ArrayBuffer(0)}}async deleteFile(e,t){const a=await this.workerManager.deleteFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to delete file")}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0,n=await this.workerManager.listFiles(e,a);if(!n.success)throw new Error(n.error?.message||"Failed to list files");return n.files||[]}async getFileInfo(e,t){const a=await this.workerManager.getFileInfo(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to get file info");return a.data?.fileInfo||{size:0,lastModified:new Date}}async getQuota(){const e=await this.workerManager.getQuota();if(!e.success)throw new Error(e.error?.message||"Failed to get quota");return e.data?.quota||{used:0,available:0}}getBackendType(){return"opfs-sync"}}class Pd{db=null;dbName="editme-storage";version=1;async init(){return new Promise((e,t)=>{if(!("indexedDB"in globalThis)){t(new Error("IndexedDB not available"));return}const a=indexedDB.open(this.dbName,this.version);a.onerror=()=>{t(new Error(`Failed to open IndexedDB: ${a.error?.message}`))},a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=n=>{const i=n.target.result;if(i.objectStoreNames.contains("workspaces")||i.createObjectStore("workspaces",{keyPath:"id"}).createIndex("created","created",{unique:!1}),!i.objectStoreNames.contains("files")){const s=i.createObjectStore("files",{keyPath:["workspaceId","path"]});s.createIndex("workspaceId","workspaceId",{unique:!1}),s.createIndex("modified","modified",{unique:!1})}}})}async transaction(e,t,a){if(!this.db)throw new Error("Database not initialized");return new Promise((n,i)=>{const s=this.db.transaction(e,t);s.onerror=()=>{i(new Error(`Transaction failed: ${s.error?.message}`))},a(s).then(n).catch(i)})}async putRecord(e,t){return new Promise((a,n)=>{const i=e.put(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Put failed: ${i.error?.message}`))})}async getRecord(e,t){return new Promise((a,n)=>{const i=e.get(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`Get failed: ${i.error?.message}`))})}async deleteRecord(e,t){return new Promise((a,n)=>{const i=e.delete(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Delete failed: ${i.error?.message}`))})}async getAllRecords(e,t){return new Promise((a,n)=>{const i=e.getAll(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`GetAll failed: ${i.error?.message}`))})}async createWorkspace(e){await this.transaction(["workspaces"],"readwrite",async t=>{const a=t.objectStore("workspaces");await this.putRecord(a,{id:e,created:Date.now()})})}async deleteWorkspace(e){await this.transaction(["workspaces","files"],"readwrite",async t=>{const a=t.objectStore("workspaces"),n=t.objectStore("files"),i=n.index("workspaceId"),s=await this.getAllRecords(i,IDBKeyRange.only(e));for(const l of s)await this.deleteRecord(n,[l.workspaceId,l.path]);await this.deleteRecord(a,e)})}async listWorkspaces(){return await this.transaction(["workspaces"],"readonly",async e=>{const t=e.objectStore("workspaces");return(await this.getAllRecords(t)).map(n=>n.id).sort()})}async writeFile(e,t,a){await this.transaction(["files"],"readwrite",async n=>{const i=n.objectStore("files");await this.putRecord(i,{workspaceId:e,path:t,content:a,modified:Date.now()})})}async readFile(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return i.content})}async deleteFile(e,t){await this.transaction(["files"],"readwrite",async a=>{const n=a.objectStore("files");await this.deleteRecord(n,[e,t])})}async listFiles(e,t){return await this.transaction(["files"],"readonly",async a=>{const i=a.objectStore("files").index("workspaceId");let l=(await this.getAllRecords(i,IDBKeyRange.only(e))).map(d=>d.path);if(t){const u=t.replace(/\/+$/,"")+"/";l=l.filter(c=>c.startsWith(u))}return l.sort()})}async getFileInfo(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return{size:i.content.byteLength,lastModified:new Date(i.modified)}})}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage)try{const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}catch{}return{used:0,available:0}}getBackendType(){return"indexeddb"}}class Md{backend=null;initialized=!1;async init(){this.initialized||(this.backend=await Kn.create(),this.initialized=!0)}isInitialized(){return this.initialized&&this.backend!==null}getBackendType(){if(!this.backend)throw new Error("Storage manager not initialized");return this.backend.getBackendType()}generateWorkspaceId(){return"workspace-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}async createWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");const t=e||this.generateWorkspaceId();return await this.backend.createWorkspace(t),t}async deleteWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteWorkspace(e)}async listWorkspaces(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listWorkspaces()}async writeFile(e,t,a){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.writeFile(e,t,a)}async readFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.readFile(e,t)}async deleteFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteFile(e,t)}async listFiles(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listFiles(e,t)}async getFileInfo(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getFileInfo(e,t)}async getQuota(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getQuota()}async writeTextFile(e,t,a){const i=new TextEncoder().encode(a).buffer;await this.writeFile(e,t,i)}async readTextFile(e,t){const a=await this.readFile(e,t);return new TextDecoder().decode(a)}async fileExists(e,t){try{return await this.readFile(e,t),!0}catch{return!1}}async getFileSize(e,t){return(await this.readFile(e,t)).byteLength}destroy(){this.backend&&"destroy"in this.backend&&this.backend.destroy(),this.backend=null,this.initialized=!1}}class Ut{static instance=null;manager;initPromise=null;constructor(){this.manager=new Md}static getInstance(){return Ut.instance||(Ut.instance=new Ut),Ut.instance}static async getInitializedInstance(){const e=Ut.getInstance();return e.isInitialized()||await e.init(),e}static resetInstance(){Ut.instance&&(Ut.instance.destroy(),Ut.instance=null)}async init(){if(!this.manager.isInitialized()){if(this.initPromise){await this.initPromise;return}this.initPromise=this.doInit();try{await this.initPromise}finally{this.initPromise=null}}}async doInit(){await this.manager.init(),console.log("FileStorageAPI initialized with backend:",this.manager.getBackendType())}isInitialized(){return this.manager.isInitialized()}getBackendType(){return this.manager.getBackendType()}async createWorkspace(e){return await this.manager.createWorkspace(e)}async deleteWorkspace(e){await this.manager.deleteWorkspace(e)}async listWorkspaces(){return await this.manager.listWorkspaces()}async writeFile(e,t,a){await this.manager.writeFile(e,t,a)}async readFile(e,t){return await this.manager.readFile(e,t)}async deleteFile(e,t){await this.manager.deleteFile(e,t)}async renameFile(e,t,a){const n=await this.manager.readFile(e,t);await this.manager.writeFile(e,a,n),await this.manager.deleteFile(e,t)}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0;return await this.manager.listFiles(e,a)}async getFileInfo(e,t){return await this.manager.getFileInfo(e,t)}async getQuota(){return await this.manager.getQuota()}async estimateWorkspaceSize(e){const t=await this.manager.listFiles(e);let a=0;for(const n of t)try{const i=await this.manager.getFileSize(e,n);a+=i}catch{}return a}async writeTextFile(e,t,a){await this.manager.writeTextFile(e,t,a)}async readTextFile(e,t){return await this.manager.readTextFile(e,t)}async fileExists(e,t){return await this.manager.fileExists(e,t)}supportsDirectBlobURLs(){const e=this.manager.getBackendType();return e==="opfs-async"||e==="opfs-sync"}async getFile(e,t){if(!this.manager.isInitialized())throw new Error("Storage manager not initialized");const a=this.manager.getBackendType();if(a==="opfs-async")return await(await this.manager.backend.getFileHandle(e,t,!1)).getFile();if(a==="opfs-sync"){const n=await this.readFile(e,t),i=t.split("/").pop()||"file";return new File([n],i)}else throw new Error("Direct file access not supported for IndexedDB backend")}destroy(){this.manager.destroy()}}function lo(r){return new ReadableStream({start(e){e.enqueue(r),e.close()}})}function Ld(r,e="download.x"){const t=window.URL.createObjectURL(r),a=document.createElement("a");a.href=t,a.setAttribute("download",e),a.click(),window.URL.revokeObjectURL(t)}async function co(r,e){const t=r.getReader();let a=!1;const n=[];for(;!a;){const i=await t.read();a=i.done,i.value&&n.push(i.value)}return new Blob(n,{type:e})}function un(r,e,t){const a=[];for(let n=0;n<t;n++)a.push(String.fromCharCode(r.getUint8(e+n)));return a.join("")}class Dr{#e;#t=0;#r=[];#a=[];#n=null;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const t=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([t]);if(e.compressionMethod===8){const a=new DecompressionStream("deflate-raw"),i=lo(t).pipeThrough(a);return await co(i)}else throw new Error(`Unsupported compression method: ${e.compressionMethod}`)}read(){for(;!this.#n&&this.#t<this.#e.byteLength-4;){const e=this.#e.getUint32(this.#t,!0);if(e===67324752){const t=this.readLocalFile(this.#t);t.startsAt=this.#t+30+t.fileNameLength+t.extraLength,t.extract=this.extract.bind(this,t),this.#r.push(t),this.#t=t.startsAt+t.compressedSize}else if(e===33639248){const t=this.readCentralDirectory(this.#t);this.#a.push(t),this.#t+=46+t.fileNameLength+t.extraLength+t.fileCommentLength}else if(e===101010256){this.#n=this.readEndCentralDirectory(this.#t);break}else this.#t++}}readLocalFile(e){const t=this.#e.getUint16(e+26,!0),a=this.#e.getUint16(e+28,!0);return{signature:un(this.#e,e,4),version:this.#e.getUint16(e+4,!0),generalPurpose:this.#e.getUint16(e+6,!0),compressionMethod:this.#e.getUint16(e+8,!0),lastModifiedTime:this.#e.getUint16(e+10,!0),lastModifiedDate:this.#e.getUint16(e+12,!0),crc:this.#e.getUint32(e+14,!0),compressedSize:this.#e.getUint32(e+18,!0),uncompressedSize:this.#e.getUint32(e+22,!0),fileNameLength:t,fileName:un(this.#e,e+30,t),extraLength:a,extra:un(this.#e,e+30+t,a),startsAt:0,extract:()=>Promise.resolve(new Blob)}}readCentralDirectory(e){const t=this.#e.getUint16(e+28,!0),a=this.#e.getUint16(e+30,!0),n=this.#e.getUint16(e+32,!0);return{signature:un(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:t,extraLength:a,fileCommentLength:n,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(e+42,!0),fileName:un(this.#e,e+46,t),extra:un(this.#e,e+46+t,a),comments:un(this.#e,e+46+t+a,n)}}readEndCentralDirectory(e){const t=this.#e.getUint16(e+20,!0);return{signature:un(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:t,comment:un(this.#e,e+22,t)}}get entries(){return this.#r}}class Jn{#e=[];static _crcTable=[];constructor(){this.#e=[]}async addFile(e,t,a={}){const{compressionMethod:n=e==="mimetype"?0:8,lastModified:i=new Date}=a;let s,l,d,u,c;if(t instanceof ArrayBuffer)c=t;else if(t instanceof Uint8Array)c=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);else if(t instanceof Blob)c=await t.arrayBuffer();else if(typeof t=="string")c=new TextEncoder().encode(t).buffer;else throw new Error("Unsupported data type");if(d=c.byteLength,l=this.#s(new Uint8Array(c)),n===0)s=c,u=d;else if(n===8){const h=new CompressionStream("deflate-raw"),m=lo(c).pipeThrough(h);s=await(await co(m)).arrayBuffer(),u=s.byteLength}else throw new Error(`Unsupported compression method: ${n}`);const p={fileName:e,compressionMethod:n,lastModified:i,crc32:l,compressedSize:u,uncompressedSize:d,data:s,localHeaderOffset:0};return this.#e.push(p),this}async build(){const e=[];let t=0;const a=[...this.#e].sort((u,c)=>u.fileName==="mimetype"?-1:c.fileName==="mimetype"?1:0);for(const u of a){u.localHeaderOffset=t;const c=this.#t(u);e.push(c),t+=c.byteLength,e.push(u.data),t+=u.data.byteLength}const n=t;for(const u of a){const c=this.#r(u);e.push(c),t+=c.byteLength}const i=this.#a(this.#e.length,t-n,n);e.push(i);const s=e.reduce((u,c)=>u+c.byteLength,0),l=new Uint8Array(s);let d=0;for(const u of e)l.set(new Uint8Array(u),d),d+=u.byteLength;return l.buffer}async buildBlob(){const e=await this.build();return new Blob([e],{type:"application/zip"})}#t(e){const t=new TextEncoder().encode(e.fileName),a=30+t.length,n=new ArrayBuffer(a),i=new DataView(n),s=new Uint8Array(n);i.setUint32(0,67324752,!0),i.setUint16(4,20,!0),i.setUint16(6,0,!0),i.setUint16(8,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(10,l.time,!0),i.setUint16(12,l.date,!0),i.setUint32(14,e.crc32,!0),i.setUint32(18,e.compressedSize,!0),i.setUint32(22,e.uncompressedSize,!0),i.setUint16(26,t.length,!0),i.setUint16(28,0,!0),s.set(t,30),n}#r(e){const t=new TextEncoder().encode(e.fileName),a=46+t.length,n=new ArrayBuffer(a),i=new DataView(n),s=new Uint8Array(n);i.setUint32(0,33639248,!0),i.setUint16(4,20,!0),i.setUint16(6,20,!0),i.setUint16(8,0,!0),i.setUint16(10,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(12,l.time,!0),i.setUint16(14,l.date,!0),i.setUint32(16,e.crc32,!0),i.setUint32(20,e.compressedSize,!0),i.setUint32(24,e.uncompressedSize,!0),i.setUint16(28,t.length,!0),i.setUint16(30,0,!0),i.setUint16(32,0,!0),i.setUint16(34,0,!0),i.setUint16(36,0,!0),i.setUint32(38,0,!0),i.setUint32(42,e.localHeaderOffset,!0),s.set(t,46),n}#a(e,t,a){const n=new ArrayBuffer(22),i=new DataView(n);return i.setUint32(0,101010256,!0),i.setUint16(4,0,!0),i.setUint16(6,0,!0),i.setUint16(8,e,!0),i.setUint16(10,e,!0),i.setUint32(12,t,!0),i.setUint32(16,a,!0),i.setUint16(20,0,!0),n}#n(e){const t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),i=e.getHours(),s=e.getMinutes(),l=Math.floor(e.getSeconds()/2),d=t-1980<<9|a<<5|n,u=i<<11|s<<5|l;return{date:d,time:u}}#s(e){const t=this.#i();let a=4294967295;for(let n=0;n<e.length;n++){const i=e[n];a=a>>>8^t[(a^i)&255]}return(a^4294967295)>>>0}#i(){if(Jn._crcTable.length===0){const e=Array.from({length:256},()=>0);for(let t=0;t<256;t++){let a=t;for(let n=0;n<8;n++)a=a&1?3988292384^a>>>1:a>>>1;e[t]=a}Jn._crcTable=e}return Jn._crcTable}clear(){return this.#e=[],this}get fileCount(){return this.#e.length}getFileNames(){return this.#e.map(e=>e.fileName)}}const $r="locales";function Dd(){return new Rd}class Rd{storage=Ut.getInstance();async needsUpdate(){return!0}async extractTranslations(){let e=globalThis.__EDITME_I18N_BUNDLE__,t;if(e)try{const n=e.split(",")[1];if(!n)throw new Error("Invalid data URL format: missing base64 data");const i=atob(n),s=new Uint8Array(i.length);for(let l=0;l<i.length;l++)s[l]=i.charCodeAt(l);t=s.buffer}catch(n){throw new Error(`Failed to decode embedded translation data: ${n instanceof Error?n.message:"Unknown error"}`)}finally{delete globalThis.__EDITME_I18N_BUNDLE__}else try{const n=await fetch("/i18n-bundle.zip");if(!n.ok)throw new Error(`Failed to fetch i18n-bundle.zip: ${n.status}`);t=await n.arrayBuffer()}catch{throw new Error('Translation data not found. For single file builds, please run "npm run build" to generate a new build with embedded translations.')}let a;try{a=new Dr(t)}catch(n){throw new Error(`Failed to parse ZIP archive: ${n instanceof Error?n.message:"Unknown error"}`)}this.storage.isInitialized()||await this.storage.init(),await this.storage.createWorkspace($r);for(const n of a.entries){if(!n.fileName.endsWith(".json"))continue;const s=await(await n.extract()).text();try{JSON.parse(s)}catch(l){throw new Error(`Invalid JSON in ${n.fileName}: ${l instanceof Error?l.message:"Unknown error"}`)}await this.storage.writeTextFile($r,n.fileName,s)}}async loadTranslations(){const e={};this.storage.isInitialized()||await this.storage.init();const a=(await this.storage.listFiles($r)).filter(n=>n.endsWith(".json"));for(const n of a)try{const i=await this.storage.readTextFile($r,n);let s;s=JSON.parse(i);const d=(n.split("/").pop()||n).replace(".json",""),u={locale:d,messages:this.extractMessages(s),headers:s[""]||{}};e[d]=u}catch{}return e}extractMessages(e){const t={};for(const[a,n]of Object.entries(e)){if(a==="")continue;const i=Array.isArray(n)?n[0]:n;typeof i=="string"&&(t[a]=i)}return t}}const At=Jt({currentLocale:Lr,locales:Mr,catalogs:{},initialized:!1,loading:!1}),_i=Ar(At,r=>r.currentLocale);Ar(At,r=>r.loading);Ar(At,r=>r.initialized);Ar(_i,r=>ka(r)?"rtl":"ltr");const oa={locale:"en",messages:{Save:"Save",Cancel:"Cancel",Delete:"Delete",Edit:"Edit",File:"File",Settings:"Settings",Workspace:"Workspace",Metadata:"Metadata",Manifest:"Manifest",Navigation:"Navigation","Spine Items":"Spine Items"},headers:{}},Ud=(r,e={})=>{const t=ln(At);let n=t.catalogs[t.currentLocale]?.messages[r];if(!n&&t.currentLocale!=="en"&&(n=t.catalogs.en?.messages[r]||oa.messages[r]),n||(n=r),Object.keys(e).length>0)for(const[i,s]of Object.entries(e))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(s));return n},pt=Ar(At,r=>(e,t={})=>{let n=r.catalogs[r.currentLocale]?.messages[e];if(!n&&r.currentLocale!=="en"&&(n=r.catalogs.en?.messages[e]||oa.messages[e]),n||(n=e),Object.keys(t).length>0)for(const[i,s]of Object.entries(t))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(s));return n});async function uo(){const r=ln(At);if(!(r.initialized||r.loading)){At.update(e=>({...e,loading:!0}));try{const e=Dd();await e.extractTranslations();const t=await e.loadTranslations();t.en||(t.en=oa);const a=Ed(),n=t[a]?a:Lr;typeof document<"u"&&(document.documentElement.setAttribute("data-dir",ka(n)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",n)),At.update(i=>({...i,currentLocale:n,catalogs:t,initialized:!0,loading:!1}))}catch(e){console.error("Failed to initialize i18n:",e),At.update(t=>({...t,currentLocale:Lr,catalogs:{en:oa},initialized:!0,loading:!1}))}}}async function Ad(r){const e=ln(At);if(!e.initialized)throw new Error("i18n system not initialized");if(!Mr[r])throw new Error(`Unsupported locale: ${r}`);e.catalogs[r]||console.warn(`Translation catalog for ${r} not loaded, falling back to English`),typeof document<"u"&&(document.documentElement.setAttribute("data-dir",ka(r)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",r)),typeof localStorage<"u"&&localStorage.setItem("editme-locale",r),At.update(t=>({...t,currentLocale:r}))}function Od(){const r=ln(At);return Object.keys(r.locales).map(e=>r.locales[e])}const fo={translate:Ud,getCurrentLocale:()=>ln(_i),setLocale:Ad,getAvailableLocales:Od,hasTranslation:(r,e)=>!!ln(At).catalogs[r]?.messages[e],isLocaleSupported:r=>!!Mr[r],isRTL:ka,getCatalogs:()=>ln(At).catalogs,isInitialized:()=>ln(At).initialized,init:uo},Hr="editme_theme_preference",zd={current:"light",systemPreference:"light",isInitialized:!1};function Wd(){const{subscribe:r,set:e,update:t}=Jt(zd);return{subscribe:r,set:e,update:t,initialize(){let a=null,n="light";typeof window<"u"&&window.matchMedia&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");try{const s=localStorage.getItem(Hr);s&&Nd(s)&&(a=s)}catch(s){console.warn("Failed to load theme preference:",s)}const i=a||n;t(s=>({...s,current:i,systemPreference:n,isInitialized:!0})),hr(i),typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{const d=l.matches?"dark":"light";t(u=>({...u,systemPreference:d})),a||(t(u=>({...u,current:d})),hr(d))})},setTheme(a){t(n=>{try{localStorage.setItem(Hr,a)}catch(i){console.warn("Failed to save theme preference:",i)}return hr(a),{...n,current:a}})},toggleTheme(){t(a=>{const n=a.current==="light"?"dark":"light";try{localStorage.setItem(Hr,n)}catch(i){console.warn("Failed to save theme preference:",i)}return hr(n),{...a,current:n}})},useSystemPreference(){t(a=>{try{localStorage.removeItem(Hr)}catch(n){console.warn("Failed to clear theme preference:",n)}return hr(a.systemPreference),{...a,current:a.systemPreference}})},getCurrentTheme(){return ln({subscribe:r}).current}}}function Nd(r){return r==="light"||r==="dark"}function hr(r){typeof document<"u"&&document.documentElement.setAttribute("data-theme",r)}const la=Wd();typeof window<"u"&&la.initialize();var jd=js('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>'),Bd=js('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),$d=P('<span class="theme-toggle__label svelte-v7l3jb"> </span>'),Hd=P('<button aria-label="Toggle theme"><span class="theme-toggle__icon svelte-v7l3jb" aria-hidden="true"><!></span> <!></button>');function Ki(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(la,"$themeStore",t),i=Ne(),s=Ne();let l=B(e,"size",8,"medium"),d=B(e,"showLabel",8,!0);function u(){la.toggleTheme()}ft(()=>n(),()=>{y(i,n().current)}),ft(()=>o(i),()=>{y(s,o(i)==="dark")}),Mt(),gt();var c=Hd();let p;c.__click=u;var h=f(c),v=f(h);{var m=I=>{var C=jd();_(I,C)},w=I=>{var C=Bd();_(I,C)};j(v,I=>{o(s)?I(m):I(w,!1)})}var b=g(h,2);{var k=I=>{var C=$d(),L=f(C);R(()=>x(L,o(s)?"Light":"Dark")),_(I,C)};j(b,I=>{d()&&I(k)})}R(I=>{p=st(c,1,"theme-toggle svelte-v7l3jb",null,p,I),pe(c,"title",`Switch to ${o(s)?"light":"dark"} theme`)},[()=>({"theme-toggle--small":l()==="small","theme-toggle--large":l()==="large"})],de),_(r,c),et(),a()}_t(["click"]);function qd(){An.toggleSidebar()}function Yi(){const r=new CustomEvent("append-spine-item",{bubbles:!0});window.dispatchEvent(r)}var Vd=P('<h2 class="sidebar-title svelte-qtftjm">SEED.html</h2> <div class="header-actions svelte-qtftjm"><!></div>',1),Gd=P('<div class="header-actions compact svelte-qtftjm"><!></div>'),Xd=(r,e,t)=>e(o(t).id),Kd=P('<button><span class="section-label svelte-qtftjm"><!></span></button>'),Yd=P('<div><span class="section-label svelte-qtftjm"> </span> <button><span class="append-icon svelte-qtftjm">+</span></button></div>'),Jd=P('<div><span class="section-label svelte-qtftjm"> </span> <button><span class="append-icon svelte-qtftjm">+</span></button></div>'),Zd=(r,e,t)=>e(t.id),Qd=P('<aside><div class="sidebar-header svelte-qtftjm"><button class="sidebar-toggle svelte-qtftjm"> </button> <!></div> <div class="sidebar-main svelte-qtftjm"><nav class="sidebar-nav svelte-qtftjm"><!> <!></nav> <div class="spine-items-container svelte-qtftjm"><!></div> <div class="section-content"><!> <!> <!> <!> <!> <!></div></div> <div class="sidebar-footer svelte-qtftjm"><button><span class="section-label svelte-qtftjm"><!></span></button></div></aside>');function eu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"isExpanded",8,!0),s=B(e,"activeSection",8,"workspace"),l=B(e,"hasWorkspace",8,!1);const d=[{id:"about",icon:"â¹ï¸",label:n()("About")},{id:"workspace",icon:"ð ",label:n()("Projects")},{id:"metadata",icon:"ð",label:n()("Metadata")},{id:"manifest",icon:"ð",label:n()("Manifest")},{id:"navigation",icon:"ð",label:n()("Navigation")}],u={id:"settings",icon:"âï¸",label:n()("Settings")};function c(Z){!l()&&Z!=="about"&&Z!=="workspace"&&Z!=="settings"||An.setSidebarSection(Z)}function p(Z){return!l()&&Z!=="about"&&Z!=="workspace"&&Z!=="settings"}function h(Z){return Z.slice(0,2).toUpperCase()}gt();var v=Qd();let m;var w=f(v),b=f(w);b.__click=[qd];var k=f(b),I=g(b,2);{var C=Z=>{var ue=Vd(),Fe=g(Ze(ue),2),je=f(Fe);Ki(je,{size:"small",showLabel:!1}),_(Z,ue)},L=Z=>{var ue=Gd(),Fe=f(ue);Ki(Fe,{size:"small",showLabel:!1}),_(Z,ue)};j(I,Z=>{i()?Z(C):Z(L,!1)})}var E=g(w,2),N=f(E),z=f(N);kt(z,1,()=>d,It,(Z,ue)=>{var Fe=Kd();let je;Fe.__click=[Xd,c,ue];var Ge=f(Fe),ne=f(Ge);{var be=_e=>{var Pe=Et();R($e=>x(Pe,$e),[()=>n()(o(ue).label)],de),_(_e,Pe)},me=_e=>{var Pe=Et();R($e=>x(Pe,$e),[()=>h(n()(o(ue).label))],de),_(_e,Pe)};j(ne,_e=>{i()?_e(be):_e(me,!1)})}R((_e,Pe,$e)=>{je=st(Fe,1,"sidebar-section svelte-qtftjm",null,je,_e),Fe.disabled=Pe,pe(Fe,"aria-current",s()===o(ue).id?"page":void 0),pe(Fe,"title",$e)},[()=>({active:s()===o(ue).id,disabled:p(o(ue).id)}),()=>p(o(ue).id),()=>n()(o(ue).label)],de),_(Z,Fe)});var H=g(z,2);{var W=Z=>{var ue=Yd();let Fe;var je=f(ue),Ge=f(je),ne=g(je,2);let be;ne.__click=[Yi],R((me,_e,Pe,$e,He)=>{Fe=st(ue,1,"spine-section-header svelte-qtftjm",null,Fe,me),x(Ge,_e),be=st(ne,1,"append-button-nav svelte-qtftjm",null,be,Pe),ne.disabled=!l(),pe(ne,"aria-label",$e),pe(ne,"title",He)},[()=>({disabled:!l()}),()=>n()("Spine Items"),()=>({disabled:!l()}),()=>n()("Append Item"),()=>n()("Append Item")],de),_(Z,ue)},O=Z=>{var ue=Jd();let Fe;var je=f(ue),Ge=f(je),ne=g(je,2);let be;ne.__click=[Yi],R((me,_e,Pe,$e,He)=>{Fe=st(ue,1,"spine-section-header compact svelte-qtftjm",null,Fe,me),x(Ge,_e),be=st(ne,1,"append-button-nav compact svelte-qtftjm",null,be,Pe),ne.disabled=!l(),pe(ne,"aria-label",$e),pe(ne,"title",He)},[()=>({disabled:!l()}),()=>h(n()("Spine Items")),()=>({disabled:!l()}),()=>n()("Append Item"),()=>n()("Append Item")],de),_(Z,ue)};j(H,Z=>{i()?Z(W):Z(O,!1)})}var T=g(N,2),G=f(T);St(G,e,"sidebar-spine",{});var U=g(T,2),F=f(U);St(F,e,"sidebar-about",{});var D=g(F,2);St(D,e,"sidebar-workspace",{});var M=g(D,2);St(M,e,"sidebar-metadata",{});var le=g(M,2);St(le,e,"sidebar-manifest",{});var J=g(le,2);St(J,e,"sidebar-navigation",{});var ge=g(J,2);St(ge,e,"sidebar-settings",{});var X=g(E,2),we=f(X);let he;we.__click=[Zd,c,u];var Ce=f(we),se=f(Ce);{var Q=Z=>{var ue=Et();R(Fe=>x(ue,Fe),[()=>n()(u.label)],de),_(Z,ue)},ve=Z=>{var ue=Et();R(Fe=>x(ue,Fe),[()=>h(n()(u.label))],de),_(Z,ue)};j(se,Z=>{i()?Z(Q):Z(ve,!1)})}R((Z,ue,Fe,je,Ge)=>{m=st(v,1,"sidebar svelte-qtftjm",null,m,Z),pe(b,"aria-expanded",i()),pe(b,"aria-label",ue),x(k,i()?"âï¸":"â¶ï¸"),pe(N,"aria-label",Fe),he=st(we,1,"sidebar-section svelte-qtftjm",null,he,je),pe(we,"aria-current",s()===u.id?"page":void 0),pe(we,"title",Ge)},[()=>({collapsed:!i()}),()=>n()("Toggle sidebar"),()=>n()("Main navigation"),()=>({active:s()===u.id}),()=>n()(u.label)],de),_(r,v),et(),a()}_t(["click"]);var tu=P('<div class="pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),nu=P('<div class="pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),ru=P("<!> <!> <!>",1),au=P('<div class="single-pane-container svelte-1b458cb"><div class="pane-header svelte-1b458cb"><!></div> <div class="pane-content svelte-1b458cb"><!></div></div>'),iu=P('<div class="app-layout svelte-1b458cb"><!> <div class="main-content svelte-1b458cb"><!></div></div>');function su(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(An,"$layoutStore",t),i=Ne(),s=Ne(),l=Ne();let d=B(e,"hasWorkspace",8,!1);ft(()=>(o(i),n()),()=>{(w=>{y(i,w.sidebar)})(n())}),ft(()=>o(i),()=>{y(s,o(i).isExpanded?"250px":"48px")}),ft(()=>o(i),()=>{y(l,o(i).activeSection!=="workspace"&&o(i).activeSection!=="settings")}),Mt();var u=iu(),c=f(u);eu(c,{get isExpanded(){return o(i).isExpanded},get activeSection(){return o(i).activeSection},get hasWorkspace(){return d()},$$slots:{"sidebar-workspace":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-workspace",{}),_(w,k)},"sidebar-metadata":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-metadata",{}),_(w,k)},"sidebar-manifest":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-manifest",{}),_(w,k)},"sidebar-navigation":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-navigation",{}),_(w,k)},"sidebar-spine":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-spine",{}),_(w,k)},"sidebar-settings":(w,b)=>{var k=ht(),I=Ze(k);St(I,e,"sidebar-settings",{}),_(w,k)}}});var p=g(c,2),h=f(p);{var v=w=>{gd(w,{direction:"horizontal",autoSaveId:"editme-content-panes",children:(b,k)=>{var I=ru(),C=Ze(I);Xi(C,{defaultSize:50,minSize:25,children:(N,z)=>{var H=tu(),W=f(H),O=f(W);St(O,e,"left-header",{});var T=g(W,2),G=f(T);St(G,e,"left-content",{}),_(N,H)},$$slots:{default:!0}});var L=g(C,2);bd(L,{});var E=g(L,2);Xi(E,{defaultSize:50,minSize:20,children:(N,z)=>{var H=nu(),W=f(H),O=f(W);St(O,e,"right-header",{});var T=g(W,2),G=f(T);St(G,e,"right-content",{}),_(N,H)},$$slots:{default:!0}}),_(b,I)},$$slots:{default:!0}})},m=w=>{var b=au(),k=f(b),I=f(k);St(I,e,"left-header",{});var C=g(k,2),L=f(C);St(L,e,"left-content",{}),_(w,b)};j(h,w=>{o(l)?w(v):w(m,!1)})}R(()=>li(u,`grid-template-columns: ${o(s)??""} 1fr`)),_(r,u),et(),a()}const Fn={CURRENT_VIEW:"editme_nav_current_view",VIEW_HISTORY:"editme_nav_view_history",VIEW_DATA:"editme_nav_view_data"},ou=20,Oa={currentView:"about",previousView:null,viewHistory:["about"],viewData:{},isTransitioning:!1,canNavigateBack:!1,canNavigateForward:!1},lu=["about","workspace","metadata","manifest","navigation","spine","settings"];function cu(){const{subscribe:r,set:e,update:t}=Jt(Oa),a={guards:new Map,nextId:1};let n=0;return{subscribe:r,set:e,update:t,initialize(){let p=Oa.currentView,h=[...Oa.viewHistory],v={};try{const b=localStorage.getItem(Fn.CURRENT_VIEW);b&&s(b)&&(p=b);const k=localStorage.getItem(Fn.VIEW_HISTORY);if(k){const C=JSON.parse(k);Array.isArray(C)&&C.every(s)&&(h=C)}const I=localStorage.getItem(Fn.VIEW_DATA);if(I){const C=JSON.parse(I);typeof C=="object"&&C!==null&&(v=C)}}catch(b){console.warn("Failed to load navigation state:",b)}n=h.length-1;const m=n>0,w=!1;t(b=>({...b,currentView:p,previousView:h.length>1?h[h.length-2]:null,viewHistory:h,viewData:v,canNavigateBack:m,canNavigateForward:w,isInitialized:!0})),c(p),An.subscribe(({sidebar:b})=>{let k=null;this.subscribe(C=>{k=C.currentView})(),b.activeSection!==k&&(navigator.userAgent.includes("Firefox")?queueMicrotask(()=>{this.navigateTo(b.activeSection,{replaceHistory:!0})}):this.navigateTo(b.activeSection,{replaceHistory:!0}))})},async navigateTo(p,h={}){if(!s(p))return console.error("Invalid view type:",p),!1;const v=i();if(v.currentView===p&&!h.force)return!0;t(m=>({...m,isTransitioning:!0}));try{if(!h.force&&!await l(v.currentView,p))return t(w=>({...w,isTransitioning:!1})),!1;if(v.currentView==="spine"&&p!=="spine"){const m=new CustomEvent("clear-spine-selection");window.dispatchEvent(m)}return await d(p,h),!0}catch(m){return console.error("Navigation error:",m),t(w=>({...w,isTransitioning:!1})),!1}},async canNavigate(p){const h=i(),v=p||h.currentView;if(!s(v))return!1;try{return await l(h.currentView,v)}catch(m){return console.error("Guard execution error:",m),!1}},async goBack(){const p=i();if(!p.canNavigateBack||n<=0)return!1;const h=p.viewHistory[n-1];return!h||!await l(p.currentView,h)?!1:(n--,await u(h,{isHistoryNavigation:!0}),!0)},async goForward(){const p=i();if(!p.canNavigateForward||n>=p.viewHistory.length-1)return!1;const h=p.viewHistory[n+1];return!h||!await l(p.currentView,h)?!1:(n++,await u(h,{isHistoryNavigation:!0}),!0)},setViewData(p,h){if(!s(p)){console.error("Invalid view type for setViewData:",p);return}t(v=>{const m={...v.viewData,[p]:h};try{localStorage.setItem(Fn.VIEW_DATA,JSON.stringify(m))}catch(w){console.warn("Failed to save view data:",w)}return{...v,viewData:m}})},getViewData(p){return s(p)?i().viewData[p]||null:(console.error("Invalid view type for getViewData:",p),null)},clearViewData(p){if(!s(p)){console.error("Invalid view type for clearViewData:",p);return}t(h=>{const v={...h.viewData};delete v[p];try{localStorage.setItem(Fn.VIEW_DATA,JSON.stringify(v))}catch(m){console.warn("Failed to save view data:",m)}return{...h,viewData:v}})},addNavigationGuard(p){const h=`guard_${a.nextId++}`;return a.guards.set(h,p),h},removeNavigationGuard(p){return a.guards.delete(p)}};function i(){let p;return r(h=>p=h)(),p}function s(p){return lu.includes(p)}async function l(p,h){const v=Array.from(a.guards.values());for(const m of v)try{if(!await m(p,h))return!1}catch(w){return console.error("Navigation guard error:",w),!1}return!0}async function d(p,h){const v=i();h.viewData&&t(w=>({...w,viewData:{...w.viewData,[p]:h.viewData}}));let m=[...v.viewHistory];h.replaceHistory?(m[m.length-1]=p,n=m.length-1):(m=m.slice(0,n+1),m.push(p),n=m.length-1,m.length>ou&&(m=m.slice(-20),n=m.length-1)),await u(p,{newHistory:m})}async function u(p,h={}){const v=i(),m=h.newHistory||v.viewHistory,w=n>0,b=n<m.length-1;t(k=>({...k,currentView:p,previousView:k.currentView,viewHistory:m,canNavigateBack:w,canNavigateForward:b,isTransitioning:!1}));try{localStorage.setItem(Fn.CURRENT_VIEW,p),localStorage.setItem(Fn.VIEW_HISTORY,JSON.stringify(m))}catch(k){console.warn("Failed to save navigation state:",k)}h.isHistoryNavigation||c(p)}function c(p){try{An.setSidebarSection(p)}catch(h){console.warn("Failed to sync to layout store:",h)}}}const bt=cu();typeof window<"u"&&bt.initialize();const du=`SEED.html Freeware - License

This software is provided free of charge for personal, non-commercial use only.
You may not otherwise use this software without obtaining a separate commercial license agreement with the author.
You may not modify, decompile or reverse-engineer this software.
You may redistribute this software provided this license agreement and copyright notice are included in all copies.
The software is provided "as is" without warranty of any kind.
The author is not liable for any damages arising from its use.
Endangered Language Exception: This software can be used to create an EPUB file in which the majority of content is in an endangered language for any purpose without obtaining a seperate commercial license.

(c) 2025 Stewart Haines
`;var uu=P('<div class="about-view svelte-wc4a07"><div class="about-content svelte-wc4a07"><header class="about-header svelte-wc4a07"><h1 class="app-title svelte-wc4a07"> </h1> <p class="app-version svelte-wc4a07"> </p></header> <section class="about-section svelte-wc4a07"><h2 class="svelte-wc4a07"> </h2> <p class="svelte-wc4a07"> </p> <p class="svelte-wc4a07"><a href="https://stewarthaines.com/epub" target="_blank" rel="noopener noreferrer" class="external-link svelte-wc4a07"> </a></p> <p class="svelte-wc4a07"> </p></section> <section class="about-section svelte-wc4a07"><h2 class="svelte-wc4a07"> </h2> <pre class="license-text svelte-wc4a07"> </pre></section></div></div>');function fu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i="0.4.0";gt();var s=uu(),l=f(s),d=f(l),u=f(d),c=f(u),p=g(u,2),h=f(p),v=g(d,2),m=f(v),w=f(m),b=g(m,2),k=f(b),I=g(b,2),C=f(I),L=f(C),E=g(I,2),N=f(E),z=g(v,2),H=f(z),W=f(H),O=g(H,2),T=f(O);R((G,U,F,D,M,le,J)=>{x(c,G),x(h,`${U??""}: ${i}`),x(w,F),x(k,D),x(L,M),x(N,le),x(W,J),x(T,du)},[()=>n()("about.subtitle"),()=>n()("about.version"),()=>n()("about.description.title"),()=>n()("about.description.content"),()=>n()("about.website.link"),()=>n()("about.attribution.content"),()=>n()("about.license.title")],de),_(r,s),et(),a()}var pu=P('<span class="library-version svelte-3a2w4e"> </span>'),hu=P('<div class="library-item svelte-3a2w4e"><h3 class="library-name svelte-3a2w4e"><a target="_blank" rel="noopener noreferrer" class="external-link svelte-3a2w4e"> </a> <!></h3> <p class="library-description svelte-3a2w4e"> </p> <p class="library-copyright svelte-3a2w4e"> </p></div>'),vu=P('<div class="thirdparty-view svelte-3a2w4e"><div class="thirdparty-content svelte-3a2w4e"><header class="thirdparty-header svelte-3a2w4e"><h1 class="svelte-3a2w4e"> </h1> <p class="thirdparty-intro svelte-3a2w4e"> </p></header> <section class="libraries-section svelte-3a2w4e"><div class="library-list svelte-3a2w4e"></div> <div class="mit-license-section svelte-3a2w4e"><h3 class="svelte-3a2w4e"> </h3> <pre class="license-text svelte-3a2w4e"></pre></div></section></div></div>');function mu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=[{name:"Svelte",version:"^5.28.1",license:"MIT",url:"https://github.com/sveltejs/svelte",description:"Cybernetically enhanced web apps",copyright:"Copyright (c) 2016-present, sveltejs"},{name:"paneforge",version:"^1.0.0",license:"MIT",url:"https://github.com/svecosystem/paneforge",description:"Headless pane management for Svelte",copyright:"Copyright (c) 2024 Hunter Johnston <https://github.com/huntabyte> Copyright (c) 2023 Brian Vaughn <https://github.com/bvaughn>"},{name:"ndesmic/zip",version:"N/A",license:"MIT",url:"https://github.com/ndesmic/zip",description:"Browser-native ZIP implementation (substantial portions used)",copyright:"Copyright (c) 2021 ndesmic"}];gt();var s=vu(),l=f(s),d=f(l),u=f(d),c=f(u),p=g(u,2),h=f(p),v=g(d,2),m=f(v);kt(m,5,()=>i,It,(C,L)=>{var E=hu(),N=f(E),z=f(N),H=f(z),W=g(z,2);{var O=D=>{var M=pu(),le=f(M);R(()=>x(le,`v${o(L).version??""}`)),_(D,M)};j(W,D=>{o(L).version!=="N/A"&&D(O)})}var T=g(N,2),G=f(T),U=g(T,2),F=f(U);R(()=>{pe(z,"href",o(L).url),x(H,o(L).name),x(G,o(L).description),x(F,o(L).copyright)}),_(C,E)});var w=g(m,2),b=f(w),k=f(b),I=g(b,2);I.textContent=`MIT License

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`,R((C,L,E)=>{x(c,C),x(h,L),x(k,`${E??""}: MIT`)},[()=>n()("about.thirdparty.title"),()=>n()("about.thirdparty.intro"),()=>n()("about.thirdparty.license")],de),_(r,s),et(),a()}const gu=(r,e)=>{console.log("ð¯ WorkspaceActionBar: Create New button clicked!"),e("createNewRequested"),console.log("ð¯ WorkspaceActionBar: createNewRequested event dispatched")},wu=(r,e)=>{e("loadEpubRequested")};var yu=P('<div class="workspace-action-bar svelte-4wg9d"><h3 class="section-title svelte-4wg9d"> </h3> <div class="action-buttons svelte-4wg9d"><button type="button" class="action-button primary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">â</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button> <button type="button" class="action-button secondary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">ð</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button></div></div>');function bu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Lt();let s=B(e,"isLoading",8,!1);gt();var l=yu(),d=f(l),u=f(d),c=g(d,2),p=f(c);p.__click=[gu,i];var h=g(f(p),2),v=f(h),m=f(v),w=g(v,2),b=f(w),k=g(p,2);k.__click=[wu,i];var I=g(f(k),2),C=f(I),L=f(C),E=g(C,2),N=f(E);R((z,H,W,O,T,G,U)=>{x(u,z),p.disabled=s(),pe(p,"aria-label",H),x(m,W),x(b,O),k.disabled=s(),pe(k,"aria-label",T),x(L,G),x(N,U)},[()=>n()("Get Started"),()=>n()("Create a new minimal EPUB project"),()=>n()("Create New"),()=>n()("Start fresh"),()=>n()("Load an existing EPUB file for editing"),()=>n()("Load EPUB"),()=>n()("Edit existing file")],de),_(r,l),et(),a()}_t(["click"]);const xu=(r,e,t)=>{r.stopPropagation(),e("deleteRequested",{workspaceId:t().id})},_u=(r,e)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e())};var Su=P('<span class="workspace-icon error svelte-ijd5ei">â ï¸</span>'),Eu=P('<span class="workspace-icon svelte-ijd5ei" aria-hidden="true">ð</span>'),ku=P('<span class="workspace-author-inline svelte-ijd5ei"> </span>'),Tu=P('<span class="current-badge svelte-ijd5ei"> </span>'),Cu=P('<div role="button" tabindex="0"><div class="workspace-main svelte-ijd5ei"><div class="workspace-icon-container svelte-ijd5ei"><!></div> <div class="workspace-info svelte-ijd5ei"><div class="workspace-header svelte-ijd5ei"><h3 class="workspace-title svelte-ijd5ei"> <!> <!></h3> <span class="workspace-time svelte-ijd5ei"> </span></div> <div class="workspace-meta svelte-ijd5ei"><span class="workspace-language svelte-ijd5ei"> </span> <span class="meta-separator svelte-ijd5ei">â¢</span> <span class="workspace-stats svelte-ijd5ei"> <!> <!></span></div></div></div> <div class="workspace-actions svelte-ijd5ei"><button type="button" class="delete-button svelte-ijd5ei"><span aria-hidden="true">ðï¸</span></button></div></div>');function Iu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Lt();let s=B(e,"workspace",8),l=B(e,"isCurrent",8,!1),d=B(e,"hasError",8,!1);const u=()=>{i("selected",{workspaceId:s().id})},c=se=>{const ve=new Date().getTime()-se.getTime(),Z=Math.floor(ve/(1e3*60*60)),ue=Math.floor(Z/24);return Z<1?n()("Just now"):Z<24?n()("{count}h ago",{count:Z}):ue===1?n()("1 day ago"):ue<7?n()("{count} days ago",{count:ue}):n()("{count}w ago",{count:Math.floor(ue/7)})},p=se=>{if(se===0)return"0 B";const Q=1024,ve=["B","KB","MB","GB"],Z=Math.floor(Math.log(se)/Math.log(Q));return parseFloat((se/Math.pow(Q,Z)).toFixed(1))+" "+ve[Z]};gt();var h=Cu();let v;h.__click=u,h.__keydown=[_u,u];var m=f(h),w=f(m),b=f(w);{var k=se=>{var Q=Su();R((ve,Z)=>{pe(Q,"aria-label",ve),pe(Q,"title",Z)},[()=>n()("Error"),()=>n()("Project has errors")],de),_(se,Q)},I=se=>{var Q=Eu();_(se,Q)};j(b,se=>{d()||s().hasError?se(k):se(I,!1)})}var C=g(w,2),L=f(C),E=f(L),N=f(E),z=g(N);{var H=se=>{var Q=ku(),ve=f(Q);R(()=>x(ve,`- ${s().author??""}`)),_(se,Q)};j(z,se=>{s().author&&se(H)})}var W=g(z,2);{var O=se=>{var Q=Tu(),ve=f(Q);R((Z,ue)=>{pe(Q,"aria-label",Z),x(ve,ue)},[()=>n()("Currently open"),()=>n()("Current")],de),_(se,Q)};j(W,se=>{l()&&se(O)})}var T=g(E,2),G=f(T),U=g(L,2),F=f(U),D=f(F),M=g(F,4),le=f(M),J=g(le);{var ge=se=>{var Q=Et();R(ve=>x(Q,`â¢ ${ve??""}`),[()=>p(s().totalSize)],de),_(se,Q)};j(J,se=>{s().totalSize>0&&se(ge)})}var X=g(J,2);{var we=se=>{var Q=Et();R(ve=>x(Q,`â¢ ${ve??""}`),[()=>s().extensionIds.join(", ")],de),_(se,Q)};j(X,se=>{s().extensionIds&&s().extensionIds.length>0&&se(we)})}var he=g(m,2),Ce=f(he);Ce.__click=[xu,i,s],R((se,Q,ve,Z,ue,Fe)=>{v=st(h,1,"workspace-item svelte-ijd5ei",null,v,se),pe(h,"aria-label",Q),x(N,`${s().title??""} `),x(G,ve),x(D,s().language),x(le,`${s().fileCount??""}
          ${Z??""} `),pe(Ce,"aria-label",ue),pe(Ce,"title",Fe)},[()=>({current:l(),error:d()||s().hasError}),()=>n()("Open project: {title}",{title:s().title}),()=>c(s().lastModified),()=>n()("files"),()=>n()("Delete project: {title}",{title:s().title}),()=>n()("Delete project")],de),_(r,h),et(),a()}_t(["click","keydown"]);var Fu=P('<button type="button" class="clear-search svelte-1r2ik5n">Ã</button>'),Pu=P('<div class="search-container svelte-1r2ik5n"><div class="search-input-wrapper svelte-1r2ik5n"><input type="search" class="search-input svelte-1r2ik5n"/> <!></div></div>'),Mu=P('<div class="loading-state svelte-1r2ik5n"><div class="skeleton-item svelte-1r2ik5n" aria-hidden="true"></div> <div class="skeleton-item svelte-1r2ik5n" aria-hidden="true"></div> <div class="skeleton-item svelte-1r2ik5n" aria-hidden="true"></div> <p class="loading-text svelte-1r2ik5n"> </p></div>'),Lu=P('<div class="empty-state svelte-1r2ik5n"><div class="empty-tips svelte-1r2ik5n"><h5 class="tips-title svelte-1r2ik5n"> </h5> <ul class="tips-list svelte-1r2ik5n"><li class="svelte-1r2ik5n"> </li> <li class="svelte-1r2ik5n"> </li> <li class="svelte-1r2ik5n"><!></li></ul></div></div>'),Du=P('<div class="no-results svelte-1r2ik5n"><div class="no-results-icon svelte-1r2ik5n" aria-hidden="true">ð</div> <h4 class="no-results-title svelte-1r2ik5n"> </h4> <p class="no-results-description svelte-1r2ik5n"> </p> <button type="button" class="clear-search-button svelte-1r2ik5n"> </button></div>'),Ru=P('<div class="search-results-info svelte-1r2ik5n"><p class="results-text svelte-1r2ik5n"> </p></div>'),Uu=P('<div class="workspace-grid svelte-1r2ik5n"></div> <!>',1),Au=P('<div class="workspace-list svelte-1r2ik5n"><div class="list-header svelte-1r2ik5n"><!></div> <div class="list-content svelte-1r2ik5n"><!></div></div>');function Ou(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne(),s=Ne(),l=Lt();let d=B(e,"workspaces",24,()=>[]),u=B(e,"currentWorkspaceId",8,null),c=B(e,"isLoading",8,!1),p=Ne("");const h=W=>{l("workspaceSelected",W.detail)},v=W=>{l("workspaceDeleted",W.detail)},m=W=>{l("packageRequested",W.detail)},w=W=>{const O=W.target;y(p,O.value)},b=()=>{y(p,"")};ft(()=>(rt(d()),o(p)),()=>{y(i,d().filter(W=>{if(!o(p))return!0;const O=o(p).toLowerCase();return W.title.toLowerCase().includes(O)||W.author?.toLowerCase().includes(O)||W.language.toLowerCase().includes(O)}))}),ft(()=>o(i),()=>{y(s,[...o(i)].sort((W,O)=>O.lastModified.getTime()-W.lastModified.getTime()))}),Mt(),gt();var k=Au(),I=f(k),C=f(I);{var L=W=>{var O=Pu(),T=f(O),G=f(T),U=g(G,2);{var F=D=>{var M=Fu();R(le=>pe(M,"aria-label",le),[()=>n()("Clear search")],de),Ke("click",M,b),_(D,M)};j(U,D=>{o(p)&&D(F)})}R((D,M)=>{pe(G,"placeholder",D),En(G,o(p)),pe(G,"aria-label",M)},[()=>n()("Search projectsâ¦"),()=>n()("Search projects")],de),Ke("input",G,w),_(W,O)};j(C,W=>{d().length>0&&W(L)})}var E=g(I,2),N=f(E);{var z=W=>{var O=Mu(),T=g(f(O),6),G=f(T);R(U=>x(G,U),[()=>n()("Loading projectsâ¦")],de),_(W,O)},H=(W,O)=>{{var T=U=>{var F=Lu(),D=f(F),M=f(D),le=f(M),J=g(M,2),ge=f(J),X=f(ge),we=g(ge,2),he=f(we),Ce=g(we,2),se=f(Ce);Xl(se,()=>n()("Download: Start with a sample from {link}",{link:`<a target="_blank" href="https://stewarthaines.com/epub">${n()("SEED.html home page")}</a>`})),R((Q,ve,Z)=>{x(le,Q),x(X,ve),x(he,Z)},[()=>n()("Quick Start Tips:"),()=>n()("Create New: Start with a minimal project"),()=>n()("Load EPUB: Load .epub file from the filesystem")],de),_(U,F)},G=(U,F)=>{{var D=le=>{var J=Du(),ge=g(f(J),2),X=f(ge),we=g(ge,2),he=f(we),Ce=g(we,2),se=f(Ce);R((Q,ve,Z)=>{x(X,Q),x(he,ve),x(se,Z)},[()=>n()("No projects found"),()=>n()('No projects match your search for "{query}"',{query:o(p)}),()=>n()("Clear search")],de),Ke("click",Ce,b),_(le,J)},M=le=>{var J=Uu(),ge=Ze(J);kt(ge,5,()=>o(s),he=>he.id,(he,Ce)=>{const se=de(()=>o(Ce).id===u()),Q=de(()=>o(Ce).hasError||!1);Iu(he,{get workspace(){return o(Ce)},get isCurrent(){return o(se)},get hasError(){return o(Q)},$$events:{selected:h,deleteRequested:v,packageRequested:m}})});var X=g(ge,2);{var we=he=>{var Ce=Ru(),se=f(Ce),Q=f(se);R(ve=>x(Q,ve),[()=>n()("Showing {filtered} of {total} workspaces",{filtered:o(i).length,total:d().length})],de),_(he,Ce)};j(X,he=>{o(p)&&o(i).length<d().length&&he(we)})}_(le,J)};j(U,le=>{o(i).length===0?le(D):le(M,!1)},F)}};j(W,U=>{d().length===0?U(T):U(G,!1)},O)}};j(N,W=>{c()?W(z):W(H,!1)})}_(r,k),et(),a()}function pn(){return new Date().toISOString().replace(/\.\d{3}Z$/,"Z")}class wt{static parseContainerXml(e){try{if(!globalThis.DOMParser)return{error:"DOMParser not available"};const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return{error:"Invalid XML in container.xml"};const i=a.querySelector("rootfile");if(!i)return{error:"No rootfile element found in container.xml"};const s=i.getAttribute("full-path");return s?s.endsWith(".opf")?{rootfilePath:s}:{error:`Rootfile does not appear to be an OPF file: ${s}`}:{error:"No full-path attribute found in rootfile element"}}catch(t){return{error:`Failed to parse container.xml: ${t instanceof Error?t.message:"Unknown error"}`}}}static validateXML(e){try{if(!globalThis.DOMParser)return{isValid:!1,error:"DOMParser not available"};const n=new DOMParser().parseFromString(e,"application/xml").querySelector("parsererror");return n?{isValid:!1,error:n.textContent||"Unknown XML parsing error"}:{isValid:!0}}catch(t){return{isValid:!1,error:t instanceof Error?t.message:"XML validation failed"}}}static parseOPFMetadata(e){const t="http://purl.org/dc/elements/1.1/",a=e.getElementsByTagNameNS(t,"title"),n=e.getElementsByTagNameNS(t,"language"),i=e.getElementsByTagNameNS(t,"identifier");if(a.length===0||!a[0].textContent?.trim())throw new Error("Missing required dc:title in OPF metadata");if(n.length===0||!n[0].textContent?.trim())throw new Error("Missing required dc:language in OPF metadata");if(i.length===0||!i[0].textContent?.trim())throw new Error("Missing required dc:identifier in OPF metadata");let s=e.getElementsByTagNameNS(t,"creator");s.length===0&&(s=e.querySelectorAll("dc\\:creator, creator"));let l=e.getElementsByTagNameNS(t,"contributor");l.length===0&&(l=e.querySelectorAll("dc\\:contributor, contributor"));let d=e.getElementsByTagNameNS(t,"subject");d.length===0&&(d=e.querySelectorAll("dc\\:subject, subject"));const u=e.getElementsByTagNameNS(t,"publisher"),c=e.getElementsByTagNameNS(t,"date"),p=e.getElementsByTagNameNS(t,"description"),h=e.getElementsByTagNameNS(t,"rights"),v=e.getElementsByTagNameNS(t,"source"),m=e.getElementsByTagNameNS(t,"relation"),w=e.getElementsByTagNameNS(t,"coverage"),b=e.getElementsByTagNameNS(t,"type"),k=e.getElementsByTagNameNS(t,"format"),I=e.querySelectorAll('meta[property="dcterms:modified"]'),C=Array.from(s).map(N=>N.textContent?.trim()).filter(Boolean),L=Array.from(l).map(N=>N.textContent?.trim()).filter(Boolean),E=Array.from(d).map(N=>N.textContent?.trim()).filter(Boolean);return{title:a[0].textContent.trim(),language:n[0].textContent.trim(),identifier:i[0].textContent.trim(),creator:C.length>0?C:void 0,contributor:L.length>0?L:void 0,publisher:u.length>0?u[0].textContent?.trim():void 0,date:c.length>0?c[0].textContent?.trim():void 0,description:p.length>0?p[0].textContent?.trim():void 0,subject:E.length>0?E:void 0,rights:h.length>0?h[0].textContent?.trim():void 0,source:v.length>0?v[0].textContent?.trim():void 0,relation:m.length>0?m[0].textContent?.trim():void 0,coverage:w.length>0?w[0].textContent?.trim():void 0,type:b.length>0?b[0].textContent?.trim():void 0,format:k.length>0?k[0].textContent?.trim():void 0,modifiedDate:I.length>0?I[0].textContent?.trim():void 0}}static parseOPFDocument(e){const t=this.validateXML(e);if(!t.isValid)throw new Error(`Invalid OPF XML: ${t.error}`);const n=new DOMParser().parseFromString(e,"application/xml"),s=n.querySelector("package")?.getAttribute("version")||"2.0",l=this.parseOPFMetadata(n),d=[];n.querySelectorAll("manifest item").forEach(m=>{const w=m.getAttribute("id"),b=m.getAttribute("href"),k=m.getAttribute("media-type");if(w&&b&&k){const I=m.getAttribute("properties"),C=m.getAttribute("fallback");d.push({id:w,href:b,mediaType:k,properties:I?I.split(" "):void 0,fallback:C||void 0})}});const c=[];n.querySelectorAll("spine itemref").forEach(m=>{const w=m.getAttribute("idref");if(w){const b=m.getAttribute("linear"),k=m.getAttribute("properties");c.push({idref:w,linear:b!=="no",properties:k?k.split(" "):void 0})}});const h=[];return n.querySelectorAll("guide reference").forEach(m=>{const w=m.getAttribute("type"),b=m.getAttribute("href");if(w&&b){const k=m.getAttribute("title");h.push({type:w,href:b,title:k||void 0})}}),{metadata:l,manifest:d,spine:c,guide:h.length>0?h:void 0,version:s}}static generateOPFXML(e){const{metadata:t,manifest:a,spine:n,guide:i,version:s}=e,l=c=>c.replace(/[<>&'"]/g,p=>{switch(p){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&apos;";default:return p}}),d=a.find(c=>c.id==="uuid")?.id||"uuid";let u=`<?xml version="1.0" encoding="utf-8"?>
<package version="${s}" xmlns="http://www.idpf.org/2007/opf" unique-identifier="${d}" prefix="ibooks: http://vocabulary.itunes.apple.com/rdf/ibooks/vocabulary-extensions-1.0/">
  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:ibooks="http://vocabulary.itunes.apple.com/rdf/ibooks/vocabularies/2012/01/ibooks-specific">
    <dc:title>${l(t.title)}</dc:title>
    <dc:language>${l(t.language)}</dc:language>
    <dc:identifier id="${d}">${l(t.identifier)}</dc:identifier>`;return t.creator&&t.creator.length>0&&t.creator.forEach(c=>{u+=`
    <dc:creator>${l(c)}</dc:creator>`}),t.contributor&&t.contributor.length>0&&t.contributor.forEach(c=>{u+=`
    <dc:contributor>${l(c)}</dc:contributor>`}),t.publisher&&(u+=`
    <dc:publisher>${l(t.publisher)}</dc:publisher>`),t.date&&(u+=`
    <dc:date>${l(t.date)}</dc:date>`),t.description&&(u+=`
    <dc:description>${l(t.description)}</dc:description>`),t.subject&&t.subject.length>0&&t.subject.forEach(c=>{u+=`
    <dc:subject>${l(c)}</dc:subject>`}),t.rights&&(u+=`
    <dc:rights>${l(t.rights)}</dc:rights>`),t.source&&(u+=`
    <dc:source>${l(t.source)}</dc:source>`),t.relation&&(u+=`
    <dc:relation>${l(t.relation)}</dc:relation>`),t.coverage&&(u+=`
    <dc:coverage>${l(t.coverage)}</dc:coverage>`),t.type&&(u+=`
    <dc:type>${l(t.type)}</dc:type>`),t.format&&(u+=`
    <dc:format>${l(t.format)}</dc:format>`),t.modifiedDate&&(u+=`
    <meta property="dcterms:modified">${l(t.modifiedDate)}</meta>`),u+=`
    <meta property="ibooks:specified-fonts">true</meta>`,u+=`
  </metadata>
  <manifest>`,a.forEach(c=>{u+=`
    <item id="${l(c.id)}" href="${l(c.href)}" media-type="${l(c.mediaType)}"`,c.properties&&c.properties.length>0&&(u+=` properties="${l(c.properties.join(" "))}"`),c.fallback&&(u+=` fallback="${l(c.fallback)}"`),u+=" />"}),u+=`
  </manifest>
  <spine>`,n.forEach(c=>{u+=`
    <itemref idref="${l(c.idref)}"`,c.linear===!1&&(u+=' linear="no"'),c.properties&&c.properties.length>0&&(u+=` properties="${l(c.properties.join(" "))}"`),u+=" />"}),u+=`
  </spine>`,i&&i.length>0&&(u+=`
  <guide>`,i.forEach(c=>{u+=`
    <reference type="${l(c.type)}" href="${l(c.href)}"`,c.title&&(u+=` title="${l(c.title)}"`),u+=" />"}),u+=`
  </guide>`),u+=`
</package>`,u}static detectEPUBVersion(e){try{if(!globalThis.DOMParser)return;const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return;const i=a.querySelector("package");if(i){const s=i.getAttribute("version");if(s)return s.startsWith("2.")?"EPUB 2.0":s.startsWith("3.")?"EPUB 3.0":`EPUB ${s}`}return a.querySelector("[properties]")||a.querySelector("[epub\\:type]")?"EPUB 3.0":"EPUB 2.0"}catch{return}}static parseRootfilePath(e){const t=e.match(/<rootfile[^>]+full-path\s*=\s*["']([^"']+)["'][^>]*>/i);if(!t)throw new Error("Could not find rootfile path in container.xml");return t[1]}static generateContainerXML(e="OEBPS/content.opf"){return`<?xml version="1.0" encoding="UTF-8"?>
<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">
  <rootfiles>
    <rootfile full-path="${e}" media-type="application/oebps-package+xml"/>
  </rootfiles>
</container>`}static validateManifestSpineConsistency(e,t){const a=[],n=new Set(e.map(i=>i.id));return t.forEach((i,s)=>{n.has(i.idref)||a.push(`Spine item ${s} references non-existent manifest item: ${i.idref}`)}),a}}const zu={"application/xhtml+xml":"Text/","text/html":"Text/","text/css":"Styles/","text/javascript":"Scripts/","application/javascript":"Scripts/","image/jpeg":"Images/","image/png":"Images/","image/gif":"Images/","image/svg+xml":"Images/","image/webp":"Images/","audio/mpeg":"Audio/","audio/ogg":"Audio/","audio/wav":"Audio/","audio/mp4":"Audio/","video/mp4":"Video/","video/webm":"Video/","video/ogg":"Video/","font/ttf":"Fonts/","font/otf":"Fonts/","font/woff":"Fonts/","font/woff2":"Fonts/","application/font-woff":"Fonts/","application/pdf":"Misc/","text/plain":"Text/"};function Wu(r){const e=r.split(";")[0].trim().toLowerCase();return zu[e]||""}function Ka(r,e){return Wu(e)+r}class Si{static getArrayField(e,t){const a=e[t];return Array.isArray(a)?a:[]}static getStringField(e,t){const a=e[t];return typeof a=="string"?a:void 0}static getRequiredStringField(e,t){const a=e[t];return typeof a=="string"?a:""}static isArrayField(e){return["creator","contributor","subject","accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard"].includes(e)}static isStringField(e){return["title","language","identifier","publisher","date","description","rights","source","relation","coverage","type","format","modifiedDate","epubVersion","renditionLayout","pageProgressionDirection","renditionOrientation","renditionSpread","accessibilitySummary"].includes(e)}static updateArrayField(e,t,a){const n=Si.getArrayField(e,t),i=a(n);return{...e,[t]:i}}static updateStringField(e,t,a){return{...e,[t]:a}}}const Nu={html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",css:"text/css",js:"application/javascript",txt:"text/plain",json:"application/json",opf:"application/oebps-package+xml",ncx:"application/x-dtbncx+xml",epub:"application/epub+zip",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",gz:"application/gzip",zip:"application/zip"};function po(r){const e=r.split(".").pop()?.toLowerCase();return Nu[e||""]||"application/octet-stream"}function ho(r){const e=r.startsWith("SOURCE/")?r.substring(7):r;return e==="settings.json"?"settings":e.startsWith("text/")?"text":e.startsWith("scripts/")?"script":e.startsWith("extensions/")?"extension":"other"}function ju(r){if(!r||typeof r!="string"||r.trim()==="")return!1;let e=r.trim();if(e=e.replace(/\\/g,"/"),!e.startsWith("SOURCE/")||e.startsWith("/")||/^[A-Za-z]:/.test(e)||e.includes(".."))return!1;const t=e.split("/").pop()?.toLowerCase()||"",a=["con","aux","prn","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],n=t.split(".")[0];return!(a.includes(n)||t===".ds_store"||t==="thumbs.db")}function Yn(r){return!r||typeof r!="string"?!1:r.startsWith("SOURCE/")&&r.length>7}function Bu(r){const e={isValid:!0,errors:[],warnings:[]};if(!r||r.trim()==="")return e.isValid=!1,e.errors.push("Empty settings"),e;let t;try{t=JSON.parse(r)}catch(i){e.isValid=!1;const s=`Invalid JSON syntax: ${i}`;return e.errors.push(s),e}const a=["version"];for(const i of a)i in t?(t[i]===null||t[i]===void 0)&&(e.isValid=!1,e.errors.push(`Field '${i}' cannot be null or undefined`)):(e.isValid=!1,e.errors.push(`Missing required field: ${i}`));"is_draft"in t&&typeof t.is_draft!="boolean"&&(e.isValid=!1,e.errors.push('Field "is_draft" must be a boolean')),"draft_id"in t&&typeof t.draft_id!="number"&&(e.isValid=!1,e.errors.push('Field "draft_id" must be a number')),"text_transform"in t&&typeof t.text_transform!="string"&&(e.isValid=!1,e.errors.push('Field "text_transform" must be a string')),"dom_transforms"in t&&!Array.isArray(t.dom_transforms)&&(e.isValid=!1,e.errors.push('Field "dom_transforms" must be an array')),"version"in t&&typeof t.version!="string"&&(e.isValid=!1,e.errors.push('Field "version" must be a string'));const n=["is_draft","draft_id","text_transform","dom_transforms","version"];for(const i in t)n.includes(i)||e.warnings.push(`Unknown field: ${i}`);return e}async function $u(r,e){const a=(await r.listFiles(e)).filter(i=>Yn(i)),n={totalFiles:a.length,totalSize:0,directories:{text:0,scripts:0,extensions:0},hasSettingsFile:!1};for(const i of a){try{const s=await r.readFile(e,i);n.totalSize+=s.byteLength}catch{continue}i==="SOURCE/settings.json"&&(n.hasSettingsFile=!0),i.startsWith("SOURCE/text/")?n.directories.text++:i.startsWith("SOURCE/scripts/")?n.directories.scripts++:i.startsWith("SOURCE/extensions/")&&n.directories.extensions++}return n}function Hu(r){if(!r||typeof r!="string")return"";let e=r.trim();return e=e.replace(/\\/g,"/"),e=e.replace(/\/+/g,"/"),e=e.split("/").filter(n=>n!=="."&&n!=="").join("/"),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e}const qu={is_draft:!1,draft_id:1,text_transform:"markdown-transform.js",dom_transforms:["custom-dom.js"],version:"1.0.0"};class vo{constructor(e){this.fileStorage=e}async createSourceZip(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Error(`Workspace ${e} not found`);const n=(await this.fileStorage.listFiles(e)).filter(s=>Yn(s));if(n.length===0)return null;const i=new Jn;for(const s of n)try{const l=await this.fileStorage.readFile(e,s);await i.addFile(s,l)}catch(l){throw new Error(`Failed to read file ${s}: ${l}`)}try{return await i.buildBlob()}catch(s){throw new Error(`ZIP creation failed: ${s}`)}}catch(t){throw t instanceof Error?t:new Error(`Failed to create SOURCE.zip: ${t}`)}}async extractSourceZip(e,t){try{const a=await t.arrayBuffer(),n=new Dr(a);for(const i of n.entries){const s=Hu(i.fileName);if(!ju(s))throw new Error(`Invalid file path: ${i.fileName}`);try{const d=await(await i.extract()).arrayBuffer();await this.fileStorage.writeFile(e,s,d)}catch(l){throw new Error(`Failed to write file ${s}: ${l}`)}}}catch(a){throw a instanceof Error?a:new Error(`Failed to extract SOURCE.zip: ${a}`)}}async hasSourceFiles(e){try{return(await this.fileStorage.listFiles(e)).filter(n=>Yn(n)).length>0}catch(t){throw new Error(`Failed to check SOURCE/ files: ${t}`)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e)).filter(i=>Yn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const s=await this.fileStorage.readFile(e,i),l={path:i,size:s.byteLength,type:ho(i)};n.push(l)}catch{continue}return n}catch(t){throw new Error(`Failed to list SOURCE/ files: ${t}`)}}async initializeSourceStructure(e){try{const t="SOURCE/settings.json";if(!await this.fileStorage.fileExists(e,t)){const a=JSON.stringify(qu,null,2);await this.fileStorage.writeTextFile(e,t,a)}}catch(t){throw new Error(`Failed to initialize SOURCE/ structure: ${t}`)}}async validateSourceStructure(e){const t={isValid:!0,errors:[],warnings:[],fileCount:0,totalSize:0,hasSettings:!1};try{const n=(await this.fileStorage.listFiles(e)).filter(i=>Yn(i));t.fileCount=n.length;for(const i of n)try{const s=await this.fileStorage.readFile(e,i);if(t.totalSize+=s.byteLength,i==="SOURCE/settings.json"){t.hasSettings=!0;const d=new TextDecoder().decode(s),u=Bu(d);u.isValid||(t.isValid=!1,t.errors.push(...u.errors.map(c=>`Invalid settings.json format: ${c}`))),t.warnings.push(...u.warnings)}const l=i.substring(7);!l.includes("/")&&i!=="SOURCE/settings.json"&&t.warnings.push(`Unexpected file in SOURCE/ root: ${l}`)}catch{continue}t.hasSettings||t.warnings.push("Missing settings.json file")}catch(a){t.isValid=!1,t.errors.push(`Failed to validate SOURCE/ structure: ${a}`)}return t}async getSourceDirectoryStats(e){try{return await $u(this.fileStorage,e)}catch(t){throw new Error(`Failed to get SOURCE/ directory statistics: ${t}`)}}}class Ei{fileStorage;sourceManager;constructor(){this.fileStorage=Ut.getInstance(),this.sourceManager=new vo(this.fileStorage)}async packageEPUB(e,t={}){const a=Date.now();try{const n=await this.readWorkspaceFiles(e);if(n.length===0)return{success:!1,error:"Workspace is empty"};const i=await this.extractMetadata(n),s=new Jn,l=n.reduce((p,h)=>p+h.size,0);let d=0;for(let p=0;p<n.length;p++){const h=n[p],v=this.optimizeCompression(h.path,h.content);await s.addFile(h.path,h.content,{compressionMethod:v.method,lastModified:new Date}),d+=h.size,t.progressCallback?.({phase:"compressing",currentFile:h.path,processedFiles:p+1,totalFiles:n.length,currentBytes:d,totalBytes:l})}t.progressCallback?.({phase:"writing",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l});const u=await s.buildBlob(),c=this.generateFilename(i);return t.progressCallback?.({phase:"complete",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l}),{success:!0,blob:u,filename:c,totalSize:l,compressedSize:u.size,fileCount:n.length,processingTime:Date.now()-a}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error",processingTime:Date.now()-a}}}async readWorkspaceFiles(e){const t=await this.fileStorage.listFiles(e),a=t.filter(s=>s.startsWith("SOURCE/")),n=t.filter(s=>!s.startsWith("SOURCE/")),i=[];for(const s of n)try{const l=await this.fileStorage.readFile(e,s);i.push({path:s,content:l,size:l.byteLength,mimeType:po(s)})}catch(l){console.warn(`Failed to read file ${s}:`,l)}if(a.length>0)try{const s=await this.sourceManager.createSourceZip(e);if(s){const l=await s.arrayBuffer();i.push({path:"SOURCE.zip",content:l,size:l.byteLength,mimeType:"application/zip"})}}catch(s){console.warn("Failed to create SOURCE.zip:",s)}return i}async extractMetadata(e){const t=e.find(c=>c.path==="META-INF/container.xml");if(!t)throw new Error("Missing META-INF/container.xml file - invalid EPUB structure");const a=new TextDecoder,n=a.decode(t.content),i=wt.parseRootfilePath(n),s=e.find(c=>c.path===i);if(!s)throw new Error(`Missing OPF file at path: ${i}`);const l=a.decode(s.content),u=new DOMParser().parseFromString(l,"application/xml");return wt.parseOPFMetadata(u)}optimizeCompression(e,t){if(e==="mimetype")return{method:0,reason:"EPUB compliance requirement"};const a=e.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","mp3","mp4","webp","zip"].includes(a||"")?{method:0,reason:"Already compressed format"}:["html","xhtml","xml","css","js","txt","opf","ncx"].includes(a||"")?{method:8,reason:"Text-based content compresses well"}:{method:8,reason:"Default compression"}}generateFilename(e){const t=this.sanitizeFilename(e.title||"Untitled"),a=e.creator?.[0]?this.sanitizeFilename(e.creator[0]):null,n=new Date().toISOString().split("T")[0],i=[t];return a&&i.push(a),i.push(n),`${i.join(" - ")}.epub`}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,50)}downloadEPUB(e,t){Ld(e,t)}}var Vu=P('<div class="error-banner svelte-9tke9n"><span class="error-icon svelte-9tke9n" aria-hidden="true">â ï¸</span> <span class="error-text svelte-9tke9n"> </span> <button type="button" class="retry-button svelte-9tke9n"> </button></div>'),Gu=P('<div class="unsaved-indicator svelte-9tke9n"><span class="indicator-icon svelte-9tke9n" aria-hidden="true">â ï¸</span> <span> </span></div>'),Xu=P('<div class="workspace-view svelte-9tke9n"><main class="view-content svelte-9tke9n"><!> <!>  <!> <!></main></div>');function Ku(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=()=>Ye(_i,"$currentLocale",t);let s=B(e,"onWorkspaceChange",3,null),l=B(e,"currentWorkspaceId",3,null),d=Ue(Ct([])),u=Ue(null),c=Ue(!1),p=Ue(null),h=Ue(!1),v=Ue(""),m=Ue(!1);const w=new Ei;xt(()=>{l()&&o(d).length>0?y(u,o(d).find(Q=>Q.id===l())||null,!0):y(u,null)});const b=async Q=>{if(Q){y(u,o(d).find(ve=>ve.id===Q)||null,!0),localStorage.setItem("currentWorkspace",Q);try{await e.onLoadWorkspace(Q)}catch(ve){console.error("Failed to load workspace:",ve)}}else y(u,null),localStorage.removeItem("currentWorkspace");s()&&s()(Q),e.onWorkspaceChanged?.(Q)},k=()=>{},I=async()=>{try{y(c,!0),y(p,null),y(d,await e.onListWorkspaces(),!0),k()}catch(Q){console.error("Failed to load workspaces:",Q),y(p,n()("Failed to load projects"),!0),y(d,[],!0)}finally{y(c,!1)}},C=()=>({title:"Untitled Book Project",identifier:crypto.randomUUID(),creator:["Unknown"]}),L=async()=>{try{y(c,!0);const Q=i(),ve=C(),Z=await e.onCreateWorkspace({title:ve.title||"Untitled Book Project",language:Q});console.log("â Workspace created:",Z),await I(),await b(Z),e.onNavigationRequested?.("metadata",Z),e.onWorkspaceOpened?.(Z)}catch(Q){console.error("Failed to create workspace:",Q),alert(n()("Failed to create workspace: {error}",{error:Q instanceof Error?Q.message:"Unknown error"}))}finally{y(c,!1)}},E=async()=>{try{y(c,!0),await e.onEpubImportRequested(),await I()}catch(Q){console.error("Failed to import EPUB:",Q),alert(n()("Failed to import EPUB: {error}",{error:Q instanceof Error?Q.message:"Unknown error"}))}finally{y(c,!1)}},N=async Q=>{const{workspaceId:ve}=Q.detail;try{await b(ve),e.onSmartNavigationRequested?.(ve),e.onWorkspaceOpened?.(ve)}catch(Z){console.error("Failed to open workspace:",Z),alert(n()("Failed to open workspace: {error}",{error:Z instanceof Error?Z.message:"Unknown error"}))}},z=async Q=>{const{workspaceId:ve}=Q.detail,Z=o(d).find(Fe=>Fe.id===ve);if(!(!Z||!confirm(n()('Delete "{title}"? This cannot be undone.',{title:Z.title}))))try{y(c,!0),await e.onDeleteWorkspace(ve),await I(),l()===ve&&await b(null)}catch(Fe){console.error("Failed to delete workspace:",Fe),alert(n()("Failed to delete workspace: {error}",{error:Fe instanceof Error?Fe.message:"Unknown error"}))}finally{y(c,!1)}},H=async Q=>{const{workspaceId:ve}=Q.detail;if(o(d).find(ue=>ue.id===ve))try{y(m,!0);const ue=await w.packageEPUB(ve,{progressCallback:Fe=>{console.log(`Packaging progress: ${Fe.phase} - ${Fe.processedFiles}/${Fe.totalFiles} files`)}});if(ue.success&&ue.blob&&ue.filename)w.downloadEPUB(ue.blob,ue.filename),console.log(`â Successfully packaged and downloaded: ${ue.filename}`);else throw new Error(ue.error||"Unknown packaging error")}catch(ue){console.error("Failed to package EPUB:",ue),alert(n()("Failed to package EPUB: {error}",{error:ue instanceof Error?ue.message:"Unknown error"}))}finally{y(m,!1)}};async function W(){return o(h)?window.confirm(n()("You have unsaved project changes. Continue?")):!0}function O(Q){}function T(){}function G(){return{currentWorkspaceId:l(),hasUnsavedChanges:o(h)}}async function U(Q){Q.currentWorkspaceId&&await b(Q.currentWorkspaceId),Q.hasUnsavedChanges!==void 0&&y(h,Q.hasUnsavedChanges,!0)}const F=()=>{I()};an(async()=>{y(v,bt.addNavigationGuard(W),!0),window.addEventListener("workspace-list-refresh",F),await I()}),lr(()=>{o(v)&&bt.removeNavigationGuard(o(v)),window.removeEventListener("workspace-list-refresh",F)});var D=Xu(),M=f(D),le=f(M);bu(le,{get isLoading(){return o(c)},$$events:{createNewRequested:L,loadEpubRequested:E}});var J=g(le,2);{var ge=Q=>{var ve=Vu(),Z=g(f(ve),2),ue=f(Z),Fe=g(Z,2);Fe.__click=I;var je=f(Fe);R(Ge=>{x(ue,o(p)),x(je,Ge)},[()=>n()("Retry")]),_(Q,ve)};j(J,Q=>{o(p)&&Q(ge)})}var X=g(J,2);const we=oe(()=>o(c)||o(m));Ou(X,{get workspaces(){return o(d)},get currentWorkspaceId(){return l()},get isLoading(){return o(we)},$$events:{workspaceSelected:N,workspaceDeleted:z,packageRequested:H}});var he=g(X,2);{var Ce=Q=>{var ve=Gu(),Z=g(f(ve),2),ue=f(Z);R(Fe=>x(ue,Fe),[()=>n()("You have unsaved changes")]),_(Q,ve)};j(he,Q=>{o(h)&&Q(Ce)})}_(r,D);var se=et({canLeave:W,onViewEnter:O,onViewLeave:T,getViewData:G,setViewData:U});return a(),se}_t(["click"]);var Yu=P('<span class="error-indicator svelte-z75kp3">!</span>'),Ju=P('<button><span class="tab-label svelte-z75kp3"> </span> <!></button>');function Zu(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Lt();let s=B(e,"id",8,""),l=B(e,"label",8,""),d=B(e,"active",8,!1),u=B(e,"errorCount",8,0),c=B(e,"disabled",8,!1);const p=()=>{c()||i("click",{tabId:s()})},h=C=>{(C.key==="Enter"||C.key===" ")&&!c()&&(C.preventDefault(),i("click",{tabId:s()}))};gt();var v=Ju();let m;var w=f(v),b=f(w),k=g(w,2);{var I=C=>{var L=Yu();R(E=>pe(L,"aria-label",E),[()=>n()("validation.errorsCount",{count:u()})],de),_(C,L)};j(k,C=>{u()>0&&C(I)})}R(C=>{m=st(v,1,"metadata-tab svelte-z75kp3",null,m,C),v.disabled=c(),pe(v,"aria-controls",`metadata-panel-${s()??""}`),pe(v,"id",`metadata-tab-${s()??""}`),x(b,l())},[()=>({active:d(),"has-errors":u()>0,disabled:c()})],de),Ke("click",v,p),Ke("keydown",v,h),_(r,v),et(),a()}var Qu=P('<div class="metadata-tab-bar svelte-1pzcjt6" tabindex="-1"></div>');function ef(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Lt();let s=B(e,"activeTab",8,"basic"),l=B(e,"validationErrors",24,()=>[]),d=B(e,"tabs",24,()=>[{id:"basic",label:n()("metadata.tab.basic")},{id:"advanced",label:n()("metadata.tab.advanced")},{id:"publication",label:n()("metadata.tab.publication")},{id:"accessibility",label:n()("metadata.tab.accessibility")}]);const u=v=>{const m=c(v);return l().filter(w=>m.includes(w.field)).length},c=v=>{switch(v){case"basic":return["title","language","identifier","creator"];case"advanced":return["publisher","date","description","subject","rights","source","relation","coverage","type","format","contributor"];case"publication":return["series","seriesPosition","epubVersion","uniqueIdentifierScheme","primaryCreatorFileAs","creatorRoles"];case"accessibility":return["accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard","accessibilitySummary","accessibilityCertification","accessibilityCertifier"];default:return[]}},p=v=>{i("tabClick",v.detail)};gt();var h=Qu();kt(h,5,d,It,(v,m)=>{const w=de(()=>s()===o(m).id),b=de(()=>u(o(m).id));Zu(v,{get id(){return o(m).id},get label(){return o(m).label},get active(){return o(w)},get errorCount(){return o(b)},$$events:{click:p}})}),_(r,h),et(),a()}const tf=(r,e)=>{e("change",{value:r.target.value})};var nf=P('<span class="field-error svelte-cp96ig" role="alert"> </span>'),rf=P("<label><!></label>"),af=P('<div class="metadata-field svelte-cp96ig"><!> <input type="text"/></div>');function nn(r,e){Qe(e,!1);const t=Ne(),a=Lt();let n=B(e,"value",8,""),i=B(e,"placeholder",8,""),s=B(e,"required",8,!1),l=B(e,"disabled",8,!1),d=B(e,"error",8,""),u=B(e,"label",8,""),c=B(e,"id",8,"");const p=I=>{a("blur",{value:I.target.value})},h=()=>{a("focus",{field:c()})};ft(()=>(rt(s()),rt(n())),()=>{y(t,s()&&(!n()||n().trim()===""))}),Mt(),gt();var v=af(),m=f(v);{var w=I=>{var C=rf();let L;var E=f(C);{var N=H=>{var W=nf(),O=f(W);R(()=>{pe(W,"id",`${c()??""}-error`),x(O,d())}),_(H,W)},z=H=>{var W=Et();R(()=>x(W,u())),_(H,W)};j(E,H=>{d()?H(N):H(z,!1)})}R(H=>{pe(C,"for",c()),L=st(C,1,"field-label svelte-cp96ig",null,L,H)},[()=>({"needs-attention":o(t)})],de),_(I,C)};j(m,I=>{u()&&I(w)})}var b=g(m,2);let k;b.__input=[tf,a],R(I=>{pe(b,"id",c()),En(b,n()),pe(b,"placeholder",i()),b.required=s(),b.disabled=l(),k=st(b,1,"field-input svelte-cp96ig",null,k,I),pe(b,"aria-describedby",d()?`${c()}-error`:void 0),pe(b,"aria-invalid",!!d())},[()=>({error:!!d(),"needs-attention":o(t)})],de),Ke("blur",b,p),Ke("focus",b,h),_(r,v),et()}_t(["input"]);const sf=(r,e)=>{const t=r.target;e("change",{value:t.value})};var of=P('<div class="field-error svelte-bssb4o" role="alert"> </div>'),lf=P("<label><!></label>"),cf=P("<option> </option>"),df=P("<option> </option>"),uf=P('<div class="metadata-field svelte-bssb4o"><!> <select><!><!></select></div>');function Vn(r,e){Qe(e,!1);const t=Ne(),a=Lt();let n=B(e,"value",8,""),i=B(e,"options",24,()=>[]),s=B(e,"required",8,!1),l=B(e,"disabled",8,!1),d=B(e,"error",8,""),u=B(e,"label",8,""),c=B(e,"id",8,""),p=B(e,"placeholder",8,"");const h=z=>{const H=z.target;a("blur",{value:H.value})},v=()=>{a("focus",{field:c()})};ft(()=>(rt(s()),rt(n())),()=>{y(t,s()&&(!n()||n().trim()===""))}),Mt(),gt();var m=uf(),w=f(m);{var b=z=>{var H=lf();let W;var O=f(H);{var T=U=>{var F=of(),D=f(F);R(()=>{pe(F,"id",`${c()??""}-error`),x(D,d())}),_(U,F)},G=U=>{var F=Et();R(()=>x(F,u())),_(U,F)};j(O,U=>{d()?U(T):U(G,!1)})}R(U=>{pe(H,"for",c()),W=st(H,1,"field-label svelte-bssb4o",null,W,U)},[()=>({"needs-attention":o(t)})],de),_(z,H)};j(w,z=>{u()&&z(b)})}var k=g(w,2);Ir(k,n);var I;let C;k.__change=[sf,a];var L=f(k);{var E=z=>{var H=cf();H.value=H.__value="";var W=f(H);R(()=>x(W,p())),_(z,H)};j(L,z=>{p()&&z(E)})}var N=g(L);kt(N,1,i,It,(z,H)=>{var W=df(),O={},T=f(W);R(()=>{O!==(O=o(H).value)&&(W.value=(W.__value=o(H).value)??""),x(T,o(H).label)}),_(z,W)}),R(z=>{pe(k,"id",c()),I!==(I=n())&&(k.value=(k.__value=n())??"",Un(k,n())),k.required=s(),k.disabled=l(),C=st(k,1,"field-select svelte-bssb4o",null,C,z),pe(k,"aria-describedby",d()?`${c()}-error`:void 0),pe(k,"aria-invalid",!!d())},[()=>({error:!!d(),"needs-attention":o(t)})],de),Ke("blur",k,h),Ke("focus",k,v),_(r,m),et()}_t(["change"]);var ff=P('<span class="required svelte-1c704qf">*</span>'),pf=P("<label> <!></label>"),hf=P('<div class="field-error svelte-1c704qf" role="alert"> </div>'),vf=P('<div class="metadata-field svelte-1c704qf"><!> <textarea></textarea> <!></div>');function mf(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne(),s=Lt();let l=B(e,"value",8,""),d=B(e,"placeholder",8,""),u=B(e,"required",8,!1),c=B(e,"disabled",8,!1),p=B(e,"error",8,""),h=B(e,"label",8,""),v=B(e,"id",8,""),m=B(e,"rows",8,4);const w=W=>{s("change",{value:W.target.value})},b=W=>{s("blur",{value:W.target.value})},k=()=>{s("focus",{field:v()})};ft(()=>(rt(u()),rt(l())),()=>{y(i,u()&&(!l()||l().trim()===""))}),Mt(),gt();var I=vf(),C=f(I);{var L=W=>{var O=pf();let T;var G=f(O),U=g(G);{var F=D=>{var M=ff();R(le=>pe(M,"aria-label",le),[()=>n()("Required field")],de),_(D,M)};j(U,D=>{u()&&D(F)})}R(D=>{pe(O,"for",v()),T=st(O,1,"field-label svelte-1c704qf",null,T,D),x(G,`${h()??""} `)},[()=>({"needs-attention":o(i)})],de),_(W,O)};j(C,W=>{h()&&W(L)})}var E=g(C,2);let N;var z=g(E,2);{var H=W=>{var O=hf(),T=f(O);R(()=>{pe(O,"id",`${v()??""}-error`),x(T,p())}),_(W,O)};j(z,W=>{p()&&W(H)})}R(W=>{pe(E,"id",v()),En(E,l()),pe(E,"placeholder",d()),E.required=u(),E.disabled=c(),pe(E,"rows",m()),N=st(E,1,"field-textarea svelte-1c704qf",null,N,W),pe(E,"aria-describedby",p()?`${v()}-error`:void 0),pe(E,"aria-invalid",!!p())},[()=>({error:!!p(),"needs-attention":o(i)})],de),Ke("input",E,w),Ke("blur",E,b),Ke("focus",E,k),_(r,I),et(),a()}const gf=(r,e)=>{e.ongenerateIdentifier?.(new CustomEvent("generateIdentifier"))};var wf=P('<div class="array-item svelte-1nofkco"><!> <button type="button" class="remove-button svelte-1nofkco">Ã</button></div>'),yf=(r,e)=>e("creator"),bf=P('<div class="basic-info-fields svelte-1nofkco" tabindex="-1"><div class="form-columns svelte-1nofkco" tabindex="-1"><div class="column svelte-1nofkco" tabindex="-1"><fieldset class="field-group svelte-1nofkco" tabindex="-1"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <div class="identifier-field svelte-1nofkco"><!> <button type="button" class="generate-button svelte-1nofkco"> </button></div></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <div class="array-field svelte-1nofkco"><!> <button type="button" class="add-button svelte-1nofkco"> </button></div></fieldset></div> <div class="column svelte-1nofkco"><fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div></div></div>');function xf(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"metadata",19,()=>({title:"",language:"",identifier:""})),s=B(e,"validationErrors",19,()=>[]),l=B(e,"saving",3,!1),d=Ue(Ct([]));xt(()=>{y(d,i().creator||[],!0)});const u=[{value:"en",label:"English"},{value:"de",label:"Deutsch"},{value:"es",label:"EspaÃ±ol"},{value:"fr",label:"FranÃ§ais"},{value:"it",label:"Italiano"},{value:"pt",label:"PortuguÃªs"},{value:"ja",label:"æ¥æ¬èª"},{value:"zh",label:"ä¸­æ"},{value:"ar",label:"Ø§ÙØ¹Ø±Ø¨ÙØ©"},{value:"he",label:"×¢××¨××ª"},{value:"ka",label:"á¥áá áá£áá"}],c=[{value:"reflowable",label:n()("Reflowable")},{value:"pre-paginated",label:n()("Pre-paginated")}],p=[{value:"default",label:n()("Default")},{value:"ltr",label:n()("Left to Right")},{value:"rtl",label:n()("Right to Left")}],h=[{value:"auto",label:n()("Auto")},{value:"landscape",label:n()("Landscape")},{value:"portrait",label:n()("Portrait")}],v=[{value:"auto",label:n()("Auto")},{value:"none",label:n()("None")},{value:"both",label:n()("Both")}],m=S=>{const K=s().find(re=>re.field===S);return K?K.message:""},w=(S,K)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:S,value:K}}))},b=(S,K)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:S,value:K}}))},k=S=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:S}}))},I=(S,K)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:S,index:K}}))},C=(S,K,re)=>{o(d)[K]=re,w(S,o(d))};var L=bf(),E=f(L),N=f(E),z=f(N),H=f(z),W=f(H),O=g(H,2);const T=oe(()=>n()("Title")),G=oe(()=>i().title||""),U=oe(()=>n()("Enter book title")),F=oe(()=>m("title"));nn(O,{id:"title",get label(){return o(T)},get value(){return o(G)},get placeholder(){return o(U)},required:!0,get error(){return o(F)},$$events:{change:S=>w("title",S.detail.value),blur:S=>b("title",S.detail.value)}});var D=g(O,2);const M=oe(()=>n()("Language")),le=oe(()=>i().language||""),J=oe(()=>n()("Select language")),ge=oe(()=>m("language"));Vn(D,{id:"language",get label(){return o(M)},get value(){return o(le)},get options(){return u},get placeholder(){return o(J)},required:!0,get error(){return o(ge)},$$events:{change:S=>w("language",S.detail.value),blur:S=>b("language",S.detail.value)}});var X=g(D,2),we=f(X);const he=oe(()=>n()("Identifier")),Ce=oe(()=>i().identifier||""),se=oe(()=>n()("Enter a unique identifier")),Q=oe(()=>m("identifier"));nn(we,{id:"identifier",get label(){return o(he)},get value(){return o(Ce)},get placeholder(){return o(se)},required:!0,get error(){return o(Q)},$$events:{change:S=>w("identifier",S.detail.value),blur:S=>b("identifier",S.detail.value)}});var ve=g(we,2);ve.__click=[gf,e];var Z=f(ve),ue=g(z,2),Fe=f(ue),je=f(Fe),Ge=g(Fe,2),ne=f(Ge);kt(ne,17,()=>o(d),It,(S,K,re)=>{var Se=wf(),De=f(Se);const A=oe(()=>n()("Author name")),ee=oe(()=>m(`creator[${re}]`));nn(De,{id:`creator-${re}`,get value(){return o(K)},get placeholder(){return o(A)},get error(){return o(ee)},$$events:{change:Re=>C("creator",re,Re.detail.value),blur:()=>b("creator",o(d))}});var ie=g(De,2);ie.__click=()=>I("creator",re),R(Re=>{ie.disabled=l(),pe(ie,"aria-label",Re)},[()=>n()("Remove author")]),_(S,Se)});var be=g(ne,2);be.__click=[yf,k];var me=f(be),_e=g(N,2),Pe=f(_e),$e=f(Pe),He=f($e),Je=g($e,2);const at=oe(()=>i().description||""),ce=oe(()=>n()("Enter book description")),ke=oe(()=>m("description"));mf(Je,{id:"description",label:void 0,get value(){return o(at)},get placeholder(){return o(ce)},get error(){return o(ke)},rows:3,$$events:{change:S=>w("description",S.detail.value),blur:S=>b("description",S.detail.value)}});var Ee=g(Pe,2),ze=f(Ee),$=f(ze),V=g(ze,2);const Y=oe(()=>n()("Layout")),te=oe(()=>i().renditionLayout||"reflowable"),Te=oe(()=>m("renditionLayout"));Vn(V,{id:"renditionLayout",get label(){return o(Y)},get value(){return o(te)},get options(){return c},get error(){return o(Te)},$$events:{change:S=>w("renditionLayout",S.detail.value),blur:S=>b("renditionLayout",S.detail.value)}});var q=g(V,2);const fe=oe(()=>n()("Page Progression")),ae=oe(()=>i().pageProgressionDirection||"default"),xe=oe(()=>m("pageProgressionDirection"));Vn(q,{id:"pageProgressionDirection",get label(){return o(fe)},get value(){return o(ae)},get options(){return p},get error(){return o(xe)},$$events:{change:S=>w("pageProgressionDirection",S.detail.value),blur:S=>b("pageProgressionDirection",S.detail.value)}});var Ie=g(q,2);const Ae=oe(()=>n()("Orientation")),Le=oe(()=>i().renditionOrientation||"auto"),We=oe(()=>m("renditionOrientation"));Vn(Ie,{id:"renditionOrientation",get label(){return o(Ae)},get value(){return o(Le)},get options(){return h},get error(){return o(We)},$$events:{change:S=>w("renditionOrientation",S.detail.value),blur:S=>b("renditionOrientation",S.detail.value)}});var ye=g(Ie,2);const Oe=oe(()=>n()("Spread")),Be=oe(()=>i().renditionSpread||"auto"),Me=oe(()=>m("renditionSpread"));Vn(ye,{id:"renditionSpread",get label(){return o(Oe)},get value(){return o(Be)},get options(){return v},get error(){return o(Me)},$$events:{change:S=>w("renditionSpread",S.detail.value),blur:S=>b("renditionSpread",S.detail.value)}}),R((S,K,re,Se,De,A)=>{x(W,S),ve.disabled=l(),x(Z,K),x(je,re),be.disabled=l(),x(me,Se),x(He,De),x($,A)},[()=>n()("Essential Information"),()=>n()("Generate"),()=>n()("Authors"),()=>n()("Add Author"),()=>n()("Description"),()=>n()("Rendition Properties")]),_(r,L),et(),a()}_t(["click"]);var _f=P('<span class="required svelte-14vfa0w">*</span>'),Sf=P("<label> <!></label>"),Ef=P('<button type="button" class="today-button svelte-14vfa0w"> </button>'),kf=P('<div class="field-error svelte-14vfa0w" role="alert"> </div>'),Tf=P('<div class="metadata-field svelte-14vfa0w"><!> <div class="date-input-wrapper svelte-14vfa0w"><input type="date"/> <!></div> <!></div>');function Cf(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne(),s=Lt();let l=B(e,"value",8,""),d=B(e,"required",8,!1),u=B(e,"disabled",8,!1),c=B(e,"error",8,""),p=B(e,"label",8,""),h=B(e,"id",8,"");const v=T=>{s("change",{value:T.target.value})},m=T=>{s("blur",{value:T.target.value})},w=()=>{s("focus",{field:h()})},b=()=>{const T=new Date().toISOString().split("T")[0];s("change",{value:T}),s("blur",{value:T})};ft(()=>(rt(d()),rt(l())),()=>{y(i,d()&&(!l()||l().trim()===""))}),Mt(),gt();var k=Tf(),I=f(k);{var C=T=>{var G=Sf();let U;var F=f(G),D=g(F);{var M=le=>{var J=_f();R(ge=>pe(J,"aria-label",ge),[()=>n()("Required field")],de),_(le,J)};j(D,le=>{d()&&le(M)})}R(le=>{pe(G,"for",h()),U=st(G,1,"field-label svelte-14vfa0w",null,U,le),x(F,`${p()??""} `)},[()=>({"needs-attention":o(i)})],de),_(T,G)};j(I,T=>{p()&&T(C)})}var L=g(I,2),E=f(L);let N;var z=g(E,2);{var H=T=>{var G=Ef(),U=f(G);R((F,D)=>{pe(G,"aria-label",F),x(U,D)},[()=>n()("Set to today"),()=>n()("Today")],de),Ke("click",G,b),_(T,G)};j(z,T=>{u()||T(H)})}var W=g(L,2);{var O=T=>{var G=kf(),U=f(G);R(()=>{pe(G,"id",`${h()??""}-error`),x(U,c())}),_(T,G)};j(W,T=>{c()&&T(O)})}R(T=>{pe(E,"id",h()),En(E,l()),E.required=d(),E.disabled=u(),N=st(E,1,"field-input svelte-14vfa0w",null,N,T),pe(E,"aria-describedby",c()?`${h()}-error`:void 0),pe(E,"aria-invalid",!!c())},[()=>({error:!!c(),"needs-attention":o(i)})],de),Ke("input",E,v),Ke("blur",E,m),Ke("focus",E,w),_(r,k),et(),a()}var If=P('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">Ã</button></div>'),Ff=(r,e)=>e("subject"),Pf=P('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">Ã</button></div>'),Mf=(r,e)=>e("contributor"),Lf=P('<div class="advanced-fields svelte-fuok1"><div class="form-columns svelte-fuok1"><div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div> <div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset></div></div></div>');function Df(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"metadata",19,()=>({title:"",language:"",identifier:""})),s=B(e,"validationErrors",19,()=>[]),l=B(e,"saving",3,!1);const d=[{value:"",label:n()("Select content type")},{value:"fiction",label:n()("Fiction")},{value:"non-fiction",label:n()("Non-fiction")},{value:"poetry",label:n()("Poetry")},{value:"drama",label:n()("Drama")},{value:"biography",label:n()("Biography")},{value:"textbook",label:n()("Textbook")},{value:"reference",label:n()("Reference")},{value:"children",label:n()("Children")}],u=S=>{const K=s().find(re=>re.field===S);return K?K.message:""},c=(S,K)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:S,value:K}}))},p=(S,K)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:S,value:K}}))},h=S=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:S}}))},v=(S,K)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:S,index:K}}))},m=(S,K,re)=>{const De=[...Si.getArrayField(i(),S)];De[K]=re,c(S,De)};var w=Lf(),b=f(w),k=f(b),I=f(k),C=f(I),L=f(C),E=g(C,2);const N=oe(()=>n()("Publisher")),z=oe(()=>i().publisher||""),H=oe(()=>n()("Enter publisher name")),W=oe(()=>u("publisher"));nn(E,{id:"publisher",get label(){return o(N)},get value(){return o(z)},get placeholder(){return o(H)},get error(){return o(W)},$$events:{change:S=>c("publisher",S.detail.value),blur:S=>p("publisher",S.detail.value)}});var O=g(E,2);const T=oe(()=>n()("Publication Date")),G=oe(()=>i().date||""),U=oe(()=>u("date"));Cf(O,{id:"date",get label(){return o(T)},get value(){return o(G)},get error(){return o(U)},$$events:{change:S=>c("date",S.detail.value),blur:S=>p("date",S.detail.value)}});var F=g(O,2);const D=oe(()=>n()("Rights")),M=oe(()=>i().rights||""),le=oe(()=>n()("Enter copyright information")),J=oe(()=>u("rights"));nn(F,{id:"rights",get label(){return o(D)},get value(){return o(M)},get placeholder(){return o(le)},get error(){return o(J)},$$events:{change:S=>c("rights",S.detail.value),blur:S=>p("rights",S.detail.value)}});var ge=g(F,2);const X=oe(()=>n()("Content Type")),we=oe(()=>i().type||""),he=oe(()=>n()("Select content type")),Ce=oe(()=>u("type"));Vn(ge,{id:"type",get label(){return o(X)},get value(){return o(we)},get options(){return d},get placeholder(){return o(he)},get error(){return o(Ce)},$$events:{change:S=>c("type",S.detail.value),blur:S=>p("type",S.detail.value)}});var se=g(I,2),Q=f(se),ve=f(Q),Z=g(Q,2);const ue=oe(()=>n()("Source")),Fe=oe(()=>i().source||""),je=oe(()=>n()("Enter source information")),Ge=oe(()=>u("source"));nn(Z,{id:"source",get label(){return o(ue)},get value(){return o(Fe)},get placeholder(){return o(je)},get error(){return o(Ge)},$$events:{change:S=>c("source",S.detail.value),blur:S=>p("source",S.detail.value)}});var ne=g(Z,2);const be=oe(()=>n()("Relation")),me=oe(()=>i().relation||""),_e=oe(()=>n()("Enter related work information")),Pe=oe(()=>u("relation"));nn(ne,{id:"relation",get label(){return o(be)},get value(){return o(me)},get placeholder(){return o(_e)},get error(){return o(Pe)},$$events:{change:S=>c("relation",S.detail.value),blur:S=>p("relation",S.detail.value)}});var $e=g(ne,2);const He=oe(()=>n()("Coverage")),Je=oe(()=>i().coverage||""),at=oe(()=>n()("Enter spatial or temporal coverage")),ce=oe(()=>u("coverage"));nn($e,{id:"coverage",get label(){return o(He)},get value(){return o(Je)},get placeholder(){return o(at)},get error(){return o(ce)},$$events:{change:S=>c("coverage",S.detail.value),blur:S=>p("coverage",S.detail.value)}});var ke=g($e,2);const Ee=oe(()=>n()("Format")),ze=oe(()=>i().format||""),$=oe(()=>n()("Enter format information")),V=oe(()=>u("format"));nn(ke,{id:"format",get label(){return o(Ee)},get value(){return o(ze)},get placeholder(){return o($)},get error(){return o(V)},$$events:{change:S=>c("format",S.detail.value),blur:S=>p("format",S.detail.value)}});var Y=g(k,2),te=f(Y),Te=f(te),q=f(Te),fe=g(Te,2),ae=f(fe);kt(ae,17,()=>i().subject||[],It,(S,K,re)=>{var Se=If(),De=f(Se);const A=oe(()=>n()("Subject or keyword")),ee=oe(()=>u(`subject[${re}]`));nn(De,{id:`subject-${re}`,get value(){return o(K)},get placeholder(){return o(A)},get error(){return o(ee)},$$events:{change:Re=>m("subject",re,Re.detail.value),blur:()=>p("subject",i().subject)}});var ie=g(De,2);ie.__click=()=>v("subject",re),R(Re=>{ie.disabled=l(),pe(ie,"aria-label",Re)},[()=>n()("Remove subject")]),_(S,Se)});var xe=g(ae,2);xe.__click=[Ff,h];var Ie=f(xe),Ae=g(te,2),Le=f(Ae),We=f(Le),ye=g(Le,2),Oe=f(ye);kt(Oe,17,()=>i().contributor||[],It,(S,K,re)=>{var Se=Pf(),De=f(Se);const A=oe(()=>n()("Contributor name")),ee=oe(()=>u(`contributor[${re}]`));nn(De,{id:`contributor-${re}`,get value(){return o(K)},get placeholder(){return o(A)},get error(){return o(ee)},$$events:{change:Re=>m("contributor",re,Re.detail.value),blur:()=>p("contributor",i().contributor)}});var ie=g(De,2);ie.__click=()=>v("contributor",re),R(Re=>{ie.disabled=l(),pe(ie,"aria-label",Re)},[()=>n()("Remove contributor")]),_(S,Se)});var Be=g(Oe,2);Be.__click=[Mf,h];var Me=f(Be);R((S,K,re,Se,De,A)=>{x(L,S),x(ve,K),x(q,re),xe.disabled=l(),x(Ie,Se),x(We,De),Be.disabled=l(),x(Me,A)},[()=>n()("Publication"),()=>n()("Additional Information"),()=>n()("Subjects"),()=>n()("Add Subject"),()=>n()("Contributors"),()=>n()("Add Contributor")]),_(r,w),et(),a()}_t(["click"]);class fn extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="MetadataServiceError"}}class Ji extends fn{constructor(e,t,a){super(e,"VALIDATION_FAILED",a),this.validationResults=t,this.name="MetadataValidationError"}}class Rf{constructor(e){this.workspaceService=e}loadMetadata(e){return e.opf.metadata}async updateField(e,t,a){try{const n={[t]:a},i=this.validateMetadataUpdates(n);if(i.some(s=>s.type==="error"))throw new Ji("Field validation failed",i,e.id);return await this.workspaceService.updateMetadata(e,n)}catch(n){throw n instanceof fn?n:new fn(`Failed to update field ${String(t)}: ${n instanceof Error?n.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async updateMetadata(e,t){try{const a=this.validateMetadataUpdates(t);if(a.filter(i=>i.type==="error").length>0)throw new Ji("Metadata validation failed",a,e.id);return await this.workspaceService.updateMetadata(e,t)}catch(a){throw a instanceof fn?a:new fn(`Failed to update metadata: ${a instanceof Error?a.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async addArrayItem(e,t,a=""){try{const n=e.opf.metadata[t]||[],i={[t]:[...n,a||this.getDefaultArrayValue(t)]};return await this.workspaceService.updateMetadata(e,i)}catch(n){throw new fn(`Failed to add ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_ADD_ERROR",e.id)}}async removeArrayItem(e,t,a){try{const n=e.opf.metadata[t]||[];if(a<0||a>=n.length)throw new fn(`Invalid index ${a} for ${t} array`,"INVALID_INDEX",e.id);const i=[...n];i.splice(a,1);const s={[t]:i};return await this.workspaceService.updateMetadata(e,s)}catch(n){throw n instanceof fn?n:new fn(`Failed to remove ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_REMOVE_ERROR",e.id)}}validateMetadata(e){const t=[];return e.title?.trim()||t.push({field:"title",message:"Title is required",type:"error"}),e.language?.trim()||t.push({field:"language",message:"Language is required",type:"error"}),e.identifier?.trim()||t.push({field:"identifier",message:"Identifier is required",type:"error"}),e.language&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)&&t.push({field:"language",message:'Invalid language code format (use ISO 639-1, e.g., "en" or "en-US")',type:"warning"}),e.title&&e.title.length>200&&t.push({field:"title",message:"Title should be under 200 characters",type:"warning"}),e.creator&&e.creator.some(a=>!a.trim())&&t.push({field:"creator",message:"Creator entries cannot be empty",type:"warning"}),t}validateMetadataUpdates(e){const t=[];return e.title!==void 0&&!e.title.trim()&&t.push({field:"title",message:"Title cannot be empty",type:"error"}),e.language!==void 0&&(e.language.trim()?/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)||t.push({field:"language",message:"Invalid language code format",type:"warning"}):t.push({field:"language",message:"Language cannot be empty",type:"error"})),e.identifier!==void 0&&!e.identifier.trim()&&t.push({field:"identifier",message:"Identifier cannot be empty",type:"error"}),t}getDefaultArrayValue(e){switch(e){case"creator":return"Unknown Author";case"contributor":return"Unknown Contributor";case"subject":return"New Subject";default:return""}}}var Uf=P('<div class="loading-state svelte-17s3g49"><p> </p></div>'),Af=(r,e)=>y(e,null),Of=P('<div class="error-state svelte-17s3g49"><p class="error-message svelte-17s3g49"> </p> <button type="button" class="retry-button svelte-17s3g49"> </button></div>'),zf=P('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),Wf=P('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),Nf=P('<div class="tab-panel svelte-17s3g49" tabindex="-1"><!></div>'),jf=P('<div class="metadata-editor svelte-17s3g49"><div class="pane-header svelte-17s3g49" tabindex="-1"><!></div> <div class="pane-content svelte-17s3g49" tabindex="-1"><!></div></div>');function Bf(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Lt();let s=B(e,"workspace",15,null),l=oe(()=>s()?.opf.metadata??{title:"",language:"",identifier:""}),d=oe(()=>e.metadataService.validateMetadata(o(l))),u=oe(()=>!s()),c=Ue("basic"),p=Ue(!1),h=Ue(null),v=oe(()=>[{id:"basic",label:n()("Basic Info")},{id:"advanced",label:n()("Advanced")},{id:"publication",label:n()("Publication Details")},{id:"accessibility",label:n()("Accessibility")}]);const m=U=>{switch(U){case"basic":return["title","language","identifier","creator"];case"advanced":return["publisher","date","description","subject","rights","source","relation","coverage","type","format","contributor"];case"publication":return["series","seriesPosition","epubVersion","uniqueIdentifierScheme","primaryCreatorFileAs","creatorRoles"];case"accessibility":return["accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard","accessibilitySummary","accessibilityCertification","accessibilityCertifier"];default:return[]}},w=(U,F)=>{const D=m(U);return o(d).filter(M=>D.includes(M.field))},b=U=>{},k=async U=>{const{field:F,value:D}=U.detail;if(s())try{s(await e.metadataService.updateField(s(),F,D)),i("metadataChanged",{field:F,value:D}),y(h,null)}catch(M){console.error(`Failed to save field ${F}:`,M),y(h,n()("Failed to save metadata field"),!0)}},I=async U=>{const{field:F}=U.detail;if(s())try{y(p,!0),(F==="creator"||F==="subject"||F==="contributor")&&(s(await e.metadataService.addArrayItem(s(),F)),i("metadataChanged",{field:F,value:s().opf.metadata[F]})),y(h,null)}catch(D){console.error(`Failed to add ${F}:`,D),y(h,n()("Failed to add metadata item"),!0)}finally{y(p,!1)}},C=async U=>{const{field:F,index:D}=U.detail;if(s())try{y(p,!0),(F==="creator"||F==="subject"||F==="contributor")&&(s(await e.metadataService.removeArrayItem(s(),F,D)),i("metadataChanged",{field:F,value:s().opf.metadata[F]})),y(h,null)}catch(M){console.error(`Failed to remove ${F}:`,M),y(h,n()("Failed to remove metadata item"),!0)}finally{y(p,!1)}},L=async()=>{const U=`urn:uuid:${crypto.randomUUID()}`;await k({detail:{field:"identifier",value:U}})},E=async U=>{const F=U.detail.tabId;if(w(o(c),o(l)).length>0){alert(n()("Please fix errors before switching tabs"));return}y(c,F,!0)};var N=jf(),z=f(N),H=f(z);ef(H,{get activeTab(){return o(c)},get validationErrors(){return o(d)},get tabs(){return o(v)},$$events:{tabClick:E}});var W=g(z,2),O=f(W);{var T=U=>{var F=Uf(),D=f(F),M=f(D);R(le=>x(M,le),[()=>n()("Loading metadataâ¦")]),_(U,F)},G=(U,F)=>{{var D=le=>{var J=Of(),ge=f(J),X=f(ge),we=g(ge,2);we.__click=[Af,h];var he=f(we);R(Ce=>{x(X,o(h)),x(he,Ce)},[()=>n()("Retry")]),_(le,J)},M=le=>{var J=Nf(),ge=f(J);{var X=he=>{xf(he,{get metadata(){return o(l)},get validationErrors(){return o(d)},get saving(){return o(p)},onfieldChange:b,onfieldSave:k,onarrayAdd:I,onarrayRemove:C,ongenerateIdentifier:L})},we=(he,Ce)=>{{var se=ve=>{Df(ve,{get metadata(){return o(l)},get validationErrors(){return o(d)},get saving(){return o(p)},onfieldChange:b,onfieldSave:k,onarrayAdd:I,onarrayRemove:C})},Q=(ve,Z)=>{{var ue=je=>{var Ge=zf(),ne=f(Ge),be=f(ne),me=g(ne,2),_e=f(me);R((Pe,$e,He)=>{x(be,Pe),x(_e,`${$e??""} - ${He??""}`)},[()=>n()("Coming Soon"),()=>n()("Publication Details"),()=>n()("Series information, EPUB version, and publication-specific metadata")]),_(je,Ge)},Fe=(je,Ge)=>{{var ne=be=>{var me=Wf(),_e=f(me),Pe=f(_e),$e=g(_e,2),He=f($e);R((Je,at,ce)=>{x(Pe,Je),x(He,`${at??""} - ${ce??""}`)},[()=>n()("Coming Soon"),()=>n()("Accessibility"),()=>n()("Accessibility features, hazards, and certification information")]),_(be,me)};j(je,be=>{o(c)==="accessibility"&&be(ne)},Ge)}};j(ve,je=>{o(c)==="publication"?je(ue):je(Fe,!1)},Z)}};j(he,ve=>{o(c)==="advanced"?ve(se):ve(Q,!1)},Ce)}};j(ge,he=>{o(c)==="basic"?he(X):he(we,!1)})}R(()=>{pe(J,"id",`metadata-panel-${o(c)??""}`),pe(J,"aria-labelledby",`metadata-tab-${o(c)??""}`)}),_(le,J)};j(U,le=>{o(h)?le(D):le(M,!1)},F)}};j(O,U=>{o(u)?U(T):U(G,!1)})}_(r,N),et(),a()}_t(["click"]);var $f=P('<div class="coming-soon-badge svelte-skhkuy"><span class="badge-text">Phase 3</span></div>'),Hf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),qf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Vf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Gf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Xf=P('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),Kf=(r,e)=>e("demo_action_1"),Yf=(r,e)=>e("demo_action_2"),Jf=()=>bt.navigateTo("workspace"),Zf=P('<div class="last-action svelte-skhkuy"><span class="action-icon svelte-skhkuy">â¨</span> <span> </span></div>'),Qf=P('<div class="placeholder-view svelte-skhkuy"><header class="view-header svelte-skhkuy"><div class="header-content svelte-skhkuy"><span class="view-icon svelte-skhkuy"> </span> <div class="header-text svelte-skhkuy"><h2 class="svelte-skhkuy"> </h2> <p class="svelte-skhkuy"> </p></div></div> <!></header> <main class="view-content svelte-skhkuy"><div class="placeholder-content svelte-skhkuy"><div class="placeholder-icon svelte-skhkuy"><span class="large-icon svelte-skhkuy"> </span></div> <h3 class="svelte-skhkuy"> </h3> <p class="placeholder-description svelte-skhkuy"> </p> <div class="feature-preview svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <ul class="feature-list svelte-skhkuy"><!></ul></div> <div class="demo-actions svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <div class="action-buttons svelte-skhkuy"><button class="btn btn-primary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button></div></div> <!></div></main></div>');function qr(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"viewType",8,"Unknown"),s=B(e,"title",8,"View"),l=B(e,"description",8,"This view will be implemented in Phase 3."),d=B(e,"icon",8,"ð"),u=B(e,"comingSoon",8,!0),c,p=Ne({});function h(Ee){Ee&&y(p,{...o(p),...Ee});const ze=bt.getViewData(i());ze&&y(p,ze)}function v(){bt.setViewData(i(),o(p))}function m(){return o(p)}function w(Ee){y(p,{...o(p),...Ee})}async function b(){return!0}an(()=>{c=bt.addNavigationGuard(b),h()}),lr(()=>{c&&bt.removeNavigationGuard(c),v()});function k(Ee){console.log(`${i()} action:`,Ee),Xe(p,o(p).lastAction=Ee),Xe(p,o(p).actionTime=new Date().toISOString()),bt.setViewData(i(),o(p))}gt();var I=Qf(),C=f(I),L=f(C),E=f(L),N=f(E),z=g(E,2),H=f(z),W=f(H),O=g(H,2),T=f(O),G=g(L,2);{var U=Ee=>{var ze=$f();_(Ee,ze)};j(G,Ee=>{u()&&Ee(U)})}var F=g(C,2),D=f(F),M=f(D),le=f(M),J=f(le),ge=g(M,2),X=f(ge),we=g(ge,2),he=f(we),Ce=g(we,2),se=f(Ce),Q=f(se),ve=g(se,2),Z=f(ve);{var ue=Ee=>{var ze=Hf(),$=Ze(ze),V=f($),Y=g($,2),te=f(Y),Te=g(Y,2),q=f(Te),fe=g(Te,2),ae=f(fe);R((xe,Ie,Ae,Le)=>{x(V,`ð ${xe??""}`),x(te,`ð ${Ie??""}`),x(q,`ð ${Ae??""}`),x(ae,`ðï¸ ${Le??""}`)},[()=>n()("File listing and management"),()=>n()("Search and filter files"),()=>n()("Add/remove manifest items"),()=>n()("Preview file contents")],de),_(Ee,ze)},Fe=(Ee,ze)=>{{var $=Y=>{var te=qf(),Te=Ze(te),q=f(Te),fe=g(Te,2),ae=f(fe),xe=g(fe,2),Ie=f(xe),Ae=g(xe,2),Le=f(Ae);R((We,ye,Oe,Be)=>{x(q,`ð ${We??""}`),x(ae,`ð ${ye??""}`),x(Ie,`ð ${Oe??""}`),x(Le,`ð¯ ${Be??""}`)},[()=>n()("Table of contents editing"),()=>n()("Navigation link management"),()=>n()("TOC structure editing"),()=>n()("Auto-generation from spine")],de),_(Y,te)},V=(Y,te)=>{{var Te=fe=>{var ae=Vf(),xe=Ze(ae),Ie=f(xe),Ae=g(xe,2),Le=f(Ae),We=g(Ae,2),ye=f(We),Oe=g(We,2),Be=f(Oe);R((Me,S,K,re)=>{x(Ie,`ð ${Me??""}`),x(Le,`ð ${S??""}`),x(ye,`ð ${K??""}`),x(Be,`ð ${re??""}`)},[()=>n()("Chapter ordering interface"),()=>n()("Drag-and-drop reordering"),()=>n()("Spine item management"),()=>n()("Link to source files")],de),_(fe,ae)},q=(fe,ae)=>{{var xe=Ae=>{var Le=Gf(),We=Ze(Le),ye=f(We),Oe=g(We,2),Be=f(Oe),Me=g(Oe,2),S=f(Me),K=g(Me,2),re=f(K);R((Se,De,A,ee)=>{x(ye,`âï¸ ${Se??""}`),x(Be,`ð¨ ${De??""}`),x(S,`ð¾ ${A??""}`),x(re,`ð§ ${ee??""}`)},[()=>n()("Application preferences"),()=>n()("Theme and UI settings"),()=>n()("Export/import settings"),()=>n()("Advanced configurations")],de),_(Ae,Le)},Ie=Ae=>{var Le=Xf(),We=Ze(Le),ye=f(We),Oe=g(We,2),Be=f(Oe),Me=g(Oe,2),S=f(Me),K=g(Me,2),re=f(K);R((Se,De,A,ee)=>{x(ye,`ð ${Se??""}`),x(Be,`ð ${De??""}`),x(S,`ð ${A??""}`),x(re,`ð¡ ${ee??""}`)},[()=>n()("Enhanced functionality"),()=>n()("Improved user interface"),()=>n()("Seamless integration"),()=>n()("New capabilities")],de),_(Ae,Le)};j(fe,Ae=>{i()==="settings"?Ae(xe):Ae(Ie,!1)},ae)}};j(Y,fe=>{i()==="spine"?fe(Te):fe(q,!1)},te)}};j(Ee,Y=>{i()==="navigation"?Y($):Y(V,!1)},ze)}};j(Z,Ee=>{i()==="manifest"?Ee(ue):Ee(Fe,!1)})}var je=g(Ce,2),Ge=f(je),ne=f(Ge),be=g(Ge,2),me=f(be);me.__click=[Kf,k];var _e=f(me),Pe=g(me,2);Pe.__click=[Yf,k];var $e=f(Pe),He=g(Pe,2);He.__click=[Jf];var Je=f(He),at=g(je,2);{var ce=Ee=>{var ze=Zf(),$=g(f(ze),2),V=f($);R((Y,te,Te)=>x(V,`${Y??""}: ${o(p).lastAction??""}
            ${te??""}
            ${Te??""}`),[()=>n()("Last action"),()=>n()("at"),()=>new Date(o(p).actionTime).toLocaleTimeString()],de),_(Ee,ze)};j(at,Ee=>{o(p).lastAction&&Ee(ce)})}R((Ee,ze,$,V,Y,te,Te)=>{x(N,d()),x(W,s()),x(T,l()),x(J,d()),x(X,Ee),x(he,ze),x(Q,`${$??""}:`),x(ne,`${V??""}:`),x(_e,Y),x($e,te),x(Je,Te)},[()=>n()("Coming Soon"),()=>n()("The {title} interface will be implemented in Phase 3 of the EDITME development. This will include full content management capabilities.",{title:s().toLowerCase()}),()=>n()("Planned Features"),()=>n()("Navigation Demo"),()=>n()("Demo Action 1"),()=>n()("Demo Action 2"),()=>n()("Back to Projects")],de),_(r,I),Pt(e,"onViewEnter",h),Pt(e,"onViewLeave",v),Pt(e,"getViewData",m),Pt(e,"setViewData",w),Pt(e,"canLeave",b);var ke=et({onViewEnter:h,onViewLeave:v,getViewData:m,setViewData:w,canLeave:b});return a(),ke}_t(["click"]);function ep(r,e){e.onPaneToggle?.()}function tp(r,e){e.onForceUpdate?.()}var np=P('<div class="status-indicator transforming svelte-1o393xc" title="Transform in progress"><div class="status-spinner svelte-1o393xc"></div> <span class="svelte-1o393xc">Transforming...</span></div>'),rp=P('<div class="status-indicator error svelte-1o393xc" title="Transform error"><span class="status-icon svelte-1o393xc">â ï¸</span> <span class="svelte-1o393xc">Error</span></div>'),ap=P('<div class="status-indicator error svelte-1o393xc" title="Syntax error prevents transform"><span class="status-icon svelte-1o393xc">â ï¸</span> <span class="svelte-1o393xc">Syntax Error</span></div>'),ip=P('<div class="status-indicator warning svelte-1o393xc"><span class="status-icon svelte-1o393xc">â ï¸</span> <span class="svelte-1o393xc"> </span></div>'),sp=P('<div class="status-indicator success svelte-1o393xc" title="Transform successful"><span class="status-icon svelte-1o393xc">â</span> <span class="svelte-1o393xc"> </span></div>'),op=(r,e)=>e(2,r),lp=P('<option class="svelte-1o393xc"> </option>'),cp=P('<div class="pane-error-overlay svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">â ï¸</span> <span class="error-message svelte-1o393xc"> </span></div>'),dp=P('<div class="editor-pane pane-2 svelte-1o393xc"><div class="pane-header svelte-1o393xc"><select class="file-selector svelte-1o393xc" aria-label="Select file for pane 2"><option disabled class="svelte-1o393xc">Select file...</option><!></select></div> <div class="textarea-container svelte-1o393xc"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 2 content"></textarea> <!></div></div>'),up=(r,e)=>e(1,r),fp=P('<option class="svelte-1o393xc"> </option>'),pp=P('<div class="pane-error-overlay svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">â ï¸</span> <span class="error-message svelte-1o393xc"> </span></div>'),hp=P('<details class="error-stack svelte-1o393xc"><summary class="svelte-1o393xc">Stack Trace</summary> <pre class="svelte-1o393xc"> </pre></details>'),vp=P('<div class="error-display svelte-1o393xc"><div class="error-header svelte-1o393xc"><span class="error-icon svelte-1o393xc" aria-hidden="true">ð¨</span> <strong class="svelte-1o393xc"> </strong></div> <div class="error-message svelte-1o393xc"> </div> <!></div>'),mp=P('<li class="svelte-1o393xc"> </li>'),gp=P('<div class="warnings-display svelte-1o393xc"><div class="warnings-header svelte-1o393xc"><span class="warning-icon svelte-1o393xc" aria-hidden="true">â ï¸</span> <strong class="svelte-1o393xc"> </strong></div> <ul class="warnings-list svelte-1o393xc"></ul></div>'),wp=P('<div class="editor-pane-container svelte-1o393xc"><div class="editor-header svelte-1o393xc"><div class="editor-controls svelte-1o393xc"><button type="button" class="pane-toggle-btn svelte-1o393xc"><span class="toggle-icon svelte-1o393xc" aria-hidden="true"> </span> <span class="toggle-label svelte-1o393xc"> </span></button></div> <div class="editor-status svelte-1o393xc"><!> <button type="button" class="force-update-btn svelte-1o393xc" title="Force immediate preview update">ð</button></div></div> <div class="editor-content svelte-1o393xc"><div><!> <div class="editor-pane pane-1 svelte-1o393xc"><div class="pane-header svelte-1o393xc"><select class="file-selector svelte-1o393xc" aria-label="Select file for pane 1"><option disabled class="svelte-1o393xc">Select file...</option><!></select></div> <div class="textarea-container svelte-1o393xc"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 1 content"></textarea> <!></div></div></div></div> <!> <!></div>');function yp(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(I(),"$pane1FileStore",t),i=()=>Ye(C(),"$pane2FileStore",t),s=()=>Ye(pt,"$t",t);let l=B(e,"transformError",3,null),d=B(e,"transformWarnings",19,()=>[]),u=B(e,"isTransforming",3,!1),c=B(e,"executionTime",3,0),p=B(e,"availableFiles1",19,()=>[]),h=B(e,"availableFiles2",19,()=>[]),v=B(e,"editorMode",3,"single"),m=B(e,"pane1SelectedFile",3,""),w=B(e,"pane2SelectedFile",3,""),b=B(e,"pane1Error",15),k=B(e,"pane2Error",15),I=B(e,"pane1FileStore",3,null),C=B(e,"pane2FileStore",3,null);B(e,"onPreviewClick",3,null);function L(q,fe){const ae=fe.target,Ie=(q===1?p():h()).find(Ae=>Ae.value===ae.value);Ie&&e.onFileSelect?.(q,Ie.path,Ie.type)}function E(q){const fe=q.target.value;if(!I()){console.warn("ð« No file store available for input in pane 1");return}const ae=e.contentService.validateFileContent(fe,m());if(ae){b(ae);return}else b(null);I().updateContent(fe)}function N(q){const fe=q.target.value;if(!C()){console.warn("ð« No file store available for input in pane 2");return}const ae=e.contentService.validateFileContent(fe,w());if(ae){k(ae);return}else k(null);C().updateContent(fe)}function z(q){return q.includes("css")?"syntax-css":q.includes("javascript")||q.includes("js")||q.includes("transform")?"syntax-js":"syntax-text"}function H(q){return q.includes("css")||q.includes("javascript")||q.includes("js")||q.includes("transform")}function W(q){return q==="text"?`Enter your chapter content here...

This will be transformed to XHTML using your configured text transform script.`:q.includes("css")?`/* Stylesheet content */

body {
  /* Your styles here */
}`:q.includes("javascript")||q.includes("js")?`// JavaScript content

(function() {
  // Your code here
})();`:q.includes("transform")?`// Transform script

function transform(input) {
  // Your transform logic here
  return input;
}`:""}function O(q){return q<1e3?`${q}ms`:`${(q/1e3).toFixed(1)}s`}let T=Ue(void 0),G=Ue(void 0);function U(q){let fe=q.trim();return fe=fe.split("").map(ae=>{const xe=ae.charCodeAt(0);return xe===8217||xe===8216?"'":xe===8221||xe===8220?'"':ae}).join(""),fe=fe.replace(/[""ââ]/g,'"'),fe=fe.replace(/\s+/g," "),fe}function F(q){const{text:fe}=q;let ae=null,xe="";if(I()&&m()&&o(T)&&n()?.content?(ae=o(T),xe=n().content):C()&&w()&&o(G)&&i()?.content&&(ae=o(G),xe=i().content),!ae||!xe)return;const Ie=fe.trim(),Ae=U(Ie),Le=xe.toLowerCase(),We=Ae.toLowerCase();let ye=Le.indexOf(We);if(ye!==-1){D(ae,ye,ye+Ae.length);return}if(Ie.length>=8){const Oe=Ie.toLowerCase();if(ye=Le.indexOf(Oe),ye!==-1){D(ae,ye,ye+Ie.length);return}}}function D(q,fe,ae){q.focus(),q.setSelectionRange(fe,ae);const Ie=q.value.substring(0,fe).split(`
`).length-1,Ae=parseInt(getComputedStyle(q).lineHeight)||20,Le=Ie*Ae;q.scrollTop=Math.max(0,Le-q.clientHeight/2)}var M=wp(),le=f(M),J=f(le),ge=f(J);ge.__click=[ep,e];var X=f(ge),we=f(X),he=g(X,2),Ce=f(he),se=g(J,2),Q=f(se);{var ve=q=>{var fe=np();_(q,fe)},Z=(q,fe)=>{{var ae=Ie=>{var Ae=rp();_(Ie,Ae)},xe=(Ie,Ae)=>{{var Le=ye=>{var Oe=ap();_(ye,Oe)},We=(ye,Oe)=>{{var Be=S=>{var K=ip(),re=g(f(K),2),Se=f(re);R(()=>{pe(K,"title",`${d().length} warnings`),x(Se,`${d().length??""} warnings`)}),_(S,K)},Me=S=>{var K=sp(),re=g(f(K),2),Se=f(re);R(De=>x(Se,De),[()=>O(c())]),_(S,K)};j(ye,S=>{d().length>0?S(Be):S(Me,!1)},Oe)}};j(Ie,ye=>{b()||k()?ye(Le):ye(We,!1)},Ae)}};j(q,Ie=>{l()&&l().stage!=="syntax-validation"?Ie(ae):Ie(xe,!1)},fe)}};j(Q,q=>{u()?q(ve):q(Z,!1)})}var ue=g(Q,2);ue.__click=[tp,e];var Fe=g(le,2),je=f(Fe);let Ge;var ne=f(je);{var be=q=>{var fe=dp(),ae=f(fe),xe=f(ae);Ir(xe,w);var Ie;xe.__change=[op,L];var Ae=f(xe);Ae.value=Ae.__value="";var Le=g(Ae);kt(Le,17,h,It,(S,K)=>{var re=lp(),Se={},De=f(re);R(()=>{Se!==(Se=o(K).value)&&(re.value=(re.__value=o(K).value)??""),x(De,o(K).label)}),_(S,re)});var We=g(ae,2),ye=f(We);let Oe;ye.__input=N,Nt(ye,S=>y(G,S),()=>o(G));var Be=g(ye,2);{var Me=S=>{var K=cp(),re=g(f(K),2),Se=f(re);R(()=>x(Se,k())),_(S,K)};j(Be,S=>{k()&&S(Me)})}R((S,K,re,Se)=>{Ie!==(Ie=w())&&(xe.value=(xe.__value=w())??"",Un(xe,w())),Oe=st(ye,1,`content-textarea ${S??""}`,"svelte-1o393xc",Oe,K),En(ye,C()&&i()?.content||""),pe(ye,"placeholder",re),pe(ye,"spellcheck",w()==="text"),pe(ye,"dir",Se),ye.dir=ye.dir},[()=>z(w()),()=>({"has-error":k()}),()=>W(w()),()=>H(w())?"ltr":void 0]),_(q,fe)};j(ne,q=>{v()==="dual"&&q(be)})}var me=g(ne,2),_e=f(me),Pe=f(_e);Ir(Pe,m);var $e;Pe.__change=[up,L];var He=f(Pe);He.value=He.__value="";var Je=g(He);kt(Je,17,p,It,(q,fe)=>{var ae=fp(),xe={},Ie=f(ae);R(()=>{xe!==(xe=o(fe).value)&&(ae.value=(ae.__value=o(fe).value)??""),x(Ie,o(fe).label)}),_(q,ae)});var at=g(_e,2),ce=f(at);let ke;ce.__input=E,Nt(ce,q=>y(T,q),()=>o(T));var Ee=g(ce,2);{var ze=q=>{var fe=pp(),ae=g(f(fe),2),xe=f(ae);R(()=>x(xe,b())),_(q,fe)};j(Ee,q=>{b()&&q(ze)})}var $=g(Fe,2);{var V=q=>{var fe=vp(),ae=f(fe),xe=g(f(ae),2),Ie=f(xe),Ae=g(ae,2),Le=f(Ae),We=g(Ae,2);{var ye=Oe=>{var Be=hp(),Me=g(f(Be),2),S=f(Me);R(()=>x(S,l().stack)),_(Oe,Be)};j(We,Oe=>{l().stack&&Oe(ye)})}R(()=>{x(Ie,`Transform Error (${l().stage??""})`),x(Le,l().message)}),_(q,fe)};j($,q=>{l()&&l().stage!=="syntax-validation"&&q(V)})}var Y=g($,2);{var te=q=>{var fe=gp(),ae=f(fe),xe=g(f(ae),2),Ie=f(xe),Ae=g(ae,2);kt(Ae,21,d,It,(Le,We)=>{var ye=mp(),Oe=f(ye);R(()=>x(Oe,o(We))),_(Le,ye)}),R(()=>x(Ie,`${d().length??""} Warnings`)),_(q,fe)};j(Y,q=>{d().length>0&&q(te)})}R((q,fe,ae,xe,Ie,Ae)=>{pe(ge,"title",v()==="single"?"Add second editor pane":"Switch to single pane"),x(we,v()==="single"?"â":"â"),x(Ce,q),ue.disabled=u(),Ge=st(je,1,"editor-panes svelte-1o393xc",null,Ge,fe),$e!==($e=m())&&(Pe.value=(Pe.__value=m())??"",Un(Pe,m())),ke=st(ce,1,`content-textarea ${ae??""}`,"svelte-1o393xc",ke,xe),En(ce,I()&&n()?.content||""),pe(ce,"placeholder",Ie),pe(ce,"spellcheck",m()==="text"),pe(ce,"dir",Ae),ce.dir=ce.dir},[()=>v()==="single"?s()("Split Pane"):s()("Single Pane"),()=>({"dual-mode":v()==="dual"}),()=>z(m()),()=>({"has-error":b()}),()=>W(m()),()=>H(m())?"ltr":void 0]),_(r,M);var Te=et({findAndSelectText:F});return a(),Te}_t(["click","change","input"]);function bp(r,e,t,a){y(e,o(e)==="portrait"?"landscape":"portrait",!0),t(o(a))}function xp(r,e,t,a,n,i){console.log("ð CLICK EVENT FIRED! toggleSourceView() called"),console.log("ð Current showSource state:",o(e));const s=o(e);y(e,!o(e)),console.log("ð State toggled from",s,"to",o(e)),o(e)||(console.log("ð About to call updatePreviewContent and re-apply device settings"),setTimeout(()=>{console.log("ð updatePreviewContent called"),t(a()),n(o(i))},0)),console.log("ð toggleSourceView completed")}var _p=P('<button type="button" class="orientation-toggle svelte-32psnf" title="Toggle orientation" aria-label="Toggle device orientation"> </button>'),Sp=(r,e)=>e(r.target.value),Ep=P('<option class="svelte-32psnf"> </option>'),kp=P('<optgroup class="svelte-32psnf"></optgroup>'),Tp=P('<div class="transform-status transforming svelte-32psnf"><div class="status-spinner svelte-32psnf"></div> <span class="svelte-32psnf">Transforming content...</span></div>'),Cp=P('<div class="transform-status error svelte-32psnf"><span class="status-icon svelte-32psnf">ð¨</span> <span class="svelte-32psnf"> </span></div>'),Ip=P('<div class="transform-status warning svelte-32psnf"><span class="status-icon svelte-32psnf">â ï¸</span> <span class="svelte-32psnf"> </span></div>'),Fp=P('<div class="source-view svelte-32psnf"><pre class="source-code svelte-32psnf" dir="ltr"> </pre></div>'),Pp=P('<details class="svelte-32psnf"><summary class="svelte-32psnf">Stack Trace</summary> <pre class="error-stack svelte-32psnf"> </pre></details>'),Mp=P('<div class="preview-error svelte-32psnf"><div class="error-content svelte-32psnf"><h3 class="svelte-32psnf">Transform Error</h3> <p class="svelte-32psnf"><strong class="svelte-32psnf">Stage:</strong> </p> <p class="svelte-32psnf"><strong class="svelte-32psnf">Message:</strong> </p> <!></div></div>'),Lp=P('<iframe class="preview-iframe svelte-32psnf" title="XHTML Preview"></iframe>'),Dp=P('<div class="preview-empty svelte-32psnf"><div class="empty-content svelte-32psnf"><span class="empty-icon svelte-32psnf" aria-hidden="true">ð</span> <h3 class="svelte-32psnf">No Content</h3> <p class="svelte-32psnf">Start typing in the editor to see your XHTML preview here.</p></div></div>'),Rp=P('<div class="preview-viewport svelte-32psnf"><div class="preview-frame-wrapper svelte-32psnf"><div><!></div></div></div>'),Up=P('<span class="update-time svelte-32psnf"> </span>'),Ap=P('<span class="content-size svelte-32psnf"> </span>'),Op=P('<span class="warning-count svelte-32psnf"> </span>'),zp=P('<div class="preview-pane-container svelte-32psnf"><div class="preview-header svelte-32psnf"><div class="preview-title svelte-32psnf"><button title="Toggle source view"> </button></div> <div class="preview-controls svelte-32psnf"><!>  <select class="device-selector svelte-32psnf"></select></div></div> <!> <div class="preview-content svelte-32psnf"><!></div> <div class="preview-footer svelte-32psnf"><div class="meta-info svelte-32psnf"><!> <!> <!></div></div></div>');function Wp(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=()=>Ye(N,"$lastUpdateTime",t);let s=B(e,"xhtmlContent",3,""),l=B(e,"isTransforming",3,!1),d=B(e,"transformError",3,null),u=B(e,"transformWarnings",19,()=>[]);B(e,"executionTime",3,0);let c=B(e,"onPreviewClick",3,null);const p=[{id:"desktop",name:"Fill",width:"100%",height:"100%",icon:"ð¥ï¸",category:"responsive"},{id:"galaxy-s23",name:"Pocket",width:"360px",height:"800px",icon:"ð±",category:"commute"},{id:"iphone",name:"Standard",width:"375px",height:"667px",icon:"ð±",category:"commute"},{id:"pixel-7",name:"Large",width:"393px",height:"851px",icon:"ð±",category:"commute"},{id:"iphone-plus",name:"Plus",width:"414px",height:"736px",icon:"ð±",category:"commute"},{id:"ipad",name:"Compact",width:"768px",height:"1024px",icon:"ð±",category:"home"},{id:"galaxy-tab-s9",name:"Large",width:"800px",height:"1280px",icon:"ð±",category:"home"},{id:"ipad-air",name:"Extra Large",width:"820px",height:"1180px",icon:"ð±",category:"home"},{id:"kindle",name:"Standard",width:"600px",height:"800px",icon:"ð",category:"travel"},{id:"kobo-clara-2e",name:"Large",width:"758px",height:"1024px",icon:"ð",category:"travel"}],h=$=>{switch($){case"responsive":return n()("Responsive");case"commute":return n()("Commute (phone)");case"home":return n()("Home (tablet)");case"travel":return n()("Travel (e-ink)");default:return $}},v=$=>{switch($.name){case"Fill":return n()("Fill");case"Pocket":return n()("Pocket");case"Standard":return n()("Standard");case"Large":return n()("Large");case"Plus":return n()("Plus");case"Compact":return n()("Compact");case"Extra Large":return n()("Extra Large");default:return $.name}};let m=Ue("desktop"),w=Ue("portrait"),b=Ue(!1),k=Ue(void 0),I=Ue(void 0),C=Ue(void 0),L=Ue(1),E=Ue(null);const N=Jt(Date.now()),z=oe(()=>{const $={};for(const V of p)$[V.category]||($[V.category]=[]),$[V.category].push(V);return $});xt(()=>{O(s())});function H($){try{const V=$.documentElement,Y=V.scrollTop||$.body.scrollTop,te=V.clientWidth/2,Te=Math.min(100,V.clientHeight/4),q=$.elementFromPoint(te,Te);if(!q||q===$.body||q===V)return{element:null,id:null,offset:Y};let fe=q;for(;fe&&fe!==$.body;){if(fe.id){const Ae=fe.getBoundingClientRect(),Le=Y-(Ae.top+Y-Te);return{element:fe,id:fe.id,offset:Le}}fe=fe.parentElement}const ae=q.tagName.toLowerCase(),Ie=Array.from($.querySelectorAll(ae)).indexOf(q);if(Ie>=0){const Ae=q.getBoundingClientRect(),Le=Y-(Ae.top+Y-Te);return{element:q,id:`${ae}[${Ie}]`,offset:Le}}return{element:null,id:null,offset:Y}}catch(V){return console.warn("Failed to find scroll anchor:",V),null}}function W($,V,Y){if(!V){$.documentElement.scrollTop=Y,$.body&&($.body.scrollTop=Y);return}try{let te=null;if(V.id)if(V.id.includes("[")&&V.id.includes("]")){const[Te,q]=V.id.split("["),fe=parseInt(q.replace("]",""),10);te=$.querySelectorAll(Te)[fe]||null}else te=$.getElementById(V.id);if(te){if(te.scrollIntoView({behavior:"instant",block:"start"}),V.offset!==0){const Te=$.documentElement.scrollTop||$.body?.scrollTop||0,q=Math.max(0,Te+V.offset);$.documentElement.scrollTop=q,$.body&&($.body.scrollTop=q)}}else $.documentElement.scrollTop=Y,$.body&&($.body.scrollTop=Y)}catch(te){console.warn("Failed to restore scroll position:",te),$.documentElement.scrollTop=Y,$.body&&($.body.scrollTop=Y)}}function O($){if(!(!o(k)||!$))try{const V=o(k).contentDocument;if(!V)return;const Y=V.documentElement.scrollTop||V.body?.scrollTop||0,te=Y>0?H(V):null;y(E,{anchor:te,fallbackScrollTop:Y},!0),V.open(),V.write($),V.close(),N.set(Date.now())}catch(V){console.error("Failed to update preview content:",V)}}function T($){const V=parseInt($.width.replace("px","")),Y=parseInt($.height.replace("px",""));return o(w)==="landscape"?{width:Y,height:V}:{width:V,height:Y}}function G($){if($.id==="desktop")return 1;try{if(!o(C))return 1;const V=o(C).getBoundingClientRect(),Y=Math.max(200,V.width-40),te=Math.max(200,V.height-40),{width:Te,height:q}=T($),fe=Y/te,ae=Te/q;let xe;return fe>ae?xe=te/q:xe=Y/Te,Math.min(Math.max(xe,.1),2)}catch(V){return console.warn("Failed to calculate optimal scale:",V),1}}function U($){y(m,$,!0);const V=p.find(Y=>Y.id===$);if(V&&o(I)){const Y=o(I).parentElement;V.id==="desktop"?(o(I).style.width="100%",o(I).style.height="100%",o(I).style.maxWidth="none",o(I).style.maxHeight="none",Y&&(Y.style.width="100%",Y.style.height="100%"),y(L,1)):setTimeout(()=>{if(o(I)){const te=G(V),{width:Te,height:q}=T(V);o(I).style.width=Te+"px",o(I).style.height=q+"px",o(I).style.maxWidth=Te+"px",o(I).style.maxHeight=q+"px",Y&&(Y.style.width=Math.round(Te*te)+"px",Y.style.height=Math.round(q*te)+"px"),y(L,te,!0)}},0)}}function F($){return new Date($).toLocaleTimeString()}function D($){const V=o(k)?.contentDocument;if(!V)return 0;try{const Y=V.createTreeWalker(V.body,NodeFilter.SHOW_TEXT,null);let te=0,Te;for(;(Te=Y.nextNode())&&!$.contains(Te);)te+=Te.textContent?.length||0;return te}catch(Y){return console.warn("Failed to estimate document position:",Y),0}}function M($){if(!c())return;const V=$.target;if(!V)return;const Y=V.closest("p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th")||V,te=Y.textContent?.trim();if(!(!te||te.length<8)&&!(te.length>500))try{const Te=D(Y),q=Y.tagName.toLowerCase();c()({text:te,documentPosition:Te,elementType:q})}catch(Te){console.warn("Failed to handle preview click:",Te)}}function le($){$.addEventListener("click",M);const V=$.createElement("style");V.textContent=`
      body {
        /* margin: 0; */
        /* padding: 0; */
        /* font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; */
        /* line-height: 1.6; */
      }

      /* Ensure images are responsive */
      img {
        max-width: 100%;
        height: auto;
      }

      /* Add some visual feedback for empty content */
      body:empty::before {
        content: 'No content to preview';
        color: #666;
        font-style: italic;
        display: block;
        text-align: center;
        padding: 2rem;
      }

      /* Indicate clickable text elements */
      p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th {
        cursor: pointer;
      }

      /* Visual feedback on hover */
      p:hover, h1:hover, h2:hover, h3:hover, h4:hover, h5:hover, h6:hover,
      div:hover, span:hover, li:hover, blockquote:hover, td:hover, th:hover {
        /* background-color: rgba(59, 130, 246, 0.1); */
        outline: 1px solid rgba(59, 130, 246, 0.3);
        outline-offset: 1px;
      }
    `,$.head.appendChild(V)}function J(){if(o(k)?.contentDocument){const $=o(k).contentDocument;le($),o(E)&&requestAnimationFrame(()=>{W($,o(E).anchor,o(E).fallbackScrollTop),y(E,null)})}}let ge=null;an(()=>{U(o(m)),typeof ResizeObserver<"u"&&(ge=new ResizeObserver(()=>{setTimeout(()=>{U(o(m))},400)}),o(C)&&ge.observe(o(C)));const $=()=>{setTimeout(()=>U(o(m)),400)};return window.addEventListener("resize",$),()=>{ge?.disconnect(),window.removeEventListener("resize",$)}});var X=zp(),we=f(X),he=f(we),Ce=f(he);let se;Ce.__click=[xp,b,O,s,U,m];var Q=f(Ce),ve=g(he,2),Z=f(ve);{var ue=$=>{var V=_p();V.__click=[bp,w,U,m];var Y=f(V);R(()=>x(Y,o(w)==="portrait"?"â­":"â¯")),_($,V)};j(Z,$=>{o(m)!=="desktop"&&$(ue)})}var Fe=g(Z,2);Fe.__change=[Sp,U],kt(Fe,21,()=>Object.entries(o(z)),It,($,V)=>{var Y=oe(()=>Mo(o(V),2));let te=()=>o(Y)[0],Te=()=>o(Y)[1];var q=kp();kt(q,21,Te,It,(fe,ae)=>{var xe=Ep(),Ie={},Ae=f(xe);R(Le=>{Ie!==(Ie=o(ae).id)&&(xe.value=(xe.__value=o(ae).id)??""),x(Ae,`${o(ae).icon??""}
                ${Le??""}`)},[()=>v(o(ae))]),_(fe,xe)}),R(fe=>pe(q,"label",fe),[()=>h(te())]),_($,q)});var je=g(we,2);{var Ge=$=>{var V=Tp();_($,V)},ne=($,V)=>{{var Y=Te=>{var q=Cp(),fe=g(f(q),2),ae=f(fe);R(()=>x(ae,`Transform failed: ${d().message??""}`)),_(Te,q)},te=(Te,q)=>{{var fe=ae=>{var xe=Ip(),Ie=g(f(xe),2),Ae=f(Ie);R(()=>x(Ae,`${u().length??""} warnings`)),_(ae,xe)};j(Te,ae=>{u().length>0&&ae(fe)},q)}};j($,Te=>{d()?Te(Y):Te(te,!1)},V)}};j(je,$=>{l()?$(Ge):$(ne,!1)})}var be=g(je,2),me=f(be);{var _e=$=>{var V=Fp(),Y=f(V),te=f(Y);R(()=>{x(te,s()||"\x3C!-- No content generated yet -->"),Y.dir=Y.dir}),_($,V)},Pe=$=>{var V=Rp(),Y=f(V),te=f(Y);let Te,q;var fe=f(te);{var ae=Ie=>{var Ae=Mp(),Le=f(Ae),We=g(f(Le),2),ye=g(f(We)),Oe=g(We,2),Be=g(f(Oe)),Me=g(Oe,2);{var S=K=>{var re=Pp(),Se=g(f(re),2),De=f(Se);R(()=>x(De,d().stack)),_(K,re)};j(Me,K=>{d().stack&&K(S)})}R(()=>{x(ye,` ${d().stage??""}`),x(Be,` ${d().message??""}`)}),_(Ie,Ae)},xe=(Ie,Ae)=>{{var Le=ye=>{var Oe=Lp();Nt(Oe,Be=>y(k,Be),()=>o(k)),Ke("load",Oe,J),_(ye,Oe)},We=ye=>{var Oe=Dp();_(ye,Oe)};j(Ie,ye=>{s()?ye(Le):ye(We,!1)},Ae)}};j(fe,Ie=>{d()?Ie(ae):Ie(xe,!1)})}Nt(te,Ie=>y(I,Ie),()=>o(I)),R(Ie=>{Te=st(te,1,"preview-frame-container svelte-32psnf",null,Te,Ie),q=li(te,"",q,{transform:o(m)!=="desktop"?`scale(${o(L)})`:"none","transform-origin":"top left"})},[()=>({"device-frame":o(m)!=="desktop"})]),_($,V)};j(me,$=>{o(b)?$(_e):$(Pe,!1)})}Nt(be,$=>y(C,$),()=>o(C));var $e=g(be,2),He=f($e),Je=f(He);{var at=$=>{var V=Up(),Y=f(V);R(te=>x(Y,`Updated: ${te??""}`),[()=>F(i())]),_($,V)};j(Je,$=>{i()&&$(at)})}var ce=g(Je,2);{var ke=$=>{var V=Ap(),Y=f(V);R(te=>x(Y,`${te??""}KB`),[()=>Math.round(s().length/1024)]),_($,V)};j(ce,$=>{s()&&$(ke)})}var Ee=g(ce,2);{var ze=$=>{var V=Op(),Y=f(V);R(()=>x(Y,`${u().length??""} warnings`)),_($,V)};j(Ee,$=>{u().length>0&&$(ze)})}R(($,V)=>{se=st(Ce,1,"view-toggle svelte-32psnf",null,se,$),x(Q,o(b)?"ðï¸":"ð"),pe(Fe,"aria-label",V)},[()=>({active:o(b)}),()=>n()("Select device preset")]),$s(Fe,()=>o(m),$=>y(m,$)),_(r,X),et(),a()}_t(["click","change"]);function Zi(r,e="Text"){return r.startsWith("../")||r.startsWith("./")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")||r.startsWith("/")?r:e&&e!==""?`../${r}`:r}function za(r,e="Text"){return!r.startsWith("../")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")?r:e&&e!==""&&r.startsWith("../")?r.substring(3):r}class Np{constructor(e,t,a,n,i,s){this.workspaceId=e,this.fileStorage=t,this.extensionManager=a,this.blobURLManager=n,this.transformEngine=i,this.settingsService=s}async executeTransform(e,t=3e3,a){try{const n=await this.loadTransformScripts();return await this.transformEngine.setTransformScripts(n),await this.transformEngine.executeTransform(e,t,a)}catch(n){return{success:!1,error:{stage:"communication",message:String(n?.message||n)}}}}async loadTransformScripts(){try{const e={textTransform:"",domTransforms:[]};if(this.settingsService){const t=await this.settingsService.loadEPUBSettings(this.workspaceId);if(t.text_transform)try{e.textTransform=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${t.text_transform}`)}catch{console.warn(`Failed to load text transform script: ${t.text_transform}`)}if(t.dom_transforms&&t.dom_transforms.length>0){e.domTransforms=[];for(const a of t.dom_transforms)try{const n=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${a}`);e.domTransforms.push(n)}catch{console.warn(`Failed to load DOM transform script: ${a}`)}}}return e}catch(e){throw new Error(`Failed to load transform scripts: ${e instanceof Error?e.message:String(e)}`)}}async setDebugMode(e){try{await this.transformEngine.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async ping(e={}){return await this.transformEngine.ping({data:e})}cleanup(){}}class jp{transformPipeline;debounceTimer;currentContent;isTransforming=!1;lastTransformTime=0;workspaceId;fileStorage;extensionManager;blobURLManager;workspaceService;settingsService;transformEngine;config;onPreviewUpdate;onError;spineItemId;spineItem;constructor(e,t,a,n,i,s,l,d,u,c,p,h){this.workspaceId=e,this.fileStorage=a,this.extensionManager=n,this.blobURLManager=i,this.workspaceService=s,this.settingsService=l,this.transformEngine=d,this.config=u,this.onPreviewUpdate=c,this.onError=p,this.spineItemId=t,this.spineItem=h,this.transformPipeline=new Np(e,a,n,i,d,l),this.currentContent={text:""},this.blobURLManager.setActiveWorkspace(e)}async initialize(){await this.transformPipeline.loadTransformScripts()}updateContent(e,t){this.currentContent[e]=t,this.debounceRender()}async loadInitialContent(){try{try{this.currentContent.text=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/text/${this.spineItemId}.txt`)}catch{this.currentContent.text=""}this.debounceRender()}catch(e){this.handleError("initialization",e)}}getCurrentContent(){return{...this.currentContent}}debounceRender(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.renderPreview()},this.config.debounceMs)}async renderPreview(){if(this.isTransforming){this.debounceRender();return}this.isTransforming=!0;const e=performance.now();try{this.config.autoSave&&await this.autoSaveChangedContent();const t=await this.transformPipeline.executeTransform(this.currentContent.text,this.config.transformTimeout,this.spineItemId);if(!t.success){this.handleError("transform",t.error);return}const a=await this.generateChapterMetadata(),n=this.generateXHTML(t.html||"",a);this.config.persistToManifest&&await this.saveXHTMLToManifest(n);const i=await this.blobURLManager.processXHTMLForPreview(n),s=performance.now()-e;this.lastTransformTime=s,this.onPreviewUpdate({xhtml:i,warnings:t.warnings||[],executionTime:Math.round(s),timestamp:Date.now()})}catch(t){this.handleError("preview",t)}finally{this.isTransforming=!1}}async autoSaveChangedContent(){const e={success:!0,savedFiles:[],errors:[]},t={path:`SOURCE/text/${this.spineItemId}.txt`,content:this.currentContent.text,type:"text"};if(t.content.trim())try{await this.fileStorage.writeTextFile(this.workspaceId,t.path,t.content),e.savedFiles.push(t.path)}catch(a){e.success=!1,e.errors.push({file:t.path,error:a instanceof Error?a.message:String(a)})}return e}async saveXHTMLToManifest(e){try{const t=await this.workspaceService.loadWorkspace(this.workspaceId),a=t.opf.manifest.find(i=>i.id===this.spineItemId);if(!a){console.warn(`Manifest item not found for spine item: ${this.spineItemId}`);return}const n=this.resolveManifestPath(a.href,t.pathInfo.basePath);await this.workspaceService.writeFile(this.workspaceId,n,e),await this.updateSVGProperty(e,t,a)}catch(t){console.warn("Failed to save XHTML to manifest:",t)}}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}detectInlineSVG(e){try{return new DOMParser().parseFromString(e,"text/html").querySelectorAll("svg").length>0}catch(t){return console.warn("Failed to parse XHTML for SVG detection:",t),!1}}async updateSVGProperty(e,t,a){try{if(a.mediaType!=="application/xhtml+xml")return;const n=this.detectInlineSVG(e),i=a.properties||[],s=i.includes("svg");if(n&&!s)await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:[...i,"svg"]});else if(!n&&s){const l=i.filter(d=>d!=="svg");await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:l.length>0?l:void 0})}}catch(n){console.warn("Failed to update SVG property:",n)}}async generateChapterMetadata(){const e=this.spineItemId;let t="en";try{t=(await this.workspaceService.loadWorkspace(this.workspaceId))?.opf?.metadata?.language||"en"}catch(i){console.warn("Could not load workspace language, using default:",i)}const a=[],n=[];try{const i=await this.workspaceService.loadWorkspace(this.workspaceId);i.opf.manifest.filter(s=>s.mediaType==="text/css").forEach(s=>{a.push(s.href)}),i.opf.manifest.filter(s=>s.mediaType==="text/javascript"||s.mediaType==="application/javascript").forEach(s=>{n.push(s.href)})}catch{}return{title:e,language:t,stylesheets:a,scripts:n}}generateXHTML(e,t){const a=t.stylesheets.map(i=>`  <link rel="stylesheet" type="text/css" href="${this.escapeHtml(Zi(i))}" />`).join(`
`),n=t.scripts.map(i=>`  <script src="${this.escapeHtml(Zi(i))}"><\/script>`).join(`
`);return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="${this.escapeHtml(t.language)}" lang="${this.escapeHtml(t.language)}">
<head>
  <title>${this.escapeHtml(t.title)}</title>
${a}
${n}
</head>
${e}
</html>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}handleError(e,t){const a={stage:e,message:t?.message||(typeof t=="string"?t:"Unknown error"),stack:t?.stack};this.onError({error:a,stage:e,timestamp:Date.now()})}getStats(){return{isTransforming:this.isTransforming,lastTransformTime:this.lastTransformTime,contentLength:{text:this.currentContent.text.length}}}async forcePreviewUpdate(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),await this.renderPreview()}async setDebugMode(e){try{await this.transformPipeline.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async pingTransformPipeline(){try{return await this.transformPipeline.ping({timestamp:Date.now()}),!0}catch(e){return console.warn("Transform pipeline ping failed:",e),!1}}async switchToSpineItem(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.isTransforming=!1,this.lastTransformTime=0,this.spineItemId=e,this.spineItem=t,this.currentContent={text:""};try{await this.loadInitialContent()}catch(a){console.warn("Failed to load initial content for spine item switch:",a)}}cleanup(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.transformPipeline.cleanup(),this.blobURLManager.cleanup(),this.isTransforming=!1,this.lastTransformTime=0}}function Bp(r,e,t,a,n,i,s,l,d={},u,c,p){const v={...{debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0},...d};return new jp(r,e,t,a,n,i,s,l,v,u,c,p)}const $p={debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0};class Sr extends Error{constructor(e,t){super(e),this.code=t,this.name="BlobURLError"}}class Vr extends Sr{constructor(e,t){super(`Blob URL capacity exceeded: ${e}/${t}`,"CAPACITY_EXCEEDED")}}class Qi extends Sr{constructor(e,t){super(e,"XHTML_PROCESSING_ERROR"),this.originalError=t}}class mo{activeWorkspaceId=null;registry;fileStorage;basePath;supportsDirectBlobs;onCapacityReached;constructor(e){this.fileStorage=e.fileStorage,this.basePath=e.basePath,this.onCapacityReached=e.onCapacityReached,this.registry={urls:new Map,created:new Map,count:0,maxCount:e.maxBlobURLs||100},this.supportsDirectBlobs=this.fileStorage.supportsDirectBlobURLs()}setActiveWorkspace(e){this.activeWorkspaceId!==e&&(this.cleanup(),this.activeWorkspaceId=e)}async createBlobURL(e){if(this.registry.count>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.registry.count,this.registry.maxCount);if(this.registry.urls.has(e))return this.registry.urls.get(e);if(!this.activeWorkspaceId)throw new Sr("No active workspace set","NO_WORKSPACE");const t=this.resolveManifestPath(e);try{let a;const n=e.toLowerCase().endsWith(".css");if(this.supportsDirectBlobs&&!n){const i=await this.fileStorage.getFile(this.activeWorkspaceId,t),s=this.getMimeType(e),l=new File([i],i.name,{type:s});a=URL.createObjectURL(l)}else{let i;if(n){const d=await this.fileStorage.readTextFile(this.activeWorkspaceId,t),u=await this.processCSSFontURLs(d);i=new TextEncoder().encode(u).buffer}else i=await this.fileStorage.readFile(this.activeWorkspaceId,t);const s=this.getMimeType(e),l=new Blob([i],{type:s});a=URL.createObjectURL(l)}return this.addToRegistry(e,a),a}catch(a){throw new Sr(`Failed to create blob URL for ${e}: ${a instanceof Error?a.message:String(a)}`,"CREATION_FAILED")}}createBlobFromContent(e,t){const a=new Blob([e],{type:t});return URL.createObjectURL(a)}async processXHTMLForPreview(e){if(this.isAtCapacity())throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);try{const a=new DOMParser().parseFromString(e,"application/xhtml+xml");if(a.documentElement&&a.documentElement.tagName==="parsererror")throw new Qi("Invalid XHTML content");const n=this.findAssetElements(a);for(const s of n)await this.processAssetElement(s);return new XMLSerializer().serializeToString(a)}catch(t){throw t instanceof Sr?t:new Qi(`XHTML processing failed: ${t instanceof Error?t.message:String(t)}`,t instanceof Error?t:new Error(String(t)))}}revokeBlobURL(e){URL.revokeObjectURL(e),this.removeFromRegistry(e)}revokeFileBlob(e){const t=this.registry.urls.get(e);t&&this.revokeBlobURL(t)}cleanup(){for(const e of this.registry.urls.values())URL.revokeObjectURL(e);this.registry.urls.clear(),this.registry.created.clear(),this.registry.count=0}getMimeType(e){return po(e)}isResourcePath(e){return!e.startsWith("http")&&!e.startsWith("data:")&&!e.startsWith("blob:")&&!e.startsWith("/")&&!e.startsWith("ftp:")&&!e.startsWith("mailto:")&&!e.startsWith("tel:")&&!e.startsWith("file:")&&!e.startsWith("about:")&&!e.startsWith("javascript:")&&!e.startsWith("//")&&e.trim().length>0}getBlobURLCount(){return this.registry.count}isAtCapacity(){return this.registry.count>=this.registry.maxCount}resolveManifestPath(e){return this.basePath?`${this.basePath}/${e}`:e}findAssetElements(e){const t=[],a=["script[src]","link[href]","a[href]","audio[src]","video[src]","video[poster]","img[src]","object[data]","image[href]","*[data-src]"];for(const n of a){const i=e.querySelectorAll(n);t.push(...Array.from(i))}return t}async processAssetElement(e){let t;if(e.hasAttribute("src"))t="src";else if(e.hasAttribute("href"))t="href";else if(e.hasAttribute("data"))t="data";else if(e.hasAttribute("poster"))t="poster";else if(e.hasAttribute("data-src"))t="data-src";else return;const a=e.getAttribute(t);if(!(!a||!this.isResourcePath(a)))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);const n=za(a),i=await this.createBlobURL(n);e.setAttribute(t,i)}catch(n){this.handleMissingAsset(e,a,n)}}handleMissingAsset(e,t,a){const n=e.tagName.toLowerCase(),i=za(t),s=this.resolveManifestPath(i);if(["img","video","audio","object","image"].includes(n)){console.warn(`Missing image: ${s} (referenced by <${n}> element)`);const l=e.hasAttribute("src")?"src":e.hasAttribute("href")?"href":"data";e.setAttribute(l,this.getErrorIconSVG()),e.setAttribute("alt",`Missing: ${t}`)}else["script","link"].includes(n)&&console.warn(`Missing asset: ${s} (referenced by <${n}> element)`)}getErrorIconSVG(){return`data:image/svg+xml,${encodeURIComponent(`
      <svg width="24" height="24" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" fill="#f44336" stroke="#d32f2f"/>
        <text x="12" y="16" text-anchor="middle" fill="white" font-size="12">!</text>
      </svg>
    `)}`}addToRegistry(e,t){this.registry.urls.set(e,t),this.registry.created.set(e,new Date),this.registry.count++}removeFromRegistry(e){for(const[t,a]of this.registry.urls.entries())if(a===e){this.registry.urls.delete(t),this.registry.created.delete(t),this.registry.count--;break}}async processCSSFontURLs(e){const t=/url\(\s*(['"]?)(.*?)\1\s*\)/g;let a=e;const n=Array.from(e.matchAll(t));for(const i of n){const s=i[0],l=i[1],d=i[2];if(this.isResourcePath(d))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Vr(this.getBlobURLCount(),this.registry.maxCount);const u=za(d),c=await this.createBlobURL(u),p=`url(${l}${c}${l})`;a=a.replace(s,p)}catch(u){console.warn(`Failed to process CSS url(${d}):`,u)}}return a}getLoadedGlobals(){return{}}}class vr extends Error{constructor(e,t){super(e),this.code=t,this.name="SettingsServiceError"}}class Zn{constructor(e,t,a,n){this.fileStorage=e,this.extensionManager=t,this.themeStore=a,this.i18nStore=n}static GLOBAL_SETTINGS_KEY="editme_global_settings";static SUPPORTED_LOCALES=new Set(["en","de","ar","he","ja","ka","zh-hant","fr","es","it","pt","ru","pl","nl","sv"]);static VALID_THEMES=new Set(["light","dark","system"]);loadGlobalSettings(){try{if(typeof localStorage>"u")return this.getDefaultGlobalSettings();const e=localStorage.getItem(Zn.GLOBAL_SETTINGS_KEY);if(!e)return this.getDefaultGlobalSettings();const t=JSON.parse(e);if(typeof t!="object"||!t)return this.getDefaultGlobalSettings();const a=this.getDefaultGlobalSettings();return{theme:this.isValidTheme(t.theme)?t.theme:a.theme,locale:this.isValidLocale(t.locale)?t.locale:a.locale,editor_font_size:this.isValidFontSize(t.editor_font_size)?t.editor_font_size:a.editor_font_size}}catch{return this.getDefaultGlobalSettings()}}saveGlobalSettings(e){try{if(typeof localStorage>"u")return;localStorage.setItem(Zn.GLOBAL_SETTINGS_KEY,JSON.stringify(e)),e.theme==="system"?this.themeStore.useSystemPreference():this.themeStore.setTheme(e.theme),this.i18nStore.setLocale(e.locale)}catch(t){throw new vr(`Failed to save global settings: ${t instanceof Error?t.message:"Unknown error"}`,"GLOBAL_SETTINGS_SAVE_ERROR")}}getDefaultGlobalSettings(){return{theme:"system",locale:"en",editor_font_size:14}}async loadWorkspaceSettings(e){try{const t=await this.fileStorage.readTextFile(e,".workspace-metadata.json"),a=JSON.parse(t),n=this.getDefaultWorkspaceSettings();return{bust_cache:a.bust_cache??n.bust_cache,draft_id:a.draft_id??n.draft_id,editor:{preview_delay_ms:a.editor?.preview_delay_ms??n.editor.preview_delay_ms,advanced_mode:a.editor?.advanced_mode??n.editor.advanced_mode}}}catch{return this.getDefaultWorkspaceSettings()}}async saveWorkspaceSettings(e,t){try{let a={};try{const i=await this.fileStorage.readTextFile(e,".workspace-metadata.json");a=JSON.parse(i)}catch{}const n={...a,bust_cache:t.bust_cache,draft_id:t.draft_id,editor:t.editor};await this.fileStorage.writeTextFile(e,".workspace-metadata.json",JSON.stringify(n,null,2))}catch(a){throw new vr(`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`,"WORKSPACE_SETTINGS_SAVE_ERROR")}}getDefaultWorkspaceSettings(){return{bust_cache:!1,draft_id:0,editor:{preview_delay_ms:500,advanced_mode:!1}}}async loadEPUBSettings(e){try{const t=await this.fileStorage.readTextFile(e,"SOURCE/settings.json"),a=JSON.parse(t),n=this.getDefaultEPUBSettings();return{text_transform:a.text_transform??n.text_transform,dom_transforms:a.dom_transforms??n.dom_transforms,spine_basename:a.spine_basename??n.spine_basename,cover:a.cover?{template:a.cover.template??"default",background_color:a.cover.background_color??"#ffffff",text_color:a.cover.text_color??"#000000",font_family:a.cover.font_family??"serif"}:void 0}}catch{return this.getDefaultEPUBSettings()}}async saveEPUBSettings(e,t){try{await this.fileStorage.writeTextFile(e,"SOURCE/settings.json",JSON.stringify(t,null,2))}catch(a){throw new vr(`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_SETTINGS_SAVE_ERROR")}}getDefaultEPUBSettings(){return{text_transform:"SOURCE/scripts/transformText.js",dom_transforms:["SOURCE/scripts/transformDom.js"],spine_basename:"chapter"}}async incrementDraftId(e){const t=await this.loadWorkspaceSettings(e),a=t.draft_id+1;return await this.saveWorkspaceSettings(e,{...t,draft_id:a}),a}generateDraftTitle(e,t){return`${e} (Draft ${t})`}extractDraftInfo(e){const t=e.match(/^(.+?)\s+\(Draft\s+(\d+)\)$/);return t?{baseTitle:t[1],draftId:parseInt(t[2],10)}:{baseTitle:e,draftId:null}}async getAvailableTransforms(e){try{return await this.extensionManager.getAvailableTransforms(e)}catch(t){throw new vr(`Failed to get available transforms: ${t instanceof Error?t.message:"Unknown error"}`,"TRANSFORM_DISCOVERY_ERROR")}}async resolveTransformScripts(e,t){try{let a=null;const n=[];if(t.text_transform)try{a=await this.fileStorage.readTextFile(e,t.text_transform)}catch{}for(const i of t.dom_transforms)try{const s=await this.fileStorage.readTextFile(e,i);n.push(s)}catch{}return{textTransform:a,domTransforms:n}}catch(a){throw new vr(`Failed to resolve transform scripts: ${a instanceof Error?a.message:"Unknown error"}`,"TRANSFORM_RESOLUTION_ERROR")}}validateGlobalSettings(e){const t=[],a=[];return e.theme!==void 0&&!this.isValidTheme(e.theme)&&t.push(`Invalid theme: ${e.theme}`),e.locale!==void 0&&!this.isValidLocale(e.locale)&&a.push(`Unsupported locale: ${e.locale}`),e.editor_font_size!==void 0&&!this.isValidFontSize(e.editor_font_size)&&t.push("Font size must be between 8-32 pixels"),{isValid:t.length===0,errors:t,warnings:a}}validateWorkspaceSettings(e){const t=[],a=[];if(e.draft_id!==void 0&&(e.draft_id<0||!Number.isInteger(e.draft_id))&&t.push("Draft ID must be a non-negative integer"),e.editor){const{preview_delay_ms:n}=e.editor;n!==void 0&&(n<100||n>2e3)&&t.push("Preview delay must be between 100-2000ms")}return{isValid:t.length===0,errors:t,warnings:a}}validateEPUBSettings(e){const t=[],a=[];if(e.text_transform!==void 0&&e.text_transform&&(e.text_transform.startsWith("SOURCE/")||t.push("Text transform must start with SOURCE/")),e.dom_transforms!==void 0)for(const n of e.dom_transforms)n.startsWith("SOURCE/")||t.push(`DOM transform must start with SOURCE/: ${n}`);if(e.spine_basename!==void 0&&!e.spine_basename.trim()&&t.push("Spine basename cannot be empty"),e.cover){const{background_color:n,text_color:i}=e.cover;n&&!this.isValidColor(n)&&t.push("Invalid background color format"),i&&!this.isValidColor(i)&&t.push("Invalid text color format")}return{isValid:t.length===0,errors:t,warnings:a}}isValidTheme(e){return Zn.VALID_THEMES.has(e)}isValidLocale(e){return typeof e=="string"&&e.length>0}isValidFontSize(e){return typeof e=="number"&&e>=8&&e<=32&&Number.isInteger(e)}isValidColor(e){return/^#[0-9A-Fa-f]{6}$/.test(e)}}function Hp(r){let e=r;return e.endsWith(".js")&&(e=e.slice(0,-3)),e.endsWith(".min")&&(e=e.slice(0,-4)),e=e.replace(/[-@](?:v?\d+[\.\-]\d+|\d+[\.\-]\d+)(?:[\.\-]\w+)*$/i,""),Ya(e)}function Ya(r){return r.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function qp(r){const e=r.name.toLowerCase();return e.endsWith(".js")?r.size===0?{isValid:!1,fileType:"javascript",error:"JavaScript file cannot be empty"}:r.size>50*1024*1024?{isValid:!1,fileType:"javascript",error:"JavaScript file too large (max 50MB)"}:{isValid:!0,fileType:"javascript"}:e==="license.txt"||e==="license"?r.size>1024*1024?{isValid:!1,fileType:"license",error:"License file too large (max 1MB)"}:{isValid:!0,fileType:"license"}:{isValid:!1,fileType:"unknown",error:"Invalid file type: only JavaScript (.js) and license files are supported"}}function Gn(r){const e=r.slice().sort((a,n)=>a.name.localeCompare(n.name)),t=r.reduce((a,n)=>a+n.size,0);return{files:e,totalSize:t}}function Ja(r,e){return r.totalSize!==e.totalSize||r.files.length!==e.files.length?!1:r.files.every((t,a)=>t.name===e.files[a].name&&t.size===e.files[a].size)}function Vp(r){return!(!r||r.length===0||r.length>100||!/^[a-z0-9-]+$/.test(r)||r.startsWith("-")||r.endsWith("-")||/^-+$/.test(r))}const zt="extensions-cache";class Gp{constructor(e){this.fileStorage=e}async listCachedExtensions(){try{const e=await this.fileStorage.listFiles(zt),t=new Set;for(const n of e){const i=n.split("/");i.length>=2&&t.add(i[0])}const a=[];for(const n of t)try{const i=await this.getExtensionInfo(n);a.push(i)}catch{}return a.sort((n,i)=>n.name.localeCompare(i.name))}catch(e){if(e instanceof Error&&e.message.includes("not found"))return[];throw e}}async getExtensionInfo(e){const a=(await this.fileStorage.listFiles(zt)).filter(s=>s.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);const n=[];let i=0;for(const s of a){const l=s.split("/").pop(),u={size:(await this.fileStorage.readFile(zt,s)).byteLength};let c;if(l.endsWith(".js"))c="javascript";else if(l.toLowerCase().includes("license"))c="license";else continue;n.push({filename:s.replace(`${e}/`,""),size:u.size,type:c}),i+=u.size}if(n.length===0)throw new Error(`Extension '${e}' has no valid files`);return{name:e,files:n,totalSize:i,location:"cache"}}async cacheExtension(e,t){if(await this.hasConflict(e,t))throw new Error(`Extension '${e}' already cached with different content`);for(const[n,i]of t.entries()){const s=`${e}/${n}`;await this.fileStorage.writeFile(zt,s,i)}}async copyToWorkspace(e,t){const n=(await this.fileStorage.listFiles(zt)).filter(i=>i.startsWith(e+"/"));if(n.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const i of n){const s=await this.fileStorage.readFile(zt,i),l=`SOURCE/extensions/${i}`;await this.fileStorage.writeFile(t,l,s)}}async deleteExtension(e){const a=(await this.fileStorage.listFiles(zt)).filter(n=>n.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const n of a)await this.fileStorage.deleteFile(zt,n)}async hasConflict(e,t){try{const a=await this.getExtensionInfo(e),n=Gn(Array.from(t.keys()).map(s=>({name:s,size:t.get(s).byteLength}))),i=Gn(a.files.map(s=>({name:s.filename,size:s.size})));return!Ja(n,i)}catch{return!1}}async getExtensionSignature(e){try{const a=(await this.fileStorage.listFiles(zt)).filter(i=>i.startsWith(e+"/"));if(a.length===0)return null;const n=[];for(const i of a){const s=i.split("/").pop();if(s.endsWith(".js")||s.toLowerCase().includes("license"))try{const l=await this.fileStorage.getFileInfo(zt,i);n.push({name:s,size:l.size})}catch{const l=await this.fileStorage.readFile(zt,i);n.push({name:s,size:l.byteLength})}}return Gn(n)}catch{return null}}async addToCache(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=new Map;for(const s of n){const l=s.replace(`SOURCE/extensions/${t}/`,""),d=await this.fileStorage.readFile(e,s);i.set(l,d)}await this.cacheExtension(t,i)}async removeFromCache(e){await this.deleteExtension(e)}get cacheWorkspaceId(){return zt}async importFromCache(e,t){if((await this.fileStorage.listFiles(t)).some(i=>i.startsWith(`SOURCE/extensions/${e}/`)))throw new Error(`Extension '${e}' already exists in workspace`);await this.copyToWorkspace(e,t)}async deleteCachedExtension(e){await this.deleteExtension(e)}async isCached(e){try{return await this.getExtensionInfo(e),!0}catch{return!1}}async compareExtensions(e,t,a){try{const i=(await this.fileStorage.listFiles(e)).filter(c=>c.startsWith(`SOURCE/extensions/${t}/`)),l=(await this.fileStorage.listFiles(zt)).filter(c=>c.startsWith(`${a}/`));if(i.length!==l.length)return!0;const d=await this.createWorkspaceSignature(e,t,i),u=await this.createCacheSignature(a,l);return!Ja(d,u)}catch{return!0}}async createWorkspaceSignature(e,t,a){const n=[];for(const i of a){const s=i.replace(`SOURCE/extensions/${t}/`,""),l=i.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license")){const d=await this.fileStorage.readFile(e,i);n.push({name:s,size:d.byteLength})}}return Gn(n)}async createCacheSignature(e,t){const a=[];for(const n of t){const i=n.replace(`${e}/`,""),s=n.split("/").pop();if(s.endsWith(".js")||s.toLowerCase().includes("license")){const l=await this.fileStorage.readFile(zt,n);a.push({name:i,size:l.byteLength})}}return Gn(a)}async getCacheStats(){const e=await this.listCachedExtensions(),t={};for(const a of e)t[a.name]=a.files.length;return{totalExtensions:e.length,totalSize:e.reduce((a,n)=>a+n.totalSize,0),extensionCount:t}}}class ki{constructor(e){if(this.fileStorage=e,!e)throw new Error("FileStorageAPI is required");this.cache=new Gp(e)}cache;get extensionCache(){return this.cache}async importExtension(e,t,a){const n=Ya(a);if(!Vp(n))throw new Error(`Invalid extension name: '${a}' contains illegal characters`);const i=this.validateExtensionFile(t);if(!i.isValid)throw new Error(i.error);if((await this.listWorkspaceExtensions(e)).some(c=>c.name===n))throw new Error(`Extension '${n}' already exists in workspace`);const l=await t.arrayBuffer(),d=`SOURCE/extensions/${n}/${t.name}`;await this.fileStorage.writeFile(e,d,l);const u=new Map([[t.name,l]]);try{await this.cache.cacheExtension(n,u)}catch{}return{name:n,files:[{filename:t.name,size:t.size,type:i.fileType}],totalSize:t.size,location:"workspace"}}async addFileToExtension(e,t,a){const n=this.validateExtensionFile(a);if(!n.isValid)throw new Error(n.error);if(!(await this.listWorkspaceExtensions(e)).some(u=>u.name===t))throw new Error(`Extension '${t}' does not exist in workspace`);const s=`SOURCE/extensions/${t}/${a.name}`;if(await this.fileStorage.fileExists(e,s))throw new Error(`File '${a.name}' already exists in extension '${t}'`);const d=await a.arrayBuffer();await this.fileStorage.writeFile(e,s,d);try{const u=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,u)}catch{}}async listWorkspaceExtensions(e){try{const a=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith("SOURCE/extensions/")),n=new Set;for(const s of a){const l=s.split("/");l.length>=3&&n.add(l[2])}const i=[];for(const s of n)try{const l=await this.getWorkspaceExtensionInfo(e,s);i.push(l)}catch{}return i.sort((s,l)=>s.name.localeCompare(l.name))}catch(t){if(t instanceof Error&&t.message.includes("not found"))return[];throw t}}async deleteWorkspaceExtension(e,t){const n=(await this.fileStorage.listFiles(e)).filter(i=>i.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);for(const i of n)await this.fileStorage.deleteFile(e,i)}async getExtensionLicense(e,t){try{const a=`SOURCE/extensions/${t}/LICENSE.txt`,n=await this.fileStorage.readFile(e,a);return new TextDecoder().decode(n)}catch{return""}}async saveExtensionLicense(e,t,a){if(!(await this.listWorkspaceExtensions(e)).some(d=>d.name===t))throw new Error(`Extension '${t}' does not exist in workspace`);const i=`SOURCE/extensions/${t}/LICENSE.txt`,l=new TextEncoder().encode(a);await this.fileStorage.writeFile(e,i,l.buffer)}async listCachedExtensions(){return this.cache.listCachedExtensions()}async importFromCache(e,t){if(!(await this.cache.listCachedExtensions()).some(i=>i.name===t))throw new Error(`Extension '${t}' not found in cache`);if((await this.listWorkspaceExtensions(e)).some(i=>i.name===t))throw new Error(`Extension '${t}' already exists in workspace`);await this.cache.copyToWorkspace(t,e)}async deleteCachedExtension(e){await this.cache.deleteExtension(e)}async cacheExtension(e,t){if(!(await this.fileStorage.listFiles(e)).some(l=>l.startsWith(`SOURCE/extensions/${t}/`)))throw new Error(`Extension '${t}' does not exist in workspace`);const i=await this.cache.getExtensionSignature(t);if(i){const l=await this.getWorkspaceExtensionSignature(e,t);if(Ja(i,l))return;throw new Error(`Extension '${t}' already cached with different content`)}const s=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,s)}async scanAndCacheExtensions(e){const t=await this.listWorkspaceExtensions(e),a={successCount:0,totalScanned:t.length,conflicts:[],errors:[]};for(const n of t)try{const i=await this.getWorkspaceExtensionFiles(e,n.name);if(await this.cache.hasConflict(n.name,i)){a.conflicts.push(n.name);continue}await this.cache.cacheExtension(n.name,i),a.successCount++}catch(i){a.errors.push({extensionName:n.name,reason:"storage",message:i instanceof Error?i.message:"Unknown error"})}return a}detectExtensionName(e){return Hp(e)}validateExtensionFile(e){return qp(e)}normalizeExtensionName(e){return Ya(e)}compareExtensions(e,t){const a=e.name||"unknown",n=t.name||"unknown";if(a!==n||e.totalSize!==t.totalSize||e.files.length!==t.files.length)return!1;const i=e.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name)),s=t.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name));return i.every((l,d)=>{const u=s[d],c=l.filename||l.name,p=u.filename||u.name;return c===p&&l.size===u.size})}sanitizeFilename(e){return e.replace(/\.\.\//g,"").replace(/\.\.\\/g,"").replace(/[<>:"/\\|?*\x00-\x1f]/g,"-").replace(/^\.+/,"").replace(/\.+$/,"").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255)}async getWorkspaceExtensionSignature(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];for(const s of n){const l=s.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license"))try{const d=await this.fileStorage.getFileInfo(e,s);i.push({name:l,size:d.size})}catch{const d=await this.fileStorage.readFile(e,s);i.push({name:l,size:d.byteLength})}}return Gn(i)}async getWorkspaceExtensionInfo(e,t){const n=(await this.fileStorage.listFiles(e)).filter(l=>l.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];let s=0;for(const l of n){const d=l.split("/").pop(),c={size:(await this.fileStorage.readFile(e,l)).byteLength};let p;if(d.endsWith(".js"))p="javascript";else if(d.toLowerCase().includes("license"))p="license";else continue;i.push({filename:d,size:c.size,type:p}),s+=c.size}return{name:t,files:i,totalSize:s,location:"workspace"}}async getWorkspaceExtensionFiles(e,t){const n=(await this.fileStorage.listFiles(e)).filter(s=>s.startsWith(`SOURCE/extensions/${t}/`)),i=new Map;for(const s of n){const l=s.split("/").pop(),d=await this.fileStorage.readFile(e,s);i.set(l,d)}return i}async getAvailableTransforms(e){const t=[];try{const a=await this.fileStorage.listFiles(e),n=a.filter(s=>s.startsWith("SOURCE/")&&s.endsWith(".js"));for(const s of n){const l=s.split("/").pop()||"";(l.includes("transform")||l.includes("Transform")||l==="transformText.js"||l==="transformDom.js")&&t.push({path:s,extensionName:`Transform: ${l}`,fileName:l})}const i=a.filter(s=>s.startsWith("SOURCE/extensions/")&&s.endsWith(".js")&&(s.includes("transform")||s.includes("Transform")));for(const s of i){const l=s.split("/"),d=l.pop()||"",u=l[2]||"Unknown Extension";t.push({path:s,extensionName:u,fileName:d})}}catch(a){console.warn("Failed to get available transforms:",a)}return t}}const Zr=new Set;let es=0;function go(r,e=""){if(Zr.has(r))throw new Error(`Editor ID "${r}" is already in use`);Zr.add(r);function t(){return es++,Date.now()+es*.001}const a=Jt({content:e,isEmpty:e.trim()==="",lastUpdated:t()}),n=[];function i(c){typeof c=="string"&&a.update(p=>({content:c,isEmpty:c.trim()==="",lastUpdated:t()}))}function s(){a.update(c=>({content:"",isEmpty:!0,lastUpdated:t()}))}function l(){let c="";return a.subscribe(h=>{c=h.content})(),c}function d(c){const p=a.subscribe(c);return n.push(p),()=>{p();const h=n.indexOf(p);h>-1&&n.splice(h,1)}}function u(){n.forEach(c=>c()),n.length=0,Zr.delete(r)}return{subscribe:d,updateContent:i,reset:s,getContent:l,destroy:u}}function Xp(){Zr.clear()}var Kp=P('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>'),Yp=P('<div class="error-state svelte-19lb94x"><span class="error-icon svelte-19lb94x">â ï¸</span> <p> </p></div>'),Jp=P('<div class="empty-state svelte-19lb94x"><div class="empty-icon svelte-19lb94x">ð</div> <h3 class="svelte-19lb94x"> </h3> <p class="svelte-19lb94x"> </p></div>'),Zp=P('<div data-spine-view="" class="spine-editor-wrapper svelte-19lb94x"><!></div>'),Qp=P('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>');function eh(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=()=>Ye(ge,"$transformError",t),s=()=>Ye(J,"$transformWarnings",t),l=()=>Ye(X,"$isTransforming",t),d=()=>Ye(we,"$executionTime",t);let u=B(e,"workspace",8),c=B(e,"workspaceService",8),p=B(e,"spineService",8),h=B(e,"contentService",8),v=B(e,"selectedItemId",12,null),m=B(e,"transformEngine",8),w=Ne(null),b=Ne(!1),k=Ne(null),I,C,L,E,N,z=Ne(!1),H=Ne(null),W={text:""},O=[],T=Ne([]),G=Ne([]),U=Ne(null),F=!1,D=Ne(),M=Ne({mode:"single",pane1:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""},pane2:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""}});const le=Jt(""),J=Jt([]),ge=Jt(null),X=Jt(!1),we=Jt(0);let he=Ne(null),Ce=Ne(null),se=new Map,Q=Ne(null),ve=Ne(null),Z=Ne(null);const ue=Lt();function Fe(A){me(),v()&&ye()}function je(){}function Ge(){return{selectedItemId:v(),selectedItem:o(w)}}function ne(A){A.selectedItemId&&(v(A.selectedItemId),ye())}async function be(){return!0}async function me(){if(!o(z))try{C=Ut.getInstance(),L=new ki(C),E=new mo({fileStorage:C,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),N=new Zn(C,L,la,fo),y(z,!0)}catch(A){y(k,A instanceof Error?A.message:"Failed to initialize services"),console.error("Failed to initialize spine editor services:",A)}}function _e(){if(o(M).mode==="single")y(T,O),y(G,O);else{const A=o(M).pane1.fileType==="text",ee=o(M).pane2.fileType==="text";y(T,O.filter(ie=>!(ie.type==="text"&&ee))),y(G,O.filter(ie=>!(ie.type==="text"&&A)))}}async function Pe(){if(!(!v()||!o(z)))try{const A=[{value:"text",label:"Text Content",path:`SOURCE/text/${v()}.txt`,href:`SOURCE/text/${v()}.txt`,type:"text"}];try{const ee=await C.listFiles(u().id,"OEBPS/Styles");for(const ie of ee)if(ie.endsWith(".css")){const Re=ie.split("/").pop()?.replace(".css","")||ie,qe=ie.startsWith("OEBPS/")?ie.substring(6):ie;A.push({value:`css-${Re}`,label:`CSS: ${Re}`,path:ie,href:qe,type:"css"})}}catch{}try{const ee=await C.listFiles(u().id,"OEBPS/Scripts");for(const ie of ee)if(ie.endsWith(".js")){const Re=ie.split("/").pop()?.replace(".js","")||ie,qe=ie.startsWith("OEBPS/")?ie.substring(6):ie;A.push({value:`js-${Re}`,label:`JS: ${Re}`,path:ie,href:qe,type:"javascript"})}}catch{}try{const ee=await C.listFiles(u().id,"SOURCE/scripts");for(const ie of ee)if(ie.endsWith(".js")){const Re=ie.split("/").pop()?.replace(".js","")||ie;A.push({value:`transform-${Re}`,label:`Transform: ${Re}`,path:ie,href:ie,type:"transform"})}}catch{}O=A,_e()}catch(A){console.error("Failed to load available files:",A),O=[{value:"text",label:"Text Content",path:`SOURCE/text/${v()}.txt`,href:`SOURCE/text/${v()}.txt`,type:"text"}],_e()}}async function $e(A,ee,ie){const Re=A.path,qe=`file-content-${Re.replace(/[^a-zA-Z0-9]/g,"-")}`;let Ve="";try{const it=await ie.readFile(ee,Re);Ve=new TextDecoder().decode(it)}catch{}const tt=go(qe,Ve);let ct;return tt.subscribe(it=>{o(H)&&(clearTimeout(ct),ct=setTimeout(async()=>{try{await ie.writeFile(ee,A.path,it.content),A.type==="text"?o(H).updateContent("text",it.content):["css","javascript","transform"].includes(A.type)&&(A.href&&E&&E.revokeFileBlob(A.href),o(H).forcePreviewUpdate())}catch(Dt){console.error("Auto-save failed:",Dt)}},300))}),tt}async function He(A,ee,ie){try{const Re=A.path;if(se.has(Re))return se.get(Re);const qe=await $e(A,ee,ie);return se.has(Re)?(qe.destroy(),se.get(Re)):(se.set(Re,qe),qe)}catch(Re){return console.error(`Failed to get/create file store for ${A.path}:`,Re),null}}async function Je(){if(!(!v()||!o(z)))try{if(await Pe(),!o(w)||o(w).id!==v()){console.warn("â ï¸ Spine item synchronization issue:",{selectedItemId:v(),selectedItemActualId:o(w)?.id,selectedItem:o(w)});return}o(H)?await o(H).switchToSpineItem(o(w).idref,o(w)):(y(H,Bp(u().id,o(w).idref,C,L,E,c(),N,m(),$p,xe,Ie,o(w))),await o(H).initialize(),await o(H).loadInitialContent()),W=o(H).getCurrentContent(),await at()}catch(A){y(k,A instanceof Error?A.message:"Failed to initialize spine editor"),console.error("Failed to initialize spine editor:",A)}}async function at(){if(O.length===0)return;const A=bt.getViewData("spine");if(A&&(A.pane1||A.pane2))await fe(A);else{const ee=O.find(ie=>ie.type==="text");if(ee){const ie=ce(ee.type);Xe(M,o(M).mode="single"),Xe(M,o(M).pane1={filePath:ee.path,fileHref:ee.href,fileType:ee.type,contentType:ie,selectedFileValue:ee.value,content:""}),console.warn("restoreOrInitializePaneContent bypassed loadFileIntoPane for text content"),q()}}o(H)&&await o(H).forcePreviewUpdate()}function ce(A){return A==="text"?"text":null}function ke(A){return A==="text"}async function Ee(A){const{pane:ee,filePath:ie,fileType:Re}=A.detail,qe=O.find(Gt=>Gt.path===ie);if(!qe)return;const Ve=qe.href,tt=qe.value,ct=`pane${ee}`,it=ce(Re);Xe(M,o(M)[ct]={filePath:ie,fileHref:Ve,fileType:Re,contentType:it,selectedFileValue:tt,content:""}),y(ee===1?he:Ce,null),ee===2&&o(M).mode==="single"&&Xe(M,o(M).mode="dual"),q();const Dt=await He(qe,u().id,c());Dt?y(ee===1?Q:ve,Dt):console.error("â Failed to create file store for:",ie),_e()}function ze(A){if(!A||A.trim()==="")return null;try{return new Function(A),null}catch(ee){return ee instanceof SyntaxError?`JavaScript syntax error: ${ee.message}`:`JavaScript validation error: ${ee instanceof Error?ee.message:String(ee)}`}}function $(A){const{pane:ee,content:ie}=A.detail,Re=`pane${ee}`;Xe(M,o(M)[Re].content=ie);const{contentType:qe,filePath:Ve,fileHref:tt,fileType:ct}=o(M)[Re];if((ct.includes("javascript")||ct.includes("js")||ct==="transform")&&ie.trim()){const it=ze(ie);if(it){y(ee===1?he:Ce,it);return}else y(ee===1?he:Ce,null)}else y(ee===1?he:Ce,null);qe&&o(H)&&(W[qe]=ie,o(H).updateContent(qe,ie)),Ve&&te(Ve,tt,ie)}async function V(){const A=o(M).mode==="single"?"dual":"single";if(A==="dual"){let ee=null;if(o(M).pane1.fileType==="text"&&o(M).pane2.fileType==="text"?(ee=O.find(ie=>ie.type!=="text"),console.log("ð Text conflict resolved: moving pane 2 from text to",ee?.label||"empty")):(!o(M).pane2.selectedFileValue||o(M).pane2.selectedFileValue==="")&&(ee=O[0]),ee){Xe(M,o(M).pane2={selectedFileValue:ee.value,filePath:ee.path,fileType:ee.type,fileHref:ee.href,contentType:"text",content:""});try{const ie=await He(ee,u().id,c());ie&&y(ve,ie)}catch(ie){console.error("Failed to create store for pane 2 default selection:",ie)}}}Xe(M,o(M).mode=A),q(),_e()}let Y=new Map;function te(A,ee,ie){const Re=Y.get(A);Re&&clearTimeout(Re);const qe=setTimeout(async()=>{try{if(!Te(A,ie))return;await C.writeTextFile(u().id,A,ie),E&&(A.includes("/Styles/")||A.includes("/Scripts/"))&&(E.revokeFileBlob(ee),o(H)&&o(H).forcePreviewUpdate())}catch{}finally{Y.delete(A)}},500);Y.set(A,qe)}function Te(A,ee){if(A.includes("SOURCE/text/")&&v()){const ie=`SOURCE/text/${v()}.txt`;if(A!==ie)return!1;if(ee.includes("chapter")||ee.includes("Chapter")){const Re=A.match(/chapter(\d+)/)?.[1];if(Re&&ee.toLowerCase().includes("chapter")&&!ee.toLowerCase().includes(`chapter ${Re}`)&&!ee.toLowerCase().includes(`chapter${Re}`))return!1}}return!0}function q(){const A={pane1:o(M).pane1.fileType?{fileType:o(M).pane1.fileType,selectedFile:o(M).pane1.filePath}:null,pane2:o(M).pane2.fileType?{fileType:o(M).pane2.fileType,selectedFile:o(M).pane2.filePath}:null,mode:o(M).mode};bt.setViewData("spine",A)}async function fe(A){Xe(M,o(M).mode=A.mode),A.pane1&&await ae(1,A.pane1),A.pane2&&await ae(2,A.pane2)}async function ae(A,ee){const{fileType:ie,selectedFile:Re,content:qe}=ee;let Ve;if(ie==="text"?Ve=O.find(tt=>tt.type==="text"):Re?(Ve=O.find(tt=>tt.path===Re),Ve||(Ve=O.find(tt=>tt.type===ie))):Ve=O.find(tt=>tt.type===ie),Ve){const tt=ce(Ve.type),ct=`pane${A}`;Xe(M,o(M)[ct]={filePath:Ve.path,fileHref:Ve.href,fileType:Ve.type,contentType:tt,selectedFileValue:Ve.value,content:""});const it=await He(Ve,u().id,c());it?y(A===1?Q:ve,it):console.error("â Pane restoration failed - could not create store for:",Ve.path)}}function xe(A){le.set(A.xhtml),J.set(A.warnings),ge.set(null),X.set(!1),we.set(A.executionTime),ue("previewUpdate",{xhtmlContent:A.xhtml,isTransforming:!1,transformError:null,transformWarnings:A.warnings,executionTime:A.executionTime,spineItemId:v()})}function Ie(A){ge.set(A.error),X.set(!1),ue("previewUpdate",{xhtmlContent:"",isTransforming:!1,transformError:A.error,transformWarnings:[],executionTime:0,spineItemId:v()})}async function Ae(){if(o(H)){X.set(!0);try{await o(H).forcePreviewUpdate()}catch(A){Ie({error:{stage:"manual-update",message:A instanceof Error?A.message:"Manual update failed"}})}}}function Le(A){o(D)&&typeof o(D).findAndSelectText=="function"&&o(D).findAndSelectText(A.detail)}let We=null;async function ye(){if(!(!v()||!p())&&!F){if(We)try{await We}catch{}F=!0,We=Oe();try{await We}finally{We=null,F=!1}}}async function Oe(){y(b,!0),y(k,null);try{const ee=(await p().loadSpineItems(u())).find(Ve=>Ve.id===v())||null,ie=o(w)?.id,Re=ee?.id,qe=ie&&Re&&ie!==Re;y(w,ee),o(w)&&o(z)&&(qe?await Be():await Je())}catch(A){y(k,A instanceof Error?A.message:"Failed to load spine item")}finally{y(b,!1)}}async function Be(){try{await Pe(),await Me(),await Je()}catch(A){y(k,A instanceof Error?A.message:"Failed to switch spine item")}}async function Me(){for(const[A,ee]of Y)clearTimeout(ee);if(Y.clear(),JSON.parse(JSON.stringify(o(M))),o(M).pane1.fileType&&ke(o(M).pane1.fileType)){o(M).pane1.filePath;const A=`SOURCE/text/${v()}.txt`;Xe(M,o(M).pane1.filePath=A),Xe(M,o(M).pane1.fileHref=A)}if(o(M).pane2.fileType&&ke(o(M).pane2.fileType)){o(M).pane2.filePath;const A=`SOURCE/text/${v()}.txt`;Xe(M,o(M).pane2.filePath=A),Xe(M,o(M).pane2.fileHref=A)}}an(()=>{I=bt.addNavigationGuard(be),Fe()}),lr(()=>{for(const[A,ee]of se)ee.destroy();se.clear(),I&&bt.removeNavigationGuard(I)}),ft(()=>(rt(u()),o(Z),rt(m())),()=>{if(u()?.id&&(o(Z)===null||u().id!==o(Z))){for(const[A,ee]of se)ee.destroy();se.clear(),y(Q,null),y(ve,null),Xp(),m().setWorkspaceExtensions(u().id).catch(A=>{console.error("Failed to load workspace extensions:",A)})}y(Z,u()?.id||null)}),ft(()=>(rt(v()),o(U),rt(u()),rt(p()),o(z)),()=>{v()!==o(U)&&(y(U,v()),u()&&p()&&(o(z)||me(),v()?ye():(y(w,null),y(k,null),y(H,null))))}),Mt(),gt();var S=ht(),K=Ze(S);{var re=A=>{var ee=Kp(),ie=g(f(ee),2),Re=f(ie);R(qe=>x(Re,qe),[()=>n()("Loading spine item...")],de),_(A,ee)},Se=(A,ee)=>{{var ie=qe=>{var Ve=Yp(),tt=g(f(Ve),2),ct=f(tt);R(()=>x(ct,o(k))),_(qe,Ve)},Re=(qe,Ve)=>{{var tt=it=>{var Dt=Jp(),Gt=g(f(Dt),2),Tn=f(Gt),jt=g(Gt,2),Xt=f(jt);R((Cn,Ft)=>{x(Tn,Cn),x(Xt,Ft)},[()=>n()("No spine item selected"),()=>n()("Select a spine item from the sidebar to start editing")],de),_(it,Dt)},ct=(it,Dt)=>{{var Gt=jt=>{var Xt=Zp(),Cn=f(Xt);Nt(yp(Cn,{get availableFiles1(){return o(T)},get availableFiles2(){return o(G)},get transformError(){return i()},get transformWarnings(){return s()},get isTransforming(){return l()},get executionTime(){return d()},get editorMode(){return o(M).mode},get pane1SelectedFile(){return o(M).pane1.selectedFileValue},get pane2SelectedFile(){return o(M).pane2.selectedFileValue},get pane1FileStore(){return o(Q)},get pane2FileStore(){return o(ve)},get contentService(){return h()},onPaneToggle:()=>V(),onFileSelect:(Ft,In,zr)=>Ee({detail:{pane:Ft,filePath:In,fileType:zr}}),onContentChange:(Ft,In)=>$({detail:{pane:Ft,content:In}}),onForceUpdate:()=>Ae(),get pane1Error(){return o(he)},set pane1Error(Ft){y(he,Ft)},get pane2Error(){return o(Ce)},set pane2Error(Ft){y(Ce,Ft)},$$legacy:!0}),Ft=>y(D,Ft),()=>o(D)),Ke("preview-click",Xt,Le),_(jt,Xt)},Tn=jt=>{var Xt=Qp(),Cn=g(f(Xt),2),Ft=f(Cn);R(In=>x(Ft,In),[()=>n()("Initializing editor...")],de),_(jt,Xt)};j(it,jt=>{o(w)&&o(z)&&o(H)?jt(Gt):jt(Tn,!1)},Dt)}};j(qe,it=>{v()?it(ct,!1):it(tt)},Ve)}};j(A,qe=>{o(k)?qe(ie):qe(Re,!1)},ee)}};j(K,A=>{o(b)?A(re):A(Se,!1)})}_(r,S),Pt(e,"onViewEnter",Fe),Pt(e,"onViewLeave",je),Pt(e,"getViewData",Ge),Pt(e,"setViewData",ne),Pt(e,"canLeave",be);var De=et({onViewEnter:Fe,onViewLeave:je,getViewData:Ge,setViewData:ne,canLeave:be});return a(),De}function th(r,e){y(e,!o(e))}var nh=P('<div class="license-preview svelte-1ksqegs"><span class="license-preview-text svelte-1ksqegs"> </span></div>'),rh=P('<div class="license-section svelte-1ksqegs"><textarea class="license-textarea svelte-1ksqegs"></textarea></div>'),ah=P('<li class="extension-item svelte-1ksqegs"><div class="extension-header svelte-1ksqegs"><span class="extension-name svelte-1ksqegs"> </span> <div class="extension-actions svelte-1ksqegs"><button type="button" class="license-button svelte-1ksqegs"> </button> <button type="button" class="remove-button svelte-1ksqegs"> </button></div></div> <!> <!></li>');function ih(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=Ue(!1),s=Ue(""),l=Ue(!1);const d=oe(()=>{if(!o(s)||!o(s).trim())return"";const O=o(s).split(`
`)[0].trim();return O.length>60?O.substring(0,57)+"...":O});let u=null;xt(()=>{e.workspaceId&&e.extension.name&&c()});async function c(){try{y(l,!0),y(s,await e.extensionManager.getExtensionLicense(e.workspaceId,e.extension.name),!0)}catch(O){console.error("Failed to load license text:",O),y(s,"")}finally{y(l,!1)}}function p(){e.isAdvancedMode&&(u&&clearTimeout(u),u=setTimeout(()=>{h()},500))}async function h(){try{await e.extensionManager.saveExtensionLicense(e.workspaceId,e.extension.name,o(s))}catch(O){console.error("Failed to save license text:",O)}}xt(()=>()=>{u&&clearTimeout(u)});var v=ah(),m=f(v),w=f(m),b=f(w),k=g(w,2),I=f(k);I.__click=[th,i];var C=f(I),L=g(I,2);L.__click=function(...O){e.onRemove?.apply(this,O)};var E=f(L),N=g(m,2);{var z=O=>{var T=nh(),G=f(T),U=f(G);R(()=>x(U,o(d))),_(O,T)};j(N,O=>{o(d)&&O(z)})}var H=g(N,2);{var W=O=>{var T=rh(),G=f(T);G.__input=p,R(U=>{pe(G,"placeholder",U),G.readOnly=!e.isAdvancedMode,G.disabled=o(l)},[()=>n()("Paste {name} license text here",{name:e.extension.name})]),Jr(G,()=>o(s),U=>y(s,U)),_(O,T)};j(H,O=>{o(i)&&O(W)})}R((O,T)=>{x(b,e.extension.name),I.disabled=o(l),x(C,O),L.disabled=!e.isAdvancedMode,x(E,T)},[()=>n()("License"),()=>n()("Remove")]),_(r,v),et(),a()}_t(["click","input"]);async function sh(r,e,t,a,n){if(!e.workspaceId||!o(t))return;const s=r.target.checked,l={...o(t),editor:{preview_delay_ms:o(t).editor?.preview_delay_ms??500,advanced_mode:s}};y(t,l,!0);try{await e.settingsService.saveWorkspaceSettings(e.workspaceId,l),e.onSettingsChanged?.()}catch(d){y(a,d instanceof Error?d.message:n()("Failed to save settings"),!0),y(t,{...o(t),editor:{preview_delay_ms:o(t).editor?.preview_delay_ms??500,advanced_mode:!s}},!0)}}var oh=P('<p class="no-workspace-message svelte-1qxmh9x"> </p>'),lh=P('<p class="loading-message svelte-1qxmh9x"> </p>'),ch=P('<div class="error-message svelte-1qxmh9x" role="alert"><strong> </strong> </div>'),dh=P('<p class="advanced-mode-note svelte-1qxmh9x"> </p>'),uh=P("<p> </p>"),fh=P("<p> </p>"),ph=P('<ul class="extensions-list svelte-1qxmh9x"></ul>'),hh=P('<div class="settings-content svelte-1qxmh9x"><section class="workspace-settings svelte-1qxmh9x"><h2 class="svelte-1qxmh9x"> </h2> <div class="setting-group svelte-1qxmh9x"><label class="setting-label svelte-1qxmh9x"><input type="checkbox" class="svelte-1qxmh9x"/> <span class="setting-text svelte-1qxmh9x"> </span></label> <p class="setting-description svelte-1qxmh9x"> </p></div></section> <section class="extensions-settings svelte-1qxmh9x"><h2 class="svelte-1qxmh9x"> </h2> <div><label for="extension-file" class="svelte-1qxmh9x"> </label> <input id="extension-file" type="file" accept=".js" class="svelte-1qxmh9x"/> <!></div> <!></section></div>'),vh=P('<div class="settings-view svelte-1qxmh9x"><div class="settings-header svelte-1qxmh9x"><h1 class="svelte-1qxmh9x"> </h1> <!></div> <!> <!></div>');function mh(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=Ue(null),s=Ue(!1),l=Ue(null),d=Ue(Ct([])),u=Ue(!1);xt(()=>{if(!e.workspaceId||!e.settingsService)return;(async()=>{y(s,!0),y(l,null);try{y(i,await e.settingsService.loadWorkspaceSettings(e.workspaceId),!0)}catch(O){y(l,O instanceof Error?O.message:n()("Failed to load settings"),!0),y(i,e.settingsService.getDefaultWorkspaceSettings(),!0)}finally{y(s,!1)}})()}),xt(()=>{if(!e.workspaceId)return;(async()=>{y(u,!0);try{y(d,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0)}catch(O){console.error("Failed to load extensions:",O),y(d,[],!0)}finally{y(u,!1)}})()});async function c(W){if(!o(h))return;const O=W.target,T=O.files?.[0];if(!(!T||!e.workspaceId))try{const G=e.extensionManager.detectExtensionName(T.name);await e.extensionManager.importExtension(e.workspaceId,T,G),y(d,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId),O.value=""}catch(G){console.error("Failed to import extension:",G),y(l,G instanceof Error?G.message:n()("Failed to import extension"),!0)}}async function p(W){if(e.workspaceId)try{await e.extensionManager.deleteWorkspaceExtension(e.workspaceId,W),y(d,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId)}catch(O){console.error("Failed to remove extension:",O),y(l,O instanceof Error?O.message:n()("Failed to remove extension"),!0)}}const h=oe(()=>o(i)?.editor?.advanced_mode??!1),v=oe(()=>e.workspaceId!==null&&o(i)!==null);var m=vh(),w=f(m),b=f(w),k=f(b),I=g(b,2);{var C=W=>{var O=oh(),T=f(O);R(G=>x(T,G),[()=>n()("Please select a workspace to configure settings.")]),_(W,O)},L=(W,O)=>{{var T=G=>{var U=lh(),F=f(U);R(D=>x(F,D),[()=>n()("Loading settings...")]),_(G,U)};j(W,G=>{o(s)&&G(T)},O)}};j(I,W=>{e.workspaceId?W(L,!1):W(C)})}var E=g(w,2);{var N=W=>{var O=ch(),T=f(O),G=f(T),U=g(T);R(F=>{x(G,`${F??""}:`),x(U,` ${o(l)??""}`)},[()=>n()("Error")]),_(W,O)};j(E,W=>{o(l)&&W(N)})}var z=g(E,2);{var H=W=>{var O=hh(),T=f(O),G=f(T),U=f(G),F=g(G,2),D=f(F),M=f(D);M.__change=[sh,e,i,l,n];var le=g(M,2),J=f(le),ge=g(D,2),X=f(ge),we=g(T,2),he=f(we),Ce=f(he),se=g(he,2);let Q;var ve=f(se),Z=f(ve),ue=g(ve,2);ue.__change=c;var Fe=g(ue,2);{var je=me=>{var _e=dh(),Pe=f(_e);R($e=>x(Pe,$e),[()=>n()("Advanced Mode required for extension management")]),_(me,_e)};j(Fe,me=>{o(h)||me(je)})}var Ge=g(se,2);{var ne=me=>{var _e=uh(),Pe=f(_e);R($e=>x(Pe,$e),[()=>n()("Loading extensions...")]),_(me,_e)},be=(me,_e)=>{{var Pe=He=>{var Je=fh(),at=f(Je);R(ce=>x(at,ce),[()=>n()("No extensions installed.")]),_(He,Je)},$e=He=>{var Je=ph();kt(Je,21,()=>o(d),It,(at,ce)=>{var ke=ht(),Ee=Ze(ke);{var ze=$=>{ih($,{get extension(){return o(ce)},get workspaceId(){return e.workspaceId},get isAdvancedMode(){return o(h)},get extensionManager(){return e.extensionManager},onRemove:()=>p(o(ce).name)})};j(Ee,$=>{e.workspaceId&&$(ze)})}_(at,ke)}),_(He,Je)};j(me,He=>{o(d).length===0?He(Pe):He($e,!1)},_e)}};j(Ge,me=>{o(u)?me(ne):me(be,!1)})}R((me,_e,Pe,$e,He,Je,at)=>{x(U,me),Vs(M,o(h)),M.disabled=o(s),x(J,_e),x(X,Pe),x(Ce,$e),Q=st(se,1,"extension-import svelte-1qxmh9x",null,Q,He),x(Z,`${Je??""}: ${at??""}`),ue.disabled=o(u)},[()=>n()("Project Settings"),()=>n()("Advanced Mode"),()=>n()("Enable advanced editing features and additional controls for power users."),()=>n()("Extensions"),()=>({disabled:!o(h)}),()=>n()("Import JavaScript Extension"),()=>n()("Please copy license text into the License field below to comply with open source requirements.")]),_(W,O)};j(z,W=>{o(v)&&W(H)})}R(W=>x(k,W),[()=>n()("Settings")]),_(r,m),et(),a()}_t(["change"]);function gh(r,e){(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e()())}var wh=P('<div><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M2 5h12v1H2zm0 5h12v1H2z"></path></svg></div>'),yh=(r,e)=>{r.stopPropagation(),e()()},bh=(r,e)=>{r.stopPropagation(),e()()},xh=(r,e)=>{r.stopPropagation(),e()()},_h=(r,e)=>{r.stopPropagation(),e(r)},Sh=(r,e)=>{r.stopPropagation(),e()()},Eh=(r,e)=>{r.stopPropagation(),e(r)},kh=P('<div class="move-buttons svelte-1b48bnl" aria-label="Item controls"><button class="move-button svelte-1b48bnl">â</button> <button class="move-button delete-button svelte-1b48bnl">â</button> <button class="move-button svelte-1b48bnl">â</button> <button class="move-button svelte-1b48bnl">â</button></div>'),Th=P('<span class="error-indicator svelte-1b48bnl" aria-label="Validation error">â ï¸</span>'),Ch=P('<div role="button" tabindex="0"><!> <span class="chapter-id svelte-1b48bnl"> </span> <!> <!></div>');function Ih(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne(),s=Ne();let l=B(e,"item",8);const d=0;let u=B(e,"isSelected",8,!1),c=B(e,"isExpanded",8,!0),p=B(e,"compact",8,!1),h=B(e,"dragHandleProps",24,()=>({})),v=B(e,"isFirstItem",8,!1),m=B(e,"isLastItem",8,!1),w=B(e,"onSelect",8),b=B(e,"onMoveUp",8),k=B(e,"onMoveDown",8),I=B(e,"onRenameId",8),C=B(e,"onDelete",8);async function L(J){if(J.key==="Enter"||J.key===" "){J.preventDefault(),await b()();const ge=document.querySelector(`[aria-label="Move ${l().id} up"]`);ge&&ge.focus()}}async function E(J){if(J.key==="Enter"||J.key===" "){J.preventDefault(),await k()();const ge=document.querySelector(`[aria-label="Move ${l().id} down"]`);if(ge&&!ge.disabled)ge.focus();else{const X=document.querySelector(`[aria-label="Move ${l().id} up"]`);X&&X.focus()}}}function N(J){const ge=J.match(/^(\w+)[-_]?(\d+)$/i);if(ge){const[,he,Ce]=ge;return he.charAt(0).toUpperCase()+Ce}const X=J.split(/[\s\-_]+/).filter(he=>he.length>0);if(X.length>1)return X.map(he=>he.charAt(0).toUpperCase()).join("");const we=J.trim();return we.length<=3?we.toUpperCase():we.length<=6?we.slice(0,3):we.slice(0,2)}ft(()=>(rt(u()),rt(p())),()=>{y(i,u()&&!p())}),ft(()=>(rt(p()),rt(l())),()=>{y(s,p()?N(l().id):l().id)}),Mt(),gt();var z=Ch();let H;z.__click=function(...J){w()?.apply(this,J)},z.__keydown=[gh,w];var W=f(z);{var O=J=>{var ge=wh();_a(ge,()=>({class:"drag-handle",...h(),tabindex:"-1","aria-hidden":"true"}),void 0,"svelte-1b48bnl"),_(J,ge)};j(W,J=>{!p()&&c()&&J(O)})}var T=g(W,2),G=f(T),U=g(T,2);{var F=J=>{var ge=kh(),X=f(ge);X.__click=[yh,I];var we=g(X,2);we.__click=[bh,C];var he=g(we,2);he.__click=[xh,b],he.__keydown=[_h,L];var Ce=g(he,2);Ce.__click=[Sh,k],Ce.__keydown=[Eh,E],R((se,Q,ve,Z)=>{pe(X,"aria-label",se),pe(X,"title",Q),pe(we,"aria-label",ve),pe(we,"title",Z),he.disabled=v(),pe(he,"aria-label",`Move ${l().id} up`),pe(he,"title",`Move ${l().id} up`),Ce.disabled=m(),pe(Ce,"aria-label",`Move ${l().id} down`),pe(Ce,"title",`Move ${l().id} down`)},[()=>n()("Rename {item}",{item:l().id}),()=>n()("Rename {item}",{item:l().id}),()=>n()("Delete chapter {name}",{name:l().id}),()=>n()("Delete chapter {name}",{name:l().id})],de),_(J,ge)};j(U,J=>{o(i)&&J(F)})}var D=g(U,2);{var M=J=>{var ge=Th();_(J,ge)};j(D,J=>{!p()&&(!l().hasSourceFile||!l().linear)&&J(M)})}R(J=>{H=st(z,1,"spine-item svelte-1b48bnl",null,H,J),pe(z,"aria-pressed",u()),pe(z,"aria-label",`${l().id}${l().hasSourceFile?"":", has validation error"}`),x(G,o(s))},[()=>({compact:p(),selected:u(),"has-error":l().hasSourceFile===!1||!l().linear})],de),_(r,z),Pt(e,"index",d);var le=et({index:d});return a(),le}_t(["click","keydown"]);async function Fh(r,e,t,a,n){if(!(!e()||!t()))try{y(a,!0),await t()(e().id)}catch(i){console.error("Failed to package EPUB:",i),alert(n()("Failed to package EPUB: {error}",{error:i instanceof Error?i.message:"Unknown error"}))}finally{y(a,!1)}}var Ph=P('<div class="loading svelte-1d5i0rj"><p> </p></div>'),Mh=P('<div class="error svelte-1d5i0rj"><p> </p> <button class="retry-button svelte-1d5i0rj"> </button></div>'),Lh=P('<div class="spine-item-wrapper svelte-1d5i0rj" role="listitem"><!></div>'),Dh=P('<div class="spine-list svelte-1d5i0rj" role="list"></div>'),Rh=P('<div class="empty-state svelte-1d5i0rj"><p> </p> <button class="retry-button svelte-1d5i0rj"> </button></div>'),Uh=P('<div class="empty-state svelte-1d5i0rj"><p> </p></div>'),Ah=P('<div class="package-epub-section svelte-1d5i0rj"><button class="package-epub-button svelte-1d5i0rj"><!></button></div>'),Oh=P('<div class="spine-sidebar svelte-1d5i0rj"><!> <!></div>');function zh(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne();let s=B(e,"workspace",12,null),l=B(e,"spineService",8),d=B(e,"selectedItemId",8,null),u=B(e,"isExpanded",8,!0),c=B(e,"onWorkspaceUpdate",8,null),p=B(e,"onPackageRequested",8,null),h=Ne([]),v=Ne(!0),m=Ne(null),w=!1,b=Ne(!1);an(()=>{const X=()=>{L()};return window.addEventListener("append-spine-item",X),()=>{window.removeEventListener("append-spine-item",X)}});async function k(){s()&&l()&&await I()}async function I(){if(s()){y(v,!0),y(m,null);try{const X=await l().loadSpineItems(s());y(h,X)}catch(X){console.error("â SpineSidebar: Error loading spine items:",X),y(m,X instanceof Error?X.message:"Failed to load spine items"),y(h,[])}finally{y(v,!1)}}}function C(X){const we=new CustomEvent("select-spine-item",{detail:{itemId:X},bubbles:!0});window.dispatchEvent(we)}async function L(){if(s())try{y(v,!0);const X=await l().addChapter(s(),{title:"New Chapter",linear:!0,createSourceFile:!0});s(X.updatedWorkspace),c()&&c()(s()),await I(),C(X.newChapter.id)}catch(X){y(m,X instanceof Error?X.message:"Failed to create chapter")}finally{y(v,!1)}}async function E(X){if(!(w||X===0||!s())){w=!0;try{const we=await l().moveChapterUp(s(),X);s(we.updatedWorkspace),c()&&c()(s()),y(h,we.newOrder),z(o(h)[X-1].id,X,X-1)}catch{await I()}finally{w=!1}}}async function N(X){if(!(w||X===o(h).length-1||!s())){w=!0;try{const we=await l().moveChapterDown(s(),X);s(we.updatedWorkspace),c()&&c()(s()),y(h,we.newOrder),z(o(h)[X+1].id,X,X+1)}catch{await I()}finally{w=!1}}}function z(X,we,he){const Ce=`${X} moved from position ${we+1} to position ${he+1}`,se=document.createElement("div");se.setAttribute("role","status"),se.setAttribute("aria-live","polite"),se.style.position="absolute",se.style.left="-10000px",se.textContent=Ce,document.body.appendChild(se),setTimeout(()=>se.remove(),1e3)}function H(X,we){o(i)&&(X.dataTransfer.effectAllowed="move",X.dataTransfer.setData("text/plain",we.toString()))}function W(X){o(i)&&(X.preventDefault(),X.dataTransfer.dropEffect="move")}async function O(X,we){if(!o(i)||w)return;X.preventDefault();const he=parseInt(X.dataTransfer.getData("text/plain"),10);if(he!==we&&s()){w=!0;try{const Ce=await l().reorderItems(s(),he,we);s(Ce.updatedWorkspace),c()&&c()(s()),y(h,Ce.newOrder),z(o(h)[we].id,he,we)}catch{await I()}finally{w=!1}}}async function T(X){if(!(!s()||!window.confirm(n()("Are you sure you want to delete chapter '{name}'? This will permanently delete the chapter and its source file.",{name:X}))))try{y(v,!0);const he=await l().deleteChapter(s(),X);if(s(he.updatedWorkspace),c()&&c()(s()),d()===X){const Ce=new CustomEvent("select-spine-item",{detail:{itemId:null},bubbles:!0});window.dispatchEvent(Ce)}y(h,await l().loadSpineItems(s()))}catch(he){console.error("Failed to delete chapter:",he)}finally{y(v,!1)}}async function G(X){if(!s())return;const we=window.prompt(n()("Enter new ID for {item}:",{item:X}),X);if(!(!we||we===X))try{y(v,!0);const he=await l().renameChapterId(s(),X,we);s(he.updatedWorkspace),c()&&c()(s()),await I(),C(we)}catch(he){console.error("Failed to rename chapter ID:",he),alert(n()("Failed to rename chapter ID: {error}",{error:he instanceof Error?he.message:"Unknown error"}))}finally{y(v,!1)}}ft(()=>rt(u()),()=>{y(i,u())}),ft(()=>(rt(s()),rt(l())),()=>{s()&&l()?I():s()||(y(h,[]),y(v,!1),y(m,null))}),Mt(),gt();var U=Oh(),F=f(U);{var D=X=>{var we=Ph(),he=f(we),Ce=f(he);R(se=>x(Ce,se),[()=>n()("Loading spine itemsâ¦")],de),_(X,we)},M=(X,we)=>{{var he=se=>{var Q=Mh(),ve=f(Q),Z=f(ve),ue=g(ve,2);ue.__click=I;var Fe=f(ue);R(je=>{x(Z,o(m)),x(Fe,je)},[()=>n()("Retry")],de),_(se,Q)},Ce=(se,Q)=>{{var ve=ue=>{var Fe=Dh();kt(Fe,7,()=>o(h),je=>je.id,(je,Ge,ne)=>{var be=Lh(),me=f(be);const _e=de(()=>d()===o(Ge).id),Pe=de(()=>!u()),$e=de(()=>o(ne)===0),He=de(()=>o(ne)===o(h).length-1);Ih(me,{get item(){return o(Ge)},get index(){return o(ne)},get isSelected(){return o(_e)},get isExpanded(){return o(i)},get compact(){return o(Pe)},get isFirstItem(){return o($e)},get isLastItem(){return o(He)},onSelect:()=>C(o(Ge).id),onMoveUp:async()=>await E(o(ne)),onMoveDown:async()=>await N(o(ne)),onRenameId:async()=>await G(o(Ge).id),onDelete:async()=>await T(o(Ge).id),dragHandleProps:{draggable:!0,"data-drag-handle":!0}}),R(()=>pe(be,"draggable",o(i))),Ke("dragstart",be,Je=>H(Je,o(ne))),Ke("dragover",be,W),Ke("drop",be,Je=>O(Je,o(ne))),_(je,be)}),_(ue,Fe)},Z=(ue,Fe)=>{{var je=ne=>{var be=Rh(),me=f(be),_e=f(me),Pe=g(me,2);Pe.__click=I;var $e=f(Pe);R((He,Je)=>{x(_e,He),x($e,Je)},[()=>n()("No spine items yet"),()=>n()("Refresh")],de),_(ne,be)},Ge=ne=>{var be=Uh(),me=f(be),_e=f(me);R(Pe=>x(_e,Pe),[()=>n()("No project selected")],de),_(ne,be)};j(ue,ne=>{s()&&!o(v)?ne(je):ne(Ge,!1)},Fe)}};j(se,ue=>{o(h).length>0?ue(ve):ue(Z,!1)},Q)}};j(X,se=>{o(m)?se(he):se(Ce,!1)},we)}};j(F,X=>{o(v)?X(D):X(M,!1)})}var le=g(F,2);{var J=X=>{var we=Ah(),he=f(we);he.__click=[Fh,s,p,b,n];var Ce=f(he);{var se=ve=>{var Z=Et();R(ue=>x(Z,ue),[()=>n()("Packaging...")],de),_(ve,Z)},Q=ve=>{var Z=Et();R(ue=>x(Z,ue),[()=>n()("Package EPUB")],de),_(ve,Z)};j(Ce,ve=>{o(b)?ve(se):ve(Q,!1)})}R(ve=>{he.disabled=o(b),pe(he,"title",ve)},[()=>n()("Package EPUB")],de),_(X,we)};j(le,X=>{s()&&X(J)})}_(r,U),Pt(e,"refreshSpineItems",k);var ge=et({refreshSpineItems:k});return a(),ge}_t(["click"]);const Wh=(r,e)=>{const t=r.target;y(e,t.value)},Nh=(r,e)=>{o(e)?.click()},jh=(r,e)=>{e("itemCreate",{mode:"create-text"})},Bh=(r,e,t,a)=>{e()&&t()==="manifest"&&a("itemEdit",{item:e()})},$h=(r,e)=>{y(e,"")};var Hh=P('<button type="button" class="clear-filter-button svelte-8hsxjr">Ã</button>'),qh=P('<div class="drag-overlay svelte-8hsxjr"><div class="drag-message svelte-8hsxjr"><p class="svelte-8hsxjr"> </p></div></div>'),Vh=P('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),Gh=P('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),Xh=P('<div class="empty-state svelte-8hsxjr"><!></div>'),Kh=(r,e)=>e("id"),Yh=(r,e)=>e("href"),Jh=(r,e)=>e("size"),Zh=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr"> </span></div></td></tr>'),Qh=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Source Files</span></div></td></tr>'),ev=P('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Package Files</span></div></td></tr>'),tv=(r,e,t,a)=>e(o(t),o(a)),nv=(r,e,t,a)=>e(r,o(t),o(a)),rv=P('<span class="property-tag svelte-8hsxjr"> </span>'),av=P('<div class="properties-list svelte-8hsxjr"></div>'),iv=P('<!> <!> <!> <tr tabindex="0"><td class="id-cell svelte-8hsxjr"><span class="item-id svelte-8hsxjr" dir="ltr"> </span></td><td class="href-cell svelte-8hsxjr"><span class="item-href svelte-8hsxjr" dir="ltr"> </span></td><td class="size-cell svelte-8hsxjr"> </td><td class="properties-cell svelte-8hsxjr"><!></td><!></tr>',1),sv=P('<table class="manifest-table svelte-8hsxjr"><thead><tr><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"> </th></tr></thead><tbody></tbody></table>'),ov=P('<div class="manifest-table-container svelte-8hsxjr"><div role="toolbar" tabindex="0"><div class="filter-section svelte-8hsxjr"><label for="manifest-filter" class="filter-label svelte-8hsxjr"> </label> <div class="filter-input-container svelte-8hsxjr"><input id="manifest-filter" type="text" class="filter-input svelte-8hsxjr"/> <!></div></div> <div class="action-buttons svelte-8hsxjr"><button type="button" class="action-button secondary svelte-8hsxjr"> </button> <button type="button" class="action-button primary svelte-8hsxjr"> </button> <button type="button" class="action-button secondary svelte-8hsxjr"> </button></div> <input type="file" multiple accept="*/*" style="display: none;"/> <!></div> <div class="table-container svelte-8hsxjr"><!></div></div>');function lv(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t),i=Ne(),s=Ne(),l=Ne();let d=B(e,"manifestItems",24,()=>[]),u=B(e,"sourceItems",24,()=>[]),c=B(e,"advancedMode",8,!0),p=B(e,"validationErrors",24,()=>[]),h=B(e,"selectedItem",8,null),v=B(e,"selectedItemType",8,null),m=B(e,"loading",8,!1);const w=Lt();let b=Ne(""),k=Ne(!1),I=Ne(),C=Ne("id"),L=Ne("asc");const E=ce=>{o(C)===ce?y(L,o(L)==="asc"?"desc":"asc"):(y(C,ce),y(L,"asc"))},N=(ce,ke)=>{w("itemSelect",{item:ce,type:ke==="source-zip"?"source":ke})},z=(ce,ke,Ee)=>{(ce.key==="Enter"||ce.key===" ")&&(ce.preventDefault(),N(ke,Ee))},H=(ce,ke)=>{if(!h())return!1;const Ee=ke==="source-zip"?"source":ke;return v()!==Ee?!1:ke==="manifest"?ce.id===h().id:ce.path===h().path},W=ce=>p().filter(ke=>ke.itemId===ce.id),O=ce=>W(ce).length>0,T=ce=>{if(!ce)return"-";const ke=["B","KB","MB","GB"];let Ee=ce,ze=0;for(;Ee>=1024&&ze<ke.length-1;)Ee/=1024,ze++;return`${Ee.toFixed(ze===0?0:1)} ${ke[ze]}`},G=ce=>o(C)!==ce?"â":o(L)==="asc"?"â":"â",U=ce=>{const ke=ce.target;ke.files&&ke.files.length>0&&(w("fileUpload",{files:ke.files}),ke.value="")},F=ce=>{ce.preventDefault(),y(k,!0)},D=ce=>{ce.preventDefault(),y(k,!1)},M=ce=>{ce.preventDefault(),y(k,!1),ce.dataTransfer?.files&&ce.dataTransfer.files.length>0&&w("fileUpload",{files:ce.dataTransfer.files})};ft(()=>(rt(d()),rt(c()),rt(u())),()=>{y(i,[...d().map(ce=>({...ce,_type:"manifest"})),{name:"content.opf",path:"content.opf",size:void 0,_type:"opf"},...c()?u().map(ce=>({...ce,_type:"source"})):[],...c()?[]:[{name:"SOURCE.zip",path:"SOURCE.zip",size:void 0,_type:"source-zip",isPlaceholder:!0}]])}),ft(()=>(o(i),o(b)),()=>{y(s,o(i).filter(ce=>{if(!o(b))return!0;const ke=o(b).toLowerCase();if(ce._type==="manifest"){const Ee=ce;return Ee.id.toLowerCase().includes(ke)||Ee.href.toLowerCase().includes(ke)||Ee.properties?.some(ze=>ze.toLowerCase().includes(ke))||!1}else if(ce._type==="source"){const Ee=ce;return Ee.name.toLowerCase().includes(ke)||Ee.path.toLowerCase().includes(ke)}else if(ce._type==="source-zip"){const Ee=ce;return Ee.name.toLowerCase().includes(ke)||Ee.path.toLowerCase().includes(ke)}else{const Ee=ce;return Ee.name.toLowerCase().includes(ke)||Ee.path.toLowerCase().includes(ke)}}))}),ft(()=>(o(s),o(C),o(L)),()=>{y(l,(()=>{const ce=o(s).filter(V=>V._type==="manifest"),ke=o(s).filter(V=>V._type==="source"),Ee=o(s).filter(V=>V._type==="source-zip"),ze=o(s).filter(V=>V._type==="opf"),$=V=>[...V].sort((Y,te)=>{let Te="",q="";return o(C)==="id"?(Te=Y._type==="manifest"?Y.id:(Y._type==="source"||Y._type==="source-zip",Y.name),q=te._type==="manifest"?te.id:(te._type==="source"||te._type==="source-zip",te.name)):o(C)==="href"?(Te=Y._type==="manifest"?Y.href:(Y._type==="source"||Y._type==="source-zip",Y.path),q=te._type==="manifest"?te.href:(te._type==="source"||te._type==="source-zip",te.path)):o(C)==="size"&&(Te=Y.size||0,q=te.size||0),Te<q?o(L)==="asc"?-1:1:Te>q?o(L)==="asc"?1:-1:0});return[...$(ce),...$(ke),...$(ze),...$(Ee)]})())}),Mt(),gt();var le=ov(),J=f(le);let ge;var X=f(J),we=f(X),he=f(we),Ce=g(we,2),se=f(Ce);se.__input=[Wh,b];var Q=g(se,2);{var ve=ce=>{var ke=Hh();ke.__click=[$h,b],R(Ee=>pe(ke,"aria-label",Ee),[()=>n()("Clear filter")],de),_(ce,ke)};j(Q,ce=>{o(b)&&ce(ve)})}var Z=g(X,2),ue=f(Z);ue.__click=[Bh,h,v,w];var Fe=f(ue),je=g(ue,2);je.__click=[Nh,I];var Ge=f(je),ne=g(je,2);ne.__click=[jh,w];var be=f(ne),me=g(Z,2);me.__change=U,Nt(me,ce=>y(I,ce),()=>o(I));var _e=g(me,2);{var Pe=ce=>{var ke=qh(),Ee=f(ke),ze=f(Ee),$=f(ze);R(V=>x($,V),[()=>n()("Drop files here to add them to the manifest")],de),_(ce,ke)};j(_e,ce=>{o(k)&&ce(Pe)})}var $e=g(J,2),He=f($e);{var Je=ce=>{var ke=Xh(),Ee=f(ke);{var ze=V=>{var Y=Vh(),te=Ze(Y),Te=f(te),q=g(te,2),fe=f(q);R((ae,xe)=>{x(Te,ae),x(fe,xe)},[()=>n()("No items match your filter"),()=>n()("Try adjusting your search terms")],de),_(V,Y)},$=V=>{var Y=Gh(),te=Ze(Y),Te=f(te),q=g(te,2),fe=f(q);R((ae,xe)=>{x(Te,ae),x(fe,xe)},[()=>n()("No manifest items found"),()=>n()("Create your first item using the buttons above")],de),_(V,Y)};j(Ee,V=>{o(b)?V(ze):V($,!1)})}_(ce,ke)},at=ce=>{var ke=sv(),Ee=f(ke),ze=f(Ee),$=f(ze),V=f($);V.__click=[Kh,E];var Y=f(V),te=g($),Te=f(te);Te.__click=[Yh,E];var q=f(Te),fe=g(te),ae=f(fe);ae.__click=[Jh,E];var xe=f(ae),Ie=g(fe),Ae=f(Ie),Le=g(Ee);kt(Le,5,()=>o(l),It,(We,ye,Oe)=>{var Be=iv();const Me=de(()=>o(ye)._type),S=de(()=>H(o(ye),o(Me))),K=de(()=>o(Me)==="manifest"?O(o(ye)):!1),re=de(()=>Oe>0?o(l)[Oe-1]._type:null),Se=de(()=>o(Me)==="source"&&o(re)==="manifest"),De=de(()=>o(Me)==="source-zip"&&o(re)==="opf"),A=de(()=>o(Me)==="opf"&&(o(re)==="manifest"||o(re)==="source"));var ee=Ze(Be);{var ie=mt=>{var Bt=Zh(),Ta=f(Bt),Ca=f(Ta),Wr=f(Ca),Ia=f(Wr);R(Co=>x(Ia,Co),[()=>n()("SOURCE.zip")],de),_(mt,Bt)};j(ee,mt=>{o(Se)&&mt(ie)})}var Re=g(ee,2);{var qe=mt=>{var Bt=Qh();_(mt,Bt)};j(Re,mt=>{o(De)&&mt(qe)})}var Ve=g(Re,2);{var tt=mt=>{var Bt=ev();_(mt,Bt)};j(Ve,mt=>{o(A)&&mt(tt)})}var ct=g(Ve,2);let it;ct.__click=[tv,N,ye,Me],ct.__keydown=[nv,z,ye,Me];var Dt=f(ct),Gt=f(Dt),Tn=f(Gt),jt=g(Dt),Xt=f(jt),Cn=f(Xt),Ft=g(jt),In=f(Ft),zr=g(Ft),_o=f(zr);{var So=mt=>{var Bt=av();kt(Bt,5,()=>o(ye).properties||[],It,(Ta,Ca)=>{var Wr=rv(),Ia=f(Wr);R(()=>x(Ia,o(Ca))),_(Ta,Wr)}),_(mt,Bt)},Eo=mt=>{var Bt=Et("-");_(mt,Bt)};j(_o,mt=>{o(Me)==="manifest"&&o(ye).properties&&(o(ye).properties?.length??0)>0?mt(So):mt(Eo,!1)})}var ko=g(zr);{var To=mt=>{};j(ko,mt=>{o(Me)==="manifest"&&mt(To)})}R((mt,Bt)=>{it=st(ct,1,"manifest-row svelte-8hsxjr",null,it,mt),pe(ct,"aria-selected",o(S)),x(Tn,o(Me)==="manifest"?o(ye).id:(o(Me)==="source"||o(Me)==="source-zip")&&o(ye).name||o(ye).name),Gt.dir=Gt.dir,x(Cn,o(Me)==="manifest"?o(ye).href:(o(Me)==="source"||o(Me)==="source-zip")&&o(ye).path||o(ye).path),Xt.dir=Xt.dir,x(In,Bt)},[()=>({selected:o(S),error:o(K),"source-item":o(Me)==="source","source-zip-item":o(Me)==="source-zip","opf-item":o(Me)==="opf"}),()=>T(o(ye).size)],de),_(We,Be)}),R((We,ye,Oe,Be,Me,S,K,re,Se,De)=>{pe(V,"aria-label",We),x(Y,`${ye??""}
                ${Oe??""}`),pe(Te,"aria-label",Be),x(q,`${Me??""}
                ${S??""}`),pe(ae,"aria-label",K),x(xe,`${re??""}
                ${Se??""}`),x(Ae,De)},[()=>n()("Sort by ID"),()=>n()("ID"),()=>G("id"),()=>n()("Sort by path"),()=>n()("Path"),()=>G("href"),()=>n()("Sort by size"),()=>n()("Size"),()=>G("size"),()=>n()("Properties")],de),_(ce,ke)};j(He,ce=>{o(l).length===0?ce(Je):ce(at,!1)})}R((ce,ke,Ee,ze,$,V,Y)=>{ge=st(J,1,"manifest-toolbar svelte-8hsxjr",null,ge,ce),pe(J,"aria-label",ke),x(he,`${Ee??""}:`),pe(se,"placeholder",ze),En(se,o(b)),se.disabled=m(),ue.disabled=!h()||v()!=="manifest",x(Fe,`âï¸ ${$??""}`),je.disabled=m(),x(Ge,`ð ${V??""}`),ne.disabled=m(),x(be,`ð ${Y??""}`)},[()=>({"drag-active":o(k)}),()=>n()("Manifest actions"),()=>n()("Filter"),()=>n()("Filter by ID, path, or media type..."),()=>n()("Edit Item"),()=>n()("Load File"),()=>n()("Create Text File")],de),Ke("dragover",J,F),Ke("dragleave",J,D),Ke("drop",J,M),_(r,le),et(),a()}_t(["input","click","change","keydown"]);class wo{static generateItemId(e){return!e||e.trim()===""?"item":e.replace(/\.[^/.]+$/,"").toLowerCase().replace(/[^a-z0-9_-]/g,"_").replace(/^[0-9]/,"item_$&").replace(/^[^a-z_]/,"item").replace(/^_+|_+$/g,"")||"item"}static detectMediaType(e,t){const a=this.getFileExtension(e).toLowerCase(),i={xhtml:"application/xhtml+xml",html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",txt:"text/plain",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",bmp:"image/bmp",ico:"image/x-icon",mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",m4a:"audio/mp4",aac:"audio/aac",flac:"audio/flac",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",avi:"video/x-msvideo",mov:"video/quicktime",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2",eot:"application/vnd.ms-fontobject",pdf:"application/pdf",epub:"application/epub+zip",zip:"application/zip"}[a];return i||(t&&t.byteLength>0?this.detectMediaTypeFromContent(t):"application/octet-stream")}static detectMediaTypeFromContent(e){const t=new Uint8Array(e);if(t.length>=8){if(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71)return"image/png";if(t[0]===255&&t[1]===216&&t[2]===255)return"image/jpeg";if(t[0]===71&&t[1]===73&&t[2]===70&&t[3]===56)return"image/gif";if(t[0]===37&&t[1]===80&&t[2]===68&&t[3]===70)return"application/pdf";if(t[0]===80&&t[1]===75&&(t[2]===3||t[2]===5))return"application/zip"}try{const a=new TextDecoder("utf-8",{fatal:!0}).decode(e);return a.includes("<?xml")?"application/xml":a.includes("<html")||a.includes("<!DOCTYPE html")?"text/html":"text/plain"}catch{}return"application/octet-stream"}static getMediaTypeCategories(){return{text:[{mediaType:"application/xhtml+xml",extensions:["xhtml"],description:"XHTML Document",isEpubCore:!0},{mediaType:"text/html",extensions:["html","htm"],description:"HTML Document"},{mediaType:"text/css",extensions:["css"],description:"CSS Stylesheet",isEpubCore:!0},{mediaType:"application/javascript",extensions:["js"],description:"JavaScript"},{mediaType:"application/json",extensions:["json"],description:"JSON Data"},{mediaType:"text/plain",extensions:["txt"],description:"Plain Text"},{mediaType:"application/xml",extensions:["xml"],description:"XML Document"}],image:[{mediaType:"image/jpeg",extensions:["jpg","jpeg"],description:"JPEG Image",isEpubCore:!0},{mediaType:"image/png",extensions:["png"],description:"PNG Image",isEpubCore:!0},{mediaType:"image/gif",extensions:["gif"],description:"GIF Image",isEpubCore:!0},{mediaType:"image/svg+xml",extensions:["svg"],description:"SVG Image",isEpubCore:!0},{mediaType:"image/webp",extensions:["webp"],description:"WebP Image"},{mediaType:"image/bmp",extensions:["bmp"],description:"Bitmap Image"}],audio:[{mediaType:"audio/mpeg",extensions:["mp3"],description:"MP3 Audio",isEpubCore:!0},{mediaType:"audio/mp4",extensions:["m4a"],description:"MP4 Audio",isEpubCore:!0},{mediaType:"audio/ogg",extensions:["ogg"],description:"OGG Audio"},{mediaType:"audio/wav",extensions:["wav"],description:"WAV Audio"},{mediaType:"audio/aac",extensions:["aac"],description:"AAC Audio"}],video:[{mediaType:"video/mp4",extensions:["mp4"],description:"MP4 Video",isEpubCore:!0},{mediaType:"video/webm",extensions:["webm"],description:"WebM Video"},{mediaType:"video/ogg",extensions:["ogv"],description:"OGG Video"},{mediaType:"video/quicktime",extensions:["mov"],description:"QuickTime Video"}],application:[{mediaType:"font/ttf",extensions:["ttf"],description:"TrueType Font",isEpubCore:!0},{mediaType:"font/otf",extensions:["otf"],description:"OpenType Font",isEpubCore:!0},{mediaType:"font/woff",extensions:["woff"],description:"WOFF Font",isEpubCore:!0},{mediaType:"font/woff2",extensions:["woff2"],description:"WOFF2 Font",isEpubCore:!0},{mediaType:"application/pdf",extensions:["pdf"],description:"PDF Document"},{mediaType:"application/zip",extensions:["zip"],description:"ZIP Archive"},{mediaType:"application/octet-stream",extensions:[],description:"Binary Data"}]}}static createBlobUrl(e,t){const a=typeof e=="string"?new Blob([e],{type:t}):new Blob([e],{type:t});return URL.createObjectURL(a)}static revokeBlobUrl(e){URL.revokeObjectURL(e)}static formatFileSize(e){if(e===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+a[n]}static getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1):""}static sanitizeFileName(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}}var cv=P('<p class="file-info svelte-ziknnq"> </p>'),dv=P('<div class="form-group svelte-ziknnq"><label for="file-input" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="file-input" type="file" class="file-input svelte-ziknnq" required/> <!></div>'),uv=P('<p class="error-message svelte-ziknnq"> </p>'),fv=P('<p class="error-message svelte-ziknnq"> </p>'),pv=P("<option> </option>"),hv=P('<p class="error-message svelte-ziknnq"> </p>'),vv=P('<label class="checkbox-label svelte-ziknnq"><input type="checkbox" class="checkbox-input svelte-ziknnq"/> </label>'),mv=P('<div class="form-group svelte-ziknnq"><label for="text-content" class="form-label svelte-ziknnq"> </label> <textarea id="text-content" class="form-textarea svelte-ziknnq" rows="3"></textarea> <p class="field-help svelte-ziknnq"> </p></div>'),gv=P('<div class="modal-overlay svelte-ziknnq" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-content svelte-ziknnq"><div class="modal-header svelte-ziknnq"><h2 id="modal-title" class="svelte-ziknnq"><!></h2> <button type="button" class="close-button svelte-ziknnq">Ã</button></div> <form class="modal-form svelte-ziknnq"><div class="form-body svelte-ziknnq"><!> <div class="form-group svelte-ziknnq"><label for="item-id" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-id" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-href" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-href" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-mediatype" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <select id="item-mediatype" required><option> </option><!></select> <!></div> <div class="form-group svelte-ziknnq"><fieldset class="checkbox-fieldset svelte-ziknnq"><legend class="form-label svelte-ziknnq"> </legend> <div class="checkbox-group svelte-ziknnq"></div></fieldset></div> <!></div> <div class="modal-footer svelte-ziknnq"><button type="button" class="cancel-button svelte-ziknnq"> </button> <button type="submit" class="save-button svelte-ziknnq"><!></button></div></form></div></div>');function wv(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"itemEditorMode",8,"create-text"),s=B(e,"item",8,null),l=B(e,"validationErrors",24,()=>[]);const d=Lt();let u=Ne(),c=Ne({id:"",href:"",mediaType:"",properties:[]}),p=Ne(""),h=Ne(),v=Ne(null);const m=[{value:"application/xhtml+xml",label:"XHTML"},{value:"text/html",label:"HTML"},{value:"text/css",label:"CSS"},{value:"text/javascript",label:"JavaScript"},{value:"text/plain",label:"Plain Text"},{value:"image/jpeg",label:"JPEG Image"},{value:"image/png",label:"PNG Image"},{value:"image/svg+xml",label:"SVG Image"},{value:"audio/mpeg",label:"MP3 Audio"},{value:"audio/ogg",label:"OGG Audio"},{value:"video/mp4",label:"MP4 Video"},{value:"video/webm",label:"WebM Video"},{value:"application/pdf",label:"PDF"},{value:"application/epub+zip",label:"EPUB"}],w=[{value:"cover-image",label:"Cover Image"},{value:"mathml",label:"MathML"},{value:"nav",label:"Navigation"},{value:"remote-resources",label:"Remote Resources"},{value:"scripted",label:"Scripted"},{value:"svg",label:"SVG"}],b=()=>{d("close")},k=S=>{S.target===o(u)&&b()},I=S=>{S.key==="Escape"&&S.target===o(u)&&b()},C=S=>{S.key==="Escape"&&b()},L=S=>{const K=S.target;if(K.files&&K.files.length>0){y(v,K.files[0]),o(c).id||Xe(c,o(c).id=o(v).name.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"));const re=o(v).type,Se=wo.detectMediaType(o(v).name),De=!re||re==="application/octet-stream",A=Se.startsWith("font/"),ee=De||A?Se:re;o(c).href||Xe(c,o(c).href=Ka(o(v).name,ee)),o(c).mediaType||Xe(c,o(c).mediaType=ee)}},E=S=>{if(S.preventDefault(),!o(c).id||!o(c).href||!o(c).mediaType){alert(n()("Please fill in all required fields"));return}const K={id:o(c).id,href:o(c).href,mediaType:o(c).mediaType,properties:o(c).properties?.filter(re=>re.length>0)};d("save",{item:K,textContent:o(p),selectedFile:o(v)})},N=(S,K)=>{K?Xe(c,o(c).properties=[...o(c).properties||[],S]):Xe(c,o(c).properties=(o(c).properties||[]).filter(re=>re!==S))},z=()=>{if(o(c).href){const S=o(c).href.split("/").pop()||"";Xe(c,o(c).id=S.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"))}},H=()=>{if(o(c).id&&!o(c).href){const S=W(o(c).mediaType||""),K=o(c).id+S;Xe(c,o(c).href=Ka(K,o(c).mediaType||""))}},W=S=>({"application/xhtml+xml":".xhtml","text/html":".html","text/css":".css","text/javascript":".js","text/plain":".txt","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/svg+xml":".svg","audio/mpeg":".mp3","audio/ogg":".ogg","video/mp4":".mp4","video/webm":".webm","application/pdf":".pdf"})[S]||".dat",O=S=>{const K=l().find(re=>re.field===S);return K?K.message:null},T=S=>l().some(K=>K.field===S);ft(()=>(rt(i()),rt(s())),()=>{if(i()==="edit"&&s()&&"id"in s()){const S=s();y(c,{id:S.id,href:S.href,mediaType:S.mediaType,properties:S.properties||[]})}else y(c,{id:"",href:"",mediaType:i()==="create-text"?"text/plain":"",properties:[]})}),Mt(),gt();var G=gv();Ke("keydown",Ba,C);var U=f(G),F=f(U),D=f(F),M=f(D);{var le=S=>{var K=Et();R(re=>x(K,re),[()=>n()("Create Text File")],de),_(S,K)},J=(S,K)=>{{var re=De=>{var A=Et();R(ee=>x(A,ee),[()=>n()("Upload File")],de),_(De,A)},Se=De=>{var A=Et();R(ee=>x(A,ee),[()=>n()("Edit Manifest Item")],de),_(De,A)};j(S,De=>{i()==="create-file"?De(re):De(Se,!1)},K)}};j(M,S=>{i()==="create-text"?S(le):S(J,!1)})}var ge=g(D,2),X=g(F,2),we=f(X),he=f(we);{var Ce=S=>{var K=dv(),re=f(K),Se=f(re),De=g(re,2);Nt(De,ie=>y(h,ie),()=>o(h));var A=g(De,2);{var ee=ie=>{var Re=cv(),qe=f(Re);R((Ve,tt)=>x(qe,`${Ve??""}: ${o(v).name??""} (${tt??""} KB)`),[()=>n()("Selected"),()=>(o(v).size/1024).toFixed(1)],de),_(ie,Re)};j(A,ie=>{o(v)&&ie(ee)})}R(ie=>x(Se,`${ie??""} `),[()=>n()("Select File")],de),Ke("change",De,L),_(S,K)};j(he,S=>{i()==="create-file"&&S(Ce)})}var se=g(he,2),Q=f(se),ve=f(Q),Z=g(Q,2);let ue;var Fe=g(Z,2);{var je=S=>{var K=uv(),re=f(K);R(Se=>x(re,Se),[()=>O("id")],de),_(S,K)};j(Fe,S=>{O("id")&&S(je)})}var Ge=g(se,2),ne=f(Ge),be=f(ne),me=g(ne,2);let _e;var Pe=g(me,2);{var $e=S=>{var K=fv(),re=f(K);R(Se=>x(re,Se),[()=>O("href")],de),_(S,K)};j(Pe,S=>{O("href")&&S($e)})}var He=g(Ge,2),Je=f(He),at=f(Je),ce=g(Je,2);R(()=>{o(c),Cl(()=>{n()})});let ke;var Ee=f(ce);Ee.value=Ee.__value="";var ze=f(Ee),$=g(Ee);kt($,1,()=>m,It,(S,K)=>{var re=pv(),Se={},De=f(re);R(()=>{Se!==(Se=o(K).value)&&(re.value=(re.__value=o(K).value)??""),x(De,o(K).label)}),_(S,re)});var V=g(ce,2);{var Y=S=>{var K=hv(),re=f(K);R(Se=>x(re,Se),[()=>O("mediaType")],de),_(S,K)};j(V,S=>{O("mediaType")&&S(Y)})}var te=g(He,2),Te=f(te),q=f(Te),fe=f(q),ae=g(q,2);kt(ae,5,()=>w,It,(S,K)=>{var re=vv(),Se=f(re),De=g(Se);R(A=>{Vs(Se,A),x(De,` ${o(K).label??""}`)},[()=>o(c).properties?.includes(o(K).value)||!1],de),Ke("change",Se,A=>N(o(K).value,A.currentTarget.checked)),_(S,re)});var xe=g(te,2);{var Ie=S=>{var K=mv(),re=f(K),Se=f(re),De=g(re,2),A=g(De,2),ee=f(A);R((ie,Re,qe)=>{x(Se,ie),pe(De,"placeholder",Re),x(ee,qe)},[()=>n()("Initial Content"),()=>n()("Enter the initial content for this text fileâ¦"),()=>n()("You can edit the content later in the main editor")],de),Jr(De,()=>o(p),ie=>y(p,ie)),_(S,K)};j(xe,S=>{i()==="create-text"&&S(Ie)})}var Ae=g(we,2),Le=f(Ae),We=f(Le),ye=g(Le,2),Oe=f(ye);{var Be=S=>{var K=Et();R(re=>x(K,re),[()=>n()("Create Text File")],de),_(S,K)},Me=(S,K)=>{{var re=De=>{var A=Et();R(ee=>x(A,ee),[()=>n()("Upload File")],de),_(De,A)},Se=De=>{var A=Et();R(ee=>x(A,ee),[()=>n()("Save Changes")],de),_(De,A)};j(S,De=>{i()==="create-file"?De(re):De(Se,!1)},K)}};j(Oe,S=>{i()==="create-text"?S(Be):S(Me,!1)})}Nt(G,S=>y(u,S),()=>o(u)),R((S,K,re,Se,De,A,ee,ie,Re,qe,Ve,tt)=>{pe(ge,"aria-label",S),x(ve,`${K??""} `),ue=st(Z,1,"form-input svelte-ziknnq",null,ue,re),pe(Z,"placeholder",Se),Z.dir=Z.dir,x(be,`${De??""} `),_e=st(me,1,"form-input svelte-ziknnq",null,_e,A),pe(me,"placeholder",ee),me.dir=me.dir,x(at,`${ie??""} `),ke=st(ce,1,"form-select svelte-ziknnq",null,ke,Re),x(ze,qe),x(fe,Ve),x(We,tt)},[()=>n()("Close"),()=>n()("ID"),()=>({error:T("id")}),()=>n()("Unique identifier for this item"),()=>n()("File Path"),()=>({error:T("href")}),()=>n()("OEBPS/filename.ext"),()=>n()("Media Type"),()=>({error:T("mediaType")}),()=>n()("Select media typeâ¦"),()=>n()("EPUB Properties"),()=>n()("Cancel")],de),Ke("click",ge,b),Jr(Z,()=>o(c).id,S=>Xe(c,o(c).id=S)),Ke("blur",Z,H),Jr(me,()=>o(c).href,S=>Xe(c,o(c).href=S)),Ke("blur",me,z),$s(ce,()=>o(c).mediaType,S=>Xe(c,o(c).mediaType=S)),Ke("click",Le,b),Ke("submit",X,E),Ke("click",G,k),Ke("keydown",G,I),_(r,G),et(),a()}var yv=P('<div class="loading-state svelte-12tyyls"><p> </p></div>'),bv=P('<div class="error-state svelte-12tyyls"><p class="error-message svelte-12tyyls"> </p> <button type="button" class="retry-button svelte-12tyyls"> </button></div>'),xv=P("<!> <!>",1);function _v(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"workspace",7,null),s=B(e,"advancedMode",3,!0),l=Ue(Ct([])),d=Ue(Ct([])),u=Ue(null),c=Ue(null),p=Ue(Ct([])),h=Ue(!0),v=Ue(null),m=Ue(!1),w=Ue("create-text");const b=async()=>{if(i())try{y(h,!0),y(v,null);const F=i().opf.manifest,D=await Promise.all(F.map(async M=>{try{const le=i().pathInfo.basePath?`${i().pathInfo.basePath}/${M.href}`:M.href,J=await e.workspaceService.getFileInfo(i().id,le);return{...M,size:J.size}}catch{return M}}));if(y(l,D,!0),s())try{y(d,await e.workspaceService.listSourceFiles(i()),!0)}catch(M){console.warn("Failed to load SOURCE items:",M),y(d,[],!0)}else y(d,[],!0);y(p,[],!0)}catch{y(v,n()("Failed to load manifest"),!0)}finally{y(h,!1)}},k=F=>{y(u,F.detail.item,!0),y(c,F.detail.type,!0),e.onItemSelect?.({item:F.detail.item,type:F.detail.type})},I=F=>{y(w,F.detail.mode,!0),y(m,!0)},C=F=>{y(u,F.detail.item,!0),y(c,"manifest"),y(w,"edit"),y(m,!0)},L=async F=>{if(!(!i()||!confirm(n()("Are you sure you want to delete this item?"))))try{i(await e.workspaceService.removeManifestItem(i(),F.detail.itemId)),await b(),o(u)&&"id"in o(u)&&o(u).id===F.detail.itemId&&(y(u,null),y(c,null))}catch{y(v,n()("Failed to delete item"),!0)}},E=async F=>{if(i())try{const{item:D}=F.detail;if(o(w)==="edit"&&o(u)&&"id"in o(u))i(await e.workspaceService.updateManifestItem(i(),o(u).id,D));else if(o(w)==="create-text"){i(await e.workspaceService.addManifestItem(i(),D));const M=D.href.startsWith(i().pathInfo.basePath+"/")?D.href:`${i().pathInfo.basePath}/${D.href}`;await e.workspaceService.writeFile(i().id,M,"")}y(m,!1),await b()}catch{y(v,n()("Failed to save item"),!0)}},N=async F=>{if(!i())return;const D=F.detail.files,M=[],le=[];for(const J of D)try{const ge=J.type,X=wo.detectMediaType(J.name),we=!ge||ge==="application/octet-stream",he=X.startsWith("font/"),se=we||he||(X==="application/javascript"||X==="text/javascript")?X:ge,Q={href:Ka(J.name,se),mediaType:se};i(await e.workspaceService.addManifestItem(i(),Q));const ve=`${i().pathInfo.basePath}/${Q.href}`;if(J.type.startsWith("text/")||J.type.includes("json")||J.type.includes("xml")){const Z=await J.text();await e.workspaceService.writeFile(i().id,ve,Z)}else{const Z=await J.arrayBuffer();await e.workspaceService.writeBinaryFile(i().id,ve,Z)}M.push(J.name)}catch(ge){console.warn(`Failed to upload ${J.name}:`,ge),le.push({name:J.name,error:ge instanceof Error?ge.message:"Unknown error"})}await b(),le.length===0?console.log(`Successfully uploaded ${M.length} files:`,M):M.length===0?(y(v,n()("Failed to upload all files"),!0),console.error("Upload failures:",le)):(console.log(`Uploaded ${M.length} files successfully:`,M),console.warn(`Failed to upload ${le.length} files:`,le),y(v,n()("Some files failed to upload - see console for details"),!0))},z=()=>{y(m,!1)};an(b),xt(()=>{i()&&b()}),xt(()=>{i()&&(s()?e.workspaceService.listSourceFiles(i()).then(F=>{y(d,F,!0)}).catch(F=>{console.warn("Failed to load SOURCE items:",F),y(d,[],!0)}):y(d,[],!0))}),xt(()=>{i()&&b()});var H=xv(),W=Ze(H);{var O=F=>{var D=yv(),M=f(D),le=f(M);R(J=>x(le,J),[()=>n()("Loading manifestâ¦")]),_(F,D)},T=(F,D)=>{{var M=J=>{var ge=bv(),X=f(ge),we=f(X),he=g(X,2);he.__click=b;var Ce=f(he);R(se=>{x(we,o(v)),x(Ce,se)},[()=>n()("Retry")]),_(J,ge)},le=J=>{lv(J,{get manifestItems(){return o(l)},get sourceItems(){return o(d)},get advancedMode(){return s()},get validationErrors(){return o(p)},get selectedItem(){return o(u)},get selectedItemType(){return o(c)},$$events:{itemSelect:k,itemCreate:I,itemEdit:C,itemDelete:L,fileUpload:N}})};j(F,J=>{o(v)?J(M):J(le,!1)},D)}};j(W,F=>{o(h)?F(O):F(T,!1)})}var G=g(W,2);{var U=F=>{const D=oe(()=>o(w)==="edit"?o(u):null);wv(F,{get itemEditorMode(){return o(w)},get item(){return o(D)},get validationErrors(){return o(p)},$$events:{save:E,close:z}})};j(G,F=>{o(m)&&F(U)})}_(r,H),et(),a()}_t(["click"]);var Sv=P('<div class="no-selection svelte-xcscli"><p class="svelte-xcscli"> </p> <p class="no-selection-subtitle svelte-xcscli"> </p></div>'),Ev=P('<div class="loading-state svelte-xcscli"><p> </p></div>'),kv=P('<div class="error-state svelte-xcscli"><p class="error-message svelte-xcscli"> </p> <button type="button" class="retry-button svelte-xcscli"> </button></div>'),Tv=P('<button type="button" class="action-button edit-button svelte-xcscli"> </button>'),Cv=P('<button type="button" class="action-button delete-button svelte-xcscli"> </button>'),Iv=P('<div class="preview-error svelte-xcscli"><p> </p></div>'),Fv=P('<div class="text-preview svelte-xcscli"><pre class="text-content svelte-xcscli"> </pre></div>'),Pv=P('<div class="image-preview svelte-xcscli"><img class="preview-image svelte-xcscli"/></div>'),Mv=P('<div class="audio-preview svelte-xcscli"><audio controls class="preview-audio svelte-xcscli"><source/> </audio></div>'),Lv=P('<div class="video-preview svelte-xcscli"><video controls class="preview-video svelte-xcscli"><track kind="captions"/> <source/> </video></div>',2),Dv=P('<div class="binary-preview svelte-xcscli"><p> </p> <p class="binary-info svelte-xcscli"> </p></div>'),Rv=P('<div class="content-header svelte-xcscli"><span class="content-type-icon svelte-xcscli"> </span> <span class="content-type svelte-xcscli"> </span></div> <!>',1),Uv=P('<div class="preview-content svelte-xcscli"><div class="preview-header svelte-xcscli"><div class="preview-actions svelte-xcscli"><!> <button type="button" class="action-button download-button svelte-xcscli"> </button> <!></div></div> <div class="preview-body svelte-xcscli"><!></div></div>'),Av=P('<div class="manifest-preview svelte-xcscli"><!></div>');function Ov(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(pt,"$t",t);let i=B(e,"selectedItem",8,null),s=B(e,"selectedItemType",8,null),l=B(e,"workspace",8,null),d=B(e,"workspaceService",8);const u=Lt();let c=Ne(null),p=Ne(!1),h=Ne(null),v=null;const m=T=>T.startsWith("text/")||T.includes("json")||T.includes("xml")||T.includes("javascript"),w=T=>T.startsWith("image/"),b=T=>T.includes("css")||T.includes("javascript")||T.includes("json")||T.includes("xml")||T.startsWith("text/css")||T.startsWith("text/javascript")||T.startsWith("application/json")||T.startsWith("application/xml")||T.startsWith("application/xhtml+xml"),k=()=>{v&&(URL.revokeObjectURL(v),v=null)};lr(()=>{k()});const I=async()=>{if(!i()||!s()||!d()||!l()){y(c,null),k();return}try{if(y(p,!0),y(h,null),k(),s()==="manifest"){const T=i(),G=T.href.startsWith(l().pathInfo.basePath+"/")?T.href:`${l().pathInfo.basePath}/${T.href}`;try{let U;try{U=await d().readFile(l().id,G)}catch{U=await d().readFile(l().id,T.href)}const F=m(T.mediaType),D=w(T.mediaType);let M,le,J;if(F)M=new TextDecoder("utf-8").decode(U),J="text";else if(D){const ge=new Blob([U],{type:T.mediaType});le=URL.createObjectURL(ge),v=le,J="image"}else J="binary";y(c,{itemId:T.id,mediaType:T.mediaType,contentType:J,textContent:M,previewUrl:le,metadata:{characterCount:M?M.length:void 0,lineCount:M?M.split(`
`).length:void 0,wordCount:M?M.split(/\s+/).filter(ge=>ge.length>0).length:void 0}})}catch{y(c,{itemId:T.id,mediaType:T.mediaType,contentType:"binary",error:"Failed to load content"})}}else if(s()==="source"){const T=i();try{const G=await d().readFile(l().id,T.path),U=m(T.mediaType||"text/plain");let F;U&&(F=new TextDecoder("utf-8").decode(G)),y(c,{itemId:T.path,mediaType:T.mediaType||"text/plain",contentType:U?"text":"binary",textContent:F,metadata:{characterCount:F?F.length:void 0,lineCount:F?F.split(`
`).length:void 0,wordCount:F?F.split(/\s+/).filter(D=>D.length>0).length:void 0}})}catch{y(c,{itemId:T.path,mediaType:T.mediaType||"text/plain",contentType:"text",error:"Failed to load SOURCE file content"})}}else if(s()==="opf"){const T=i();try{const G=await d().readFile(l().id,l().pathInfo.rootfilePath),F=new TextDecoder("utf-8").decode(G);y(c,{itemId:T.name,mediaType:"application/xml",contentType:"text",textContent:F,metadata:{characterCount:F.length,lineCount:F.split(`
`).length,wordCount:F.split(/\s+/).filter(D=>D.length>0).length}})}catch{y(c,{itemId:T.name,mediaType:"application/xml",contentType:"text",error:"Failed to load content.opf file"})}}}catch{y(h,n()("Failed to load content preview")),y(c,null)}finally{y(p,!1)}},C=()=>{i()&&s()==="manifest"&&u("itemEdit",{item:i()})},L=()=>{i()&&s()==="manifest"&&u("itemDelete",{itemId:i().id})},E=async()=>{if(!(!i()||!d()||!l()))try{let T,G,U;if(s()==="manifest"){const le=i(),J=le.href.startsWith(l().pathInfo.basePath+"/")?le.href:`${l().pathInfo.basePath}/${le.href}`;try{T=await d().readFile(l().id,J)}catch{T=await d().readFile(l().id,le.href)}G=le.href.split("/").pop()||le.id,U=le.mediaType}else if(s()==="source"){const le=i();T=await d().readFile(l().id,le.path),G=le.name||le.path.split("/").pop()||"source-file",U=le.mediaType||"application/octet-stream"}else if(s()==="opf"){const le=i();T=await d().readFile(l().id,l().pathInfo.rootfilePath),G="content.opf",U="application/xml"}else return;const F=new Blob([T],{type:U}),D=URL.createObjectURL(F),M=document.createElement("a");M.href=D,M.download=G,M.style.display="none",document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(D)}catch(T){console.error("Download failed:",T)}},N=T=>{switch(T){case"text":return"ð";case"image":return"ð¼ï¸";case"audio":return"ðµ";case"video":return"ð¥";default:return"ð¦"}};ft(()=>(rt(i()),rt(s()),rt(d()),rt(l())),()=>{i()&&s()&&d()&&l()&&I()}),Mt(),gt();var z=Av(),H=f(z);{var W=T=>{var G=Sv(),U=f(G),F=f(U),D=g(U,2),M=f(D);R((le,J)=>{x(F,le),x(M,J)},[()=>n()("Select an item to preview its content"),()=>n()("Click on any row in the table to see details")],de),_(T,G)},O=(T,G)=>{{var U=D=>{var M=Ev(),le=f(M),J=f(le);R(ge=>x(J,ge),[()=>n()("Loading previewâ¦")],de),_(D,M)},F=(D,M)=>{{var le=ge=>{var X=kv(),we=f(X),he=f(we),Ce=g(we,2),se=f(Ce);R(Q=>{x(he,o(h)),x(se,Q)},[()=>n()("Retry")],de),Ke("click",Ce,I),_(ge,X)},J=ge=>{var X=Uv(),we=f(X),he=f(we),Ce=f(he);{var se=ne=>{var be=Tv(),me=f(be);R(_e=>x(me,_e),[()=>n()("Edit")],de),Ke("click",be,C),_(ne,be)};j(Ce,ne=>{s()==="manifest"&&ne(se)})}var Q=g(Ce,2),ve=f(Q),Z=g(Q,2);{var ue=ne=>{var be=Cv(),me=f(be);R(_e=>x(me,_e),[()=>n()("Delete")],de),Ke("click",be,L),_(ne,be)};j(Z,ne=>{s()==="manifest"&&ne(ue)})}var Fe=g(we,2),je=f(Fe);{var Ge=ne=>{var be=Rv(),me=Ze(be),_e=f(me),Pe=f(_e),$e=g(_e,2),He=f($e),Je=g(me,2);{var at=ke=>{var Ee=Iv(),ze=f(Ee),$=f(ze);R(V=>x($,`${V??""}: ${o(c).error??""}`),[()=>n()("Preview Error")],de),_(ke,Ee)},ce=(ke,Ee)=>{{var ze=V=>{var Y=Fv(),te=f(Y),Te=f(te);R(q=>{pe(te,"dir",q),x(Te,o(c).textContent),te.dir=te.dir},[()=>b(o(c).mediaType)?"ltr":void 0],de),_(V,Y)},$=(V,Y)=>{{var te=q=>{var fe=Pv(),ae=f(fe);R(()=>{pe(ae,"src",o(c).previewUrl),pe(ae,"alt",s()==="manifest"?i().id:i().name)}),_(q,fe)},Te=(q,fe)=>{{var ae=Ie=>{var Ae=Mv(),Le=f(Ae),We=f(Le),ye=g(We);R(Oe=>{pe(We,"src",o(c).previewUrl),pe(We,"type",o(c).mediaType),x(ye,` ${Oe??""}`)},[()=>n()("Your browser does not support the audio element.")],de),_(Ie,Ae)},xe=(Ie,Ae)=>{{var Le=ye=>{var Oe=Lv(),Be=f(Oe),Me=g(f(Be),2),S=g(Me);R(K=>{pe(Me,"src",o(c).previewUrl),pe(Me,"type",o(c).mediaType),x(S,` ${K??""}`)},[()=>n()("Your browser does not support the video element.")],de),_(ye,Oe)},We=ye=>{var Oe=Dv(),Be=f(Oe),Me=f(Be),S=g(Be,2),K=f(S);R((re,Se)=>{x(Me,re),x(K,Se)},[()=>n()("Binary file - preview not available"),()=>n()("Use the download button to access the file")],de),_(ye,Oe)};j(Ie,ye=>{o(c).contentType==="video"&&o(c).previewUrl?ye(Le):ye(We,!1)},Ae)}};j(q,Ie=>{o(c).contentType==="audio"&&o(c).previewUrl?Ie(ae):Ie(xe,!1)},fe)}};j(V,q=>{o(c).contentType==="image"&&o(c).previewUrl?q(te):q(Te,!1)},Y)}};j(ke,V=>{o(c).contentType==="text"&&o(c).textContent?V(ze):V($,!1)},Ee)}};j(Je,ke=>{o(c).error?ke(at):ke(ce,!1)})}R(ke=>{x(Pe,ke),x(He,o(c).mediaType)},[()=>N(o(c).contentType)],de),_(ne,be)};j(je,ne=>{o(c)&&ne(Ge)})}R(ne=>x(ve,ne),[()=>n()("Download")],de),Ke("click",Q,E),_(ge,X)};j(D,ge=>{o(h)?ge(le):ge(J,!1)},M)}};j(T,D=>{o(p)?D(U):D(F,!1)},G)}};j(H,T=>{i()?T(O,!1):T(W)})}_(r,z),et(),a()}var zv=P(`<div class="outline-editor"><textarea class="outline-editor__textarea" aria-label="Navigation content editor" aria-describedby="editor-help" spellcheck="false" aria-multiline="true"></textarea> <div id="editor-help" class="sr-only">Enter navigation content in plain text. Leave empty to auto-generate from chapter titles. Press
    Ctrl+Enter (Cmd+Enter on Mac) to save navigation content.</div></div>`);function Wv(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(s(),"$editorStore",t),i=Ne();let s=B(e,"editorStore",8),l=B(e,"placeholder",8,"Navigation content will be auto-generated from your chapters...");const d=Lt();let u;function c(v){const m=v.target;clearTimeout(u),u=setTimeout(()=>{s().updateContent(m.value),d("contentChanged",{editorId:"outline-nav",timestamp:Date.now(),isEmpty:m.value.trim()===""})},300)}lr(()=>{clearTimeout(u)}),ft(()=>n(),()=>{y(i,n().content)}),Mt(),gt();var p=zv(),h=f(p);R(()=>{En(h,o(i)),pe(h,"placeholder",l())}),Ke("input",h,c),_(r,p),et(),a()}class mr{static async generateFromSpine(e,t,a,n){n||(n={rootfilePath:"OEBPS/content.opf",basePath:"OEBPS",opfFileName:"content.opf"});const i={includeUntitled:!0,titleStrategy:"heading",documentTitle:"Table of Contents",cssClasses:{}},s=[];let l=1;for(const c of e)if(c.href)try{const p=`${n.basePath}/${c.href}`,h=await t.readFile(a,p),v=new TextDecoder().decode(h),m=this.extractTitleFromXHTML(v,c.href,l,"heading");if(m||i.includeUntitled){const w={href:c.href,title:m||`Chapter ${l}`};s.push(w)}l++}catch(p){if(p instanceof Error&&p.message.includes("Workspace not found"))throw p;continue}return{xhtmlContent:this.generateNavigationXHTML(s,i.documentTitle,i.cssClasses),metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}static async processUserContent(e,t,a,n){const i={validationLevel:"strict",errorHandling:"throw",documentTitle:"Navigation",...n};try{let l=(await t.transformText(e,a,"nav")).transformedText||"";return(!l||!l.includes('<?xml version="1.0" encoding="UTF-8"?>'))&&(l=this.generateNavigationXHTML([],i.documentTitle)),{xhtmlContent:l,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}catch(s){if(i.errorHandling==="throw")throw s;return{xhtmlContent:this.generateNavigationXHTML([],i.documentTitle),metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}}static extractTitleFromXHTML(e,t,a,n){const s=new DOMParser().parseFromString(e,"application/xml");if(s.querySelector("parsererror"))throw new Error("Malformed XHTML");if(!s.querySelector("html"))throw new Error("Invalid XHTML structure");const u=s.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const h of u){const v=h.textContent?.trim();if(v)return v}const p=s.querySelector("title")?.textContent?.trim();return p||this.getFallbackTitle(t,a,n)}static getFallbackTitle(e,t,a){return a==="filename"?(e.split("/").pop()||"").replace(/\.[^/.]+$/,"")||null:a==="fallback"?`Chapter ${t}`:null}static generateNavigationXHTML(e,t="Table of Contents",a={}){const n=e.map(l=>`      <li><a href="${l.href}">${this.escapeXML(l.title)}</a></li>`).join(`
`),i=a.nav?` class="${a.nav}"`:"",s=a.list?` class="${a.list}"`:"";return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeXML(t)}</title>
  <meta charset="UTF-8"/>
</head>
<body>
  <nav epub:type="toc" role="navigation"${i}>
    <h1>${this.escapeXML(t)}</h1>
    <ol${s}>
${n}
    </ol>
  </nav>
</body>
</html>`}static escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}}var Nv=P('<div class="outline-view svelte-vjoxn9" role="group" aria-label="Navigation editor"><div aria-live="polite" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <div aria-live="assertive" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <!></div>');function jv(r,e){Qe(e,!1);const[t,a]=ot(),n=()=>Ye(p,"$outlineStore",t);let i=B(e,"workspace",12),s=B(e,"workspaceService",8),l=B(e,"spineService",8),d=B(e,"transformPipeline",8,void 0);const u=Lt(),c=`outline-nav-${Date.now()}-${Math.random().toString(36).substring(2,8)}`,p=go(c);let h=!1,v=null;async function m(D){try{D?await w():await b()}catch(M){u("error",{message:M instanceof Error?M.message:"Unknown error occurred",stage:D?"generation":"transform"})}}async function w(){try{const D=await l().loadSpineItems(i()),M=await mr.generateFromSpine(D,s(),i().id,i().pathInfo);u("previewUpdate",{xhtml:M.xhtmlContent})}catch(D){console.error("Failed to generate navigation from spine:",D),u("error",{message:D instanceof Error?D.message:"Failed to generate navigation",stage:"generation"})}}async function b(){const D=p.getContent();if(!d()){console.warn("TransformPipeline not available - falling back to auto-generation"),await w();return}try{const M=await mr.processUserContent(D,d(),i().id);u("previewUpdate",{xhtml:M.xhtmlContent,warnings:[]})}catch(M){console.error("Failed to process user content:",M),u("error",{message:M instanceof Error?M.message:"Failed to process navigation content",stage:"transform"})}}async function k(){await W();try{const D="SOURCE/text/nav.txt";if(await s().fileExists(i().id,D)){const le=await s().readFile(i().id,D),J=new TextDecoder().decode(le);p.updateContent(J)}else p.updateContent("")}catch(D){console.error("Failed to load navigation content:",D),u("error",{message:D instanceof Error?D.message:"Failed to load navigation content",stage:"generation"})}}async function I(){await W();try{const D=p.getContent();await s().writeFile(i().id,"SOURCE/text/nav.txt",D);let le;if(D.trim()===""){const X=await l().loadSpineItems(i());le=await mr.generateFromSpine(X,s(),i().id,i().pathInfo)}else if(d())le=await mr.processUserContent(D,d(),i().id);else{console.warn("TransformPipeline not available - using auto-generation instead of user content");const X=await l().loadSpineItems(i());le=await mr.generateFromSpine(X,s(),i().id,i().pathInfo)}await s().writeFile(i().id,"OEBPS/nav.xhtml",le.xhtmlContent);const ge=i().opf.manifest.find(X=>X.id==="nav"||X.properties?.includes("nav"));ge?ge.href!=="nav.xhtml"&&i(await s().updateManifestItem(i(),ge.id,{href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]})):i(await s().addManifestItem(i(),{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]}))}catch(D){console.error("Failed to save navigation content:",D),u("error",{message:D instanceof Error?D.message:"Failed to save navigation content",stage:"save"})}}function C(D){}let L=Ne(),E=Ne();async function N(D){if(D.key==="Enter"&&(D.ctrlKey||D.metaKey)){D.preventDefault();try{await I(),o(L)&&(Xe(L,o(L).textContent="Navigation saved successfully"),setTimeout(()=>{Xe(L,o(L).textContent="")},3e3))}catch(M){o(E)&&(Xe(E,o(E).textContent=`Save failed: ${M instanceof Error?M.message:"Unknown error"}`),setTimeout(()=>{Xe(E,o(E).textContent="")},5e3))}}}an(async()=>{v||(v=z()),await v}),lr(()=>{h=!1,v=null,p.destroy(),u("destroyed",{timestamp:Date.now()})});async function z(){try{h=!0,u("ready",{timestamp:Date.now()}),await k(),await I()}catch(D){console.error("Failed to initialize OutlineView:",D),u("error",{message:D instanceof Error?D.message:"Failed to initialize component",stage:"generation"})}}function H(){return h}async function W(){if(!h){if(v){await v;return}throw new Error("Component not mounted")}}ft(()=>n(),()=>{n().lastUpdated&&m(n().isEmpty)}),Mt(),gt();var O=Nv(),T=f(O);Nt(T,D=>y(L,D),()=>o(L));var G=g(T,2);Nt(G,D=>y(E,D),()=>o(E));var U=g(G,2);Wv(U,{get editorStore(){return p},placeholder:"Navigation content will be auto-generated from your chapters...",$$events:{contentChanged:C}}),Ke("keydown",O,N),_(r,O),Pt(e,"loadNavigationContent",k),Pt(e,"saveNavigationContent",I),Pt(e,"isReady",H),Pt(e,"waitForReady",W);var F=et({loadNavigationContent:k,saveNavigationContent:I,isReady:H,waitForReady:W});return a(),F}var Bv=P('<div><div class="content-preview__container svelte-166aukc"><div class="content-preview__letterbox svelte-166aukc"><iframe class="content-preview__iframe svelte-166aukc" title="Content Preview"></iframe></div></div></div>');function $v(r,e){Qe(e,!1);let t=B(e,"content",8),a=B(e,"deviceSize",8,"responsive"),n=B(e,"orientation",8,"portrait"),i=B(e,"fontSizeAdjustment",8,0),s=B(e,"fontFamily",8,"default"),l=B(e,"class",8,"");const d={"old-iphone":{width:375,height:667,fontSize:16,margin:12,lineHeight:1.4},"recent-iphone":{width:390,height:844,fontSize:17,margin:14,lineHeight:1.4},"large-iphone":{width:430,height:932,fontSize:18,margin:16,lineHeight:1.4},"small-tablet":{width:744,height:1133,fontSize:20,margin:20,lineHeight:1.5},"medium-tablet":{width:820,height:1180,fontSize:22,margin:24,lineHeight:1.5},"large-tablet":{width:1024,height:1366,fontSize:24,margin:28,lineHeight:1.5}};let u=Ne(),c=Ne(),p=Ne();function h(N,z){if(N==="responsive")return null;const H=d[N];return z==="landscape"?{width:H.height,height:H.width}:{width:H.width,height:H.height}}function v(N,z){if(N==="responsive")return"";const H=d[N];return`body {
      font-size: ${H.fontSize+z}px;
      margin: ${H.margin}px;
      line-height: ${H.lineHeight};
    }`}function m(N,z,H,W){if(!N)return;const O=N.contentDocument;if(!O)return;const T=O.head.querySelector(".device-injected-styles");T&&T.remove();let G="";if(G+=v(z,W),G){const U=O.createElement("style");U.className="device-injected-styles",U.textContent=G;const F=O.head.querySelector('style, link[rel="stylesheet"]');F?O.head.insertBefore(U,F):O.head.appendChild(U)}}function w(N,z){const H=N.width/z.width,W=N.height/z.height;return Math.min(H,W)}function b(){if(!o(u)||!o(c)||!o(p))return;const N=h(a(),n());if(!N){Xe(c,o(c).style.transform=""),Xe(c,o(c).style.width="100%"),Xe(c,o(c).style.height="100%"),Xe(p,o(p).style.width="100%"),Xe(p,o(p).style.height="100%");return}const z=o(u).getBoundingClientRect(),H=w(z,N);Xe(p,o(p).style.width=`${N.width}px`),Xe(p,o(p).style.height=`${N.height}px`),Xe(c,o(c).style.transform=`scale(${H})`),Xe(c,o(c).style.transformOrigin="center"),Xe(c,o(c).style.width=`${N.width}px`),Xe(c,o(c).style.height=`${N.height}px`)}function k(){o(p)&&m(o(p),a(),s(),i())}an(()=>{b();let N=null;return typeof ResizeObserver<"u"&&(N=new ResizeObserver(()=>{b()})),o(u)&&N&&N.observe(o(u)),()=>{N&&N.disconnect()}}),ft(()=>(o(p),rt(t())),()=>{o(p)&&t()&&Xe(p,o(p).srcdoc=t())}),ft(()=>(o(u),o(c),o(p)),()=>{o(u)&&o(c)&&o(p)&&b()}),ft(()=>(o(p),rt(a()),rt(s()),rt(i())),()=>{o(p)&&m(o(p),a(),s(),i())}),Mt(),gt();var I=Bv(),C=f(I),L=f(C),E=f(L);Nt(E,N=>y(p,N),()=>o(p)),Nt(C,N=>y(c,N),()=>o(c)),Nt(I,N=>y(u,N),()=>o(u)),R(()=>{st(I,1,`content-preview ${l()??""}`,"svelte-166aukc"),pe(E,"srcdoc",t())}),Ke("load",E,k),_(r,I),et()}var Hv=P('<span class="separator svelte-eqvpc4">â¢</span> <span class="workspace-author svelte-eqvpc4"> </span>',1),qv=P('<span class="separator svelte-eqvpc4">â¢</span> <span class="workspace-extensions svelte-eqvpc4"><!></span>',1),Vv=P('<div class="workspace-header svelte-eqvpc4"><h2 class="workspace-title svelte-eqvpc4"> </h2> <!> <!></div>');function Gv(r,e){Qe(e,!0);let t=Ue(Ct([])),a=Ue(!1);xt(()=>{e.workspace?.id&&e.extensionManager&&(y(a,!0),e.extensionManager.listWorkspaceExtensions(e.workspace.id).then(v=>{y(t,v,!0),y(a,!1)}).catch(()=>{y(t,[],!0),y(a,!1)}))});let n=oe(()=>e.workspace?.opf?.metadata?.title||"Untitled"),i=oe(()=>{const v=e.workspace?.opf?.metadata?.creator;return v&&v.length>0?v.join(", "):null});var s=Vv(),l=f(s),d=f(l),u=g(l,2);{var c=v=>{var m=Hv(),w=g(Ze(m),2),b=f(w);R(()=>{pe(w,"title",o(i)),x(b,o(i))}),_(v,m)};j(u,v=>{o(i)&&v(c)})}var p=g(u,2);{var h=v=>{var m=qv(),w=g(Ze(m),2),b=f(w);{var k=C=>{var L=Et("Loading extensions...");_(C,L)},I=C=>{var L=Et();R(E=>x(L,E),[()=>o(t).map(E=>E.name).join(", ")]),_(C,L)};j(b,C=>{o(a)?C(k):C(I,!1)})}_(v,m)};j(p,v=>{(o(t).length>0||o(a))&&v(h)})}R(()=>{pe(l,"title",o(n)),x(d,o(n))}),_(r,s),et()}class Yt extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="WorkspaceServiceError"}}class Xv extends Yt{constructor(e){super(`Workspace not found: ${e}. Please check workspace ID.`,"WORKSPACE_NOT_FOUND",e),this.name="WorkspaceNotFoundError"}}class Kv extends Yt{constructor(e,t){super(`OPF file corrupted in workspace ${e}: ${t}. Try reimporting the EPUB.`,"OPF_CORRUPTED",e),this.name="OPFCorruptedError"}}class tn extends Yt{constructor(e,t){super(e,"VALIDATION_ERROR"),this.context=t,this.name="ValidationError",this.context=t}}class yo{constructor(e){this.fileStorage=e,this.extensionManager=new ki(e)}extensionManager;async createWorkspace(e){const t=this.generateWorkspaceId(),a={...e,modifiedDate:pn()};await this.fileStorage.createWorkspace(t);const n={version:"3.0",metadata:{...a,epubVersion:"3.0"},manifest:[],spine:[],guide:[]};return await this.createEPUBStructure(t,n),{id:t,opf:n,pathInfo:{rootfilePath:"OEBPS/content.opf",basePath:"OEBPS",opfFileName:"content.opf"}}}async populateWithContent(e,t){for(const s of t.assets)await this.fileStorage.writeTextFile(e,s.path,s.content);for(const s of t.chapters)await this.fileStorage.writeTextFile(e,`SOURCE/text/${s.fileName}`,s.content),await this.fileStorage.writeTextFile(e,`OEBPS/Text/${s.id}.xhtml`,s.xhtmlContent);const a=await this.loadWorkspace(e),n={...a.opf,manifest:[...a.opf.manifest,...t.manifestUpdates],spine:[...a.opf.spine,...t.spineUpdates]},i=wt.generateOPFXML(n);return await this.fileStorage.writeTextFile(e,a.pathInfo.rootfilePath,i),{...a,opf:n}}async loadWorkspace(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Xv(e);const a=await this.getWorkspacePathInfo(e),n=await this.fileStorage.readTextFile(e,a.rootfilePath);let i;try{i=wt.parseOPFDocument(n)}catch(s){throw new Kv(e,s instanceof Error?s.message:"Unknown parsing error")}return{id:e,opf:i,pathInfo:a}}catch(t){throw t instanceof Yt?t:new Yt(`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e)}}async saveWorkspace(e){const t={...e},a=wt.generateOPFXML(t.opf);return await this.fileStorage.writeTextFile(e.id,e.pathInfo.rootfilePath,a),t}async deleteWorkspace(e){try{await this.fileStorage.deleteWorkspace(e)}catch(t){if(t instanceof Error&&!t.message.includes("not found"))throw new Yt(`Failed to delete workspace: ${t.message}`,"DELETE_ERROR",e)}}async updateMetadata(e,t){this.validateMetadataUpdates(t);const a={...e,opf:{...e.opf,metadata:{...e.opf.metadata,...t}}};return await this.saveWorkspace(a)}async addManifestItem(e,t){if(!t.href)throw new tn("Manifest item must have href");const a=t.id||this.generateManifestId(t.href,new Set(e.opf.manifest.map(s=>s.id)));if(e.opf.manifest.some(s=>s.id===a))throw new tn(`Manifest item with ID '${a}' already exists`);const n={id:a,href:t.href,mediaType:t.mediaType||this.detectMediaType(t.href),properties:t.properties,fallback:t.fallback};let i={...e,opf:{...e.opf,manifest:[...e.opf.manifest,n],metadata:{...e.opf.metadata,modifiedDate:pn()}}};return(n.mediaType==="text/javascript"||n.mediaType==="application/javascript")&&(i=this.addScriptedPropertiesToChapters(i)),await this.saveWorkspace(i)}async removeManifestItem(e,t){const a=e.opf.manifest.findIndex(l=>l.id===t);if(a===-1)throw new tn(`Manifest item with ID '${t}' not found`);const n=e.opf.manifest[a],i=n.mediaType==="text/javascript"||n.mediaType==="application/javascript";try{const l=this.resolveManifestPath(n.href,e.pathInfo.basePath);await this.fileStorage.deleteFile(e.id,l)}catch(l){console.warn(`Failed to delete file for manifest item ${t}:`,l)}let s={...e,opf:{...e.opf,manifest:e.opf.manifest.filter(l=>l.id!==t),spine:e.opf.spine.filter(l=>l.idref!==t),metadata:{...e.opf.metadata,modifiedDate:pn()}}};return i&&(s=this.addScriptedPropertiesToChapters(s)),await this.saveWorkspace(s)}async updateManifestItem(e,t,a){const n=e.opf.manifest.findIndex(p=>p.id===t);if(n===-1)throw new tn(`Manifest item with ID '${t}' not found`);const i=e.opf.manifest[n];if(a.href&&a.href!==i.href){const p=this.resolveManifestPath(i.href,e.pathInfo.basePath),h=this.resolveManifestPath(a.href,e.pathInfo.basePath);if(await this.fileStorage.fileExists(e.id,p))try{await this.fileStorage.renameFile(e.id,p,h)}catch(v){throw new Yt(`Failed to move file from ${i.href} to ${a.href}: ${v instanceof Error?v.message:"Unknown error"}`,"FILE_MOVE_ERROR",e.id)}}const s=i.mediaType==="text/javascript"||i.mediaType==="application/javascript",l=a.mediaType==="text/javascript"||a.mediaType==="application/javascript",d=[...e.opf.manifest];d[n]={...d[n],...a};let u=e.opf.spine;if(a.id&&a.id!==t){if(e.opf.manifest.some((p,h)=>h!==n&&p.id===a.id))throw new tn(`Manifest item with ID '${a.id}' already exists`);u=e.opf.spine.map(p=>p.idref===t?{...p,idref:a.id}:p)}let c={...e,opf:{...e.opf,manifest:d,spine:u,metadata:{...e.opf.metadata,modifiedDate:pn()}}};return s!==l&&(c=this.addScriptedPropertiesToChapters(c)),await this.saveWorkspace(c)}async updateSpineOrder(e,t){const a=new Set(e.opf.manifest.map(l=>l.id)),n=t.filter(l=>!a.has(l));if(n.length>0)throw new tn(`Spine items reference missing manifest items: ${n.join(", ")}`);const i=t.map(l=>({idref:l})),s={...e,opf:{...e.opf,spine:i,metadata:{...e.opf.metadata,modifiedDate:pn()}}};return await this.saveWorkspace(s)}async addSpineItem(e,t,a){if(!e.opf.manifest.some(l=>l.id===t.idref))throw new tn(`Referenced manifest item not found: ${t.idref}`);if(e.opf.spine.some(l=>l.idref===t.idref))throw new tn(`Spine item with idref '${t.idref}' already exists`);const n=[...e.opf.spine],i=a??n.length;n.splice(i,0,t);const s={...e,opf:{...e.opf,spine:n,metadata:{...e.opf.metadata,modifiedDate:pn()}}};return await this.saveWorkspace(s)}async removeSpineItem(e,t){if(e.opf.spine.findIndex(i=>i.idref===t)===-1)throw new tn(`Spine item with idref '${t}' not found`);const n={...e,opf:{...e.opf,spine:e.opf.spine.filter(i=>i.idref!==t),metadata:{...e.opf.metadata,modifiedDate:pn()}}};return await this.saveWorkspace(n)}async listWorkspaces(){const e=await this.fileStorage.listWorkspaces(),t=[];for(const a of e)try{const n=await this.loadWorkspace(a),i=await this.fileStorage.listFiles(a),s=0;let l;try{l=(await this.fileStorage.getFileInfo(a,n.pathInfo.rootfilePath)).lastModified}catch{l=n.opf.metadata.modifiedDate?new Date(n.opf.metadata.modifiedDate):new Date}let d;try{const u=await this.extensionManager.listWorkspaceExtensions(a);u.length>0&&(d=u.map(c=>c.name))}catch{}t.push({id:a,title:n.opf.metadata.title,language:n.opf.metadata.language,lastModified:l,fileCount:i.length,totalSize:s,author:n.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0",extensionIds:d})}catch{continue}return t}async workspaceExists(e){try{return(await this.fileStorage.listWorkspaces()).includes(e)}catch{return!1}}async loadChapterContents(e,t){const a=[];for(const n of t){const i=e.opf.manifest.find(l=>l.id===n),s=e.opf.spine.find(l=>l.idref===n);if(!(!i||!s))try{const l=this.resolveManifestPath(i.href,e.pathInfo.basePath),d=await this.fileStorage.readTextFile(e.id,l);a.push({id:n,href:i.href,xhtmlContent:d,linear:s.linear??!0,mediaType:i.mediaType||"application/xhtml+xml"})}catch{continue}}return a}async loadAllLinearChapterContents(e){const t=e.opf.spine.filter(a=>a.linear!==!1).map(a=>a.idref);return this.loadChapterContents(e,t)}generateWorkspaceId(){return"workspace-"+crypto.randomUUID()}async createEPUBStructure(e,t){await this.fileStorage.writeTextFile(e,"mimetype","application/epub+zip");const a=wt.generateContainerXML();await this.fileStorage.writeTextFile(e,"META-INF/container.xml",a);const n=wt.generateOPFXML(t);await this.fileStorage.writeTextFile(e,"OEBPS/content.opf",n)}async getWorkspacePathInfo(e){try{const t=await this.fileStorage.readTextFile(e,"META-INF/container.xml"),a=wt.parseContainerXml(t);if(a.error)throw new Error(a.error);const n=a.rootfilePath,i=n.lastIndexOf("/");if(i===-1)return{rootfilePath:n,basePath:"",opfFileName:n};const s=n.substring(0,i),l=n.substring(i+1);return{rootfilePath:n,basePath:s,opfFileName:l}}catch(t){throw new Yt(`Failed to parse workspace container.xml: ${t instanceof Error?t.message:"Unknown error"}`,"INVALID_CONTAINER_STRUCTURE",e)}}validateMetadataUpdates(e){if(e.title!==void 0&&e.title.trim()==="")throw new tn("Title cannot be empty");if(e.language!==void 0&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language))throw new tn("Invalid language code format")}addScriptedPropertiesToChapters(e){const t=e.opf.manifest.some(n=>n.mediaType==="text/javascript"||n.mediaType==="application/javascript"),a=e.opf.manifest.map(n=>{if(n.mediaType==="application/xhtml+xml"&&n.id!=="nav"&&!n.properties?.includes("nav")){const i=n.properties||[],s=i.includes("scripted");if(t&&!s)return{...n,properties:[...i,"scripted"]};if(!t&&s){const l=i.filter(d=>d!=="scripted");return{...n,properties:l.length>0?l:void 0}}}return n});return{...e,opf:{...e.opf,manifest:a}}}generateManifestId(e,t){const i=(e.split("/").pop()||"item").replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"-").replace(/^[^a-zA-Z]/,"item-").toLowerCase();let s=i,l=1;for(;t.has(s);)s=`${i}-${l++}`;return s}detectMediaType(e){const t=e.split(".").pop()?.toLowerCase()||"";return{xhtml:"application/xhtml+xml",html:"application/xhtml+xml",css:"text/css",js:"application/javascript",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",mp3:"audio/mpeg",mp4:"video/mp4",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2"}[t]||"application/octet-stream"}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}async fileExists(e,t){try{return await this.fileStorage.readFile(e,t),!0}catch{return!1}}async renameFile(e,t,a){await this.fileStorage.renameFile(e,t,a)}async readFile(e,t){try{return await this.fileStorage.readFile(e,t)}catch(a){throw new Yt(`Failed to read file ${t}: ${a instanceof Error?a.message:"Unknown error"}`,"READ_FILE_ERROR",e)}}async writeFile(e,t,a){try{const i=new TextEncoder().encode(a),s=new ArrayBuffer(i.length);new Uint8Array(s).set(i),await this.fileStorage.writeFile(e,t,s)}catch(n){throw new Yt(`Failed to write file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_FILE_ERROR",e)}}async writeBinaryFile(e,t,a){try{await this.fileStorage.writeFile(e,t,a)}catch(n){throw new Yt(`Failed to write binary file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_BINARY_FILE_ERROR",e)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e.id)).filter(i=>Yn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const s=await this.fileStorage.getFileInfo(e.id,i),l={path:i,name:i.split("/").pop()||i,type:"file",size:s.size,modified:s.lastModified,mediaType:this.detectMediaTypeForSource(i)};n.push(l)}catch{continue}return n}catch(t){throw new Yt(`Failed to list SOURCE files: ${t instanceof Error?t.message:"Unknown error"}`,"LIST_SOURCE_FILES_ERROR",e.id)}}detectMediaTypeForSource(e){const t=e.split(".").pop()?.toLowerCase()||"",a=ho(e),n={txt:"text/plain",md:"text/markdown",json:"application/json",js:"application/javascript",ts:"application/typescript",css:"text/css",html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",py:"text/x-python",sh:"application/x-sh"};return n[t]||"text/plain"}async getFileInfo(e,t){return await this.fileStorage.getFileInfo(e,t)}}class ts{static validateSyntax(e){if(!e.trim())return null;try{const t=new Function(e);try{const a={console:{log:()=>{},warn:()=>{},error:()=>{}},window:{},document:{querySelector:()=>null,createElement:()=>({}),addEventListener:()=>{}},setTimeout:()=>0,setInterval:()=>0,clearTimeout:()=>{},clearInterval:()=>{},fetch:()=>Promise.resolve(),Math,JSON,Date,Array,Object,String,Number,Boolean,RegExp};return t.call(a),null}catch(a){return a instanceof ReferenceError?`JavaScript reference error: ${a.message}`:a instanceof TypeError?`JavaScript type error: ${a.message}`:`JavaScript runtime error: ${a instanceof Error?a.message:String(a)}`}}catch(t){return t instanceof SyntaxError?`JavaScript syntax error: ${t.message}`:`JavaScript validation error: ${t instanceof Error?t.message:String(t)}`}}static shouldValidate(e){return e.includes("javascript")||e.includes("js")}}class Wa extends Error{constructor(e,t){super(`Missing translation keys for locale ${e}: ${t.join(", ")}`),this.locale=e,this.missingKeys=t,this.name="TranslationMissingError"}}let gr=class extends Error{constructor(e){super(`Unsupported locale: ${e}`),this.locale=e,this.name="UnsupportedLocaleError"}};class Yv extends Error{constructor(e,t,a){super(`Invalid content for ${e}.${t}: ${a}`),this.locale=e,this.key=t,this.reason=a,this.name="InvalidContentError"}}const Gr=["sample.book.title","sample.book.description","sample.author.name","sample.publisher.name","sample.chapter1.title","sample.chapter1.content"];class Jv{constructor(e){this.catalogs=e}translate(e,t){return this.catalogs[e]?.messages[t]||t}isLocaleSupported(e){return e in this.catalogs}isRTL(e){return["ar","he","fa","ur"].includes(e)}hasTranslation(e,t){const a=this.catalogs[e];if(!a)return!1;const n=a.messages[t];return n!==void 0&&n.trim()!==""}async generateLocalizedContent(e){if(!this.isLocaleSupported(e))throw new gr(e);await this.checkTranslationCompleteness(e);const t={title:this.translate(e,"sample.book.title"),description:this.translate(e,"sample.book.description"),author:this.translate(e,"sample.author.name"),publisher:this.translate(e,"sample.publisher.name")},a=await this.generateLocalizedChapters(e),n=this.isRTL(e);return{locale:e,metadata:t,chapters:a,isRTL:n,pageProgressionDirection:n?"rtl":"ltr"}}async generateLocalizedMetadata(e){if(!this.isLocaleSupported(e))throw new gr(e);const t=["sample.book.title","sample.book.description","sample.author.name","sample.publisher.name"],a=[];for(const c of t)this.hasTranslation(e,c)||a.push(c);if(a.length>0)throw new Wa(e,a);const n=Date.now(),i=performance.now(),s=Math.floor(n+i%1*1e3),l=`sample-content-${e}-${s}`,u=this.isRTL(e)?"rtl":"ltr";return{title:this.translate(e,"sample.book.title"),language:e,identifier:l,creator:[this.translate(e,"sample.author.name")],publisher:this.translate(e,"sample.publisher.name"),description:this.translate(e,"sample.book.description"),pageProgressionDirection:u}}async generateLocalizedChapters(e){if(!this.isLocaleSupported(e))throw new gr(e);const t=["sample.chapter1.title","sample.chapter1.content"],a=[];for(const n of t)this.hasTranslation(e,n)||a.push(n);if(a.length>0)throw new Wa(e,a);return[{id:"chapter1",title:this.translate(e,"sample.chapter1.title"),content:this.translate(e,"sample.chapter1.content"),linear:!0,mediaType:"application/xhtml+xml"}]}async getAvailableLocales(){const e=[],t=Object.keys(this.catalogs);for(const a of t)Gr.every(i=>this.hasTranslation(a,i))&&e.push(a);return e}async validateLocaleCompleteness(e){if(!this.isLocaleSupported(e))throw new gr(e);const t=[],a=[],n=this.catalogs[e];for(const s of Gr)if(!n||!(s in n.messages))t.push(s);else{const l=n.messages[s];(!l||l.trim()==="")&&a.push(s)}return{isValid:t.length===0&&a.length===0,missingKeys:t,emptyKeys:a,locale:e}}async checkTranslationCompleteness(e){const t=this.catalogs[e];if(!t)throw new gr(e);for(const n of Gr)if(n in t.messages){const i=t.messages[n];if(!i||i.trim()==="")throw new Yv(e,n,"Translation is empty")}const a=[];for(const n of Gr)n in t.messages||a.push(n);if(a.length>0)throw new Wa(e,a)}}const Zv=`/* Universal CSS for all locales with EPUB reading system compatibility */

code-sample {
  font-family: monospace;
  font-weight: 700;
  font-size: 0.7rem;
}

.action {
  text-align: center;
  margin: 3em 0 4em;
}

.action a {
  text-decoration: none;
  background-color: #00e;
  color: white;
  padding: 0.6em 1em 0.5em;
  border-radius: 0.5em;
  font-family: sans-serif;
  font-weight: 600;
}

body {
  /* System fonts with enhanced stack for global language support */
  font-family:
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    'Noto Sans',
    'Liberation Sans',
    sans-serif;

  /* Enhanced typography for reading contexts */
  font-size: 1.125rem; /* Slightly larger base for better readability */
  line-height: 1.6;

  /* Progressive enhancement: physical properties first, then logical */
  margin-left: auto;
  margin-right: auto;
  padding: 1em;
  max-width: 65ch;

  /* Modern logical properties with feature query protection */
}

@supports (margin-inline: auto) {
  body {
    margin-left: unset;
    margin-right: unset;
    max-width: unset;
    margin-inline: auto;
    max-inline-size: 65ch;
  }
}

/* Additional language-specific adjustments */
:lang(ja),
:lang(ko),
:lang(zh) {
  line-height: 1.8; /* Better spacing for CJK characters */
}

:lang(ar),
:lang(he) {
  line-height: 1.7; /* Improved RTL script readability */
}

/* Enhanced text flow and hyphenation */
body {
  hyphens: auto;
  -webkit-hyphens: auto;
  -ms-hyphens: auto;
}

/* Headings with progressive enhancement for logical spacing */
h1,
h2,
h3,
h4,
h5,
h6 {
  /* Physical properties first for compatibility */
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  margin-left: 0;
  margin-right: 0;
  font-weight: 600;
  line-height: 1.2;
}

@supports (margin-block-start: 1.5em) {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: unset;
    margin-bottom: unset;
    margin-left: unset;
    margin-right: unset;
    margin-block-start: 1.5em;
    margin-block-end: 0.5em;
    margin-inline: 0;
  }
}

h1 {
  font-size: 2em;
  padding-bottom: 0.25em;
}

h2 {
  font-size: 1.5em;
}

h3 {
  font-size: 1.25em;
}

/* Paragraphs with progressive enhancement */
p {
  /* Physical properties first */
  margin-bottom: 1em;
  text-align: left; /* Will be overridden for RTL */
}

/* RTL-specific physical fallback */
[data-dir='rtl'] p {
  text-align: right;
}

/* Lists with progressive enhancement */
ul,
ol {
  /* Physical properties first */
  margin-top: 1em;
  margin-bottom: 1em;
  padding-left: 2em;
}

li {
  margin-bottom: 0.5em;
}

/* Blockquotes with progressive enhancement */
blockquote {
  /* Physical properties first */
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  margin-left: 2em;
  margin-right: 0;
  padding-left: 1em;
  font-style: italic;
}

/* Code blocks with progressive enhancement */
pre,
code {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
  font-size: 0.875em;
}

pre {
  padding: 1em;
  border-radius: 4px;
  overflow-x: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

code {
  padding-left: 0.25em;
  padding-right: 0.25em;
  border-radius: 2px;
}

/* Images with progressive enhancement */
img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Strong and emphasis with universal styling */
strong {
  font-weight: 600;
}

em {
  font-style: italic;
}
`,ns=`/**
 * Convert simple markdown to well-formed XHTML
 * @param {string} markdown - Markdown text
 * @param {string|undefined} idref - Spine item idref for context-aware transforms
 * @returns {string} Valid XHTML output
 */
function transformText(markdown, idref) {
  // Split content into blocks (separated by double newlines)
  const blocks = markdown.split(/\\n\\s*\\n/).filter(block => block.trim());
  const htmlBlocks = [];

  for (const block of blocks) {
    const trimmedBlock = block.trim();
    if (!trimmedBlock) continue;

    // Check if block is a header
    const headerMatch = trimmedBlock.match(/^(#{1,6})\\s+(.+)$/);
    if (headerMatch) {
      const level = headerMatch[1].length;
      const text = processInlineFormatting(headerMatch[2]);
      htmlBlocks.push(\`<h\${level}>\${text}</h\${level}>\`);
    } else {
      // Process as paragraph content
      let paragraphContent = processInlineFormatting(trimmedBlock);
      // Convert single newlines to <br/> within paragraphs
      paragraphContent = paragraphContent.replace(/\\n/g, '<br />');
      htmlBlocks.push(\`<p>\${paragraphContent}</p>\`);
    }
  }

  return htmlBlocks.join('\\n');
}

/**
 * Process inline formatting (bold, italic) within text
 * @param {string} text - Text to process
 * @returns {string} Text with inline HTML tags
 */
function processInlineFormatting(text) {
  let result = text;

  // Bold and italic (process bold first to handle overlap correctly)
  result = result.replace(/\\*\\*\\*(.*?)\\*\\*\\*/g, '<strong><em>$1</em></strong>');
  result = result.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');
  result = result.replace(/\\*(.*?)\\*/g, '<em>$1</em>');

  return result;
}
`,Qv=`/**
 * Transform DOM by adding IDs to H2 headings for navigation
 * @param {Document} htmlDocument - HTML document to transform
 * @param {string|undefined} idref - Spine item idref for context-aware transforms
 * @returns {Document} Transformed document with H2 IDs
 */
function transformDOM(htmlDocument, idref) {
  try {
    // Find all H2 elements in the document
    const h2Elements = htmlDocument.querySelectorAll('h2');

    h2Elements.forEach((h2, index) => {
      // Skip if already has an ID
      if (h2.getAttribute('id')) {
        return;
      }

      // Generate ID from text content or use fallback
      const text = h2.textContent || '';
      let id = text
        .toLowerCase()
        .replace(/[^a-z0-9\\s-]/g, '') // Remove special characters
        .replace(/\\s+/g, '-') // Replace spaces with hyphens
        .replace(/-+/g, '-') // Collapse multiple hyphens
        .replace(/^-|-$/g, '') // Remove leading/trailing hyphens
        .substring(0, 50); // Limit length

      // Fallback if no usable text
      if (!id) {
        id = \`heading-\${index + 1}\`;
      }

      // Ensure ID is unique in document
      let finalId = id;
      let counter = 1;
      while (htmlDocument.getElementById(finalId)) {
        finalId = \`\${id}-\${counter}\`;
        counter++;
      }

      // Set the ID attribute
      h2.setAttribute('id', finalId);
    });

    return htmlDocument;
  } catch (error) {
    console.error('DOM transform error:', error);
    return htmlDocument;
  }
}
`;class bo extends Error{constructor(e,t){super(e),this.code=t,this.name="ContentServiceError"}}class em extends bo{constructor(e){super(`Unsupported locale: ${e}`,"UNSUPPORTED_LOCALE"),this.name="UnsupportedLocaleError"}}class ca{constructor(e,t){this.transformExecutor=e,this.i18nSystem=t}static SUPPORTED_LOCALES=new Set(["en","es","fr","de","it","pt","nl","sv","da","no","fi","ru","pl","cs","hu","ro","bg","hr","sk","sl","et","lv","lt","el","tr","ar","he","fa","ur","hi","bn","ta","te","ml","kn","gu","pa","or","as","ne","si","my","km","lo","vi","th","id","ms","tl","zh","ja","ko"]);static RTL_LOCALES=new Set(["ar","he","fa","ur"]);async generateSampleContentData(e="en"){try{const t=await this.generateLocalizedContent(e),{chapters:a,isRTL:n}=t,i=[];for(const c of a){const p=await this.transformContent(c.content),h=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="${e}"${n?' dir="rtl"':""}>
<head>
  <title>${c.title}</title>
  <link rel="stylesheet" type="text/css" href="../Styles/page.css"/>
</head>
<body>
  ${p.xhtml}
</body>
</html>`;i.push({id:c.id,title:c.title,fileName:`${c.id}.txt`,content:c.content,xhtmlContent:h})}const s=this.generateNavigationContent(a,e,n),l=[{path:"OEBPS/Styles/page.css",content:Zv},{path:"SOURCE/scripts/transformText.js",content:ns},{path:"SOURCE/scripts/transformDom.js",content:Qv},{path:"SOURCE/settings.json",content:JSON.stringify({version:"1.0.0",text_transform:"transformText.js",dom_transforms:["transformDom.js"]},null,2)},{path:"OEBPS/nav.xhtml",content:s}],d=[{id:"page-css",href:"Styles/page.css",mediaType:"text/css"},{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]},...a.map(c=>({id:c.id,href:`Text/${c.id}.xhtml`,mediaType:"application/xhtml+xml"}))],u=a.map(c=>({idref:c.id}));return{chapters:i,assets:l,manifestUpdates:d,spineUpdates:u}}catch(t){throw new bo(`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,"SAMPLE_CONTENT_ERROR")}}generateNavigationContent(e,t,a){const n=this.i18nSystem.translate("navigation.title")||"Navigation",i=this.i18nSystem.translate("navigation.tableOfContents")||"Table of Contents",s=e.map(l=>{const d=this.i18nSystem.translate(`content.${l.id}`)||l.title;return`      <li><a href="${l.id}.xhtml">${this.escapeHtml(d)}</a></li>`}).join(`
`);return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="${t}"${a?' dir="rtl"':""}>
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" id="toc">
    <h1>${this.escapeHtml(i)}</h1>
    <ol>
${s}
    </ol>
  </nav>
</body>
</html>`}async transformContent(e,t,a){const n=Date.now(),i=[];try{const s={...t,idref:a},l=await this.transformExecutor.executeTextTransform(ns,"transformText.js",e,s,{timeoutMs:5e3}),d=Date.now()-n;return{xhtml:l,warnings:i,transformTime:d}}catch(s){const l=Date.now()-n,d=s instanceof Error?s.message:"Unknown transform error";return{xhtml:`<p>${this.escapeHtml(e)}</p>`,warnings:[d],transformTime:l}}}async previewContent(e,t){const a=await this.transformContent(e,t);return{previewHtml:a.xhtml,warnings:a.warnings}}generateNavigationFromContent(e){const a=e.filter(s=>s.linear).map(s=>{const l=this.extractTitleFromXHTML(s.xhtmlContent)||s.id;return`    <li><a href="${s.href}">${this.escapeHtml(l)}</a></li>`}).join(`
`),n=this.i18nSystem.translate("navigation.tableOfContents");return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(n)}</h1>
    <ol>
${a}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}processUserNavigation(e){const t=this.i18nSystem.translate("navigation.tableOfContents");if(!e.trim())return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(t)}</h1>
    <ol></ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}};const n=this.parseNavigationEntries(e).map(s=>`    <li><a href="${s.href}">${this.escapeHtml(s.title)}</a></li>`).join(`
`);return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="navigation">
    <h1>${this.escapeHtml(t)}</h1>
    <ol>
${n}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}async generateLocalizedContent(e){if(!ca.SUPPORTED_LOCALES.has(e))throw new em(e);const t=ca.RTL_LOCALES.has(e),a=await this.generateLocalizedMetadata(e),n=await this.generateLocalizedChapters(e);return{locale:e,metadata:a,chapters:n,isRTL:t,pageProgressionDirection:t?"rtl":"ltr"}}async generateLocalizedMetadata(e){const t=this.i18nSystem.translate("sample.title"),a=this.i18nSystem.translate("sample.author"),n=this.i18nSystem.translate("sample.description");return{title:t||"Sample Book",language:e,identifier:`urn:uuid:sample-${Date.now()}`,creator:[a||"Sample Author"],description:n||"A sample book for demonstration purposes",modifiedDate:pn()}}async generateLocalizedChapters(e){const t=this.i18nSystem.getCatalogs();return new Jv(t).generateLocalizedChapters(e)}extractTitleFromXHTML(e){try{const a=new DOMParser().parseFromString(e,"text/xml"),n=["h1","h2","h3","h4","h5","h6"];for(const i of n){const s=a.querySelector(i);if(s&&s.textContent?.trim())return s.textContent.trim()}return null}catch{return null}}parseNavigationEntries(e){const t=[],a=e.split(`
`);for(const n of a){const i=n.trim();if(!i||i.startsWith("#"))continue;const s=i.match(/\[([^\]]+)\]\(([^)]+)\)/);if(s){t.push({title:s[1],href:s[2]});continue}const l=i.match(/^(.+?)\s*-\s*(.+)$/);if(l){t.push({title:l[1].trim(),href:l[2].trim()});continue}const d=i.match(/^-\s*(.+)$/);if(d){const u=d[1].trim();t.push({title:u,href:`Text/${u.toLowerCase().replace(/\s+/g,"_")}.xhtml`})}}return t}generateSampleChapterContent(e,t){return`
${`# ${this.i18nSystem.translate(`content.chapter${t}`)||`Chapter ${t}`}`}

This is sample content for demonstration purposes.

## Section 1

Here is some **bold text** and *italic text*.

## Section 2

Here is more sample content with additional paragraphs to demonstrate the transformation process.

This concludes the sample chapter.
    `.trim()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}validateFileContent(e,t){return ts.shouldValidate(t)?ts.validateSyntax(e):null}}class xo{fileStorage;constructor(){this.fileStorage=Ut.getInstance()}async unpackEPUB(e,t){try{this.fileStorage.isInitialized()||await this.fileStorage.init();const a=await e.arrayBuffer(),n=new Dr(a),i=await this.validateEPUBStructure(n);if(!i.isValid)return{success:!1,error:`Invalid EPUB structure: ${i.errors.join(", ")}`};const s=await this.extractToWorkspace(n,t);return{success:s.success,workspaceId:t,extractedFiles:s.extractedFiles,totalSize:s.totalBytes,processedFiles:s.extractedFiles.length,error:s.errors.length>0?s.errors.join("; "):void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}}async validateEPUBStructure(e){const t=[],a=[];let n,i,s;const l=e.entries.map(d=>d.fileName);if(!l.includes("mimetype"))t.push("Missing required mimetype file");else try{const d=e.entries.find(u=>u.fileName==="mimetype");if(d){const c=await(await d.extract()).text();c.trim()!=="application/epub+zip"&&t.push(`Invalid mimetype content: "${c.trim()}" (expected "application/epub+zip")`)}}catch{t.push("Failed to read mimetype file content")}if(!l.includes("META-INF/container.xml"))t.push("Missing required META-INF/container.xml file");else try{const d=e.entries.find(u=>u.fileName==="META-INF/container.xml");if(d){const c=await(await d.extract()).text(),p=wt.validateXML(c);if(!p.isValid)t.push(`Invalid XML in container.xml: ${p.error}`);else{const h=wt.parseContainerXml(c);if(h.error)t.push(h.error);else if(h.rootfilePath){i=h.rootfilePath;const v=i.split("/");v.length>1&&(s=v.slice(0,-1).join("/")),l.includes(i)||t.push(`Rootfile specified in container.xml not found: ${i}`)}}}}catch{t.push("Failed to parse META-INF/container.xml")}e.entries.length===0&&t.push("Empty ZIP file");for(const d of l)d.includes("..")&&t.push(`Invalid file path with directory traversal: ${d}`),d.startsWith("/")&&a.push(`Absolute path found: ${d}`);if(i&&l.includes(i))try{const d=e.entries.find(u=>u.fileName===i);if(d){const c=await(await d.extract()).text(),p=wt.validateXML(c);p.isValid?(n=wt.detectEPUBVersion(c),n||a.push("Could not detect EPUB version from OPF file")):t.push(`Invalid XML in OPF file (${i}): ${p.error}`)}}catch{t.push(`Failed to read or parse OPF file: ${i}`)}return s&&l.filter(u=>u.startsWith(s+"/")).length===0&&a.push(`No files found in package directory: ${s}/`),{isValid:t.length===0,errors:t,warnings:a,detectedVersion:n,rootfilePath:i,packageDirectory:s}}async extractToWorkspace(e,t){const a=[],n=[],i=[];let s=0;try{await this.fileStorage.createWorkspace(t)}catch(u){if(u instanceof Error&&!u.message.includes("already exists"))return i.push(`Failed to create workspace: ${u.message}`),{success:!1,extractedFiles:a,totalBytes:s,skippedFiles:n,errors:i}}const l=new vo(this.fileStorage);let d=null;for(const u of e.entries)try{if(u.fileName.endsWith("/"))continue;if(u.fileName==="SOURCE.zip"||u.fileName.endsWith("/SOURCE.zip")){d=u;continue}const p=await(await u.extract()).arrayBuffer();await this.fileStorage.writeFile(t,u.fileName,p),a.push(u.fileName),s+=p.byteLength}catch(c){const p=c instanceof Error?c.message:"Unknown error";i.push(`Failed to extract ${u.fileName}: ${p}`),n.push(u.fileName)}if(d)try{const u=await d.extract();await l.extractSourceZip(t,u),a.push("SOURCE.zip (extracted to SOURCE/ directory)"),s+=u.size}catch(u){const c=u instanceof Error?u.message:"Unknown error";i.push(`Failed to extract SOURCE.zip: ${c}`),n.push(d.fileName)}return{success:i.length===0,extractedFiles:a,totalBytes:s,skippedFiles:n,errors:i}}async analyzeEPUB(e){try{const t=await e.arrayBuffer(),a=new Dr(t),n=await this.validateEPUBStructure(a),i=a.entries.map(l=>l.fileName).filter(l=>!l.endsWith("/")).sort(),s=a.entries.reduce((l,d)=>l+d.uncompressedSize,0);return{isValid:n.isValid,fileCount:i.length,totalSize:s,validation:n,fileList:i}}catch(t){return{isValid:!1,fileCount:0,totalSize:0,validation:{isValid:!1,errors:[t instanceof Error?t.message:"Failed to analyze EPUB"],warnings:[]},fileList:[]}}}destroy(){this.fileStorage.destroy()}}class Hn extends Error{constructor(e,t){super(e),this.code=t,this.name="EPUBProcessorError"}}class tm{constructor(e){this.fileStorage=e,this.epubUnpacker=new xo,this.epubPackager=new Ei}epubUnpacker;epubPackager;async unpackEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubUnpacker.unpackEPUB(e,t)}catch(a){throw new Hn(`Failed to unpack EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_UNPACK_ERROR")}}async validateEPUBStructure(e){try{const t=new Dr(e);return await this.epubUnpacker.validateEPUBStructure(t)}catch(t){return{isValid:!1,errors:[`Validation failed: ${t instanceof Error?t.message:"Unknown error"}`],warnings:[]}}}async packageEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubPackager.packageEPUB(e,t)}catch(a){throw new Hn(`Failed to package EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_PACKAGE_ERROR")}}parseOPFDocument(e){try{return wt.parseOPFDocument(e)}catch(t){throw new Hn(`Failed to parse OPF document: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_PARSE_ERROR")}}generateOPFXML(e){try{return wt.generateOPFXML(e)}catch(t){throw new Hn(`Failed to generate OPF XML: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_GENERATE_ERROR")}}validateXML(e){return wt.validateXML(e)}parseOPFMetadata(e){try{if(!globalThis.DOMParser)throw new Error("DOMParser not available");const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))throw new Error("Invalid OPF XML");return wt.parseOPFMetadata(a)}catch(t){throw new Hn(`Failed to parse OPF metadata: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_METADATA_PARSE_ERROR")}}parseContainerXML(e){return wt.parseContainerXml(e)}generateContainerXML(e="OEBPS/content.opf"){return wt.generateContainerXML(e)}detectEPUBVersion(e){return wt.detectEPUBVersion(e)}validateManifestSpineConsistency(e,t){return wt.validateManifestSpineConsistency(e,t)}parseRootfilePath(e){try{return wt.parseRootfilePath(e)}catch(t){throw new Hn(`Failed to parse rootfile path: ${t instanceof Error?t.message:"Unknown error"}`,"ROOTFILE_PARSE_ERROR")}}}const wn={WORKSPACE_ID:"editme_app_workspace_id",SPINE_ITEM_ID:"editme_app_spine_item_id"};class nm{constructor(e,t,a,n,i,s,l,d=!1){this.skipReactiveEffects=d,this.fileStorage=e,this.transformEngine=l,this.extensionManager=n,this.settingsService=new Zn(e,n,i,s),this.epubProcessor=new tm(e),this.workspaceService=new yo(e),this.contentService=new ca(t,a),this.loadGlobalSettings(),d||this.setupReactiveEffects()}fileStorage;transformEngine;extensionManager;workspaceService;contentService;settingsService;epubProcessor;#e=Ue(null);get workspace(){return o(this.#e)}set workspace(e){y(this.#e,e,!0)}#t=Ue(null);get selectedChapterId(){return o(this.#t)}set selectedChapterId(e){y(this.#t,e,!0)}#r=Ue(null);get selectedManifestItemId(){return o(this.#r)}set selectedManifestItemId(e){y(this.#r,e,!0)}#a=Ue(!1);get initialized(){return o(this.#a)}set initialized(e){y(this.#a,e,!0)}#n=Ue(!1);get isLoading(){return o(this.#n)}set isLoading(e){y(this.#n,e,!0)}#s=Ue(null);get errorMessage(){return o(this.#s)}set errorMessage(e){y(this.#s,e,!0)}#i=Ue(null);get globalSettings(){return o(this.#i)}set globalSettings(e){y(this.#i,e,!0)}#o=Ue(null);get workspaceSettings(){return o(this.#o)}set workspaceSettings(e){y(this.#o,e,!0)}#l=Ue(null);get epubSettings(){return o(this.#l)}set epubSettings(e){y(this.#l,e,!0)}get hasWorkspace(){return this.workspace!==null}get isWorkspaceReady(){return this.initialized&&this.workspace!==null}get currentWorkspaceId(){return this.workspace?.id||null}get workspaceInfo(){return this.workspace?{id:this.workspace.id,title:this.workspace.opf.metadata.title,language:this.workspace.opf.metadata.language,lastModified:new Date,fileCount:this.workspace.opf.manifest.length,totalSize:0,author:this.workspace.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0"}:null}get selectedChapter(){if(!this.workspace||!this.selectedChapterId)return null;const e=this.workspace.opf.manifest.find(t=>t.id===this.selectedChapterId);return e?{id:e.id,href:e.href,xhtmlContent:"",linear:!0,mediaType:e.mediaType||"application/xhtml+xml"}:null}get navigationItems(){return this.workspace?this.workspace.opf.spine.map((e,t)=>{const a=this.workspace.opf.manifest.find(n=>n.id===e.idref);return{id:e.idref,title:a?.id||`Chapter ${t+1}`,href:a?.href||"",order:t}}):[]}get availableChapters(){return this.workspace?this.workspace.opf.manifest.filter(e=>e.mediaType==="application/xhtml+xml").map(e=>({id:e.id,title:e.id,href:e.href})):[]}get currentTheme(){return this.globalSettings?.theme||"system"}get currentLocale(){return this.globalSettings?.locale||"en"}get editorFontSize(){return this.globalSettings?.editor_font_size||14}get isDraftMode(){return(this.workspaceSettings?.draft_id||0)>0}get currentDraftId(){return this.workspaceSettings?.draft_id||0}get isAdvancedMode(){return this.workspaceSettings?.editor?.advanced_mode??!1}getTransformEngine(){return this.transformEngine}getContentService(){return this.contentService}getSettingsService(){return this.settingsService}getExtensionManager(){return this.extensionManager}setupReactiveEffects(){hl(()=>{xt(()=>{this.workspace?.id?(this.loadWorkspaceSettings(this.workspace.id),this.loadEPUBSettings(this.workspace.id)):(this.workspaceSettings=null,this.epubSettings=null)}),xt(()=>{this.errorMessage&&setTimeout(()=>{this.errorMessage=null},5e3)})})}async initialize(){try{this.isLoading=!0,this.errorMessage=null,this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.restoreWorkspaceState(),this.initialized=!0}catch(e){throw this.errorMessage=`Failed to initialize: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async listWorkspaces(){try{return this.isLoading=!0,this.errorMessage=null,await this.workspaceService.listWorkspaces()}catch(e){throw this.errorMessage=`Failed to list workspaces: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async createWorkspace(e,t="en"){try{this.isLoading=!0,this.errorMessage=null;const a=await this.workspaceService.createWorkspace({title:e,language:t,identifier:`urn:uuid:${crypto.randomUUID()}`}),n=await this.contentService.generateSampleContentData(t),i=await this.workspaceService.populateWithContent(a.id,n);return this.workspace=i,a.id}catch(a){throw this.errorMessage=`Failed to create workspace: ${a instanceof Error?a.message:"Unknown error"}`,a}finally{this.isLoading=!1}}async loadWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.loadWorkspace(e),this.selectedChapterId=null,this.selectedManifestItemId=null,this.persistWorkspaceId(e)}catch(t){throw this.errorMessage=`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async saveWorkspace(){if(!this.workspace)throw new Error("No workspace to save");try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.saveWorkspace(this.workspace)}catch(e){throw this.errorMessage=`Failed to save workspace: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async deleteWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,await this.workspaceService.deleteWorkspace(e),this.workspace?.id===e&&(this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.clearPersistedState())}catch(t){throw this.errorMessage=`Failed to delete workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}selectChapter(e){this.selectedChapterId=e,this.persistSpineItemId(e)}selectManifestItem(e){this.selectedManifestItemId=e}async generateSampleContent(e="en"){if(!this.workspace)throw new Error("No workspace loaded");try{this.isLoading=!0,this.errorMessage=null;const t=await this.contentService.generateLocalizedContent(e);this.workspace.opf.metadata={...this.workspace.opf.metadata,...t.metadata},t.chapters.forEach((a,n)=>{const i={id:`chapter${n+1}`,href:`Text/${a.title}.xhtml`,mediaType:"application/xhtml+xml"};this.workspace.opf.manifest.push(i),this.workspace.opf.spine.push({idref:i.id,linear:!0})}),await this.saveWorkspace()}catch(t){throw this.errorMessage=`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}loadGlobalSettings(){try{this.globalSettings=this.settingsService.loadGlobalSettings()}catch(e){console.warn("Failed to load global settings:",e),this.globalSettings=this.settingsService.getDefaultGlobalSettings()}}updateGlobalSettings(e){if(!this.globalSettings)return;const t={...this.globalSettings,...e};try{this.settingsService.saveGlobalSettings(t),this.globalSettings=t}catch(a){this.errorMessage=`Failed to save global settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadWorkspaceSettings(e){try{this.workspaceSettings=await this.settingsService.loadWorkspaceSettings(e)}catch(t){console.warn("Failed to load workspace settings:",t),this.workspaceSettings=this.settingsService.getDefaultWorkspaceSettings()}}async updateWorkspaceSettings(e){if(!this.workspace||!this.workspaceSettings)return;const t={...this.workspaceSettings,...e};try{await this.settingsService.saveWorkspaceSettings(this.workspace.id,t),this.workspaceSettings=t}catch(a){this.errorMessage=`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadEPUBSettings(e){try{this.epubSettings=await this.settingsService.loadEPUBSettings(e)}catch(t){console.warn("Failed to load EPUB settings:",t),this.epubSettings=this.settingsService.getDefaultEPUBSettings()}}async updateEPUBSettings(e){if(!this.workspace||!this.epubSettings)return;const t={...this.epubSettings,...e};try{await this.settingsService.saveEPUBSettings(this.workspace.id,t),this.epubSettings=t}catch(a){this.errorMessage=`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`}}async incrementDraftId(){if(this.workspace)try{const e=await this.settingsService.incrementDraftId(this.workspace.id);this.workspaceSettings&&(this.workspaceSettings.draft_id=e);const t=this.settingsService.extractDraftInfo(this.workspace.opf.metadata.title).baseTitle;this.workspace.opf.metadata.title=this.settingsService.generateDraftTitle(t,e)}catch(e){this.errorMessage=`Failed to increment draft ID: ${e instanceof Error?e.message:"Unknown error"}`}}async packageEPUB(){if(!this.workspace)throw new Error("No workspace to package");try{this.isLoading=!0,this.errorMessage=null;const e=await this.epubProcessor.packageEPUB(this.workspace.id,{compressionLevel:"balanced",validateStructure:!0,progressCallback:t=>{console.log("Package progress:",t)}});if(!e.success)throw new Error(e.error||"Package failed");return e.blob||null}catch(e){throw this.errorMessage=`Failed to package EPUB: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async unpackEPUB(e){try{this.isLoading=!0,this.errorMessage=null;const t=await this.epubProcessor.unpackEPUB(e,`workspace-${Date.now()}`);if(!t.success)throw new Error(t.error||"Unpack failed");const a=t.workspaceId;return await this.loadWorkspace(a),a}catch(t){throw this.errorMessage=`Failed to unpack EPUB: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async restoreWorkspaceState(){try{const e=localStorage.getItem(wn.WORKSPACE_ID);if(e){await this.loadWorkspace(e);const t=localStorage.getItem(wn.SPINE_ITEM_ID);t&&(this.selectedChapterId=t)}}catch(e){console.warn("Failed to restore workspace state:",e),this.clearPersistedState()}}persistWorkspaceId(e){try{e?localStorage.setItem(wn.WORKSPACE_ID,e):localStorage.removeItem(wn.WORKSPACE_ID)}catch(t){console.warn("Failed to persist workspace ID:",t)}}persistSpineItemId(e){try{e?localStorage.setItem(wn.SPINE_ITEM_ID,e):localStorage.removeItem(wn.SPINE_ITEM_ID)}catch(t){console.warn("Failed to persist spine item ID:",t)}}clearPersistedState(){try{localStorage.removeItem(wn.WORKSPACE_ID),localStorage.removeItem(wn.SPINE_ITEM_ID)}catch(e){console.warn("Failed to clear persisted state:",e)}}cleanup(){this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.initialized=!1,this.isLoading=!1,this.errorMessage=null}}class Na extends Error{stage;scriptName;line;column;hasCustomStack;constructor(e){super(e.message),this.name="TransformError",this.stage=e.stage,this.scriptName=e.scriptName,this.line=e.line,this.column=e.column,this.hasCustomStack=!!e.stack,e.stack&&(this.stack=e.stack)}toUserMessage(){let a=`${{loading:"Script Loading",text:"Text Transform",dom:"DOM Transform",template:"Template Generation"}[this.stage]} Error: ${this.message}`;return this.scriptName&&(a+=`
Script: ${this.scriptName}`),this.line!==void 0&&(a+=`
Line ${this.line}`),this.column!==void 0&&(a+=`
Column ${this.column}`),a}getErrorDetails(){return{stage:this.stage,message:this.message,scriptName:this.scriptName,line:this.line,column:this.column,stack:this.hasCustomStack?this.stack:void 0,userMessage:this.toUserMessage()}}}class da{static DEFAULT_TIMEOUT_MS=2e3;async executeTextTransform(e,t,a,n,i={}){const s=i.timeoutMs||da.DEFAULT_TIMEOUT_MS;return new Promise((l,d)=>{const u=setTimeout(()=>{d(new Na({stage:"text",message:`Transform execution timed out after ${s}ms`,scriptName:t}))},s);try{const c=this.createSandboxedGlobals(i.globals),p=this.executeFunctionInSandbox(e,"transformText",[a,n.idref],c,t);clearTimeout(u),l(typeof p=="string"?p:String(p))}catch(c){clearTimeout(u),d(this.createTransformError(c,"text",t))}})}async executeDOMTransform(e,t,a,n,i={}){const s=i.timeoutMs||da.DEFAULT_TIMEOUT_MS;return new Promise((l,d)=>{const u=setTimeout(()=>{d(new Na({stage:"dom",message:`Transform execution timed out after ${s}ms`,scriptName:t}))},s);try{const c=a.cloneNode(!0),p=this.createSandboxedGlobals(i.globals),h=this.executeFunctionInSandbox(e,"transformDOM",[c,n.idref],p,t);clearTimeout(u),h instanceof Document?l(h):l(c)}catch(c){clearTimeout(u),d(this.createTransformError(c,"dom",t))}})}createSandboxedGlobals(e={}){const t={console,JSON,Math,Date,RegExp,String,Number,Boolean,Array,Object,document:typeof document<"u"?document:void 0,...e};return["eval","Function","setTimeout","setInterval","clearTimeout","clearInterval","setImmediate","clearImmediate","XMLHttpRequest","fetch","import","require","process","global","globalThis"].forEach(n=>{delete t[n]}),t}executeFunctionInSandbox(e,t,a,n,i){const s=Object.keys(n),l=Object.values(n),d=`(function(${s.join(", ")}) {
        ${e}

        if (typeof ${t} !== 'function') {
          throw new Error('Function ${t} is not defined or not a function');
        }

        return ${t};
      })`;return new Function("return "+d)()(...l)(...a)}createTransformError(e,t,a){const n=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;let s,l;if(i){const d=i.match(/at.*:(\d+):(\d+)/);d&&(s=parseInt(d[1],10),l=parseInt(d[2],10))}return new Na({stage:t,message:n,scriptName:a,line:s,column:l,stack:i})}}const rm=`/**
 * Transform Execution Environment Styles
 * 
 * Minimal styling for the iframe transform execution environment.
 * Focus on functionality over appearance since this is primarily
 * for sandboxed script execution.
 */

/* Reset and base styles */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
               'Helvetica Neue', Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: #333;
  background: #fff;
}

/* Status display */
.transform-status {
  padding: 12px 16px;
  margin-bottom: 16px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  display: none;
  border: 1px solid transparent;
}

.transform-status.visible {
  display: block;
}

/* Status variants */
.transform-status.info {
  background: #e3f2fd;
  color: #0d47a1;
  border-color: #bbdefb;
}

.transform-status.success {
  background: #e8f5e8;
  color: #2e7d32;
  border-color: #c8e6c9;
}

.transform-status.error {
  background: #ffebee;
  color: #c62828;
  border-color: #ffcdd2;
}

.transform-status.warning {
  background: #fff8e1;
  color: #f57f17;
  border-color: #ffecb3;
}

/* Debug information (hidden by default) */
.debug-info {
  margin-top: 20px;
  padding: 12px;
  background: #f5f5f5;
  border-radius: 4px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  color: #666;
  display: none;
}

.debug-info.visible {
  display: block;
}

/* Error details */
.error-details {
  margin-top: 8px;
  padding: 8px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 3px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  white-space: pre-wrap;
  word-break: break-word;
}

/* Minimal responsive adjustments */
@media (max-width: 480px) {
  body {
    padding: 12px;
  }
  
  .transform-status {
    padding: 8px 12px;
    margin-bottom: 12px;
    font-size: 13px;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .transform-status.info {
    background: #000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.success {
    background: #006600;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.error {
    background: #cc0000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.warning {
    background: #cc6600;
    color: #fff;
    border-color: #fff;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}`,am=`/**
 * Transform Script Execution Engine
 *
 * Provides sandboxed execution of text and DOM transform scripts
 * with timeout protection and comprehensive error handling.
 *
 * This script runs inside the iframe and communicates with the parent
 * window via postMessage for security and isolation.
 */

/**
 * Transform execution environment with sandboxing and error handling
 */
class TransformExecutionEngine {
  constructor() {
    this.textTransformScript = '';
    this.domTransformScripts = [];
    this.loadedExtensionScripts = [];
    this.debugMode = false;
    this.messageHandlers = new Map();

    this.init();
  }

  /**
   * Initialize the execution environment
   */
  init() {
    this.setupMessageHandling();
    this.setupErrorHandling();
    this.signalReady();
  }

  /**
   * Set up message handling from parent window
   */
  setupMessageHandling() {
    window.addEventListener('message', event => {
      this.handleParentMessage(event.data);
    });

    // Register message handlers
    this.messageHandlers.set('SET_TRANSFORM_SCRIPTS', this.setTransformScripts.bind(this));
    this.messageHandlers.set('SET_EXTENSION_SCRIPTS', this.setExtensionScripts.bind(this));
    this.messageHandlers.set('EXECUTE_TRANSFORM', this.executeTransform.bind(this));
    this.messageHandlers.set('SET_DEBUG_MODE', this.setDebugMode.bind(this));
    this.messageHandlers.set('PING', this.handlePing.bind(this));
  }

  /**
   * Set up global error handling
   */
  setupErrorHandling() {
    window.addEventListener('error', event => {
      console.error('Global error in transform iframe:', event.error);
      this.notifyParent('GLOBAL_ERROR', {
        message: event.error?.message || 'Unknown global error',
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack,
      });
    });

    window.addEventListener('unhandledrejection', event => {
      console.error('Unhandled promise rejection in transform iframe:', event.reason);
      this.notifyParent('UNHANDLED_REJECTION', {
        message: event.reason?.message || 'Unhandled promise rejection',
        stack: event.reason?.stack,
      });
    });
  }

  /**
   * Signal ready state to parent window
   */
  signalReady() {
    this.updateStatus('Transform execution environment ready', 'success');
    this.notifyParent('IFRAME_READY');

    if (this.debugMode) {
      this.debugLog('TransformExecutionEngine initialized');
    }
  }

  /**
   * Handle incoming messages from parent window
   */
  handleParentMessage(message) {
    if (!message || typeof message !== 'object') {
      return;
    }

    const { type, payload, messageId } = message;

    if (this.debugMode) {
      this.debugLog(\`Received message: \${type}\`, payload);
    }

    try {
      const handler = this.messageHandlers.get(type);
      if (handler) {
        handler(payload, messageId);
      } else {
        console.warn('Unknown message type received:', type);
        this.respondToParent(messageId, {
          success: false,
          error: { stage: 'communication', message: \`Unknown message type: \${type}\` },
        });
      }
    } catch (error) {
      console.error('Error handling message:', error);
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'communication',
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : undefined,
        },
      });
    }
  }

  /**
   * Set transform scripts content
   */
  setTransformScripts(scripts, messageId) {
    try {
      this.textTransformScript = scripts.textTransform || '';
      this.domTransformScripts = scripts.domTransforms || [];

      const textScriptLength = this.textTransformScript.length;
      const domScriptCount = this.domTransformScripts.length;

      this.updateStatus(
        \`Loaded text transform (\${textScriptLength} chars) and \${domScriptCount} DOM transforms\`,
        'success'
      );

      if (this.debugMode) {
        this.debugLog('Transform scripts updated', {
          textTransform: textScriptLength > 0,
          domTransformCount: domScriptCount,
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'script-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load extension scripts dynamically into iframe context
   */
  async setExtensionScripts(scripts, messageId) {
    try {
      // Clear any previously loaded extension scripts
      this.clearLoadedExtensions();

      const scriptCount = scripts.length;
      this.updateStatus(\`Loading \${scriptCount} extension scripts...\`, 'info');

      // Load each script sequentially to avoid race conditions
      for (const script of scripts) {
        await this.loadExtensionScript(script.name, script.blobUrl);
      }

      this.updateStatus(\`Successfully loaded \${scriptCount} extension libraries\`, 'success');

      if (this.debugMode) {
        this.debugLog('Extension scripts loaded', {
          scriptCount,
          scripts: scripts.map(s => s.name),
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.updateStatus(\`Failed to load extension scripts: \${error.message}\`, 'error');
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'extension-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load a single extension script
   */
  async loadExtensionScript(name, blobUrl) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = blobUrl;

      // Set ID for easy identification in browser inspector
      // Convert name to valid HTML ID (replace invalid characters)
      const scriptId = \`extension-\${name.replace(/[^a-zA-Z0-9-_]/g, '-')}\`;
      script.id = scriptId;

      script.onload = () => {
        if (this.debugMode) {
          this.debugLog(\`Loaded extension script: \${name} (id: \${scriptId})\`);
        }
        // Clean up blob URL after loading
        URL.revokeObjectURL(blobUrl);
        resolve();
      };
      script.onerror = error => {
        URL.revokeObjectURL(blobUrl);
        reject(new Error(\`Failed to load extension script \${name}: \${error}\`));
      };

      // Add script to head to execute
      document.head.appendChild(script);

      // Store reference for cleanup
      if (!this.loadedExtensionScripts) {
        this.loadedExtensionScripts = [];
      }
      this.loadedExtensionScripts.push(script);
    });
  }

  /**
   * Clear previously loaded extension scripts
   */
  clearLoadedExtensions() {
    if (this.loadedExtensionScripts) {
      for (const script of this.loadedExtensionScripts) {
        if (script.parentNode) {
          script.parentNode.removeChild(script);
        }
      }
      this.loadedExtensionScripts = [];
    }
  }

  /**
   * Execute the complete transform pipeline
   */
  async executeTransform(request, messageId) {
    const { plainText, timeout = 3000, idref } = request;
    const startTime = performance.now();

    try {
      this.updateStatus('Executing transform pipeline...', 'info');

      if (this.debugMode) {
        this.debugLog('Starting transform execution', {
          plainTextLength: plainText.length,
          timeout,
          hasTextTransform: this.textTransformScript.length > 0,
          domTransformCount: this.domTransformScripts.length,
        });
      }

      // Step 1: Execute text transform
      let html = plainText;
      if (this.textTransformScript.trim()) {
        html = await this.executeTextTransformWithTimeout(plainText, timeout, idref);

        if (this.debugMode) {
          this.debugLog('Text transform completed', {
            inputLength: plainText.length,
            outputLength: html.length,
          });
        }
      }

      // Step 2: Execute DOM transforms in sequence
      if (this.domTransformScripts.length > 0) {
        html = await this.executeDOMTransformsWithTimeout(html, timeout, idref);

        if (this.debugMode) {
          this.debugLog('DOM transforms completed', {
            transformCount: this.domTransformScripts.length,
            finalLength: html.length,
          });
        }
      }

      const executionTime = performance.now() - startTime;
      this.updateStatus(\`Transform completed in \${executionTime.toFixed(2)}ms\`, 'success');

      this.respondToParent(messageId, {
        success: true,
        html,
        executionTime: Math.round(executionTime),
      });
    } catch (error) {
      const executionTime = performance.now() - startTime;
      this.updateStatus(
        \`Transform failed: \${error instanceof Error ? error.message : String(error)}\`,
        'error'
      );

      if (this.debugMode) {
        console.error('Transform execution failed', {
          error: error instanceof Error ? error.message : String(error),
          stage: error && typeof error === 'object' && 'stage' in error ? error.stage : 'unknown',
          executionTime: Math.round(executionTime),
        });
      }

      this.respondToParent(messageId, {
        success: false,
        error,
        executionTime: Math.round(executionTime),
      });
    }
  }

  /**
   * Execute text transform with timeout protection
   * @param {any} plainText
   * @param {any} timeout
   * @param {any} idref
   */
  executeTextTransformWithTimeout(plainText, timeout, idref) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`Text transform execution timed out after \${timeout}ms\`);
        error.stage = 'text-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeTextTransformSync(plainText, idref);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'text';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute text transform synchronously
   * @param {any} plainText
   * @param {any} idref
   */
  executeTextTransformSync(plainText, idref) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${this.textTransformScript}

      if (typeof transformText !== 'function') {
        throw new Error('transformText function is not defined in script');
      }

      return transformText;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with input text and idref
    const result = transformFunction(plainText, idref);

    // Ensure result is a string
    return typeof result === 'string' ? result : String(result);
  }

  /**
   * Execute DOM transforms with timeout protection
   * @param {any} html
   * @param {any} timeout
   * @param {any} idref
   */
  executeDOMTransformsWithTimeout(html, timeout, idref) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`DOM transform execution timed out after \${timeout}ms\`);
        error.stage = 'dom-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeDOMTransformsSync(html, idref);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'dom';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute DOM transforms synchronously with direct live DOM when layout is needed
   * @param {any} html
   * @param {any} idref
   */
  executeDOMTransformsSync(html, idref) {
    // Check if any transform scripts need layout calculations
    const needsLayout = this.checkIfLayoutNeeded();

    if (this.debugMode) {
      this.debugLog(\`DOM transform mode decision: needsLayout=\${needsLayout}\`, {
        scriptCount: this.domTransformScripts.length,
        scriptsWithLayout: this.domTransformScripts.filter(script =>
          script.includes('getElementLayout')
        ).length,
      });
    }

    if (needsLayout) {
      // Use live DOM approach for layout-dependent transforms
      return this.executeDOMTransformsWithLiveDOM(html, idref);
    } else {
      // Use standard parsed document approach for simple transforms
      return this.executeDOMTransformsWithParsedDOM(html, idref);
    }
  }

  /**
   * Check if transform scripts need layout calculations
   */
  checkIfLayoutNeeded() {
    // Simple heuristic: check if any scripts mention getElementLayout
    return this.domTransformScripts.some(script => script.includes('getElementLayout'));
  }

  /**
   * Execute DOM transforms using live DOM for layout calculations
   */
  executeDOMTransformsWithLiveDOM(html, idref) {
    const tempContainer = this.createLiveDOMContainer();

    try {
      // Put content directly in live DOM
      tempContainer.innerHTML = html;

      if (this.debugMode) {
        this.debugLog('Live DOM container created:', {
          innerHTML: tempContainer.innerHTML.substring(0, 200) + '...',
          elementCount: tempContainer.querySelectorAll('*').length,
          containerWidth: tempContainer.offsetWidth,
          containerHeight: tempContainer.offsetHeight,
          firstElementInfo: tempContainer.firstElementChild
            ? {
                tagName: tempContainer.firstElementChild.tagName,
                offsetWidth: tempContainer.firstElementChild.offsetWidth,
                offsetHeight: tempContainer.firstElementChild.offsetHeight,
                textContent: tempContainer.firstElementChild.textContent?.substring(0, 50),
              }
            : 'no first element',
        });
      }

      // Execute transforms on live DOM elements
      for (let i = 0; i < this.domTransformScripts.length; i++) {
        try {
          // Pass the live container as a document-like object
          const mockDocument = this.createMockDocument(tempContainer);
          this.executeSingleDOMTransform(mockDocument, this.domTransformScripts[i], i, idref);
        } catch (error) {
          if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
          throw error;
        }
      }

      // Return the transformed HTML from live DOM (including body element and attributes)
      // Create a body element with the container's attributes and content
      const serializer = new XMLSerializer();
      const bodyElement = document.createElement('body');
      
      // Copy all attributes from container to body
      for (let i = 0; i < tempContainer.attributes.length; i++) {
        const attr = tempContainer.attributes[i];
        bodyElement.setAttribute(attr.name, attr.value);
      }
      bodyElement.innerHTML = tempContainer.innerHTML;
      
      return serializer.serializeToString(bodyElement);
    } finally {
      this.cleanupTempAttachment(tempContainer);
    }
  }

  /**
   * Execute DOM transforms using parsed DOM (traditional approach)
   */
  executeDOMTransformsWithParsedDOM(html, idref) {
    // Parse HTML to DOM document
    const parser = new DOMParser();
    let document = parser.parseFromString(
      \`<!DOCTYPE html><html><head></head><body>\${html}</body></html>\`,
      'text/html'
    );

    // Execute each DOM transform in sequence
    for (let i = 0; i < this.domTransformScripts.length; i++) {
      try {
        document = this.executeSingleDOMTransform(document, this.domTransformScripts[i], i, idref);
      } catch (error) {
        if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
        throw error;
      }
    }

    // Return transformed HTML content with XHTML compliance (including body element and attributes)
    const serializer = new XMLSerializer();
    const fullBodySerialization = serializer.serializeToString(document.body);
    return fullBodySerialization;
  }

  /**
   * Create a live DOM container for layout calculations
   */
  createLiveDOMContainer() {
    const container = document.createElement('div');
    container.id = 'transform-live-container';

    // Set styles via JavaScript properties instead of CSS strings
    // This works better in iframe environments
    const style = container.style;
    style.position = 'fixed';
    style.top = '0px';
    style.left = '0px';
    style.width = '800px';
    style.minHeight = '600px';
    style.visibility = 'hidden';
    style.pointerEvents = 'none';
    style.fontFamily = 'Georgia, serif';
    style.fontSize = '16px';
    style.lineHeight = '1.6';
    style.color = 'black';
    style.backgroundColor = 'white';
    style.display = 'block';
    style.boxSizing = 'border-box';
    style.padding = '20px';

    document.body.appendChild(container);

    // Force layout calculation by accessing offsetWidth immediately
    const forceLayout1 = container.offsetWidth;

    // Try a different approach if that didn't work - temporarily make visible
    if (forceLayout1 === 0) {
      style.visibility = 'visible';
      style.opacity = '0';
      const forceLayout2 = container.offsetWidth;
      style.visibility = 'hidden';
      style.opacity = '1';

      if (this.debugMode) {
        this.debugLog('Container had zero width, tried visibility workaround', {
          beforeWorkaround: forceLayout1,
          afterWorkaround: forceLayout2,
        });
      }
    }

    if (this.debugMode) {
      this.debugLog('Created live DOM container for layout calculations', {
        offsetWidth: container.offsetWidth,
        offsetHeight: container.offsetHeight,
        clientWidth: container.clientWidth,
        clientHeight: container.clientHeight,
        computedWidth: window.getComputedStyle(container).width,
        computedDisplay: window.getComputedStyle(container).display,
        parentElement: container.parentElement ? container.parentElement.tagName : 'none',
        documentBody: document.body ? 'exists' : 'missing',
      });
    }

    return container;
  }

  /**
   * Create a mock document object that uses the live container as its body
   */
  createMockDocument(container) {
    return {
      body: container,
      querySelector: selector => container.querySelector(selector),
      querySelectorAll: selector => container.querySelectorAll(selector),
      createElement: tagName => document.createElement(tagName),
      // Add other document methods as needed
    };
  }

  /**
   * Clean up temporary DOM container
   */
  cleanupTempAttachment(container) {
    if (container && container.parentNode) {
      container.parentNode.removeChild(container);

      if (this.debugMode) {
        this.debugLog('Cleaned up temporary DOM container');
      }
    }
  }

  /**
   * Execute a single DOM transform script
   * @param {any} document
   * @param {any} script
   * @param {any} index
   * @param {any} idref
   */
  executeSingleDOMTransform(document, script, index, idref) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${script}

      if (typeof transformDOM !== 'function') {
        throw new Error('transformDOM function is not defined in script \${index}');
      }

      return transformDOM;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with document and idref
    const result = transformFunction(document, idref);

    // Ensure result is a Document, return original if not
    return result instanceof Document ? result : document;
  }

  /**
   * Create safe execution environment with restricted globals
   */
  createSafeExecutionEnvironment() {
    // Start with safe browser APIs
    const safeGlobals = {
      // Safe JavaScript built-ins
      console,
      JSON,
      Math,
      Date,
      RegExp,
      String,
      Number,
      Boolean,
      Array,
      Object,
      parseInt,
      parseFloat,
      isNaN,
      isFinite,

      // Safe DOM APIs (document is special-cased for transforms)
      document: typeof document !== 'undefined' ? document : undefined,
      DOMParser: typeof DOMParser !== 'undefined' ? DOMParser : undefined,

      // Layout calculation utilities for attached DOM elements
      getElementLayout: this.createLayoutUtility(),

      // Extension libraries are available as native window globals after dynamic loading
    };

    // Explicitly remove dangerous globals that could break sandbox
    const dangerousGlobals = [
      'eval',
      'Function',
      'setTimeout',
      'setInterval',
      'clearTimeout',
      'clearInterval',
      'setImmediate',
      'clearImmediate',
      'requestAnimationFrame',
      'XMLHttpRequest',
      'fetch',
      'WebSocket',
      'EventSource',
      'import',
      'require',
      'process',
      'global',
      'globalThis',
      'window',
      'self',
      'parent',
      'top',
      'frames',
      'location',
      'history',
      'navigator',
      'localStorage',
      'sessionStorage',
      'indexedDB',
      'Worker',
      'SharedWorker',
    ];

    dangerousGlobals.forEach(dangerous => {
      delete safeGlobals[dangerous];
    });

    return safeGlobals;
  }

  /**
   * Create layout calculation utility for transform scripts
   */
  createLayoutUtility() {
    return element => {
      // Check if this is a real DOM element in the browser
      if (!element || !element.getBoundingClientRect) {
        if (this.debugMode) {
          this.debugLog('Layout requested for non-live element, returning defaults');
        }
        return {
          width: 0,
          height: 0,
          offsetWidth: 0,
          offsetHeight: 0,
          clientWidth: 0,
          clientHeight: 0,
          scrollWidth: 0,
          scrollHeight: 0,
          isAttached: false,
        };
      }

      // Element is live DOM - calculate real layout information
      const computedStyle = window.getComputedStyle(element);
      const rect = element.getBoundingClientRect();

      const layout = {
        // Dimensions from getBoundingClientRect (actual rendered size)
        width: rect.width,
        height: rect.height,

        // Element properties (includes padding/border/scrollbars)
        offsetWidth: element.offsetWidth,
        offsetHeight: element.offsetHeight,

        // Client dimensions (content + padding, excludes scrollbars/border)
        clientWidth: element.clientWidth,
        clientHeight: element.clientHeight,

        // Scroll dimensions (total content size)
        scrollWidth: element.scrollWidth,
        scrollHeight: element.scrollHeight,

        // Computed styles (useful for layout calculations)
        marginLeft: parseInt(computedStyle.marginLeft, 10) || 0,
        marginRight: parseInt(computedStyle.marginRight, 10) || 0,
        marginTop: parseInt(computedStyle.marginTop, 10) || 0,
        marginBottom: parseInt(computedStyle.marginBottom, 10) || 0,

        paddingLeft: parseInt(computedStyle.paddingLeft, 10) || 0,
        paddingRight: parseInt(computedStyle.paddingRight, 10) || 0,
        paddingTop: parseInt(computedStyle.paddingTop, 10) || 0,
        paddingBottom: parseInt(computedStyle.paddingBottom, 10) || 0,

        borderLeftWidth: parseInt(computedStyle.borderLeftWidth, 10) || 0,
        borderRightWidth: parseInt(computedStyle.borderRightWidth, 10) || 0,
        borderTopWidth: parseInt(computedStyle.borderTopWidth, 10) || 0,
        borderBottomWidth: parseInt(computedStyle.borderBottomWidth, 10) || 0,

        // Position information
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,

        // Attachment status
        isAttached: true,
      };

      if (this.debugMode) {
        this.debugLog('Layout calculated for live DOM element', {
          tagName: element.tagName,
          width: layout.width,
          height: layout.height,
          isAttached: layout.isAttached,
        });
      }

      return layout;
    };
  }

  /**
   * Enhance error object with additional context
   */
  enhanceError(error) {
    const enhanced = {
      message: error && error.message ? error.message : 'Unknown error',
      stage: error && error.stage ? error.stage : 'unknown',
      stack: error && error.stack ? error.stack : undefined,
    };

    // Try to extract line/column information from stack trace
    if (error && error.stack) {
      const lineMatch = error.stack.match(/at.*:(\\d+):(\\d+)/);
      if (lineMatch) {
        enhanced.line = parseInt(lineMatch[1], 10);
        enhanced.column = parseInt(lineMatch[2], 10);
      }
    }

    return enhanced;
  }

  /**
   * Set debug mode
   * @param {any} enabled
   * @param {any} messageId
   */
  setDebugMode(enabled, messageId) {
    this.debugMode = Boolean(enabled);
    this.updateStatus(\`Debug mode \${this.debugMode ? 'enabled' : 'disabled'}\`, 'info');
    this.respondToParent(messageId, { success: true, debugMode: this.debugMode });
  }

  /**
   * Handle ping message for connectivity testing
   * @param {any} payload
   * @param {any} messageId
   */
  handlePing(payload, messageId) {
    const timestamp = Date.now();
    this.respondToParent(messageId, {
      success: true,
      pong: true,
      timestamp,
      payload,
    });
  }

  /**
   * Update status display in iframe
   * @param {any} message
   * @param {string} type
   */
  updateStatus(message, type = 'info') {
    const statusElement = document.getElementById('status');
    if (statusElement) {
      statusElement.textContent = message;
      statusElement.className = \`transform-status visible \${type}\`;
    }

    if (this.debugMode) {
      console.log(\`[\${type.toUpperCase()}] \${message}\`);
    }
  }

  /**
   * Send notification to parent window (no response expected)
   * @param {any} type
   * @param {any} payload
   */
  notifyParent(type, payload = {}) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ type, payload }, '*');
    }
  }

  /**
   * Respond to parent window message
   * @param {any} messageId
   * @param {any} result
   */
  respondToParent(messageId, result) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage(
        {
          type: 'TRANSFORM_RESULT',
          messageId,
          payload: {
            result: result,
          },
        },
        '*'
      );
    }
  }

  /**
   * Debug logging utility
   * @param {any} message
   * @param {any} data
   */
  debugLog(message, data = null) {
    if (this.debugMode) {
      const timestamp = new Date().toISOString();
      console.log(\`[DEBUG \${timestamp}] \${message}\`, data || '');
    }
  }
}

// Initialize the transform execution engine when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    new TransformExecutionEngine();
  });
} else {
  new TransformExecutionEngine();
}
`;class im{constructor(e,t){this.extensionManager=t,this.blobURLManager=e}iframe=null;messageId=0;pendingMessages=new Map;blobURLManager;async initialize(){this.iframe=this.createPersistentIframe(),document.body.appendChild(this.iframe),window.addEventListener("message",this.handleMessage.bind(this)),await this.waitForReady()}async setTransformScripts(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_TRANSFORM_SCRIPTS",e)}async executeTransform(e,t=3e3,a){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("EXECUTE_TRANSFORM",{plainText:e,timeout:t,idref:a})}async setDebugMode(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_DEBUG_MODE",e)}async ping(e){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("PING",e)}async setWorkspaceExtensions(e){if(this.extensionManager)try{const t=await this.loadExtensionScripts(e);await this.sendMessage("SET_EXTENSION_SCRIPTS",t)}catch(t){console.error("Failed to load workspace extensions:",t)}}async loadExtensionScripts(e){if(!this.extensionManager)return[];const t=await this.extensionManager.listWorkspaceExtensions(e),a=[];for(const n of t)try{const i=n.files.filter(s=>s.type==="javascript");for(const s of i){const l=`SOURCE/extensions/${n.name}/${s.filename}`,u=await Ut.getInstance().readFile(e,l),c="application/javascript",p=new Blob([u],{type:c}),h=URL.createObjectURL(p);a.push({name:`${n.name}/${s.filename}`,blobUrl:h})}}catch(i){console.warn(`Failed to load extension ${n.name}:`,i)}return a}cleanup(){for(const[e,t]of this.pendingMessages)clearTimeout(t.timeout),t.reject(new Error("Transform engine shutting down"));this.pendingMessages.clear(),this.iframe&&(this.iframe.remove(),this.iframe=null),window.removeEventListener("message",this.handleMessage.bind(this))}createPersistentIframe(){const e=document.createElement("iframe");e.style.visibility="hidden",e.style.position="absolute",e.style.left="-9999px",e.style.top="0px",e.style.width="800px",e.style.height="600px";const t=this.createIframeDocument(),a=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(a);return e.src=n,e.onload=()=>{URL.revokeObjectURL(n)},e}createIframeDocument(){return`<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Transform Engine</title>
  <style>
${rm}
  </style>
</head>
<body>
  <div id="status" class="transform-status">Transform engine initializing...</div>
  <script>
${am}
  <\/script>
</body>
</html>`}async sendMessage(e,t){const a=++this.messageId;return new Promise((n,i)=>{const s=setTimeout(()=>{this.pendingMessages.delete(a),i(new Error(`Message timeout: ${e}`))},5e3);this.pendingMessages.set(a,{resolve:l=>{clearTimeout(s),n(l)},reject:l=>{clearTimeout(s),i(l)},timeout:s}),this.iframe?.contentWindow?this.iframe.contentWindow.postMessage({type:e,payload:t,messageId:a},"*"):(this.pendingMessages.delete(a),clearTimeout(s),i(new Error("Iframe not available")))})}handleMessage(e){if(e.source!==this.iframe?.contentWindow)return;const{type:t,messageId:a,payload:n}=e.data;if(t==="TRANSFORM_RESULT"&&a){const i=this.pendingMessages.get(a);if(i)if(this.pendingMessages.delete(a),n?.result?.success)i.resolve(n.result);else{const s=n?.result?.error||{message:"Unknown transform error"},l={stage:s.stage||"unknown",message:String(s.message||s||"Transform failed"),line:s.line,column:s.column,stack:s.stack};i.reject(l)}}else t==="IFRAME_READY"||(t==="GLOBAL_ERROR"||t==="UNHANDLED_REJECTION")&&console.error(`Transform engine ${t.toLowerCase()}:`,n)}waitForReady(){return new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("Transform engine initialization timeout"))},1e4),n=i=>{i.source===this.iframe?.contentWindow&&i.data.type==="IFRAME_READY"&&(clearTimeout(a),window.removeEventListener("message",n),e())};window.addEventListener("message",n)})}}class yt extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="SpineServiceError"}}class sm{constructor(e){this.workspaceService=e}async loadSpineItems(e){try{const t=[];for(const a of e.opf.spine){const n=e.opf.manifest.find(l=>l.id===a.idref);if(!n)continue;const i=`SOURCE/text/${n.id}.txt`,s=await this.workspaceService.fileExists(e.id,i);t.push({idref:n.id,linear:a.linear??!0,id:n.id,href:n.href,mediaType:n.mediaType,sourcePath:s?i:void 0,hasSourceFile:s})}return t}catch(t){throw new yt(`Failed to load spine items: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e.id)}}async addChapter(e,t){try{const a=this.generateUniqueChapterId(e),n=`Text/${a}.xhtml`,i={id:a,href:n,mediaType:"application/xhtml+xml"};let s=await this.workspaceService.addManifestItem(e,i);const l={idref:a,linear:t.linear??!0};s=await this.workspaceService.addSpineItem(s,l,t.insertIndex);const d=this.generateChapterXHTML(t.title);await this.workspaceService.writeFile(e.id,n,d);let u=!1,c;if(t.createSourceFile){c=`SOURCE/text/${a}.txt`;const h=`# ${t.title}

Your chapter content goes here...`;await this.workspaceService.writeFile(e.id,c,h),u=!0}const p={idref:a,linear:t.linear??!0,id:a,href:n,mediaType:"application/xhtml+xml",sourcePath:u?c:void 0,hasSourceFile:u};return{updatedWorkspace:s,newChapter:p}}catch(a){throw new yt(`Failed to add chapter: ${a instanceof Error?a.message:"Unknown error"}`,"ADD_CHAPTER_ERROR",e.id)}}async moveChapterUp(e,t){try{if(t<=0)throw new yt("Cannot move first chapter up","INVALID_MOVE",e.id);const a=await this.loadSpineItems(e);if(t>=a.length)throw new yt("Invalid chapter index","INVALID_INDEX",e.id);const n=[...a];return[n[t-1],n[t]]=[n[t],n[t-1]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(s=>s.id)),newOrder:n}}catch(a){throw a instanceof yt?a:new yt(`Failed to move chapter up: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async moveChapterDown(e,t){try{const a=await this.loadSpineItems(e);if(t<0||t>=a.length-1)throw new yt("Cannot move last chapter down","INVALID_MOVE",e.id);const n=[...a];return[n[t],n[t+1]]=[n[t+1],n[t]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(s=>s.id)),newOrder:n}}catch(a){throw a instanceof yt?a:new yt(`Failed to move chapter down: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async reorderItems(e,t,a){try{const n=await this.loadSpineItems(e);if(t<0||t>=n.length||a<0||a>=n.length)throw new yt("Invalid reorder indices","INVALID_INDEX",e.id);const i=[...n],[s]=i.splice(t,1);return i.splice(a,0,s),{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,i.map(d=>d.id)),newOrder:i}}catch(n){throw n instanceof yt?n:new yt(`Failed to reorder items: ${n instanceof Error?n.message:"Unknown error"}`,"REORDER_ERROR",e.id)}}generateUniqueChapterId(e){const t=new Set(e.opf.manifest.map(i=>i.id));let a=1,n=`chapter${a.toString().padStart(2,"0")}`;for(;t.has(n);)a++,n=`chapter${a.toString().padStart(2,"0")}`;return n}generateChapterXHTML(e){return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
    <title>${e}</title>
    <link rel="stylesheet" type="text/css" href="../Styles/styles.css"/>
</head>
<body>
    <section class="chapter">
        <h1>${e}</h1>
        <p>Your chapter content goes here...</p>
    </section>
</body>
</html>`}async deleteChapter(e,t){try{if(e.opf.spine.findIndex(l=>l.idref===t)===-1)throw new yt("Chapter not found in spine","CHAPTER_NOT_FOUND",e.id);const n=e.opf.manifest.findIndex(l=>l.id===t);if(n===-1)throw new yt("Chapter not found in manifest","MANIFEST_ITEM_NOT_FOUND",e.id);const i=e.opf.manifest[n],s={...e,opf:{...e.opf,spine:e.opf.spine.filter(l=>l.idref!==t),manifest:e.opf.manifest.filter(l=>l.id!==t)}};await this.workspaceService.saveWorkspace(s);try{const l=i.href.startsWith(e.pathInfo.basePath)?i.href:`${e.pathInfo.basePath}/${i.href}`;await this.workspaceService.fileStorage.deleteFile(s.id,l)}catch(l){console.warn("Failed to delete XHTML file:",l)}try{const l=`SOURCE/text/${t}.txt`;await this.workspaceService.fileStorage.deleteFile(s.id,l)}catch(l){console.warn("Failed to delete source file:",l)}return{updatedWorkspace:s}}catch(a){throw a instanceof yt?a:new yt(`Failed to delete chapter: ${a instanceof Error?a.message:"Unknown error"}`,"DELETE_ERROR",e.id)}}async renameChapterId(e,t,a){try{if(!/^[a-zA-Z_][a-zA-Z0-9_.-]*$/.test(a))throw new yt("Invalid ID format. ID must start with a letter or underscore and contain only letters, numbers, hyphens, periods, and underscores.","INVALID_ID_FORMAT",e.id);if(e.opf.manifest.some(u=>u.id===a))throw new yt(`ID '${a}' already exists`,"DUPLICATE_ID",e.id);const n=e.opf.manifest.find(u=>u.id===t);if(!n)throw new yt(`Item with ID '${t}' not found`,"ITEM_NOT_FOUND",e.id);const i=n.href.replace(t,a);let s=await this.workspaceService.updateManifestItem(e,t,{id:a,href:i});const l=`SOURCE/text/${t}.txt`,d=`SOURCE/text/${a}.txt`;return await this.workspaceService.fileExists(e.id,l)&&await this.workspaceService.renameFile(e.id,l,d),{updatedWorkspace:s}}catch(n){throw new yt(`Failed to rename chapter ID: ${n instanceof Error?n.message:"Unknown error"}`,"RENAME_ERROR",e.id)}}}var om=P('<div class="error-state svelte-1pwtvzx"><h2 class="svelte-1pwtvzx">Transform Engine Failed</h2> <p class="svelte-1pwtvzx"> </p> <p class="svelte-1pwtvzx">Please refresh the page to try again.</p></div>'),lm=P('<div class="loading-state svelte-1pwtvzx"><div class="spinner svelte-1pwtvzx"></div> <p>Initializing transform engine...</p></div>'),cm=P('<div class="loading-state svelte-1pwtvzx"><div class="spinner svelte-1pwtvzx"></div> <p>Initializing application...</p></div>'),dm=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),um=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),fm=P('<div class="placeholder-content svelte-1pwtvzx"><p class="svelte-1pwtvzx"> </p></div>'),pm=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),hm=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),vm=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p></div>'),mm=P('<div class="placeholder-content svelte-1pwtvzx"><h3 class="svelte-1pwtvzx"> </h3> <p class="svelte-1pwtvzx"> </p> <p class="current-view-info svelte-1pwtvzx"> <strong> </strong></p></div>');function gm(r,e){Qe(e,!0);const[t,a]=ot(),n=()=>Ye(bt,"$navigationStore",t),i=()=>Ye(An,"$layoutStore",t),s=()=>Ye(pt,"$t",t);let l;const d={setTheme:()=>{},useSystemPreference:()=>{},getCurrentTheme:()=>"system"},u={setLocale:()=>{},getCurrentLocale:()=>"en"},c=Ut.getInstance(),p=new da,h=new yo(c),v=new sm(h),m=new Rf(h),w=new Ei,b=new xo;let k,I=null,C=Ue(!1),L=Ue(null),E=Ue(null),N=oe(()=>n().currentView),z=oe(()=>i().sidebar.isExpanded),H=oe(()=>o(E)?.currentWorkspaceId),W=oe(()=>o(E)?.selectedChapterId),O=oe(()=>o(E)?.initialized||!1),T=oe(()=>o(E)?.workspace),G=oe(()=>{const ne=o(T)?.opf?.metadata?.title;return ne?`${ne}`:"EDITME"}),U=Ue(null),F=Ue(null),D=Ue(null),M=Ue(Ct({xhtmlContent:"",isTransforming:!1,transformError:null,transformWarnings:[],executionTime:0,spineItemId:null}));const le=ne=>{y(U,ne.item,!0),y(F,ne.type,!0)},J=async ne=>{const{field:be}=ne.detail;(be==="creator"||be==="title"||be==="language")&&window.dispatchEvent(new CustomEvent("workspace-list-refresh"))},ge=ne=>{y(D,ne.detail.xhtml,!0)},X=ne=>{y(M,{xhtmlContent:ne.detail.xhtmlContent,isTransforming:ne.detail.isTransforming,transformError:ne.detail.transformError,transformWarnings:ne.detail.transformWarnings,executionTime:ne.detail.executionTime,spineItemId:ne.detail.spineItemId},!0)},we=ne=>{const be=document.querySelector("[data-spine-view]");be&&be.dispatchEvent(new CustomEvent("preview-click",{detail:ne,bubbles:!0}))},he=async ne=>{if(!(!o(T)||!o(E)||!confirm(s()("Are you sure you want to delete this item?"))))try{const me=await h.removeManifestItem(o(T),ne.detail.itemId);o(E).workspace=me,o(U)&&o(U).id===ne.detail.itemId&&(y(U,null),y(F,null))}catch(me){console.error("Failed to delete manifest item:",me)}},Ce=async(ne,be)=>{if(!o(E)){console.error("AppState not initialized");return}try{let me;if(ne)me=ne;else if(be){console.log(`Downloading EPUB from: ${be}`);const He=await fetch(be);if(!He.ok)throw new Error(`Failed to download EPUB: ${He.status} ${He.statusText}`);const Je=await He.blob(),at=se(be);me=new File([Je],at,{type:"application/epub+zip"})}else me=await Q();const _e="workspace-"+crypto.randomUUID();console.log(`Importing EPUB: ${me.name} to workspace: ${_e}`);const Pe=await b.unpackEPUB(me,_e);if(!Pe.success)throw new Error(Pe.error||"Failed to unpack EPUB");console.log(`â Successfully imported EPUB: ${Pe.extractedFiles?.length} files extracted`),await o(E).loadWorkspace(_e);const $e=o(E).workspace?.opf?.spine?.[0];$e?(o(E).selectChapter($e.idref),bt.navigateTo("spine")):bt.navigateTo("metadata"),location.hash=""}catch(me){console.error("Failed to import EPUB:",me);const _e=me instanceof Error?me.message:"Unknown error";alert(`Failed to import EPUB: ${_e}`)}},se=ne=>{try{const _e=new URL(ne).pathname.split("/").pop()||"imported-epub.epub";return _e.endsWith(".epub")?_e:`${_e}.epub`}catch{return"imported-epub.epub"}},Q=()=>new Promise((ne,be)=>{const me=document.createElement("input");me.type="file",me.accept=".epub",me.onchange=_e=>{const Pe=_e.target.files?.[0];Pe?ne(Pe):be(new Error("No file selected"))},me.oncancel=()=>{be(new Error("File selection cancelled"))},me.click()}),ve=ne=>{if(!o(E))return;const be=o(E).workspace?.opf?.spine?.[0];be?(o(E).selectChapter(be.idref),bt.navigateTo("spine")):bt.navigateTo("metadata")},Z=async ne=>{if(o(T))try{const be=await h.updateMetadata(o(T),{modifiedDate:pn()});o(E)&&(o(E).workspace=be);const me=await w.packageEPUB(ne,{progressCallback:_e=>{console.log(`Packaging progress: ${_e.phase} - ${_e.processedFiles}/${_e.totalFiles} files`)}});if(me.success&&me.blob&&me.filename)w.downloadEPUB(me.blob,me.filename),console.log(`â Successfully packaged and downloaded: ${me.filename}`);else throw new Error(me.error||"Unknown packaging error")}catch(be){throw console.error("Failed to package EPUB:",be),be}};an(()=>{(async()=>{try{await c.init(),l=new ki(c),k=new mo({fileStorage:c,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),I=new im(k,l),await I.initialize(),y(C,!0),y(E,new nm(c,p,fo,l,d,u,I),!0),await o(E).initialize()}catch(_e){console.error("Failed to initialize app:",_e),y(L,_e instanceof Error?_e.message:"Initialization failed",!0)}})();const ne=_e=>{if(!o(E))return;const Pe=_e;o(E).selectChapter(Pe.detail.itemId),bt.navigateTo("spine")},be=()=>{o(E)&&o(E).selectChapter(null)},me=()=>{const _e=window.location.hash.slice(1);if(_e.startsWith("http"))try{const Pe=decodeURIComponent(_e);console.log(`Hash change detected: importing EPUB from ${Pe}`),Ce(void 0,Pe)}catch(Pe){console.error("Failed to decode URL from hash:",Pe),alert("Invalid URL in hash fragment")}};return window.location.hash&&me(),window.addEventListener("select-spine-item",ne),window.addEventListener("clear-spine-selection",be),window.addEventListener("hashchange",me),()=>{window.removeEventListener("select-spine-item",ne),window.removeEventListener("clear-spine-selection",be),window.removeEventListener("hashchange",me),o(E)?.cleanup(),I?.cleanup()}});var ue=ht();Wl(ne=>{R(()=>ws.title=o(G))});var Fe=Ze(ue);{var je=ne=>{var be=om(),me=g(f(be),2),_e=f(me);R(()=>x(_e,o(L))),_(ne,be)},Ge=(ne,be)=>{{var me=Pe=>{var $e=lm();_(Pe,$e)},_e=(Pe,$e)=>{{var He=at=>{var ce=cm();_(at,ce)},Je=at=>{const ce=oe(()=>!!o(H));su(at,{get hasWorkspace(){return o(ce)},$$slots:{"sidebar-spine":(ke,Ee)=>{var ze=ht(),$=Ze(ze);{var V=te=>{var Te=dm(),q=f(Te),fe=f(q);R(ae=>x(fe,ae),[()=>s()("Loading projectâ¦")]),_(te,Te)},Y=(te,Te)=>{{var q=ae=>{var xe=um(),Ie=f(xe),Ae=f(Ie);R(Le=>x(Ae,Le),[()=>s()("No project selected")]),_(ae,xe)},fe=(ae,xe)=>{{var Ie=Le=>{zh(Le,{get workspace(){return o(T)},get spineService(){return v},get selectedItemId(){return o(W)},get isExpanded(){return o(z)},onWorkspaceUpdate:We=>{o(E)&&(o(E).workspace=We)},onPackageRequested:Z})},Ae=Le=>{var We=fm(),ye=f(We),Oe=f(ye);R(Be=>x(Oe,Be),[()=>s()("Loading projectâ¦")]),_(Le,We)};j(ae,Le=>{o(T)?Le(Ie):Le(Ae,!1)},xe)}};j(te,ae=>{o(T)?ae(fe,!1):ae(q)},Te)}};j($,te=>{o(O)?te(Y,!1):te(V)})}_(ke,ze)},"left-header":(ke,Ee)=>{var ze=ht(),$=Ze(ze);{var V=Y=>{Gv(Y,{get workspace(){return o(T)},get extensionManager(){return l}})};j($,Y=>{o(T)&&o(N)!=="about"&&o(N)!=="workspace"&&o(N)!=="metadata"&&Y(V)})}_(ke,ze)},"left-content":(ke,Ee)=>{var ze=ht(),$=Ze(ze);{var V=te=>{fu(te,{})},Y=(te,Te)=>{{var q=ae=>{Ku(ae,{onListWorkspaces:()=>o(E)?.listWorkspaces()??Promise.resolve([]),onCreateWorkspace:xe=>o(E)?.createWorkspace(xe.title,xe.language)??Promise.resolve(""),onDeleteWorkspace:xe=>o(E)?.deleteWorkspace(xe)??Promise.resolve(),onLoadWorkspace:xe=>o(E)?.loadWorkspace(xe)??Promise.resolve(),onEpubImportRequested:Ce,get currentWorkspaceId(){return o(H)},onNavigationRequested:xe=>{bt.navigateTo(xe)},onSmartNavigationRequested:ve,onWorkspaceOpened:()=>{},onWorkspaceChanged:()=>{}})},fe=(ae,xe)=>{{var Ie=Le=>{var We=ht(),ye=Ze(We);{var Oe=Me=>{Bf(Me,{get metadataService(){return m},get workspace(){return o(E).workspace},set workspace(S){o(E).workspace=S},$$events:{metadataChanged:J}})},Be=Me=>{const S=oe(()=>s()("EPUB Metadata")),K=oe(()=>s()("Configure publication metadata and details"));qr(Me,{viewType:"metadata",get title(){return o(S)},get description(){return o(K)},icon:"ð"})};j(ye,Me=>{o(O)&&o(T)&&o(E)?Me(Oe):Me(Be,!1)})}_(Le,We)},Ae=(Le,We)=>{{var ye=Be=>{var Me=ht(),S=Ze(Me);{var K=Se=>{_v(Se,{get workspace(){return o(T)},get workspaceService(){return h},get advancedMode(){return o(E).isAdvancedMode},onItemSelect:le})},re=Se=>{const De=oe(()=>s()("File Manifest")),A=oe(()=>s()("Manage EPUB files and resources"));qr(Se,{viewType:"manifest",get title(){return o(De)},get description(){return o(A)},icon:"ð"})};j(S,Se=>{o(O)&&o(T)?Se(K):Se(re,!1)})}_(Be,Me)},Oe=(Be,Me)=>{{var S=re=>{var Se=ht(),De=Ze(Se);{var A=ie=>{jv(ie,{get workspace(){return o(T)},get workspaceService(){return h},get spineService(){return v},$$events:{previewUpdate:ge}})},ee=ie=>{const Re=oe(()=>s()("Table of Contents")),qe=oe(()=>s()("Loading projectâ¦"));qr(ie,{viewType:"navigation",get title(){return o(Re)},get description(){return o(qe)},icon:"ð"})};j(De,ie=>{o(O)&&o(T)?ie(A):ie(ee,!1)})}_(re,Se)},K=(re,Se)=>{{var De=ee=>{var ie=ht(),Re=Ze(ie);{var qe=tt=>{const ct=oe(()=>o(E).getTransformEngine()),it=oe(()=>o(E).getContentService());eh(tt,{get workspace(){return o(T)},get workspaceService(){return h},get spineService(){return v},get selectedItemId(){return o(W)},get transformEngine(){return o(ct)},get contentService(){return o(it)},$$events:{previewUpdate:X}})},Ve=tt=>{const ct=oe(()=>s()("Spine Items")),it=oe(()=>s()("Loading projectâ¦"));qr(tt,{viewType:"spine",get title(){return o(ct)},get description(){return o(it)},icon:"ð"})};j(Re,tt=>{o(O)&&o(T)&&o(E)?tt(qe):tt(Ve,!1)})}_(ee,ie)},A=(ee,ie)=>{{var Re=Ve=>{const tt=oe(()=>o(E).getSettingsService()),ct=oe(()=>o(E).getExtensionManager()),it=oe(()=>o(E).getTransformEngine());mh(Ve,{get settingsService(){return o(tt)},get extensionManager(){return o(ct)},get transformEngine(){return o(it)},get workspaceId(){return o(E).currentWorkspaceId},onSettingsChanged:()=>{o(E)?.currentWorkspaceId&&o(E).loadWorkspaceSettings(o(E).currentWorkspaceId)}})},qe=Ve=>{var tt=pm(),ct=f(tt),it=f(ct),Dt=g(ct,2),Gt=f(Dt);R((Tn,jt)=>{x(it,Tn),x(Gt,`${jt??""}: ${o(N)??""}`)},[()=>s()("Unknown View"),()=>s()("View type")]),_(Ve,tt)};j(ee,Ve=>{o(N)==="settings"?Ve(Re):Ve(qe,!1)},ie)}};j(re,ee=>{o(N)==="spine"?ee(De):ee(A,!1)},Se)}};j(Be,re=>{o(N)==="navigation"?re(S):re(K,!1)},Me)}};j(Le,Be=>{o(N)==="manifest"?Be(ye):Be(Oe,!1)},We)}};j(ae,Le=>{o(N)==="metadata"?Le(Ie):Le(Ae,!1)},xe)}};j(te,ae=>{o(N)==="workspace"&&o(O)?ae(q):ae(fe,!1)},Te)}};j($,te=>{o(N)==="about"?te(V):te(Y,!1)})}_(ke,ze)},"right-content":(ke,Ee)=>{var ze=ht(),$=Ze(ze);{var V=te=>{mu(te,{})},Y=(te,Te)=>{{var q=ae=>{Ov(ae,{get selectedItem(){return o(U)},get selectedItemType(){return o(F)},get workspace(){return o(T)},get workspaceService(){return h},$$events:{itemDelete:he}})},fe=(ae,xe)=>{{var Ie=Le=>{var We=ht(),ye=Ze(We);{var Oe=Me=>{$v(Me,{get content(){return o(D)}})},Be=Me=>{var S=hm(),K=f(S),re=f(K),Se=g(K,2),De=f(Se);R((A,ee)=>{x(re,A),x(De,ee)},[()=>s()("Navigation Preview"),()=>s()("Generating navigation from chapters...")]),_(Me,S)};j(ye,Me=>{o(D)?Me(Oe):Me(Be,!1)})}_(Le,We)},Ae=(Le,We)=>{{var ye=Be=>{var Me=ht(),S=Ze(Me);{var K=Se=>{Wp(Se,{get xhtmlContent(){return o(M).xhtmlContent},get isTransforming(){return o(M).isTransforming},get transformError(){return o(M).transformError},get transformWarnings(){return o(M).transformWarnings},get executionTime(){return o(M).executionTime},get spineItemId(){return o(M).spineItemId},onPreviewClick:we})},re=Se=>{var De=vm(),A=f(De),ee=f(A),ie=g(A,2),Re=f(ie);R((qe,Ve)=>{x(ee,qe),x(Re,Ve)},[()=>s()("Spine Preview"),()=>s()("Select a spine item to see the preview here")]),_(Se,De)};j(S,Se=>{o(M).spineItemId?Se(K):Se(re,!1)})}_(Be,Me)},Oe=Be=>{var Me=mm(),S=f(Me),K=f(S),re=g(S,2),Se=f(re),De=g(re,2),A=f(De),ee=g(A),ie=f(ee);R((Re,qe,Ve)=>{x(K,Re),x(Se,qe),x(A,`${Ve??""}: `),x(ie,o(N))},[()=>s()("Preview Pane"),()=>s()("Content preview will appear here based on the current view"),()=>s()("Current view")]),_(Be,Me)};j(Le,Be=>{o(N)==="spine"?Be(ye):Be(Oe,!1)},We)}};j(ae,Le=>{o(N)==="navigation"?Le(Ie):Le(Ae,!1)},xe)}};j(te,ae=>{o(N)==="manifest"&&o(O)&&o(T)?ae(q):ae(fe,!1)},Te)}};j($,te=>{o(N)==="about"?te(V):te(Y,!1)})}_(ke,ze)}}})};j(Pe,at=>{o(E)?at(Je,!1):at(He)},$e)}};j(ne,Pe=>{o(C)?Pe(_e,!1):Pe(me)},be)}};j(Fe,ne=>{o(L)?ne(je):ne(Ge,!1)})}_(r,ue),et(),a()}uo().catch(r=>{console.error("Failed to initialize i18n:",r)});jl(gm,{target:document.getElementById("app")});</script>
    <style rel="stylesheet" crossorigin>:root{--color-neutral-50: #ffffff;--color-neutral-100: #f8f8f8;--color-neutral-200: #f0f0f0;--color-neutral-300: #e0e0e0;--color-neutral-400: #cccccc;--color-neutral-500: #999999;--color-neutral-600: #666666;--color-neutral-700: #444444;--color-neutral-800: #333333;--color-neutral-900: #222222;--color-neutral-950: #000000;--color-primary-50: #f0f0ff;--color-primary-100: #e6e6ff;--color-primary-200: #ccccff;--color-primary-300: #9999ff;--color-primary-400: #6666ff;--color-primary-500: #3333ff;--color-primary-600: #0000ee;--color-primary-700: #0000cc;--color-primary-800: #0000aa;--color-primary-900: #000088;--color-primary-950: #000066;--color-success-50: #f0fdf4;--color-success-100: #e6f5e6;--color-success-200: #cceecc;--color-success-300: #99dd99;--color-success-400: #66cc66;--color-success-500: #33bb33;--color-success-600: #22aa22;--color-success-700: #118811;--color-success-800: #006600;--color-success-900: #005500;--color-success-950: #004400;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-200: #fde68a;--color-warning-300: #fcd34d;--color-warning-400: #fbbf24;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-warning-800: #92400e;--color-warning-900: #78350f;--color-warning-950: #451a03;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-200: #fecaca;--color-error-300: #fca5a5;--color-error-400: #f87171;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-error-800: #991b1b;--color-error-900: #7f1d1d;--color-error-950: #450a0a;--color-white: #ffffff;--color-black: #000000;--color-transparent: transparent;--color-link-visited: #551a8b;--color-craigslist-bg: #f0f0f0;--color-craigslist-border: #ccc;--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-craigslist-bg);--color-bg-tertiary: var(--color-neutral-100);--color-bg-quaternary: var(--color-neutral-200);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-text-link-visited: var(--color-link-visited);--color-border-default: var(--color-craigslist-border);--color-border-strong: var(--color-neutral-400);--color-border-subtle: var(--color-neutral-300);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-success-600);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-primary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-neutral-100);--color-sidebar-item-active: var(--color-neutral-200);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-neutral-100);--color-button-primary-bg-hover: var(--color-neutral-200);--color-button-primary-text: var(--color-text-primary);--color-button-primary-border: var(--color-neutral-400);--color-button-secondary-bg: var(--color-white);--color-button-secondary-bg-hover: var(--color-neutral-100);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-success-600);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-input-border-active: var(--color-success-600);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-forced-bg: Canvas;--color-forced-text: CanvasText;--color-forced-border: ButtonBorder;--color-forced-link: LinkText;--color-forced-visited: VisitedText;--color-forced-active: ActiveText;--color-forced-button-face: ButtonFace;--color-forced-button-text: ButtonText;--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-forced-text);--color-bg-primary: var(--color-forced-bg);--color-border-default: var(--color-forced-border);--color-text-link: var(--color-forced-link);--color-focus: var(--color-forced-active)}}:root{--space-0: 0;--space-px: 1px;--space-0-5: .125rem;--space-1: .25rem;--space-1-5: .375rem;--space-2: .5rem;--space-2-5: .625rem;--space-3: .75rem;--space-3-5: .875rem;--space-4: 1rem;--space-5: 1.25rem;--space-6: 1.5rem;--space-7: 1.75rem;--space-8: 2rem;--space-9: 2.25rem;--space-10: 2.5rem;--space-11: 2.75rem;--space-12: 3rem;--space-14: 3.5rem;--space-16: 4rem;--space-20: 5rem;--space-24: 6rem;--space-28: 7rem;--space-32: 8rem;--space-36: 9rem;--space-40: 10rem;--space-44: 11rem;--space-48: 12rem;--space-52: 13rem;--space-56: 14rem;--space-60: 15rem;--space-64: 16rem;--space-72: 18rem;--space-80: 20rem;--space-96: 24rem;--spacing-component-xs: var(--space-0-5);--spacing-component-sm: var(--space-1);--spacing-component-md: var(--space-2);--spacing-component-lg: var(--space-3);--spacing-component-xl: var(--space-4);--spacing-layout-xs: var(--space-1);--spacing-layout-sm: var(--space-2);--spacing-layout-md: var(--space-3);--spacing-layout-lg: var(--space-4);--spacing-layout-xl: var(--space-6);--spacing-content-xs: var(--space-2);--spacing-content-sm: var(--space-3);--spacing-content-md: var(--space-4);--spacing-content-lg: var(--space-5);--spacing-content-xl: var(--space-6);--layout-sidebar-width-expanded: 250px;--layout-sidebar-width-collapsed: 40px;--layout-header-height: 60px;--layout-header-padding: var(--space-4);--layout-content-padding: var(--space-3);--layout-content-max-width: 960px;--layout-content-gap: var(--space-2);--layout-panel-padding-block: var(--space-3);--layout-panel-padding-inline: var(--space-3);--layout-panel-gap: var(--space-2);--layout-panel-border-radius: var(--radius-none);--layout-resize-handle-width: 4px;--layout-resize-handle-hover-width: 6px;--form-field-spacing: var(--space-2);--form-group-spacing: var(--space-3);--form-section-spacing: var(--space-4);--list-item-padding-block: var(--space-1);--list-item-padding-inline: var(--space-1);--list-item-gap: var(--space-1);--list-section-gap: var(--space-3);--card-padding-block: var(--space-3);--card-padding-inline: var(--space-3);--card-gap: var(--space-2);--card-header-padding-block: var(--space-2);--card-header-padding-inline: var(--space-2);--button-padding-inline: var(--space-2);--button-padding-block: var(--space-1);--button-gap: var(--space-1);--layout-direction: ltr;--content-align-start: left;--content-align-end: right;--focus-ring-width: 2px;--focus-ring-offset: 2px;--focus-ring-style: solid;--touch-target-min: 44px;--touch-target-spacing: var(--space-2);--sr-only-clip: rect(0, 0, 0, 0);--radius-none: 0;--radius-xs: .0625rem;--radius-sm: .125rem;--radius-md: .1875rem;--radius-lg: .25rem;--radius-xl: .375rem;--radius-2xl: .5rem;--radius-3xl: .75rem;--radius-full: 9999px;--radius-button: var(--radius-sm);--radius-input: var(--radius-xs);--radius-card: var(--radius-none);--radius-panel: var(--radius-none);--radius-modal: var(--radius-sm);--radius-tooltip: var(--radius-none);--breakpoint-sm: 640px;--breakpoint-md: 768px;--breakpoint-lg: 1024px;--breakpoint-xl: 1280px;--breakpoint-2xl: 1536px;--container-sm: 640px;--container-md: 768px;--container-lg: 1024px;--container-xl: 1280px;--container-2xl: 1536px;--container-full: 100%}[data-dir=rtl]{--layout-direction: rtl;--content-align-start: right;--content-align-end: left}:root{--font-sans: Helvetica, Arial, sans-serif;--font-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;--font-serif: Georgia, "Times New Roman", Times, serif;--text-xs: .6875rem;--text-sm: .8125rem;--text-base: .875rem;--text-lg: 1rem;--text-xl: 1.125rem;--text-2xl: 1.25rem;--text-3xl: 1.5rem;--text-4xl: 1.875rem;--text-5xl: 2.25rem;--text-6xl: 3rem;--text-7xl: 3.75rem;--text-8xl: 4.5rem;--text-9xl: 6rem;--font-thin: 100;--font-extralight: 200;--font-light: 300;--font-normal: 400;--font-medium: 500;--font-semibold: 600;--font-bold: 700;--font-extrabold: 800;--font-black: 900;--leading-none: 1;--leading-tight: 1.2;--leading-snug: 1.3;--leading-normal: 1.4;--leading-relaxed: 1.5;--leading-loose: 1.6;--leading-xs: 1rem;--leading-sm: 1.25rem;--leading-base: 1.5rem;--leading-lg: 1.75rem;--leading-xl: 1.75rem;--leading-2xl: 2rem;--leading-3xl: 2.25rem;--leading-4xl: 2.5rem;--leading-5xl: 1;--leading-6xl: 1;--leading-7xl: 1;--leading-8xl: 1;--leading-9xl: 1;--tracking-tighter: -.05em;--tracking-tight: -.025em;--tracking-normal: 0em;--tracking-wide: .025em;--tracking-wider: .05em;--tracking-widest: .1em;--text-display-2xl: var(--text-5xl);--text-display-xl: var(--text-4xl);--text-display-lg: var(--text-3xl);--text-display-md: var(--text-2xl);--text-display-sm: var(--text-xl);--text-heading-2xl: var(--text-4xl);--text-heading-xl: var(--text-3xl);--text-heading-lg: var(--text-2xl);--text-heading-md: var(--text-xl);--text-heading-sm: var(--text-lg);--text-heading-xs: var(--text-base);--text-body-xl: var(--text-xl);--text-body-lg: var(--text-lg);--text-body-md: var(--text-base);--text-body-sm: var(--text-sm);--text-body-xs: var(--text-xs);--text-label-lg: var(--text-sm);--text-label-md: var(--text-xs);--text-label-sm: var(--text-xs);--button-text-lg: var(--text-base);--button-text-md: var(--text-sm);--button-text-sm: var(--text-xs);--button-font-weight: var(--font-normal);--button-letter-spacing: var(--tracking-normal);--input-text-size: var(--text-base);--input-font-weight: var(--font-normal);--input-letter-spacing: var(--tracking-normal);--input-placeholder-weight: var(--font-normal);--nav-text-size: var(--text-base);--nav-font-weight: var(--font-normal);--nav-letter-spacing: var(--tracking-normal);--sidebar-text-size: var(--text-sm);--sidebar-font-weight: var(--font-normal);--sidebar-heading-weight: var(--font-semibold);--sidebar-letter-spacing: var(--tracking-normal);--code-text-size: var(--text-sm);--code-font-family: var(--font-mono);--code-font-weight: var(--font-normal);--code-letter-spacing: var(--tracking-normal);--code-line-height: var(--leading-relaxed);--caption-text-size: var(--text-xs);--caption-font-weight: var(--font-normal);--caption-letter-spacing: var(--tracking-normal);--caption-line-height: var(--leading-normal);--text-decoration-none: none;--text-decoration-underline: underline;--text-decoration-line-through: line-through;--link-text-decoration: underline;--link-text-decoration-hover: underline;--link-underline-offset: .1em;--text-transform-none: none;--text-transform-uppercase: uppercase;--text-transform-lowercase: lowercase;--text-transform-capitalize: capitalize;--editor-font-family: var(--font-serif);--editor-text-size: var(--text-base);--editor-line-height: var(--leading-relaxed);--editor-letter-spacing: var(--tracking-normal);--editor-font-weight: var(--font-normal);--preview-font-family: var(--font-serif);--preview-text-size: var(--text-base);--preview-line-height: var(--leading-relaxed);--preview-letter-spacing: var(--tracking-normal);--metadata-font-family: var(--font-sans);--metadata-text-size: var(--text-sm);--metadata-line-height: var(--leading-normal);--metadata-label-weight: var(--font-medium)}:root{--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-none: none;--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);--z-base: 0;--z-raised: 10;--z-overlay: 20;--z-sticky: 30;--z-fixed: 40;--z-dropdown: 1000;--z-tooltip: 1100;--z-modal-backdrop: 1200;--z-modal: 1300;--z-popover: 1400;--z-toast: 1500;--z-loading: 1600;--z-maximum: 9999;--elevation-card-flat: var(--shadow-none);--elevation-card-raised: var(--shadow-sm);--elevation-card-floating: var(--shadow-md);--elevation-card-elevated: var(--shadow-lg);--elevation-panel-flat: var(--shadow-none);--elevation-panel-inset: var(--shadow-inner);--elevation-panel-raised: var(--shadow-sm);--elevation-panel-floating: var(--shadow-lg);--elevation-button-flat: var(--shadow-none);--elevation-button-raised: var(--shadow-sm);--elevation-button-hover: var(--shadow-md);--elevation-button-active: var(--shadow-xs);--elevation-input-flat: var(--shadow-none);--elevation-input-inset: var(--shadow-inner);--elevation-input-focus: var(--shadow-focus-primary);--elevation-nav-flat: var(--shadow-none);--elevation-nav-floating: var(--shadow-md);--elevation-nav-sticky: var(--shadow-sm);--elevation-modal-backdrop: var(--shadow-none);--elevation-modal: var(--shadow-2xl);--elevation-tooltip: var(--shadow-lg);--elevation-dropdown: var(--shadow-lg);--elevation-sidebar: var(--shadow-sm);--elevation-sidebar-floating: var(--shadow-md);--elevation-header: var(--shadow-sm);--elevation-header-floating: var(--shadow-md);--elevation-content-primary: var(--shadow-none);--elevation-content-secondary: var(--shadow-sm);--elevation-resize-handle: var(--shadow-none);--elevation-resize-handle-hover: var(--shadow-sm);--border-width-0: 0;--border-width-1: 1px;--border-width-2: 2px;--border-width-4: 4px;--border-width-8: 8px;--border-style-solid: solid;--border-style-dashed: dashed;--border-style-dotted: dotted;--border-style-none: none;--border-default: var(--border-width-1) var(--border-style-solid) var(--color-border-default);--border-strong: var(--border-width-1) var(--border-style-solid) var(--color-border-strong);--border-accent: var(--border-width-1) var(--border-style-solid) var(--color-border-accent);--border-focus: var(--border-width-2) var(--border-style-solid) var(--color-border-focus);--opacity-0: 0;--opacity-5: .05;--opacity-10: .1;--opacity-20: .2;--opacity-25: .25;--opacity-30: .3;--opacity-40: .4;--opacity-50: .5;--opacity-60: .6;--opacity-70: .7;--opacity-75: .75;--opacity-80: .8;--opacity-90: .9;--opacity-95: .95;--opacity-100: 1;--opacity-disabled: var(--opacity-50);--opacity-hover: var(--opacity-80);--opacity-loading: var(--opacity-60);--opacity-overlay: var(--opacity-50);--opacity-backdrop: var(--opacity-75)}:root{--duration-instant: 0ms;--duration-fast: .15s;--duration-normal: .25s;--duration-slow: .35s;--duration-slower: .5s;--duration-slowest: .75s;--duration-tooltip: var(--duration-fast);--duration-button-hover: var(--duration-fast);--duration-input-focus: var(--duration-fast);--duration-dropdown: var(--duration-normal);--duration-modal: var(--duration-normal);--duration-sidebar-toggle: var(--duration-normal);--duration-theme-switch: var(--duration-normal);--duration-page-transition: var(--duration-slow);--duration-loading: var(--duration-slower);--ease-linear: linear;--ease-in: cubic-bezier(.4, 0, 1, 1);--ease-out: cubic-bezier(0, 0, .2, 1);--ease-in-out: cubic-bezier(.4, 0, .2, 1);--ease-elastic: cubic-bezier(.68, -.55, .265, 1.55);--ease-bounce: cubic-bezier(.175, .885, .32, 1.275);--ease-smooth: cubic-bezier(.25, .1, .25, 1);--ease-sharp: cubic-bezier(.4, 0, .6, 1);--ease-ui-out: var(--ease-out);--ease-ui-in: var(--ease-in);--ease-ui-in-out: var(--ease-in-out);--ease-ui-smooth: var(--ease-smooth);--transition-colors: color var(--duration-fast) var(--ease-ui-out), background-color var(--duration-fast) var(--ease-ui-out), border-color var(--duration-fast) var(--ease-ui-out);--transition-opacity: opacity var(--duration-fast) var(--ease-ui-out);--transition-transform: transform var(--duration-fast) var(--ease-ui-out);--transition-shadow: box-shadow var(--duration-fast) var(--ease-ui-out);--transition-size: width var(--duration-normal) var(--ease-ui-out), height var(--duration-normal) var(--ease-ui-out);--transition-button: var(--transition-colors), var(--transition-shadow), transform var(--duration-button-hover) var(--ease-ui-out);--transition-input: var(--transition-colors), border-color var(--duration-input-focus) var(--ease-ui-out), box-shadow var(--duration-input-focus) var(--ease-ui-out);--transition-panel: var(--transition-colors), var(--transition-shadow);--transition-modal: opacity var(--duration-modal) var(--ease-ui-out), transform var(--duration-modal) var(--ease-ui-out);--transition-dropdown: opacity var(--duration-dropdown) var(--ease-ui-out), transform var(--duration-dropdown) var(--ease-ui-out);--transition-sidebar: width var(--duration-sidebar-toggle) var(--ease-ui-out);--transition-resize: all var(--duration-fast) var(--ease-ui-out);--transition-theme: background-color var(--duration-theme-switch) var(--ease-ui-out), color var(--duration-theme-switch) var(--ease-ui-out), border-color var(--duration-theme-switch) var(--ease-ui-out), box-shadow var(--duration-theme-switch) var(--ease-ui-out);--animation-spin: spin 1s linear infinite;--animation-ping: ping 1s cubic-bezier(0, 0, .2, 1) infinite;--animation-pulse: pulse 2s cubic-bezier(.4, 0, .6, 1) infinite;--animation-bounce: bounce 1s infinite;--animation-fade-in: fadeIn var(--duration-normal) var(--ease-ui-out);--animation-slide-in-up: slideInUp var(--duration-normal) var(--ease-ui-out);--animation-slide-in-down: slideInDown var(--duration-normal) var(--ease-ui-out);--animation-slide-in-left: slideInLeft var(--duration-normal) var(--ease-ui-out);--animation-slide-in-right: slideInRight var(--duration-normal) var(--ease-ui-out);--animation-scale-in: scaleIn var(--duration-normal) var(--ease-ui-out);--animation-fade-out: fadeOut var(--duration-normal) var(--ease-ui-in);--animation-slide-out-up: slideOutUp var(--duration-normal) var(--ease-ui-in);--animation-slide-out-down: slideOutDown var(--duration-normal) var(--ease-ui-in);--animation-slide-out-left: slideOutLeft var(--duration-normal) var(--ease-ui-in);--animation-slide-out-right: slideOutRight var(--duration-normal) var(--ease-ui-in);--animation-scale-out: scaleOut var(--duration-normal) var(--ease-ui-in);@media (prefers-reduced-motion: reduce){:root{--duration-fast: 50ms;--duration-normal: .1s;--duration-slow: .15s;--duration-slower: .2s;--duration-slowest: .25s;--ease-ui-out: ease;--ease-ui-in: ease;--ease-ui-in-out: ease;--ease-ui-smooth: ease;--animation-spin: none;--animation-ping: none;--animation-pulse: none;--animation-bounce: none}}--layout-transition-duration: var(--duration-normal);--layout-transition-easing: var(--ease-ui-out);--nav-transition-duration: var(--duration-fast);--nav-transition-easing: var(--ease-ui-out);--content-transition-duration: var(--duration-normal);--content-transition-easing: var(--ease-ui-out);--interactive-hover-duration: var(--duration-fast);--interactive-focus-duration: var(--duration-fast);--interactive-active-duration: var(--duration-instant)}*,*:before,*:after{transition:var(--transition-theme)}.theme-initializing *,.theme-initializing *:before,.theme-initializing *:after{transition:none!important}:root{color-scheme:light}[data-theme=dark]{color-scheme:dark}[data-theme=auto]{color-scheme:light dark}::-webkit-scrollbar-track{background:var(--color-bg-secondary)}::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-full)}::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}*{scrollbar-width:thin;scrollbar-color:var(--color-border-strong) var(--color-bg-secondary)}::selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}::-moz-selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}*:focus{outline:none}*:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex]:focus-visible{box-shadow:var(--shadow-focus-primary)}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-black);--color-text-secondary: var(--color-neutral-800);--color-bg-primary: var(--color-white);--color-border-default: var(--color-neutral-900);--color-border-focus: var(--color-primary-900)}[data-theme=dark]{--color-text-primary: var(--color-white);--color-text-secondary: var(--color-neutral-200);--color-bg-primary: var(--color-black);--color-border-default: var(--color-white);--color-border-focus: var(--color-primary-300)}}@media print{*{color:#000!important;background:#fff!important;box-shadow:none!important}button,.nav,.sidebar,[role=navigation]{display:none!important}}@media (prefers-reduced-motion: reduce){*,*:before,*:after{transition:none!important;animation:none!important}*:focus-visible{transition:box-shadow .1s ease!important}}.theme-loading{visibility:hidden}.theme-loaded{visibility:visible}.theme-ready{transition:var(--transition-theme)}a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex="0"]:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}[data-theme=light]{--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-neutral-100);--color-bg-tertiary: var(--color-neutral-200);--color-bg-quaternary: var(--color-neutral-300);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-border-default: var(--color-neutral-200);--color-border-strong: var(--color-neutral-300);--color-border-subtle: var(--color-neutral-100);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-300);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-primary-500);--color-border-hover: var(--color-neutral-300);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-secondary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-bg-tertiary);--color-sidebar-item-active: var(--color-bg-accent);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-interactive-primary);--color-button-primary-bg-hover: var(--color-interactive-primary-hover);--color-button-primary-text: var(--color-text-inverse);--color-button-secondary-bg: var(--color-interactive-secondary);--color-button-secondary-bg-hover: var(--color-interactive-secondary-hover);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-border-focus);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb;--color-surface-disabled: var(--color-neutral-100);--color-text-disabled: var(--color-neutral-400);--color-surface-hover: var(--color-neutral-50);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);color-scheme:light}@media (prefers-color-scheme: light){:root:not([data-theme]){color-scheme:light}}[data-theme=dark]{--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);--color-border-hover: var(--color-neutral-600);--color-interactive-primary: var(--color-primary-500);--color-interactive-primary-hover: var(--color-primary-400);--color-interactive-primary-active: var(--color-primary-600);--color-interactive-secondary: var(--color-neutral-800);--color-interactive-secondary-hover: var(--color-neutral-700);--color-interactive-secondary-active: var(--color-neutral-600);--color-interactive-disabled: var(--color-neutral-700);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-neutral-900);--color-surface-secondary: var(--color-neutral-800);--color-surface-tertiary: var(--color-neutral-700);--color-surface-overlay: rgba(0, 0, 0, .8);--color-surface-elevated: var(--color-neutral-800);--color-sidebar-bg: var(--color-neutral-900);--color-sidebar-border: var(--color-neutral-700);--color-sidebar-item-hover: var(--color-neutral-800);--color-sidebar-item-active: var(--color-neutral-700);--color-sidebar-text: var(--color-neutral-100);--color-sidebar-text-secondary: var(--color-neutral-400);--color-button-primary-bg: var(--color-primary-600);--color-button-primary-bg-hover: var(--color-primary-500);--color-button-primary-text: var(--color-white);--color-button-secondary-bg: var(--color-neutral-800);--color-button-secondary-bg-hover: var(--color-neutral-700);--color-button-secondary-text: var(--color-neutral-100);--color-button-secondary-border: var(--color-neutral-600);--color-input-bg: var(--color-neutral-800);--color-input-border: var(--color-neutral-600);--color-input-border-focus: var(--color-primary-400);--color-input-text: var(--color-neutral-100);--color-input-placeholder: var(--color-neutral-400);--color-status-success: var(--color-success-400);--color-status-warning: var(--color-warning-400);--color-status-error: var(--color-error-400);--color-status-info: var(--color-primary-400);--color-focus: var(--color-primary-400);--color-focus-ring: var(--color-primary-300);--color-error-text: #fca5a5;--color-error-bg: var(--color-error-950);--color-success-text: #86efac;--color-success-bg: var(--color-success-950);--color-warning-text: #fcd34d;--color-warning-bg: var(--color-warning-950);--color-surface-disabled: var(--color-neutral-800);--color-text-disabled: var(--color-neutral-500);--color-surface-hover: var(--color-neutral-700);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .3);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .4), 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .4), 0 2px 4px rgba(0, 0, 0, .3);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4), 0 4px 6px rgba(0, 0, 0, .2);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .4), 0 10px 10px rgba(0, 0, 0, .2);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .6);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .4);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .4);--shadow-success: 0 4px 14px rgba(34, 197, 94, .4);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .4);--shadow-error: 0 4px 14px rgba(239, 68, 68, .4);--shadow-focus-primary: 0 0 0 3px rgba(96, 165, 250, .3);--shadow-focus-success: 0 0 0 3px rgba(74, 222, 128, .3);--shadow-focus-warning: 0 0 0 3px rgba(251, 191, 36, .3);--shadow-focus-error: 0 0 0 3px rgba(248, 113, 113, .3)}@media (prefers-color-scheme: dark){:root:not([data-theme]){--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);color-scheme:dark}}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.inline-grid{display:inline-grid}.table{display:table}.table-cell{display:table-cell}.table-row{display:table-row}.hidden{display:none}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.inset-auto{inset:auto}.inset-inline-0{inset-inline:0}.inset-inline-auto{inset-inline:auto}.inset-block-0{inset-block:0}.inset-block-auto{inset-block:auto}.start-0{inset-inline-start:0}.start-auto{inset-inline-start:auto}.end-0{inset-inline-end:0}.end-auto{inset-inline-end:auto}.top-0{inset-block-start:0}.top-auto{inset-block-start:auto}.bottom-0{inset-block-end:0}.bottom-auto{inset-block-end:auto}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.flex-wrap-reverse{flex-wrap:wrap-reverse}.flex-nowrap{flex-wrap:nowrap}.flex-1{flex:1 1 0%}.flex-auto{flex:1 1 auto}.flex-initial{flex:0 1 auto}.flex-none{flex:none}.flex-grow{flex-grow:1}.flex-grow-0{flex-grow:0}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.justify-evenly{justify-content:space-evenly}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-evenly{align-content:space-evenly}.self-auto{align-self:auto}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-stretch{align-self:stretch}.self-baseline{align-self:baseline}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.grid-cols-none{grid-template-columns:none}.grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}.grid-rows-3{grid-template-rows:repeat(3,minmax(0,1fr))}.grid-rows-4{grid-template-rows:repeat(4,minmax(0,1fr))}.grid-rows-5{grid-template-rows:repeat(5,minmax(0,1fr))}.grid-rows-6{grid-template-rows:repeat(6,minmax(0,1fr))}.grid-rows-none{grid-template-rows:none}.col-auto{grid-column:auto}.col-span-1{grid-column:span 1 / span 1}.col-span-2{grid-column:span 2 / span 2}.col-span-3{grid-column:span 3 / span 3}.col-span-4{grid-column:span 4 / span 4}.col-span-5{grid-column:span 5 / span 5}.col-span-6{grid-column:span 6 / span 6}.col-span-full{grid-column:1 / -1}.row-auto{grid-row:auto}.row-span-1{grid-row:span 1 / span 1}.row-span-2{grid-row:span 2 / span 2}.row-span-3{grid-row:span 3 / span 3}.row-span-4{grid-row:span 4 / span 4}.row-span-5{grid-row:span 5 / span 5}.row-span-6{grid-row:span 6 / span 6}.row-span-full{grid-row:1 / -1}.gap-0{gap:0}.gap-1{gap:var(--space-1)}.gap-2{gap:var(--space-2)}.gap-3{gap:var(--space-3)}.gap-4{gap:var(--space-4)}.gap-5{gap:var(--space-5)}.gap-6{gap:var(--space-6)}.gap-8{gap:var(--space-8)}.gap-10{gap:var(--space-10)}.gap-12{gap:var(--space-12)}.gap-x-0{column-gap:0}.gap-x-1{column-gap:var(--space-1)}.gap-x-2{column-gap:var(--space-2)}.gap-x-3{column-gap:var(--space-3)}.gap-x-4{column-gap:var(--space-4)}.gap-x-5{column-gap:var(--space-5)}.gap-x-6{column-gap:var(--space-6)}.gap-x-8{column-gap:var(--space-8)}.gap-y-0{row-gap:0}.gap-y-1{row-gap:var(--space-1)}.gap-y-2{row-gap:var(--space-2)}.gap-y-3{row-gap:var(--space-3)}.gap-y-4{row-gap:var(--space-4)}.gap-y-5{row-gap:var(--space-5)}.gap-y-6{row-gap:var(--space-6)}.gap-y-8{row-gap:var(--space-8)}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-clip{overflow:clip}.overflow-visible{overflow:visible}.overflow-scroll{overflow:scroll}.overflow-x-auto{overflow-x:auto}.overflow-x-hidden{overflow-x:hidden}.overflow-x-clip{overflow-x:clip}.overflow-x-visible{overflow-x:visible}.overflow-x-scroll{overflow-x:scroll}.overflow-y-auto{overflow-y:auto}.overflow-y-hidden{overflow-y:hidden}.overflow-y-clip{overflow-y:clip}.overflow-y-visible{overflow-y:visible}.overflow-y-scroll{overflow-y:scroll}.container{width:100%;margin-left:auto;margin-right:auto}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.box-border{box-sizing:border-box}.box-content{box-sizing:content-box}.float-start{float:inline-start}.float-end{float:inline-end}.float-none{float:none}.clear-start{clear:inline-start}.clear-end{clear:inline-end}.clear-both{clear:both}.clear-none{clear:none}.isolate{isolation:isolate}.isolation-auto{isolation:auto}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.object-fill{object-fit:fill}.object-none{object-fit:none}.object-scale-down{object-fit:scale-down}.object-bottom{object-position:bottom}.object-center{object-position:center}.object-start{object-position:left}.object-start-bottom{object-position:left bottom}.object-start-top{object-position:left top}.object-end{object-position:right}.object-end-bottom{object-position:right bottom}.object-end-top{object-position:right top}.object-top{object-position:top}[data-dir=rtl] .object-start{object-position:right}[data-dir=rtl] .object-start-bottom{object-position:right bottom}[data-dir=rtl] .object-start-top{object-position:right top}[data-dir=rtl] .object-end{object-position:left}[data-dir=rtl] .object-end-bottom{object-position:left bottom}[data-dir=rtl] .object-end-top{object-position:left top}.text-start{text-align:start}.text-end{text-align:end}.text-center{text-align:center}.text-justify{text-align:justify}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:var(--sr-only-clip);white-space:nowrap;border:0}.sr-only-focusable:focus,.sr-only-focusable:active{position:static;width:auto;height:auto;padding:inherit;margin:inherit;overflow:visible;clip:auto;white-space:inherit}.focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.touch-target{min-width:var(--touch-target-min);min-height:var(--touch-target-min)}.m-0{margin:0}.m-1{margin:var(--space-1)}.m-2{margin:var(--space-2)}.m-3{margin:var(--space-3)}.m-4{margin:var(--space-4)}.m-5{margin:var(--space-5)}.m-6{margin:var(--space-6)}.m-8{margin:var(--space-8)}.m-auto{margin:auto}.mx-0{margin-inline:0}.mx-1{margin-inline:var(--space-1)}.mx-2{margin-inline:var(--space-2)}.mx-3{margin-inline:var(--space-3)}.mx-4{margin-inline:var(--space-4)}.mx-5{margin-inline:var(--space-5)}.mx-6{margin-inline:var(--space-6)}.mx-8{margin-inline:var(--space-8)}.mx-auto{margin-inline:auto}.my-0{margin-block:0}.my-1{margin-block:var(--space-1)}.my-2{margin-block:var(--space-2)}.my-3{margin-block:var(--space-3)}.my-4{margin-block:var(--space-4)}.my-5{margin-block:var(--space-5)}.my-6{margin-block:var(--space-6)}.my-8{margin-block:var(--space-8)}.my-auto{margin-block:auto}.ms-0{margin-inline-start:0}.ms-1{margin-inline-start:var(--space-1)}.ms-2{margin-inline-start:var(--space-2)}.ms-3{margin-inline-start:var(--space-3)}.ms-4{margin-inline-start:var(--space-4)}.ms-5{margin-inline-start:var(--space-5)}.ms-6{margin-inline-start:var(--space-6)}.ms-8{margin-inline-start:var(--space-8)}.ms-auto{margin-inline-start:auto}.me-0{margin-inline-end:0}.me-1{margin-inline-end:var(--space-1)}.me-2{margin-inline-end:var(--space-2)}.me-3{margin-inline-end:var(--space-3)}.me-4{margin-inline-end:var(--space-4)}.me-5{margin-inline-end:var(--space-5)}.me-6{margin-inline-end:var(--space-6)}.me-8{margin-inline-end:var(--space-8)}.me-auto{margin-inline-end:auto}.mt-0{margin-block-start:0}.mt-1{margin-block-start:var(--space-1)}.mt-2{margin-block-start:var(--space-2)}.mt-3{margin-block-start:var(--space-3)}.mt-4{margin-block-start:var(--space-4)}.mt-5{margin-block-start:var(--space-5)}.mt-6{margin-block-start:var(--space-6)}.mt-8{margin-block-start:var(--space-8)}.mt-auto{margin-block-start:auto}.mb-0{margin-block-end:0}.mb-1{margin-block-end:var(--space-1)}.mb-2{margin-block-end:var(--space-2)}.mb-3{margin-block-end:var(--space-3)}.mb-4{margin-block-end:var(--space-4)}.mb-5{margin-block-end:var(--space-5)}.mb-6{margin-block-end:var(--space-6)}.mb-8{margin-block-end:var(--space-8)}.mb-auto{margin-block-end:auto}.p-0{padding:0}.p-1{padding:var(--space-1)}.p-2{padding:var(--space-2)}.p-3{padding:var(--space-3)}.p-4{padding:var(--space-4)}.p-5{padding:var(--space-5)}.p-6{padding:var(--space-6)}.p-8{padding:var(--space-8)}.px-0{padding-inline:0}.px-1{padding-inline:var(--space-1)}.px-2{padding-inline:var(--space-2)}.px-3{padding-inline:var(--space-3)}.px-4{padding-inline:var(--space-4)}.px-5{padding-inline:var(--space-5)}.px-6{padding-inline:var(--space-6)}.px-8{padding-inline:var(--space-8)}.py-0{padding-block:0}.py-1{padding-block:var(--space-1)}.py-2{padding-block:var(--space-2)}.py-3{padding-block:var(--space-3)}.py-4{padding-block:var(--space-4)}.py-5{padding-block:var(--space-5)}.py-6{padding-block:var(--space-6)}.py-8{padding-block:var(--space-8)}.ps-0{padding-inline-start:0}.ps-1{padding-inline-start:var(--space-1)}.ps-2{padding-inline-start:var(--space-2)}.ps-3{padding-inline-start:var(--space-3)}.ps-4{padding-inline-start:var(--space-4)}.ps-5{padding-inline-start:var(--space-5)}.ps-6{padding-inline-start:var(--space-6)}.ps-8{padding-inline-start:var(--space-8)}.pe-0{padding-inline-end:0}.pe-1{padding-inline-end:var(--space-1)}.pe-2{padding-inline-end:var(--space-2)}.pe-3{padding-inline-end:var(--space-3)}.pe-4{padding-inline-end:var(--space-4)}.pe-5{padding-inline-end:var(--space-5)}.pe-6{padding-inline-end:var(--space-6)}.pe-8{padding-inline-end:var(--space-8)}.pt-0{padding-block-start:0}.pt-1{padding-block-start:var(--space-1)}.pt-2{padding-block-start:var(--space-2)}.pt-3{padding-block-start:var(--space-3)}.pt-4{padding-block-start:var(--space-4)}.pt-5{padding-block-start:var(--space-5)}.pt-6{padding-block-start:var(--space-6)}.pt-8{padding-block-start:var(--space-8)}.pb-0{padding-block-end:0}.pb-1{padding-block-end:var(--space-1)}.pb-2{padding-block-end:var(--space-2)}.pb-3{padding-block-end:var(--space-3)}.pb-4{padding-block-end:var(--space-4)}.pb-5{padding-block-end:var(--space-5)}.pb-6{padding-block-end:var(--space-6)}.pb-8{padding-block-end:var(--space-8)}.input{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);transition:border-color .15s ease-in-out}.input:focus{outline:none;border-color:var(--color-input-border-focus)}.input::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.input-sm{padding:var(--space-0-5) var(--space-1);font-size:var(--text-xs)}.input-lg{padding:var(--space-2) var(--space-3);font-size:var(--text-lg)}.textarea{display:block;width:100%;min-height:120px;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);resize:vertical;transition:border-color .15s ease-in-out}.textarea:focus{outline:none;border-color:var(--color-input-border-focus)}.textarea::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.select{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);padding-inline-end:var(--space-6);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right var(--space-2) center;background-size:1em;border:1px solid var(--color-input-border);border-radius:var(--radius-input);appearance:none;cursor:pointer;transition:border-color .15s ease-in-out}.select:focus{outline:none;border-color:var(--color-input-border-focus)}[data-dir=rtl] .select{background-position:left var(--space-2) center}.checkbox,.radio{display:inline-block;width:1rem;height:1rem;margin:0;margin-inline-end:var(--space-1);vertical-align:middle;background-color:var(--color-input-bg);border:1px solid var(--color-input-border);appearance:none;cursor:pointer;transition:all .15s ease-in-out}.checkbox{border-radius:var(--radius-xs)}.radio{border-radius:var(--radius-full)}.checkbox:checked,.radio:checked{background-color:var(--color-primary-600);border-color:var(--color-primary-600)}.checkbox:checked:after{content:"";display:block;width:100%;height:100%;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='20 6 9 17 4 12'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:center;background-size:.75rem}.radio:checked:after{content:"";display:block;width:100%;height:100%;background:#fff;border-radius:var(--radius-full);transform:scale(.4)}.checkbox:focus,.radio:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.label{display:inline-block;margin-block-end:var(--space-1);font-size:var(--text-label-md);font-weight:var(--font-medium);color:var(--color-text-primary)}.label-required:after{content:" *";color:var(--color-error-600)}.form-group{margin-block-end:var(--form-field-spacing)}.form-section{margin-block-end:var(--form-section-spacing);padding-block-end:var(--form-section-spacing);border-block-end:1px solid var(--color-border-default)}.form-section:last-child{margin-block-end:0;padding-block-end:0;border-block-end:none}.field-help{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-text-secondary)}.field-error{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-error-text)}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--button-gap);padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--button-text-md);font-weight:var(--button-font-weight);line-height:var(--leading-tight);text-align:center;text-decoration:none;color:var(--color-button-primary-text);background-color:var(--color-button-primary-bg);border:1px solid var(--color-button-primary-border);border-radius:var(--radius-button);cursor:pointer;transition:all .15s ease-in-out;user-select:none}.btn:hover{background-color:var(--color-button-primary-bg-hover)}.btn:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{color:var(--color-text-primary);background-color:var(--color-neutral-100);border-color:var(--color-neutral-400)}.btn-primary:hover{background-color:var(--color-neutral-200)}.btn-secondary{color:var(--color-button-secondary-text);background-color:var(--color-button-secondary-bg);border-color:var(--color-button-secondary-border)}.btn-secondary:hover{background-color:var(--color-button-secondary-bg-hover)}.btn-link{padding:0;color:var(--color-text-link);background-color:transparent;border:none;text-decoration:var(--link-text-decoration)}.btn-link:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover);background-color:transparent}.btn-sm{padding:var(--space-0-5) var(--space-1-5);font-size:var(--button-text-sm)}.btn-lg{padding:var(--space-2) var(--space-4);font-size:var(--button-text-lg)}fieldset{margin:0;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md)}legend{padding-inline:var(--space-1);font-size:var(--text-sm);font-weight:var(--font-medium);color:var(--color-text-primary)}.form-inline{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2)}.form-inline .form-group{margin-block-end:0;flex:1 1 auto}.form-inline .input,.form-inline .select{width:auto}.input-craigslist:focus,.textarea-craigslist:focus,.select-craigslist:focus{border-color:var(--color-success-600)}.btn-minimal{padding:var(--space-1) var(--space-2);color:var(--color-text-primary);background-color:var(--color-neutral-100);border:1px solid var(--color-neutral-400);border-radius:var(--radius-sm)}.btn-minimal:hover{background-color:var(--color-neutral-200)}.btn-text{padding:0;color:var(--color-text-link);background:none;border:none;text-decoration:underline;cursor:pointer}.btn-text:hover{color:var(--color-text-link-hover)}*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:none;text-size-adjust:none}:root[data-dir=rtl]{direction:rtl}:root[data-dir=ltr]{direction:ltr}body{min-height:100vh;line-height:var(--leading-normal);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:var(--font-sans);font-size:var(--text-base);color:var(--color-text-primary);background-color:var(--color-bg-secondary)}img,picture,video,canvas,svg{display:block;max-width:100%;height:auto}input,button,textarea,select{font:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}h1,h2,h3,h4,h5,h6{font-weight:var(--font-bold);line-height:var(--leading-tight);color:var(--color-text-primary)}h1{font-size:var(--text-heading-2xl);margin-block-end:var(--space-4)}h2{font-size:var(--text-heading-xl);margin-block-end:var(--space-3)}h3{font-size:var(--text-heading-lg);margin-block-end:var(--space-3)}h4{font-size:var(--text-heading-md);margin-block-end:var(--space-2)}h5{font-size:var(--text-heading-sm);margin-block-end:var(--space-2)}h6{font-size:var(--text-heading-xs);margin-block-end:var(--space-2)}p{margin-block-end:var(--space-3)}p:last-child{margin-block-end:0}a{color:var(--color-text-link);text-decoration:var(--link-text-decoration);text-underline-offset:var(--link-underline-offset);transition:color .15s ease-in-out}a:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover)}a:visited{color:var(--color-text-link-visited)}a:focus{outline:2px solid var(--color-focus);outline-offset:2px}ul,ol{margin-block-end:var(--space-3);padding-inline-start:var(--space-5)}ul ul,ul ol,ol ul,ol ol{margin-block-end:0}li{margin-block-end:var(--space-1)}li:last-child{margin-block-end:0}table{width:100%;border-collapse:collapse;margin-block-end:var(--space-4)}th,td{padding:var(--space-2);text-align:start;border-block-end:1px solid var(--color-border-default)}th{font-weight:var(--font-semibold);background-color:var(--color-bg-tertiary)}code,kbd,samp,pre{font-family:var(--font-mono);font-size:var(--code-text-size)}code{padding:var(--space-0-5) var(--space-1);background-color:var(--color-bg-tertiary);border-radius:var(--radius-xs)}pre{overflow-x:auto;padding:var(--space-3);margin-block-end:var(--space-4);background-color:var(--color-bg-tertiary);border-radius:var(--radius-sm)}pre code{padding:0;background-color:transparent}blockquote{padding-inline-start:var(--space-4);margin-block-end:var(--space-4);border-inline-start:3px solid var(--color-border-strong);color:var(--color-text-secondary)}hr{height:0;margin-block:var(--space-6);border:0;border-block-start:1px solid var(--color-border-default)}:focus-visible{outline:2px solid var(--color-focus);outline-offset:2px}::selection{background-color:var(--color-primary-200);color:var(--color-text-primary)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--color-bg-tertiary)}::-webkit-scrollbar-thumb{background:var(--color-neutral-400);border-radius:var(--radius-sm)}::-webkit-scrollbar-thumb:hover{background:var(--color-neutral-500)}.skip-link{position:absolute;top:-40px;left:0;padding:var(--space-2) var(--space-4);background:var(--color-bg-primary);color:var(--color-text-link);text-decoration:none;z-index:100}.skip-link:focus{top:0}@media (prefers-reduced-motion: reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}#app{margin:0;padding:0;width:100vw;height:100vh;overflow:hidden;display:flex;flex-direction:column}body:not(.sb-show-main){overflow:hidden}html{height:100%}html,body{margin:0;padding:0}.theme-toggle.svelte-v7l3jb{display:inline-flex;align-items:center;gap:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-3);background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;outline:none;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.theme-toggle.svelte-v7l3jb:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.theme-toggle.svelte-v7l3jb:active{transform:translateY(0);box-shadow:none}.theme-toggle--small.svelte-v7l3jb{padding-block:var(--space-1);padding-inline:var(--space-2);font-size:var(--text-xs);gap:var(--space-1)}.theme-toggle--large.svelte-v7l3jb{padding-block:var(--space-3);padding-inline:var(--space-4);font-size:var(--text-base);gap:var(--space-3)}.theme-toggle__icon.svelte-v7l3jb{display:flex;align-items:center;justify-content:center;inline-size:1.2em;block-size:1.2em;flex-shrink:0}.theme-toggle__icon.svelte-v7l3jb svg:where(.svelte-v7l3jb){inline-size:100%;block-size:100%}.theme-toggle__label.svelte-v7l3jb{white-space:nowrap}.theme-toggle--small.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1em;block-size:1em}.theme-toggle--large.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1.4em;block-size:1.4em}@media (prefers-contrast: high){.theme-toggle.svelte-v7l3jb{border:2px solid var(--color-forced-border)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:3px solid var(--color-forced-active)}}@media (prefers-reduced-motion: reduce){.theme-toggle.svelte-v7l3jb{transition:none}.theme-toggle.svelte-v7l3jb:hover,.theme-toggle.svelte-v7l3jb:active{transform:none}}.sidebar.svelte-qtftjm{--sidebar-width: 250px;--sidebar-collapsed-width: 48px;inline-size:100%;background:var(--color-sidebar-bg);display:flex;flex-direction:column;overflow-x:visible;overflow-y:hidden;block-size:100vh;position:relative}.sidebar.collapsed.svelte-qtftjm{inline-size:100%}.sidebar-header.svelte-qtftjm{display:flex;align-items:center;padding-block:var(--space-1);padding-inline:var(--space-2);border-block-end:1px solid var(--color-border-default);background:var(--color-bg-primary);flex-shrink:0;min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-qtftjm{background:none;border:none;font-size:var(--text-lg);cursor:pointer;padding-block:var(--space-2);padding-inline:var(--space-2);border-radius:var(--radius-sm);transition:background-color var(--duration-fast) ease;display:flex;align-items:center;justify-content:center;inline-size:32px;block-size:32px;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-qtftjm:hover{background:var(--color-interactive-secondary-hover)}.sidebar-toggle.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.sidebar-title.svelte-qtftjm{margin:0;margin-inline-start:var(--space-2);font-size:var(--text-sm);font-weight:var(--font-normal);color:var(--color-text-secondary);flex:1}.header-actions.svelte-qtftjm{display:flex;align-items:center;gap:var(--space-1);margin-inline-start:var(--space-2)}.header-actions.compact.svelte-qtftjm{margin-inline-start:0;justify-content:center}.sidebar-main.svelte-qtftjm{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;background:var(--color-bg-secondary)}.sidebar-nav.svelte-qtftjm{padding-block:0;padding-inline:0;flex-shrink:0}.sidebar-footer.svelte-qtftjm{flex-shrink:0;background:var(--color-bg-secondary);border-top:1px solid var(--color-border-default)}.sidebar-section.svelte-qtftjm{inline-size:100%;background:transparent;border:none;display:flex;align-items:center;padding-block:var(--space-2);padding-inline:var(--space-2);cursor:pointer;transition:background-color .1s ease;text-align:start;color:var(--color-text-link);min-block-size:var(--touch-target-min);font-size:var(--text-sm);outline:none;position:relative}.sidebar-section.svelte-qtftjm:hover{text-decoration:underline}.sidebar-section.svelte-qtftjm:hover:not(.active){background:var(--color-bg-tertiary)}.sidebar-section.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.sidebar .sidebar-section.active{background:var(--color-bg-primary)!important;color:var(--color-text-primary)!important;font-weight:var(--font-normal)!important;border-top:1px solid var(--color-border-default)!important;border-bottom:1px solid var(--color-border-default)!important;border-right:1px solid var(--color-bg-primary)!important;margin-inline-end:-1px!important;position:relative!important;z-index:1!important}.sidebar .sidebar-section.active .section-label{text-decoration:none!important}.spine-section-header.svelte-qtftjm{display:flex;align-items:center;justify-content:space-between;padding-block:var(--space-2);padding-inline:var(--space-2);min-block-size:var(--touch-target-min);color:var(--color-text-primary);background:transparent}.spine-section-header.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-sm);font-weight:var(--font-normal)}.spine-section-header.compact.svelte-qtftjm{justify-content:center;flex-direction:column;gap:var(--space-1);padding-block:var(--space-1)}.spine-section-header.compact.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-xs);text-align:center}.append-button-nav.svelte-qtftjm{display:flex;align-items:center;justify-content:center;inline-size:var(--touch-target-min);block-size:var(--touch-target-min);border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.append-button-nav.svelte-qtftjm:hover{background:var(--color-bg-tertiary);color:var(--color-text-primary)}.append-button-nav.svelte-qtftjm:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.append-button-nav.compact.svelte-qtftjm{inline-size:var(--touch-target-min);block-size:var(--touch-target-min);font-size:var(--text-xs)}.append-icon.svelte-qtftjm{font-size:var(--text-sm);font-weight:var(--font-medium)}.spine-items-container.svelte-qtftjm{flex:1}.section-label.svelte-qtftjm{font-size:var(--text-base);font-weight:var(--font-normal)}.sidebar.collapsed.svelte-qtftjm .section-label:where(.svelte-qtftjm){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.sidebar.collapsed.svelte-qtftjm .sidebar-section:where(.svelte-qtftjm){justify-content:center;padding-inline:var(--space-1)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar{inline-size:6px}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.sidebar-main.svelte-qtftjm::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.sidebar.svelte-qtftjm{--sidebar-width: 250px}.sidebar.collapsed.svelte-qtftjm{--sidebar-width: 48px}@media (prefers-contrast: high){.sidebar.svelte-qtftjm{border-inline-end:2px solid var(--color-forced-border)}.sidebar-header.svelte-qtftjm{border-block-end:2px solid var(--color-forced-border)}.sidebar-section.active.svelte-qtftjm{border-inline-end:4px solid var(--color-forced-active)}}[dir=rtl] .sidebar-toggle.svelte-qtftjm{transform:scaleX(-1)}.sidebar-section.svelte-qtftjm:disabled,.sidebar-section.disabled.svelte-qtftjm{opacity:.5;cursor:not-allowed;color:var(--color-text-disabled, var(--color-text-tertiary))}.sidebar-section.svelte-qtftjm:disabled:hover,.sidebar-section.disabled.svelte-qtftjm:hover{text-decoration:none;background:transparent}.spine-section-header.disabled.svelte-qtftjm{opacity:.5}.spine-section-header.disabled.svelte-qtftjm .section-label:where(.svelte-qtftjm){color:var(--color-text-disabled, var(--color-text-tertiary))}.append-button-nav.svelte-qtftjm:disabled,.append-button-nav.disabled.svelte-qtftjm{opacity:.5;cursor:not-allowed;background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.append-button-nav.svelte-qtftjm:disabled:hover,.append-button-nav.disabled.svelte-qtftjm:hover{background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.app-layout.svelte-1b458cb{display:grid;height:100vh;width:100vw;margin:0;padding:0}.main-content.svelte-1b458cb{min-inline-size:0;overflow:hidden}.pane-container.svelte-1b458cb{display:flex;flex-direction:column;height:100%}.pane-header.svelte-1b458cb{flex-shrink:0;border-block-end:1px solid var(--color-border-default);background:var(--color-bg-secondary);min-block-size:40px;display:flex;align-items:center;padding-inline:var(--space-4);padding-block:0}.pane-content.svelte-1b458cb{flex:1;overflow:auto;background:var(--color-bg-primary)}.single-pane-container.svelte-1b458cb{display:flex;flex-direction:column;height:100%}[data-pane-resizer]{background:var(--color-border-default);inline-size:4px;cursor:col-resize;transition:background-color var(--duration-fast) ease}[data-pane-resizer]:hover{background:var(--color-border-strong)}[data-pane-resizer][data-resize-handle-active]{background:var(--color-border-accent)}[data-pane-resizer]:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}@media (prefers-contrast: high){.pane-header.svelte-1b458cb{border-block-end:2px solid var(--color-forced-border)}}.about-view.svelte-wc4a07{height:100%;overflow:auto;padding:var(--space-4);background:var(--color-bg-primary)}.about-content.svelte-wc4a07{max-width:800px;margin:0 auto}.about-header.svelte-wc4a07{text-align:center;margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--color-border-default)}.app-title.svelte-wc4a07{font-size:var(--text-3xl);font-weight:var(--font-bold);color:var(--color-text-primary);margin:0 0 var(--space-2) 0}.app-version.svelte-wc4a07{font-size:var(--text-sm);color:var(--color-text-tertiary);margin:0}.about-section.svelte-wc4a07{margin-bottom:var(--space-6)}.about-section.svelte-wc4a07 h2:where(.svelte-wc4a07){font-size:var(--text-xl);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0;border-bottom:1px solid var(--color-border-subtle);padding-bottom:var(--space-1)}.about-section.svelte-wc4a07 p:where(.svelte-wc4a07){font-size:var(--text-base);line-height:1.6;color:var(--color-text-secondary);margin:0 0 var(--space-3) 0}.external-link.svelte-wc4a07{color:var(--color-text-link);text-decoration:underline}.external-link.svelte-wc4a07:hover{color:var(--color-text-link-hover)}.license-text.svelte-wc4a07{background:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-sm);line-height:1.5;color:var(--color-text-primary);white-space:pre-wrap;overflow-x:auto;overflow-y:auto}@media (max-width: 640px){.about-view.svelte-wc4a07{padding:var(--space-3)}.app-title.svelte-wc4a07{font-size:var(--text-2xl)}}@media (prefers-contrast: high){.license-text.svelte-wc4a07{border-width:2px}}@media (prefers-reduced-motion: reduce){.about-view.svelte-wc4a07{scroll-behavior:auto}}.thirdparty-view.svelte-3a2w4e{height:100%;overflow:auto;padding:var(--space-4);background:var(--color-bg-primary)}.thirdparty-content.svelte-3a2w4e{max-width:800px;margin:0 auto}.thirdparty-header.svelte-3a2w4e{text-align:center;margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--color-border-default)}.thirdparty-header.svelte-3a2w4e h1:where(.svelte-3a2w4e){font-size:var(--text-2xl);font-weight:var(--font-bold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0}.thirdparty-intro.svelte-3a2w4e{font-size:var(--text-base);line-height:1.6;color:var(--color-text-secondary);margin:0}.libraries-section.svelte-3a2w4e{margin-bottom:var(--space-6)}.external-link.svelte-3a2w4e{color:var(--color-text-link);text-decoration:underline}.external-link.svelte-3a2w4e:hover{color:var(--color-text-link-hover)}.license-text.svelte-3a2w4e{background:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-sm);line-height:1.5;color:var(--color-text-primary);white-space:pre-wrap;overflow-x:auto;overflow-y:auto}.library-list.svelte-3a2w4e{display:flex;flex-direction:column;gap:var(--space-4)}.library-item.svelte-3a2w4e{border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);background:var(--color-bg-secondary)}.library-name.svelte-3a2w4e{font-size:var(--text-base);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-1) 0;display:flex;align-items:center;gap:var(--space-2)}.library-version.svelte-3a2w4e{font-size:var(--text-sm);font-weight:var(--font-normal);color:var(--color-text-tertiary);background:var(--color-bg-tertiary);padding:var(--space-1) var(--space-2);border-radius:var(--radius-xs)}.library-description.svelte-3a2w4e{font-size:var(--text-sm);color:var(--color-text-secondary);margin:var(--space-1) 0}.library-copyright.svelte-3a2w4e{font-size:var(--text-xs);color:var(--color-text-tertiary);margin:var(--space-1) 0 0 0;font-family:var(--font-mono)}.mit-license-section.svelte-3a2w4e{margin-top:var(--space-5);padding-top:var(--space-4);border-top:1px solid var(--color-border-subtle)}.mit-license-section.svelte-3a2w4e h3:where(.svelte-3a2w4e){font-size:var(--text-lg);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0}@media (max-width: 640px){.thirdparty-view.svelte-3a2w4e{padding:var(--space-3)}.thirdparty-header.svelte-3a2w4e h1:where(.svelte-3a2w4e){font-size:var(--text-xl)}.library-name.svelte-3a2w4e{flex-direction:column;align-items:flex-start;gap:var(--space-1)}}@media (prefers-contrast: high){.license-text.svelte-3a2w4e,.library-item.svelte-3a2w4e{border-width:2px}}@media (prefers-reduced-motion: reduce){.thirdparty-view.svelte-3a2w4e{scroll-behavior:auto}}.workspace-action-bar.svelte-4wg9d{margin-block-end:var(--space-6)}.section-title.svelte-4wg9d{margin:0 0 var(--space-4) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.action-buttons.svelte-4wg9d{display:grid;grid-template-columns:repeat(auto-fit,minmax(15em,1fr));gap:var(--space-4)}.action-button.svelte-4wg9d{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:2px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-family:inherit;cursor:pointer;transition:all var(--duration-normal) ease;text-align:left;min-height:80px;position:relative}.action-button.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);transform:translateY(-2px);box-shadow:var(--shadow-md)}.action-button.svelte-4wg9d:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.action-button.primary.svelte-4wg9d{border-color:var(--color-primary);background-color:var(--color-primary);color:var(--color-surface)}.action-button.primary.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-hover)}.action-button.svelte-4wg9d:disabled{opacity:.6;cursor:not-allowed;transform:none}.action-button.svelte-4wg9d:disabled:hover{border-color:var(--color-border-default);background-color:var(--color-surface-primary);transform:none;box-shadow:none}.action-button.primary.svelte-4wg9d:disabled:hover{border-color:var(--color-primary);background-color:var(--color-primary)}.button-icon.svelte-4wg9d{font-size:2rem;flex-shrink:0}.button-content.svelte-4wg9d{display:flex;flex-direction:column;gap:var(--space-1);flex:1;min-width:0}.button-title.svelte-4wg9d{font-size:var(--text-base);font-weight:600;line-height:1.2}.button-subtitle.svelte-4wg9d{font-size:var(--text-sm);opacity:.8;line-height:1.2}.action-button.primary.svelte-4wg9d .button-subtitle:where(.svelte-4wg9d){opacity:.9}.action-button.svelte-4wg9d:disabled .button-icon:where(.svelte-4wg9d){opacity:.5}@media (max-width: 768px){.action-buttons.svelte-4wg9d{grid-template-columns:1fr;gap:var(--space-3)}.action-button.svelte-4wg9d{min-height:70px;padding:var(--space-3)}.button-icon.svelte-4wg9d{font-size:1.5rem}}@media (max-width: 480px){.action-button.svelte-4wg9d{flex-direction:column;text-align:center;gap:var(--space-2);min-height:90px}.button-content.svelte-4wg9d{align-items:center}}.workspace-item.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);cursor:pointer;transition:all var(--duration-fast) ease;margin-block-end:var(--space-3);min-height:44px}.workspace-item.svelte-ijd5ei:hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);box-shadow:var(--shadow-sm)}.workspace-item.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.workspace-item.current.svelte-ijd5ei{border-color:var(--color-primary);background-color:var(--color-primary-surface)}.workspace-item.current.svelte-ijd5ei:hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-surface-hover)}.workspace-item.error.svelte-ijd5ei{border-color:var(--color-warning);background-color:var(--color-warning-surface)}.workspace-item.error.svelte-ijd5ei:hover{border-color:var(--color-warning-hover)}.workspace-main.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);flex:1;min-width:0}.workspace-icon-container.svelte-ijd5ei{flex-shrink:0}.workspace-icon.svelte-ijd5ei{font-size:1.5rem;display:block}.workspace-icon.error.svelte-ijd5ei{font-size:1.25rem;color:var(--color-warning)}.workspace-info.svelte-ijd5ei{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--space-1)}.workspace-header.svelte-ijd5ei{display:flex;align-items:center;justify-content:space-between;gap:var(--space-2)}.workspace-title.svelte-ijd5ei{margin:0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;gap:var(--space-2);flex:1;min-width:0}.current-badge.svelte-ijd5ei{font-size:var(--text-xs);font-weight:500;padding:2px var(--space-1);background-color:var(--color-primary);color:var(--color-surface);border-radius:var(--radius-xs);flex-shrink:0}.workspace-time.svelte-ijd5ei{font-size:var(--text-sm);color:var(--color-text-secondary);flex-shrink:0}.workspace-meta.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-1);font-size:var(--text-sm);color:var(--color-text-secondary);overflow:hidden}.workspace-author-inline.svelte-ijd5ei{color:var(--color-text-secondary);font-weight:400}.meta-separator.svelte-ijd5ei{flex-shrink:0;opacity:.6}.workspace-language.svelte-ijd5ei{flex-shrink:0;text-transform:uppercase;font-weight:500}.workspace-stats.svelte-ijd5ei{flex-shrink:0}.workspace-actions.svelte-ijd5ei{display:flex;gap:var(--space-2);flex-shrink:0}.delete-button.svelte-ijd5ei{min-width:44px;min-height:44px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-secondary);color:var(--color-text-secondary);font-size:1.25rem;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.delete-button.svelte-ijd5ei:hover{border-color:var(--color-error);background-color:var(--color-error-surface);color:var(--color-error)}.delete-button.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-error);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}@media (max-width: 640px){.workspace-item.svelte-ijd5ei{padding:var(--space-3)}.workspace-header.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-1)}.workspace-time.svelte-ijd5ei{order:-1;align-self:flex-end}.workspace-meta.svelte-ijd5ei{flex-wrap:wrap}.workspace-stats.svelte-ijd5ei{flex:1 0 100%;margin-block-start:var(--space-1)}}@media (max-width: 480px){.workspace-main.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-2)}.workspace-icon-container.svelte-ijd5ei{align-self:center}.workspace-info.svelte-ijd5ei{width:100%}.workspace-actions.svelte-ijd5ei{align-self:center}}.workspace-list.svelte-1r2ik5n{display:flex;flex-direction:column;gap:var(--space-4)}.list-header.svelte-1r2ik5n{display:flex;flex-direction:column;gap:var(--space-3)}.search-container.svelte-1r2ik5n{display:flex;justify-content:flex-end}.search-input-wrapper.svelte-1r2ik5n{position:relative;max-width:300px;width:100%}.search-input.svelte-1r2ik5n{width:100%;padding:var(--space-2) var(--space-3);padding-inline-end:var(--space-8);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-size:var(--text-sm);transition:all var(--duration-fast) ease}.search-input.svelte-1r2ik5n:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.search-input.svelte-1r2ik5n::placeholder{color:var(--color-text-tertiary)}.clear-search.svelte-1r2ik5n{position:absolute;top:50%;inset-inline-end:var(--space-2);transform:translateY(-50%);width:24px;height:24px;border:none;border-radius:var(--radius-sm);background-color:var(--color-surface-tertiary);color:var(--color-text-secondary);font-size:1rem;font-weight:700;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.clear-search.svelte-1r2ik5n:hover{background-color:var(--color-surface-hover);color:var(--color-text-primary)}.list-content.svelte-1r2ik5n{min-height:200px}.loading-state.svelte-1r2ik5n{display:flex;flex-direction:column;gap:var(--space-3)}.skeleton-item.svelte-1r2ik5n{height:80px;background-color:var(--color-surface-tertiary);border-radius:var(--radius-md);animation:svelte-1r2ik5n-pulse 2s infinite;opacity:.6}@keyframes svelte-1r2ik5n-pulse{0%,to{opacity:.6}50%{opacity:.8}}.loading-text.svelte-1r2ik5n{text-align:center;color:var(--color-text-secondary);font-style:italic;margin:var(--space-4) 0 0 0}.empty-state.svelte-1r2ik5n{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.empty-tips.svelte-1r2ik5n{max-width:400px;margin:0 auto;text-align:left}.tips-title.svelte-1r2ik5n{margin:0 0 var(--space-2) 0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary)}.tips-list.svelte-1r2ik5n{margin:0;padding-inline-start:var(--space-4);list-style-type:disc}.tips-list.svelte-1r2ik5n li:where(.svelte-1r2ik5n){margin-block-end:var(--space-1);font-size:var(--text-sm);line-height:1.5}.no-results.svelte-1r2ik5n{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.no-results-icon.svelte-1r2ik5n{font-size:3rem;margin-block-end:var(--space-4);display:block;opacity:.6}.no-results-title.svelte-1r2ik5n{margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.no-results-description.svelte-1r2ik5n{margin:0 0 var(--space-4) 0;font-size:var(--text-base)}.clear-search-button.svelte-1r2ik5n{padding:var(--space-2) var(--space-4);border:1px solid var(--color-primary);border-radius:var(--radius-md);background-color:transparent;color:var(--color-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.clear-search-button.svelte-1r2ik5n:hover{background-color:var(--color-primary);color:var(--color-surface)}.workspace-grid.svelte-1r2ik5n{display:flex;flex-direction:column;gap:0}.search-results-info.svelte-1r2ik5n{margin-block-start:var(--space-4);padding-block-start:var(--space-4);border-block-start:1px solid var(--color-border-default)}.results-text.svelte-1r2ik5n{margin:0;text-align:center;font-size:var(--text-sm);color:var(--color-text-secondary);font-style:italic}@media (max-width: 768px){.list-header.svelte-1r2ik5n{gap:var(--space-2)}.search-container.svelte-1r2ik5n{justify-content:stretch}.search-input-wrapper.svelte-1r2ik5n{max-width:none}.empty-state.svelte-1r2ik5n{padding:var(--space-6) var(--space-2)}.empty-tips.svelte-1r2ik5n{text-align:center}}.workspace-view.svelte-9tke9n{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-content.svelte-9tke9n{flex:1;padding:var(--space-6);overflow-y:auto}.error-banner.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);margin-block-end:var(--space-6);background-color:var(--color-error-surface);color:var(--color-error);border:1px solid var(--color-error);border-radius:var(--radius-md)}.error-icon.svelte-9tke9n{font-size:1.25rem;flex-shrink:0}.error-text.svelte-9tke9n{flex:1;font-weight:500}.retry-button.svelte-9tke9n{padding:var(--space-2) var(--space-3);border:1px solid var(--color-error);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-error);font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:44px}.retry-button.svelte-9tke9n:hover{background-color:var(--color-error);color:var(--color-surface)}.retry-button.svelte-9tke9n:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.unsaved-indicator.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);margin-block-start:var(--space-6);background-color:var(--color-warning-surface);color:var(--color-warning);border:1px solid var(--color-warning);border-radius:var(--radius-md);font-size:var(--text-sm)}.indicator-icon.svelte-9tke9n{font-size:var(--text-base);flex-shrink:0}@media (max-width: 768px){.view-content.svelte-9tke9n{padding:var(--space-4)}}.metadata-tab.svelte-z75kp3{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;border:none;border-block-end:2px solid transparent;background-color:transparent;color:var(--color-text-secondary);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;white-space:nowrap}.metadata-tab.svelte-z75kp3:hover:not(.disabled){color:var(--color-text-primary);background-color:var(--color-surface-hover)}.metadata-tab.svelte-z75kp3:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-radius:var(--radius-sm)}.metadata-tab.active.svelte-z75kp3{color:var(--color-primary);border-block-end-color:var(--color-primary);background-color:var(--color-surface-primary)}.metadata-tab.has-errors.svelte-z75kp3{color:var(--color-error)}.metadata-tab.has-errors.active.svelte-z75kp3{border-block-end-color:var(--color-error)}.metadata-tab.disabled.svelte-z75kp3{color:var(--color-text-disabled);cursor:not-allowed}.tab-label.svelte-z75kp3{flex:1}.error-indicator.svelte-z75kp3{display:inline-flex;align-items:center;justify-content:center;width:1.25rem;height:1.25rem;border-radius:50%;background-color:var(--color-error);color:var(--color-surface);font-size:.75rem;font-weight:700;line-height:1}[dir=rtl] .metadata-tab.svelte-z75kp3{flex-direction:row-reverse}.metadata-tab-bar.svelte-1pzcjt6{display:flex;border-block-end:1px solid var(--color-border-default);background-color:var(--color-surface-primary);overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none}.metadata-tab-bar.svelte-1pzcjt6::-webkit-scrollbar{display:none}@media (max-width: 480px){.metadata-tab-bar.svelte-1pzcjt6{flex-wrap:wrap}}.metadata-field.svelte-cp96ig{margin-block-end:1rem}.field-label.svelte-cp96ig{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-cp96ig{color:var(--color-success-600)}.field-input.svelte-cp96ig{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-cp96ig:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-cp96ig:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-cp96ig{border-color:var(--color-error)}.field-input.error.svelte-cp96ig:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-cp96ig{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-cp96ig:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-cp96ig{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-bssb4o{margin-block-end:1rem}.field-label.svelte-bssb4o{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-bssb4o{color:var(--color-success-600)}.field-select.svelte-bssb4o{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;cursor:pointer}.field-select.svelte-bssb4o:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-select.svelte-bssb4o:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-select.error.svelte-bssb4o{border-color:var(--color-error)}.field-select.error.svelte-bssb4o:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-select.needs-attention.svelte-bssb4o{border-color:var(--color-success-600)}.field-select.needs-attention.svelte-bssb4o:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-bssb4o{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-1c704qf{margin-block-end:1rem}.field-label.svelte-1c704qf{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-1c704qf{color:var(--color-success-600)}.required.svelte-1c704qf{color:var(--color-error);margin-inline-start:.25rem}.field-textarea.svelte-1c704qf{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;resize:vertical;font-family:inherit;line-height:1.5;field-sizing:content;min-height:calc(4.5em + 1.5rem)}.field-textarea.svelte-1c704qf:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-textarea.svelte-1c704qf:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed;resize:none}.field-textarea.error.svelte-1c704qf{border-color:var(--color-error)}.field-textarea.error.svelte-1c704qf:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-textarea.needs-attention.svelte-1c704qf{border-color:var(--color-success-600)}.field-textarea.needs-attention.svelte-1c704qf:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-1c704qf{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.basic-info-fields.svelte-1nofkco{padding:1.5rem}.form-columns.svelte-1nofkco{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-1nofkco{grid-template-columns:1fr 1fr}}.column.svelte-1nofkco{min-width:0}.field-group.svelte-1nofkco{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-1nofkco:last-child{margin-block-end:0}.group-title.svelte-1nofkco{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.identifier-field.svelte-1nofkco{display:flex;gap:.5rem;align-items:flex-end}.identifier-field.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.generate-button.svelte-1nofkco{padding:.75rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap;height:fit-content}.generate-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.generate-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.generate-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.array-field.svelte-1nofkco{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-1nofkco{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-1nofkco .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-1nofkco .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-1nofkco .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-1nofkco .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-1nofkco{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-1nofkco:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-1nofkco{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.metadata-field.svelte-14vfa0w{margin-block-end:1rem}.field-label.svelte-14vfa0w{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-14vfa0w{color:var(--color-success-600)}.required.svelte-14vfa0w{color:var(--color-error);margin-inline-start:.25rem}.date-input-wrapper.svelte-14vfa0w{display:flex;gap:.5rem;align-items:center}.field-input.svelte-14vfa0w{flex:1;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-14vfa0w:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-14vfa0w{border-color:var(--color-error)}.field-input.error.svelte-14vfa0w:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-14vfa0w{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-14vfa0w:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.today-button.svelte-14vfa0w{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.today-button.svelte-14vfa0w:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.today-button.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-error.svelte-14vfa0w{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.advanced-fields.svelte-fuok1{padding:1.5rem}.form-columns.svelte-fuok1{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-fuok1{grid-template-columns:1fr 1fr}}.column.svelte-fuok1{min-width:0}.field-group.svelte-fuok1{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-fuok1:last-child{margin-block-end:0}.group-title.svelte-fuok1{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.array-field.svelte-fuok1{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-fuok1{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-fuok1 .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-fuok1 .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-fuok1 .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-fuok1 .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-fuok1 .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-fuok1{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-fuok1:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-fuok1{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-fuok1:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.metadata-editor.svelte-17s3g49{display:flex;flex-direction:column;height:100%;background-color:var(--color-surface-primary)}.pane-header.svelte-17s3g49{flex-shrink:0;border-block-end:1px solid var(--color-border-default)}.pane-content.svelte-17s3g49{flex:1;overflow-y:auto;background-color:var(--color-bg-primary)}.tab-panel.svelte-17s3g49{height:100%}.loading-state.svelte-17s3g49,.error-state.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-17s3g49{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-17s3g49{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-17s3g49:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-17s3g49:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.placeholder-panel.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.placeholder-panel.svelte-17s3g49 p:where(.svelte-17s3g49):first-child{font-size:1.125rem;font-weight:600;margin-block-end:.5rem}.placeholder-description.svelte-17s3g49{font-size:.875rem;opacity:.8}.placeholder-view.svelte-skhkuy{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-header.svelte-skhkuy{display:flex;align-items:center;justify-content:space-between;padding:var(--space-6);border-bottom:1px solid var(--color-border-default);background-color:var(--color-bg-secondary)}.header-content.svelte-skhkuy{display:flex;align-items:center;gap:var(--space-3)}.view-icon.svelte-skhkuy{font-size:var(--text-2xl)}.header-text.svelte-skhkuy h2:where(.svelte-skhkuy){margin:0 0 var(--space-1) 0;font-size:var(--text-xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.header-text.svelte-skhkuy p:where(.svelte-skhkuy){margin:0;font-size:var(--text-sm);color:var(--color-text-secondary)}.coming-soon-badge.svelte-skhkuy{padding:var(--space-1) var(--space-2);background-color:var(--color-accent);color:#fff;border-radius:var(--radius-md);font-size:var(--text-xs);font-weight:var(--font-medium)}.view-content.svelte-skhkuy{flex:1;overflow-y:auto;display:flex;align-items:center;justify-content:center;padding:var(--space-6)}.placeholder-content.svelte-skhkuy{max-width:600px;text-align:center}.placeholder-icon.svelte-skhkuy{margin-bottom:var(--space-6)}.large-icon.svelte-skhkuy{font-size:4rem;opacity:.6}.placeholder-content.svelte-skhkuy h3:where(.svelte-skhkuy){margin:0 0 var(--space-4) 0;font-size:var(--text-2xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.placeholder-description.svelte-skhkuy{margin:0 0 var(--space-8) 0;font-size:var(--text-base);color:var(--color-text-secondary);line-height:var(--leading-relaxed)}.feature-preview.svelte-skhkuy{margin-bottom:var(--space-8);text-align:left}.feature-preview.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary);text-align:center}.feature-list.svelte-skhkuy{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--space-2)}.feature-list.svelte-skhkuy li:where(.svelte-skhkuy){padding:var(--space-2);background-color:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-size:var(--text-sm);color:var(--color-text-primary)}.demo-actions.svelte-skhkuy{margin-bottom:var(--space-6)}.demo-actions.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary)}.action-buttons.svelte-skhkuy{display:flex;gap:var(--space-3);justify-content:center;flex-wrap:wrap}.btn.svelte-skhkuy{display:inline-flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-4);border:none;border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;text-decoration:none}.btn-primary.svelte-skhkuy{color:var(--color-text-inverse)}.btn-primary.svelte-skhkuy:hover{background-color:var(--color-accent-dark, var(--color-accent));transform:translateY(-1px);box-shadow:var(--shadow-sm)}.btn-secondary.svelte-skhkuy{background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default)}.btn-secondary.svelte-skhkuy:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover)}.last-action.svelte-skhkuy{display:flex;align-items:center;justify-content:center;gap:var(--space-2);padding:var(--space-3);background-color:var(--color-success-bg, #d4edda);color:var(--color-success-text, #155724);border:1px solid var(--color-success-border, #c3e6cb);border-radius:var(--radius-md);font-size:var(--text-sm)}.action-icon.svelte-skhkuy{font-size:var(--text-base)}.editor-pane-container.svelte-1o393xc{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.editor-header.svelte-1o393xc{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.editor-controls.svelte-1o393xc{display:flex;gap:var(--space-2)}.pane-toggle-btn.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-2) var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);cursor:pointer;transition:all var(--duration-fast) ease;font-size:var(--text-sm);font-weight:var(--font-medium)}.pane-toggle-btn.svelte-1o393xc:hover{background:var(--color-bg-hover);border-color:var(--color-accent-primary)}.pane-toggle-btn.svelte-1o393xc:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.toggle-icon.svelte-1o393xc{font-size:var(--text-base);font-weight:700}.toggle-label.svelte-1o393xc{font-size:var(--text-sm)}.editor-status.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-2)}.status-indicator.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:var(--font-medium)}.status-indicator.transforming.svelte-1o393xc{background:var(--color-info-bg);color:var(--color-info-text)}.status-indicator.error.svelte-1o393xc{background:var(--color-error-bg);color:var(--color-error-text)}.status-indicator.warning.svelte-1o393xc{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-indicator.success.svelte-1o393xc{background:var(--color-success-bg);color:var(--color-success-text)}.status-spinner.svelte-1o393xc{width:12px;height:12px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-1o393xc-spin var(--duration-normal) linear infinite}@keyframes svelte-1o393xc-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.force-update-btn.svelte-1o393xc{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm);transition:all var(--duration-fast) ease}.force-update-btn.svelte-1o393xc:hover:not(:disabled){background:var(--color-bg-hover)}.force-update-btn.svelte-1o393xc:disabled{opacity:.5;cursor:not-allowed}.editor-content.svelte-1o393xc{flex:1;overflow:hidden}.editor-panes.svelte-1o393xc{display:flex;flex-direction:column;height:100%}.editor-pane.svelte-1o393xc{display:flex;flex-direction:column;flex:1;min-height:0}.editor-panes.dual-mode.svelte-1o393xc .editor-pane:where(.svelte-1o393xc){flex:1}.pane-2.svelte-1o393xc{border-bottom:1px solid var(--color-border-default)}.pane-header.svelte-1o393xc{padding:var(--space-2);background:var(--color-bg-tertiary);border-bottom:1px solid var(--color-border-default)}.file-selector.svelte-1o393xc{width:100%;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer}.file-selector.svelte-1o393xc:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.textarea-container.svelte-1o393xc{flex:1;padding:var(--space-2);overflow:hidden;position:relative}.content-textarea.svelte-1o393xc{width:100%;height:100%;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background:var(--color-bg-primary);color:var(--color-text-primary);font-family:var(--font-mono);font-size:var(--text-sm);line-height:var(--leading-relaxed);resize:none;outline:none}.content-textarea.svelte-1o393xc:focus{border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.content-textarea.has-error.svelte-1o393xc{border-color:var(--color-error-border)}.content-textarea.has-error.svelte-1o393xc:focus{border-color:var(--color-error-border);box-shadow:0 0 0 var(--focus-ring-width) var(--color-error-text)}.pane-error-overlay.svelte-1o393xc{position:absolute;bottom:var(--space-3);left:var(--space-3);right:var(--space-3);display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-3);background:var(--color-error-bg);border:1px solid var(--color-error-border);border-radius:var(--radius-sm);color:var(--color-error-text);font-size:var(--text-sm);box-shadow:0 2px 8px #00000026;z-index:10}.pane-error-overlay.svelte-1o393xc .error-icon:where(.svelte-1o393xc){font-size:var(--text-base);flex-shrink:0}.pane-error-overlay.svelte-1o393xc .error-message:where(.svelte-1o393xc){flex:1;font-family:var(--font-mono)}.error-display.svelte-1o393xc,.warnings-display.svelte-1o393xc{margin:var(--space-2);padding:var(--space-3);border-radius:var(--radius-md)}.error-display.svelte-1o393xc{background:var(--color-error-bg);border:1px solid var(--color-error-border);color:var(--color-error-text)}.warnings-display.svelte-1o393xc{background:var(--color-warning-bg);border:1px solid var(--color-warning-border);color:var(--color-warning-text)}.error-header.svelte-1o393xc,.warnings-header.svelte-1o393xc{display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2)}.error-message.svelte-1o393xc{font-family:var(--font-mono);font-size:var(--text-sm)}.error-stack.svelte-1o393xc{margin-top:var(--space-2)}.error-stack.svelte-1o393xc pre:where(.svelte-1o393xc){font-family:var(--font-mono);font-size:var(--text-xs);overflow-x:auto;margin:var(--space-1) 0 0}.warnings-list.svelte-1o393xc{margin:0;padding-left:var(--space-4);font-size:var(--text-sm)}.warnings-list.svelte-1o393xc li:where(.svelte-1o393xc){margin-bottom:var(--space-1)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-1o393xc{animation:none}.pane-toggle-btn.svelte-1o393xc,.force-update-btn.svelte-1o393xc{transition:none}}.preview-pane-container.svelte-32psnf{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.preview-header.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.preview-title.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);font-weight:var(--font-medium);color:var(--color-text-primary)}.preview-controls.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2)}.orientation-toggle.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;margin-right:var(--space-2);min-width:32px;display:inline-flex;align-items:center;justify-content:center}.orientation-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.orientation-toggle.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.device-selector.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-xs);cursor:pointer}.device-selector.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.view-toggle.svelte-32psnf{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm)}.view-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.view-toggle.active.svelte-32psnf{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary)}.transform-status.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2);font-size:var(--text-sm);font-weight:var(--font-medium)}.transform-status.transforming.svelte-32psnf{background:var(--color-info-bg);color:var(--color-info-text)}.transform-status.error.svelte-32psnf{background:var(--color-error-bg);color:var(--color-error-text)}.transform-status.warning.svelte-32psnf{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-spinner.svelte-32psnf{width:16px;height:16px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-32psnf-spin var(--duration-normal) linear infinite}@keyframes svelte-32psnf-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.preview-content.svelte-32psnf{flex:1;overflow:hidden;background:var(--color-bg-primary)}.source-view.svelte-32psnf{height:100%;overflow:auto}.source-code.svelte-32psnf{margin:0;padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-xs);line-height:var(--leading-relaxed);color:var(--color-text-primary);background:var(--color-bg-primary);white-space:pre-wrap}.preview-viewport.svelte-32psnf{height:100%;display:flex;justify-content:center;align-items:center;background-color:var(--color-bg-tertiary)}.preview-frame-wrapper.svelte-32psnf{position:relative}.preview-frame-container.svelte-32psnf{width:100%;height:100%;border:1px solid var(--color-border-default);border-radius:var(--radius-md);overflow:hidden}.preview-frame-container.device-frame.svelte-32psnf{box-shadow:var(--shadow-lg);border:2px solid var(--color-border-strong)}.preview-iframe.svelte-32psnf{width:100%;height:100%;border:none;background:#fff}.preview-error.svelte-32psnf,.preview-empty.svelte-32psnf{display:flex;align-items:center;justify-content:center;height:100%;padding:var(--space-4)}.error-content.svelte-32psnf,.empty-content.svelte-32psnf{text-align:center;max-width:400px}.error-content.svelte-32psnf{color:var(--color-error-text)}.error-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg)}.error-content.svelte-32psnf p:where(.svelte-32psnf){margin:var(--space-1) 0;font-size:var(--text-sm)}.error-stack.svelte-32psnf{font-family:var(--font-mono);font-size:var(--text-xs);text-align:left;background:var(--color-bg-secondary);padding:var(--space-2);border-radius:var(--radius-sm);margin-top:var(--space-2);overflow-x:auto}.empty-content.svelte-32psnf{color:var(--color-text-secondary)}.empty-icon.svelte-32psnf{font-size:var(--text-4xl);display:block;margin-bottom:var(--space-3)}.empty-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);color:var(--color-text-primary)}.empty-content.svelte-32psnf p:where(.svelte-32psnf){margin:0;font-size:var(--text-sm)}.preview-footer.svelte-32psnf{padding:var(--space-2);border-top:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.meta-info.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;font-size:var(--text-xs);color:var(--color-text-tertiary)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf){margin-right:var(--space-3)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf):last-child{margin-right:0}.warning-count.svelte-32psnf{color:var(--color-warning-text);background:var(--color-warning-bg);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-32psnf{animation:none}.view-toggle.svelte-32psnf{transition:none}}@media (prefers-contrast: high){.preview-frame-container.svelte-32psnf{border:2px solid var(--color-forced-border)}}.loading-state.svelte-19lb94x,.error-state.svelte-19lb94x,.empty-state.svelte-19lb94x{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:var(--space-8);background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-19lb94x{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-19lb94x-spin 1s linear infinite;margin-bottom:var(--space-4)}@keyframes svelte-19lb94x-spin{to{transform:rotate(360deg)}}.error-icon.svelte-19lb94x{font-size:var(--text-2xl);margin-bottom:var(--space-3)}.error-state.svelte-19lb94x{color:var(--color-error-text)}.empty-icon.svelte-19lb94x{font-size:3rem;opacity:.5;margin-bottom:var(--space-4)}.empty-state.svelte-19lb94x h3:where(.svelte-19lb94x){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:var(--font-medium)}.empty-state.svelte-19lb94x p:where(.svelte-19lb94x){margin:0;color:var(--color-text-secondary);font-size:var(--text-sm)}.spine-editor-wrapper.svelte-19lb94x{height:100%;display:flex;flex-direction:column}@media (prefers-reduced-motion: reduce){.spinner.svelte-19lb94x{animation:none}}.extension-item.svelte-1ksqegs{border:1px solid var(--border-color, #ddd);border-radius:.25rem;margin-bottom:.5rem;background:var(--bg-primary, #fff);overflow:hidden}.extension-header.svelte-1ksqegs{display:flex;align-items:center;justify-content:space-between;padding:.75rem}.extension-name.svelte-1ksqegs{font-weight:500;color:var(--text-primary, #333)}.extension-actions.svelte-1ksqegs{display:flex;gap:.5rem}.license-button.svelte-1ksqegs{background:var(--color-accent-primary, #007acc);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.875rem}.license-button.svelte-1ksqegs:hover:not(:disabled){background:var(--color-accent-primary-hover, #005a9e)}.license-button.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}.remove-button.svelte-1ksqegs{background:var(--error-bg, #dc3545);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.875rem}.remove-button.svelte-1ksqegs:hover:not(:disabled){background:var(--error-hover, #c82333)}.remove-button.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}.license-preview.svelte-1ksqegs{padding:.5rem .75rem 0;border-bottom:1px solid var(--color-border-subtle, #e9ecef)}.license-preview-text.svelte-1ksqegs{font-size:.75rem;color:var(--color-text-tertiary, #6c757d);font-style:italic;line-height:1.3}.license-section.svelte-1ksqegs{border-top:1px solid var(--border-color, #ddd);padding:.75rem;background:var(--color-bg-secondary, #f8f9fa)}.license-textarea.svelte-1ksqegs{width:100%;min-height:120px;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;font-family:var(--font-mono, monospace);font-size:.875rem;line-height:1.4;resize:vertical;background:var(--bg-primary, #fff);color:var(--text-primary, #333)}.license-textarea.svelte-1ksqegs:focus{outline:2px solid var(--focus-color, #007acc);outline-offset:2px;border-color:var(--focus-color, #007acc)}.license-textarea.svelte-1ksqegs:read-only{background:var(--color-bg-tertiary, #f1f3f4);cursor:not-allowed}.license-textarea.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}@media (max-width: 640px){.extension-header.svelte-1ksqegs{flex-direction:column;align-items:flex-start;gap:.5rem}.extension-actions.svelte-1ksqegs{align-self:stretch;justify-content:flex-end}}.settings-view.svelte-1qxmh9x{padding:1rem;max-width:100%;width:100%;margin:0}.settings-header.svelte-1qxmh9x h1:where(.svelte-1qxmh9x){margin:0 0 .5rem;font-size:1.5rem;font-weight:600}.no-workspace-message.svelte-1qxmh9x,.loading-message.svelte-1qxmh9x{color:var(--text-muted, #666);font-style:italic}.error-message.svelte-1qxmh9x{background:var(--error-bg, #fee);color:var(--error-text, #c33);padding:.75rem;border-radius:.25rem;border:1px solid var(--error-border, #fcc);margin-bottom:1rem}.settings-content.svelte-1qxmh9x{display:grid;grid-template-columns:1fr 1fr;gap:2rem;max-width:1000px;margin:0 auto}@media (max-width: 1024px){.settings-content.svelte-1qxmh9x{grid-template-columns:1fr}}section.svelte-1qxmh9x{border:1px solid var(--border-color, #ddd);border-radius:.5rem;padding:1.5rem}section.svelte-1qxmh9x h2:where(.svelte-1qxmh9x){margin:0 0 1rem;font-size:1.25rem;font-weight:500;color:var(--text-primary, #333)}.setting-group.svelte-1qxmh9x{margin-bottom:1rem}.setting-label.svelte-1qxmh9x{display:flex;align-items:flex-start;gap:.5rem;cursor:pointer}.setting-label.svelte-1qxmh9x input[type=checkbox]:where(.svelte-1qxmh9x){margin-top:.125rem;cursor:pointer}.setting-text.svelte-1qxmh9x{font-weight:500;color:var(--text-primary, #333)}.setting-description.svelte-1qxmh9x{margin:.5rem 0 0 1.75rem;color:var(--text-muted, #666);font-size:.875rem;line-height:1.4}.extension-import.svelte-1qxmh9x{margin-bottom:1.5rem}.extension-import.svelte-1qxmh9x label:where(.svelte-1qxmh9x){display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary, #333)}.extension-import.svelte-1qxmh9x input[type=file]:where(.svelte-1qxmh9x){width:100%;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;cursor:pointer}.extension-import.svelte-1qxmh9x input[type=file]:where(.svelte-1qxmh9x):disabled{opacity:.6;cursor:not-allowed}.extension-import.disabled.svelte-1qxmh9x{opacity:.6;pointer-events:none}.advanced-mode-note.svelte-1qxmh9x{font-size:var(--text-sm);color:var(--color-text-tertiary);font-style:italic;margin-top:var(--space-2);margin-bottom:0}.extensions-list.svelte-1qxmh9x{list-style:none;padding:0;margin:0}.setting-label.svelte-1qxmh9x:focus-within .setting-text:where(.svelte-1qxmh9x){outline:2px solid var(--focus-color, #007acc);outline-offset:2px}input[type=checkbox].svelte-1qxmh9x:focus-visible{outline:2px solid var(--focus-color, #007acc);outline-offset:2px}.spine-item.svelte-1b48bnl{display:flex;align-items:center;gap:var(--space-1);border-top:1px solid transparent;border-bottom:1px solid transparent;padding-block:var(--space-2);padding-inline-start:var(--space-2);padding-inline-end:var(--space-2);border-radius:0;cursor:pointer;transition:background-color var(--duration-fast) ease;min-block-size:var(--touch-target-min);position:relative;background:transparent}.spine-item.svelte-1b48bnl:hover:not(.selected){background:var(--color-bg-tertiary)}.spine-item.svelte-1b48bnl:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);position:relative;z-index:1}.spine-item.selected.svelte-1b48bnl{background:var(--color-bg-primary);border-top:1px solid var(--color-border-default);border-bottom:1px solid var(--color-border-default);margin-inline-start:calc(var(--space-2) * -1);margin-inline-end:0;padding-inline-start:calc(var(--space-2) * 2);padding-inline-end:var(--space-2)}.spine-item.compact.svelte-1b48bnl{padding-block:2px;padding-inline:var(--space-1);justify-content:center;min-block-size:var( --touch-target-min )}.spine-item.compact.selected.svelte-1b48bnl{margin-inline:0;padding-inline:var(--space-1)}.spine-item.compact.svelte-1b48bnl .chapter-id:where(.svelte-1b48bnl){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.drag-handle.svelte-1b48bnl{flex-shrink:0;display:flex;align-items:center;justify-content:center;inline-size:20px;block-size:20px;color:var(--color-text-tertiary);cursor:grab}.drag-handle.svelte-1b48bnl:active{cursor:grabbing}.chapter-id.svelte-1b48bnl{flex:1;font-size:var(--text-sm);color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.error-indicator.svelte-1b48bnl{flex-shrink:0;font-size:var(--text-sm);color:var(--color-status-warning)}.move-buttons.svelte-1b48bnl{display:flex;gap:var(--space-1);margin-inline-start:auto}.move-button.svelte-1b48bnl{display:flex;align-items:center;justify-content:center;inline-size:28px;block-size:28px;border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.move-button.svelte-1b48bnl:hover:not(:disabled){background:var(--color-interactive-secondary-hover);color:var(--color-text-primary)}.move-button.svelte-1b48bnl:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.move-button.svelte-1b48bnl:disabled{opacity:.5;cursor:not-allowed;color:var(--color-text-tertiary)}.delete-button.svelte-1b48bnl:hover:not(:disabled){background:var(--color-danger);color:var(--color-bg-primary)}@media (prefers-contrast: high){.spine-item.selected.svelte-1b48bnl{border:2px solid var(--color-forced-active)}.error-indicator.svelte-1b48bnl{font-weight:700}}.spine-sidebar.svelte-1d5i0rj{display:flex;flex-direction:column;block-size:100%;gap:var(--space-2);background:var(--color-bg-secondary);padding:0;padding-inline-end:0}.loading.svelte-1d5i0rj,.error.svelte-1d5i0rj,.empty-state.svelte-1d5i0rj{padding:var(--space-2);text-align:center;color:var(--color-text-secondary);font-size:var(--text-sm)}.error.svelte-1d5i0rj{color:var(--color-status-error)}.retry-button.svelte-1d5i0rj{margin-block-start:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.retry-button.svelte-1d5i0rj:hover{background:var(--color-interactive-secondary-hover);border-color:var(--color-border-strong)}.retry-button.svelte-1d5i0rj:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.spine-list.svelte-1d5i0rj{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;gap:0;list-style:none;padding:0;margin:0}.spine-list.svelte-1d5i0rj>*{border:none}.spine-item-wrapper.svelte-1d5i0rj{transition:transform var(--duration-fast) ease;border:none;outline:none}.spine-item-wrapper[draggable=true].svelte-1d5i0rj:active{opacity:.8;transform:scale(.98)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar{inline-size:6px}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.spine-list.svelte-1d5i0rj::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.package-epub-section.svelte-1d5i0rj{padding:var(--space-3);border-top:1px solid var(--color-border-default);margin-top:auto}.package-epub-button.svelte-1d5i0rj{width:100%;padding:var(--space-2) var(--space-3);border:1px solid var(--color-button-primary-bg);border-radius:var(--radius-sm);background-color:var(--color-button-primary-bg);color:#fff;font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:36px}.package-epub-button.svelte-1d5i0rj:hover:not(:disabled){background-color:var(--color-button-primary-bg-hover);border-color:var(--color-button-primary-bg-hover)}.package-epub-button.svelte-1d5i0rj:disabled{opacity:.6;cursor:not-allowed}.package-epub-button.svelte-1d5i0rj:focus-visible{outline:none;border-color:var(--color-button-primary-bg);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.manifest-table-container.svelte-8hsxjr{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.manifest-toolbar.svelte-8hsxjr{display:flex;align-items:center;justify-content:space-between;padding:1rem;background-color:var(--color-surface-primary);border-block-end:1px solid var(--color-border-default);position:relative;min-height:3rem;flex-shrink:0}.filter-section.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;flex:1;max-width:400px}.filter-label.svelte-8hsxjr{font-size:.875rem;font-weight:500;color:var(--color-text-secondary);white-space:nowrap}.filter-input-container.svelte-8hsxjr{position:relative;flex:1}.filter-input.svelte-8hsxjr{width:100%;padding:.5rem .75rem;padding-inline-end:2rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.filter-input.svelte-8hsxjr:focus{outline:none;border-color:var(--color-focus-ring);box-shadow:0 0 0 2px var(--color-focus-ring)}.filter-input.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.filter-input.svelte-8hsxjr::placeholder{color:var(--color-text-placeholder)}.clear-filter-button.svelte-8hsxjr{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.25rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.clear-filter-button.svelte-8hsxjr:hover{color:var(--color-text-primary)}.clear-filter-button.svelte-8hsxjr:focus{outline:none;color:var(--color-text-primary)}.action-buttons.svelte-8hsxjr{display:flex;gap:.5rem}.action-button.svelte-8hsxjr{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.action-button.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.action-button.primary.svelte-8hsxjr{background-color:var(--color-primary);color:var(--color-surface);border-color:var(--color-primary)}.action-button.primary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.action-button.secondary.svelte-8hsxjr{background-color:var(--color-surface);color:var(--color-text-primary)}.action-button.secondary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-secondary-hover);border-color:var(--color-interactive-secondary-hover)}.drag-overlay.svelte-8hsxjr{position:absolute;inset:0;background-color:rgba(var(--color-primary-rgb),.1);border:2px dashed var(--color-primary);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;z-index:10}.drag-message.svelte-8hsxjr{padding:1rem;background-color:var(--color-surface);border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.drag-message.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:0;font-size:.875rem;color:var(--color-text-primary);text-align:center}.drag-active.svelte-8hsxjr{background-color:rgba(var(--color-primary-rgb),.05)}.table-container.svelte-8hsxjr{flex:1;overflow:auto}.empty-state.svelte-8hsxjr{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.empty-state.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:.5rem 0}.empty-state-subtitle.svelte-8hsxjr{font-size:.875rem;opacity:.8}.manifest-table.svelte-8hsxjr{width:100%;border-collapse:collapse;font-size:.875rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .75rem;text-align:left;border-bottom:1px solid var(--color-border-default)}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr){background-color:var(--color-surface-secondary);font-weight:600;color:var(--color-text-primary);position:sticky;top:0;z-index:1}.sort-button.svelte-8hsxjr{background:none;border:none;font-size:inherit;font-weight:inherit;color:inherit;cursor:pointer;padding:0;display:flex;align-items:center;gap:.25rem}.sort-button.svelte-8hsxjr:hover{color:var(--color-interactive-primary)}.sort-button.svelte-8hsxjr:focus{outline:none;color:var(--color-interactive-primary)}.manifest-row.svelte-8hsxjr{cursor:pointer;transition:background-color .15s ease;position:relative}.manifest-row.svelte-8hsxjr:hover{background-color:var(--color-surface-hover)}.manifest-row.svelte-8hsxjr:focus:not(.selected){outline:2px solid var(--color-focus-ring);outline-offset:-2px;background-color:var(--color-surface-hover)}.manifest-row.selected.svelte-8hsxjr:focus{outline:2px solid var(--color-focus-ring);outline-offset:-2px}.manifest-row.selected.svelte-8hsxjr{background-color:var(--color-bg-accent)}.manifest-row.error.svelte-8hsxjr{background-color:var(--color-bg-error)}.manifest-row.source-zip-item.svelte-8hsxjr{opacity:.8;font-style:italic;background-color:var(--color-bg-muted, rgba(0, 0, 0, .05))}.manifest-row.source-zip-item.svelte-8hsxjr .item-id:where(.svelte-8hsxjr),.manifest-row.source-zip-item.svelte-8hsxjr .item-href:where(.svelte-8hsxjr){color:var(--color-text-secondary)}.source-separator.svelte-8hsxjr{background-color:var(--color-bg-secondary)}.separator-cell.svelte-8hsxjr{padding:.75rem;border-bottom:2px solid var(--color-border-strong);border-top:1px solid var(--color-border-default)}.separator-content.svelte-8hsxjr{display:flex;align-items:center;justify-content:flex-start}.separator-label.svelte-8hsxjr{font-size:.8125rem;font-weight:600;color:var(--color-text-secondary);letter-spacing:.05em}.id-cell.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;max-width:200px}.item-id.svelte-8hsxjr{font-weight:500;word-break:break-word}.href-cell.svelte-8hsxjr{max-width:300px}.item-href.svelte-8hsxjr{font-family:var(--font-mono);font-size:.8125rem;word-break:break-all}.size-cell.svelte-8hsxjr{text-align:right;color:var(--color-text-secondary)}.properties-list.svelte-8hsxjr{display:flex;flex-wrap:wrap;gap:.25rem}.property-tag.svelte-8hsxjr{background-color:var(--color-bg-accent);color:var(--color-primary);padding:.125rem .375rem;border-radius:var(--radius-xs);font-size:.75rem;font-weight:500}.action-button.svelte-8hsxjr{padding:.375rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .15s ease;min-width:32px;height:32px;display:flex;align-items:center;justify-content:center}.action-button.svelte-8hsxjr:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-8hsxjr:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}@media (max-width: 768px){.manifest-toolbar.svelte-8hsxjr{flex-direction:column;gap:1rem;align-items:stretch}.filter-section.svelte-8hsxjr{max-width:none}.action-buttons.svelte-8hsxjr{justify-content:center}.manifest-table.svelte-8hsxjr{font-size:.8125rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .25rem}.href-cell.svelte-8hsxjr{max-width:150px}.properties-list.svelte-8hsxjr{flex-direction:column}}.modal-overlay.svelte-ziknnq{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content.svelte-ziknnq{background-color:var(--color-surface-primary);border-radius:var(--radius-modal);box-shadow:var(--elevation-modal);max-width:600px;width:90%;max-height:90vh;display:flex;flex-direction:column}.modal-header.svelte-ziknnq{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;border-bottom:1px solid var(--color-border-default)}.modal-header.svelte-ziknnq h2:where(.svelte-ziknnq){margin:0;font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.close-button.svelte-ziknnq{background:none;border:none;font-size:1.5rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.close-button.svelte-ziknnq:hover{color:var(--color-text-primary)}.close-button.svelte-ziknnq:focus{outline:none;color:var(--color-text-primary)}.modal-form.svelte-ziknnq{display:flex;flex-direction:column;height:100%}.form-body.svelte-ziknnq{flex:1;overflow-y:auto;padding:1.5rem}.form-group.svelte-ziknnq{margin-bottom:1.5rem}.form-label.svelte-ziknnq{display:block;margin-bottom:.5rem;font-weight:500;color:var(--color-text-primary)}.required.svelte-ziknnq{color:var(--color-error-text)}.form-input.svelte-ziknnq,.form-select.svelte-ziknnq,.form-textarea.svelte-ziknnq{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-input-bg);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.form-input.svelte-ziknnq:focus,.form-select.svelte-ziknnq:focus,.form-textarea.svelte-ziknnq:focus{outline:none;border-color:var(--color-input-border-focus);box-shadow:0 0 0 2px var(--color-focus)}.form-input.error.svelte-ziknnq,.form-select.error.svelte-ziknnq{border-color:var(--color-error-text)}.form-input.svelte-ziknnq::placeholder,.form-textarea.svelte-ziknnq::placeholder{color:var(--color-input-placeholder)}.file-input.svelte-ziknnq{width:100%;padding:.75rem;border:2px dashed var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-bg-secondary);cursor:pointer;transition:border-color .2s ease}.file-input.svelte-ziknnq:hover{border-color:var(--color-interactive-primary)}.file-input.svelte-ziknnq:focus{outline:none;border-color:var(--color-focus)}.file-info.svelte-ziknnq{margin-top:.5rem;font-size:.875rem;color:var(--color-text-secondary)}.checkbox-fieldset.svelte-ziknnq{border:none;margin:0;padding:0}.checkbox-fieldset.svelte-ziknnq .form-label:where(.svelte-ziknnq){display:block;margin-bottom:.5rem;font-weight:500}.checkbox-group.svelte-ziknnq{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.checkbox-label.svelte-ziknnq{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--color-text-primary);cursor:pointer}.checkbox-input.svelte-ziknnq{width:1rem;height:1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-input-bg);cursor:pointer}.checkbox-input.svelte-ziknnq:checked{background-color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.checkbox-input.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}.error-message.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-error-text)}.field-help.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-text-secondary)}.modal-footer.svelte-ziknnq{display:flex;gap:.75rem;justify-content:flex-end;padding:1.5rem;border-top:1px solid var(--color-border-default)}.cancel-button.svelte-ziknnq,.save-button.svelte-ziknnq{padding:.75rem 1.5rem;border:1px solid var(--color-border-default);border-radius:var(--radius-button);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-button.svelte-ziknnq{background-color:var(--color-button-secondary-bg);color:var(--color-text-primary)}.cancel-button.svelte-ziknnq:hover{background-color:var(--color-button-secondary-bg-hover);border-color:var(--color-border-default)}.save-button.svelte-ziknnq{background-color:var(--color-interactive-primary);color:var(--color-white);border-color:var(--color-interactive-primary)}.save-button.svelte-ziknnq:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.cancel-button.svelte-ziknnq:focus,.save-button.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}@media (max-width: 768px){.modal-content.svelte-ziknnq{width:95%;max-height:95vh}.modal-header.svelte-ziknnq,.form-body.svelte-ziknnq{padding:1rem}.modal-footer.svelte-ziknnq{padding:1rem;flex-direction:column}.checkbox-group.svelte-ziknnq{grid-template-columns:1fr}}.loading-state.svelte-12tyyls,.error-state.svelte-12tyyls{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-12tyyls{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-12tyyls{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-12tyyls:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-12tyyls:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.manifest-preview.svelte-xcscli{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.no-selection.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.no-selection.svelte-xcscli p:where(.svelte-xcscli){margin:.5rem 0}.no-selection-subtitle.svelte-xcscli{font-size:.875rem;opacity:.8}.loading-state.svelte-xcscli,.error-state.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-xcscli{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-xcscli{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-xcscli:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.preview-content.svelte-xcscli{height:100%;display:flex;flex-direction:column}.preview-header.svelte-xcscli{flex-shrink:0;padding:1rem;border-bottom:1px solid var(--color-border-default);background-color:var(--color-surface-secondary);display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.preview-body.svelte-xcscli{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column}.content-header.svelte-xcscli{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.content-type-icon.svelte-xcscli{font-size:1.25rem}.content-type.svelte-xcscli{font-family:var(--font-mono);font-size:.875rem;color:var(--color-text-secondary)}.preview-error.svelte-xcscli{color:var(--color-error);padding:1rem;background-color:var(--color-error-subtle);border-radius:var(--radius-sm);margin-bottom:1rem}.text-preview.svelte-xcscli{flex:1}.text-content.svelte-xcscli{background-color:var(--color-surface-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1rem;font-family:var(--font-mono);font-size:.8125rem;line-height:1.4;overflow:auto;white-space:pre-wrap;word-wrap:break-word}.image-preview.svelte-xcscli,.audio-preview.svelte-xcscli,.video-preview.svelte-xcscli{margin-bottom:1rem}.preview-image.svelte-xcscli{max-width:100%;height:auto;border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.preview-audio.svelte-xcscli{width:100%;max-width:400px}.preview-video.svelte-xcscli{width:100%;max-width:600px;height:auto;border-radius:var(--radius-sm)}.binary-preview.svelte-xcscli{padding:1rem;background-color:var(--color-surface-secondary);border-radius:var(--radius-sm);text-align:center;color:var(--color-text-secondary);margin-bottom:1rem}.binary-info.svelte-xcscli{font-size:.875rem;margin-top:.5rem}.preview-actions.svelte-xcscli{flex-shrink:0;display:flex;gap:.5rem;align-items:flex-start}.action-button.svelte-xcscli{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.action-button.svelte-xcscli:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.download-button.svelte-xcscli:hover{color:var(--color-interactive-secondary);border-color:var(--color-interactive-secondary)}.edit-button.svelte-xcscli:hover{color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.delete-button.svelte-xcscli:hover{color:var(--color-error);border-color:var(--color-error)}.outline-editor{display:flex;flex-direction:column;height:100%;width:100%}.outline-editor__textarea{flex:1;min-height:200px;padding:var(--spacing-4);font-family:var(--font-family-mono);font-size:var(--font-size-base);line-height:var(--line-height-relaxed);border:1px solid var(--color-border-subtle);border-radius:var(--border-radius-md);background-color:var(--color-surface);color:var(--color-text-primary);resize:none;overflow-y:auto;transition:border-color var(--transition-fast)}.outline-editor__textarea:focus{outline:none;border-color:var(--color-border-focus);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus-ring)}.outline-editor__textarea::placeholder{color:var(--color-text-subtle);font-style:italic}@media (prefers-contrast: high){.outline-editor__textarea{border-width:2px}.outline-editor__textarea:focus{border-color:var(--color-text-primary);box-shadow:0 0 0 calc(var(--focus-ring-width) + 1px) var(--color-focus-ring)}}@media (prefers-reduced-motion: reduce){.outline-editor__textarea{transition:none}}@media (max-width: 768px){.outline-editor__textarea{min-height:44px;padding:var(--spacing-3);font-size:var(--font-size-lg)}}[data-theme=dark] .outline-editor__textarea{background-color:var(--color-surface-elevated);border-color:var(--color-border-subtle)}[data-theme=dark] .outline-editor__textarea:focus{border-color:var(--color-border-focus)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.outline-view.svelte-vjoxn9{height:100%;width:100%}.sr-only.svelte-vjoxn9{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.content-preview.svelte-166aukc{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:#000;overflow:hidden}.content-preview__container.svelte-166aukc{transform-origin:center;width:100%;height:100%}.content-preview__letterbox.svelte-166aukc{background:#000;display:flex;justify-content:center;align-items:center;width:100%;height:100%}.content-preview__iframe.svelte-166aukc{border:none;background:#fff;min-width:320px;min-height:400px}.workspace-header.svelte-eqvpc4{display:flex;align-items:center;gap:var(--space-2);padding-inline:var(--space-4);padding-block:var(--space-2);min-height:40px;font-size:var(--text-sm);color:var(--color-text-secondary);overflow:hidden}.workspace-title.svelte-eqvpc4{margin:0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:300px;flex-shrink:0}.separator.svelte-eqvpc4{color:var(--color-text-tertiary);flex-shrink:0;font-weight:700}.workspace-author.svelte-eqvpc4{font-size:var(--text-sm);color:var(--color-text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;flex-shrink:2;min-width:0}.workspace-extensions.svelte-eqvpc4{font-size:var(--text-sm);color:var(--color-text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:3;min-width:0}@media (max-width: 768px){.workspace-header.svelte-eqvpc4{padding-inline:var(--space-3)}.workspace-title.svelte-eqvpc4{max-width:none}.workspace-author.svelte-eqvpc4{max-width:120px}.workspace-extensions.svelte-eqvpc4{max-width:100px}}@media (max-width: 640px){.workspace-author.svelte-eqvpc4,.workspace-extensions.svelte-eqvpc4{display:none}}.loading-state.svelte-1pwtvzx,.error-state.svelte-1pwtvzx{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:2rem;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-1pwtvzx{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-1pwtvzx-spin 1s linear infinite;margin-bottom:1rem}@keyframes svelte-1pwtvzx-spin{to{transform:rotate(360deg)}}.error-state.svelte-1pwtvzx{color:var(--color-error-text)}.error-state.svelte-1pwtvzx h2:where(.svelte-1pwtvzx){margin:0 0 1rem;font-size:1.5rem;font-weight:600}.error-state.svelte-1pwtvzx p:where(.svelte-1pwtvzx){margin:.5rem 0;font-size:1rem}@media (prefers-reduced-motion: reduce){.spinner.svelte-1pwtvzx{animation:none}}.placeholder-content.svelte-1pwtvzx{padding:1rem;color:var(--color-text-secondary)}.placeholder-content.svelte-1pwtvzx h3:where(.svelte-1pwtvzx){margin:0 0 .5rem;font-size:1rem;font-weight:600}.placeholder-content.svelte-1pwtvzx p:where(.svelte-1pwtvzx){margin:0;font-size:.875rem;opacity:.8}.current-view-info.svelte-1pwtvzx{margin-top:1rem!important;padding:.5rem;background:var(--color-bg-secondary);border-radius:4px;font-size:.75rem!important}</style>
  <script>window.__EDITME_I18N_BUNDLE__ = 'data:application/zip;base64,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';</script></head>
  <body>
    <div id="app"></div>
  </body>
</html>
