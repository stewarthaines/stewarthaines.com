<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF/QA6OjoAKysrABwcH" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEED.html</title>
    <link rel="manifest" href="manifest.json" />
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js' + '?v0.4.3');
      }
    </script>
    <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Ii=!1;var ir=Array.isArray,Lo=Array.prototype.indexOf,ei=Array.from,ss=Object.defineProperty,Rn=Object.getOwnPropertyDescriptor,os=Object.getOwnPropertyDescriptors,ls=Object.prototype,Ro=Array.prototype,pa=Object.getPrototypeOf,Fi=Object.isExtensible;const en=()=>{};function Do(r){return r()}function Fr(r){for(var e=0;e<r.length;e++)r[e]()}function Ao(r,e){if(Array.isArray(r))return r;if(!(Symbol.iterator in r))return Array.from(r);const t=[];for(const a of r)if(t.push(a),t.length===e)break;return t}const tn=2,cs=4,ha=8,ti=16,_n=32,zn=64,ta=128,Xt=256,na=512,jt=1024,pn=2048,Mn=4096,wn=8192,va=16384,Oo=32768,ma=65536,ds=1<<17,us=1<<19,fs=1<<20,Ha=1<<21,yn=Symbol("$state"),Uo=Symbol("legacy props"),zo=Symbol("");function ps(r){return r===this.v}function hs(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function ni(r){return!hs(r,this.v)}function Wo(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function No(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function jo(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Bo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ho(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Vo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function qo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function $o(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let sr=!1,Go=!1;function Xo(){sr=!0}const ri=1,ai=2,vs=4,Ko=8,Yo=16,Jo=1,Zo=2,Qo=4,el=8,tl=16,nl=1,rl=2,Vt=Symbol(),al="http://www.w3.org/1999/xhtml",ms="@attach",il=[];function sl(r,e=!1){return Jr(r,new Map,"",il)}function Jr(r,e,t,a,n=null){if(typeof r=="object"&&r!==null){var i=e.get(r);if(i!==void 0)return i;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(ir(r)){var o=Array(r.length);e.set(r,o),n!==null&&e.set(n,o);for(var l=0;l<r.length;l+=1){var d=r[l];l in r&&(o[l]=Jr(d,e,t,a))}return o}if(pa(r)===ls){o={},e.set(r,o),n!==null&&e.set(n,o);for(var f in r)o[f]=Jr(r[f],e,t,a);return o}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return Jr(r.toJSON(),e,t,a,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}function ga(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let vt=null;function Mi(r){vt=r}function Pi(r){return ii().get(r)}function ol(r,e){return ii().set(r,e),e}function ll(r){return ii().has(r)}function rt(r,e=!1,t){var a=vt={p:vt,c:null,d:!1,e:null,m:!1,s:r,x:null,l:null};sr&&!e&&(vt.l={s:null,u:null,r1:[],r2:tr(!1)}),ya(()=>{a.d=!0})}function at(r){const e=vt;if(e!==null){r!==void 0&&(e.x=r);const o=e.e;if(o!==null){var t=yt,a=wt;e.e=null;try{for(var n=0;n<o.length;n++){var i=o[n];In(i.effect),hn(i.reaction),or(i.fn)}}finally{In(t),hn(a)}}vt=e.p,e.m=!0}return r||{}}function zr(){return!sr||vt!==null&&vt.l===null}function ii(r){return vt===null&&ga(),vt.c??=new Map(cl(vt)||void 0)}function cl(r){let e=r.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}function It(r){if(typeof r!="object"||r===null||yn in r)return r;const e=pa(r);if(e!==ls&&e!==Ro)return r;var t=new Map,a=ir(r),n=fe(0),i=wt,o=l=>{var d=wt;hn(i);var f=l();return hn(d),f};return a&&t.set("length",fe(r.length)),new Proxy(r,{defineProperty(l,d,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Vo();var c=t.get(d);return c===void 0?(c=o(()=>fe(f.value)),t.set(d,c)):m(c,o(()=>It(f.value))),!0},deleteProperty(l,d){var f=t.get(d);if(f===void 0)d in l&&(t.set(d,o(()=>fe(Vt))),Pa(n));else{if(a&&typeof d=="string"){var c=t.get("length"),p=Number(d);Number.isInteger(p)&&p<c.v&&m(c,p)}m(f,Vt),Pa(n)}return!0},get(l,d,f){if(d===yn)return r;var c=t.get(d),p=d in l;if(c===void 0&&(!p||Rn(l,d)?.writable)&&(c=o(()=>fe(It(p?l[d]:Vt))),t.set(d,c)),c!==void 0){var h=s(c);return h===Vt?void 0:h}return Reflect.get(l,d,f)},getOwnPropertyDescriptor(l,d){var f=Reflect.getOwnPropertyDescriptor(l,d);if(f&&"value"in f){var c=t.get(d);c&&(f.value=s(c))}else if(f===void 0){var p=t.get(d),h=p?.v;if(p!==void 0&&h!==Vt)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return f},has(l,d){if(d===yn)return!0;var f=t.get(d),c=f!==void 0&&f.v!==Vt||Reflect.has(l,d);if(f!==void 0||yt!==null&&(!c||Rn(l,d)?.writable)){f===void 0&&(f=o(()=>fe(c?It(l[d]):Vt)),t.set(d,f));var p=s(f);if(p===Vt)return!1}return c},set(l,d,f,c){var p=t.get(d),h=d in l;if(a&&d==="length")for(var v=f;v<p.v;v+=1){var g=t.get(v+"");g!==void 0?m(g,Vt):v in l&&(g=o(()=>fe(Vt)),t.set(v+"",g))}p===void 0?(!h||Rn(l,d)?.writable)&&(p=o(()=>fe(void 0)),m(p,o(()=>It(f))),t.set(d,p)):(h=p.v!==Vt,m(p,o(()=>It(f))));var b=Reflect.getOwnPropertyDescriptor(l,d);if(b?.set&&b.set.call(c,f),!h){if(a&&typeof d=="string"){var y=t.get("length"),L=Number(d);Number.isInteger(L)&&L>=y.v&&m(y,L+1)}Pa(n)}return!0},ownKeys(l){s(n);var d=Reflect.ownKeys(l).filter(p=>{var h=t.get(p);return h===void 0||h.v!==Vt});for(var[f,c]of t)c.v!==Vt&&!(f in l)&&d.push(f);return d},setPrototypeOf(){qo()}})}function Pa(r,e=1){m(r,r.v+e)}function Li(r){try{if(r!==null&&typeof r=="object"&&yn in r)return r[yn]}catch{}return r}function dl(r,e){return Object.is(Li(r),Li(e))}function On(r){var e=tn|pn,t=wt!==null&&(wt.f&tn)!==0?wt:null;return yt===null||t!==null&&(t.f&Xt)!==0?e|=Xt:yt.f|=fs,{ctx:vt,deps:null,effects:null,equals:ps,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??yt}}function ne(r){const e=On(r);return Ds(e),e}function De(r){const e=On(r);return e.equals=ni,e}function gs(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Kt(e[t])}}function ul(r){for(var e=r.parent;e!==null;){if((e.f&tn)===0)return e;e=e.parent}return null}function ws(r){var e,t=yt;In(ul(r));try{gs(r),e=zs(r)}finally{In(t)}return e}function ys(r){var e=ws(r);if(r.equals(e)||(r.v=e,r.wv=Os()),!cr){var t=(Tn||(r.f&Xt)!==0)&&r.deps!==null?Mn:jt;nn(r,t)}}const Mr=new Map;function tr(r,e){var t={f:0,v:r,reactions:null,equals:ps,rv:0,wv:0};return t}function fe(r,e){const t=tr(r);return Ds(t),t}function st(r,e=!1){const t=tr(r);return e||(t.equals=ni),sr&&vt!==null&&vt.l!==null&&(vt.l.s??=[]).push(t),t}function St(r,e){return m(r,At(()=>s(r))),e}function m(r,e,t=!1){wt!==null&&!ln&&zr()&&(wt.f&(tn|ti))!==0&&!bn?.includes(r)&&$o();let a=t?It(e):e;return Pr(r,a)}function Pr(r,e){if(!r.equals(e)){var t=r.v;cr?Mr.set(r,e):Mr.set(r,t),r.v=e,(r.f&tn)!==0&&((r.f&pn)!==0&&ws(r),nn(r,(r.f&Xt)===0?jt:Mn)),r.wv=Os(),bs(r,pn),zr()&&yt!==null&&(yt.f&jt)!==0&&(yt.f&(_n|zn))===0&&(Yt===null?Sl([r]):Yt.push(r))}return e}function bs(r,e){var t=r.reactions;if(t!==null)for(var a=zr(),n=t.length,i=0;i<n;i++){var o=t[i],l=o.f;(l&pn)===0&&(!a&&o===yt||(nn(o,e),(l&(jt|Xt))!==0&&((l&tn)!==0?bs(o,Mn):Sa(o))))}}function fl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let pl=!1;var Va,_s,xs,Ss,Es;function hl(){if(Va===void 0){Va=window,_s=document,xs=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Ss=Rn(e,"firstChild").get,Es=Rn(e,"nextSibling").get,Fi(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Fi(t)&&(t.__t=void 0)}}function Wr(r=""){return document.createTextNode(r)}function un(r){return Ss.call(r)}function wa(r){return Es.call(r)}function u(r,e){return un(r)}function et(r,e){{var t=un(r);return t instanceof Comment&&t.data===""?wa(t):t}}function w(r,e=1,t=!1){let a=r;for(;e--;)a=wa(a);return a}function vl(r){r.textContent=""}function ks(r){yt===null&&wt===null&&jo(),wt!==null&&(wt.f&Xt)!==0&&yt===null&&No(),cr&&Wo()}function ml(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Wn(r,e,t,a=!0){var n=yt,i={ctx:vt,deps:null,nodes_start:null,nodes_end:null,f:r|pn,first:null,fn:e,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(t)try{xa(i),i.f|=Oo}catch(d){throw Kt(i),d}else e!==null&&Sa(i);var o=t&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&(fs|ta))===0;if(!o&&a&&(n!==null&&ml(i,n),wt!==null&&(wt.f&tn)!==0)){var l=wt;(l.effects??=[]).push(i)}return i}function gl(){return wt!==null&&!ln}function ya(r){const e=Wn(ha,null,!1);return nn(e,jt),e.teardown=r,e}function ht(r){ks();var e=yt!==null&&(yt.f&_n)!==0&&vt!==null&&!vt.m;if(e){var t=vt;(t.e??=[]).push({fn:r,effect:yt,reaction:wt})}else{var a=or(r);return a}}function Ts(r){return ks(),lr(r)}function wl(r){const e=Wn(zn,r,!0);return()=>{Kt(e)}}function yl(r){const e=Wn(zn,r,!0);return(t={})=>new Promise(a=>{t.outro?ra(e,()=>{Kt(e),a(void 0)}):(Kt(e),a(void 0))})}function or(r){return Wn(cs,r,!1)}function Rt(r,e){var t=vt,a={effect:null,ran:!1};t.l.r1.push(a),a.effect=lr(()=>{r(),!a.ran&&(a.ran=!0,m(t.l.r2,!0),At(e))})}function xn(){var r=vt;lr(()=>{if(s(r.l.r2)){for(var e of r.l.r1){var t=e.effect;(t.f&jt)!==0&&nn(t,Mn),dr(t)&&xa(t),e.ran=!1}r.l.r2.v=!1}})}function lr(r){return Wn(ha,r,!0)}function D(r,e=[],t=On){const a=e.map(t);return Nn(()=>r(...a.map(s)))}function Nn(r,e=0){return Wn(ha|ti|e,r,!0)}function Cn(r,e=!0){return Wn(ha|_n,r,!0,e)}function Cs(r){var e=r.teardown;if(e!==null){const t=cr,a=wt;Ri(!0),hn(null);try{e.call(null)}finally{Ri(t),hn(a)}}}function Is(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var a=t.next;(t.f&zn)!==0?t.parent=null:Kt(t,e),t=a}}function bl(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&_n)===0&&Kt(e),e=t}}function Kt(r,e=!0){var t=!1;(e||(r.f&us)!==0)&&r.nodes_start!==null&&(Fs(r.nodes_start,r.nodes_end),t=!0),Is(r,e&&!t),la(r,0),nn(r,va);var a=r.transitions;if(a!==null)for(const i of a)i.stop();Cs(r);var n=r.parent;n!==null&&n.first!==null&&Ms(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function Fs(r,e){for(;r!==null;){var t=r===e?null:wa(r);r.remove(),r=t}}function Ms(r){var e=r.parent,t=r.prev,a=r.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===r&&(e.first=a),e.last===r&&(e.last=t))}function ra(r,e){var t=[];si(r,t,!0),Ps(t,()=>{Kt(r),e&&e()})}function Ps(r,e){var t=r.length;if(t>0){var a=()=>--t||e();for(var n of r)n.out(a)}else e()}function si(r,e,t){if((r.f&wn)===0){if(r.f^=wn,r.transitions!==null)for(const o of r.transitions)(o.is_global||t)&&e.push(o);for(var a=r.first;a!==null;){var n=a.next,i=(a.f&ma)!==0||(a.f&_n)!==0;si(a,e,i?t:!1),a=n}}}function aa(r){Ls(r,!0)}function Ls(r,e){if((r.f&wn)!==0){r.f^=wn,(r.f&jt)===0&&(r.f^=jt),dr(r)&&(nn(r,pn),Sa(r));for(var t=r.first;t!==null;){var a=t.next,n=(t.f&ma)!==0||(t.f&_n)!==0;Ls(t,n?e:!1),t=a}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let Lr=[],qa=[];function Rs(){var r=Lr;Lr=[],Fr(r)}function _l(){var r=qa;qa=[],Fr(r)}function ba(r){Lr.length===0&&queueMicrotask(Rs),Lr.push(r)}function xl(){Lr.length>0&&Rs(),qa.length>0&&_l()}let Zr=!1,ia=!1,sa=null,Dn=!1,cr=!1;function Ri(r){cr=r}let Er=[];let wt=null,ln=!1;function hn(r){wt=r}let yt=null;function In(r){yt=r}let bn=null;function Ds(r){wt!==null&&wt.f&Ha&&(bn===null?bn=[r]:bn.push(r))}let zt=null,$t=0,Yt=null;function Sl(r){Yt=r}let As=1,oa=0,Tn=!1,kn=null;function Os(){return++As}function dr(r){var e=r.f;if((e&pn)!==0)return!0;if((e&Mn)!==0){var t=r.deps,a=(e&Xt)!==0;if(t!==null){var n,i,o=(e&na)!==0,l=a&&yt!==null&&!Tn,d=t.length;if(o||l){var f=r,c=f.parent;for(n=0;n<d;n++)i=t[n],(o||!i?.reactions?.includes(f))&&(i.reactions??=[]).push(f);o&&(f.f^=na),l&&c!==null&&(c.f&Xt)===0&&(f.f^=Xt)}for(n=0;n<d;n++)if(i=t[n],dr(i)&&ys(i),i.wv>r.wv)return!0}(!a||yt!==null&&!Tn)&&nn(r,jt)}return!1}function El(r,e){for(var t=e;t!==null;){if((t.f&ta)!==0)try{t.fn(r);return}catch{t.f^=ta}t=t.parent}throw Zr=!1,r}function Di(r){return(r.f&va)===0&&(r.parent===null||(r.parent.f&ta)===0)}function _a(r,e,t,a){if(Zr){if(t===null&&(Zr=!1),Di(e))throw r;return}if(t!==null&&(Zr=!0),El(r,e),Di(e))throw r}function Us(r,e,t=!0){var a=r.reactions;if(a!==null)for(var n=0;n<a.length;n++){var i=a[n];bn?.includes(r)||((i.f&tn)!==0?Us(i,e,!1):e===i&&(t?nn(i,pn):(i.f&jt)!==0&&nn(i,Mn),Sa(i)))}}function zs(r){var e=zt,t=$t,a=Yt,n=wt,i=Tn,o=bn,l=vt,d=ln,f=r.f;zt=null,$t=0,Yt=null,Tn=(f&Xt)!==0&&(ln||!Dn||wt===null),wt=(f&(_n|zn))===0?r:null,bn=null,Mi(r.ctx),ln=!1,oa++,r.f|=Ha;try{var c=(0,r.fn)(),p=r.deps;if(zt!==null){var h;if(la(r,$t),p!==null&&$t>0)for(p.length=$t+zt.length,h=0;h<zt.length;h++)p[$t+h]=zt[h];else r.deps=p=zt;if(!Tn)for(h=$t;h<p.length;h++)(p[h].reactions??=[]).push(r)}else p!==null&&$t<p.length&&(la(r,$t),p.length=$t);if(zr()&&Yt!==null&&!ln&&p!==null&&(r.f&(tn|Mn|pn))===0)for(h=0;h<Yt.length;h++)Us(Yt[h],r);return n!==null&&n!==r&&(oa++,Yt!==null&&(a===null?a=Yt:a.push(...Yt))),c}finally{zt=e,$t=t,Yt=a,wt=n,Tn=i,bn=o,Mi(l),ln=d,r.f^=Ha}}function kl(r,e){let t=e.reactions;if(t!==null){var a=Lo.call(t,r);if(a!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[a]=t[n],t.pop())}}t===null&&(e.f&tn)!==0&&(zt===null||!zt.includes(e))&&(nn(e,Mn),(e.f&(Xt|na))===0&&(e.f^=na),gs(e),la(e,0))}function la(r,e){var t=r.deps;if(t!==null)for(var a=e;a<t.length;a++)kl(r,t[a])}function xa(r){var e=r.f;if((e&va)===0){nn(r,jt);var t=yt,a=vt,n=Dn;yt=r,Dn=!0;try{(e&ti)!==0?bl(r):Is(r),Cs(r);var i=zs(r);r.teardown=typeof i=="function"?i:null,r.wv=As;var o=r.deps,l;Ii&&Go&&r.f&pn}catch(d){_a(d,r,t,a||r.ctx)}finally{Dn=n,yt=t}}}function Tl(){try{Bo()}catch(r){if(sa!==null)_a(r,sa,null);else throw r}}function Ws(){var r=Dn;try{var e=0;for(Dn=!0;Er.length>0;){e++>1e3&&Tl();var t=Er,a=t.length;Er=[];for(var n=0;n<a;n++){var i=Il(t[n]);Cl(i)}Mr.clear()}}finally{ia=!1,Dn=r,sa=null}}function Cl(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var a=r[t];if((a.f&(va|wn))===0)try{dr(a)&&(xa(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?Ms(a):a.fn=null))}catch(n){_a(n,a,null,a.ctx)}}}function Sa(r){ia||(ia=!0,queueMicrotask(Ws));for(var e=sa=r;e.parent!==null;){e=e.parent;var t=e.f;if((t&(zn|_n))!==0){if((t&jt)===0)return;e.f^=jt}}Er.push(e)}function Il(r){for(var e=[],t=r;t!==null;){var a=t.f,n=(a&(_n|zn))!==0,i=n&&(a&jt)!==0;if(!i&&(a&wn)===0){if((a&cs)!==0)e.push(t);else if(n)t.f^=jt;else try{dr(t)&&xa(t)}catch(d){_a(d,t,null,t.ctx)}var o=t.first;if(o!==null){t=o;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}return e}function Fl(r){for(var e;;){if(xl(),Er.length===0)return e;ia=!0,Ws()}}async function Ns(){await Promise.resolve(),Fl()}function s(r){var e=r.f,t=(e&tn)!==0;if(kn!==null&&kn.add(r),wt!==null&&!ln){if(!bn?.includes(r)){var a=wt.deps;r.rv<oa&&(r.rv=oa,zt===null&&a!==null&&a[$t]===r?$t++:zt===null?zt=[r]:(!Tn||!zt.includes(r))&&zt.push(r))}}else if(t&&r.deps===null&&r.effects===null){var n=r,i=n.parent;i!==null&&(i.f&Xt)===0&&(n.f^=Xt)}return t&&(n=r,dr(n)&&ys(n)),cr&&Mr.has(r)?Mr.get(r):r.v}function Ml(r){var e=kn;kn=new Set;var t=kn,a;try{if(At(r),e!==null)for(a of kn)e.add(a)}finally{kn=e}return t}function Pl(r){var e=Ml(()=>At(r));for(var t of e)if((t.f&ds)!==0)for(const a of t.deps||[])(a.f&tn)===0&&Pr(a,a.v);else Pr(t,t.v)}function At(r){var e=ln;try{return ln=!0,r()}finally{ln=e}}const Ll=-7169;function nn(r,e){r.f=r.f&Ll|e}function Lt(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(yn in r)$a(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&yn in t&&$a(t)}}}function $a(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let a in r)try{$a(r[a],e)}catch{}const t=pa(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=os(t);for(let n in a){const i=a[n].get;if(i)try{i.call(r)}catch{}}}}}function Rl(){return Symbol(ms)}function Dl(r){return r.endsWith("capture")&&r!=="gotpointercapture"&&r!=="lostpointercapture"}const Al=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Ol(r){return Al.includes(r)}const Ul={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function zl(r){return r=r.toLowerCase(),Ul[r]??r}const Wl=["touchstart","touchmove"];function Nl(r){return Wl.includes(r)}function jl(r,e){if(e){const t=document.body;r.autofocus=!0,ba(()=>{document.activeElement===t&&r.focus()})}}let Ai=!1;function Bl(){Ai||(Ai=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function js(r){var e=wt,t=yt;hn(null),In(null);try{return r()}finally{hn(e),In(t)}}function Bs(r,e,t,a=t){r.addEventListener(e,()=>js(t));const n=r.__on_r;n?r.__on_r=()=>{n(),a(!0)}:r.__on_r=()=>a(!0),Bl()}const Hs=new Set,Ga=new Set;function oi(r,e,t,a={}){function n(i){if(a.capture||xr.call(e,i),!i.cancelBubble)return js(()=>t?.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?ba(()=>{e.addEventListener(r,n,a)}):e.addEventListener(r,n,a),n}function dn(r,e,t,a={}){var n=oi(e,r,t,a);return()=>{r.removeEventListener(e,n,a)}}function nt(r,e,t,a,n){var i={capture:a,passive:n},o=oi(r,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ya(()=>{e.removeEventListener(r,o,i)})}function _t(r){for(var e=0;e<r.length;e++)Hs.add(r[e]);for(var t of Ga)t(r)}function xr(r){var e=this,t=e.ownerDocument,a=r.type,n=r.composedPath?.()||[],i=n[0]||r.target,o=0,l=r.__root;if(l){var d=n.indexOf(l);if(d!==-1&&(e===document||e===window)){r.__root=e;return}var f=n.indexOf(e);if(f===-1)return;d<=f&&(o=d)}if(i=n[o]||r.target,i!==e){ss(r,"currentTarget",{configurable:!0,get(){return i||t}});var c=wt,p=yt;hn(null),In(null);try{for(var h,v=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var b=i["__"+a];if(b!=null&&(!i.disabled||r.target===i))if(ir(b)){var[y,...L]=b;y.apply(i,[r,...L])}else b.call(i,r)}catch(k){h?v.push(k):h=k}if(r.cancelBubble||g===e||g===null)break;i=g}if(h){for(let k of v)queueMicrotask(()=>{throw k});throw h}}finally{r.__root=e,delete r.currentTarget,hn(c),In(p)}}}function Hl(r){var e;e=document.head.appendChild(Wr());try{Nn(()=>r(e),us)}finally{}}function li(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","\x3C!---->"),e.content}function nr(r,e){var t=yt;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function I(r,e){var t=(e&nl)!==0,a=(e&rl)!==0,n,i=!r.startsWith("<!>");return()=>{n===void 0&&(n=li(i?r:"<!>"+r),t||(n=un(n)));var o=a||xs?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=un(o),d=o.lastChild;nr(l,d)}else nr(o,o);return o}}function Vl(r,e,t="svg"){var a=!r.startsWith("<!>"),n=`<${t}>${a?r:"<!>"+r}</${t}>`,i;return()=>{if(!i){var o=li(n),l=un(o);i=un(l)}var d=i.cloneNode(!0);return nr(d,d),d}}function Vs(r,e){return Vl(r,e,"svg")}function Tt(r=""){{var e=Wr(r+"");return nr(e,e),e}}function pt(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Wr();return r.append(e,t),nr(e,t),r}function _(r,e){r!==null&&r.before(e)}function ci(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function S(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function ql(r,e){return $l(r,e)}const jn=new Map;function $l(r,{target:e,anchor:t,props:a={},events:n,context:i,intro:o=!0}){hl();var l=new Set,d=p=>{for(var h=0;h<p.length;h++){var v=p[h];if(!l.has(v)){l.add(v);var g=Nl(v);e.addEventListener(v,xr,{passive:g});var b=jn.get(v);b===void 0?(document.addEventListener(v,xr,{passive:g}),jn.set(v,1)):jn.set(v,b+1)}}};d(ei(Hs)),Ga.add(d);var f=void 0,c=yl(()=>{var p=t??e.appendChild(Wr());return Cn(()=>{if(i){rt({});var h=vt;h.c=i}n&&(a.$$events=n),f=r(p,a)||{},i&&at()}),()=>{for(var h of l){e.removeEventListener(h,xr);var v=jn.get(h);--v===0?(document.removeEventListener(h,xr),jn.delete(h)):jn.set(h,v)}Ga.delete(d),p!==t&&p.parentNode?.removeChild(p)}});return Gl.set(f,c),f}let Gl=new WeakMap;function U(r,e,[t,a]=[0,0]){var n=r,i=null,o=null,l=Vt,d=t>0?ma:0,f=!1;const c=(h,v=!0)=>{f=!0,p(v,h)},p=(h,v)=>{l!==(l=h)&&(l?(i?aa(i):v&&(i=Cn(()=>v(n))),o&&ra(o,()=>{o=null})):(o?aa(o):v&&(o=Cn(()=>v(n,[t+1,a]))),i&&ra(i,()=>{i=null})))};Nn(()=>{f=!1,e(c),f||p(null,null)},d)}function Pt(r,e){return e}function Xl(r,e,t,a){for(var n=[],i=e.length,o=0;o<i;o++)si(e[o].e,n,!0);var l=i>0&&n.length===0&&t!==null;if(l){var d=t.parentNode;vl(d),d.append(t),a.clear(),En(r,e[0].prev,e[i-1].next)}Ps(n,()=>{for(var f=0;f<i;f++){var c=e[f];l||(a.delete(c.k),En(r,c.prev,c.next)),Kt(c.e,!l)}})}function Ct(r,e,t,a,n,i=null){var o=r,l={flags:e,items:new Map,first:null},d=(e&vs)!==0;if(d){var f=r;o=f.appendChild(Wr())}var c=null,p=!1,h=De(()=>{var v=t();return ir(v)?v:v==null?[]:ei(v)});Nn(()=>{var v=s(h),g=v.length;p&&g===0||(p=g===0,Kl(v,l,o,n,e,a,t),i!==null&&(g===0?c?aa(c):c=Cn(()=>i(o)):c!==null&&ra(c,()=>{c=null})),s(h))})}function Kl(r,e,t,a,n,i,o){var l=(n&Ko)!==0,d=(n&(ri|ai))!==0,f=r.length,c=e.items,p=e.first,h=p,v,g=null,b,y=[],L=[],k,E,T,P;if(l)for(P=0;P<f;P+=1)k=r[P],E=i(k,P),T=c.get(E),T!==void 0&&(T.a?.measure(),(b??=new Set).add(T));for(P=0;P<f;P+=1){if(k=r[P],E=i(k,P),T=c.get(E),T===void 0){var $=h?h.e.nodes_start:t;g=Jl($,e,g,g===null?e.first:g.next,k,E,P,a,n,o),c.set(E,g),y=[],L=[],h=g.next;continue}if(d&&Yl(T,k,P,n),(T.e.f&wn)!==0&&(aa(T.e),l&&(T.a?.unfix(),(b??=new Set).delete(T))),T!==h){if(v!==void 0&&v.has(T)){if(y.length<L.length){var R=L[0],z;g=R.prev;var O=y[0],W=y[y.length-1];for(z=0;z<y.length;z+=1)Oi(y[z],R,t);for(z=0;z<L.length;z+=1)v.delete(L[z]);En(e,O.prev,W.next),En(e,g,O),En(e,W,R),h=R,g=W,P-=1,y=[],L=[]}else v.delete(T),Oi(T,h,t),En(e,T.prev,T.next),En(e,T,g===null?e.first:g.next),En(e,g,T),g=T;continue}for(y=[],L=[];h!==null&&h.k!==E;)(h.e.f&wn)===0&&(v??=new Set).add(h),L.push(h),h=h.next;if(h===null)continue;T=h}y.push(T),g=T,h=T.next}if(h!==null||v!==void 0){for(var N=v===void 0?[]:ei(v);h!==null;)(h.e.f&wn)===0&&N.push(h),h=h.next;var j=N.length;if(j>0){var x=(n&vs)!==0&&f===0?t:null;if(l){for(P=0;P<j;P+=1)N[P].a?.measure();for(P=0;P<j;P+=1)N[P].a?.fix()}Xl(e,N,x,c)}}l&&ba(()=>{if(b!==void 0)for(T of b)T.a?.apply()}),yt.first=e.first&&e.first.e,yt.last=g&&g.e}function Yl(r,e,t,a){(a&ri)!==0&&Pr(r.v,e),(a&ai)!==0?Pr(r.i,t):r.i=t}function Jl(r,e,t,a,n,i,o,l,d,f){var c=(d&ri)!==0,p=(d&Yo)===0,h=c?p?st(n):tr(n):n,v=(d&ai)===0?o:tr(o),g={i:v,v:h,k:i,a:null,e:null,prev:t,next:a};try{return g.e=Cn(()=>l(r,h,v,f),pl),g.e.prev=t&&t.e,g.e.next=a&&a.e,t===null?e.first=g:(t.next=g,t.e.next=g.e),a!==null&&(a.prev=g,a.e.prev=g.e),g}finally{}}function Oi(r,e,t){for(var a=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==a;){var o=wa(i);n.before(i),i=o}}function En(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function qs(r,e,t=!1,a=!1,n=!1){var i=r,o="";D(()=>{var l=yt;if(o!==(o=e()??"")&&(l.nodes_start!==null&&(Fs(l.nodes_start,l.nodes_end),l.nodes_start=l.nodes_end=null),o!=="")){var d=o+"";t?d=`<svg>${d}</svg>`:a&&(d=`<math>${d}</math>`);var f=li(d);if((t||a)&&(f=un(f)),nr(un(f),f.lastChild),t||a)for(;un(f);)i.before(un(f));else i.before(f)}})}function Dt(r,e,t,a,n){var i=e.$$slots?.[t],o=!1;i===!0&&(i=e[t==="default"?"children":t],o=!0),i===void 0||i(r,o?()=>a:a)}function rr(r,e,...t){var a=r,n=en,i;Nn(()=>{n!==(n=e())&&(i&&(Kt(i),i=null),i=Cn(()=>n(a,...t)))},ma)}function Zl(r,e){var t=void 0,a;Nn(()=>{t!==(t=e())&&(a&&(Kt(a),a=null),t&&(a=Cn(()=>{or(()=>t(r))})))})}function $s(r){var e,t,a="";if(typeof r=="string"||typeof r=="number")a+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=$s(r[e]))&&(a&&(a+=" "),a+=t)}else for(t in r)r[t]&&(a&&(a+=" "),a+=t);return a}function Qr(){for(var r,e,t=0,a="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=$s(r))&&(a&&(a+=" "),a+=e);return a}function Ql(r){return typeof r=="object"?Qr(r):r??""}const Ui=[...` 	
\r\fÂ \v\uFEFF`];function ec(r,e,t){var a=r==null?"":""+r;if(e&&(a=a?a+" "+e:e),t){for(var n in t)if(t[n])a=a?a+" "+n:n;else if(a.length)for(var i=n.length,o=0;(o=a.indexOf(n,o))>=0;){var l=o+i;(o===0||Ui.includes(a[o-1]))&&(l===a.length||Ui.includes(a[l]))?a=(o===0?"":a.substring(0,o))+a.substring(l+1):o=l}}return a===""?null:a}function zi(r,e=!1){var t=e?" !important;":";",a="";for(var n in r){var i=r[n];i!=null&&i!==""&&(a+=" "+n+": "+i+t)}return a}function La(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function tc(r,e){if(e){var t="",a,n;if(Array.isArray(e)?(a=e[0],n=e[1]):a=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,o=0,l=!1,d=[];a&&d.push(...Object.keys(a).map(La)),n&&d.push(...Object.keys(n).map(La));var f=0,c=-1;const b=r.length;for(var p=0;p<b;p++){var h=r[p];if(l?h==="/"&&r[p-1]==="*"&&(l=!1):i?i===h&&(i=!1):h==="/"&&r[p+1]==="*"?l=!0:h==='"'||h==="'"?i=h:h==="("?o++:h===")"&&o--,!l&&i===!1&&o===0){if(h===":"&&c===-1)c=p;else if(h===";"||p===b-1){if(c!==-1){var v=La(r.substring(f,c).trim());if(!d.includes(v)){h!==";"&&p++;var g=r.substring(f,p).trim();t+=" "+g+";"}}f=p+1,c=-1}}}}return a&&(t+=zi(a)),n&&(t+=zi(n,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function ct(r,e,t,a,n,i){var o=r.__className;if(o!==t||o===void 0){var l=ec(t,a,i);l==null?r.removeAttribute("class"):e?r.className=l:r.setAttribute("class",l),r.__className=t}else if(i&&n!==i)for(var d in i){var f=!!i[d];(n==null||f!==!!n[d])&&r.classList.toggle(d,f)}return i}function Ra(r,e={},t,a){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?r.style.removeProperty(n):r.style.setProperty(n,i,a))}}function di(r,e,t,a){var n=r.__style;if(n!==e){var i=tc(e,a);i==null?r.removeAttribute("style"):r.style.cssText=i,r.__style=e}else a&&(Array.isArray(a)?(Ra(r,t?.[0],a[0]),Ra(r,t?.[1],a[1],"important")):Ra(r,t,a));return a}function Fn(r,e,t){if(r.multiple){if(e==null)return;if(!ir(e))return fl();for(var a of r.options)a.selected=e.includes(kr(a));return}for(a of r.options){var n=kr(a);if(dl(n,e)){a.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function ar(r,e){let t=!0;or(()=>{e&&Fn(r,At(e),t),t=!1;var a=new MutationObserver(()=>{var n=r.__value;Fn(r,n)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function Gs(r,e,t=e){var a=!0;Bs(r,"change",n=>{var i=n?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(i),kr);else{var l=r.querySelector(i)??r.querySelector("option:not([disabled])");o=l&&kr(l)}t(o)}),or(()=>{var n=e();if(Fn(r,n,a),a&&n===void 0){var i=r.querySelector(":checked");i!==null&&(n=kr(i),t(n))}r.__value=n,a=!1}),ar(r)}function kr(r){return"__value"in r?r.__value:r.value}const pr=Symbol("class"),hr=Symbol("style"),Xs=Symbol("is custom element"),Ks=Symbol("is html");function Qt(r,e){var t=ka(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Ys(r,e){var t=ka(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function nc(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function de(r,e,t,a){var n=ka(r);n[e]!==(n[e]=t)&&(e==="loading"&&(r[zo]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Js(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function rc(r,e,t,a,n=!1){var i=ka(r),o=i[Xs],l=!i[Ks],d=e||{},f=r.tagName==="OPTION";for(var c in e)c in t||(t[c]=null);t.class?t.class=Ql(t.class):(a||t[pr])&&(t.class=null),t[hr]&&(t.style??=null);var p=Js(r);for(const E in t){let T=t[E];if(f&&E==="value"&&T==null){r.value=r.__value="",d[E]=T;continue}if(E==="class"){var h=r.namespaceURI==="http://www.w3.org/1999/xhtml";ct(r,h,T,a,e?.[pr],t[pr]),d[E]=T,d[pr]=t[pr];continue}if(E==="style"){di(r,T,e?.[hr],t[hr]),d[E]=T,d[hr]=t[hr];continue}var v=d[E];if(T!==v){d[E]=T;var g=E[0]+E[1];if(g!=="$$")if(g==="on"){const P={},$="$$"+E;let R=E.slice(2);var b=Ol(R);if(Dl(R)&&(R=R.slice(0,-7),P.capture=!0),!b&&v){if(T!=null)continue;r.removeEventListener(R,d[$],P),d[$]=null}if(T!=null)if(b)r[`__${R}`]=T,_t([R]);else{let z=function(O){d[E].call(this,O)};var k=z;d[$]=oi(R,r,z,P)}else b&&(r[`__${R}`]=void 0)}else if(E==="style")de(r,E,T);else if(E==="autofocus")jl(r,!!T);else if(!o&&(E==="__value"||E==="value"&&T!=null))r.value=r.__value=T;else if(E==="selected"&&f)nc(r,T);else{var y=E;l||(y=zl(y));var L=y==="defaultValue"||y==="defaultChecked";if(T==null&&!o&&!L)if(i[E]=null,y==="value"||y==="checked"){let P=r;const $=e===void 0;if(y==="value"){let R=P.defaultValue;P.removeAttribute(y),P.defaultValue=R,P.value=P.__value=$?R:null}else{let R=P.defaultChecked;P.removeAttribute(y),P.defaultChecked=R,P.checked=$?R:!1}}else r.removeAttribute(E);else L||p.includes(y)&&(o||typeof T!="string")?r[y]=T:typeof T!="function"&&de(r,y,T)}}}return d}function Ea(r,e,t=[],a,n=!1,i=On){const o=t.map(i);var l=void 0,d={},f=r.nodeName==="SELECT",c=!1;Nn(()=>{var p=e(...o.map(s));rc(r,l,p,a,n),c&&f&&"value"in p&&Fn(r,p.value,!1);for(let v of Object.getOwnPropertySymbols(d))p[v]||Kt(d[v]);for(let v of Object.getOwnPropertySymbols(p)){var h=p[v];v.description===ms&&(!l||h!==l[v])&&(d[v]&&Kt(d[v]),d[v]=Cn(()=>Zl(r,()=>h)))}l=p}),f&&ar(r,()=>l.value),c=!0}function ka(r){return r.__attributes??={[Xs]:r.nodeName.includes("-"),[Ks]:r.namespaceURI===al}}var Wi=new Map;function Js(r){var e=Wi.get(r.nodeName);if(e)return e;Wi.set(r.nodeName,e=[]);for(var t,a=r,n=Element.prototype;n!==a;){t=os(a);for(var i in t)t[i].set&&e.push(i);a=pa(a)}return e}function Tr(r,e,t=e){var a=zr();Bs(r,"input",n=>{var i=n?r.defaultValue:r.value;if(i=Da(r)?Aa(i):i,t(i),a&&i!==(i=e())){var o=r.selectionStart,l=r.selectionEnd;r.value=i??"",l!==null&&(r.selectionStart=o,r.selectionEnd=Math.min(l,r.value.length))}}),At(e)==null&&r.value&&t(Da(r)?Aa(r.value):r.value),lr(()=>{var n=e();Da(r)&&n===Aa(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function Da(r){var e=r.type;return e==="number"||e==="range"}function Aa(r){return r===""?null:+r}function $n(r,e,t){var a=Rn(r,e);a&&a.set&&(r[e]=t,ya(()=>{r[e]=null}))}function Ni(r,e){return r===e||r?.[yn]===e}function Ut(r={},e,t,a){return or(()=>{var n,i;return lr(()=>{n=i,i=[],At(()=>{r!==t(...i)&&(e(r,...i),n&&Ni(t(...n),r)&&e(null,...n))})}),()=>{ba(()=>{i&&Ni(t(...i),r)&&e(null,...i)})}}),r}function Bt(r=!1){const e=vt,t=e.l.u;if(!t)return;let a=()=>Lt(e.s);if(r){let n=0,i={};const o=On(()=>{let l=!1;const d=e.s;for(const f in d)d[f]!==i[f]&&(i[f]=d[f],l=!0);return l&&n++,n});a=()=>s(o)}t.b.length&&Ts(()=>{ji(e,a),Fr(t.b)}),ht(()=>{const n=At(()=>t.m.map(Do));return()=>{for(const i of n)typeof i=="function"&&i()}}),t.a.length&&ht(()=>{ji(e,a),Fr(t.a)})}function ji(r,e){if(r.l.s)for(const t of r.l.s)s(t);e()}function ui(r,e,t){if(r==null)return e(void 0),t&&t(void 0),en;const a=At(()=>r.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const Bn=[];function ac(r,e){return{subscribe:Zt(r,e).subscribe}}function Zt(r,e=en){let t=null;const a=new Set;function n(l){if(hs(r,l)&&(r=l,t)){const d=!Bn.length;for(const f of a)f[1](),Bn.push(f,r);if(d){for(let f=0;f<Bn.length;f+=2)Bn[f][0](Bn[f+1]);Bn.length=0}}}function i(l){n(l(r))}function o(l,d=en){const f=[l,d];return a.add(f),a.size===1&&(t=e(n,i)||en),l(r),()=>{a.delete(f),a.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:o}}function Nr(r,e,t){const a=!Array.isArray(r),n=a?[r]:r;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return ac(t,(o,l)=>{let d=!1;const f=[];let c=0,p=en;const h=()=>{if(c)return;p();const g=e(a?f[0]:f,o,l);i?o(g):p=typeof g=="function"?g:en},v=n.map((g,b)=>ui(g,y=>{f[b]=y,c&=~(1<<b),d&&h()},()=>{c|=1<<b}));return d=!0,h(),function(){Fr(v),p(),d=!1}})}function fn(r){let e;return ui(r,t=>e=t)(),e}let Hr=!1,Xa=Symbol();function tt(r,e,t){const a=t[e]??={store:null,source:st(void 0),unsubscribe:en};if(a.store!==r&&!(Xa in t))if(a.unsubscribe(),a.store=r??null,r==null)a.source.v=void 0,a.unsubscribe=en;else{var n=!0;a.unsubscribe=ui(r,i=>{n?a.source.v=i:m(a.source,i)}),n=!1}return r&&Xa in t?fn(r):s(a.source)}function dt(){const r={};function e(){ya(()=>{for(var t in r)r[t].unsubscribe();ss(r,Xa,{enumerable:!1,value:!0})})}return[r,e]}function ic(r){var e=Hr;try{return Hr=!1,[r(),Hr]}finally{Hr=e}}const sc={get(r,e){if(!r.exclude.includes(e))return r.props[e]},set(r,e){return!1},getOwnPropertyDescriptor(r,e){if(!r.exclude.includes(e)&&e in r.props)return{enumerable:!0,configurable:!0,value:r.props[e]}},has(r,e){return r.exclude.includes(e)?!1:e in r.props},ownKeys(r){return Reflect.ownKeys(r.props).filter(e=>!r.exclude.includes(e))}};function fi(r,e,t){return new Proxy({props:r,exclude:e},sc)}function Bi(r){return r.ctx?.d??!1}function V(r,e,t,a){var n=(t&Jo)!==0,i=!sr||(t&Zo)!==0,o=(t&el)!==0,l=(t&tl)!==0,d=!1,f;o?[f,d]=ic(()=>r[e]):f=r[e];var c=yn in r||Uo in r,p=o&&(Rn(r,e)?.set??(c&&e in r&&(R=>r[e]=R)))||void 0,h=a,v=!0,g=!1,b=()=>(g=!0,v&&(v=!1,l?h=At(a):h=a),h);f===void 0&&a!==void 0&&(p&&i&&Ho(),f=b(),p&&p(f));var y;if(i)y=()=>{var R=r[e];return R===void 0?b():(v=!0,g=!1,R)};else{var L=(n?On:De)(()=>r[e]);L.f|=ds,y=()=>{var R=s(L);return R!==void 0&&(h=void 0),R===void 0?h:R}}if((t&Qo)===0&&i)return y;if(p){var k=r.$$legacy;return function(R,z){return arguments.length>0?((!i||!z||k||d)&&p(z?y():R),R):y()}}var E=!1,T=!1,P=st(f),$=On(()=>{var R=y(),z=s(P);return E?(E=!1,T=!0,z):(T=!1,P.v=R)});return o&&s($),n||($.equals=ni),function(R,z){if(kn!==null&&(E=T,y(),s(P)),arguments.length>0){const O=z?s($):i&&o?It(R):R;if(!$.equals(O)){if(E=!0,m(P,O),g&&h!==void 0&&(h=O),Bi($))return R;At(()=>s($))}return R}return Bi($)?$.v:s($)}}function rn(r){vt===null&&ga(),sr&&vt.l!==null?lc(vt).m.push(r):ht(()=>{const e=At(r);if(typeof e=="function")return e})}function ur(r){vt===null&&ga(),rn(()=>()=>At(r))}function oc(r,e,{bubbles:t=!1,cancelable:a=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:a})}function cn(){const r=vt;return r===null&&ga(),(e,t,a)=>{const n=r.s.$$events?.[e];if(n){const i=ir(n)?n.slice():[n],o=oc(e,t,a);for(const l of i)l.call(r.x,o);return!o.defaultPrevented}return!0}}function lc(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const cc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(cc);Xo();function dc(r){return typeof r=="function"}function pi(r){return r!==null&&typeof r=="object"}const uc=["string","number","bigint","boolean"];function Ka(r){return r==null||uc.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>Ka(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const Rr=Symbol("box"),hi=Symbol("is-writable");function fc(r){return pi(r)&&Rr in r}function pc(r){return it.isBox(r)&&hi in r}function it(r){let e=fe(It(r));return{[Rr]:!0,[hi]:!0,get current(){return s(e)},set current(t){m(e,t,!0)}}}function hc(r,e){const t=ne(r);return e?{[Rr]:!0,[hi]:!0,get current(){return s(t)},set current(a){e(a)}}:{[Rr]:!0,get current(){return r()}}}function vc(r){return it.isBox(r)?r:dc(r)?it.with(r):it(r)}function mc(r){return Object.entries(r).reduce((e,[t,a])=>it.isBox(a)?(it.isWritableBox(a)?Object.defineProperty(e,t,{get(){return a.current},set(n){a.current=n}}):Object.defineProperty(e,t,{get(){return a.current}}),e):Object.assign(e,{[t]:a}),{})}function gc(r){return it.isWritableBox(r)?{[Rr]:!0,get current(){return r.current}}:r}it.from=vc;it.with=hc;it.flatten=mc;it.readonly=gc;it.isBox=fc;it.isWritableBox=pc;function wc(...r){return function(e){for(const t of r)if(t){if(e.defaultPrevented)return;typeof t=="function"?t.call(this,e):t.current?.call(this,e)}}}function yc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Hn={},Oa,Hi;function bc(){if(Hi)return Oa;Hi=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,n=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,o=/^[;\s]*/,l=/^\s+|\s+$/g,d=`
`,f="/",c="*",p="",h="comment",v="declaration";Oa=function(b,y){if(typeof b!="string")throw new TypeError("First argument must be a string");if(!b)return[];y=y||{};var L=1,k=1;function E(x){var F=x.match(e);F&&(L+=F.length);var q=x.lastIndexOf(d);k=~q?x.length-q:k+x.length}function T(){var x={line:L,column:k};return function(F){return F.position=new P(x),z(),F}}function P(x){this.start=x,this.end={line:L,column:k},this.source=y.source}P.prototype.content=b;function $(x){var F=new Error(y.source+":"+L+":"+k+": "+x);if(F.reason=x,F.filename=y.source,F.line=L,F.column=k,F.source=b,!y.silent)throw F}function R(x){var F=x.exec(b);if(F){var q=F[0];return E(q),b=b.slice(q.length),F}}function z(){R(t)}function O(x){var F;for(x=x||[];F=W();)F!==!1&&x.push(F);return x}function W(){var x=T();if(!(f!=b.charAt(0)||c!=b.charAt(1))){for(var F=2;p!=b.charAt(F)&&(c!=b.charAt(F)||f!=b.charAt(F+1));)++F;if(F+=2,p===b.charAt(F-1))return $("End of comment missing");var q=b.slice(2,F-2);return k+=2,E(q),b=b.slice(F),k+=2,x({type:h,comment:q})}}function N(){var x=T(),F=R(a);if(F){if(W(),!R(n))return $("property missing ':'");var q=R(i),te=x({type:v,property:g(F[0].replace(r,p)),value:q?g(q[0].replace(r,p)):p});return R(o),te}}function j(){var x=[];O(x);for(var F;F=N();)F!==!1&&(x.push(F),O(x));return x}return z(),j()};function g(b){return b?b.replace(l,p):p}return Oa}var Vi;function _c(){if(Vi)return Hn;Vi=1;var r=Hn&&Hn.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.default=t;var e=r(bc());function t(a,n){var i=null;if(!a||typeof a!="string")return i;var o=(0,e.default)(a),l=typeof n=="function";return o.forEach(function(d){if(d.type==="declaration"){var f=d.property,c=d.value;l?n(f,c,d):c&&(i=i||{},i[f]=c)}}),i}return Hn}var xc=_c();const qi=yc(xc),Sc=qi.default||qi,Ec=/\d/,kc=["-","_","/","."];function Tc(r=""){if(!Ec.test(r))return r!==r.toLowerCase()}function Cc(r){const e=[];let t="",a,n;for(const i of r){const o=kc.includes(i);if(o===!0){e.push(t),t="",a=void 0;continue}const l=Tc(i);if(n===!1){if(a===!1&&l===!0){e.push(t),t=i,a=l;continue}if(a===!0&&l===!1&&t.length>1){const d=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=d+i,a=l;continue}}t+=i,a=l,n=o}return e.push(t),e}function Zs(r){return r?Cc(r).map(e=>Fc(e)).join(""):""}function Ic(r){return Mc(Zs(r||""))}function Fc(r){return r?r[0].toUpperCase()+r.slice(1):""}function Mc(r){return r?r[0].toLowerCase()+r.slice(1):""}function Vr(r){if(!r)return{};const e={};function t(a,n){if(a.startsWith("-moz-")||a.startsWith("-webkit-")||a.startsWith("-ms-")||a.startsWith("-o-")){e[Zs(a)]=n;return}if(a.startsWith("--")){e[a]=n;return}e[Ic(a)]=n}return Sc(r,t),e}function Qs(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function Pc(r,e,t,a){const n=Array.isArray(e)?e:[e];return n.forEach(i=>r.addEventListener(i,t,a)),()=>{n.forEach(i=>r.removeEventListener(i,t,a))}}function Lc(r,e){const t=RegExp(r,"g");return a=>{if(typeof a!="string")throw new TypeError(`expected an argument of type string, but got ${typeof a}`);return a.match(t)?a.replace(t,e):a}}const Rc=Lc(/[A-Z]/,r=>`-${r.toLowerCase()}`);function Dc(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${Rc(e)}: ${r[e]};`).join(`
`)}function eo(r={}){return Dc(r).replace(`
`," ")}const Ac={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};eo(Ac);const Oc=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],Uc=new Set(Oc);function zc(r){return Uc.has(r)}function vi(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const a=r[t];if(a){for(const n of Object.keys(a)){const i=e[n],o=a[n],l=typeof i=="function",d=typeof o=="function";if(l&&zc(n)){const f=i,c=o;e[n]=wc(f,c)}else if(l&&d)e[n]=Qs(i,o);else if(n==="class"){const f=Ka(i),c=Ka(o);f&&c?e[n]=Qr(i,o):f?e[n]=Qr(i):c&&(e[n]=Qr(o))}else if(n==="style"){const f=typeof i=="object",c=typeof o=="object",p=typeof i=="string",h=typeof o=="string";if(f&&c)e[n]={...i,...o};else if(f&&h){const v=Vr(o);e[n]={...i,...v}}else if(p&&c){const v=Vr(i);e[n]={...v,...o}}else if(p&&h){const v=Vr(i),g=Vr(o);e[n]={...v,...g}}else f?e[n]=i:c?e[n]=o:p?e[n]=i:h&&(e[n]=o)}else e[n]=o!==void 0?o:i}for(const n of Object.getOwnPropertySymbols(a)){const i=e[n],o=a[n];e[n]=o!==void 0?o:i}}}return typeof e.style=="object"&&(e.style=eo(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const Wc=typeof window<"u"?window:void 0;function Nc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}function jc(r){m(r,r.v+1)}function to(r){let e=0,t=tr(0),a;return()=>{gl()&&(s(t),lr(()=>(e===0&&(a=At(()=>r(()=>jc(t)))),e+=1,()=>{Ns().then(()=>{e-=1,e===0&&(a?.(),a=void 0)})})))}}let Bc=class{#e;#t;constructor(e={}){const{window:t=Wc,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=to(n=>{const i=dn(t,"focusin",n),o=dn(t,"focusout",n);return()=>{i(),o()}}))}get current(){return this.#t?.(),this.#e?Nc(this.#e):null}};new Bc;function Hc(r){Ns().then(r)}const Vc=9;function qc(r){return pi(r)&&r.nodeType===Vc}function $c(r){return pi(r)&&r.constructor?.name==="VisualViewport"}function Gc(r){return qc(r)?r:$c(r)?r.document:r?.ownerDocument??document}function Xc(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class mi{element;#e=ne(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return s(this.#e)}set root(e){m(this.#e,e)}constructor(e){typeof e=="function"?this.element=it.with(e):this.element=e}getDocument=()=>Gc(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>Xc(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,t)=>this.getWindow().setTimeout(e,t);clearTimeout=e=>this.getWindow().clearTimeout(e)}function gi(r,e){return{[Rl()]:t=>it.isBox(r)?(r.current=t,At(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||(r.current=null)}):(r(t),At(()=>e?.(t)),()=>{"isConnected"in t&&t.isConnected||r(null)})}}function Kc({layout:r,panesArray:e,pivotIndices:t}){let a=0,n=100,i=0,o=0;const l=t[0];for(let p=0;p<e.length;p++){const h=e[p].constraints,{maxSize:v=100,minSize:g=0}=h;p===l?(a=g,n=v):(i+=g,o+=v)}const d=Math.min(n,100-i),f=Math.max(a,100-o),c=r[l];return{valueMax:d,valueMin:f,valueNow:c}}function bt(r,e="Assertion failed!"){if(!r)throw console.error(e),new Error(e)}const Yc=100,wi=10;function Gt(r,e,t=wi){return Dr(r,e,t)===0}function Dr(r,e,t=wi){const a=$i(r,t),n=$i(e,t);return Math.sign(a-n)}function vr(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function $i(r,e){return Number.parseFloat(r.toFixed(e))}const Ta=typeof document<"u";function Jc(r){return r instanceof HTMLElement}function no(r){return r.type==="keydown"}function ro(r){return r.type.startsWith("mouse")}function ao(r){return r.type.startsWith("touch")}function Yn({paneConstraints:r,paneIndex:e,initialSize:t}){const a=r[e];bt(a!=null,"Pane constraints should not be null.");const{collapsedSize:n=0,collapsible:i,maxSize:o=100,minSize:l=0}=a;let d=t;return Dr(d,l)<0&&(d=Zc(d,i,n,l)),d=Math.min(o,d),Number.parseFloat(d.toFixed(wi))}function Zc(r,e,t,a){if(!e)return a;const n=(t+a)/2;return Dr(r,n)<0?t:a}function An(){}function Qc({groupId:r,layout:e,panesArray:t,domContext:a}){const n=jr(r,a);for(let i=0;i<t.length-1;i++){const{valueMax:o,valueMin:l,valueNow:d}=Kc({layout:e,panesArray:t,pivotIndices:[i,i+1]}),f=n[i];if(Jc(f)){const c=t[i];f.setAttribute("aria-controls",c.opts.id.current),f.setAttribute("aria-valuemax",`${Math.round(o)}`),f.setAttribute("aria-valuemin",`${Math.round(l)}`),f.setAttribute("aria-valuenow",d!=null?`${Math.round(d)}`:"")}}return()=>{for(const i of n)i.removeAttribute("aria-controls"),i.removeAttribute("aria-valuemax"),i.removeAttribute("aria-valuemin"),i.removeAttribute("aria-valuenow")}}function jr(r,e){return Ta?Array.from(e.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${r}"]`)):[]}function io({groupId:r,id:e,domContext:t}){return Ta?jr(r,t).findIndex(i=>i.getAttribute("data-pane-resizer-id")===e)??null:null}function Gi({groupId:r,dragHandleId:e,domContext:t}){const a=io({groupId:r,id:e,domContext:t});return a!=null?[a,a+1]:[-1,-1]}function Vn(r,e,t){const a=r.map(f=>f.constraints),n=Gn(r,e),i=a[n],l=n===r.length-1?[n-1,n]:[n,n+1],d=t[n];return{...i,paneSize:d,pivotIndices:l}}function Gn(r,e){return r.findIndex(t=>t.opts.id.current===e.opts.id.current)}function mr(r,e,t){for(let a=0;a<e.length;a++){const n=e[a],i=r[a];bt(i);const{collapsedSize:o=0,collapsible:l}=i.constraints,d=t[i.opts.id.current];if(!(d==null||n!==d))continue;t[i.opts.id.current]=n;const{onCollapse:f,onExpand:c,onResize:p}=i.callbacks;p?.(n,d),l&&(f||c)&&(c&&(d==null||d===o)&&n!==o&&c(),f&&(d==null||d!==o)&&n===o&&f())}}function ed({panesArray:r}){const e=Array(r.length),t=r.map(i=>i.constraints);let a=0,n=100;for(let i=0;i<r.length;i++){const o=t[i];bt(o);const{defaultSize:l}=o;l!=null&&(a++,e[i]=l,n-=l)}for(let i=0;i<r.length;i++){const o=t[i];bt(o);const{defaultSize:l}=o;if(l!=null)continue;const d=r.length-a,f=n/d;a++,e[i]=f,n-=f}return e}function td({layout:r,paneConstraints:e}){const t=[...r],a=t.reduce((i,o)=>i+o,0);if(t.length!==e.length)throw new Error(`Invalid ${e.length} pane layout: ${t.map(i=>`${i}%`).join(", ")}`);if(!Gt(a,100))for(let i=0;i<e.length;i++){const o=t[i];bt(o!=null);const l=100/a*o;t[i]=l}let n=0;for(let i=0;i<e.length;i++){const o=t[i];bt(o!=null);const l=Yn({paneConstraints:e,paneIndex:i,initialSize:o});o!==l&&(n+=o-l,t[i]=l)}if(!Gt(n,0))for(let i=0;i<e.length;i++){const o=t[i];bt(o!=null);const l=o+n,d=Yn({paneConstraints:e,paneIndex:i,initialSize:l});if(o!==d&&(n-=d-o,t[i]=d,Gt(n,0)))break}return t}function nd(r,e){if(!Ta)return null;const t=e.querySelector(`[data-pane-group][data-pane-group-id="${r}"]`);return t||null}function yi(r,e){if(!Ta)return null;const t=e.querySelector(`[data-pane-resizer-id="${r}"]`);return t||null}function rd({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:n}){const i=t==="horizontal",o=yi(e,n);bt(o);const l=o.getAttribute("data-pane-group-id");bt(l);const{initialCursorPosition:d}=a,f=so(t,r),c=nd(l,n);bt(c);const p=c.getBoundingClientRect(),h=i?p.width:p.height;return(f-d)/h*100}function ad({event:r,dragHandleId:e,dir:t,initialDragState:a,keyboardResizeBy:n,domContext:i}){if(no(r)){const o=t==="horizontal";let l=0;r.shiftKey?l=100:n!=null?l=n:l=10;let d=0;switch(r.key){case"ArrowDown":d=o?0:l;break;case"ArrowLeft":d=o?-l:0;break;case"ArrowRight":d=o?l:0;break;case"ArrowUp":d=o?0:-l;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return a==null?0:rd({event:r,dragHandleId:e,dir:t,initialDragState:a,domContext:i})}function so(r,e){const t=r==="horizontal";if(ro(e))return t?e.clientX:e.clientY;if(ao(e)){const a=e.touches[0];return bt(a),t?a.screenX:a.screenY}else throw new Error(`Unsupported event type "${e.type}"`)}function id({groupId:r,handleId:e,panesArray:t,domContext:a}){const n=yi(e,a),i=jr(r,a),o=n?i.indexOf(n):-1,l=t[o]?.opts.id.current??null,d=t[o+1]?.opts.id.current??null;return[l,d]}const sd=typeof window<"u"?window:void 0;function od(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class ld{#e;#t;constructor(e={}){const{window:t=sd,document:a=t?.document}=e;t!==void 0&&(this.#e=a,this.#t=to(n=>{const i=dn(t,"focusin",n),o=dn(t,"focusout",n);return()=>{i(),o()}}))}get current(){return this.#t?.(),this.#e?od(this.#e):null}}new ld;function cd(r,e){switch(r){case"post":ht(e);break;case"pre":Ts(e);break}}function oo(r,e,t,a={}){const{lazy:n=!1}=a;let i=!n,o=Array.isArray(r)?[]:void 0;cd(e,()=>{const l=Array.isArray(r)?r.map(f=>f()):r();if(!i){i=!0,o=l;return}const d=At(()=>t(l,o));return o=l,d})}function Cr(r,e,t){oo(r,"post",e,t)}function dd(r,e,t){oo(r,"pre",e,t)}Cr.pre=dd;class ud{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return ll(this.#t)}get(){const e=Pi(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const t=Pi(this.#t);return t===void 0?e:t}set(e){return ol(this.#t,e)}}function gr({delta:r,layout:e,paneConstraints:t,pivotIndices:a,trigger:n}){if(Gt(r,0))return e;const i=[...e],[o,l]=a;let d=0;if(n==="keyboard"){{const c=r<0?l:o,p=t[c];if(bt(p),p.collapsible){const h=e[c];bt(h!=null);const v=t[c];bt(v);const{collapsedSize:g=0,minSize:b=0}=v;if(Gt(h,g)){const y=b-h;Dr(y,Math.abs(r))>0&&(r=r<0?0-y:y)}}}{const c=r<0?o:l,p=t[c];bt(p);const{collapsible:h}=p;if(h){const v=e[c];bt(v!=null);const g=t[c];bt(g);const{collapsedSize:b=0,minSize:y=0}=g;if(Gt(v,y)){const L=v-b;Dr(L,Math.abs(r))>0&&(r=r<0?0-L:L)}}}}{const c=r<0?1:-1;let p=r<0?l:o,h=0;for(;;){const g=e[p];bt(g!=null);const y=Yn({paneConstraints:t,paneIndex:p,initialSize:100})-g;if(h+=y,p+=c,p<0||p>=t.length)break}const v=Math.min(Math.abs(r),Math.abs(h));r=r<0?0-v:v}{let p=r<0?o:l;for(;p>=0&&p<t.length;){const h=Math.abs(r)-Math.abs(d),v=e[p];bt(v!=null);const g=v-h,b=Yn({paneConstraints:t,paneIndex:p,initialSize:g});if(!Gt(v,b)&&(d+=v-b,i[p]=b,d.toPrecision(3).localeCompare(Math.abs(r).toPrecision(3),void 0,{numeric:!0})>=0))break;r<0?p--:p++}}if(Gt(d,0))return e;{const c=r<0?l:o,p=e[c];bt(p!=null);const h=p+d,v=Yn({paneConstraints:t,paneIndex:c,initialSize:h});if(i[c]=v,!Gt(v,h)){let g=h-v,y=r<0?l:o;for(;y>=0&&y<t.length;){const L=i[y];bt(L!=null);const k=L+g,E=Yn({paneConstraints:t,paneIndex:y,initialSize:k});if(Gt(L,E)||(g-=E-L,i[y]=E),Gt(g,0))break;r>0?y--:y++}}}const f=i.reduce((c,p)=>p+c,0);return Gt(f,100)?i:e}let Ya=null,Ln=null;function lo(r){switch(r){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function fd(){Ln!==null&&(document.head.removeChild(Ln),Ya=null,Ln=null)}function Ua(r,e){if(Ya===r)return;Ya=r;const t=lo(r);Ln===null&&(Ln=e.createElement("style"),e.head.appendChild(Ln)),Ln.innerHTML=`*{cursor: ${t}!important;}`}function pd({defaultSize:r,dragState:e,layout:t,panesArray:a,paneIndex:n,precision:i=3}){const o=t[n];let l;return o==null?l=r??"1":a.length===1?l="1":l=o.toPrecision(i),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function Xi(r){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");r.getItem=e=>localStorage.getItem(e),r.setItem=(e,t)=>localStorage.setItem(e,t)}catch(e){console.error(e),r.getItem=()=>null,r.setItem=()=>{}}}function co(r){return`paneforge:${r}`}function uo(r){return r.map(t=>t.opts.order.current?`${t.opts.order.current}:${JSON.stringify(t.constraints)}`:JSON.stringify(t.constraints)).sort().join(",")}function fo(r,e){try{const t=co(r),a=e.getItem(t),n=JSON.parse(a||"");if(typeof n=="object"&&n!==null)return n}catch{}return null}function hd(r,e,t){const a=fo(r,t)||{},n=uo(e);return a[n]||null}function vd(r,e,t,a,n){const i=co(r),o=uo(e),l=fo(r,n)||{};l[o]={expandToSizes:Object.fromEntries(t.entries()),layout:a};try{n.setItem(i,JSON.stringify(l))}catch(d){console.error(d)}}const Ki={};function md(r,e=10){let t=null;return(...n)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...n)},e)}}function gd({autoSaveId:r,layout:e,storage:t,panesArray:a,paneSizeBeforeCollapse:n}){if(e.length===0||e.length!==a.length)return;let i=Ki[r];i==null&&(i=md(vd,Yc),Ki[r]=i);const o=[...a],l=new Map(n);i(r,o,l,e,t)}const Sr={getItem:r=>(Xi(Sr),Sr.getItem(r)),setItem:(r,e)=>{Xi(Sr),Sr.setItem(r,e)}},bi=new ud("PaneGroup");class _i{static create(e){return bi.set(new _i(e))}opts;attachment;domContext;#e=fe(null);get dragState(){return s(this.#e)}set dragState(e){m(this.#e,e)}#t=fe([]);get layout(){return s(this.#t)}set layout(e){m(this.#t,e)}#r=fe([]);get panesArray(){return s(this.#r)}set panesArray(e){m(this.#r,e)}#a=fe(!1);get panesArrayChanged(){return s(this.#a)}set panesArrayChanged(e){m(this.#a,e,!0)}#n=fe(It({}));get paneIdToLastNotifiedSizeMap(){return s(this.#n)}set paneIdToLastNotifiedSizeMap(e){m(this.#n,e,!0)}paneSizeBeforeCollapseMap=new Map;prevDelta=0;constructor(e){this.opts=e,this.attachment=gi(this.opts.ref),this.domContext=new mi(this.opts.ref),Cr([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>Qc({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray,domContext:this.domContext})),ht(()=>At(()=>this.#s())),Cr([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&gd({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),Cr(()=>this.panesArrayChanged,()=>{if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const t=this.layout;let a=null;if(this.opts.autoSaveId.current){const i=hd(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);i&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(i.expandToSizes)),a=i.layout)}a==null&&(a=ed({panesArray:this.panesArray}));const n=td({layout:a,paneConstraints:this.panesArray.map(i=>i.constraints)});vr(t,n)||(this.layout=n,this.opts.onLayout.current?.(n),mr(this.panesArray,n,this.paneIdToLastNotifiedSizeMap))})}setLayout=e=>{this.layout=e};registerResizeHandle=e=>t=>{t.preventDefault();const a=this.opts.direction.current,n=this.dragState,i=this.opts.id.current,o=this.opts.keyboardResizeBy.current,l=this.layout,d=this.panesArray,{initialLayout:f}=n??{},c=this.domContext.getDocument(),p=Gi({groupId:i,dragHandleId:e,domContext:this.domContext});let h=ad({event:t,dragHandleId:e,dir:a,initialDragState:n,keyboardResizeBy:o,domContext:this.domContext});if(h===0)return;const v=a==="horizontal";c.dir==="rtl"&&v&&(h=-h);const g=d.map(L=>L.constraints),b=gr({delta:h,layout:f??l,paneConstraints:g,pivotIndices:p,trigger:no(t)?"keyboard":"mouse-or-touch"}),y=!vr(l,b);(ro(t)||ao(t))&&this.prevDelta!==h&&(this.prevDelta=h,Ua(y?v?"horizontal":"vertical":v?h<0?"horizontal-min":"horizontal-max":h<0?"vertical-min":"vertical-max",c)),y&&(this.setLayout(b),this.opts.onLayout.current?.(b),mr(d,b,this.paneIdToLastNotifiedSizeMap))};resizePane=(e,t)=>{const a=this.layout,n=this.panesArray,i=n.map(p=>p.constraints),{paneSize:o,pivotIndices:l}=Vn(n,e,a);bt(o!=null);const f=Gn(n,e)===n.length-1?o-t:t-o,c=gr({delta:f,layout:a,paneConstraints:i,pivotIndices:l,trigger:"imperative-api"});vr(a,c)||(this.setLayout(c),this.opts.onLayout.current?.(c),mr(n,c,this.paneIdToLastNotifiedSizeMap))};startDragging=(e,t)=>{const a=this.opts.direction.current,n=this.layout,i=yi(e,this.domContext);bt(i);const o=so(a,t);this.dragState={dragHandleId:e,dragHandleRect:i.getBoundingClientRect(),initialCursorPosition:o,initialLayout:n}};stopDragging=()=>{fd(),this.dragState=null};isPaneCollapsed=e=>{const t=this.panesArray,a=this.layout,{collapsedSize:n=0,collapsible:i,paneSize:o}=Vn(t,e,a);return i===!0&&o===n};expandPane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(g=>g.constraints),{collapsedSize:i=0,paneSize:o,minSize:l=0,pivotIndices:d}=Vn(a,e,t);if(o!==i)return;const f=this.paneSizeBeforeCollapseMap.get(e.opts.id.current),c=f!=null&&f>=l?f:l,h=Gn(a,e)===a.length-1?o-c:c-o,v=gr({delta:h,layout:t,paneConstraints:n,pivotIndices:d,trigger:"imperative-api"});vr(t,v)||(this.setLayout(v),this.opts.onLayout.current?.(v),mr(a,v,this.paneIdToLastNotifiedSizeMap))};collapsePane=e=>{const t=this.layout,a=this.panesArray;if(!e.constraints.collapsible)return;const n=a.map(p=>p.constraints),{collapsedSize:i=0,paneSize:o,pivotIndices:l}=Vn(a,e,t);if(bt(o!=null),o===i)return;this.paneSizeBeforeCollapseMap.set(e.opts.id.current,o);const f=Gn(a,e)===a.length-1?o-i:i-o,c=gr({delta:f,layout:t,paneConstraints:n,pivotIndices:l,trigger:"imperative-api"});vr(t,c)||(this.layout=c,this.opts.onLayout.current?.(c),mr(a,c,this.paneIdToLastNotifiedSizeMap))};getPaneSize=e=>Vn(this.panesArray,e,this.layout).paneSize;getPaneStyle=(e,t)=>{const a=this.panesArray,n=this.layout,i=this.dragState,o=Gn(a,e);return pd({defaultSize:t,dragState:i,layout:n,panesArray:a,paneIndex:o})};isPaneExpanded=e=>{const{collapsedSize:t=0,collapsible:a,paneSize:n}=Vn(this.panesArray,e,this.layout);return!a||n>t};registerPane=e=>{const t=[...this.panesArray,e];return t.sort((a,n)=>{const i=a.opts.order.current,o=n.opts.order.current;return i==null&&o==null?0:i==null?-1:o==null?1:i-o}),this.panesArray=t,this.panesArrayChanged=!0,()=>{const a=[...this.panesArray],n=Gn(this.panesArray,e);n<0||(a.splice(n,1),this.panesArray=a,delete this.paneIdToLastNotifiedSizeMap[e.opts.id.current],this.panesArrayChanged=!0)}};#s=()=>{const e=this.opts.id.current,t=jr(e,this.domContext),a=this.panesArray,n=t.map(i=>{const o=i.getAttribute("data-pane-resizer-id");if(!o)return An;const[l,d]=id({groupId:e,handleId:o,panesArray:a,domContext:this.domContext});if(l==null||d==null)return An;const c=Pc(i,"keydown",p=>{if(p.defaultPrevented||p.key!=="Enter")return;p.preventDefault();const h=this.panesArray,v=h.findIndex(P=>P.opts.id.current===l);if(v<0)return;const g=h[v];bt(g);const b=this.layout,y=b[v],{collapsedSize:L=0,collapsible:k,minSize:E=0}=g.constraints;if(!(y!=null&&k))return;const T=gr({delta:Gt(y,L)?E-y:L-y,layout:b,paneConstraints:h.map(P=>P.constraints),pivotIndices:Gi({groupId:e,dragHandleId:o,domContext:this.domContext}),trigger:"keyboard"});b!==T&&(this.layout=T)});return()=>{c()}});return()=>{for(const i of n)i()}};#i=ne(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"},...this.attachment}));get props(){return s(this.#i)}set props(e){m(this.#i,e)}}const wd=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];class xi{static create(e){return new xi(e,bi.get())}opts;#e;attachment;domContext;#t=ne(()=>this.#e.dragState?.dragHandleId===this.opts.id.current);#r=fe(!1);resizeHandler=null;constructor(e,t){this.opts=e,this.#e=t,this.attachment=gi(this.opts.ref),this.domContext=new mi(this.opts.ref),ht(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.#e.registerResizeHandle(this.opts.id.current)}),ht(()=>{const a=this.opts.ref.current;if(!a)return;const n=this.opts.disabled.current,i=this.resizeHandler,o=s(this.#t);if(n||i===null||!o)return;const l=h=>{i(h)},d=h=>{i(h)},f=()=>{a.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1)},c=this.domContext.getDocument().body,p=this.domContext.getWindow();return Qs(dn(c,"contextmenu",f),dn(c,"mousemove",l),dn(c,"touchmove",l,{passive:!1}),dn(c,"mouseleave",d),dn(p,"mouseup",f),dn(p,"touchend",f))})}#a=e=>{e.preventDefault(),!this.opts.disabled.current&&(this.#e.startDragging(this.opts.id.current,e),this.opts.onDraggingChange.current(!0))};#n=()=>{const e=this.opts.ref.current;e&&(e.blur(),this.#e.stopDragging(),this.opts.onDraggingChange.current(!1))};#s=e=>{if(this.opts.disabled.current||!this.resizeHandler||e.defaultPrevented)return;if(wd.includes(e.key)){e.preventDefault(),this.resizeHandler(e);return}if(e.key!=="F6")return;e.preventDefault();const t=jr(this.#e.opts.id.current,this.domContext),a=io({groupId:this.#e.opts.id.current,id:this.opts.id.current,domContext:this.domContext});if(a===null)return;let n=0;e.shiftKey?a>0?n=a-1:n=t.length-1:a+1<t.length?n=a+1:n=0,t[n].focus()};#i=()=>{m(this.#r,!1)};#o=()=>{m(this.#r,!0)};#l=e=>{this.#a(e)};#d=()=>{this.#n()};#u=()=>{this.#n()};#f=()=>{this.#n()};#p=e=>{this.#a(e)};#c=ne(()=>({id:this.opts.id.current,role:"separator","data-direction":this.#e.opts.direction.current,"data-pane-group-id":this.#e.opts.id.current,"data-active":s(this.#t)?"pointer":s(this.#r)?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:lo(this.#e.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:this.#s,onblur:this.#i,onfocus:this.#o,onmousedown:this.#l,onmouseup:this.#d,ontouchcancel:this.#u,ontouchend:this.#f,ontouchstart:this.#p,...this.attachment}));get props(){return s(this.#c)}set props(e){m(this.#c,e)}}class Si{static create(e){return new Si(e,bi.get())}opts;group;attachment;domContext;#e=fe("");#t=ne(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current}));get callbacks(){return s(this.#t)}set callbacks(e){m(this.#t,e)}#r=ne(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current}));get constraints(){return s(this.#r)}set constraints(e){m(this.#r,e)}#a=e=>{m(this.#e,e,!0),Hc(()=>{if(this.opts.ref.current){const t=this.opts.ref.current;if(!(getComputedStyle(t).transitionDuration!=="0s")){m(this.#e,"");return}const i=o=>{o.propertyName==="flex-grow"&&(m(this.#e,""),t.removeEventListener("transitionend",i))};t.addEventListener("transitionend",i)}else m(this.#e,"")})};pane={collapse:()=>{this.#a("collapsing"),this.group.collapsePane(this)},expand:()=>{this.#a("expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:e=>this.group.resizePane(this,e),getId:()=>this.opts.id.current};constructor(e,t){this.opts=e,this.group=t,this.attachment=gi(this.opts.ref),this.domContext=new mi(this.opts.ref),rn(()=>this.group.registerPane(this)),Cr(()=>sl(this.constraints),()=>{this.group.panesArrayChanged=!0})}#n=ne(()=>this.group.isPaneCollapsed(this));#s=ne(()=>s(this.#e)!==""?s(this.#e):s(this.#n)?"collapsed":"expanded");#i=ne(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":s(this.#n)?"":void 0,"data-expanded":s(this.#n)?void 0:"","data-pane-state":s(this.#s),...this.attachment}));get props(){return s(this.#i)}set props(e){m(this.#i,e)}}var yd=I("<div><!></div>");function bd(r,e){const t=ci();rt(e,!0);let a=V(e,"autoSaveId",3,null),n=V(e,"id",3,t),i=V(e,"keyboardResizeBy",3,null),o=V(e,"onLayoutChange",3,An),l=V(e,"storage",3,Sr),d=V(e,"ref",15,null),f=fi(e,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const c=_i.create({id:it.with(()=>n()??t),ref:it.with(()=>d(),E=>d(E)),autoSaveId:it.with(()=>a()),direction:it.with(()=>e.direction),keyboardResizeBy:it.with(()=>i()),onLayout:it.with(()=>o()),storage:it.with(()=>l())}),p=()=>c.layout,h=c.setLayout,v=()=>c.opts.id.current,g=ne(()=>vi(f,c.props));var b=pt(),y=et(b);{var L=E=>{var T=pt(),P=et(T);rr(P,()=>e.child,()=>({props:s(g)})),_(E,T)},k=E=>{var T=yd();Ea(T,()=>({...s(g)}));var P=u(T);rr(P,()=>e.children??en),_(E,T)};U(y,E=>{e.child?E(L):E(k,!1)})}return _(r,b),at({getLayout:p,setLayout:h,getId:v})}var _d=I("<div><!></div>");function Yi(r,e){const t=ci();rt(e,!0);let a=V(e,"id",3,t),n=V(e,"ref",15,null),i=V(e,"onCollapse",3,An),o=V(e,"onExpand",3,An),l=V(e,"onResize",3,An),d=fi(e,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const f=Si.create({id:it.with(()=>a()),ref:it.with(()=>n(),$=>n($)),collapsedSize:it.with(()=>e.collapsedSize),collapsible:it.with(()=>e.collapsible),defaultSize:it.with(()=>e.defaultSize),maxSize:it.with(()=>e.maxSize),minSize:it.with(()=>e.minSize),onCollapse:it.with(()=>i()),onExpand:it.with(()=>o()),onResize:it.with(()=>l()),order:it.with(()=>e.order)}),c=f.pane.collapse,p=f.pane.expand,h=f.pane.getSize,v=f.pane.isCollapsed,g=f.pane.isExpanded,b=f.pane.resize,y=f.pane.getId,L=ne(()=>vi(d,f.props));var k=pt(),E=et(k);{var T=$=>{var R=pt(),z=et(R);rr(z,()=>e.child,()=>({props:s(L)})),_($,R)},P=$=>{var R=_d();Ea(R,()=>({...s(L)}));var z=u(R);rr(z,()=>e.children??en),_($,R)};U(E,$=>{e.child?$(T):$(P,!1)})}return _(r,k),at({collapse:c,expand:p,getSize:h,isCollapsed:v,isExpanded:g,resize:b,getId:y})}var xd=I("<div><!></div>");function Sd(r,e){const t=ci();rt(e,!0);let a=V(e,"id",3,t),n=V(e,"ref",15,null),i=V(e,"disabled",3,!1),o=V(e,"onDraggingChange",3,An),l=V(e,"tabindex",3,0),d=fi(e,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const f=xi.create({id:it.with(()=>a()),ref:it.with(()=>n(),b=>n(b)),disabled:it.with(()=>i()),onDraggingChange:it.with(()=>o()),tabIndex:it.with(()=>l())}),c=ne(()=>vi(d,f.props));var p=pt(),h=et(p);{var v=b=>{var y=pt(),L=et(y);rr(L,()=>e.child,()=>({props:s(c)})),_(b,y)},g=b=>{var y=xd();Ea(y,()=>({...s(c)}));var L=u(y);rr(L,()=>e.children??en),_(b,y)};U(h,b=>{e.child?b(v):b(g,!1)})}_(r,p),at()}const qr={SIDEBAR_EXPANDED:"editme_sidebar_expanded",SIDEBAR_SECTION:"editme_sidebar_section"},za={sidebar:{isExpanded:!0,activeSection:"about"},isInitialized:!1};function Ed(){const{subscribe:r,set:e,update:t}=Zt(za);return{subscribe:r,set:e,update:t,initialize(){let a=za.sidebar.isExpanded,n=za.sidebar.activeSection;try{const i=localStorage.getItem(qr.SIDEBAR_EXPANDED);i&&(a=JSON.parse(i))}catch(i){console.warn("Failed to load sidebar expanded state:",i)}try{const i=localStorage.getItem(qr.SIDEBAR_SECTION);i&&kd(i)&&(n=i)}catch(i){console.warn("Failed to load sidebar section:",i)}t(i=>({...i,sidebar:{isExpanded:a,activeSection:n},isInitialized:!0}))},toggleSidebar(){t(a=>{const n=!a.sidebar.isExpanded;try{localStorage.setItem(qr.SIDEBAR_EXPANDED,JSON.stringify(n))}catch(i){console.warn("Failed to save sidebar expanded state:",i)}return{...a,sidebar:{...a.sidebar,isExpanded:n}}})},setSidebarSection(a){t(n=>{try{localStorage.setItem(qr.SIDEBAR_SECTION,a)}catch(i){console.warn("Failed to save sidebar section:",i)}return{...n,sidebar:{...n.sidebar,activeSection:a}}})}}}function kd(r){return["about","workspace","metadata","manifest","navigation","spine","settings"].includes(r)}const Un=Ed();typeof window<"u"&&Un.initialize();const Ar={en:{code:"en",name:"English",direction:"ltr",englishName:"English"},de:{code:"de",name:"Deutsch",direction:"ltr",englishName:"German"},ka:{code:"ka",name:"á¥áá áá£áá",direction:"ltr",englishName:"Georgian"},ar:{code:"ar",name:"Ø§ÙØ¹Ø±Ø¨ÙØ©",direction:"rtl",englishName:"Arabic"},he:{code:"he",name:"×¢××¨××ª",direction:"rtl",englishName:"Hebrew"},"zh-Hant":{code:"zh-Hant",name:"ç¹é«ä¸­æ",direction:"ltr",englishName:"Traditional Chinese"},ja:{code:"ja",name:"æ¥æ¬èª",direction:"ltr",englishName:"Japanese"}},Or="en",Td=["ar","he"];function Ca(r){return Td.includes(r)}function po(){if(typeof navigator>"u")return Or;const r=navigator.languages||[navigator.language];for(const e of r){if(Ar[e])return e;const t=e.split("-")[0];if(Ar[t])return t;if(t==="zh"&&["zh-TW","zh-HK","zh-MO"].includes(e))return"zh-Hant"}return Or}const Cd=`/**
 * OPFS Worker Script
 *
 * Handles OPFS sync access handle operations in a Web Worker.
 * Used primarily on Safari where sync access handles work better in workers.
 *
 * NOTE: This file MUST remain JavaScript (not TypeScript) because it gets
 * injected as a worker blob URL to support sync access handles in Safari.
 * Claude/agents should NOT convert this file to TypeScript.
 */

let opfsRoot = null;

async function getOPFSRoot() {
  if (!opfsRoot) {
    opfsRoot = await navigator.storage.getDirectory();
  }
  return opfsRoot;
}

async function ensureWorkspaceDirectory(workspaceId) {
  const root = await getOPFSRoot();
  const workspacesDir = await root.getDirectoryHandle('workspaces', { create: true });
  return await workspacesDir.getDirectoryHandle(workspaceId, { create: true });
}

async function ensureDirectoryPath(baseHandle, path) {
  const pathParts = path.split('/').filter(part => part.length > 0);
  let currentHandle = baseHandle;

  for (const part of pathParts) {
    currentHandle = await currentHandle.getDirectoryHandle(part, { create: true });
  }

  return currentHandle;
}

async function getFileHandle(workspaceId, path, create = false) {
  const workspaceHandle = await ensureWorkspaceDirectory(workspaceId);

  const pathParts = path.split('/');
  const fileName = pathParts.pop();
  const dirPath = pathParts.join('/');

  let targetDir = workspaceHandle;
  if (dirPath) {
    targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
  }

  return await targetDir.getFileHandle(fileName, { create });
}

async function createWorkspace(data) {
  try {
    await ensureWorkspaceDirectory(data.workspaceId);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteWorkspace(data) {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    await workspacesDir.removeEntry(data.workspaceId, { recursive: true });
    return { success: true };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true }; // Already deleted
    }
    return { success: false, error: error.message };
  }
}

async function listWorkspaces() {
  try {
    const root = await getOPFSRoot();
    const workspacesDir = await root.getDirectoryHandle('workspaces');
    const workspaces = [];

    for await (const [name, handle] of workspacesDir.entries()) {
      if (handle.kind === 'directory') {
        workspaces.push(name);
      }
    }

    return { success: true, workspaces: workspaces.sort() };
  } catch (error) {
    if (error.name === 'NotFoundError') {
      return { success: true, workspaces: [] };
    }
    return { success: false, error: error.message };
  }
}

async function writeFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, true);
    const syncHandle = await fileHandle.createSyncAccessHandle();

    try {
      // Truncate the file first to ensure complete overwrite
      syncHandle.truncate(data.content.byteLength);
      syncHandle.write(data.content, { at: 0 });
      syncHandle.flush();
    } finally {
      syncHandle.close();
    }

    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function readFile(data) {
  try {
    const fileHandle = await getFileHandle(data.workspaceId, data.path, false);
    const file = await fileHandle.getFile();
    const content = await file.arrayBuffer();
    return { success: true, content };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function deleteFile(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);

    const pathParts = data.path.split('/');
    const fileName = pathParts.pop();
    const dirPath = pathParts.join('/');

    let targetDir = workspaceHandle;
    if (dirPath) {
      targetDir = await ensureDirectoryPath(workspaceHandle, dirPath);
    }

    await targetDir.removeEntry(fileName);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function collectFiles(dirHandle, currentPath, files) {
  for await (const [name, handle] of dirHandle.entries()) {
    const fullPath = currentPath ? \`\${currentPath}/\${name}\` : name;

    if (handle.kind === 'file') {
      files.push(fullPath);
    } else if (handle.kind === 'directory') {
      await collectFiles(handle, fullPath, files);
    }
  }
}

async function listFiles(data) {
  try {
    const workspaceHandle = await ensureWorkspaceDirectory(data.workspaceId);
    let targetDir = workspaceHandle;

    if (data.basePath) {
      try {
        targetDir = await ensureDirectoryPath(workspaceHandle, data.basePath);
      } catch (error) {
        if (error.name === 'NotFoundError') {
          return { success: true, files: [] };
        }
        throw error;
      }
    }

    const files = [];
    await collectFiles(targetDir, data.basePath || '', files);
    return { success: true, files: files.sort() };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

async function getQuota() {
  try {
    if ('storage' in navigator && 'estimate' in navigator.storage) {
      const estimate = await navigator.storage.estimate();
      return {
        success: true,
        quota: {
          used: estimate.usage || 0,
          available: (estimate.quota || 0) - (estimate.usage || 0),
        },
      };
    }
    return { success: true, quota: { used: 0, available: 0 } };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// Worker message handler
self.addEventListener('message', async event => {
  const { type, data, id } = event.data;
  let result;

  try {
    switch (type) {
      case 'createWorkspace':
        result = await createWorkspace(data);
        break;
      case 'deleteWorkspace':
        result = await deleteWorkspace(data);
        break;
      case 'listWorkspaces':
        result = await listWorkspaces();
        break;
      case 'writeFile':
        result = await writeFile(data);
        break;
      case 'readFile':
        result = await readFile(data);
        break;
      case 'deleteFile':
        result = await deleteFile(data);
        break;
      case 'listFiles':
        result = await listFiles(data);
        break;
      case 'getQuota':
        result = await getQuota();
        break;
      default:
        result = { success: false, error: \`Unknown operation: \${type}\` };
    }
  } catch (error) {
    result = { success: false, error: error.message };
  }

  const response = { type, result, id };
  self.postMessage(response);
});
`;class Id{worker=null;messageId=0;pendingMessages=new Map;timeout=1e4;isDestroyed=!1;constructor(){this.initWorker()}initWorker(){const e=new Blob([Cd],{type:"application/javascript"}),t=URL.createObjectURL(e);this.worker=new Worker(t),this.worker.onmessage=this.handleWorkerMessage.bind(this),this.worker.onerror=this.handleWorkerError.bind(this),this.worker.onmessageerror=this.handleWorkerMessageError.bind(this),URL.revokeObjectURL(t)}handleWorkerMessage(e){const{result:t,id:a,type:n}=e.data;if(n==="readFile"&&t&&!t.success?console.warn(`â ï¸ Worker readFile failed: ${t.error}`):n==="readFile"&&t&&t.content===null&&console.warn(`â ï¸ Empty ArrayBuffer received for ${t.path||"unknown path"}`),this.pendingMessages.has(a)){const{resolve:i}=this.pendingMessages.get(a);this.pendingMessages.delete(a),i(t)}}handleWorkerError(e){const t=new Error(`Worker error: ${e.message||"Unknown error"}`);this.rejectAllPendingMessages(t)}handleWorkerMessageError(e){const t=new Error("Worker message error: Failed to deserialize message");this.rejectAllPendingMessages(t)}rejectAllPendingMessages(e){for(const{reject:t}of this.pendingMessages.values())t(e);this.pendingMessages.clear()}async sendMessage(e,t){if(this.isDestroyed)throw new Error("Worker terminated");if(!this.worker)throw new Error("Worker not initialized");return new Promise((a,n)=>{const i=++this.messageId;this.pendingMessages.set(i,{resolve:a,reject:n}),this.worker.postMessage({type:e,data:t,id:i}),setTimeout(()=>{this.pendingMessages.has(i)&&(this.pendingMessages.delete(i),n(new Error(`Worker operation timed out after ${this.timeout}ms`)))},this.timeout)})}setTimeout(e){this.timeout=e}async createWorkspace(e){return await this.sendMessage("createWorkspace",{workspaceId:e})}async deleteWorkspace(e){return await this.sendMessage("deleteWorkspace",{workspaceId:e})}async listWorkspaces(){return await this.sendMessage("listWorkspaces")}async writeFile(e,t,a){return await this.sendMessage("writeFile",{workspaceId:e,path:t,content:a})}async readFile(e,t){return await this.sendMessage("readFile",{workspaceId:e,path:t})}async deleteFile(e,t){return await this.sendMessage("deleteFile",{workspaceId:e,path:t})}async listFiles(e,t){return await this.sendMessage("listFiles",{workspaceId:e,basePath:t})}async getFileInfo(e,t){return await this.sendMessage("getFileInfo",{workspaceId:e,path:t})}async getQuota(){return await this.sendMessage("getQuota")}destroy(){if(this.isDestroyed)return;this.isDestroyed=!0;const e=new Error("Worker terminated");this.rejectAllPendingMessages(e),this.worker&&(this.worker.terminate(),this.worker=null)}}class Fd{capabilityCache=null;async testOPFSAvailable(){try{return"storage"in navigator&&"getDirectory"in navigator.storage}catch{return!1}}async testOPFSAsync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_async_test__",{create:!0});if(!("createWritable"in t))return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1;try{return await(await t.createWritable()).close(),await e.removeEntry("__opfs_async_test__"),!0}catch{return await e.removeEntry("__opfs_async_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSync(){try{if(!await this.testOPFSAvailable())return!1;const e=await navigator.storage.getDirectory(),t=await e.getFileHandle("__opfs_sync_test__",{create:!0});if(!("createSyncAccessHandle"in t))return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1;try{return(await t.createSyncAccessHandle()).close(),await e.removeEntry("__opfs_sync_test__"),!0}catch{return await e.removeEntry("__opfs_sync_test__").catch(()=>{}),!1}}catch{return!1}}async testOPFSSyncWorker(){return new Promise(e=>{try{const t=`
					(async () => {
						try {
							const root = await navigator.storage.getDirectory();
							const testHandle = await root.getFileHandle('__worker_test__', { create: true });
							if ('createSyncAccessHandle' in testHandle) {
								const syncHandle = await testHandle.createSyncAccessHandle();
								syncHandle.close();
								await root.removeEntry('__worker_test__');
								self.postMessage({ success: true });
							} else {
								self.postMessage({ success: false });
							}
						} catch (error) {
							self.postMessage({ success: false, error: error.message });
						}
					})();
				`,a=new Blob([t],{type:"application/javascript"}),n=URL.createObjectURL(a),i=new Worker(n),o=setTimeout(()=>{i.terminate(),URL.revokeObjectURL(n),e(!1)},3e3);i.onmessage=l=>{clearTimeout(o),i.terminate(),URL.revokeObjectURL(n),e(l.data.success===!0)},i.onerror=()=>{clearTimeout(o),i.terminate(),URL.revokeObjectURL(n),e(!1)}}catch{e(!1)}})}async testIndexedDB(){return new Promise(e=>{try{if(!("indexedDB"in globalThis)){e(!1);return}const t=indexedDB.open("__capability_test__",1);t.onerror=()=>{e(!1)},t.onsuccess=()=>{t.result.close(),indexedDB.deleteDatabase("__capability_test__"),e(!0)},t.onupgradeneeded=a=>{const n=a.target.result;n.objectStoreNames.contains("test")||n.createObjectStore("test")}}catch{e(!1)}})}async testStorageEstimate(){try{return!("storage"in navigator)||!("estimate"in navigator.storage)?!1:(await navigator.storage.estimate(),!0)}catch{return!1}}async detectCapabilities(){if(this.capabilityCache)return this.capabilityCache;try{const[e,t,a,n,i,o]=await Promise.all([this.testOPFSAvailable().catch(()=>!1),this.testOPFSAsync().catch(()=>!1),this.testOPFSSync().catch(()=>!1),this.testOPFSSyncWorker().catch(()=>!1),this.testIndexedDB().catch(()=>!1),this.testStorageEstimate().catch(()=>!1)]);return this.capabilityCache={opfs:e,opfsAsync:t,opfsSync:a,opfsSyncWorker:n,indexedDB:i,storageEstimate:o},this.capabilityCache}catch{return this.capabilityCache={opfs:!1,opfsAsync:!1,opfsSync:!1,opfsSyncWorker:!1,indexedDB:!1,storageEstimate:!1},this.capabilityCache}}async detectOptimalBackend(){const e=await this.detectCapabilities();if(e.opfsAsync)return"opfs-async";if(e.opfsSyncWorker)return"opfs-sync";if(e.indexedDB)return"indexeddb";throw new Error("No storage backend available")}clearCache(){this.capabilityCache=null}}class Jn{static featureDetector=new Fd;static cachedBackend=null;static async detectStorageBackend(){return await this.featureDetector.detectOptimalBackend()}static async testWorkerSyncAccessHandle(){return await this.featureDetector.testOPFSSyncWorker()}static async create(){if(Jn.cachedBackend)return Jn.cachedBackend;const e=await this.detectStorageBackend();let t;switch(e){case"opfs-sync":t=new Pd;break;case"opfs-async":t=new Md,await t.init?.();break;case"indexeddb":t=new Ld,await t.init?.();break;default:throw new Error(`Unsupported backend: ${e}`)}return Jn.cachedBackend=t,t}static async getCapabilities(){return await this.featureDetector.detectCapabilities()}static clearCache(){this.featureDetector.clearCache(),Jn.cachedBackend=null}}class Md{root=null;async init(){if(!("storage"in navigator&&"getDirectory"in navigator.storage))throw new Error("OPFS not available");this.root=await navigator.storage.getDirectory()}async ensureWorkspaceDirectory(e){if(!this.root)throw new Error("Backend not initialized");return await(await this.root.getDirectoryHandle("workspaces",{create:!0})).getDirectoryHandle(e,{create:!0})}async ensureDirectoryPath(e,t){const a=t.split("/").filter(i=>i.length>0);let n=e;for(const i of a)n=await n.getDirectoryHandle(i,{create:!0});return n}async getFileHandle(e,t,a=!1){const n=await this.ensureWorkspaceDirectory(e),i=t.split("/"),o=i.pop(),l=i.join("/");let d=n;return l&&(d=await this.ensureDirectoryPath(n,l)),await d.getFileHandle(o,{create:a})}async createWorkspace(e){await this.ensureWorkspaceDirectory(e)}async deleteWorkspace(e){if(!this.root)throw new Error("Backend not initialized");try{await(await this.root.getDirectoryHandle("workspaces")).removeEntry(e,{recursive:!0})}catch(t){if(t.name!=="NotFoundError")throw t}}async listWorkspaces(){if(!this.root)throw new Error("Backend not initialized");try{const e=await this.root.getDirectoryHandle("workspaces"),t=[];for await(const[a,n]of e.entries())n.kind==="directory"&&t.push(a);return t.sort()}catch(e){if(e.name==="NotFoundError")return[];throw e}}async writeFile(e,t,a){const n=await this.getFileHandle(e,t,!0);await this.writeFileWithFallback(n,a)}async writeFileWithFallback(e,t){try{const a=await e.createWritable();try{await a.write(t)}finally{await a.close()}}catch(a){if("createSyncAccessHandle"in e){const n=await e.createSyncAccessHandle();try{n.truncate(t.byteLength),n.write(t,{at:0}),n.flush()}finally{n.close()}}else throw a}}async readFile(e,t){return await(await(await this.getFileHandle(e,t,!1)).getFile()).arrayBuffer()}async deleteFile(e,t){const a=await this.ensureWorkspaceDirectory(e),n=t.split("/"),i=n.pop(),o=n.join("/");let l=a;o&&(l=await this.ensureDirectoryPath(a,o)),await l.removeEntry(i)}async listFiles(e,t){const a=await this.ensureWorkspaceDirectory(e);let n=a;const i=t?t.replace(/\/+$/,""):"";if(i)try{n=await this.ensureDirectoryPath(a,i)}catch(l){if(l.name==="NotFoundError")return[];throw l}const o=[];return await this.collectFiles(n,i,o),o.sort()}async getFileInfo(e,t){const n=await(await this.getFileHandle(e,t,!1)).getFile();return{size:n.size,lastModified:new Date(n.lastModified)}}async collectFiles(e,t,a){for await(const[n,i]of e.entries()){const o=t?`${t}/${n}`:n;i.kind==="file"?a.push(o):i.kind==="directory"&&await this.collectFiles(i,o,a)}}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}return{used:0,available:0}}getBackendType(){return"opfs-async"}}class Pd{workerManager;constructor(){this.workerManager=new Id}async sendMessage(e,t){return await this.workerManager.sendMessage(e,t)}destroy(){this.workerManager.destroy()}async createWorkspace(e){const t=await this.workerManager.createWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to create workspace")}async deleteWorkspace(e){const t=await this.workerManager.deleteWorkspace(e);if(!t.success)throw new Error(t.error?.message||"Failed to delete workspace")}async listWorkspaces(){const e=await this.workerManager.listWorkspaces();if(!e.success)throw new Error(e.error?.message||"Failed to list workspaces");return e.workspaces||[]}async writeFile(e,t,a){const n=await this.workerManager.writeFile(e,t,a);if(!n.success)throw new Error(n.error?.message||"Failed to write file")}async readFile(e,t){const a=await this.workerManager.readFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to read file");const n=a.content;if(!n||!(n instanceof ArrayBuffer))return console.warn(`â ï¸ Invalid ArrayBuffer received for ${t}: ${typeof n}, length: ${n?.byteLength||"undefined"}`),new ArrayBuffer(0);try{return n.byteLength===0&&console.warn(`â ï¸ Empty ArrayBuffer received for ${t}`),n}catch(i){return console.warn(`â ï¸ Detached ArrayBuffer received for ${t}:`,i),new ArrayBuffer(0)}}async deleteFile(e,t){const a=await this.workerManager.deleteFile(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to delete file")}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0,n=await this.workerManager.listFiles(e,a);if(!n.success)throw new Error(n.error?.message||"Failed to list files");return n.files||[]}async getFileInfo(e,t){const a=await this.workerManager.getFileInfo(e,t);if(!a.success)throw new Error(a.error?.message||"Failed to get file info");return a.data?.fileInfo||{size:0,lastModified:new Date}}async getQuota(){const e=await this.workerManager.getQuota();if(!e.success)throw new Error(e.error?.message||"Failed to get quota");return e.data?.quota||{used:0,available:0}}getBackendType(){return"opfs-sync"}}class Ld{db=null;dbName="editme-storage";version=1;async init(){return new Promise((e,t)=>{if(!("indexedDB"in globalThis)){t(new Error("IndexedDB not available"));return}const a=indexedDB.open(this.dbName,this.version);a.onerror=()=>{t(new Error(`Failed to open IndexedDB: ${a.error?.message}`))},a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=n=>{const i=n.target.result;if(i.objectStoreNames.contains("workspaces")||i.createObjectStore("workspaces",{keyPath:"id"}).createIndex("created","created",{unique:!1}),!i.objectStoreNames.contains("files")){const o=i.createObjectStore("files",{keyPath:["workspaceId","path"]});o.createIndex("workspaceId","workspaceId",{unique:!1}),o.createIndex("modified","modified",{unique:!1})}}})}async transaction(e,t,a){if(!this.db)throw new Error("Database not initialized");return new Promise((n,i)=>{const o=this.db.transaction(e,t);o.onerror=()=>{i(new Error(`Transaction failed: ${o.error?.message}`))},a(o).then(n).catch(i)})}async putRecord(e,t){return new Promise((a,n)=>{const i=e.put(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Put failed: ${i.error?.message}`))})}async getRecord(e,t){return new Promise((a,n)=>{const i=e.get(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`Get failed: ${i.error?.message}`))})}async deleteRecord(e,t){return new Promise((a,n)=>{const i=e.delete(t);i.onsuccess=()=>a(),i.onerror=()=>n(new Error(`Delete failed: ${i.error?.message}`))})}async getAllRecords(e,t){return new Promise((a,n)=>{const i=e.getAll(t);i.onsuccess=()=>a(i.result),i.onerror=()=>n(new Error(`GetAll failed: ${i.error?.message}`))})}async createWorkspace(e){await this.transaction(["workspaces"],"readwrite",async t=>{const a=t.objectStore("workspaces");await this.putRecord(a,{id:e,created:Date.now()})})}async deleteWorkspace(e){await this.transaction(["workspaces","files"],"readwrite",async t=>{const a=t.objectStore("workspaces"),n=t.objectStore("files"),i=n.index("workspaceId"),o=await this.getAllRecords(i,IDBKeyRange.only(e));for(const l of o)await this.deleteRecord(n,[l.workspaceId,l.path]);await this.deleteRecord(a,e)})}async listWorkspaces(){return await this.transaction(["workspaces"],"readonly",async e=>{const t=e.objectStore("workspaces");return(await this.getAllRecords(t)).map(n=>n.id).sort()})}async writeFile(e,t,a){await this.transaction(["files"],"readwrite",async n=>{const i=n.objectStore("files");await this.putRecord(i,{workspaceId:e,path:t,content:a,modified:Date.now()})})}async readFile(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return i.content})}async deleteFile(e,t){await this.transaction(["files"],"readwrite",async a=>{const n=a.objectStore("files");await this.deleteRecord(n,[e,t])})}async listFiles(e,t){return await this.transaction(["files"],"readonly",async a=>{const i=a.objectStore("files").index("workspaceId");let l=(await this.getAllRecords(i,IDBKeyRange.only(e))).map(d=>d.path);if(t){const f=t.replace(/\/+$/,"")+"/";l=l.filter(c=>c.startsWith(f))}return l.sort()})}async getFileInfo(e,t){return await this.transaction(["files"],"readonly",async a=>{const n=a.objectStore("files"),i=await this.getRecord(n,[e,t]);if(!i)throw new Error("File not found");return{size:i.content.byteLength,lastModified:new Date(i.modified)}})}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage)try{const e=await navigator.storage.estimate();return{used:e.usage||0,available:(e.quota||0)-(e.usage||0)}}catch{}return{used:0,available:0}}getBackendType(){return"indexeddb"}}class Rd{backend=null;initialized=!1;async init(){this.initialized||(this.backend=await Jn.create(),this.initialized=!0)}isInitialized(){return this.initialized&&this.backend!==null}getBackendType(){if(!this.backend)throw new Error("Storage manager not initialized");return this.backend.getBackendType()}generateWorkspaceId(){return"workspace-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}async createWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");const t=e||this.generateWorkspaceId();return await this.backend.createWorkspace(t),t}async deleteWorkspace(e){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteWorkspace(e)}async listWorkspaces(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listWorkspaces()}async writeFile(e,t,a){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.writeFile(e,t,a)}async readFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.readFile(e,t)}async deleteFile(e,t){if(!this.backend)throw new Error("Storage manager not initialized");await this.backend.deleteFile(e,t)}async listFiles(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.listFiles(e,t)}async getFileInfo(e,t){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getFileInfo(e,t)}async getQuota(){if(!this.backend)throw new Error("Storage manager not initialized");return await this.backend.getQuota()}async writeTextFile(e,t,a){const i=new TextEncoder().encode(a).buffer;await this.writeFile(e,t,i)}async readTextFile(e,t){const a=await this.readFile(e,t);return new TextDecoder().decode(a)}async fileExists(e,t){try{return await this.readFile(e,t),!0}catch{return!1}}async getFileSize(e,t){return(await this.readFile(e,t)).byteLength}destroy(){this.backend&&"destroy"in this.backend&&this.backend.destroy(),this.backend=null,this.initialized=!1}}class Wt{static instance=null;manager;initPromise=null;constructor(){this.manager=new Rd}static getInstance(){return Wt.instance||(Wt.instance=new Wt),Wt.instance}static async getInitializedInstance(){const e=Wt.getInstance();return e.isInitialized()||await e.init(),e}static resetInstance(){Wt.instance&&(Wt.instance.destroy(),Wt.instance=null)}async init(){if(!this.manager.isInitialized()){if(this.initPromise){await this.initPromise;return}this.initPromise=this.doInit();try{await this.initPromise}finally{this.initPromise=null}}}async doInit(){await this.manager.init(),console.log("FileStorageAPI initialized with backend:",this.manager.getBackendType())}isInitialized(){return this.manager.isInitialized()}getBackendType(){return this.manager.getBackendType()}async createWorkspace(e){return await this.manager.createWorkspace(e)}async deleteWorkspace(e){await this.manager.deleteWorkspace(e)}async listWorkspaces(){return await this.manager.listWorkspaces()}async writeFile(e,t,a){await this.manager.writeFile(e,t,a)}async readFile(e,t){return await this.manager.readFile(e,t)}async deleteFile(e,t){await this.manager.deleteFile(e,t)}async renameFile(e,t,a){const n=await this.manager.readFile(e,t);await this.manager.writeFile(e,a,n),await this.manager.deleteFile(e,t)}async listFiles(e,t){const a=t?t.replace(/\/+$/,""):void 0;return await this.manager.listFiles(e,a)}async getFileInfo(e,t){return await this.manager.getFileInfo(e,t)}async getQuota(){return await this.manager.getQuota()}async estimateWorkspaceSize(e){const t=await this.manager.listFiles(e);let a=0;for(const n of t)try{const i=await this.manager.getFileSize(e,n);a+=i}catch{}return a}async writeTextFile(e,t,a){await this.manager.writeTextFile(e,t,a)}async readTextFile(e,t){return await this.manager.readTextFile(e,t)}async fileExists(e,t){return await this.manager.fileExists(e,t)}supportsDirectBlobURLs(){const e=this.manager.getBackendType();return e==="opfs-async"||e==="opfs-sync"}async getFile(e,t){if(!this.manager.isInitialized())throw new Error("Storage manager not initialized");const a=this.manager.getBackendType();if(a==="opfs-async")return await(await this.manager.backend.getFileHandle(e,t,!1)).getFile();if(a==="opfs-sync"){const n=await this.readFile(e,t),i=t.split("/").pop()||"file";return new File([n],i)}else throw new Error("Direct file access not supported for IndexedDB backend")}destroy(){this.manager.destroy()}}function ho(r){return new ReadableStream({start(e){e.enqueue(r),e.close()}})}function Dd(r,e="download.x"){const t=window.URL.createObjectURL(r),a=document.createElement("a");a.href=t,a.setAttribute("download",e),a.click(),window.URL.revokeObjectURL(t)}async function vo(r,e){const t=r.getReader();let a=!1;const n=[];for(;!a;){const i=await t.read();a=i.done,i.value&&n.push(i.value)}return new Blob(n,{type:e})}function vn(r,e,t){const a=[];for(let n=0;n<t;n++)a.push(String.fromCharCode(r.getUint8(e+n)));return a.join("")}class Ur{#e;#t=0;#r=[];#a=[];#n=null;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const t=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([t]);if(e.compressionMethod===8){const a=new DecompressionStream("deflate-raw"),i=ho(t).pipeThrough(a);return await vo(i)}else throw new Error(`Unsupported compression method: ${e.compressionMethod}`)}read(){for(;!this.#n&&this.#t<this.#e.byteLength-4;){const e=this.#e.getUint32(this.#t,!0);if(e===67324752){const t=this.readLocalFile(this.#t);t.startsAt=this.#t+30+t.fileNameLength+t.extraLength,t.extract=this.extract.bind(this,t),this.#r.push(t),this.#t=t.startsAt+t.compressedSize}else if(e===33639248){const t=this.readCentralDirectory(this.#t);this.#a.push(t),this.#t+=46+t.fileNameLength+t.extraLength+t.fileCommentLength}else if(e===101010256){this.#n=this.readEndCentralDirectory(this.#t);break}else this.#t++}}readLocalFile(e){const t=this.#e.getUint16(e+26,!0),a=this.#e.getUint16(e+28,!0);return{signature:vn(this.#e,e,4),version:this.#e.getUint16(e+4,!0),generalPurpose:this.#e.getUint16(e+6,!0),compressionMethod:this.#e.getUint16(e+8,!0),lastModifiedTime:this.#e.getUint16(e+10,!0),lastModifiedDate:this.#e.getUint16(e+12,!0),crc:this.#e.getUint32(e+14,!0),compressedSize:this.#e.getUint32(e+18,!0),uncompressedSize:this.#e.getUint32(e+22,!0),fileNameLength:t,fileName:vn(this.#e,e+30,t),extraLength:a,extra:vn(this.#e,e+30+t,a),startsAt:0,extract:()=>Promise.resolve(new Blob)}}readCentralDirectory(e){const t=this.#e.getUint16(e+28,!0),a=this.#e.getUint16(e+30,!0),n=this.#e.getUint16(e+32,!0);return{signature:vn(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:t,extraLength:a,fileCommentLength:n,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(e+42,!0),fileName:vn(this.#e,e+46,t),extra:vn(this.#e,e+46+t,a),comments:vn(this.#e,e+46+t+a,n)}}readEndCentralDirectory(e){const t=this.#e.getUint16(e+20,!0);return{signature:vn(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:t,comment:vn(this.#e,e+22,t)}}get entries(){return this.#r}}class Qn{#e=[];static _crcTable=[];constructor(){this.#e=[]}async addFile(e,t,a={}){const{compressionMethod:n=e==="mimetype"?0:8,lastModified:i=new Date}=a;let o,l,d,f,c;if(t instanceof ArrayBuffer)c=t;else if(t instanceof Uint8Array)c=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);else if(t instanceof Blob)c=await t.arrayBuffer();else if(typeof t=="string")c=new TextEncoder().encode(t).buffer;else throw new Error("Unsupported data type");if(d=c.byteLength,l=this.#s(new Uint8Array(c)),n===0)o=c,f=d;else if(n===8){const h=new CompressionStream("deflate-raw"),g=ho(c).pipeThrough(h);o=await(await vo(g)).arrayBuffer(),f=o.byteLength}else throw new Error(`Unsupported compression method: ${n}`);const p={fileName:e,compressionMethod:n,lastModified:i,crc32:l,compressedSize:f,uncompressedSize:d,data:o,localHeaderOffset:0};return this.#e.push(p),this}async build(){const e=[];let t=0;const a=[...this.#e].sort((f,c)=>f.fileName==="mimetype"?-1:c.fileName==="mimetype"?1:0);for(const f of a){f.localHeaderOffset=t;const c=this.#t(f);e.push(c),t+=c.byteLength,e.push(f.data),t+=f.data.byteLength}const n=t;for(const f of a){const c=this.#r(f);e.push(c),t+=c.byteLength}const i=this.#a(this.#e.length,t-n,n);e.push(i);const o=e.reduce((f,c)=>f+c.byteLength,0),l=new Uint8Array(o);let d=0;for(const f of e)l.set(new Uint8Array(f),d),d+=f.byteLength;return l.buffer}async buildBlob(){const e=await this.build();return new Blob([e],{type:"application/zip"})}#t(e){const t=new TextEncoder().encode(e.fileName),a=30+t.length,n=new ArrayBuffer(a),i=new DataView(n),o=new Uint8Array(n);i.setUint32(0,67324752,!0),i.setUint16(4,20,!0),i.setUint16(6,0,!0),i.setUint16(8,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(10,l.time,!0),i.setUint16(12,l.date,!0),i.setUint32(14,e.crc32,!0),i.setUint32(18,e.compressedSize,!0),i.setUint32(22,e.uncompressedSize,!0),i.setUint16(26,t.length,!0),i.setUint16(28,0,!0),o.set(t,30),n}#r(e){const t=new TextEncoder().encode(e.fileName),a=46+t.length,n=new ArrayBuffer(a),i=new DataView(n),o=new Uint8Array(n);i.setUint32(0,33639248,!0),i.setUint16(4,20,!0),i.setUint16(6,20,!0),i.setUint16(8,0,!0),i.setUint16(10,e.compressionMethod,!0);const l=this.#n(e.lastModified);return i.setUint16(12,l.time,!0),i.setUint16(14,l.date,!0),i.setUint32(16,e.crc32,!0),i.setUint32(20,e.compressedSize,!0),i.setUint32(24,e.uncompressedSize,!0),i.setUint16(28,t.length,!0),i.setUint16(30,0,!0),i.setUint16(32,0,!0),i.setUint16(34,0,!0),i.setUint16(36,0,!0),i.setUint32(38,0,!0),i.setUint32(42,e.localHeaderOffset,!0),o.set(t,46),n}#a(e,t,a){const n=new ArrayBuffer(22),i=new DataView(n);return i.setUint32(0,101010256,!0),i.setUint16(4,0,!0),i.setUint16(6,0,!0),i.setUint16(8,e,!0),i.setUint16(10,e,!0),i.setUint32(12,t,!0),i.setUint32(16,a,!0),i.setUint16(20,0,!0),n}#n(e){const t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=Math.floor(e.getSeconds()/2),d=t-1980<<9|a<<5|n,f=i<<11|o<<5|l;return{date:d,time:f}}#s(e){const t=this.#i();let a=4294967295;for(let n=0;n<e.length;n++){const i=e[n];a=a>>>8^t[(a^i)&255]}return(a^4294967295)>>>0}#i(){if(Qn._crcTable.length===0){const e=Array.from({length:256},()=>0);for(let t=0;t<256;t++){let a=t;for(let n=0;n<8;n++)a=a&1?3988292384^a>>>1:a>>>1;e[t]=a}Qn._crcTable=e}return Qn._crcTable}clear(){return this.#e=[],this}get fileCount(){return this.#e.length}getFileNames(){return this.#e.map(e=>e.fileName)}}const $r="locales";function Ad(){return new Od}class Od{storage=Wt.getInstance();async needsUpdate(){return!0}async extractTranslations(){let e=globalThis.__EDITME_I18N_BUNDLE__,t;if(e)try{const n=e.split(",")[1];if(!n)throw new Error("Invalid data URL format: missing base64 data");const i=atob(n),o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);t=o.buffer}catch(n){throw new Error(`Failed to decode embedded translation data: ${n instanceof Error?n.message:"Unknown error"}`)}finally{delete globalThis.__EDITME_I18N_BUNDLE__}else try{const n=await fetch("/i18n-bundle.zip");if(!n.ok)throw new Error(`Failed to fetch i18n-bundle.zip: ${n.status}`);t=await n.arrayBuffer()}catch{throw new Error('Translation data not found. For single file builds, please run "npm run build" to generate a new build with embedded translations.')}let a;try{a=new Ur(t)}catch(n){throw new Error(`Failed to parse ZIP archive: ${n instanceof Error?n.message:"Unknown error"}`)}this.storage.isInitialized()||await this.storage.init(),await this.storage.createWorkspace($r);for(const n of a.entries){if(!n.fileName.endsWith(".json"))continue;const o=await(await n.extract()).text();try{JSON.parse(o)}catch(l){throw new Error(`Invalid JSON in ${n.fileName}: ${l instanceof Error?l.message:"Unknown error"}`)}await this.storage.writeTextFile($r,n.fileName,o)}}async loadTranslations(){const e={};this.storage.isInitialized()||await this.storage.init();const a=(await this.storage.listFiles($r)).filter(n=>n.endsWith(".json"));for(const n of a)try{const i=await this.storage.readTextFile($r,n);let o;o=JSON.parse(i);const d=(n.split("/").pop()||n).replace(".json",""),f={locale:d,messages:this.extractMessages(o),headers:o[""]||{}};e[d]=f}catch{}return e}extractMessages(e){const t={};for(const[a,n]of Object.entries(e)){if(a==="")continue;const i=Array.isArray(n)?n[0]:n;typeof i=="string"&&(t[a]=i)}return t}}const Nt=Zt({currentLocale:Or,locales:Ar,catalogs:{},initialized:!1,loading:!1}),Ei=Nr(Nt,r=>r.currentLocale);Nr(Nt,r=>r.loading);Nr(Nt,r=>r.initialized);Nr(Ei,r=>Ca(r)?"rtl":"ltr");const ca={locale:"en",messages:{Save:"Save",Cancel:"Cancel",Delete:"Delete",Edit:"Edit",File:"File",Settings:"Settings",Workspace:"Workspace",Metadata:"Metadata",Manifest:"Manifest",Navigation:"Navigation","Spine Items":"Spine Items"},headers:{}},Ud=(r,e={})=>{const t=fn(Nt);let n=t.catalogs[t.currentLocale]?.messages[r];if(!n&&t.currentLocale!=="en"&&(n=t.catalogs.en?.messages[r]||ca.messages[r]),n||(n=r),Object.keys(e).length>0)for(const[i,o]of Object.entries(e))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(o));return n},mt=Nr(Nt,r=>(e,t={})=>{let n=r.catalogs[r.currentLocale]?.messages[e];if(!n&&r.currentLocale!=="en"&&(n=r.catalogs.en?.messages[e]||ca.messages[e]),n||(n=e),Object.keys(t).length>0)for(const[i,o]of Object.entries(t))n=n.replace(new RegExp(`\\{${i}\\}`,"g"),String(o));return n});async function mo(){const r=fn(Nt);if(!(r.initialized||r.loading)){Nt.update(e=>({...e,loading:!0}));try{const e=Ad();await e.extractTranslations();const t=await e.loadTranslations();t.en||(t.en=ca);const a=po(),n=t[a]?a:Or;typeof document<"u"&&(document.documentElement.setAttribute("data-dir",Ca(n)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",n)),Nt.update(i=>({...i,currentLocale:n,catalogs:t,initialized:!0,loading:!1}))}catch(e){console.error("Failed to initialize i18n:",e),Nt.update(t=>({...t,currentLocale:Or,catalogs:{en:ca},initialized:!0,loading:!1}))}}}async function zd(r){const e=fn(Nt);if(!e.initialized)throw new Error("i18n system not initialized");if(!Ar[r])throw new Error(`Unsupported locale: ${r}`);e.catalogs[r]||console.warn(`Translation catalog for ${r} not loaded, falling back to English`),typeof document<"u"&&(document.documentElement.setAttribute("data-dir",Ca(r)?"rtl":"ltr"),document.documentElement.setAttribute("data-locale",r)),typeof localStorage<"u"&&localStorage.setItem("editme-locale",r),Nt.update(t=>({...t,currentLocale:r}))}function Wd(){const r=fn(Nt);return Object.keys(r.locales).map(e=>r.locales[e])}const go={translate:Ud,getCurrentLocale:()=>fn(Ei),setLocale:zd,getAvailableLocales:Wd,hasTranslation:(r,e)=>!!fn(Nt).catalogs[r]?.messages[e],isLocaleSupported:r=>!!Ar[r],isRTL:Ca,getCatalogs:()=>fn(Nt).catalogs,isInitialized:()=>fn(Nt).initialized,init:mo},Gr="editme_theme_preference",Nd={current:"light",systemPreference:"light",isInitialized:!1};function jd(){const{subscribe:r,set:e,update:t}=Zt(Nd);return{subscribe:r,set:e,update:t,initialize(){let a=null,n="light";typeof window<"u"&&window.matchMedia&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");try{const o=localStorage.getItem(Gr);o&&Bd(o)&&(a=o)}catch(o){console.warn("Failed to load theme preference:",o)}const i=a||n;t(o=>({...o,current:i,systemPreference:n,isInitialized:!0})),wr(i),typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{const d=l.matches?"dark":"light";t(f=>({...f,systemPreference:d})),a||(t(f=>({...f,current:d})),wr(d))})},setTheme(a){t(n=>{try{localStorage.setItem(Gr,a)}catch(i){console.warn("Failed to save theme preference:",i)}return wr(a),{...n,current:a}})},toggleTheme(){t(a=>{const n=a.current==="light"?"dark":"light";try{localStorage.setItem(Gr,n)}catch(i){console.warn("Failed to save theme preference:",i)}return wr(n),{...a,current:n}})},useSystemPreference(){t(a=>{try{localStorage.removeItem(Gr)}catch(n){console.warn("Failed to clear theme preference:",n)}return wr(a.systemPreference),{...a,current:a.systemPreference}})},getCurrentTheme(){return fn({subscribe:r}).current}}}function Bd(r){return r==="light"||r==="dark"}function wr(r){typeof document<"u"&&document.documentElement.setAttribute("data-theme",r)}const da=jd();typeof window<"u"&&da.initialize();var Hd=Vs('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>'),Vd=Vs('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-v7l3jb"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),qd=I('<span class="theme-toggle__label svelte-v7l3jb"> </span>'),$d=I('<button aria-label="Toggle theme"><span class="theme-toggle__icon svelte-v7l3jb" aria-hidden="true"><!></span> <!></button>');function Ji(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(da,"$themeStore",t),i=st(),o=st();let l=V(e,"size",8,"medium"),d=V(e,"showLabel",8,!0);function f(){da.toggleTheme()}Rt(()=>n(),()=>{m(i,n().current)}),Rt(()=>s(i),()=>{m(o,s(i)==="dark")}),xn(),Bt();var c=$d();let p;c.__click=f;var h=u(c),v=u(h);{var g=k=>{var E=Hd();_(k,E)},b=k=>{var E=Vd();_(k,E)};U(v,k=>{s(o)?k(g):k(b,!1)})}var y=w(h,2);{var L=k=>{var E=qd(),T=u(E);D(()=>S(T,s(o)?"Light":"Dark")),_(k,E)};U(y,k=>{d()&&k(L)})}D(k=>{p=ct(c,1,"theme-toggle svelte-v7l3jb",null,p,k),de(c,"title",`Switch to ${s(o)?"light":"dark"} theme`)},[()=>({"theme-toggle--small":l()==="small","theme-toggle--large":l()==="large"})],De),_(r,c),at(),a()}_t(["click"]);function Gd(){Un.toggleSidebar()}function Zi(){const r=new CustomEvent("append-spine-item",{bubbles:!0});window.dispatchEvent(r)}var Xd=I('<h2 class="sidebar-title svelte-1l16yvq">SEED.html</h2> <div class="header-actions svelte-1l16yvq"><!></div>',1),Kd=I('<div class="header-actions compact svelte-1l16yvq"><!></div>'),Yd=I('<h3 class="workspace-extensions svelte-1l16yvq"><!></h3>'),Jd=I('<div class="workspace-title-header svelte-1l16yvq"><h3 class="workspace-title svelte-1l16yvq"> </h3> <!></div>'),Zd=I('<div class="extensions-indicator svelte-1l16yvq"> </div>'),Qd=I('<div class="workspace-title-header compact svelte-1l16yvq"><div class="workspace-title-compact svelte-1l16yvq"> </div> <!></div>'),eu=I('<div class="workspace-title-section svelte-1l16yvq"><!></div>'),tu=(r,e,t)=>e(s(t).id),nu=I('<!> <button><span class="section-label svelte-1l16yvq"><!></span></button>',1),ru=(r,e,t)=>e(s(t).id),au=I('<button><span class="section-label svelte-1l16yvq"><!></span></button>'),iu=I('<div class="spine-section-header svelte-1l16yvq"><span class="section-label svelte-1l16yvq"> </span> <button class="append-button-nav svelte-1l16yvq"><span class="append-icon svelte-1l16yvq">+</span></button></div>'),su=I('<div class="spine-section-header compact svelte-1l16yvq"><span class="section-label svelte-1l16yvq"> </span> <button class="append-button-nav compact svelte-1l16yvq"><span class="append-icon svelte-1l16yvq">+</span></button></div>'),ou=I('<aside><div class="sidebar-header svelte-1l16yvq"><button class="sidebar-toggle svelte-1l16yvq"> </button> <!></div> <div class="sidebar-main svelte-1l16yvq"><nav class="sidebar-nav svelte-1l16yvq"><!> <!> <!></nav> <div class="spine-items-container svelte-1l16yvq"><!></div> <div class="section-content"><!> <!> <!> <!> <!> <!></div></div> <div class="sidebar-footer svelte-1l16yvq"><!></div></aside>');function lu(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"isExpanded",3,!0),o=V(e,"activeSection",3,"workspace"),l=V(e,"hasWorkspace",3,!1),d=V(e,"currentWorkspace",3,null),f=V(e,"workspaceTitle",3,void 0),c=V(e,"extensionManager",3,null),p=fe(It([])),h=fe(!1);ht(()=>{d()?.id&&c()?(m(h,!0),c().listWorkspaceExtensions(d().id).then(oe=>{m(p,oe,!0),m(h,!1)}).catch(()=>{m(p,[],!0),m(h,!1)})):(m(p,[],!0),m(h,!1))});const v=[{id:"about",icon:"â¹ï¸",label:n()("About")},{id:"workspace",icon:"ð ",label:n()("Projects")},{id:"settings",icon:"âï¸",label:n()("Settings")},{id:"metadata",icon:"ð",label:n()("Metadata"),requiresWorkspace:!0},{id:"manifest",icon:"ð",label:n()("Manifest"),requiresWorkspace:!0},{id:"navigation",icon:"ð",label:n()("Navigation"),requiresWorkspace:!0}];function g(oe){Un.setSidebarSection(oe)}function b(oe){return!oe.requiresWorkspace||l()}function y(oe){return oe.slice(0,2).toUpperCase()}var L=ou();let k;var E=u(L),T=u(E);T.__click=[Gd];var P=u(T),$=w(T,2);{var R=oe=>{var ie=Xd(),xe=w(et(ie),2),Me=u(xe);Ji(Me,{size:"small",showLabel:!1}),_(oe,ie)},z=oe=>{var ie=Kd(),xe=u(ie);Ji(xe,{size:"small",showLabel:!1}),_(oe,ie)};U($,oe=>{i()?oe(R):oe(z,!1)})}var O=w(E,2),W=u(O),N=u(W);Ct(N,17,()=>v.filter(oe=>!oe.requiresWorkspace),Pt,(oe,ie)=>{var xe=nu(),Me=et(xe);{var Ae=he=>{var ke=pt(),Te=et(ke);{var Oe=se=>{var Ee=eu(),ve=u(Ee);{var We=B=>{var H=Jd(),Z=u(H),ue=u(Z),ye=w(Z,2);{var Se=Fe=>{var Ie=Yd(),Xe=u(Ie);{var Be=ae=>{var me=Tt("Loading...");_(ae,me)},le=ae=>{var me=Tt();D(Pe=>S(me,Pe),[()=>s(p).map(Pe=>Pe.name).join(", ")]),_(ae,me)};U(Xe,ae=>{s(h)?ae(Be):ae(le,!1)})}_(Fe,Ie)};U(ye,Fe=>{(s(p).length>0||s(h))&&Fe(Se)})}D(()=>{de(Z,"title",f()||"Untitled Project"),S(ue,f()||"Untitled Project")}),_(B,H)},Ve=B=>{var H=Qd(),Z=u(H),ue=u(Z),ye=w(Z,2);{var Se=Fe=>{var Ie=Zd(),Xe=u(Ie);D(Be=>{de(Ie,"title",Be),S(Xe,`â¢${s(p).length??""}`)},[()=>s(p).map(Be=>Be.name).join(", ")]),_(Fe,Ie)};U(ye,Fe=>{s(p).length>0&&!s(h)&&Fe(Se)})}D(Fe=>{de(Z,"title",f()||"Untitled Project"),S(ue,Fe)},[()=>(f()||"Untitled Project").slice(0,2).toUpperCase()]),_(B,H)};U(ve,B=>{i()?B(We):B(Ve,!1)})}_(se,Ee)};U(Te,se=>{l()&&d()&&se(Oe)})}_(he,ke)};U(Me,he=>{s(ie).id==="settings"&&he(Ae)})}var He=w(Me,2);let $e;He.__click=[tu,g,ie];var Ye=u(He),Ne=u(Ye);{var Ge=he=>{var ke=Tt();D(Te=>S(ke,Te),[()=>n()(s(ie).label)]),_(he,ke)},Ke=he=>{var ke=Tt();D(Te=>S(ke,Te),[()=>y(n()(s(ie).label))]),_(he,ke)};U(Ne,he=>{i()?he(Ge):he(Ke,!1)})}D((he,ke)=>{$e=ct(He,1,"sidebar-section svelte-1l16yvq",null,$e,he),de(He,"aria-current",o()===s(ie).id?"page":void 0),de(He,"title",ke)},[()=>({active:o()===s(ie).id}),()=>n()(s(ie).label)]),_(oe,xe)});var j=w(N,2);Ct(j,17,()=>v.filter(oe=>oe.requiresWorkspace),Pt,(oe,ie)=>{var xe=pt(),Me=et(xe);{var Ae=He=>{var $e=au();let Ye;$e.__click=[ru,g,ie];var Ne=u($e),Ge=u(Ne);{var Ke=ke=>{var Te=Tt();D(Oe=>S(Te,Oe),[()=>n()(s(ie).label)]),_(ke,Te)},he=ke=>{var Te=Tt();D(Oe=>S(Te,Oe),[()=>y(n()(s(ie).label))]),_(ke,Te)};U(Ge,ke=>{i()?ke(Ke):ke(he,!1)})}D((ke,Te)=>{Ye=ct($e,1,"sidebar-section svelte-1l16yvq",null,Ye,ke),de($e,"aria-current",o()===s(ie).id?"page":void 0),de($e,"title",Te)},[()=>({active:o()===s(ie).id}),()=>n()(s(ie).label)]),_(He,$e)};U(Me,He=>{b(s(ie))&&He(Ae)})}_(oe,xe)});var x=w(j,2);{var F=oe=>{var ie=pt(),xe=et(ie);{var Me=He=>{var $e=iu(),Ye=u($e),Ne=u(Ye),Ge=w(Ye,2);Ge.__click=[Zi],D((Ke,he,ke)=>{S(Ne,Ke),de(Ge,"aria-label",he),de(Ge,"title",ke)},[()=>n()("Chapters"),()=>n()("Append Item"),()=>n()("Append Item")]),_(He,$e)},Ae=He=>{var $e=su(),Ye=u($e),Ne=u(Ye),Ge=w(Ye,2);Ge.__click=[Zi],D((Ke,he,ke)=>{S(Ne,Ke),de(Ge,"aria-label",he),de(Ge,"title",ke)},[()=>y(n()("Chapters")),()=>n()("Append Item"),()=>n()("Append Item")]),_(He,$e)};U(xe,He=>{i()?He(Me):He(Ae,!1)})}_(oe,ie)};U(x,oe=>{l()&&oe(F)})}var q=w(W,2),te=u(q);Dt(te,e,"sidebar-spine",{});var M=w(q,2),Q=u(M);Dt(Q,e,"sidebar-about",{});var ce=w(Q,2);Dt(ce,e,"sidebar-workspace",{});var be=w(ce,2);Dt(be,e,"sidebar-metadata",{});var _e=w(be,2);Dt(_e,e,"sidebar-manifest",{});var Ue=w(_e,2);Dt(Ue,e,"sidebar-navigation",{});var Ce=w(Ue,2);Dt(Ce,e,"sidebar-settings",{});var pe=w(O,2),K=u(pe);Dt(K,e,"sidebar-footer",{}),D((oe,ie,xe)=>{k=ct(L,1,"sidebar svelte-1l16yvq",null,k,oe),de(T,"aria-expanded",i()),de(T,"aria-label",ie),S(P,i()?"âï¸":"â¶ï¸"),de(W,"aria-label",xe)},[()=>({collapsed:!i()}),()=>n()("Toggle sidebar"),()=>n()("Main navigation")]),_(r,L),at(),a()}_t(["click"]);var cu=I('<div class="pane-content svelte-4h1481"><!></div>'),du=I('<div class="pane-content svelte-4h1481"><!></div>'),uu=I("<!> <!> <!>",1),fu=I('<div class="single-pane-container svelte-4h1481"><!></div>'),pu=I('<div class="app-layout svelte-4h1481"><!> <div class="main-content svelte-4h1481"><!></div></div>');function hu(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(Un,"$layoutStore",t),i=st(),o=st(),l=st();let d=V(e,"hasWorkspace",8,!1),f=V(e,"currentWorkspace",8,null),c=V(e,"workspaceTitle",8,void 0),p=V(e,"extensionManager",8,null);Rt(()=>(s(i),n()),()=>{(k=>{m(i,k.sidebar)})(n())}),Rt(()=>s(i),()=>{m(o,s(i).isExpanded?"250px":"48px")}),Rt(()=>s(i),()=>{m(l,s(i).activeSection!=="workspace"&&s(i).activeSection!=="settings")}),xn();var h=pu(),v=u(h);lu(v,{get isExpanded(){return s(i).isExpanded},get activeSection(){return s(i).activeSection},get hasWorkspace(){return d()},get currentWorkspace(){return f()},get workspaceTitle(){return c()},get extensionManager(){return p()},$$slots:{"sidebar-workspace":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-workspace",{}),_(k,T)},"sidebar-metadata":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-metadata",{}),_(k,T)},"sidebar-manifest":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-manifest",{}),_(k,T)},"sidebar-navigation":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-navigation",{}),_(k,T)},"sidebar-spine":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-spine",{}),_(k,T)},"sidebar-settings":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-settings",{}),_(k,T)},"sidebar-footer":(k,E)=>{var T=pt(),P=et(T);Dt(P,e,"sidebar-footer",{}),_(k,T)}}});var g=w(v,2),b=u(g);{var y=k=>{bd(k,{direction:"horizontal",autoSaveId:"editme-content-panes",children:(E,T)=>{var P=uu(),$=et(P);Yi($,{defaultSize:50,minSize:25,children:(O,W)=>{var N=cu(),j=u(N);Dt(j,e,"left-content",{}),_(O,N)},$$slots:{default:!0}});var R=w($,2);Sd(R,{});var z=w(R,2);Yi(z,{defaultSize:50,minSize:20,children:(O,W)=>{var N=du(),j=u(N);Dt(j,e,"right-content",{}),_(O,N)},$$slots:{default:!0}}),_(E,P)},$$slots:{default:!0}})},L=k=>{var E=fu(),T=u(E);Dt(T,e,"left-content",{}),_(k,E)};U(b,k=>{s(l)?k(y):k(L,!1)})}D(()=>di(h,`grid-template-columns: ${s(o)??""} 1fr`)),_(r,h),at(),a()}const Pn={CURRENT_VIEW:"editme_nav_current_view",VIEW_HISTORY:"editme_nav_view_history",VIEW_DATA:"editme_nav_view_data"},vu=20,Wa={currentView:"about",previousView:null,viewHistory:["about"],viewData:{},isTransitioning:!1,canNavigateBack:!1,canNavigateForward:!1},mu=["about","workspace","metadata","manifest","navigation","spine","settings"];function gu(){const{subscribe:r,set:e,update:t}=Zt(Wa),a={guards:new Map,nextId:1};let n=0;return{subscribe:r,set:e,update:t,initialize(){let p=Wa.currentView,h=[...Wa.viewHistory],v={};try{const y=localStorage.getItem(Pn.CURRENT_VIEW);y&&o(y)&&(p=y);const L=localStorage.getItem(Pn.VIEW_HISTORY);if(L){const E=JSON.parse(L);Array.isArray(E)&&E.every(o)&&(h=E)}const k=localStorage.getItem(Pn.VIEW_DATA);if(k){const E=JSON.parse(k);typeof E=="object"&&E!==null&&(v=E)}}catch(y){console.warn("Failed to load navigation state:",y)}n=h.length-1;const g=n>0,b=!1;t(y=>({...y,currentView:p,previousView:h.length>1?h[h.length-2]:null,viewHistory:h,viewData:v,canNavigateBack:g,canNavigateForward:b,isInitialized:!0})),c(p),Un.subscribe(({sidebar:y})=>{let L=null;this.subscribe(E=>{L=E.currentView})(),y.activeSection!==L&&(navigator.userAgent.includes("Firefox")?queueMicrotask(()=>{this.navigateTo(y.activeSection,{replaceHistory:!0})}):this.navigateTo(y.activeSection,{replaceHistory:!0}))})},async navigateTo(p,h={}){if(!o(p))return console.error("Invalid view type:",p),!1;const v=i();if(v.currentView===p&&!h.force)return!0;t(g=>({...g,isTransitioning:!0}));try{if(!h.force&&!await l(v.currentView,p))return t(b=>({...b,isTransitioning:!1})),!1;if(v.currentView==="spine"&&p!=="spine"){const g=new CustomEvent("clear-spine-selection");window.dispatchEvent(g)}return await d(p,h),!0}catch(g){return console.error("Navigation error:",g),t(b=>({...b,isTransitioning:!1})),!1}},async canNavigate(p){const h=i(),v=p||h.currentView;if(!o(v))return!1;try{return await l(h.currentView,v)}catch(g){return console.error("Guard execution error:",g),!1}},async goBack(){const p=i();if(!p.canNavigateBack||n<=0)return!1;const h=p.viewHistory[n-1];return!h||!await l(p.currentView,h)?!1:(n--,await f(h,{isHistoryNavigation:!0}),!0)},async goForward(){const p=i();if(!p.canNavigateForward||n>=p.viewHistory.length-1)return!1;const h=p.viewHistory[n+1];return!h||!await l(p.currentView,h)?!1:(n++,await f(h,{isHistoryNavigation:!0}),!0)},setViewData(p,h){if(!o(p)){console.error("Invalid view type for setViewData:",p);return}t(v=>{const g={...v.viewData,[p]:h};try{localStorage.setItem(Pn.VIEW_DATA,JSON.stringify(g))}catch(b){console.warn("Failed to save view data:",b)}return{...v,viewData:g}})},getViewData(p){return o(p)?i().viewData[p]||null:(console.error("Invalid view type for getViewData:",p),null)},clearViewData(p){if(!o(p)){console.error("Invalid view type for clearViewData:",p);return}t(h=>{const v={...h.viewData};delete v[p];try{localStorage.setItem(Pn.VIEW_DATA,JSON.stringify(v))}catch(g){console.warn("Failed to save view data:",g)}return{...h,viewData:v}})},addNavigationGuard(p){const h=`guard_${a.nextId++}`;return a.guards.set(h,p),h},removeNavigationGuard(p){return a.guards.delete(p)}};function i(){let p;return r(h=>p=h)(),p}function o(p){return mu.includes(p)}async function l(p,h){const v=Array.from(a.guards.values());for(const g of v)try{if(!await g(p,h))return!1}catch(b){return console.error("Navigation guard error:",b),!1}return!0}async function d(p,h){const v=i();h.viewData&&t(b=>({...b,viewData:{...b.viewData,[p]:h.viewData}}));let g=[...v.viewHistory];h.replaceHistory?(g[g.length-1]=p,n=g.length-1):(g=g.slice(0,n+1),g.push(p),n=g.length-1,g.length>vu&&(g=g.slice(-20),n=g.length-1)),await f(p,{newHistory:g})}async function f(p,h={}){const v=i(),g=h.newHistory||v.viewHistory,b=n>0,y=n<g.length-1;t(L=>({...L,currentView:p,previousView:L.currentView,viewHistory:g,canNavigateBack:b,canNavigateForward:y,isTransitioning:!1}));try{localStorage.setItem(Pn.CURRENT_VIEW,p),localStorage.setItem(Pn.VIEW_HISTORY,JSON.stringify(g))}catch(L){console.warn("Failed to save navigation state:",L)}h.isHistoryNavigation||c(p)}function c(p){try{Un.setSidebarSection(p)}catch(h){console.warn("Failed to sync to layout store:",h)}}}const Mt=gu();typeof window<"u"&&Mt.initialize();const wu=`Copyright (c) 2025 Stewart Haines <https://stewarthaines.com>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
`;var yu=I('<div class="about-view svelte-jmnys0"><div class="about-content svelte-jmnys0"><header class="about-header svelte-jmnys0"><h1 class="app-title svelte-jmnys0"> </h1> <p class="app-version svelte-jmnys0"> </p></header> <section class="about-section svelte-jmnys0"><h2 class="svelte-jmnys0"> </h2> <p class="svelte-jmnys0"> </p> <p class="svelte-jmnys0"><a href="https://stewarthaines.com/epub" target="_blank" rel="noopener noreferrer" class="external-link svelte-jmnys0"> </a></p> <p class="svelte-jmnys0"> </p></section> <section class="about-section svelte-jmnys0"><h2 class="svelte-jmnys0"> </h2> <pre class="license-text svelte-jmnys0"> </pre></section></div></div>');function bu(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i="0.4.3";Bt();var o=yu(),l=u(o),d=u(l),f=u(d),c=u(f),p=w(f,2),h=u(p),v=w(d,2),g=u(v),b=u(g),y=w(g,2),L=u(y),k=w(y,2),E=u(k),T=u(E),P=w(k,2),$=u(P),R=w(v,2),z=u(R),O=u(z),W=w(z,2),N=u(W);D((j,x,F,q,te,M,Q)=>{S(c,j),S(h,`${x??""}: ${i}`),S(b,F),S(L,q),S(T,te),S($,M),S(O,Q),S(N,wu)},[()=>n()("about.subtitle"),()=>n()("about.version"),()=>n()("about.description.title"),()=>n()("about.description.content"),()=>n()("about.website.link"),()=>n()("about.attribution.content"),()=>n()("about.license.title")],De),_(r,o),at(),a()}var _u=I('<span class="library-version svelte-3a2w4e"> </span>'),xu=I('<div class="library-item svelte-3a2w4e"><h3 class="library-name svelte-3a2w4e"><a target="_blank" rel="noopener noreferrer" class="external-link svelte-3a2w4e"> </a> <!></h3> <p class="library-description svelte-3a2w4e"> </p> <p class="library-copyright svelte-3a2w4e"> </p></div>'),Su=I('<div class="thirdparty-view svelte-3a2w4e"><div class="thirdparty-content svelte-3a2w4e"><header class="thirdparty-header svelte-3a2w4e"><h1 class="svelte-3a2w4e"> </h1> <p class="thirdparty-intro svelte-3a2w4e"> </p></header> <section class="libraries-section svelte-3a2w4e"><div class="library-list svelte-3a2w4e"></div> <div class="mit-license-section svelte-3a2w4e"><h3 class="svelte-3a2w4e"> </h3> <pre class="license-text svelte-3a2w4e"></pre></div></section></div></div>');function Eu(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=[{name:"Svelte",version:"^5.28.1",license:"MIT",url:"https://github.com/sveltejs/svelte",description:"Cybernetically enhanced web apps",copyright:"Copyright (c) 2016-present, sveltejs"},{name:"paneforge",version:"^1.0.0",license:"MIT",url:"https://github.com/svecosystem/paneforge",description:"Headless pane management for Svelte",copyright:"Copyright (c) 2024 Hunter Johnston <https://github.com/huntabyte> Copyright (c) 2023 Brian Vaughn <https://github.com/bvaughn>"},{name:"ndesmic/zip",version:"N/A",license:"MIT",url:"https://github.com/ndesmic/zip",description:"Browser-native ZIP implementation (substantial portions used)",copyright:"Copyright (c) 2021 ndesmic"}];Bt();var o=Su(),l=u(o),d=u(l),f=u(d),c=u(f),p=w(f,2),h=u(p),v=w(d,2),g=u(v);Ct(g,5,()=>i,Pt,(E,T)=>{var P=xu(),$=u(P),R=u($),z=u(R),O=w(R,2);{var W=q=>{var te=_u(),M=u(te);D(()=>S(M,`v${s(T).version??""}`)),_(q,te)};U(O,q=>{s(T).version!=="N/A"&&q(W)})}var N=w($,2),j=u(N),x=w(N,2),F=u(x);D(()=>{de(R,"href",s(T).url),S(z,s(T).name),S(j,s(T).description),S(F,s(T).copyright)}),_(E,P)});var b=w(g,2),y=u(b),L=u(y),k=w(y,2);k.textContent=`MIT License

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`,D((E,T,P)=>{S(c,E),S(h,T),S(L,`${P??""}: MIT`)},[()=>n()("about.thirdparty.title"),()=>n()("about.thirdparty.intro"),()=>n()("about.thirdparty.license")],De),_(r,o),at(),a()}const ku=(r,e)=>{console.log("ð¯ WorkspaceActionBar: Create New button clicked!"),e("createNewRequested"),console.log("ð¯ WorkspaceActionBar: createNewRequested event dispatched")},Tu=(r,e)=>{e("loadEpubRequested")};var Cu=I('<div class="workspace-action-bar svelte-4wg9d"><h3 class="section-title svelte-4wg9d"> </h3> <div class="action-buttons svelte-4wg9d"><button type="button" class="action-button primary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">â</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button> <button type="button" class="action-button secondary svelte-4wg9d"><span class="button-icon svelte-4wg9d" aria-hidden="true">ð</span> <div class="button-content svelte-4wg9d"><span class="button-title svelte-4wg9d"> </span> <span class="button-subtitle svelte-4wg9d"> </span></div></button></div></div>');function Iu(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=cn();let o=V(e,"isLoading",8,!1);Bt();var l=Cu(),d=u(l),f=u(d),c=w(d,2),p=u(c);p.__click=[ku,i];var h=w(u(p),2),v=u(h),g=u(v),b=w(v,2),y=u(b),L=w(p,2);L.__click=[Tu,i];var k=w(u(L),2),E=u(k),T=u(E),P=w(E,2),$=u(P);D((R,z,O,W,N,j,x)=>{S(f,R),p.disabled=o(),de(p,"aria-label",z),S(g,O),S(y,W),L.disabled=o(),de(L,"aria-label",N),S(T,j),S($,x)},[()=>n()("Get Started"),()=>n()("Create a new minimal EPUB project"),()=>n()("Create New"),()=>n()("Start fresh"),()=>n()("Load an existing EPUB file for editing"),()=>n()("Load EPUB"),()=>n()("Edit existing file")],De),_(r,l),at(),a()}_t(["click"]);const Fu=(r,e,t)=>{r.stopPropagation(),e("deleteRequested",{workspaceId:t().id})},Mu=(r,e)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e())};var Pu=I('<span class="workspace-icon error svelte-ijd5ei">â ï¸</span>'),Lu=I('<span class="workspace-icon svelte-ijd5ei" aria-hidden="true">ð</span>'),Ru=I('<span class="workspace-author-inline svelte-ijd5ei"> </span>'),Du=I('<span class="current-badge svelte-ijd5ei"> </span>'),Au=I('<div role="button" tabindex="0"><div class="workspace-main svelte-ijd5ei"><div class="workspace-icon-container svelte-ijd5ei"><!></div> <div class="workspace-info svelte-ijd5ei"><div class="workspace-header svelte-ijd5ei"><h3 class="workspace-title svelte-ijd5ei"> <!> <!></h3> <span class="workspace-time svelte-ijd5ei"> </span></div> <div class="workspace-meta svelte-ijd5ei"><span class="workspace-language svelte-ijd5ei"> </span> <span class="meta-separator svelte-ijd5ei">â¢</span> <span class="workspace-stats svelte-ijd5ei"> <!> <!></span></div></div></div> <div class="workspace-actions svelte-ijd5ei"><button type="button" class="delete-button svelte-ijd5ei"><span aria-hidden="true">ðï¸</span></button></div></div>');function Ou(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=cn();let o=V(e,"workspace",8),l=V(e,"isCurrent",8,!1),d=V(e,"hasError",8,!1);const f=()=>{i("selected",{workspaceId:o().id})},c=pe=>{const oe=new Date().getTime()-pe.getTime(),ie=Math.floor(oe/(1e3*60*60)),xe=Math.floor(ie/24);return ie<1?n()("Just now"):ie<24?n()("{count}h ago",{count:ie}):xe===1?n()("1 day ago"):xe<7?n()("{count} days ago",{count:xe}):n()("{count}w ago",{count:Math.floor(xe/7)})},p=pe=>{if(pe===0)return"0 B";const K=1024,oe=["B","KB","MB","GB"],ie=Math.floor(Math.log(pe)/Math.log(K));return parseFloat((pe/Math.pow(K,ie)).toFixed(1))+" "+oe[ie]};Bt();var h=Au();let v;h.__click=f,h.__keydown=[Mu,f];var g=u(h),b=u(g),y=u(b);{var L=pe=>{var K=Pu();D((oe,ie)=>{de(K,"aria-label",oe),de(K,"title",ie)},[()=>n()("Error"),()=>n()("Project has errors")],De),_(pe,K)},k=pe=>{var K=Lu();_(pe,K)};U(y,pe=>{d()||o().hasError?pe(L):pe(k,!1)})}var E=w(b,2),T=u(E),P=u(T),$=u(P),R=w($);{var z=pe=>{var K=Ru(),oe=u(K);D(()=>S(oe,`- ${o().author??""}`)),_(pe,K)};U(R,pe=>{o().author&&pe(z)})}var O=w(R,2);{var W=pe=>{var K=Du(),oe=u(K);D((ie,xe)=>{de(K,"aria-label",ie),S(oe,xe)},[()=>n()("Currently open"),()=>n()("Current")],De),_(pe,K)};U(O,pe=>{l()&&pe(W)})}var N=w(P,2),j=u(N),x=w(T,2),F=u(x),q=u(F),te=w(F,4),M=u(te),Q=w(M);{var ce=pe=>{var K=Tt();D(oe=>S(K,`â¢ ${oe??""}`),[()=>p(o().totalSize)],De),_(pe,K)};U(Q,pe=>{o().totalSize>0&&pe(ce)})}var be=w(Q,2);{var _e=pe=>{var K=Tt();D(oe=>S(K,`â¢ ${oe??""}`),[()=>o().extensionIds.join(", ")],De),_(pe,K)};U(be,pe=>{o().extensionIds&&o().extensionIds.length>0&&pe(_e)})}var Ue=w(g,2),Ce=u(Ue);Ce.__click=[Fu,i,o],D((pe,K,oe,ie,xe,Me)=>{v=ct(h,1,"workspace-item svelte-ijd5ei",null,v,pe),de(h,"aria-label",K),S($,`${o().title??""} `),S(j,oe),S(q,o().language),S(M,`${o().fileCount??""}
          ${ie??""} `),de(Ce,"aria-label",xe),de(Ce,"title",Me)},[()=>({current:l(),error:d()||o().hasError}),()=>n()("Open project: {title}",{title:o().title}),()=>c(o().lastModified),()=>n()("files"),()=>n()("Delete project: {title}",{title:o().title}),()=>n()("Delete project")],De),_(r,h),at(),a()}_t(["click","keydown"]);var Uu=I('<button type="button" class="clear-search svelte-1juhm6m">Ã</button>'),zu=I('<div class="search-container svelte-1juhm6m"><div class="search-input-wrapper svelte-1juhm6m"><input type="search" class="search-input svelte-1juhm6m"/> <!></div></div>'),Wu=I('<div class="loading-state svelte-1juhm6m"><div class="skeleton-item svelte-1juhm6m" aria-hidden="true"></div> <div class="skeleton-item svelte-1juhm6m" aria-hidden="true"></div> <div class="skeleton-item svelte-1juhm6m" aria-hidden="true"></div> <p class="loading-text svelte-1juhm6m"> </p></div>'),Nu=I('<div class="empty-state svelte-1juhm6m"><div class="empty-tips svelte-1juhm6m"><h5 class="tips-title svelte-1juhm6m"> </h5> <ul class="tips-list svelte-1juhm6m"><li class="svelte-1juhm6m"> </li> <li class="svelte-1juhm6m"> </li> <li class="svelte-1juhm6m"><!></li></ul></div></div>'),ju=I('<div class="no-results svelte-1juhm6m"><div class="no-results-icon svelte-1juhm6m" aria-hidden="true">ð</div> <h4 class="no-results-title svelte-1juhm6m"> </h4> <p class="no-results-description svelte-1juhm6m"> </p> <button type="button" class="clear-search-button svelte-1juhm6m"> </button></div>'),Bu=I('<div class="search-results-info svelte-1juhm6m"><p class="results-text svelte-1juhm6m"> </p></div>'),Hu=I('<div class="workspace-grid svelte-1juhm6m"></div> <!>',1),Vu=I('<div class="workspace-list svelte-1juhm6m"><div class="list-header svelte-1juhm6m"><!></div> <div class="list-content svelte-1juhm6m"><!></div></div>');function qu(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=st(),o=st(),l=cn();let d=V(e,"workspaces",24,()=>[]),f=V(e,"currentWorkspaceId",8,null),c=V(e,"isLoading",8,!1),p=st("");const h=O=>{l("workspaceSelected",O.detail)},v=O=>{l("workspaceDeleted",O.detail)},g=O=>{l("packageRequested",O.detail)},b=O=>{const W=O.target;m(p,W.value)},y=()=>{m(p,"")};Rt(()=>(Lt(d()),s(p)),()=>{m(i,d().filter(O=>{if(!s(p))return!0;const W=s(p).toLowerCase();return O.title.toLowerCase().includes(W)||O.author?.toLowerCase().includes(W)||O.language.toLowerCase().includes(W)}))}),Rt(()=>s(i),()=>{m(o,[...s(i)].sort((O,W)=>W.lastModified.getTime()-O.lastModified.getTime()))}),xn(),Bt();var L=Vu(),k=u(L),E=u(k);{var T=O=>{var W=zu(),N=u(W),j=u(N),x=w(j,2);{var F=q=>{var te=Uu();D(M=>de(te,"aria-label",M),[()=>n()("Clear search")],De),nt("click",te,y),_(q,te)};U(x,q=>{s(p)&&q(F)})}D((q,te)=>{de(j,"placeholder",q),Qt(j,s(p)),de(j,"aria-label",te)},[()=>n()("Search projectsâ¦"),()=>n()("Search projects")],De),nt("input",j,b),_(O,W)};U(E,O=>{d().length>0&&O(T)})}var P=w(k,2),$=u(P);{var R=O=>{var W=Wu(),N=w(u(W),6),j=u(N);D(x=>S(j,x),[()=>n()("Loading projectsâ¦")],De),_(O,W)},z=(O,W)=>{{var N=x=>{var F=Nu(),q=u(F),te=u(q),M=u(te),Q=w(te,2),ce=u(Q),be=u(ce),_e=w(ce,2),Ue=u(_e),Ce=w(_e,2),pe=u(Ce);qs(pe,()=>n()("Download: Start with a sample from {link}",{link:`<a target="_blank" href="https://stewarthaines.com/epub">${n()("SEED.html home page")}</a>`})),D((K,oe,ie)=>{S(M,K),S(be,oe),S(Ue,ie)},[()=>n()("Quick Start Tips:"),()=>n()("Create New: Start with a minimal project"),()=>n()("Load EPUB: Load .epub file from the filesystem")],De),_(x,F)},j=(x,F)=>{{var q=M=>{var Q=ju(),ce=w(u(Q),2),be=u(ce),_e=w(ce,2),Ue=u(_e),Ce=w(_e,2),pe=u(Ce);D((K,oe,ie)=>{S(be,K),S(Ue,oe),S(pe,ie)},[()=>n()("No projects found"),()=>n()('No projects match your search for "{query}"',{query:s(p)}),()=>n()("Clear search")],De),nt("click",Ce,y),_(M,Q)},te=M=>{var Q=Hu(),ce=et(Q);Ct(ce,5,()=>s(o),Ue=>Ue.id,(Ue,Ce)=>{const pe=De(()=>s(Ce).id===f()),K=De(()=>s(Ce).hasError||!1);Ou(Ue,{get workspace(){return s(Ce)},get isCurrent(){return s(pe)},get hasError(){return s(K)},$$events:{selected:h,deleteRequested:v,packageRequested:g}})});var be=w(ce,2);{var _e=Ue=>{var Ce=Bu(),pe=u(Ce),K=u(pe);D(oe=>S(K,oe),[()=>n()("Showing {filtered} of {total} workspaces",{filtered:s(i).length,total:d().length})],De),_(Ue,Ce)};U(be,Ue=>{s(p)&&s(i).length<d().length&&Ue(_e)})}_(M,Q)};U(x,M=>{s(i).length===0?M(q):M(te,!1)},F)}};U(O,x=>{d().length===0?x(N):x(j,!1)},W)}};U($,O=>{c()?O(R):O(z,!1)})}_(r,L),at(),a()}function gn(){return new Date().toISOString().replace(/\.\d{3}Z$/,"Z")}class kt{static parseContainerXml(e){try{if(!globalThis.DOMParser)return{error:"DOMParser not available"};const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return{error:"Invalid XML in container.xml"};const i=a.querySelector("rootfile");if(!i)return{error:"No rootfile element found in container.xml"};const o=i.getAttribute("full-path");return o?o.endsWith(".opf")?{rootfilePath:o}:{error:`Rootfile does not appear to be an OPF file: ${o}`}:{error:"No full-path attribute found in rootfile element"}}catch(t){return{error:`Failed to parse container.xml: ${t instanceof Error?t.message:"Unknown error"}`}}}static validateXML(e){try{if(!globalThis.DOMParser)return{isValid:!1,error:"DOMParser not available"};const n=new DOMParser().parseFromString(e,"application/xml").querySelector("parsererror");return n?{isValid:!1,error:n.textContent||"Unknown XML parsing error"}:{isValid:!0}}catch(t){return{isValid:!1,error:t instanceof Error?t.message:"XML validation failed"}}}static parseOPFMetadata(e){const t="http://purl.org/dc/elements/1.1/";let a=e.getElementsByTagNameNS(t,"title");a.length===0&&(a=e.querySelectorAll("dc\\:title, title"));let n=e.getElementsByTagNameNS(t,"language");n.length===0&&(n=e.querySelectorAll("dc\\:language, language"));let i=e.getElementsByTagNameNS(t,"identifier");if(i.length===0&&(i=e.querySelectorAll("dc\\:identifier, identifier")),a.length===0||!a[0].textContent?.trim())throw new Error("Missing required dc:title in OPF metadata");if(n.length===0||!n[0].textContent?.trim())throw new Error("Missing required dc:language in OPF metadata");if(i.length===0||!i[0].textContent?.trim())throw new Error("Missing required dc:identifier in OPF metadata");let o=e.getElementsByTagNameNS(t,"creator");o.length===0&&(o=e.querySelectorAll("dc\\:creator, creator"));let l=e.getElementsByTagNameNS(t,"contributor");l.length===0&&(l=e.querySelectorAll("dc\\:contributor, contributor"));let d=e.getElementsByTagNameNS(t,"subject");d.length===0&&(d=e.querySelectorAll("dc\\:subject, subject"));const f=e.getElementsByTagNameNS(t,"publisher"),c=e.getElementsByTagNameNS(t,"date"),p=e.getElementsByTagNameNS(t,"description"),h=e.getElementsByTagNameNS(t,"rights"),v=e.getElementsByTagNameNS(t,"source"),g=e.getElementsByTagNameNS(t,"relation"),b=e.getElementsByTagNameNS(t,"coverage"),y=e.getElementsByTagNameNS(t,"type"),L=e.getElementsByTagNameNS(t,"format"),k=e.querySelectorAll('meta[property="dcterms:modified"]'),E=Array.from(o).map(N=>N.textContent?.trim()).filter(Boolean),T=Array.from(l).map(N=>N.textContent?.trim()).filter(Boolean),P=Array.from(d).map(N=>N.textContent?.trim()).filter(Boolean),$=e.querySelector('meta[property="rendition:layout"]'),R=e.querySelector('meta[property="rendition:orientation"]'),z=e.querySelector('meta[property="rendition:spread"]'),W=e.querySelector("spine")?.getAttribute("page-progression-direction");return{title:a[0].textContent.trim(),language:n[0].textContent.trim(),identifier:i[0].textContent.trim(),creator:E.length>0?E:void 0,contributor:T.length>0?T:void 0,publisher:f.length>0?f[0].textContent?.trim():void 0,date:c.length>0?c[0].textContent?.trim():void 0,description:p.length>0?p[0].textContent?.trim():void 0,subject:P.length>0?P:void 0,rights:h.length>0?h[0].textContent?.trim():void 0,source:v.length>0?v[0].textContent?.trim():void 0,relation:g.length>0?g[0].textContent?.trim():void 0,coverage:b.length>0?b[0].textContent?.trim():void 0,type:y.length>0?y[0].textContent?.trim():void 0,format:L.length>0?L[0].textContent?.trim():void 0,modifiedDate:k.length>0?k[0].textContent?.trim():void 0,renditionLayout:$?.textContent?.trim()||void 0,renditionOrientation:R?.textContent?.trim()||void 0,renditionSpread:z?.textContent?.trim()||void 0,pageProgressionDirection:W||void 0}}static parseOPFDocument(e){const t=this.validateXML(e);if(!t.isValid)throw new Error(`Invalid OPF XML: ${t.error}`);const n=new DOMParser().parseFromString(e,"application/xml"),o=n.querySelector("package")?.getAttribute("version")||"2.0",l=this.parseOPFMetadata(n),d=[];n.querySelectorAll("manifest item").forEach(g=>{const b=g.getAttribute("id"),y=g.getAttribute("href"),L=g.getAttribute("media-type");if(b&&y&&L){const k=g.getAttribute("properties"),E=g.getAttribute("fallback");d.push({id:b,href:y,mediaType:L,properties:k?k.split(" "):void 0,fallback:E||void 0})}});const c=[];n.querySelectorAll("spine itemref").forEach(g=>{const b=g.getAttribute("idref");if(b){const y=g.getAttribute("linear"),L=g.getAttribute("properties");c.push({idref:b,linear:y!=="no",properties:L?L.split(" "):void 0})}});const h=[];return n.querySelectorAll("guide reference").forEach(g=>{const b=g.getAttribute("type"),y=g.getAttribute("href");if(b&&y){const L=g.getAttribute("title");h.push({type:b,href:y,title:L||void 0})}}),{metadata:l,manifest:d,spine:c,guide:h.length>0?h:void 0,version:o}}static generateOPFXML(e){const{metadata:t,manifest:a,spine:n,guide:i,version:o}=e,l=c=>c.replace(/[<>&'"]/g,p=>{switch(p){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&apos;";default:return p}}),d=a.find(c=>c.id==="uuid")?.id||"uuid";let f=`<?xml version="1.0" encoding="utf-8"?>
<package version="${o}" xmlns="http://www.idpf.org/2007/opf" unique-identifier="${d}" prefix="rendition: http://www.idpf.org/vocab/rendition/# ibooks: http://vocabulary.itunes.apple.com/rdf/ibooks/vocabulary-extensions-1.0/" xml:lang="en">
  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:ibooks="http://vocabulary.itunes.apple.com/rdf/ibooks/vocabularies/2012/01/ibooks-specific">
    <dc:title>${l(t.title)}</dc:title>
    <dc:language>${l(t.language)}</dc:language>
    <dc:identifier id="${d}">${l(t.identifier)}</dc:identifier>`;return t.creator&&t.creator.length>0&&t.creator.forEach(c=>{f+=`
    <dc:creator>${l(c)}</dc:creator>`}),t.contributor&&t.contributor.length>0&&t.contributor.forEach(c=>{f+=`
    <dc:contributor>${l(c)}</dc:contributor>`}),t.publisher&&(f+=`
    <dc:publisher>${l(t.publisher)}</dc:publisher>`),t.date&&(f+=`
    <dc:date>${l(t.date)}</dc:date>`),t.description&&(f+=`
    <dc:description>${l(t.description)}</dc:description>`),t.subject&&t.subject.length>0&&t.subject.forEach(c=>{f+=`
    <dc:subject>${l(c)}</dc:subject>`}),t.rights&&(f+=`
    <dc:rights>${l(t.rights)}</dc:rights>`),t.source&&(f+=`
    <dc:source>${l(t.source)}</dc:source>`),t.relation&&(f+=`
    <dc:relation>${l(t.relation)}</dc:relation>`),t.coverage&&(f+=`
    <dc:coverage>${l(t.coverage)}</dc:coverage>`),t.type&&(f+=`
    <dc:type>${l(t.type)}</dc:type>`),t.format&&(f+=`
    <dc:format>${l(t.format)}</dc:format>`),t.modifiedDate&&(f+=`
    <meta property="dcterms:modified">${l(t.modifiedDate)}</meta>`),t.renditionLayout&&t.renditionLayout!=="reflowable"&&(f+=`
    <meta property="rendition:layout">${l(t.renditionLayout)}</meta>`),t.renditionOrientation&&t.renditionOrientation!=="auto"&&(f+=`
    <meta property="rendition:orientation">${l(t.renditionOrientation)}</meta>`),t.renditionSpread&&t.renditionSpread!=="auto"&&(f+=`
    <meta property="rendition:spread">${l(t.renditionSpread)}</meta>`),f+=`
    <meta property="ibooks:specified-fonts">true</meta>`,f+=`
    <meta property="schema:accessMode">textual</meta>
    <meta property="schema:accessibilityFeature">alternativeText</meta>
    <meta property="schema:accessibilityHazard">noFlashingHazard</meta>
    <meta property="schema:accessibilityHazard">noSoundHazard</meta>
    <meta property="schema:accessModeSufficient">textual,visual</meta>
    <meta property="schema:accessibilitySummary">This publication has been validated to meet the minimum conformance requirements for EPUB Accessibility 1.1.</meta>
    <meta property="dcterms:conformsTo">http://www.w3.org/standards/wcag/2.0/a</meta>
    <meta property="dcterms:conformsTo">http://www.idpf.org/epub/a11y/accessibility-20170829.html#wcag-a</meta>
    `,f+=`
  </metadata>
  <manifest>`,a.forEach(c=>{f+=`
    <item id="${l(c.id)}" href="${l(c.href)}" media-type="${l(c.mediaType)}"`,c.properties&&c.properties.length>0&&(f+=` properties="${l(c.properties.join(" "))}"`),c.fallback&&(f+=` fallback="${l(c.fallback)}"`),f+=" />"}),f+=`
  </manifest>`,t.pageProgressionDirection&&t.pageProgressionDirection!=="default"?f+=`
  <spine page-progression-direction="${l(t.pageProgressionDirection)}">`:f+=`
  <spine>`,n.forEach(c=>{f+=`
    <itemref idref="${l(c.idref)}"`,c.linear===!1&&(f+=' linear="no"'),c.properties&&c.properties.length>0&&(f+=` properties="${l(c.properties.join(" "))}"`),f+=" />"}),f+=`
  </spine>`,i&&i.length>0&&(f+=`
  <guide>`,i.forEach(c=>{f+=`
    <reference type="${l(c.type)}" href="${l(c.href)}"`,c.title&&(f+=` title="${l(c.title)}"`),f+=" />"}),f+=`
  </guide>`),f+=`
</package>`,f}static detectEPUBVersion(e){try{if(!globalThis.DOMParser)return;const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))return;const i=a.querySelector("package");if(i){const o=i.getAttribute("version");if(o)return o.startsWith("2.")?"EPUB 2.0":o.startsWith("3.")?"EPUB 3.0":`EPUB ${o}`}return a.querySelector("[properties]")||a.querySelector("[epub\\:type]")?"EPUB 3.0":"EPUB 2.0"}catch{return}}static parseRootfilePath(e){const t=e.match(/<rootfile[^>]+full-path\s*=\s*["']([^"']+)["'][^>]*>/i);if(!t)throw new Error("Could not find rootfile path in container.xml");return t[1]}static generateContainerXML(e="OEBPS/content.opf"){return`<?xml version="1.0" encoding="UTF-8"?>
<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">
  <rootfiles>
    <rootfile full-path="${e}" media-type="application/oebps-package+xml"/>
  </rootfiles>
</container>`}static validateManifestSpineConsistency(e,t){const a=[],n=new Set(e.map(i=>i.id));return t.forEach((i,o)=>{n.has(i.idref)||a.push(`Spine item ${o} references non-existent manifest item: ${i.idref}`)}),a}}const $u={"application/xhtml+xml":"Text/","text/html":"Text/","text/css":"Styles/","text/javascript":"Scripts/","application/javascript":"Scripts/","image/jpeg":"Images/","image/png":"Images/","image/gif":"Images/","image/svg+xml":"Images/","image/webp":"Images/","audio/mpeg":"Audio/","audio/ogg":"Audio/","audio/wav":"Audio/","audio/mp4":"Audio/","video/mp4":"Video/","video/webm":"Video/","video/ogg":"Video/","font/ttf":"Fonts/","font/otf":"Fonts/","font/woff":"Fonts/","font/woff2":"Fonts/","application/font-woff":"Fonts/","application/pdf":"Misc/","text/plain":"Text/"};function Gu(r){const e=r.split(";")[0].trim().toLowerCase();return $u[e]||""}function Ja(r,e){return Gu(e)+r}const Xu={html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",css:"text/css",js:"application/javascript",txt:"text/plain",json:"application/json",opf:"application/oebps-package+xml",ncx:"application/x-dtbncx+xml",epub:"application/epub+zip",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",gz:"application/gzip",zip:"application/zip"};function wo(r){const e=r.split(".").pop()?.toLowerCase();return Xu[e||""]||"application/octet-stream"}function yo(r){const e=r.startsWith("SOURCE/")?r.substring(7):r;return e==="settings.json"?"settings":e.startsWith("text/")?"text":e.startsWith("scripts/")?"script":e.startsWith("extensions/")?"extension":"other"}function Ku(r){if(!r||typeof r!="string"||r.trim()==="")return!1;let e=r.trim();if(e=e.replace(/\\/g,"/"),!e.startsWith("SOURCE/")||e.startsWith("/")||/^[A-Za-z]:/.test(e)||e.includes(".."))return!1;const t=e.split("/").pop()?.toLowerCase()||"",a=["con","aux","prn","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],n=t.split(".")[0];return!(a.includes(n)||t===".ds_store"||t==="thumbs.db")}function Zn(r){return!r||typeof r!="string"?!1:r.startsWith("SOURCE/")&&r.length>7}function Yu(r){const e={isValid:!0,errors:[],warnings:[]};if(!r||r.trim()==="")return e.isValid=!1,e.errors.push("Empty settings"),e;let t;try{t=JSON.parse(r)}catch(i){e.isValid=!1;const o=`Invalid JSON syntax: ${i}`;return e.errors.push(o),e}const a=["version"];for(const i of a)i in t?(t[i]===null||t[i]===void 0)&&(e.isValid=!1,e.errors.push(`Field '${i}' cannot be null or undefined`)):(e.isValid=!1,e.errors.push(`Missing required field: ${i}`));"is_draft"in t&&typeof t.is_draft!="boolean"&&(e.isValid=!1,e.errors.push('Field "is_draft" must be a boolean')),"draft_id"in t&&typeof t.draft_id!="number"&&(e.isValid=!1,e.errors.push('Field "draft_id" must be a number')),"text_transform"in t&&typeof t.text_transform!="string"&&(e.isValid=!1,e.errors.push('Field "text_transform" must be a string')),"dom_transforms"in t&&!Array.isArray(t.dom_transforms)&&(e.isValid=!1,e.errors.push('Field "dom_transforms" must be an array')),"version"in t&&typeof t.version!="string"&&(e.isValid=!1,e.errors.push('Field "version" must be a string'));const n=["is_draft","draft_id","text_transform","dom_transforms","version"];for(const i in t)n.includes(i)||e.warnings.push(`Unknown field: ${i}`);return e}async function Ju(r,e){const a=(await r.listFiles(e)).filter(i=>Zn(i)),n={totalFiles:a.length,totalSize:0,directories:{text:0,scripts:0,extensions:0},hasSettingsFile:!1};for(const i of a){try{const o=await r.readFile(e,i);n.totalSize+=o.byteLength}catch{continue}i==="SOURCE/settings.json"&&(n.hasSettingsFile=!0),i.startsWith("SOURCE/text/")?n.directories.text++:i.startsWith("SOURCE/scripts/")?n.directories.scripts++:i.startsWith("SOURCE/extensions/")&&n.directories.extensions++}return n}function Zu(r){if(!r||typeof r!="string")return"";let e=r.trim();return e=e.replace(/\\/g,"/"),e=e.replace(/\/+/g,"/"),e=e.split("/").filter(n=>n!=="."&&n!=="").join("/"),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e}const Qu={is_draft:!1,draft_id:1,text_transform:"markdown-transform.js",dom_transforms:["custom-dom.js"],version:"1.0.0"};class bo{constructor(e){this.fileStorage=e}async createSourceZip(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Error(`Workspace ${e} not found`);const n=(await this.fileStorage.listFiles(e)).filter(o=>Zn(o));if(n.length===0)return null;const i=new Qn;for(const o of n)try{const l=await this.fileStorage.readFile(e,o);await i.addFile(o,l)}catch(l){throw new Error(`Failed to read file ${o}: ${l}`)}try{return await i.buildBlob()}catch(o){throw new Error(`ZIP creation failed: ${o}`)}}catch(t){throw t instanceof Error?t:new Error(`Failed to create SOURCE.zip: ${t}`)}}async extractSourceZip(e,t){try{const a=await t.arrayBuffer(),n=new Ur(a);for(const i of n.entries){const o=Zu(i.fileName);if(!Ku(o))throw new Error(`Invalid file path: ${i.fileName}`);try{const d=await(await i.extract()).arrayBuffer();await this.fileStorage.writeFile(e,o,d)}catch(l){throw new Error(`Failed to write file ${o}: ${l}`)}}}catch(a){throw a instanceof Error?a:new Error(`Failed to extract SOURCE.zip: ${a}`)}}async hasSourceFiles(e){try{return(await this.fileStorage.listFiles(e)).filter(n=>Zn(n)).length>0}catch(t){throw new Error(`Failed to check SOURCE/ files: ${t}`)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e)).filter(i=>Zn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const o=await this.fileStorage.readFile(e,i),l={path:i,size:o.byteLength,type:yo(i)};n.push(l)}catch{continue}return n}catch(t){throw new Error(`Failed to list SOURCE/ files: ${t}`)}}async initializeSourceStructure(e){try{const t="SOURCE/settings.json";if(!await this.fileStorage.fileExists(e,t)){const a=JSON.stringify(Qu,null,2);await this.fileStorage.writeTextFile(e,t,a)}}catch(t){throw new Error(`Failed to initialize SOURCE/ structure: ${t}`)}}async validateSourceStructure(e){const t={isValid:!0,errors:[],warnings:[],fileCount:0,totalSize:0,hasSettings:!1};try{const n=(await this.fileStorage.listFiles(e)).filter(i=>Zn(i));t.fileCount=n.length;for(const i of n)try{const o=await this.fileStorage.readFile(e,i);if(t.totalSize+=o.byteLength,i==="SOURCE/settings.json"){t.hasSettings=!0;const d=new TextDecoder().decode(o),f=Yu(d);f.isValid||(t.isValid=!1,t.errors.push(...f.errors.map(c=>`Invalid settings.json format: ${c}`))),t.warnings.push(...f.warnings)}const l=i.substring(7);!l.includes("/")&&i!=="SOURCE/settings.json"&&t.warnings.push(`Unexpected file in SOURCE/ root: ${l}`)}catch{continue}t.hasSettings||t.warnings.push("Missing settings.json file")}catch(a){t.isValid=!1,t.errors.push(`Failed to validate SOURCE/ structure: ${a}`)}return t}async getSourceDirectoryStats(e){try{return await Ju(this.fileStorage,e)}catch(t){throw new Error(`Failed to get SOURCE/ directory statistics: ${t}`)}}}class ki{fileStorage;sourceManager;constructor(){this.fileStorage=Wt.getInstance(),this.sourceManager=new bo(this.fileStorage)}async packageEPUB(e,t={}){const a=Date.now();try{const n=await this.readWorkspaceFiles(e);if(n.length===0)return{success:!1,error:"Workspace is empty"};const i=await this.extractMetadata(n),o=new Qn,l=n.reduce((p,h)=>p+h.size,0);let d=0;for(let p=0;p<n.length;p++){const h=n[p],v=this.optimizeCompression(h.path,h.content);await o.addFile(h.path,h.content,{compressionMethod:v.method,lastModified:new Date}),d+=h.size,t.progressCallback?.({phase:"compressing",currentFile:h.path,processedFiles:p+1,totalFiles:n.length,currentBytes:d,totalBytes:l})}t.progressCallback?.({phase:"writing",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l});const f=await o.buildBlob(),c=this.generateFilename(i);return t.progressCallback?.({phase:"complete",processedFiles:n.length,totalFiles:n.length,currentBytes:l,totalBytes:l}),{success:!0,blob:f,filename:c,totalSize:l,compressedSize:f.size,fileCount:n.length,processingTime:Date.now()-a}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error",processingTime:Date.now()-a}}}async readWorkspaceFiles(e){const t=await this.fileStorage.listFiles(e),a=t.filter(o=>o.startsWith("SOURCE/")),n=t.filter(o=>!o.startsWith("SOURCE/")),i=[];for(const o of n)try{const l=await this.fileStorage.readFile(e,o);i.push({path:o,content:l,size:l.byteLength,mimeType:wo(o)})}catch(l){console.warn(`Failed to read file ${o}:`,l)}if(a.length>0)try{const o=await this.sourceManager.createSourceZip(e);if(o){const l=await o.arrayBuffer();i.push({path:"SOURCE.zip",content:l,size:l.byteLength,mimeType:"application/zip"})}}catch(o){console.warn("Failed to create SOURCE.zip:",o)}return i}async extractMetadata(e){const t=e.find(c=>c.path==="META-INF/container.xml");if(!t)throw new Error("Missing META-INF/container.xml file - invalid EPUB structure");const a=new TextDecoder,n=a.decode(t.content),i=kt.parseRootfilePath(n),o=e.find(c=>c.path===i);if(!o)throw new Error(`Missing OPF file at path: ${i}`);const l=a.decode(o.content),f=new DOMParser().parseFromString(l,"application/xml");return kt.parseOPFMetadata(f)}optimizeCompression(e,t){if(e==="mimetype")return{method:0,reason:"EPUB compliance requirement"};const a=e.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","mp3","mp4","webp","zip"].includes(a||"")?{method:0,reason:"Already compressed format"}:["html","xhtml","xml","css","js","txt","opf","ncx"].includes(a||"")?{method:8,reason:"Text-based content compresses well"}:{method:8,reason:"Default compression"}}generateFilename(e){const t=this.sanitizeFilename(e.title||"Untitled"),a=e.creator?.[0]?this.sanitizeFilename(e.creator[0]):null,n=new Date().toISOString().split("T")[0],i=[t];return a&&i.push(a),i.push(n),`${i.join(" - ")}.epub`}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,50)}downloadEPUB(e,t){Dd(e,t)}}var ef=I('<div class="error-banner svelte-9tke9n"><span class="error-icon svelte-9tke9n" aria-hidden="true">â ï¸</span> <span class="error-text svelte-9tke9n"> </span> <button type="button" class="retry-button svelte-9tke9n"> </button></div>'),tf=I('<div class="unsaved-indicator svelte-9tke9n"><span class="indicator-icon svelte-9tke9n" aria-hidden="true">â ï¸</span> <span> </span></div>'),nf=I('<div class="workspace-view svelte-9tke9n"><main class="view-content svelte-9tke9n"><!> <!>  <!> <!></main></div>');function rf(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=()=>tt(Ei,"$currentLocale",t);let o=V(e,"onWorkspaceChange",3,null),l=V(e,"currentWorkspaceId",3,null),d=fe(It([])),f=fe(null),c=fe(!1),p=fe(null),h=fe(!1),v=fe(""),g=fe(!1);const b=new ki;ht(()=>{l()&&s(d).length>0?m(f,s(d).find(K=>K.id===l())||null,!0):m(f,null)});const y=async K=>{if(K){m(f,s(d).find(oe=>oe.id===K)||null,!0),localStorage.setItem("currentWorkspace",K);try{await e.onLoadWorkspace(K)}catch(oe){console.error("Failed to load workspace:",oe)}}else m(f,null),localStorage.removeItem("currentWorkspace");o()&&o()(K),e.onWorkspaceChanged?.(K)},L=()=>{},k=async()=>{try{m(c,!0),m(p,null),m(d,await e.onListWorkspaces(),!0),L()}catch(K){console.error("Failed to load workspaces:",K),m(p,n()("Failed to load projects"),!0),m(d,[],!0)}finally{m(c,!1)}},E=()=>({title:"Untitled Book Project",identifier:crypto.randomUUID(),creator:["Unknown"]}),T=async()=>{try{m(c,!0);const K=i(),oe=E(),ie=await e.onCreateWorkspace({title:oe.title||"Untitled Book Project",language:K});console.log("â Workspace created:",ie),await k(),await y(ie),e.onNavigationRequested?.("metadata",ie),e.onWorkspaceOpened?.(ie)}catch(K){console.error("Failed to create workspace:",K),alert(n()("Failed to create workspace: {error}",{error:K instanceof Error?K.message:"Unknown error"}))}finally{m(c,!1)}},P=async()=>{try{m(c,!0),await e.onEpubImportRequested(),await k()}catch(K){console.error("Failed to import EPUB:",K),alert(n()("Failed to import EPUB: {error}",{error:K instanceof Error?K.message:"Unknown error"}))}finally{m(c,!1)}},$=async K=>{const{workspaceId:oe}=K.detail;try{await y(oe),e.onSmartNavigationRequested?.(oe),e.onWorkspaceOpened?.(oe)}catch(ie){console.error("Failed to open workspace:",ie),alert(n()("Failed to open workspace: {error}",{error:ie instanceof Error?ie.message:"Unknown error"}))}},R=async K=>{const{workspaceId:oe}=K.detail,ie=s(d).find(Me=>Me.id===oe);if(!(!ie||!confirm(n()('Delete "{title}"? This cannot be undone.',{title:ie.title}))))try{m(c,!0),await e.onDeleteWorkspace(oe),await k(),l()===oe&&await y(null)}catch(Me){console.error("Failed to delete workspace:",Me),alert(n()("Failed to delete workspace: {error}",{error:Me instanceof Error?Me.message:"Unknown error"}))}finally{m(c,!1)}},z=async K=>{const{workspaceId:oe}=K.detail;if(s(d).find(xe=>xe.id===oe))try{m(g,!0);const xe=await b.packageEPUB(oe,{progressCallback:Me=>{console.log(`Packaging progress: ${Me.phase} - ${Me.processedFiles}/${Me.totalFiles} files`)}});if(xe.success&&xe.blob&&xe.filename)b.downloadEPUB(xe.blob,xe.filename),console.log(`â Successfully packaged and downloaded: ${xe.filename}`);else throw new Error(xe.error||"Unknown packaging error")}catch(xe){console.error("Failed to package EPUB:",xe),alert(n()("Failed to package EPUB: {error}",{error:xe instanceof Error?xe.message:"Unknown error"}))}finally{m(g,!1)}};async function O(){return s(h)?window.confirm(n()("You have unsaved project changes. Continue?")):!0}function W(K){}function N(){}function j(){return{currentWorkspaceId:l(),hasUnsavedChanges:s(h)}}async function x(K){K.currentWorkspaceId&&await y(K.currentWorkspaceId),K.hasUnsavedChanges!==void 0&&m(h,K.hasUnsavedChanges,!0)}const F=()=>{k()};rn(async()=>{m(v,Mt.addNavigationGuard(O),!0),window.addEventListener("workspace-list-refresh",F),await k()}),ur(()=>{s(v)&&Mt.removeNavigationGuard(s(v)),window.removeEventListener("workspace-list-refresh",F)});var q=nf(),te=u(q),M=u(te);Iu(M,{get isLoading(){return s(c)},$$events:{createNewRequested:T,loadEpubRequested:P}});var Q=w(M,2);{var ce=K=>{var oe=ef(),ie=w(u(oe),2),xe=u(ie),Me=w(ie,2);Me.__click=k;var Ae=u(Me);D(He=>{S(xe,s(p)),S(Ae,He)},[()=>n()("Retry")]),_(K,oe)};U(Q,K=>{s(p)&&K(ce)})}var be=w(Q,2);const _e=ne(()=>s(c)||s(g));qu(be,{get workspaces(){return s(d)},get currentWorkspaceId(){return l()},get isLoading(){return s(_e)},$$events:{workspaceSelected:$,workspaceDeleted:R,packageRequested:z}});var Ue=w(be,2);{var Ce=K=>{var oe=tf(),ie=w(u(oe),2),xe=u(ie);D(Me=>S(xe,Me),[()=>n()("You have unsaved changes")]),_(K,oe)};U(Ue,K=>{s(h)&&K(Ce)})}_(r,q);var pe=at({canLeave:O,onViewEnter:W,onViewLeave:N,getViewData:j,setViewData:x});return a(),pe}_t(["click"]);var af=I('<span class="error-indicator svelte-z75kp3">!</span>'),sf=I('<button><span class="tab-label svelte-z75kp3"> </span> <!></button>');function of(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=cn();let o=V(e,"id",8,""),l=V(e,"label",8,""),d=V(e,"active",8,!1),f=V(e,"errorCount",8,0),c=V(e,"disabled",8,!1);const p=()=>{c()||i("click",{tabId:o()})},h=E=>{(E.key==="Enter"||E.key===" ")&&!c()&&(E.preventDefault(),i("click",{tabId:o()}))};Bt();var v=sf();let g;var b=u(v),y=u(b),L=w(b,2);{var k=E=>{var T=af();D(P=>de(T,"aria-label",P),[()=>n()("validation.errorsCount",{count:f()})],De),_(E,T)};U(L,E=>{f()>0&&E(k)})}D(E=>{g=ct(v,1,"metadata-tab svelte-z75kp3",null,g,E),v.disabled=c(),de(v,"aria-controls",`metadata-panel-${o()??""}`),de(v,"id",`metadata-tab-${o()??""}`),S(y,l())},[()=>({active:d(),"has-errors":f()>0,disabled:c()})],De),nt("click",v,p),nt("keydown",v,h),_(r,v),at(),a()}var lf=I('<div class="metadata-tab-bar svelte-1pzcjt6" tabindex="-1"></div>');function cf(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=cn();let o=V(e,"activeTab",8,"basic"),l=V(e,"validationErrors",24,()=>[]),d=V(e,"tabs",24,()=>[{id:"basic",label:n()("metadata.tab.basic")},{id:"advanced",label:n()("metadata.tab.advanced")},{id:"publication",label:n()("metadata.tab.publication")},{id:"accessibility",label:n()("metadata.tab.accessibility")}]);const f=v=>{const g=c(v);return l().filter(b=>g.includes(b.field)).length},c=v=>{switch(v){case"basic":return["title","language","identifier","creator"];case"advanced":return["publisher","date","description","subject","rights","source","relation","coverage","type","format","contributor"];case"publication":return["series","seriesPosition","epubVersion","uniqueIdentifierScheme","primaryCreatorFileAs","creatorRoles"];case"accessibility":return["accessMode","accessModeSufficient","accessibilityFeature","accessibilityHazard","accessibilitySummary","accessibilityCertification","accessibilityCertifier"];default:return[]}},p=v=>{i("tabClick",v.detail)};Bt();var h=lf();Ct(h,5,d,Pt,(v,g)=>{const b=De(()=>o()===s(g).id),y=De(()=>f(s(g).id));of(v,{get id(){return s(g).id},get label(){return s(g).label},get active(){return s(b)},get errorCount(){return s(y)},$$events:{click:p}})}),_(r,h),at(),a()}const df=(r,e,t)=>{m(e,r.target.value,!0),t.onchange?.({value:s(e)})},uf=(r,e,t)=>{r.key==="Enter"&&(m(e,r.target.value,!0),t.onblur?.({value:s(e)}))};var ff=I('<span class="field-error svelte-cp96ig" role="alert"> </span>'),pf=I("<label><!></label>"),hf=I('<div class="metadata-field svelte-cp96ig"><!> <input type="text"/></div>');function on(r,e){rt(e,!0);let t=V(e,"value",3,""),a=V(e,"placeholder",3,""),n=V(e,"required",3,!1),i=V(e,"disabled",3,!1),o=V(e,"error",3,""),l=V(e,"label",3,""),d=V(e,"id",3,""),f=fe(It(t()));ht(()=>{m(f,t())});let c=ne(()=>n()&&(!s(f)||s(f).trim()===""));const p=k=>{m(f,k.target.value,!0),e.onblur?.({value:s(f)})},h=()=>{e.onfocus?.({field:d()})};var v=hf(),g=u(v);{var b=k=>{var E=pf();let T;var P=u(E);{var $=z=>{var O=ff(),W=u(O);D(()=>{de(O,"id",`${d()??""}-error`),S(W,o())}),_(z,O)},R=z=>{var O=Tt();D(()=>S(O,l())),_(z,O)};U(P,z=>{o()?z($):z(R,!1)})}D(z=>{de(E,"for",d()),T=ct(E,1,"field-label svelte-cp96ig",null,T,z)},[()=>({"needs-attention":s(c)})]),_(k,E)};U(g,k=>{l()&&k(b)})}var y=w(g,2);let L;y.__input=[df,f,e],y.__keydown=[uf,f,e],D(k=>{de(y,"id",d()),de(y,"placeholder",a()),y.required=n(),y.disabled=i(),L=ct(y,1,"field-input svelte-cp96ig",null,L,k),de(y,"aria-describedby",o()?`${d()}-error`:void 0),de(y,"aria-invalid",!!o()||s(c))},[()=>({error:!!o(),"needs-attention":s(c)})]),nt("blur",y,p),nt("focus",y,h),Tr(y,()=>s(f),k=>m(f,k)),_(r,v),at()}_t(["input","keydown"]);const vf=(r,e)=>{const t=r.target;e.onblur?.({value:t.value})},mf=(r,e)=>{r.key==="Enter"&&e.onblur?.({value:r.target.value})};var gf=I('<div class="field-error svelte-bssb4o" role="alert"> </div>'),wf=I("<label><!></label>"),yf=I("<option> </option>"),bf=I("<option> </option>"),_f=I('<div class="metadata-field svelte-bssb4o"><!> <select><!><!></select></div>');function Xn(r,e){rt(e,!0);let t=V(e,"value",3,""),a=V(e,"options",19,()=>[]),n=V(e,"required",3,!1),i=V(e,"disabled",3,!1),o=V(e,"error",3,""),l=V(e,"label",3,""),d=V(e,"id",3,""),f=V(e,"placeholder",3,""),c=ne(()=>n()&&(!t()||t().trim()===""));const p=$=>{const R=$.target;e.onblur?.({value:R.value})},h=()=>{e.onfocus?.({field:d()})};var v=_f(),g=u(v);{var b=$=>{var R=wf();let z;var O=u(R);{var W=j=>{var x=gf(),F=u(x);D(()=>{de(x,"id",`${d()??""}-error`),S(F,o())}),_(j,x)},N=j=>{var x=Tt();D(()=>S(x,l())),_(j,x)};U(O,j=>{o()?j(W):j(N,!1)})}D(j=>{de(R,"for",d()),z=ct(R,1,"field-label svelte-bssb4o",null,z,j)},[()=>({"needs-attention":s(c)})]),_($,R)};U(g,$=>{l()&&$(b)})}var y=w(g,2);ar(y,t);var L;let k;y.__change=[vf,e],y.__keydown=[mf,e];var E=u(y);{var T=$=>{var R=yf();R.value=R.__value="";var z=u(R);D(()=>S(z,f())),_($,R)};U(E,$=>{f()&&!n()&&$(T)})}var P=w(E);Ct(P,17,a,Pt,($,R)=>{var z=bf(),O={},W=u(z);D(()=>{O!==(O=s(R).value)&&(z.value=(z.__value=s(R).value)??""),S(W,s(R).label)}),_($,z)}),D($=>{de(y,"id",d()),L!==(L=t())&&(y.value=(y.__value=t())??"",Fn(y,t())),y.required=n(),y.disabled=i(),k=ct(y,1,"field-select svelte-bssb4o",null,k,$),de(y,"aria-describedby",o()?`${d()}-error`:void 0),de(y,"aria-invalid",!!o()||s(c))},[()=>({error:!!o(),"needs-attention":s(c)})]),nt("blur",y,p),nt("focus",y,h),_(r,v),at()}_t(["change","keydown"]);const xf=(r,e)=>{e.onchange?.({value:r.target.value})},Sf=(r,e)=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&(r.preventDefault(),e.onblur?.({value:r.target.value}))};var Ef=I('<span class="required svelte-1c704qf">*</span>'),kf=I("<label> <!></label>"),Tf=I('<div class="field-error svelte-1c704qf" role="alert"> </div>'),Cf=I('<div class="metadata-field svelte-1c704qf"><!> <textarea></textarea> <!></div>');function If(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"value",3,""),o=V(e,"placeholder",3,""),l=V(e,"required",3,!1),d=V(e,"disabled",3,!1),f=V(e,"error",3,""),c=V(e,"label",3,""),p=V(e,"id",3,""),h=V(e,"rows",3,4),v=ne(()=>l()&&(!i()||i().trim()===""));const g=R=>{e.onblur?.({value:R.target.value})},b=()=>{e.onfocus?.({field:p()})};var y=Cf(),L=u(y);{var k=R=>{var z=kf();let O;var W=u(z),N=w(W);{var j=x=>{var F=Ef();D(q=>de(F,"aria-label",q),[()=>n()("Required field")]),_(x,F)};U(N,x=>{l()&&x(j)})}D(x=>{de(z,"for",p()),O=ct(z,1,"field-label svelte-1c704qf",null,O,x),S(W,`${c()??""} `)},[()=>({"needs-attention":s(v)})]),_(R,z)};U(L,R=>{c()&&R(k)})}var E=w(L,2);let T;E.__input=[xf,e],E.__keydown=[Sf,e];var P=w(E,2);{var $=R=>{var z=Tf(),O=u(z);D(()=>{de(z,"id",`${p()??""}-error`),S(O,f())}),_(R,z)};U(P,R=>{f()&&R($)})}D(R=>{de(E,"id",p()),Qt(E,i()),de(E,"placeholder",o()),E.required=l(),E.disabled=d(),de(E,"rows",h()),T=ct(E,1,"field-textarea svelte-1c704qf",null,T,R),de(E,"aria-describedby",f()?`${p()}-error`:void 0),de(E,"aria-invalid",!!f()||s(v))},[()=>({error:!!f(),"needs-attention":s(v)})]),nt("blur",E,g),nt("focus",E,b),_(r,y),at(),a()}_t(["input","keydown"]);const Ff=(r,e)=>{e.ongenerateIdentifier?.(new CustomEvent("generateIdentifier"))};var Mf=I('<div class="array-item svelte-1nofkco"><!> <button type="button" class="remove-button svelte-1nofkco">Ã</button></div>'),Pf=(r,e)=>e("creator"),Lf=I('<div class="basic-info-fields svelte-1nofkco" tabindex="-1"><div class="form-columns svelte-1nofkco" tabindex="-1"><div class="column svelte-1nofkco" tabindex="-1"><fieldset class="field-group svelte-1nofkco" tabindex="-1"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <div class="identifier-field svelte-1nofkco"><!> <button type="button" class="generate-button svelte-1nofkco"> </button></div></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <div class="array-field svelte-1nofkco"><!> <button type="button" class="add-button svelte-1nofkco"> </button></div></fieldset></div> <div class="column svelte-1nofkco"><fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!></fieldset> <fieldset class="field-group svelte-1nofkco"><legend class="group-title svelte-1nofkco" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div></div></div>');function Rf(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"metadata",19,()=>({title:"",language:"",identifier:""})),o=V(e,"validationErrors",19,()=>[]),l=V(e,"saving",3,!1);const d=[{value:"en",label:"English"},{value:"de",label:"Deutsch"},{value:"es",label:"EspaÃ±ol"},{value:"fr",label:"FranÃ§ais"},{value:"it",label:"Italiano"},{value:"pt",label:"PortuguÃªs"},{value:"ja",label:"æ¥æ¬èª"},{value:"zh",label:"ä¸­æ"},{value:"ar",label:"Ø§ÙØ¹Ø±Ø¨ÙØ©"},{value:"he",label:"×¢××¨××ª"},{value:"ka",label:"á¥áá áá£áá"}],f=[{value:"reflowable",label:n()("Reflowable")},{value:"pre-paginated",label:n()("Pre-paginated")}],c=[{value:"default",label:n()("Default")},{value:"ltr",label:n()("Left to Right")},{value:"rtl",label:n()("Right to Left")}],p=[{value:"auto",label:n()("Auto")},{value:"landscape",label:n()("Landscape")},{value:"portrait",label:n()("Portrait")}],h=[{value:"auto",label:n()("Auto")},{value:"none",label:n()("None")},{value:"both",label:n()("Both")}],v=Y=>{const ge=o().find(ee=>ee.field===Y);return ge?ge.message:""},g=(Y,ge)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:Y,value:ge}}))},b=(Y,ge)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:Y,value:ge}}))},y=Y=>{e.onfieldFocus?.(new CustomEvent("fieldFocus",{detail:{field:Y}}))},L=Y=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:Y}}))},k=(Y,ge)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:Y,index:ge}}))},E=(Y,ge,ee)=>{},T=(Y,ge)=>{const ee=[...i().creator||[]];ee[Y]=ge,e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:"creator",value:ee}}))};var P=Lf(),$=u(P),R=u($),z=u(R),O=u(z),W=u(O),N=w(O,2);const j=ne(()=>n()("Title")),x=ne(()=>i().title||""),F=ne(()=>n()("Enter book title")),q=ne(()=>v("title"));on(N,{id:"title",get label(){return s(j)},get value(){return s(x)},get placeholder(){return s(F)},required:!0,get error(){return s(q)},onchange:Y=>g("title",Y.value),onblur:Y=>b("title",Y.value),onfocus:()=>y("title")});var te=w(N,2);const M=ne(()=>n()("Language")),Q=ne(()=>i().language||""),ce=ne(()=>n()("Select language")),be=ne(()=>v("language"));Xn(te,{id:"language",get label(){return s(M)},get value(){return s(Q)},get options(){return d},get placeholder(){return s(ce)},required:!0,get error(){return s(be)},onchange:Y=>g("language",Y.value),onblur:Y=>b("language",Y.value),onfocus:()=>y("language")});var _e=w(te,2),Ue=u(_e);const Ce=ne(()=>n()("Identifier")),pe=ne(()=>i().identifier||""),K=ne(()=>n()("Enter a unique identifier")),oe=ne(()=>v("identifier"));on(Ue,{id:"identifier",get label(){return s(Ce)},get value(){return s(pe)},get placeholder(){return s(K)},required:!0,get error(){return s(oe)},onchange:Y=>g("identifier",Y.value),onblur:Y=>b("identifier",Y.value),onfocus:()=>y("identifier")});var ie=w(Ue,2);ie.__click=[Ff,e];var xe=u(ie),Me=w(z,2),Ae=u(Me),He=u(Ae),$e=w(Ae,2),Ye=u($e);Ct(Ye,17,()=>i().creator||[],Pt,(Y,ge,ee)=>{var A=Mf(),J=u(A);const C=ne(()=>n()("Author name")),G=ne(()=>v(`creator[${ee}]`));on(J,{id:`creator-${ee}`,get value(){return s(ge)},get placeholder(){return s(C)},get error(){return s(G)},onchange:we=>E("creator",ee,we.value),onblur:we=>T(ee,we.value),onfocus:()=>y("creator")});var X=w(J,2);X.__click=()=>k("creator",ee),D(we=>{X.disabled=l(),de(X,"aria-label",we)},[()=>n()("Remove author")]),_(Y,A)});var Ne=w(Ye,2);Ne.__click=[Pf,L];var Ge=u(Ne),Ke=w(R,2),he=u(Ke),ke=u(he),Te=u(ke),Oe=w(ke,2);const se=ne(()=>i().description||""),Ee=ne(()=>n()("Enter book description")),ve=ne(()=>v("description"));If(Oe,{id:"description",label:void 0,get value(){return s(se)},get placeholder(){return s(Ee)},get error(){return s(ve)},rows:3,onchange:Y=>g("description",Y.value),onblur:Y=>b("description",Y.value),onfocus:()=>y("description")});var We=w(he,2),Ve=u(We),B=u(Ve),H=w(Ve,2);const Z=ne(()=>n()("Layout")),ue=ne(()=>i().renditionLayout||"reflowable"),ye=ne(()=>v("renditionLayout"));Xn(H,{id:"renditionLayout",get label(){return s(Z)},get value(){return s(ue)},get options(){return f},get error(){return s(ye)},onchange:Y=>g("renditionLayout",Y.value),onblur:Y=>b("renditionLayout",Y.value),onfocus:()=>y("renditionLayout")});var Se=w(H,2);const Fe=ne(()=>n()("Page Progression")),Ie=ne(()=>i().pageProgressionDirection||"default"),Xe=ne(()=>v("pageProgressionDirection"));Xn(Se,{id:"pageProgressionDirection",get label(){return s(Fe)},get value(){return s(Ie)},get options(){return c},get error(){return s(Xe)},onchange:Y=>g("pageProgressionDirection",Y.value),onblur:Y=>b("pageProgressionDirection",Y.value),onfocus:()=>y("pageProgressionDirection")});var Be=w(Se,2);const le=ne(()=>n()("Orientation")),ae=ne(()=>i().renditionOrientation||"auto"),me=ne(()=>v("renditionOrientation"));Xn(Be,{id:"renditionOrientation",get label(){return s(le)},get value(){return s(ae)},get options(){return p},get error(){return s(me)},onchange:Y=>g("renditionOrientation",Y.value),onblur:Y=>b("renditionOrientation",Y.value),onfocus:()=>y("renditionOrientation")});var Pe=w(Be,2);const qe=ne(()=>n()("Spread")),Le=ne(()=>i().renditionSpread||"auto"),re=ne(()=>v("renditionSpread"));Xn(Pe,{id:"renditionSpread",get label(){return s(qe)},get value(){return s(Le)},get options(){return h},get error(){return s(re)},onchange:Y=>g("renditionSpread",Y.value),onblur:Y=>b("renditionSpread",Y.value),onfocus:()=>y("renditionSpread")}),D((Y,ge,ee,A,J,C)=>{S(W,Y),ie.disabled=l(),S(xe,ge),S(He,ee),Ne.disabled=l(),S(Ge,A),S(Te,J),S(B,C)},[()=>n()("Essential Information"),()=>n()("Generate"),()=>n()("Authors"),()=>n()("Add Another Author"),()=>n()("Description"),()=>n()("Rendition Properties")]),_(r,P),at(),a()}_t(["click"]);const Df=(r,e)=>{e.onchange?.({value:r.target.value})},Af=(r,e)=>{const t=new Date().toISOString().split("T")[0];e.onchange?.({value:t}),e.onblur?.({value:t})};var Of=I('<span class="required svelte-14vfa0w">*</span>'),Uf=I("<label> <!></label>"),zf=I('<button type="button" class="today-button svelte-14vfa0w"> </button>'),Wf=I('<div class="field-error svelte-14vfa0w" role="alert"> </div>'),Nf=I('<div class="metadata-field svelte-14vfa0w"><!> <div class="date-input-wrapper svelte-14vfa0w"><input type="date"/> <!></div> <!></div>');function jf(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"value",3,""),o=V(e,"required",3,!1),l=V(e,"disabled",3,!1),d=V(e,"error",3,""),f=V(e,"label",3,""),c=V(e,"id",3,""),p=ne(()=>o()&&(!i()||i().trim()===""));const h=z=>{e.onblur?.({value:z.target.value})},v=()=>{e.onfocus?.({field:c()})};var g=Nf(),b=u(g);{var y=z=>{var O=Uf();let W;var N=u(O),j=w(N);{var x=F=>{var q=Of();D(te=>de(q,"aria-label",te),[()=>n()("Required field")]),_(F,q)};U(j,F=>{o()&&F(x)})}D(F=>{de(O,"for",c()),W=ct(O,1,"field-label svelte-14vfa0w",null,W,F),S(N,`${f()??""} `)},[()=>({"needs-attention":s(p)})]),_(z,O)};U(b,z=>{f()&&z(y)})}var L=w(b,2),k=u(L);let E;k.__input=[Df,e];var T=w(k,2);{var P=z=>{var O=zf();O.__click=[Af,e];var W=u(O);D((N,j)=>{de(O,"aria-label",N),S(W,j)},[()=>n()("Set to today"),()=>n()("Today")]),_(z,O)};U(T,z=>{l()||z(P)})}var $=w(L,2);{var R=z=>{var O=Wf(),W=u(O);D(()=>{de(O,"id",`${c()??""}-error`),S(W,d())}),_(z,O)};U($,z=>{d()&&z(R)})}D(z=>{de(k,"id",c()),Qt(k,i()),k.required=o(),k.disabled=l(),E=ct(k,1,"field-input svelte-14vfa0w",null,E,z),de(k,"aria-describedby",d()?`${c()}-error`:void 0),de(k,"aria-invalid",!!d())},[()=>({error:!!d(),"needs-attention":s(p)})]),nt("blur",k,h),nt("focus",k,v),_(r,g),at(),a()}_t(["input","click"]);var Bf=I('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">Ã</button></div>'),Hf=(r,e)=>e("subject"),Vf=I('<div class="array-item svelte-fuok1"><!> <button type="button" class="remove-button svelte-fuok1">Ã</button></div>'),qf=(r,e)=>e("contributor"),$f=I('<div class="advanced-fields svelte-fuok1"><div class="form-columns svelte-fuok1"><div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <!> <!> <!> <!></fieldset></div> <div class="column svelte-fuok1"><fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset> <fieldset class="field-group svelte-fuok1"><legend class="group-title svelte-fuok1" tabindex="-1"> </legend> <div class="array-field svelte-fuok1"><!> <button type="button" class="add-button svelte-fuok1"> </button></div></fieldset></div></div></div>');function Gf(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"metadata",19,()=>({title:"",language:"",identifier:""})),o=V(e,"validationErrors",19,()=>[]),l=V(e,"saving",3,!1);const d=[{value:"fiction",label:n()("Fiction")},{value:"non-fiction",label:n()("Non-fiction")},{value:"poetry",label:n()("Poetry")},{value:"drama",label:n()("Drama")},{value:"biography",label:n()("Biography")},{value:"textbook",label:n()("Textbook")},{value:"reference",label:n()("Reference")},{value:"children",label:n()("Children")}],f=ee=>{const A=o().find(J=>J.field===ee);return A?A.message:""},c=(ee,A)=>{e.onfieldChange?.(new CustomEvent("fieldChange",{detail:{field:ee,value:A}}))},p=(ee,A)=>{e.onfieldSave?.(new CustomEvent("fieldSave",{detail:{field:ee,value:A}}))},h=ee=>{e.onfieldFocus?.(new CustomEvent("fieldFocus",{detail:{field:ee}}))},v=ee=>{e.onarrayAdd?.(new CustomEvent("arrayAdd",{detail:{field:ee}}))},g=(ee,A)=>{e.onarrayRemove?.(new CustomEvent("arrayRemove",{detail:{field:ee,index:A}}))},b=(ee,A,J)=>{},y=(ee,A)=>{const J=[...i().subject||[]];J[ee]=A,p("subject",J)},L=(ee,A)=>{const J=[...i().contributor||[]];J[ee]=A,p("contributor",J)};var k=$f(),E=u(k),T=u(E),P=u(T),$=u(P),R=u($),z=w($,2);const O=ne(()=>n()("Publisher")),W=ne(()=>i().publisher||""),N=ne(()=>n()("Enter publisher name")),j=ne(()=>f("publisher"));on(z,{id:"publisher",get label(){return s(O)},get value(){return s(W)},get placeholder(){return s(N)},get error(){return s(j)},onchange:ee=>c("publisher",ee.value),onblur:ee=>p("publisher",ee.value),onfocus:()=>h("publisher")});var x=w(z,2);const F=ne(()=>n()("Publication Date")),q=ne(()=>i().date||""),te=ne(()=>f("date"));jf(x,{id:"date",get label(){return s(F)},get value(){return s(q)},get error(){return s(te)},onchange:ee=>c("date",ee.value),onblur:ee=>p("date",ee.value),onfocus:()=>h("date")});var M=w(x,2);const Q=ne(()=>n()("Rights")),ce=ne(()=>i().rights||""),be=ne(()=>n()("Enter copyright information")),_e=ne(()=>f("rights"));on(M,{id:"rights",get label(){return s(Q)},get value(){return s(ce)},get placeholder(){return s(be)},get error(){return s(_e)},onchange:ee=>c("rights",ee.value),onblur:ee=>p("rights",ee.value),onfocus:()=>h("rights")});var Ue=w(M,2);const Ce=ne(()=>n()("Content Type")),pe=ne(()=>i().type||""),K=ne(()=>n()("Select content type")),oe=ne(()=>f("type"));Xn(Ue,{id:"type",get label(){return s(Ce)},get value(){return s(pe)},get options(){return d},get placeholder(){return s(K)},get error(){return s(oe)},onchange:ee=>c("type",ee.value),onblur:ee=>p("type",ee.value),onfocus:()=>h("type")});var ie=w(P,2),xe=u(ie),Me=u(xe),Ae=w(xe,2);const He=ne(()=>n()("Source")),$e=ne(()=>i().source||""),Ye=ne(()=>n()("Enter source information")),Ne=ne(()=>f("source"));on(Ae,{id:"source",get label(){return s(He)},get value(){return s($e)},get placeholder(){return s(Ye)},get error(){return s(Ne)},onchange:ee=>c("source",ee.value),onblur:ee=>p("source",ee.value),onfocus:()=>h("source")});var Ge=w(Ae,2);const Ke=ne(()=>n()("Relation")),he=ne(()=>i().relation||""),ke=ne(()=>n()("Enter related work information")),Te=ne(()=>f("relation"));on(Ge,{id:"relation",get label(){return s(Ke)},get value(){return s(he)},get placeholder(){return s(ke)},get error(){return s(Te)},onchange:ee=>c("relation",ee.value),onblur:ee=>p("relation",ee.value),onfocus:()=>h("relation")});var Oe=w(Ge,2);const se=ne(()=>n()("Coverage")),Ee=ne(()=>i().coverage||""),ve=ne(()=>n()("Enter spatial or temporal coverage")),We=ne(()=>f("coverage"));on(Oe,{id:"coverage",get label(){return s(se)},get value(){return s(Ee)},get placeholder(){return s(ve)},get error(){return s(We)},onchange:ee=>c("coverage",ee.value),onblur:ee=>p("coverage",ee.value),onfocus:()=>h("coverage")});var Ve=w(Oe,2);const B=ne(()=>n()("Format")),H=ne(()=>i().format||""),Z=ne(()=>n()("Enter format information")),ue=ne(()=>f("format"));on(Ve,{id:"format",get label(){return s(B)},get value(){return s(H)},get placeholder(){return s(Z)},get error(){return s(ue)},onchange:ee=>c("format",ee.value),onblur:ee=>p("format",ee.value),onfocus:()=>h("format")});var ye=w(T,2),Se=u(ye),Fe=u(Se),Ie=u(Fe),Xe=w(Fe,2),Be=u(Xe);Ct(Be,17,()=>i().subject||[],Pt,(ee,A,J)=>{var C=Bf(),G=u(C);const X=ne(()=>n()("Subject or keyword")),we=ne(()=>f(`subject[${J}]`));on(G,{id:`subject-${J}`,get value(){return s(A)},get placeholder(){return s(X)},get error(){return s(we)},onchange:ze=>b("subject",J,ze.value),onblur:ze=>y(J,ze.value),onfocus:()=>h("subject")});var Re=w(G,2);Re.__click=()=>g("subject",J),D(ze=>{Re.disabled=l(),de(Re,"aria-label",ze)},[()=>n()("Remove subject")]),_(ee,C)});var le=w(Be,2);le.__click=[Hf,v];var ae=u(le),me=w(Se,2),Pe=u(me),qe=u(Pe),Le=w(Pe,2),re=u(Le);Ct(re,17,()=>i().contributor||[],Pt,(ee,A,J)=>{var C=Vf(),G=u(C);const X=ne(()=>n()("Contributor name")),we=ne(()=>f(`contributor[${J}]`));on(G,{id:`contributor-${J}`,get value(){return s(A)},get placeholder(){return s(X)},get error(){return s(we)},onchange:ze=>b("contributor",J,ze.value),onblur:ze=>L(J,ze.value),onfocus:()=>h("contributor")});var Re=w(G,2);Re.__click=()=>g("contributor",J),D(ze=>{Re.disabled=l(),de(Re,"aria-label",ze)},[()=>n()("Remove contributor")]),_(ee,C)});var Y=w(re,2);Y.__click=[qf,v];var ge=u(Y);D((ee,A,J,C,G,X)=>{S(R,ee),S(Me,A),S(Ie,J),le.disabled=l(),S(ae,C),S(qe,G),Y.disabled=l(),S(ge,X)},[()=>n()("Publication"),()=>n()("Additional Information"),()=>n()("Subjects"),()=>n()("Add Another Subject"),()=>n()("Contributors"),()=>n()("Add Another Contributor")]),_(r,k),at(),a()}_t(["click"]);class mn extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="MetadataServiceError"}}class Qi extends mn{constructor(e,t,a){super(e,"VALIDATION_FAILED",a),this.validationResults=t,this.name="MetadataValidationError"}}class Xf{constructor(e){this.workspaceService=e}loadMetadata(e){return e.opf.metadata}async updateField(e,t,a){try{const n={[t]:a},i=this.validateMetadataUpdates(n);if(i.some(o=>o.type==="error"))throw new Qi("Field validation failed",i,e.id);return await this.workspaceService.updateMetadata(e,n)}catch(n){throw n instanceof mn?n:new mn(`Failed to update field ${String(t)}: ${n instanceof Error?n.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async updateMetadata(e,t){try{const a=this.validateMetadataUpdates(t);if(a.filter(i=>i.type==="error").length>0)throw new Qi("Metadata validation failed",a,e.id);return await this.workspaceService.updateMetadata(e,t)}catch(a){throw a instanceof mn?a:new mn(`Failed to update metadata: ${a instanceof Error?a.message:"Unknown error"}`,"UPDATE_ERROR",e.id)}}async addArrayItem(e,t,a=""){try{const n=e.opf.metadata[t]||[],i={[t]:[...n,a||this.getDefaultArrayValue(t)]};return await this.workspaceService.updateMetadata(e,i)}catch(n){throw new mn(`Failed to add ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_ADD_ERROR",e.id)}}async removeArrayItem(e,t,a){try{const n=e.opf.metadata[t]||[];if(a<0||a>=n.length)throw new mn(`Invalid index ${a} for ${t} array`,"INVALID_INDEX",e.id);const i=[...n];i.splice(a,1);const o={[t]:i};return await this.workspaceService.updateMetadata(e,o)}catch(n){throw n instanceof mn?n:new mn(`Failed to remove ${t} item: ${n instanceof Error?n.message:"Unknown error"}`,"ARRAY_REMOVE_ERROR",e.id)}}validateMetadata(e){const t=[];return e.title?.trim()||t.push({field:"title",message:"Title is required",type:"error"}),e.language?.trim()||t.push({field:"language",message:"Language is required",type:"error"}),e.identifier?.trim()||t.push({field:"identifier",message:"Identifier is required",type:"error"}),e.language&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)&&t.push({field:"language",message:'Invalid language code format (use ISO 639-1, e.g., "en" or "en-US")',type:"warning"}),e.title&&e.title.length>200&&t.push({field:"title",message:"Title should be under 200 characters",type:"warning"}),e.creator&&e.creator.some(a=>!a.trim())&&t.push({field:"creator",message:"Creator entries cannot be empty",type:"warning"}),t}validateMetadataUpdates(e){const t=[];return e.title!==void 0&&!e.title.trim()&&t.push({field:"title",message:"Title cannot be empty",type:"error"}),e.language!==void 0&&(e.language.trim()?/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language)||t.push({field:"language",message:"Invalid language code format",type:"warning"}):t.push({field:"language",message:"Language cannot be empty",type:"error"})),e.identifier!==void 0&&!e.identifier.trim()&&t.push({field:"identifier",message:"Identifier cannot be empty",type:"error"}),t}getDefaultArrayValue(e){switch(e){case"creator":return"Unknown Author";case"contributor":return"Unknown Contributor";case"subject":return"New Subject";default:return""}}}var Kf=I('<div class="loading-state svelte-17s3g49"><p> </p></div>'),Yf=(r,e)=>m(e,null),Jf=I('<div class="error-state svelte-17s3g49"><p class="error-message svelte-17s3g49"> </p> <button type="button" class="retry-button svelte-17s3g49"> </button></div>'),Zf=I('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),Qf=I('<div class="placeholder-panel svelte-17s3g49"><p class="svelte-17s3g49"> </p> <p class="placeholder-description svelte-17s3g49"> </p></div>'),ep=I('<div class="tab-panel svelte-17s3g49" tabindex="-1"><!></div>'),tp=I('<div class="metadata-editor svelte-17s3g49"><div class="pane-header svelte-17s3g49" tabindex="-1"><!></div> <div class="pane-content svelte-17s3g49" tabindex="-1"><!></div></div>');function np(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=cn();let o=V(e,"workspace",15,null),l=ne(()=>o()?.opf.metadata??{title:"",language:"",identifier:""}),d=ne(()=>e.metadataService.validateMetadata(s(l))),f=ne(()=>!o()),c=fe("basic"),p=fe(!1),h=fe(null),v=ne(()=>[{id:"basic",label:n()("Basic Info")},{id:"advanced",label:n()("Advanced")},{id:"publication",label:n()("Publication Details")},{id:"accessibility",label:n()("Accessibility")}]);const g=j=>{},b=j=>{i("fieldFocus",j.detail)},y=async j=>{const{field:x,value:F}=j.detail;if(!o())return;const q={[x]:F};if(!(e.metadataService.validateMetadataUpdates(q).filter(Q=>Q.type==="error").length>0))try{o(await e.metadataService.updateField(o(),x,F)),i("metadataChanged",{field:x,value:F}),m(h,null)}catch(Q){console.error(`Failed to save field ${x}:`,Q),m(h,n()("Failed to save metadata field"),!0)}},L=async j=>{const{field:x}=j.detail;if(o())try{m(p,!0),(x==="creator"||x==="subject"||x==="contributor")&&(o(await e.metadataService.addArrayItem(o(),x)),i("metadataChanged",{field:x,value:o().opf.metadata[x]})),m(h,null)}catch(F){console.error(`Failed to add ${x}:`,F),m(h,n()("Failed to add metadata item"),!0)}finally{m(p,!1)}},k=async j=>{const{field:x,index:F}=j.detail;if(o())try{m(p,!0),(x==="creator"||x==="subject"||x==="contributor")&&(o(await e.metadataService.removeArrayItem(o(),x,F)),i("metadataChanged",{field:x,value:o().opf.metadata[x]})),m(h,null)}catch(q){console.error(`Failed to remove ${x}:`,q),m(h,n()("Failed to remove metadata item"),!0)}finally{m(p,!1)}},E=async()=>{const j=`urn:uuid:${crypto.randomUUID()}`;await y({detail:{field:"identifier",value:j}})},T=async j=>{const x=j.detail.tabId;m(c,x,!0)};var P=tp(),$=u(P),R=u($);cf(R,{get activeTab(){return s(c)},get validationErrors(){return s(d)},get tabs(){return s(v)},$$events:{tabClick:T}});var z=w($,2),O=u(z);{var W=j=>{var x=Kf(),F=u(x),q=u(F);D(te=>S(q,te),[()=>n()("Loading metadataâ¦")]),_(j,x)},N=(j,x)=>{{var F=te=>{var M=Jf(),Q=u(M),ce=u(Q),be=w(Q,2);be.__click=[Yf,h];var _e=u(be);D(Ue=>{S(ce,s(h)),S(_e,Ue)},[()=>n()("Retry")]),_(te,M)},q=te=>{var M=ep(),Q=u(M);{var ce=_e=>{Rf(_e,{get metadata(){return s(l)},get validationErrors(){return s(d)},get saving(){return s(p)},onfieldChange:g,onfieldSave:y,onfieldFocus:b,onarrayAdd:L,onarrayRemove:k,ongenerateIdentifier:E})},be=(_e,Ue)=>{{var Ce=K=>{Gf(K,{get metadata(){return s(l)},get validationErrors(){return s(d)},get saving(){return s(p)},onfieldChange:g,onfieldSave:y,onfieldFocus:b,onarrayAdd:L,onarrayRemove:k})},pe=(K,oe)=>{{var ie=Me=>{var Ae=Zf(),He=u(Ae),$e=u(He),Ye=w(He,2),Ne=u(Ye);D((Ge,Ke,he)=>{S($e,Ge),S(Ne,`${Ke??""} - ${he??""}`)},[()=>n()("Coming Soon"),()=>n()("Publication Details"),()=>n()("Series information, EPUB version, and publication-specific metadata")]),_(Me,Ae)},xe=(Me,Ae)=>{{var He=$e=>{var Ye=Qf(),Ne=u(Ye),Ge=u(Ne),Ke=w(Ne,2),he=u(Ke);D((ke,Te,Oe)=>{S(Ge,ke),S(he,`${Te??""} - ${Oe??""}`)},[()=>n()("Coming Soon"),()=>n()("Accessibility"),()=>n()("Accessibility features, hazards, and certification information")]),_($e,Ye)};U(Me,$e=>{s(c)==="accessibility"&&$e(He)},Ae)}};U(K,Me=>{s(c)==="publication"?Me(ie):Me(xe,!1)},oe)}};U(_e,K=>{s(c)==="advanced"?K(Ce):K(pe,!1)},Ue)}};U(Q,_e=>{s(c)==="basic"?_e(ce):_e(be,!1)})}D(()=>{de(M,"id",`metadata-panel-${s(c)??""}`),de(M,"aria-labelledby",`metadata-tab-${s(c)??""}`)}),_(te,M)};U(j,te=>{s(h)?te(F):te(q,!1)},x)}};U(O,j=>{s(f)?j(W):j(N,!1)})}_(r,P),at(),a()}_t(["click"]);var rp=I('<div class="coming-soon-badge svelte-skhkuy"><span class="badge-text">Phase 3</span></div>'),ap=I('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),ip=I('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),sp=I('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),op=I('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),lp=I('<li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li> <li class="svelte-skhkuy"> </li>',1),cp=(r,e)=>e("demo_action_1"),dp=(r,e)=>e("demo_action_2"),up=()=>Mt.navigateTo("workspace"),fp=I('<div class="last-action svelte-skhkuy"><span class="action-icon svelte-skhkuy">â¨</span> <span> </span></div>'),pp=I('<div class="placeholder-view svelte-skhkuy"><header class="view-header svelte-skhkuy"><div class="header-content svelte-skhkuy"><span class="view-icon svelte-skhkuy"> </span> <div class="header-text svelte-skhkuy"><h2 class="svelte-skhkuy"> </h2> <p class="svelte-skhkuy"> </p></div></div> <!></header> <main class="view-content svelte-skhkuy"><div class="placeholder-content svelte-skhkuy"><div class="placeholder-icon svelte-skhkuy"><span class="large-icon svelte-skhkuy"> </span></div> <h3 class="svelte-skhkuy"> </h3> <p class="placeholder-description svelte-skhkuy"> </p> <div class="feature-preview svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <ul class="feature-list svelte-skhkuy"><!></ul></div> <div class="demo-actions svelte-skhkuy"><h4 class="svelte-skhkuy"> </h4> <div class="action-buttons svelte-skhkuy"><button class="btn btn-primary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button> <button class="btn btn-secondary svelte-skhkuy"> </button></div></div> <!></div></main></div>');function Xr(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"viewType",8,"Unknown"),o=V(e,"title",8,"View"),l=V(e,"description",8,"This view will be implemented in Phase 3."),d=V(e,"icon",8,"ð"),f=V(e,"comingSoon",8,!0),c,p=st({});function h(ve){ve&&m(p,{...s(p),...ve});const We=Mt.getViewData(i());We&&m(p,We)}function v(){Mt.setViewData(i(),s(p))}function g(){return s(p)}function b(ve){m(p,{...s(p),...ve})}async function y(){return!0}rn(()=>{c=Mt.addNavigationGuard(y),h()}),ur(()=>{c&&Mt.removeNavigationGuard(c),v()});function L(ve){console.log(`${i()} action:`,ve),St(p,s(p).lastAction=ve),St(p,s(p).actionTime=new Date().toISOString()),Mt.setViewData(i(),s(p))}Bt();var k=pp(),E=u(k),T=u(E),P=u(T),$=u(P),R=w(P,2),z=u(R),O=u(z),W=w(z,2),N=u(W),j=w(T,2);{var x=ve=>{var We=rp();_(ve,We)};U(j,ve=>{f()&&ve(x)})}var F=w(E,2),q=u(F),te=u(q),M=u(te),Q=u(M),ce=w(te,2),be=u(ce),_e=w(ce,2),Ue=u(_e),Ce=w(_e,2),pe=u(Ce),K=u(pe),oe=w(pe,2),ie=u(oe);{var xe=ve=>{var We=ap(),Ve=et(We),B=u(Ve),H=w(Ve,2),Z=u(H),ue=w(H,2),ye=u(ue),Se=w(ue,2),Fe=u(Se);D((Ie,Xe,Be,le)=>{S(B,`ð ${Ie??""}`),S(Z,`ð ${Xe??""}`),S(ye,`ð ${Be??""}`),S(Fe,`ðï¸ ${le??""}`)},[()=>n()("File listing and management"),()=>n()("Search and filter files"),()=>n()("Add/remove manifest items"),()=>n()("Preview file contents")],De),_(ve,We)},Me=(ve,We)=>{{var Ve=H=>{var Z=ip(),ue=et(Z),ye=u(ue),Se=w(ue,2),Fe=u(Se),Ie=w(Se,2),Xe=u(Ie),Be=w(Ie,2),le=u(Be);D((ae,me,Pe,qe)=>{S(ye,`ð ${ae??""}`),S(Fe,`ð ${me??""}`),S(Xe,`ð ${Pe??""}`),S(le,`ð¯ ${qe??""}`)},[()=>n()("Table of contents editing"),()=>n()("Navigation link management"),()=>n()("TOC structure editing"),()=>n()("Auto-generation from spine")],De),_(H,Z)},B=(H,Z)=>{{var ue=Se=>{var Fe=sp(),Ie=et(Fe),Xe=u(Ie),Be=w(Ie,2),le=u(Be),ae=w(Be,2),me=u(ae),Pe=w(ae,2),qe=u(Pe);D((Le,re,Y,ge)=>{S(Xe,`ð ${Le??""}`),S(le,`ð ${re??""}`),S(me,`ð ${Y??""}`),S(qe,`ð ${ge??""}`)},[()=>n()("Chapter ordering interface"),()=>n()("Drag-and-drop reordering"),()=>n()("Spine item management"),()=>n()("Link to source files")],De),_(Se,Fe)},ye=(Se,Fe)=>{{var Ie=Be=>{var le=op(),ae=et(le),me=u(ae),Pe=w(ae,2),qe=u(Pe),Le=w(Pe,2),re=u(Le),Y=w(Le,2),ge=u(Y);D((ee,A,J,C)=>{S(me,`âï¸ ${ee??""}`),S(qe,`ð¨ ${A??""}`),S(re,`ð¾ ${J??""}`),S(ge,`ð§ ${C??""}`)},[()=>n()("Application preferences"),()=>n()("Theme and UI settings"),()=>n()("Export/import settings"),()=>n()("Advanced configurations")],De),_(Be,le)},Xe=Be=>{var le=lp(),ae=et(le),me=u(ae),Pe=w(ae,2),qe=u(Pe),Le=w(Pe,2),re=u(Le),Y=w(Le,2),ge=u(Y);D((ee,A,J,C)=>{S(me,`ð ${ee??""}`),S(qe,`ð ${A??""}`),S(re,`ð ${J??""}`),S(ge,`ð¡ ${C??""}`)},[()=>n()("Enhanced functionality"),()=>n()("Improved user interface"),()=>n()("Seamless integration"),()=>n()("New capabilities")],De),_(Be,le)};U(Se,Be=>{i()==="settings"?Be(Ie):Be(Xe,!1)},Fe)}};U(H,Se=>{i()==="spine"?Se(ue):Se(ye,!1)},Z)}};U(ve,H=>{i()==="navigation"?H(Ve):H(B,!1)},We)}};U(ie,ve=>{i()==="manifest"?ve(xe):ve(Me,!1)})}var Ae=w(Ce,2),He=u(Ae),$e=u(He),Ye=w(He,2),Ne=u(Ye);Ne.__click=[cp,L];var Ge=u(Ne),Ke=w(Ne,2);Ke.__click=[dp,L];var he=u(Ke),ke=w(Ke,2);ke.__click=[up];var Te=u(ke),Oe=w(Ae,2);{var se=ve=>{var We=fp(),Ve=w(u(We),2),B=u(Ve);D((H,Z,ue)=>S(B,`${H??""}: ${s(p).lastAction??""}
            ${Z??""}
            ${ue??""}`),[()=>n()("Last action"),()=>n()("at"),()=>new Date(s(p).actionTime).toLocaleTimeString()],De),_(ve,We)};U(Oe,ve=>{s(p).lastAction&&ve(se)})}D((ve,We,Ve,B,H,Z,ue)=>{S($,d()),S(O,o()),S(N,l()),S(Q,d()),S(be,ve),S(Ue,We),S(K,`${Ve??""}:`),S($e,`${B??""}:`),S(Ge,H),S(he,Z),S(Te,ue)},[()=>n()("Coming Soon"),()=>n()("The {title} interface will be implemented in Phase 3 of the EDITME development. This will include full content management capabilities.",{title:o().toLowerCase()}),()=>n()("Planned Features"),()=>n()("Navigation Demo"),()=>n()("Demo Action 1"),()=>n()("Demo Action 2"),()=>n()("Back to Projects")],De),_(r,k),$n(e,"onViewEnter",h),$n(e,"onViewLeave",v),$n(e,"getViewData",g),$n(e,"setViewData",b),$n(e,"canLeave",y);var Ee=at({onViewEnter:h,onViewLeave:v,getViewData:g,setViewData:b,canLeave:y});return a(),Ee}_t(["click"]);function hp(r,e){const t=r.target;m(e,t.value,!0)}function vp(r,e,t,a,n){const i=r.target;if(m(e,parseFloat(i.value),!0),s(t)>0){const o=s(e)/100*s(t);m(a,n.audioClipService.formatTimeString(o),!0)}}function mp(r,e,t,a,n,i){if(s(e)>0){const o=s(t),l=s(a),d=s(e)-o;l>d&&m(n,i.audioClipService.formatTimeString(d),!0)}}async function gp(r,e,t,a,n,i,o){if(s(e))try{s(t)&&s(a)==="clip"?(n.audioClipService.stop(s(e)),m(t,!1),m(a,null)):(s(i)&&(n.audioClipService.stop(s(e)),m(i,!1)),await n.audioClipService.playClip(s(e)),m(t,!0),m(a,"clip"))}catch(l){m(o,l instanceof Error?l.message:"Playback failed",!0)}}async function wp(r,e,t,a,n,i,o){if(s(e))try{s(t)&&s(a)==="last"?(n.audioClipService.stop(s(e)),m(t,!1),m(a,null)):(s(i)&&(n.audioClipService.stop(s(e)),m(i,!1)),await n.audioClipService.playLastSeconds(s(e),2),m(t,!0),m(a,"last"))}catch(l){m(o,l instanceof Error?l.message:"Playback failed",!0)}}function yp(r,e,t,a,n,i,o,l,d){if(!e()||!t())return;const f=t().slice(e().start,e().end),c=a.audioClipService.parseClipDirective(f);if(c){const p=s(n).find(h=>h.href===c.href);p&&m(i,p.href,!0),m(o,c.begin,!0),m(l,c.label||"",!0);try{const h=a.audioClipService.parseTimeString(c.end),v=a.audioClipService.parseTimeString(c.begin),g=h-v;m(d,a.audioClipService.formatTimeString(g),!0)}catch{}}}async function bp(r,e,t,a,n,i,o,l){if(s(e))try{const d=await t.audioClipService.getTemplate(t.workspace.id),f={href:s(e),startTime:s(a),duration:s(n),endTime:s(i),label:s(o).trim()||void 0},c=t.audioClipService.formatClipDirective(f,d);t.onInsertClip?.(c)}catch(d){m(l,d instanceof Error?d.message:"Failed to insert clip",!0)}}var _p=I('<div class="error-message svelte-1ullway"><span class="error-icon svelte-1ullway" aria-hidden="true">â ï¸</span> <span class="svelte-1ullway"> </span></div>'),xp=I('<option class="svelte-1ullway"> </option>'),Sp=(r,e)=>e("start",r),Ep=(r,e)=>e("start",r),kp=(r,e)=>e("duration",r),Tp=(r,e)=>e("duration",r),Cp=(r,e)=>e(-1),Ip=(r,e)=>e(-.1),Fp=(r,e)=>e(.1),Mp=(r,e)=>e(1),Pp=(r,e)=>m(e,r.target.value,!0),Lp=I('<div class="loading-indicator svelte-1ullway"><div class="spinner svelte-1ullway"></div> <span class="svelte-1ullway">Loading audio...</span></div>'),Rp=I('<div class="audio-clip-editor svelte-1ullway"><audio preload="metadata" class="svelte-1ullway"></audio> <!> <div class="control-row svelte-1ullway"><div class="control-group svelte-1ullway"><select id="audio-select" class="audio-select svelte-1ullway" aria-label="Select audio file"><option disabled class="svelte-1ullway">Select audio...</option><!></select></div> <div class="control-group range-group svelte-1ullway"><input id="range-slider" type="range" class="range-slider svelte-1ullway" min="0" max="100" step="0.1" aria-label="Approximate start position"/></div> <div class="control-pair svelte-1ullway"><div class="control-group time-input-group svelte-1ullway"><input id="start-time" type="text" class="time-input svelte-1ullway" placeholder="h:mm:ss.dd" aria-label="Start time"/></div> <div class="control-group svelte-1ullway"><button type="button"><!></button></div></div> <div class="control-pair svelte-1ullway"><div class="control-group time-input-group svelte-1ullway"><input id="duration" type="text" class="time-input svelte-1ullway" placeholder="h:mm:ss.dd" aria-label="Duration"/></div> <div class="control-group svelte-1ullway"><button type="button"><!></button></div></div> <div class="control-group jog-group svelte-1ullway"><div class="jog-controls svelte-1ullway"><button type="button" class="jog-btn svelte-1ullway" aria-label="Move start time back 1 second" title="-1s">-1</button> <button type="button" class="jog-btn svelte-1ullway" aria-label="Move start time back 0.1 seconds" title="-0.1s">-0.1</button> <button type="button" class="jog-btn svelte-1ullway" aria-label="Move start time forward 0.1 seconds" title="+0.1s">+0.1</button> <button type="button" class="jog-btn svelte-1ullway" aria-label="Move start time forward 1 second" title="+1s">+1</button></div></div> <button type="button" class="control-btn load-btn svelte-1ullway" aria-label="Load clip data from selected text" title="Load from Selection">â</button> <button type="button" class="control-btn insert-btn primary-btn svelte-1ullway" aria-label="Insert clip directive at cursor position" title="Insert Clip Directive">â</button> <div class="control-group svelte-1ullway"><input id="clip-label" type="text" class="label-input svelte-1ullway" placeholder="Optional label" aria-label="Clip label"/></div></div> <!></div>');function es(r,e){rt(e,!0);let t=V(e,"textContent",3,""),a=V(e,"textareaSelection",3,null),n=fe(It([])),i=fe(""),o=fe(""),l=fe(void 0),d=fe(0),f=fe(!1),c=fe(null),p=fe("0:00:00.00"),h=fe("0:00:10.00"),v=fe(0),g=fe(""),b=fe(!1),y=fe(!1),L=fe(null),k=ne(()=>(()=>{try{return e.audioClipService.parseTimeString(s(p))}catch{return 0}})()),E=ne(()=>(()=>{try{return e.audioClipService.parseTimeString(s(h))}catch{return 10}})()),T=ne(()=>s(k)+s(E)),P=ne(()=>(()=>{if(!a()||!t())return!1;const le=t().slice(a().start,a().end);return e.audioClipService.parseClipDirective(le)!==null})()),$=ne(()=>s(f)||!s(o)),R=ne(()=>s(b)&&s(L)==="clip"?"Stop":"Play"),z=ne(()=>s(y)&&s(L)==="last"?"Stop":"Play Last 2s");rn(async()=>{try{m(n,await e.audioClipService.getAvailableAudioFiles(e.workspace.id),!0),s(n).length>0&&!s(i)&&m(i,s(n)[0].href,!0)}catch(le){m(c,le instanceof Error?le.message:"Failed to load audio files",!0)}}),ht(()=>{s(i)&&e.workspace.id&&(async()=>{try{console.log("ðµ Component: Loading audio - href:",s(i),"workspace:",e.workspace.id),m(f,!0),m(c,null);const le=await e.audioClipService.loadAudioFile(e.workspace.id,s(i));console.log("ðµ Component: Audio src received:",le),console.log("ðµ Component: Setting audioSrc, will trigger audio element load"),m(o,le,!0)}catch(le){console.error("ðµ Component: Audio loading error:",le),m(c,le instanceof Error?le.message:"Failed to load audio file",!0),m(o,"")}finally{m(f,!1)}})()}),ht(()=>{if(s(l)&&s(o)){console.log("ðµ Component: Audio element and src available:",{audioSrc:s(o),audioElementSrc:s(l).src,readyState:s(l).readyState});const le=()=>{if(!s(l))return;console.log("ðµ Component: loadedmetadata event fired"),console.log("ðµ Component: Audio duration:",s(l).duration),console.log("ðµ Component: Audio ready state:",s(l).readyState);const Pe=e.audioClipService.getAudioMetadata(s(l));console.log("ðµ Component: Extracted metadata:",Pe),m(d,Pe.duration,!0),console.log("ðµ Component: Set audioDuration to:",s(d)),e.audioClipService.setClipRange(s(k),s(T))},ae=()=>{m(b,!1),m(y,!1),m(L,null)},me=()=>{s(l)&&s(L)==="clip"?s(l).currentTime>=s(T)&&(e.audioClipService.stop(s(l)),m(b,!1),m(L,null)):s(l)&&s(L)==="last"&&s(l).currentTime>=s(T)&&(e.audioClipService.stop(s(l)),m(y,!1),m(L,null))};return s(l).addEventListener("loadedmetadata",le),s(l).addEventListener("ended",ae),s(l).addEventListener("timeupdate",me),()=>{s(l)?.removeEventListener("loadedmetadata",le),s(l)?.removeEventListener("ended",ae),s(l)?.removeEventListener("timeupdate",me)}}}),ht(()=>{if(s(d)>0){const le=s(k)/s(d)*100;m(v,le)}}),ht(()=>{if(s(k)>=0&&s(T)>s(k))try{e.audioClipService.setClipRange(s(k),s(T))}catch{}});function O(le){const ae=le.trim();if(!ae)return"0:00:00.00";try{return e.audioClipService.parseTimeString(ae),ae}catch{}const Pe=ae.replace(/[^\d:.]/g,"").split(":"),qe=Pe[Pe.length-1],[Le,re]=qe.split(".");let Y="0",ge="00",ee="00",A="00";return Pe.length===1?(ee=Pe[0].padStart(2,"0"),re&&(A=re.padEnd(2,"0").substring(0,2))):Pe.length===2?(ge=Pe[0].padStart(2,"0"),ee=Le.padStart(2,"0"),re&&(A=re.padEnd(2,"0").substring(0,2))):Pe.length>=3&&(Y=Pe[0],ge=Pe[1].padStart(2,"0"),ee=Le.padStart(2,"0"),re&&(A=re.padEnd(2,"0").substring(0,2))),`${Y}:${ge}:${ee}.${A}`}function W(le){const ae=le.split(":");if(ae.length!==3)return le;const me=ae[0],Pe=ae[1],qe=ae[2].split("."),Le=qe[0],re=qe[1]||"00",Y=parseInt(me,10),ge=parseInt(Pe,10),ee=parseInt(Le,10),A=re.replace(/0+$/,"");let J="";return Y>0?J+=`${Y}:${ge.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`:J+=`${ge}:${ee.toString().padStart(2,"0")}`,A&&A!=="0"&&A!=="00"&&(J+=`.${A}`),J}function N(le,ae){const me=ae.target,Pe=me.value;if(!(ae.type!=="blur"&&ae?.key!=="Enter"))try{const qe=O(Pe),Le=e.audioClipService.parseTimeString(qe);let re=qe;if(le==="duration"&&s(d)>0){const Y=s(d)-s(k);Le>Y&&(re=e.audioClipService.formatTimeString(Y))}m(le==="start"?p:h,re,!0),me.value=W(re)}catch{const qe=s(le==="start"?p:h);me.value=W(qe)}}function j(le,ae){ae.key==="Enter"&&N(le,ae)}function x(le){if(!s(l))return;const ae=Math.max(0,s(k)+le),me=Math.max(0,s(l).duration-s(E)),Pe=Math.min(ae,me);m(p,e.audioClipService.formatTimeString(Pe),!0),s(l)&&(s(b)||s(y))&&(s(l).currentTime=Pe)}ht(()=>{if(s(c)){const le=setTimeout(()=>m(c,null),5e3);return()=>clearTimeout(le)}});var F=Rp(),q=u(F);Ut(q,le=>m(l,le),()=>s(l));var te=w(q,2);{var M=le=>{var ae=_p(),me=w(u(ae),2),Pe=u(me);D(()=>S(Pe,s(c))),_(le,ae)};U(te,le=>{s(c)&&le(M)})}var Q=w(te,2),ce=u(Q),be=u(ce);ar(be,()=>s(i));var _e;be.__change=[hp,i];var Ue=u(be);Ue.value=Ue.__value="";var Ce=w(Ue);Ct(Ce,17,()=>s(n),Pt,(le,ae)=>{var me=xp(),Pe={},qe=u(me);D(()=>{Pe!==(Pe=s(ae).href)&&(me.value=(me.__value=s(ae).href)??""),S(qe,s(ae).id)}),_(le,me)});var pe=w(ce,2),K=u(pe);K.__input=[vp,v,d,p,e],K.__change=[mp,d,k,E,h,e];var oe=w(pe,2),ie=u(oe),xe=u(ie);xe.__input=[Sp,N],xe.__keydown=[Ep,j];var Me=w(ie,2),Ae=u(Me);let He;Ae.__click=[gp,l,b,L,e,y,c];var $e=u(Ae);{var Ye=le=>{var ae=Tt("â¹ï¸");_(le,ae)},Ne=le=>{var ae=Tt("â¶ï¸");_(le,ae)};U($e,le=>{s(b)&&s(L)==="clip"?le(Ye):le(Ne,!1)})}var Ge=w(oe,2),Ke=u(Ge),he=u(Ke);he.__input=[kp,N],he.__keydown=[Tp,j];var ke=w(Ke,2),Te=u(ke);let Oe;Te.__click=[wp,l,y,L,e,b,c];var se=u(Te);{var Ee=le=>{var ae=Tt("â¹ï¸");_(le,ae)},ve=le=>{var ae=Tt("â¶ï¸");_(le,ae)};U(se,le=>{s(y)&&s(L)==="last"?le(Ee):le(ve,!1)})}var We=w(Ge,2),Ve=u(We),B=u(Ve);B.__click=[Cp,x];var H=w(B,2);H.__click=[Ip,x];var Z=w(H,2);Z.__click=[Fp,x];var ue=w(Z,2);ue.__click=[Mp,x];var ye=w(We,2);ye.__click=[yp,a,t,e,n,i,p,g,h];var Se=w(ye,2);Se.__click=[bp,i,e,k,E,T,g,c];var Fe=w(Se,2),Ie=u(Fe);Ie.__input=[Pp,g];var Xe=w(Q,2);{var Be=le=>{var ae=Lp();_(le,ae)};U(Xe,le=>{s(f)&&le(Be)})}D((le,ae,me,Pe)=>{de(q,"src",s(o)),_e!==(_e=s(i))&&(be.value=(be.__value=s(i))??"",Fn(be,s(i))),Qt(K,s(v)),K.disabled=!s(d),Qt(xe,le),He=ct(Ae,1,"control-btn play-btn svelte-1ullway",null,He,ae),Ae.disabled=s($),de(Ae,"aria-label",s(R)),de(Ae,"title",s(R)),Qt(he,me),Oe=ct(Te,1,"control-btn play-last-btn svelte-1ullway",null,Oe,Pe),Te.disabled=s($),de(Te,"aria-label",s(z)),de(Te,"title",s(z)),ye.disabled=!s(P),Se.disabled=!s(i),Qt(Ie,s(g))},[()=>W(s(p)),()=>({active:s(b)&&s(L)==="clip"}),()=>W(s(h)),()=>({active:s(y)&&s(L)==="last"})]),nt("blur",xe,le=>N("start",le)),nt("blur",he,le=>N("duration",le)),_(r,F),at()}_t(["change","input","keydown","click"]);function Dp(r,e){e.onPaneToggle?.()}function Ap(r,e){m(e,!s(e))}function Op(r,e){e.onForceUpdate?.()}var Up=I('<button type="button">ðµ Audio Clip Editor</button>'),zp=I('<div class="status-indicator transforming svelte-1o9epl8" title="Transform in progress"><div class="status-spinner svelte-1o9epl8"></div> <span class="svelte-1o9epl8">Transforming...</span></div>'),Wp=I('<div class="status-indicator error svelte-1o9epl8" title="Transform error"><span class="status-icon svelte-1o9epl8">â ï¸</span> <span class="svelte-1o9epl8">Error</span></div>'),Np=I('<div class="status-indicator error svelte-1o9epl8" title="Syntax error prevents transform"><span class="status-icon svelte-1o9epl8">â ï¸</span> <span class="svelte-1o9epl8">Syntax Error</span></div>'),jp=I('<div class="status-indicator warning svelte-1o9epl8"><span class="status-icon svelte-1o9epl8">â ï¸</span> <span class="svelte-1o9epl8"> </span></div>'),Bp=I('<div class="status-indicator success svelte-1o9epl8" title="Transform successful"><span class="status-icon svelte-1o9epl8">â</span> <span class="svelte-1o9epl8"> </span></div>'),Hp=(r,e)=>e(2,r),Vp=I('<option class="svelte-1o9epl8"> </option>'),qp=I('<div class="audio-editor-panel svelte-1o9epl8"><!></div>'),$p=(r,e,t)=>e()==="text"&&t(2),Gp=(r,e,t)=>e()==="text"&&t(2),Xp=I('<div class="pane-error-overlay svelte-1o9epl8"><span class="error-icon svelte-1o9epl8" aria-hidden="true">â ï¸</span> <span class="error-message svelte-1o9epl8"> </span></div>'),Kp=I('<div class="editor-pane pane-2 svelte-1o9epl8"><div class="pane-header svelte-1o9epl8"><div class="pane-header-content svelte-1o9epl8"><select class="file-selector svelte-1o9epl8" aria-label="Select file for pane 2"><option disabled class="svelte-1o9epl8">Select file...</option><!></select></div> <!></div> <div class="textarea-container svelte-1o9epl8"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 2 content"></textarea> <!></div></div>'),Yp=(r,e)=>e(1,r),Jp=I('<option class="svelte-1o9epl8"> </option>'),Zp=I('<div class="audio-editor-panel svelte-1o9epl8"><!></div>'),Qp=(r,e,t)=>e()==="text"&&t(1),eh=(r,e,t)=>e()==="text"&&t(1),th=I('<div class="pane-error-overlay svelte-1o9epl8"><span class="error-icon svelte-1o9epl8" aria-hidden="true">â ï¸</span> <span class="error-message svelte-1o9epl8"> </span></div>'),nh=I('<details class="error-stack svelte-1o9epl8"><summary class="svelte-1o9epl8">Stack Trace</summary> <pre class="svelte-1o9epl8"> </pre></details>'),rh=I('<div class="error-display svelte-1o9epl8"><div class="error-header svelte-1o9epl8"><span class="error-icon svelte-1o9epl8" aria-hidden="true">ð¨</span> <strong class="svelte-1o9epl8"> </strong></div> <div class="error-message svelte-1o9epl8"> </div> <!></div>'),ah=I('<li class="svelte-1o9epl8"> </li>'),ih=I('<div class="warnings-display svelte-1o9epl8"><div class="warnings-header svelte-1o9epl8"><span class="warning-icon svelte-1o9epl8" aria-hidden="true">â ï¸</span> <strong class="svelte-1o9epl8"> </strong></div> <ul class="warnings-list svelte-1o9epl8"></ul></div>'),sh=I('<div class="editor-pane-container svelte-1o9epl8"><div class="editor-header svelte-1o9epl8"><div class="editor-controls svelte-1o9epl8"><button type="button" class="pane-toggle-btn svelte-1o9epl8"><span class="toggle-icon svelte-1o9epl8" aria-hidden="true"> </span> <span class="toggle-label svelte-1o9epl8"> </span></button> <!></div> <div class="editor-status svelte-1o9epl8"><!> <button type="button" class="force-update-btn svelte-1o9epl8" title="Force immediate preview update">ð</button></div></div> <div class="editor-content svelte-1o9epl8"><div><!> <div class="editor-pane pane-1 svelte-1o9epl8"><div class="pane-header svelte-1o9epl8"><div class="pane-header-content svelte-1o9epl8"><select class="file-selector svelte-1o9epl8" aria-label="Select file for pane 1"><option disabled class="svelte-1o9epl8">Select file...</option><!></select></div> <!></div> <div class="textarea-container svelte-1o9epl8"><textarea autocomplete="off" autocapitalize="off" aria-label="Pane 1 content"></textarea> <!></div></div></div></div> <!> <!></div>');function oh(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(k(),"$pane1FileStore",t),i=()=>tt(E(),"$pane2FileStore",t),o=()=>tt(mt,"$t",t);let l=V(e,"transformError",3,null),d=V(e,"transformWarnings",19,()=>[]),f=V(e,"isTransforming",3,!1),c=V(e,"executionTime",3,0),p=V(e,"availableFiles1",19,()=>[]),h=V(e,"availableFiles2",19,()=>[]),v=V(e,"editorMode",3,"single"),g=V(e,"pane1SelectedFile",3,""),b=V(e,"pane2SelectedFile",3,""),y=V(e,"pane1Error",15),L=V(e,"pane2Error",15),k=V(e,"pane1FileStore",3,null),E=V(e,"pane2FileStore",3,null);V(e,"onPreviewClick",3,null);let T=V(e,"workspace",3,null),P=V(e,"audioClipService",3,null),$=V(e,"workspaceService",3,null),R=V(e,"settingsService",3,null);function z(A){const J=s(A===1?M:Q);if(!J)return;const C=J.selectionStart,G=J.selectionEnd;C!==G?m(be,{start:C,end:G},!0):m(be,null)}function O(A){const J=s(Ue)===1?s(M):s(Q);if(!J)return;const C=J.selectionStart,G=J.selectionEnd,X=J.value,we=X.slice(0,C)+A+X.slice(G);J.value=we;const Re=C+A.length;J.setSelectionRange(Re,Re);const ze=new Event("input",{bubbles:!0});J.dispatchEvent(ze),J.focus()}function W(A,J){const C=J.target,X=(A===1?p():h()).find(we=>we.value===C.value);X&&e.onFileSelect?.(A,X.path,X.type)}function N(A){const J=A.target.value;if(!k()){console.warn("ð« No file store available for input in pane 1");return}const C=e.contentService.validateFileContent(J,g());if(C){y(C);return}else y(null);k().updateContent(J)}function j(A){const J=A.target.value;if(!E()){console.warn("ð« No file store available for input in pane 2");return}const C=e.contentService.validateFileContent(J,b());if(C){L(C);return}else L(null);E().updateContent(J)}function x(A){return A.includes("css")?"syntax-css":A.includes("javascript")||A.includes("js")||A.includes("transform")?"syntax-js":"syntax-text"}function F(A){return A.includes("css")||A.includes("javascript")||A.includes("js")||A.includes("transform")}function q(A){return A==="text"?`Enter your chapter content here...

This will be transformed to XHTML using your configured text transform script.`:A.includes("css")?`/* Stylesheet content */

body {
  /* Your styles here */
}`:A.includes("javascript")||A.includes("js")?`// JavaScript content

(function() {
  // Your code here
})();`:A.includes("transform")?`// Transform script

function transform(input) {
  // Your transform logic here
  return input;
}`:""}function te(A){return A<1e3?`${A}ms`:`${(A/1e3).toFixed(1)}s`}let M=fe(void 0),Q=fe(void 0),ce=fe(!1),be=fe(null),_e=ne(()=>T()?.opf?.manifest?T().opf.manifest.some(A=>A.mediaType&&A.mediaType.startsWith("audio/")):!1),Ue=ne(()=>g()==="text"?1:b()==="text"?2:null),Ce=ne(()=>{const A=s(Ue);return A===1?k()&&n()?.content||"":A===2&&E()&&i()?.content||""});function pe(A){let J=A.trim();return J=J.split("").map(C=>{const G=C.charCodeAt(0);return G===8217||G===8216?"'":G===8221||G===8220?'"':C}).join(""),J=J.replace(/[""ââ]/g,'"'),J=J.replace(/\s+/g," "),J}function K(A){const{text:J}=A;let C=null,G="";if(k()&&g()&&s(M)&&n()?.content?(C=s(M),G=n().content):E()&&b()&&s(Q)&&i()?.content&&(C=s(Q),G=i().content),!C||!G)return;const X=J.trim(),we=pe(X),Re=G.toLowerCase(),ze=we.toLowerCase();let je=Re.indexOf(ze);if(je!==-1){oe(C,je,je+we.length);return}if(X.length>=8){const Qe=X.toLowerCase();if(je=Re.indexOf(Qe),je!==-1){oe(C,je,je+X.length);return}}}function oe(A,J,C){A.focus(),A.setSelectionRange(J,C);const X=A.value.substring(0,J).split(`
`).length-1,we=parseInt(getComputedStyle(A).lineHeight)||20,Re=X*we;A.scrollTop=Math.max(0,Re-A.clientHeight/2)}var ie=sh(),xe=u(ie),Me=u(xe),Ae=u(Me);Ae.__click=[Dp,e];var He=u(Ae),$e=u(He),Ye=w(He,2),Ne=u(Ye),Ge=w(Ae,2);{var Ke=A=>{var J=Up();let C;J.__click=[Ap,ce],D(G=>{C=ct(J,1,"audio-toggle-btn svelte-1o9epl8",null,C,G),de(J,"title",s(ce)?"Hide Audio Clip Editor":"Show Audio Clip Editor"),de(J,"aria-label",s(ce)?"Hide Audio Clip Editor":"Show Audio Clip Editor")},[()=>({active:s(ce)})]),_(A,J)};U(Ge,A=>{(g()==="text"&&v()==="single"||v()==="dual"&&(g()==="text"||b()==="text"))&&s(_e)&&P()&&T()&&A(Ke)})}var he=w(Me,2),ke=u(he);{var Te=A=>{var J=zp();_(A,J)},Oe=(A,J)=>{{var C=X=>{var we=Wp();_(X,we)},G=(X,we)=>{{var Re=je=>{var Qe=Np();_(je,Qe)},ze=(je,Qe)=>{{var Ze=ot=>{var gt=jp(),ut=w(u(gt),2),lt=u(ut);D(()=>{de(gt,"title",`${d().length} warnings`),S(lt,`${d().length??""} warnings`)}),_(ot,gt)},Je=ot=>{var gt=Bp(),ut=w(u(gt),2),lt=u(ut);D(xt=>S(lt,xt),[()=>te(c())]),_(ot,gt)};U(je,ot=>{d().length>0?ot(Ze):ot(Je,!1)},Qe)}};U(X,je=>{y()||L()?je(Re):je(ze,!1)},we)}};U(A,X=>{l()&&l().stage!=="syntax-validation"?X(C):X(G,!1)},J)}};U(ke,A=>{f()?A(Te):A(Oe,!1)})}var se=w(ke,2);se.__click=[Op,e];var Ee=w(xe,2),ve=u(Ee);let We;var Ve=u(ve);{var B=A=>{var J=Kp(),C=u(J),G=u(C),X=u(G);ar(X,b);var we;X.__change=[Hp,W];var Re=u(X);Re.value=Re.__value="";var ze=w(Re);Ct(ze,17,h,Pt,(lt,xt)=>{var ft=Vp(),Ot={},fr=u(ft);D(()=>{Ot!==(Ot=s(xt).value)&&(ft.value=(ft.__value=s(xt).value)??""),S(fr,s(xt).label)}),_(lt,ft)});var je=w(G,2);{var Qe=lt=>{var xt=qp(),ft=u(xt);es(ft,{get workspace(){return T()},get audioClipService(){return P()},get workspaceService(){return $()},get settingsService(){return R()},get textContent(){return s(Ce)},get textareaSelection(){return s(be)},onInsertClip:O}),_(lt,xt)};U(je,lt=>{b()==="text"&&s(ce)&&s(_e)&&P()&&T()&&R()&&$()&&lt(Qe)})}var Ze=w(C,2),Je=u(Ze);let ot;Je.__input=j,Je.__mouseup=[$p,b,z],Je.__keyup=[Gp,b,z],Ut(Je,lt=>m(Q,lt),()=>s(Q));var gt=w(Je,2);{var ut=lt=>{var xt=Xp(),ft=w(u(xt),2),Ot=u(ft);D(()=>S(Ot,L())),_(lt,xt)};U(gt,lt=>{L()&&lt(ut)})}D((lt,xt,ft,Ot)=>{we!==(we=b())&&(X.value=(X.__value=b())??"",Fn(X,b())),ot=ct(Je,1,`content-textarea ${lt??""}`,"svelte-1o9epl8",ot,xt),Qt(Je,E()&&i()?.content||""),de(Je,"placeholder",ft),de(Je,"spellcheck",b()==="text"),de(Je,"dir",Ot),Je.dir=Je.dir},[()=>x(b()),()=>({"has-error":L()}),()=>q(b()),()=>F(b())?"ltr":void 0]),nt("select",Je,()=>b()==="text"&&z(2)),_(A,J)};U(Ve,A=>{v()==="dual"&&A(B)})}var H=w(Ve,2),Z=u(H),ue=u(Z),ye=u(ue);ar(ye,g);var Se;ye.__change=[Yp,W];var Fe=u(ye);Fe.value=Fe.__value="";var Ie=w(Fe);Ct(Ie,17,p,Pt,(A,J)=>{var C=Jp(),G={},X=u(C);D(()=>{G!==(G=s(J).value)&&(C.value=(C.__value=s(J).value)??""),S(X,s(J).label)}),_(A,C)});var Xe=w(ue,2);{var Be=A=>{var J=Zp(),C=u(J);es(C,{get workspace(){return T()},get audioClipService(){return P()},get workspaceService(){return $()},get settingsService(){return R()},get textContent(){return s(Ce)},get textareaSelection(){return s(be)},onInsertClip:O}),_(A,J)};U(Xe,A=>{g()==="text"&&s(ce)&&s(_e)&&P()&&T()&&R()&&$()&&A(Be)})}var le=w(Z,2),ae=u(le);let me;ae.__input=N,ae.__mouseup=[Qp,g,z],ae.__keyup=[eh,g,z],Ut(ae,A=>m(M,A),()=>s(M));var Pe=w(ae,2);{var qe=A=>{var J=th(),C=w(u(J),2),G=u(C);D(()=>S(G,y())),_(A,J)};U(Pe,A=>{y()&&A(qe)})}var Le=w(Ee,2);{var re=A=>{var J=rh(),C=u(J),G=w(u(C),2),X=u(G),we=w(C,2),Re=u(we),ze=w(we,2);{var je=Qe=>{var Ze=nh(),Je=w(u(Ze),2),ot=u(Je);D(()=>S(ot,l().stack)),_(Qe,Ze)};U(ze,Qe=>{l().stack&&Qe(je)})}D(()=>{S(X,`Transform Error (${l().stage??""})`),S(Re,l().message)}),_(A,J)};U(Le,A=>{l()&&l().stage!=="syntax-validation"&&A(re)})}var Y=w(Le,2);{var ge=A=>{var J=ih(),C=u(J),G=w(u(C),2),X=u(G),we=w(C,2);Ct(we,21,d,Pt,(Re,ze)=>{var je=ah(),Qe=u(je);D(()=>S(Qe,s(ze))),_(Re,je)}),D(()=>S(X,`${d().length??""} Warnings`)),_(A,J)};U(Y,A=>{d().length>0&&A(ge)})}D((A,J,C,G,X,we)=>{de(Ae,"title",v()==="single"?"Add second editor pane":"Switch to single pane"),S($e,v()==="single"?"â":"â"),S(Ne,A),se.disabled=f(),We=ct(ve,1,"editor-panes svelte-1o9epl8",null,We,J),Se!==(Se=g())&&(ye.value=(ye.__value=g())??"",Fn(ye,g())),me=ct(ae,1,`content-textarea ${C??""}`,"svelte-1o9epl8",me,G),Qt(ae,k()&&n()?.content||""),de(ae,"placeholder",X),de(ae,"spellcheck",g()==="text"),de(ae,"dir",we),ae.dir=ae.dir},[()=>v()==="single"?o()("Split Pane"):o()("Single Pane"),()=>({"dual-mode":v()==="dual"}),()=>x(g()),()=>({"has-error":y()}),()=>q(g()),()=>F(g())?"ltr":void 0]),nt("select",ae,()=>g()==="text"&&z(1)),_(r,ie);var ee=at({findAndSelectText:K});return a(),ee}_t(["click","change","input","mouseup","keyup"]);function ts(r,e="Text"){return r.startsWith("../")||r.startsWith("./")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")||r.startsWith("/")?r:e&&e!==""?`../${r}`:r}function Na(r,e="Text"){return!r.startsWith("../")||r.startsWith("http")||r.startsWith("data:")||r.startsWith("blob:")?r:e&&e!==""&&r.startsWith("../")?r.substring(3):r}class _o{constructor(e,t,a,n,i,o){this.workspaceId=e,this.fileStorage=t,this.extensionManager=a,this.blobURLManager=n,this.transformEngine=i,this.settingsService=o}async executeTransform(e,t=3e3,a){try{const n=await this.loadTransformScripts();return await this.transformEngine.setTransformScripts(n),await this.transformEngine.executeTransform(e,t,a)}catch(n){return{success:!1,error:{stage:"communication",message:String(n?.message||n)}}}}async loadTransformScripts(){try{const e={textTransform:"",domTransforms:[]};if(this.settingsService){const t=await this.settingsService.loadEPUBSettings(this.workspaceId);if(t.text_transform)try{e.textTransform=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${t.text_transform}`)}catch{console.warn(`Failed to load text transform script: ${t.text_transform}`)}if(t.dom_transforms&&t.dom_transforms.length>0){e.domTransforms=[];for(const a of t.dom_transforms)try{const n=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/scripts/${a}`);e.domTransforms.push(n)}catch{console.warn(`Failed to load DOM transform script: ${a}`)}}}return e}catch(e){throw new Error(`Failed to load transform scripts: ${e instanceof Error?e.message:String(e)}`)}}async setDebugMode(e){try{await this.transformEngine.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async ping(e={}){return await this.transformEngine.ping({data:e})}cleanup(){}}class lh{transformPipeline;debounceTimer;currentContent;isTransforming=!1;lastTransformTime=0;workspaceId;fileStorage;extensionManager;blobURLManager;workspaceService;settingsService;transformEngine;config;onPreviewUpdate;onError;spineItemId;spineItem;constructor(e,t,a,n,i,o,l,d,f,c,p,h){this.workspaceId=e,this.fileStorage=a,this.extensionManager=n,this.blobURLManager=i,this.workspaceService=o,this.settingsService=l,this.transformEngine=d,this.config=f,this.onPreviewUpdate=c,this.onError=p,this.spineItemId=t,this.spineItem=h,this.transformPipeline=new _o(e,a,n,i,d,l),this.currentContent={text:""},this.blobURLManager.setActiveWorkspace(e)}async initialize(){await this.transformPipeline.loadTransformScripts()}updateContent(e,t){this.currentContent[e]=t,this.debounceRender()}async loadInitialContent(){try{try{this.currentContent.text=await this.fileStorage.readTextFile(this.workspaceId,`SOURCE/text/${this.spineItemId}.txt`)}catch{this.currentContent.text=""}this.debounceRender()}catch(e){this.handleError("initialization",e)}}getCurrentContent(){return{...this.currentContent}}debounceRender(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.renderPreview()},this.config.debounceMs)}async renderPreview(){if(this.isTransforming){this.debounceRender();return}this.isTransforming=!0;const e=performance.now();try{this.config.autoSave&&await this.autoSaveChangedContent();const t=await this.transformPipeline.executeTransform(this.currentContent.text,this.config.transformTimeout,this.spineItemId);if(!t.success){this.handleError("transform",t.error);return}const a=await this.generateChapterMetadata(),n=this.generateXHTML(t.html||"",a);this.config.persistToManifest&&await this.saveXHTMLToManifest(n);const i=await this.blobURLManager.processXHTMLForPreview(n),o=performance.now()-e;this.lastTransformTime=o,this.onPreviewUpdate({xhtml:i,warnings:t.warnings||[],executionTime:Math.round(o),timestamp:Date.now()})}catch(t){this.handleError("preview",t)}finally{this.isTransforming=!1}}async autoSaveChangedContent(){const e={success:!0,savedFiles:[],errors:[]},t={path:`SOURCE/text/${this.spineItemId}.txt`,content:this.currentContent.text,type:"text"};if(t.content.trim())try{await this.fileStorage.writeTextFile(this.workspaceId,t.path,t.content),e.savedFiles.push(t.path)}catch(a){e.success=!1,e.errors.push({file:t.path,error:a instanceof Error?a.message:String(a)})}return e}async saveXHTMLToManifest(e){try{const t=await this.workspaceService.loadWorkspace(this.workspaceId),a=t.opf.manifest.find(i=>i.id===this.spineItemId);if(!a){console.warn(`Manifest item not found for spine item: ${this.spineItemId}`);return}const n=this.resolveManifestPath(a.href,t.pathInfo.basePath);await this.workspaceService.writeFile(this.workspaceId,n,e),await this.updateSVGProperty(e,t,a)}catch(t){console.warn("Failed to save XHTML to manifest:",t)}}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}detectInlineSVG(e){try{return new DOMParser().parseFromString(e,"text/html").querySelectorAll("svg").length>0}catch(t){return console.warn("Failed to parse XHTML for SVG detection:",t),!1}}async updateSVGProperty(e,t,a){try{if(a.mediaType!=="application/xhtml+xml")return;const n=this.detectInlineSVG(e),i=a.properties||[],o=i.includes("svg");if(n&&!o)await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:[...i,"svg"]});else if(!n&&o){const l=i.filter(d=>d!=="svg");await this.workspaceService.updateManifestItem(t,this.spineItemId,{properties:l.length>0?l:void 0})}}catch(n){console.warn("Failed to update SVG property:",n)}}async generateChapterMetadata(){const e=this.spineItemId;let t=!1,a="en";try{a=(await this.workspaceService.loadWorkspace(this.workspaceId))?.opf?.metadata?.language||"en"}catch(o){console.warn("Could not load workspace language, using default:",o)}const n=[],i=[];try{const o=await this.workspaceService.loadWorkspace(this.workspaceId);t=o.opf.metadata.renditionLayout=="pre-paginated",o.opf.manifest.filter(l=>l.mediaType==="text/css").forEach(l=>{n.push(l.href)}),o.opf.manifest.filter(l=>l.mediaType==="text/javascript"||l.mediaType==="application/javascript").forEach(l=>{i.push(l.href)})}catch{}return{title:e,language:a,stylesheets:n,scripts:i,fixed_layout:t}}generateXHTML(e,t){const a=t.stylesheets.map(o=>`  <link rel="stylesheet" type="text/css" href="${this.escapeHtml(ts(o))}" />`).join(`
`),n=t.scripts.map(o=>`  <script src="${this.escapeHtml(ts(o))}"><\/script>`).join(`
`),i=t.fixed_layout?'<meta name="viewport" content="width=320, height=460, initial-scale=1.0" />':'<meta name="viewport" content="width=device-width, initial-scale=1.0" />';return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="${this.escapeHtml(t.language)}" lang="${this.escapeHtml(t.language)}">
<head>
  <title>${this.escapeHtml(t.title)}</title>
${a}
${n}
${i}
</head>
${e}
</html>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}handleError(e,t){const a={stage:e,message:t?.message||(typeof t=="string"?t:"Unknown error"),stack:t?.stack};this.onError({error:a,stage:e,timestamp:Date.now()})}getStats(){return{isTransforming:this.isTransforming,lastTransformTime:this.lastTransformTime,contentLength:{text:this.currentContent.text.length}}}async forcePreviewUpdate(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),await this.renderPreview()}async setDebugMode(e){try{await this.transformPipeline.setDebugMode(e)}catch(t){console.warn("Failed to set debug mode:",t)}}async pingTransformPipeline(){try{return await this.transformPipeline.ping({timestamp:Date.now()}),!0}catch(e){return console.warn("Transform pipeline ping failed:",e),!1}}async switchToSpineItem(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.isTransforming=!1,this.lastTransformTime=0,this.spineItemId=e,this.spineItem=t,this.currentContent={text:""};try{await this.loadInitialContent()}catch(a){console.warn("Failed to load initial content for spine item switch:",a)}}cleanup(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=void 0),this.transformPipeline.cleanup(),this.blobURLManager.cleanup(),this.isTransforming=!1,this.lastTransformTime=0}}function ch(r,e,t,a,n,i,o,l,d={},f,c,p){const v={...{debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0},...d};return new lh(r,e,t,a,n,i,o,l,v,f,c,p)}const dh={debounceMs:300,transformTimeout:3e3,autoSave:!0,persistToManifest:!0};class Ir extends Error{constructor(e,t){super(e),this.code=t,this.name="BlobURLError"}}class Kr extends Ir{constructor(e,t){super(`Blob URL capacity exceeded: ${e}/${t}`,"CAPACITY_EXCEEDED")}}class ns extends Ir{constructor(e,t){super(e,"XHTML_PROCESSING_ERROR"),this.originalError=t}}class Ti{activeWorkspaceId=null;registry;fileStorage;basePath;supportsDirectBlobs;onCapacityReached;constructor(e){this.fileStorage=e.fileStorage,this.basePath=e.basePath,this.onCapacityReached=e.onCapacityReached,this.registry={urls:new Map,created:new Map,count:0,maxCount:e.maxBlobURLs||100},this.supportsDirectBlobs=this.fileStorage.supportsDirectBlobURLs()}setActiveWorkspace(e){this.activeWorkspaceId!==e&&(this.cleanup(),this.activeWorkspaceId=e)}async createBlobURL(e){if(this.registry.count>=this.registry.maxCount)throw this.onCapacityReached?.(),new Kr(this.registry.count,this.registry.maxCount);if(this.registry.urls.has(e))return this.registry.urls.get(e);if(!this.activeWorkspaceId)throw new Ir("No active workspace set","NO_WORKSPACE");const t=this.resolveManifestPath(e);try{let a;const n=e.toLowerCase().endsWith(".css");if(this.supportsDirectBlobs&&!n){const i=await this.fileStorage.getFile(this.activeWorkspaceId,t),o=this.getMimeType(e),l=new File([i],i.name,{type:o});a=URL.createObjectURL(l)}else{let i;if(n){const d=await this.fileStorage.readTextFile(this.activeWorkspaceId,t),f=await this.processCSSFontURLs(d);i=new TextEncoder().encode(f).buffer}else i=await this.fileStorage.readFile(this.activeWorkspaceId,t);const o=this.getMimeType(e),l=new Blob([i],{type:o});a=URL.createObjectURL(l)}return this.addToRegistry(e,a),a}catch(a){throw new Ir(`Failed to create blob URL for ${e}: ${a instanceof Error?a.message:String(a)}`,"CREATION_FAILED")}}createBlobFromContent(e,t){const a=new Blob([e],{type:t});return URL.createObjectURL(a)}async processXHTMLForPreview(e){if(this.isAtCapacity())throw this.onCapacityReached?.(),new Kr(this.getBlobURLCount(),this.registry.maxCount);try{const a=new DOMParser().parseFromString(e,"application/xhtml+xml");if(a.documentElement&&a.documentElement.tagName==="parsererror")throw new ns("Invalid XHTML content");const n=this.findAssetElements(a);for(const o of n)await this.processAssetElement(o);return new XMLSerializer().serializeToString(a)}catch(t){throw t instanceof Ir?t:new ns(`XHTML processing failed: ${t instanceof Error?t.message:String(t)}`,t instanceof Error?t:new Error(String(t)))}}revokeBlobURL(e){URL.revokeObjectURL(e),this.removeFromRegistry(e)}revokeFileBlob(e){const t=this.registry.urls.get(e);t&&this.revokeBlobURL(t)}cleanup(){for(const e of this.registry.urls.values())URL.revokeObjectURL(e);this.registry.urls.clear(),this.registry.created.clear(),this.registry.count=0}getMimeType(e){return wo(e)}isResourcePath(e){return!e.startsWith("http")&&!e.startsWith("data:")&&!e.startsWith("blob:")&&!e.startsWith("/")&&!e.startsWith("ftp:")&&!e.startsWith("mailto:")&&!e.startsWith("tel:")&&!e.startsWith("file:")&&!e.startsWith("about:")&&!e.startsWith("javascript:")&&!e.startsWith("//")&&e.trim().length>0}getBlobURLCount(){return this.registry.count}isAtCapacity(){return this.registry.count>=this.registry.maxCount}resolveManifestPath(e){return this.basePath?`${this.basePath}/${e}`:e}findAssetElements(e){const t=[],a=["script[src]","link[href]","a[href]","audio[src]","video[src]","video[poster]","img[src]","object[data]","image[href]","*[data-src]"];for(const n of a){const i=e.querySelectorAll(n);t.push(...Array.from(i))}return t}async processAssetElement(e){let t;if(e.hasAttribute("src"))t="src";else if(e.hasAttribute("href"))t="href";else if(e.hasAttribute("data"))t="data";else if(e.hasAttribute("poster"))t="poster";else if(e.hasAttribute("data-src"))t="data-src";else return;const a=e.getAttribute(t);if(!(!a||!this.isResourcePath(a)))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Kr(this.getBlobURLCount(),this.registry.maxCount);const n=Na(a),i=await this.createBlobURL(n);e.setAttribute(t,i)}catch(n){this.handleMissingAsset(e,a,n)}}handleMissingAsset(e,t,a){const n=e.tagName.toLowerCase(),i=Na(t),o=this.resolveManifestPath(i);if(["img","video","audio","object","image"].includes(n)){console.warn(`Missing image: ${o} (referenced by <${n}> element)`);const l=e.hasAttribute("src")?"src":e.hasAttribute("href")?"href":"data";e.setAttribute(l,this.getErrorIconSVG()),e.setAttribute("alt",`Missing: ${t}`)}else["script","link"].includes(n)&&console.warn(`Missing asset: ${o} (referenced by <${n}> element)`)}getErrorIconSVG(){return`data:image/svg+xml,${encodeURIComponent(`
      <svg width="24" height="24" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" fill="#f44336" stroke="#d32f2f"/>
        <text x="12" y="16" text-anchor="middle" fill="white" font-size="12">!</text>
      </svg>
    `)}`}addToRegistry(e,t){this.registry.urls.set(e,t),this.registry.created.set(e,new Date),this.registry.count++}removeFromRegistry(e){for(const[t,a]of this.registry.urls.entries())if(a===e){this.registry.urls.delete(t),this.registry.created.delete(t),this.registry.count--;break}}async processCSSFontURLs(e){const t=/url\(\s*(['"]?)(.*?)\1\s*\)/g;let a=e;const n=Array.from(e.matchAll(t));for(const i of n){const o=i[0],l=i[1],d=i[2];if(this.isResourcePath(d))try{if(this.getBlobURLCount()>=this.registry.maxCount)throw this.onCapacityReached?.(),new Kr(this.getBlobURLCount(),this.registry.maxCount);const f=Na(d),c=await this.createBlobURL(f),p=`url(${l}${c}${l})`;a=a.replace(o,p)}catch(f){console.warn(`Failed to process CSS url(${d}):`,f)}}return a}getLoadedGlobals(){return{}}}class yr extends Error{constructor(e,t){super(e),this.code=t,this.name="SettingsServiceError"}}class er{constructor(e,t,a,n){this.fileStorage=e,this.extensionManager=t,this.themeStore=a,this.i18nStore=n}static GLOBAL_SETTINGS_KEY="editme_global_settings";static SUPPORTED_LOCALES=new Set(["en","de","ar","he","ja","ka","zh-hant","fr","es","it","pt","ru","pl","nl","sv"]);static VALID_THEMES=new Set(["light","dark","system"]);loadGlobalSettings(){try{if(typeof localStorage>"u")return this.getDefaultGlobalSettings();const e=localStorage.getItem(er.GLOBAL_SETTINGS_KEY);if(!e)return this.getDefaultGlobalSettings();const t=JSON.parse(e);if(typeof t!="object"||!t)return this.getDefaultGlobalSettings();const a=this.getDefaultGlobalSettings();return{theme:this.isValidTheme(t.theme)?t.theme:a.theme,locale:this.isValidLocale(t.locale)?t.locale:a.locale,editor_font_size:this.isValidFontSize(t.editor_font_size)?t.editor_font_size:a.editor_font_size}}catch{return this.getDefaultGlobalSettings()}}saveGlobalSettings(e){try{if(typeof localStorage>"u")return;localStorage.setItem(er.GLOBAL_SETTINGS_KEY,JSON.stringify(e)),e.theme==="system"?this.themeStore.useSystemPreference():this.themeStore.setTheme(e.theme),this.i18nStore.setLocale(e.locale)}catch(t){throw new yr(`Failed to save global settings: ${t instanceof Error?t.message:"Unknown error"}`,"GLOBAL_SETTINGS_SAVE_ERROR")}}getDefaultGlobalSettings(){return{theme:"system",locale:"en",editor_font_size:14}}async loadWorkspaceSettings(e){try{const t=await this.fileStorage.readTextFile(e,".workspace-metadata.json"),a=JSON.parse(t),n=this.getDefaultWorkspaceSettings();return{bust_cache:a.bust_cache??n.bust_cache,draft_id:a.draft_id??n.draft_id,editor:{preview_delay_ms:a.editor?.preview_delay_ms??n.editor.preview_delay_ms,advanced_mode:a.editor?.advanced_mode??n.editor.advanced_mode}}}catch{return this.getDefaultWorkspaceSettings()}}async saveWorkspaceSettings(e,t){try{let a={};try{const i=await this.fileStorage.readTextFile(e,".workspace-metadata.json");a=JSON.parse(i)}catch{}const n={...a,bust_cache:t.bust_cache,draft_id:t.draft_id,editor:t.editor};await this.fileStorage.writeTextFile(e,".workspace-metadata.json",JSON.stringify(n,null,2))}catch(a){throw new yr(`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`,"WORKSPACE_SETTINGS_SAVE_ERROR")}}getDefaultWorkspaceSettings(){return{bust_cache:!1,draft_id:0,editor:{preview_delay_ms:500,advanced_mode:!1}}}async loadEPUBSettings(e){try{const t=await this.fileStorage.readTextFile(e,"SOURCE/settings.json"),a=JSON.parse(t),n=this.getDefaultEPUBSettings();return{text_transform:a.text_transform??n.text_transform,dom_transforms:a.dom_transforms??n.dom_transforms,spine_basename:a.spine_basename??n.spine_basename,audio_clip_template:a.audio_clip_template??n.audio_clip_template,cover:a.cover?{template:a.cover.template??"default",background_color:a.cover.background_color??"#ffffff",text_color:a.cover.text_color??"#000000",font_family:a.cover.font_family??"serif"}:void 0}}catch{return this.getDefaultEPUBSettings()}}async saveEPUBSettings(e,t){try{await this.fileStorage.writeTextFile(e,"SOURCE/settings.json",JSON.stringify(t,null,2))}catch(a){throw new yr(`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_SETTINGS_SAVE_ERROR")}}getDefaultEPUBSettings(){return{text_transform:"SOURCE/scripts/transformText.js",dom_transforms:["SOURCE/scripts/transformDom.js"],spine_basename:"chapter",audio_clip_template:":clip[<label>]{src=<href> begin=<begin> end=<end>}"}}async incrementDraftId(e){const t=await this.loadWorkspaceSettings(e),a=t.draft_id+1;return await this.saveWorkspaceSettings(e,{...t,draft_id:a}),a}generateDraftTitle(e,t){return`${e} (Draft ${t})`}extractDraftInfo(e){const t=e.match(/^(.+?)\s+\(Draft\s+(\d+)\)$/);return t?{baseTitle:t[1],draftId:parseInt(t[2],10)}:{baseTitle:e,draftId:null}}async getAvailableTransforms(e){try{return await this.extensionManager.getAvailableTransforms(e)}catch(t){throw new yr(`Failed to get available transforms: ${t instanceof Error?t.message:"Unknown error"}`,"TRANSFORM_DISCOVERY_ERROR")}}async resolveTransformScripts(e,t){try{let a=null;const n=[];if(t.text_transform)try{a=await this.fileStorage.readTextFile(e,t.text_transform)}catch{}for(const i of t.dom_transforms)try{const o=await this.fileStorage.readTextFile(e,i);n.push(o)}catch{}return{textTransform:a,domTransforms:n}}catch(a){throw new yr(`Failed to resolve transform scripts: ${a instanceof Error?a.message:"Unknown error"}`,"TRANSFORM_RESOLUTION_ERROR")}}validateGlobalSettings(e){const t=[],a=[];return e.theme!==void 0&&!this.isValidTheme(e.theme)&&t.push(`Invalid theme: ${e.theme}`),e.locale!==void 0&&!this.isValidLocale(e.locale)&&a.push(`Unsupported locale: ${e.locale}`),e.editor_font_size!==void 0&&!this.isValidFontSize(e.editor_font_size)&&t.push("Font size must be between 8-32 pixels"),{isValid:t.length===0,errors:t,warnings:a}}validateWorkspaceSettings(e){const t=[],a=[];if(e.draft_id!==void 0&&(e.draft_id<0||!Number.isInteger(e.draft_id))&&t.push("Draft ID must be a non-negative integer"),e.editor){const{preview_delay_ms:n}=e.editor;n!==void 0&&(n<100||n>2e3)&&t.push("Preview delay must be between 100-2000ms")}return{isValid:t.length===0,errors:t,warnings:a}}validateEPUBSettings(e){const t=[],a=[];if(e.text_transform!==void 0&&e.text_transform&&(e.text_transform.startsWith("SOURCE/")||t.push("Text transform must start with SOURCE/")),e.dom_transforms!==void 0)for(const n of e.dom_transforms)n.startsWith("SOURCE/")||t.push(`DOM transform must start with SOURCE/: ${n}`);if(e.spine_basename!==void 0&&!e.spine_basename.trim()&&t.push("Spine basename cannot be empty"),e.audio_clip_template!==void 0&&e.audio_clip_template){const n=e.audio_clip_template,o=["<href>","<begin>","<end>"].filter(l=>!n.includes(l));o.length>0&&t.push(`Audio clip template missing required placeholders: ${o.join(", ")}`)}if(e.cover){const{background_color:n,text_color:i}=e.cover;n&&!this.isValidColor(n)&&t.push("Invalid background color format"),i&&!this.isValidColor(i)&&t.push("Invalid text color format")}return{isValid:t.length===0,errors:t,warnings:a}}isValidTheme(e){return er.VALID_THEMES.has(e)}isValidLocale(e){return typeof e=="string"&&e.length>0}isValidFontSize(e){return typeof e=="number"&&e>=8&&e<=32&&Number.isInteger(e)}isValidColor(e){return/^#[0-9A-Fa-f]{6}$/.test(e)}}function uh(r){let e=r;return e.endsWith(".js")&&(e=e.slice(0,-3)),e.endsWith(".min")&&(e=e.slice(0,-4)),e=e.replace(/[-@](?:v?\d+[\.\-]\d+|\d+[\.\-]\d+)(?:[\.\-]\w+)*$/i,""),Za(e)}function Za(r){return r.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function fh(r){const e=r.name.toLowerCase();return e.endsWith(".js")?r.size===0?{isValid:!1,fileType:"javascript",error:"JavaScript file cannot be empty"}:r.size>50*1024*1024?{isValid:!1,fileType:"javascript",error:"JavaScript file too large (max 50MB)"}:{isValid:!0,fileType:"javascript"}:e==="license.txt"||e==="license"?r.size>1024*1024?{isValid:!1,fileType:"license",error:"License file too large (max 1MB)"}:{isValid:!0,fileType:"license"}:{isValid:!1,fileType:"unknown",error:"Invalid file type: only JavaScript (.js) and license files are supported"}}function Kn(r){const e=r.slice().sort((a,n)=>a.name.localeCompare(n.name)),t=r.reduce((a,n)=>a+n.size,0);return{files:e,totalSize:t}}function Qa(r,e){return r.totalSize!==e.totalSize||r.files.length!==e.files.length?!1:r.files.every((t,a)=>t.name===e.files[a].name&&t.size===e.files[a].size)}function ph(r){return!(!r||r.length===0||r.length>100||!/^[a-z0-9-]+$/.test(r)||r.startsWith("-")||r.endsWith("-")||/^-+$/.test(r))}const Ht="extensions-cache";class hh{constructor(e){this.fileStorage=e}async listCachedExtensions(){try{const e=await this.fileStorage.listFiles(Ht),t=new Set;for(const n of e){const i=n.split("/");i.length>=2&&t.add(i[0])}const a=[];for(const n of t)try{const i=await this.getExtensionInfo(n);a.push(i)}catch{}return a.sort((n,i)=>n.name.localeCompare(i.name))}catch(e){if(e instanceof Error&&e.message.includes("not found"))return[];throw e}}async getExtensionInfo(e){const a=(await this.fileStorage.listFiles(Ht)).filter(o=>o.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);const n=[];let i=0;for(const o of a){const l=o.split("/").pop(),f={size:(await this.fileStorage.readFile(Ht,o)).byteLength};let c;if(l.endsWith(".js"))c="javascript";else if(l.toLowerCase().includes("license"))c="license";else continue;n.push({filename:o.replace(`${e}/`,""),size:f.size,type:c}),i+=f.size}if(n.length===0)throw new Error(`Extension '${e}' has no valid files`);return{name:e,files:n,totalSize:i,location:"cache"}}async cacheExtension(e,t){if(await this.hasConflict(e,t))throw new Error(`Extension '${e}' already cached with different content`);for(const[n,i]of t.entries()){const o=`${e}/${n}`;await this.fileStorage.writeFile(Ht,o,i)}}async copyToWorkspace(e,t){const n=(await this.fileStorage.listFiles(Ht)).filter(i=>i.startsWith(e+"/"));if(n.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const i of n){const o=await this.fileStorage.readFile(Ht,i),l=`SOURCE/extensions/${i}`;await this.fileStorage.writeFile(t,l,o)}}async deleteExtension(e){const a=(await this.fileStorage.listFiles(Ht)).filter(n=>n.startsWith(e+"/"));if(a.length===0)throw new Error(`Extension '${e}' not found in cache`);for(const n of a)await this.fileStorage.deleteFile(Ht,n)}async hasConflict(e,t){try{const a=await this.getExtensionInfo(e),n=Kn(Array.from(t.keys()).map(o=>({name:o,size:t.get(o).byteLength}))),i=Kn(a.files.map(o=>({name:o.filename,size:o.size})));return!Qa(n,i)}catch{return!1}}async getExtensionSignature(e){try{const a=(await this.fileStorage.listFiles(Ht)).filter(i=>i.startsWith(e+"/"));if(a.length===0)return null;const n=[];for(const i of a){const o=i.split("/").pop();if(o.endsWith(".js")||o.toLowerCase().includes("license"))try{const l=await this.fileStorage.getFileInfo(Ht,i);n.push({name:o,size:l.size})}catch{const l=await this.fileStorage.readFile(Ht,i);n.push({name:o,size:l.byteLength})}}return Kn(n)}catch{return null}}async addToCache(e,t){const n=(await this.fileStorage.listFiles(e)).filter(o=>o.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=new Map;for(const o of n){const l=o.replace(`SOURCE/extensions/${t}/`,""),d=await this.fileStorage.readFile(e,o);i.set(l,d)}await this.cacheExtension(t,i)}async removeFromCache(e){await this.deleteExtension(e)}get cacheWorkspaceId(){return Ht}async importFromCache(e,t){if((await this.fileStorage.listFiles(t)).some(i=>i.startsWith(`SOURCE/extensions/${e}/`)))throw new Error(`Extension '${e}' already exists in workspace`);await this.copyToWorkspace(e,t)}async deleteCachedExtension(e){await this.deleteExtension(e)}async isCached(e){try{return await this.getExtensionInfo(e),!0}catch{return!1}}async compareExtensions(e,t,a){try{const i=(await this.fileStorage.listFiles(e)).filter(c=>c.startsWith(`SOURCE/extensions/${t}/`)),l=(await this.fileStorage.listFiles(Ht)).filter(c=>c.startsWith(`${a}/`));if(i.length!==l.length)return!0;const d=await this.createWorkspaceSignature(e,t,i),f=await this.createCacheSignature(a,l);return!Qa(d,f)}catch{return!0}}async createWorkspaceSignature(e,t,a){const n=[];for(const i of a){const o=i.replace(`SOURCE/extensions/${t}/`,""),l=i.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license")){const d=await this.fileStorage.readFile(e,i);n.push({name:o,size:d.byteLength})}}return Kn(n)}async createCacheSignature(e,t){const a=[];for(const n of t){const i=n.replace(`${e}/`,""),o=n.split("/").pop();if(o.endsWith(".js")||o.toLowerCase().includes("license")){const l=await this.fileStorage.readFile(Ht,n);a.push({name:i,size:l.byteLength})}}return Kn(a)}async getCacheStats(){const e=await this.listCachedExtensions(),t={};for(const a of e)t[a.name]=a.files.length;return{totalExtensions:e.length,totalSize:e.reduce((a,n)=>a+n.totalSize,0),extensionCount:t}}}class Ci{constructor(e){if(this.fileStorage=e,!e)throw new Error("FileStorageAPI is required");this.cache=new hh(e)}cache;get extensionCache(){return this.cache}async importExtension(e,t,a){const n=Za(a);if(!ph(n))throw new Error(`Invalid extension name: '${a}' contains illegal characters`);const i=this.validateExtensionFile(t);if(!i.isValid)throw new Error(i.error);if((await this.listWorkspaceExtensions(e)).some(c=>c.name===n))throw new Error(`Extension '${n}' already exists in workspace`);const l=await t.arrayBuffer(),d=`SOURCE/extensions/${n}/${t.name}`;await this.fileStorage.writeFile(e,d,l);const f=new Map([[t.name,l]]);try{await this.cache.cacheExtension(n,f)}catch{}return{name:n,files:[{filename:t.name,size:t.size,type:i.fileType}],totalSize:t.size,location:"workspace"}}async addFileToExtension(e,t,a){const n=this.validateExtensionFile(a);if(!n.isValid)throw new Error(n.error);if(!(await this.listWorkspaceExtensions(e)).some(f=>f.name===t))throw new Error(`Extension '${t}' does not exist in workspace`);const o=`SOURCE/extensions/${t}/${a.name}`;if(await this.fileStorage.fileExists(e,o))throw new Error(`File '${a.name}' already exists in extension '${t}'`);const d=await a.arrayBuffer();await this.fileStorage.writeFile(e,o,d);try{const f=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,f)}catch{}}async listWorkspaceExtensions(e){try{const a=(await this.fileStorage.listFiles(e)).filter(o=>o.startsWith("SOURCE/extensions/")),n=new Set;for(const o of a){const l=o.split("/");l.length>=3&&n.add(l[2])}const i=[];for(const o of n)try{const l=await this.getWorkspaceExtensionInfo(e,o);i.push(l)}catch{}return i.sort((o,l)=>o.name.localeCompare(l.name))}catch(t){if(t instanceof Error&&t.message.includes("not found"))return[];throw t}}async deleteWorkspaceExtension(e,t){const n=(await this.fileStorage.listFiles(e)).filter(i=>i.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);for(const i of n)await this.fileStorage.deleteFile(e,i)}async getExtensionLicense(e,t){try{const a=`SOURCE/extensions/${t}/LICENSE.txt`,n=await this.fileStorage.readFile(e,a);return new TextDecoder().decode(n)}catch{return""}}async saveExtensionLicense(e,t,a){if(!(await this.listWorkspaceExtensions(e)).some(d=>d.name===t))throw new Error(`Extension '${t}' does not exist in workspace`);const i=`SOURCE/extensions/${t}/LICENSE.txt`,l=new TextEncoder().encode(a);await this.fileStorage.writeFile(e,i,l.buffer)}async listCachedExtensions(){return this.cache.listCachedExtensions()}async importFromCache(e,t){if(!(await this.cache.listCachedExtensions()).some(i=>i.name===t))throw new Error(`Extension '${t}' not found in cache`);if((await this.listWorkspaceExtensions(e)).some(i=>i.name===t))throw new Error(`Extension '${t}' already exists in workspace`);await this.cache.copyToWorkspace(t,e)}async deleteCachedExtension(e){await this.cache.deleteExtension(e)}async cacheExtension(e,t){if(!(await this.fileStorage.listFiles(e)).some(l=>l.startsWith(`SOURCE/extensions/${t}/`)))throw new Error(`Extension '${t}' does not exist in workspace`);const i=await this.cache.getExtensionSignature(t);if(i){const l=await this.getWorkspaceExtensionSignature(e,t);if(Qa(i,l))return;throw new Error(`Extension '${t}' already cached with different content`)}const o=await this.getWorkspaceExtensionFiles(e,t);await this.cache.cacheExtension(t,o)}async scanAndCacheExtensions(e){const t=await this.listWorkspaceExtensions(e),a={successCount:0,totalScanned:t.length,conflicts:[],errors:[]};for(const n of t)try{const i=await this.getWorkspaceExtensionFiles(e,n.name);if(await this.cache.hasConflict(n.name,i)){a.conflicts.push(n.name);continue}await this.cache.cacheExtension(n.name,i),a.successCount++}catch(i){a.errors.push({extensionName:n.name,reason:"storage",message:i instanceof Error?i.message:"Unknown error"})}return a}detectExtensionName(e){return uh(e)}validateExtensionFile(e){return fh(e)}normalizeExtensionName(e){return Za(e)}compareExtensions(e,t){const a=e.name||"unknown",n=t.name||"unknown";if(a!==n||e.totalSize!==t.totalSize||e.files.length!==t.files.length)return!1;const i=e.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name)),o=t.files.slice().sort((l,d)=>(l.filename||l.name).localeCompare(d.filename||d.name));return i.every((l,d)=>{const f=o[d],c=l.filename||l.name,p=f.filename||f.name;return c===p&&l.size===f.size})}sanitizeFilename(e){return e.replace(/\.\.\//g,"").replace(/\.\.\\/g,"").replace(/[<>:"/\\|?*\x00-\x1f]/g,"-").replace(/^\.+/,"").replace(/\.+$/,"").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255)}async getWorkspaceExtensionSignature(e,t){const n=(await this.fileStorage.listFiles(e)).filter(o=>o.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];for(const o of n){const l=o.split("/").pop();if(l.endsWith(".js")||l.toLowerCase().includes("license"))try{const d=await this.fileStorage.getFileInfo(e,o);i.push({name:l,size:d.size})}catch{const d=await this.fileStorage.readFile(e,o);i.push({name:l,size:d.byteLength})}}return Kn(i)}async getWorkspaceExtensionInfo(e,t){const n=(await this.fileStorage.listFiles(e)).filter(l=>l.startsWith(`SOURCE/extensions/${t}/`));if(n.length===0)throw new Error(`Extension '${t}' does not exist in workspace`);const i=[];let o=0;for(const l of n){const d=l.split("/").pop(),c={size:(await this.fileStorage.readFile(e,l)).byteLength};let p;if(d.endsWith(".js"))p="javascript";else if(d.toLowerCase().includes("license"))p="license";else continue;i.push({filename:d,size:c.size,type:p}),o+=c.size}return{name:t,files:i,totalSize:o,location:"workspace"}}async getWorkspaceExtensionFiles(e,t){const n=(await this.fileStorage.listFiles(e)).filter(o=>o.startsWith(`SOURCE/extensions/${t}/`)),i=new Map;for(const o of n){const l=o.split("/").pop(),d=await this.fileStorage.readFile(e,o);i.set(l,d)}return i}async getAvailableTransforms(e){const t=[];try{const a=await this.fileStorage.listFiles(e),n=a.filter(o=>o.startsWith("SOURCE/")&&o.endsWith(".js"));for(const o of n){const l=o.split("/").pop()||"";(l.includes("transform")||l.includes("Transform")||l==="transformText.js"||l==="transformDom.js")&&t.push({path:o,extensionName:`Transform: ${l}`,fileName:l})}const i=a.filter(o=>o.startsWith("SOURCE/extensions/")&&o.endsWith(".js")&&(o.includes("transform")||o.includes("Transform")));for(const o of i){const l=o.split("/"),d=l.pop()||"",f=l[2]||"Unknown Extension";t.push({path:o,extensionName:f,fileName:d})}}catch(a){console.warn("Failed to get available transforms:",a)}return t}}const ea=new Set;let rs=0;function xo(r,e=""){if(ea.has(r))throw new Error(`Editor ID "${r}" is already in use`);ea.add(r);function t(){return rs++,Date.now()+rs*.001}const a=Zt({content:e,isEmpty:e.trim()==="",lastUpdated:t()}),n=[];function i(c){typeof c=="string"&&a.update(p=>({content:c,isEmpty:c.trim()==="",lastUpdated:t()}))}function o(){a.update(c=>({content:"",isEmpty:!0,lastUpdated:t()}))}function l(){let c="";return a.subscribe(h=>{c=h.content})(),c}function d(c){const p=a.subscribe(c);return n.push(p),()=>{p();const h=n.indexOf(p);h>-1&&n.splice(h,1)}}function f(){n.forEach(c=>c()),n.length=0,ea.delete(r)}return{subscribe:d,updateContent:i,reset:o,getContent:l,destroy:f}}function vh(){ea.clear()}var mh=I('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>'),gh=I('<div class="error-state svelte-19lb94x"><span class="error-icon svelte-19lb94x">â ï¸</span> <p> </p></div>'),wh=I('<div class="empty-state svelte-19lb94x"><div class="empty-icon svelte-19lb94x">ð</div> <h3 class="svelte-19lb94x"> </h3> <p class="svelte-19lb94x"> </p></div>'),yh=I('<div data-spine-view="" class="spine-editor-wrapper svelte-19lb94x"><!></div>'),bh=I('<div class="loading-state svelte-19lb94x"><div class="spinner svelte-19lb94x"></div> <p> </p></div>');function _h(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=()=>tt(be,"$transformError",t),o=()=>tt(ce,"$transformWarnings",t),l=()=>tt(_e,"$isTransforming",t),d=()=>tt(Ue,"$executionTime",t);let f=fe(void 0),c=V(e,"workspace",3,null),p=V(e,"workspaceService",3,null),h=V(e,"spineService",3,null),v=V(e,"audioClipService",3,null),g=V(e,"selectedItemId",7,null),b=V(e,"transformEngine",3,null),y=fe(null),L=fe(!1),k=fe(null),E,T,P,$,R,z=fe(!1),O=fe(null),W={text:""},N=[],j=fe(It([])),x=fe(It([])),F=null,q=!1,te=fe(null),M=It({mode:"single",pane1:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""},pane2:{filePath:"",fileHref:"",fileType:"",contentType:null,selectedFileValue:"",content:""}});const Q=Zt(""),ce=Zt([]),be=Zt(null),_e=Zt(!1),Ue=Zt(0);let Ce=fe(null),pe=fe(null),K=new Map,oe=fe(null),ie=fe(null),xe=null;ht(()=>{if(c()?.id&&(xe===null||c().id!==xe)){for(const[C,G]of K)G.destroy();K.clear(),m(oe,null),m(ie,null),vh(),b().setWorkspaceExtensions(c().id).catch(C=>{console.error("Failed to load workspace extensions:",C)})}xe=c()?.id||null});const Me=cn();function Ae(C){Ge(),g()&&Pe()}function He(){}function $e(){return{selectedItemId:g(),selectedItem:s(y)}}function Ye(C){C.selectedItemId&&(g(C.selectedItemId),Pe())}async function Ne(){return!0}async function Ge(){if(!s(z))try{T=Wt.getInstance(),P=new Ci(T),$=new Ti({fileStorage:T,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),R=new er(T,P,da,go),m(z,!0)}catch(C){m(k,C instanceof Error?C.message:"Failed to initialize services",!0),console.error("Failed to initialize spine editor services:",C)}}function Ke(){if(M.mode==="single")m(j,N,!0),m(x,N,!0);else{const C=M.pane1.fileType==="text",G=M.pane2.fileType==="text";m(j,N.filter(X=>!(X.type==="text"&&G)),!0),m(x,N.filter(X=>!(X.type==="text"&&C)),!0)}}async function he(){if(!(!g()||!s(z)))try{const C=[{value:"text",label:"Text Content",path:`SOURCE/text/${g()}.txt`,href:`SOURCE/text/${g()}.txt`,type:"text"}];try{const G=await T.listFiles(c().id,"OEBPS/Styles");for(const X of G)if(X.endsWith(".css")){const we=X.split("/").pop()?.replace(".css","")||X,Re=X.startsWith("OEBPS/")?X.substring(6):X;C.push({value:`css-${we}`,label:`CSS: ${we}`,path:X,href:Re,type:"css"})}}catch{}try{const G=await T.listFiles(c().id,"OEBPS/Scripts");for(const X of G)if(X.endsWith(".js")){const we=X.split("/").pop()?.replace(".js","")||X,Re=X.startsWith("OEBPS/")?X.substring(6):X;C.push({value:`js-${we}`,label:`JS: ${we}`,path:X,href:Re,type:"javascript"})}}catch{}try{const G=await T.listFiles(c().id,"SOURCE/scripts");for(const X of G)if(X.endsWith(".js")){const we=X.split("/").pop()?.replace(".js","")||X;C.push({value:`transform-${we}`,label:`Transform: ${we}`,path:X,href:X,type:"transform"})}}catch{}N=C,Ke()}catch(C){console.error("Failed to load available files:",C),N=[{value:"text",label:"Text Content",path:`SOURCE/text/${g()}.txt`,href:`SOURCE/text/${g()}.txt`,type:"text"}],Ke()}}async function ke(C,G,X){const we=C.path,Re=`file-content-${we.replace(/[^a-zA-Z0-9]/g,"-")}`;let ze="";try{const Ze=await X.readFile(G,we);ze=new TextDecoder().decode(Ze)}catch{}const je=xo(Re,ze);let Qe;return je.subscribe(Ze=>{s(O)&&(clearTimeout(Qe),Qe=setTimeout(async()=>{try{await X.writeFile(G,C.path,Ze.content),C.type==="text"?s(O).updateContent("text",Ze.content):["css","javascript","transform"].includes(C.type)&&(C.href&&$&&$.revokeFileBlob(C.href),s(O).forcePreviewUpdate())}catch(Je){console.error("Auto-save failed:",Je)}},300))}),je}async function Te(C,G,X){try{const we=C.path;if(K.has(we))return K.get(we);const Re=await ke(C,G,X);return K.has(we)?(Re.destroy(),K.get(we)):(K.set(we,Re),Re)}catch(we){return console.error(`Failed to get/create file store for ${C.path}:`,we),null}}async function Oe(){if(!(!g()||!s(z)))try{if(await he(),!s(y)||s(y).id!==g()){console.warn("â ï¸ Spine item synchronization issue:",{selectedItemId:g(),selectedItemActualId:s(y)?.id,selectedItem:s(y)});return}s(O)?await s(O).switchToSpineItem(s(y).idref,s(y)):(m(O,ch(c().id,s(y).idref,T,P,$,p(),R,b(),dh,Xe,Be,s(y)),!0),await s(O).initialize(),await s(O).loadInitialContent()),W=s(O).getCurrentContent(),await se()}catch(C){m(k,C instanceof Error?C.message:"Failed to initialize spine editor",!0),console.error("Failed to initialize spine editor:",C)}}async function se(){if(N.length===0)return;const C=Mt.getViewData("spine");if(C&&(C.pane1||C.pane2))await Fe(C);else{const G=N.find(X=>X.type==="text");if(G){const X=Ee(G.type);M.mode="single",M.pane1={filePath:G.path,fileHref:G.href,fileType:G.type,contentType:X,selectedFileValue:G.value,content:""},console.warn("restoreOrInitializePaneContent bypassed loadFileIntoPane for text content"),Se()}}s(O)&&await s(O).forcePreviewUpdate()}function Ee(C){return C==="text"?"text":null}function ve(C){return C==="text"}async function We(C){const{pane:G,filePath:X,fileType:we}=C.detail,Re=N.find(ot=>ot.path===X);if(!Re)return;const ze=Re.href,je=Re.value,Qe=`pane${G}`,Ze=Ee(we);M[Qe]={filePath:X,fileHref:ze,fileType:we,contentType:Ze,selectedFileValue:je,content:""},m(G===1?Ce:pe,null),G===2&&M.mode==="single"&&(M.mode="dual"),Se();const Je=await Te(Re,c().id,p());Je?m(G===1?oe:ie,Je,!0):console.error("â Failed to create file store for:",X),Ke()}function Ve(C){if(!C||C.trim()==="")return null;try{return new Function(C),null}catch(G){return G instanceof SyntaxError?`JavaScript syntax error: ${G.message}`:`JavaScript validation error: ${G instanceof Error?G.message:String(G)}`}}function B(C){const{pane:G,content:X}=C.detail,we=`pane${G}`;M[we].content=X;const{contentType:Re,filePath:ze,fileHref:je,fileType:Qe}=M[we];if((Qe.includes("javascript")||Qe.includes("js")||Qe==="transform")&&X.trim()){const Ze=Ve(X);if(Ze){m(G===1?Ce:pe,Ze,!0);return}else m(G===1?Ce:pe,null)}else m(G===1?Ce:pe,null);Re&&s(O)&&(W[Re]=X,s(O).updateContent(Re,X)),ze&&ue(ze,je,X)}async function H(){const C=M.mode==="single"?"dual":"single";if(C==="dual"){let G=null;if(M.pane1.fileType==="text"&&M.pane2.fileType==="text"?(G=N.find(X=>X.type!=="text"),console.log("ð Text conflict resolved: moving pane 2 from text to",G?.label||"empty")):(!M.pane2.selectedFileValue||M.pane2.selectedFileValue==="")&&(G=N[0]),G){M.pane2={selectedFileValue:G.value,filePath:G.path,fileType:G.type,fileHref:G.href,contentType:"text",content:""};try{const X=await Te(G,c().id,p());X&&m(ie,X,!0)}catch(X){console.error("Failed to create store for pane 2 default selection:",X)}}}M.mode=C,Se(),Ke()}let Z=new Map;function ue(C,G,X){const we=Z.get(C);we&&clearTimeout(we);const Re=setTimeout(async()=>{try{if(!ye(C,X))return;await T.writeTextFile(c().id,C,X),$&&(C.includes("/Styles/")||C.includes("/Scripts/"))&&($.revokeFileBlob(G),s(O)&&s(O).forcePreviewUpdate())}catch{}finally{Z.delete(C)}},500);Z.set(C,Re)}function ye(C,G){if(C.includes("SOURCE/text/")&&g()){const X=`SOURCE/text/${g()}.txt`;if(C!==X)return!1;if(G.includes("chapter")||G.includes("Chapter")){const we=C.match(/chapter(\d+)/)?.[1];if(we&&G.toLowerCase().includes("chapter")&&!G.toLowerCase().includes(`chapter ${we}`)&&!G.toLowerCase().includes(`chapter${we}`))return!1}}return!0}function Se(){const C={pane1:M.pane1.fileType?{fileType:M.pane1.fileType,selectedFile:M.pane1.filePath}:null,pane2:M.pane2.fileType?{fileType:M.pane2.fileType,selectedFile:M.pane2.filePath}:null,mode:M.mode};Mt.setViewData("spine",C)}async function Fe(C){M.mode=C.mode,C.pane1&&await Ie(1,C.pane1),C.pane2&&await Ie(2,C.pane2)}async function Ie(C,G){const{fileType:X,selectedFile:we,content:Re}=G;let ze;if(X==="text"?ze=N.find(je=>je.type==="text"):we?(ze=N.find(je=>je.path===we),ze||(ze=N.find(je=>je.type===X))):ze=N.find(je=>je.type===X),ze){const je=Ee(ze.type),Qe=`pane${C}`;M[Qe]={filePath:ze.path,fileHref:ze.href,fileType:ze.type,contentType:je,selectedFileValue:ze.value,content:""};const Ze=await Te(ze,c().id,p());Ze?m(C===1?oe:ie,Ze,!0):console.error("â Pane restoration failed - could not create store for:",ze.path)}}function Xe(C){Q.set(C.xhtml),ce.set(C.warnings),be.set(null),_e.set(!1),Ue.set(C.executionTime),Me("previewUpdate",{xhtmlContent:C.xhtml,isTransforming:!1,transformError:null,transformWarnings:C.warnings,executionTime:C.executionTime,spineItemId:g()})}function Be(C){be.set(C.error),_e.set(!1),Me("previewUpdate",{xhtmlContent:"",isTransforming:!1,transformError:C.error,transformWarnings:[],executionTime:0,spineItemId:g()})}async function le(){if(s(O)){_e.set(!0);try{await s(O).forcePreviewUpdate()}catch(C){Be({error:{stage:"manual-update",message:C instanceof Error?C.message:"Manual update failed"}})}}}function ae(C){console.log("handlePreviewClick",C.detail.text),s(te)&&typeof s(te).findAndSelectText=="function"&&s(te).findAndSelectText(C.detail)}ht(()=>{if(!s(f))return;const C=G=>{ae(G)};return s(f).addEventListener("preview-click",C),()=>{s(f)&&s(f).removeEventListener("preview-click",C)}});let me=null;async function Pe(){if(!(!g()||!h())&&!q){if(me)try{await me}catch{}q=!0,me=qe();try{await me}finally{me=null,q=!1}}}async function qe(){m(L,!0),m(k,null);try{const G=(await h().loadSpineItems(c())).find(ze=>ze.id===g())||null,X=s(y)?.id,we=G?.id,Re=X&&we&&X!==we;m(y,G,!0),s(y)&&s(z)&&(Re?await Le():await Oe())}catch(C){m(k,C instanceof Error?C.message:"Failed to load spine item",!0)}finally{m(L,!1)}}async function Le(){try{await he(),await re(),await Oe()}catch(C){m(k,C instanceof Error?C.message:"Failed to switch spine item",!0)}}async function re(){for(const[C,G]of Z)clearTimeout(G);if(Z.clear(),JSON.parse(JSON.stringify(M)),M.pane1.fileType&&ve(M.pane1.fileType)){M.pane1.filePath;const C=`SOURCE/text/${g()}.txt`;M.pane1.filePath=C,M.pane1.fileHref=C}if(M.pane2.fileType&&ve(M.pane2.fileType)){M.pane2.filePath;const C=`SOURCE/text/${g()}.txt`;M.pane2.filePath=C,M.pane2.fileHref=C}}rn(()=>{E=Mt.addNavigationGuard(Ne),Ae()}),ur(()=>{for(const[C,G]of K)G.destroy();K.clear(),E&&Mt.removeNavigationGuard(E)}),ht(()=>{g()!==F&&(F=g(),c()&&h()&&(s(z)||Ge(),g()?Pe():(m(y,null),m(k,null),m(O,null))))});var Y=pt(),ge=et(Y);{var ee=C=>{var G=mh(),X=w(u(G),2),we=u(X);D(Re=>S(we,Re),[()=>n()("Loading spine item...")]),_(C,G)},A=(C,G)=>{{var X=Re=>{var ze=gh(),je=w(u(ze),2),Qe=u(je);D(()=>S(Qe,s(k))),_(Re,ze)},we=(Re,ze)=>{{var je=Ze=>{var Je=wh(),ot=w(u(Je),2),gt=u(ot),ut=w(ot,2),lt=u(ut);D((xt,ft)=>{S(gt,xt),S(lt,ft)},[()=>n()("No spine item selected"),()=>n()("Select a spine item from the sidebar to start editing")]),_(Ze,Je)},Qe=(Ze,Je)=>{{var ot=ut=>{var lt=yh(),xt=u(lt);Ut(oh(xt,{get availableFiles1(){return s(j)},get availableFiles2(){return s(x)},get transformError(){return i()},get transformWarnings(){return o()},get isTransforming(){return l()},get executionTime(){return d()},get editorMode(){return M.mode},get pane1SelectedFile(){return M.pane1.selectedFileValue},get pane2SelectedFile(){return M.pane2.selectedFileValue},get pane1FileStore(){return s(oe)},get pane2FileStore(){return s(ie)},get contentService(){return e.contentService},onPaneToggle:()=>H(),onFileSelect:(ft,Ot,fr)=>We({detail:{pane:ft,filePath:Ot,fileType:fr}}),onContentChange:(ft,Ot)=>B({detail:{pane:ft,content:Ot}}),onForceUpdate:()=>le(),get workspace(){return c()},get audioClipService(){return v()},get workspaceService(){return p()},get settingsService(){return R},get pane1Error(){return s(Ce)},set pane1Error(ft){m(Ce,ft,!0)},get pane2Error(){return s(pe)},set pane2Error(ft){m(pe,ft,!0)}}),ft=>m(te,ft,!0),()=>s(te)),Ut(lt,ft=>m(f,ft),()=>s(f)),_(ut,lt)},gt=ut=>{var lt=bh(),xt=w(u(lt),2),ft=u(xt);D(Ot=>S(ft,Ot),[()=>n()("Initializing editor...")]),_(ut,lt)};U(Ze,ut=>{s(y)&&s(z)&&s(O)?ut(ot):ut(gt,!1)},Je)}};U(Re,Ze=>{g()?Ze(Qe,!1):Ze(je)},ze)}};U(C,Re=>{s(k)?Re(X):Re(we,!1)},G)}};U(ge,C=>{s(L)?C(ee):C(A,!1)})}_(r,Y);var J=at({onViewEnter:Ae,onViewLeave:He,getViewData:$e,setViewData:Ye,canLeave:Ne,handlePreviewClick:ae});return a(),J}function xh(r,e){m(e,!s(e))}var Sh=I('<div class="license-preview svelte-1ksqegs"><span class="license-preview-text svelte-1ksqegs"> </span></div>'),Eh=I('<div class="license-section svelte-1ksqegs"><textarea class="license-textarea svelte-1ksqegs"></textarea></div>'),kh=I('<li class="extension-item svelte-1ksqegs"><div class="extension-header svelte-1ksqegs"><span class="extension-name svelte-1ksqegs"> </span> <div class="extension-actions svelte-1ksqegs"><button type="button" class="license-button svelte-1ksqegs"> </button> <button type="button" class="remove-button svelte-1ksqegs"> </button></div></div> <!> <!></li>');function Th(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=fe(!1),o=fe(""),l=fe(!1);const d=ne(()=>{if(!s(o)||!s(o).trim())return"";const W=s(o).split(`
`)[0].trim();return W.length>60?W.substring(0,57)+"...":W});let f=null;ht(()=>{e.workspaceId&&e.extension.name&&c()});async function c(){try{m(l,!0),m(o,await e.extensionManager.getExtensionLicense(e.workspaceId,e.extension.name),!0)}catch(W){console.error("Failed to load license text:",W),m(o,"")}finally{m(l,!1)}}function p(){e.isAdvancedMode&&(f&&clearTimeout(f),f=setTimeout(()=>{h()},500))}async function h(){try{await e.extensionManager.saveExtensionLicense(e.workspaceId,e.extension.name,s(o))}catch(W){console.error("Failed to save license text:",W)}}ht(()=>()=>{f&&clearTimeout(f)});var v=kh(),g=u(v),b=u(g),y=u(b),L=w(b,2),k=u(L);k.__click=[xh,i];var E=u(k),T=w(k,2);T.__click=function(...W){e.onRemove?.apply(this,W)};var P=u(T),$=w(g,2);{var R=W=>{var N=Sh(),j=u(N),x=u(j);D(()=>S(x,s(d))),_(W,N)};U($,W=>{s(d)&&W(R)})}var z=w($,2);{var O=W=>{var N=Eh(),j=u(N);j.__input=p,D(x=>{de(j,"placeholder",x),j.readOnly=!e.isAdvancedMode,j.disabled=s(l)},[()=>n()("Paste {name} license text here",{name:e.extension.name})]),Tr(j,()=>s(o),x=>m(o,x)),_(W,N)};U(z,W=>{s(i)&&W(O)})}D((W,N)=>{S(y,e.extension.name),k.disabled=s(l),S(E,W),T.disabled=!e.isAdvancedMode,S(P,N)},[()=>n()("License"),()=>n()("Remove")]),_(r,v),at(),a()}_t(["click","input"]);async function Ch(r,e,t,a,n){if(!e.workspaceId||!s(t))return;const o=r.target.checked,l={...s(t),editor:{preview_delay_ms:s(t).editor?.preview_delay_ms??500,advanced_mode:o}};m(t,l,!0);try{await e.settingsService.saveWorkspaceSettings(e.workspaceId,l),e.onSettingsChanged?.()}catch(d){m(a,d instanceof Error?d.message:n()("Failed to save settings"),!0),m(t,{...s(t),editor:{preview_delay_ms:s(t).editor?.preview_delay_ms??500,advanced_mode:!o}},!0)}}var Ih=I('<p class="no-workspace-message svelte-zk358"> </p>'),Fh=I('<p class="loading-message svelte-zk358"> </p>'),Mh=I('<div class="error-message svelte-zk358" role="alert"><strong> </strong> </div>'),Ph=I('<section class="epub-settings svelte-zk358"><h2 class="svelte-zk358"> </h2> <div class="setting-group svelte-zk358"><label for="audio-clip-template" class="setting-label-text svelte-zk358"> </label> <input id="audio-clip-template" type="text" class="template-input svelte-zk358" placeholder=":clip[label]{src=href begin=begin end=end}"/> <p class="setting-description svelte-zk358">Template for inserting audio clip directives. Use placeholders: &lt;href&gt;, &lt;begin&gt;, &lt;end&gt;, &lt;label&gt;, &lt;rate&gt;</p></div></section>'),Lh=I('<p class="advanced-mode-note svelte-zk358"> </p>'),Rh=I("<p> </p>"),Dh=I("<p> </p>"),Ah=I('<ul class="extensions-list svelte-zk358"></ul>'),Oh=I('<div class="settings-content svelte-zk358"><section class="workspace-settings svelte-zk358"><h2 class="svelte-zk358"> </h2> <div class="setting-group svelte-zk358"><label class="setting-label svelte-zk358"><input type="checkbox" class="svelte-zk358"/> <span class="setting-text svelte-zk358"> </span></label> <p class="setting-description svelte-zk358"> </p></div></section> <!> <section class="extensions-settings svelte-zk358"><h2 class="svelte-zk358"> </h2> <div><label for="extension-file" class="svelte-zk358"> </label> <input id="extension-file" type="file" accept=".js" class="svelte-zk358"/> <!></div> <!></section></div>'),Uh=I('<div class="settings-view svelte-zk358"><div class="settings-header svelte-zk358"><h1 class="svelte-zk358"> </h1> <!></div> <!> <!></div>');function zh(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=fe(null),o=fe(null),l=fe(!1),d=fe(!1),f=fe(null),c=fe(It([])),p=fe(!1);ht(()=>{if(!e.workspaceId||!e.settingsService)return;const x=async()=>{m(l,!0),m(f,null);try{m(i,await e.settingsService.loadWorkspaceSettings(e.workspaceId),!0)}catch(q){m(f,q instanceof Error?q.message:n()("Failed to load settings"),!0),m(i,e.settingsService.getDefaultWorkspaceSettings(),!0)}finally{m(l,!1)}},F=async()=>{m(d,!0);try{m(o,await e.settingsService.loadEPUBSettings(e.workspaceId),!0)}catch(q){console.error("Failed to load EPUB settings:",q),m(o,e.settingsService.getDefaultEPUBSettings(),!0)}finally{m(d,!1)}};x(),F()}),ht(()=>{if(!e.workspaceId)return;(async()=>{m(p,!0);try{m(c,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0)}catch(F){console.error("Failed to load extensions:",F),m(c,[],!0)}finally{m(p,!1)}})()});async function h(x){if(!s(b))return;const F=x.target,q=F.files?.[0];if(!(!q||!e.workspaceId))try{const te=e.extensionManager.detectExtensionName(q.name);await e.extensionManager.importExtension(e.workspaceId,q,te),m(c,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId),F.value=""}catch(te){console.error("Failed to import extension:",te),m(f,te instanceof Error?te.message:n()("Failed to import extension"),!0)}}async function v(x){if(!e.workspaceId||!s(o))return;const q=x.target.value,te=e.settingsService.validateEPUBSettings({audio_clip_template:q});if(!te.isValid){m(f,te.errors[0]||"Invalid template format",!0);return}const M={...s(o),audio_clip_template:q};m(o,M,!0);try{await e.settingsService.saveEPUBSettings(e.workspaceId,M),e.onSettingsChanged?.()}catch(Q){m(f,Q instanceof Error?Q.message:n()("Failed to save EPUB settings"),!0),m(o,{...s(o),audio_clip_template:s(o).audio_clip_template},!0)}}async function g(x){if(e.workspaceId)try{await e.extensionManager.deleteWorkspaceExtension(e.workspaceId,x),m(c,await e.extensionManager.listWorkspaceExtensions(e.workspaceId),!0),await e.transformEngine.setWorkspaceExtensions(e.workspaceId)}catch(F){console.error("Failed to remove extension:",F),m(f,F instanceof Error?F.message:n()("Failed to remove extension"),!0)}}const b=ne(()=>s(i)?.editor?.advanced_mode??!1),y=ne(()=>e.workspaceId!==null&&s(i)!==null),L=ne(()=>e.workspaceId!==null&&s(o)!==null);var k=Uh(),E=u(k),T=u(E),P=u(T),$=w(T,2);{var R=x=>{var F=Ih(),q=u(F);D(te=>S(q,te),[()=>n()("Please select a workspace to configure settings.")]),_(x,F)},z=(x,F)=>{{var q=te=>{var M=Fh(),Q=u(M);D(ce=>S(Q,ce),[()=>n()("Loading settings...")]),_(te,M)};U(x,te=>{s(l)&&te(q)},F)}};U($,x=>{e.workspaceId?x(z,!1):x(R)})}var O=w(E,2);{var W=x=>{var F=Mh(),q=u(F),te=u(q),M=w(q);D(Q=>{S(te,`${Q??""}:`),S(M,` ${s(f)??""}`)},[()=>n()("Error")]),_(x,F)};U(O,x=>{s(f)&&x(W)})}var N=w(O,2);{var j=x=>{var F=Oh(),q=u(F),te=u(q),M=u(te),Q=w(te,2),ce=u(Q),be=u(ce);be.__change=[Ch,e,i,f,n];var _e=w(be,2),Ue=u(_e),Ce=w(ce,2),pe=u(Ce),K=w(q,2);{var oe=Oe=>{var se=Ph(),Ee=u(se),ve=u(Ee),We=w(Ee,2),Ve=u(We),B=u(Ve),H=w(Ve,2);D((Z,ue)=>{S(ve,Z),S(B,ue),Qt(H,s(o)?.audio_clip_template||""),H.disabled=s(d)},[()=>n()("EPUB Settings"),()=>n()("Audio Clip Template")]),nt("blur",H,v),_(Oe,se)};U(K,Oe=>{s(L)&&s(b)&&Oe(oe)})}var ie=w(K,2),xe=u(ie),Me=u(xe),Ae=w(xe,2);let He;var $e=u(Ae),Ye=u($e),Ne=w($e,2);Ne.__change=h;var Ge=w(Ne,2);{var Ke=Oe=>{var se=Lh(),Ee=u(se);D(ve=>S(Ee,ve),[()=>n()("Advanced Mode required for extension management")]),_(Oe,se)};U(Ge,Oe=>{s(b)||Oe(Ke)})}var he=w(Ae,2);{var ke=Oe=>{var se=Rh(),Ee=u(se);D(ve=>S(Ee,ve),[()=>n()("Loading extensions...")]),_(Oe,se)},Te=(Oe,se)=>{{var Ee=We=>{var Ve=Dh(),B=u(Ve);D(H=>S(B,H),[()=>n()("No extensions installed.")]),_(We,Ve)},ve=We=>{var Ve=Ah();Ct(Ve,21,()=>s(c),Pt,(B,H)=>{var Z=pt(),ue=et(Z);{var ye=Se=>{Th(Se,{get extension(){return s(H)},get workspaceId(){return e.workspaceId},get isAdvancedMode(){return s(b)},get extensionManager(){return e.extensionManager},onRemove:()=>g(s(H).name)})};U(ue,Se=>{e.workspaceId&&Se(ye)})}_(B,Z)}),_(We,Ve)};U(Oe,We=>{s(c).length===0?We(Ee):We(ve,!1)},se)}};U(he,Oe=>{s(p)?Oe(ke):Oe(Te,!1)})}D((Oe,se,Ee,ve,We,Ve,B)=>{S(M,Oe),Ys(be,s(b)),be.disabled=s(l),S(Ue,se),S(pe,Ee),S(Me,ve),He=ct(Ae,1,"extension-import svelte-zk358",null,He,We),S(Ye,`${Ve??""}: ${B??""}`),Ne.disabled=s(p)},[()=>n()("Project Settings"),()=>n()("Advanced Mode"),()=>n()("Enable advanced editing features and additional controls for power users."),()=>n()("Extensions"),()=>({disabled:!s(b)}),()=>n()("Import JavaScript Extension"),()=>n()("Please copy license text into the License field below to comply with open source requirements.")]),_(x,F)};U(N,x=>{s(y)&&x(j)})}D(x=>S(P,x),[()=>n()("Settings")]),_(r,k),at(),a()}_t(["change"]);function Wh(r,e){(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e.onSelect())}var Nh=I('<div><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M2 5h12v1H2zm0 5h12v1H2z"></path></svg></div>'),jh=(r,e)=>{r.stopPropagation(),e.onRenameId()},Bh=(r,e)=>{r.stopPropagation(),e.onDelete()},Hh=(r,e)=>{r.stopPropagation(),e.onMoveUp()},Vh=(r,e)=>{r.stopPropagation(),e(r)},qh=(r,e)=>{r.stopPropagation(),e.onMoveDown()},$h=(r,e)=>{r.stopPropagation(),e(r)},Gh=I('<div class="move-buttons svelte-1b48bnl" aria-label="Item controls"><button class="move-button svelte-1b48bnl">â</button> <button class="move-button delete-button svelte-1b48bnl">â</button> <button class="move-button svelte-1b48bnl">â</button> <button class="move-button svelte-1b48bnl">â</button></div>'),Xh=I('<span class="error-indicator svelte-1b48bnl" aria-label="Validation error">â ï¸</span>'),Kh=I('<div role="button" tabindex="0"><!> <span class="chapter-id svelte-1b48bnl"> </span> <!> <!></div>');function Yh(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);V(e,"index",3,0);let i=V(e,"isSelected",3,!1),o=V(e,"isExpanded",3,!0),l=V(e,"compact",3,!1),d=V(e,"dragHandleProps",19,()=>({})),f=V(e,"isFirstItem",3,!1),c=V(e,"isLastItem",3,!1);async function p(W){if(W.key==="Enter"||W.key===" "){W.preventDefault(),await e.onMoveUp();const N=document.querySelector(`[aria-label="Move ${e.item.id} up"]`);N&&N.focus()}}async function h(W){if(W.key==="Enter"||W.key===" "){W.preventDefault(),await e.onMoveDown();const N=document.querySelector(`[aria-label="Move ${e.item.id} down"]`);if(N&&!N.disabled)N.focus();else{const j=document.querySelector(`[aria-label="Move ${e.item.id} up"]`);j&&j.focus()}}}const v=ne(()=>i()&&!l());function g(W){const N=W.match(/^(\w+)[-_]?(\d+)$/i);if(N){const[,F,q]=N;return F.charAt(0).toUpperCase()+q}const j=W.split(/[\s\-_]+/).filter(F=>F.length>0);if(j.length>1)return j.map(F=>F.charAt(0).toUpperCase()).join("");const x=W.trim();return x.length<=3?x.toUpperCase():x.length<=6?x.slice(0,3):x.slice(0,2)}const b=ne(()=>l()?g(e.item.id):e.item.id);var y=Kh();let L;y.__click=function(...W){e.onSelect?.apply(this,W)},y.__keydown=[Wh,e];var k=u(y);{var E=W=>{var N=Nh();Ea(N,()=>({class:"drag-handle",...d(),tabindex:"-1","aria-hidden":"true"}),void 0,"svelte-1b48bnl"),_(W,N)};U(k,W=>{!l()&&o()&&W(E)})}var T=w(k,2),P=u(T),$=w(T,2);{var R=W=>{var N=Gh(),j=u(N);j.__click=[jh,e];var x=w(j,2);x.__click=[Bh,e];var F=w(x,2);F.__click=[Hh,e],F.__keydown=[Vh,p];var q=w(F,2);q.__click=[qh,e],q.__keydown=[$h,h],D((te,M,Q,ce)=>{de(j,"aria-label",te),de(j,"title",M),de(x,"aria-label",Q),de(x,"title",ce),F.disabled=f(),de(F,"aria-label",`Move ${e.item.id} up`),de(F,"title",`Move ${e.item.id} up`),q.disabled=c(),de(q,"aria-label",`Move ${e.item.id} down`),de(q,"title",`Move ${e.item.id} down`)},[()=>n()("Rename {item}",{item:e.item.id}),()=>n()("Rename {item}",{item:e.item.id}),()=>n()("Delete chapter {name}",{name:e.item.id}),()=>n()("Delete chapter {name}",{name:e.item.id})]),_(W,N)};U($,W=>{s(v)&&W(R)})}var z=w($,2);{var O=W=>{var N=Xh();_(W,N)};U(z,W=>{!l()&&(!e.item.hasSourceFile||!e.item.linear)&&W(O)})}D(W=>{L=ct(y,1,"spine-item svelte-1b48bnl",null,L,W),de(y,"aria-pressed",i()),de(y,"aria-label",`${e.item.id}${e.item.hasSourceFile?"":", has validation error"}`),S(P,s(b))},[()=>({compact:l(),selected:i(),"has-error":e.item.hasSourceFile===!1||!e.item.linear})]),_(r,y),at(),a()}_t(["click","keydown"]);var Jh=I('<div class="loading svelte-d0f7cr"><p> </p></div>'),Zh=I('<div class="error svelte-d0f7cr"><p> </p> <button class="retry-button svelte-d0f7cr"> </button></div>'),Qh=I('<div class="spine-item-wrapper svelte-d0f7cr" role="listitem"><!></div>'),ev=I('<div class="spine-list svelte-d0f7cr" role="list"></div>'),tv=I('<div class="empty-state svelte-d0f7cr"><p> </p> <button class="retry-button svelte-d0f7cr"> </button></div>'),nv=I('<div class="empty-state svelte-d0f7cr"><p> </p></div>'),rv=I('<div class="spine-sidebar svelte-d0f7cr"><!></div>');function av(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=st(),o=st();let l=V(e,"workspace",12,null),d=V(e,"spineService",8),f=V(e,"selectedItemId",8,null),c=V(e,"isExpanded",8,!0),p=V(e,"onWorkspaceUpdate",8,null),h=st([]),v=st(!0),g=st(null),b=!1;rn(()=>{const M=()=>{E()};return window.addEventListener("append-spine-item",M),()=>{window.removeEventListener("append-spine-item",M)}});async function y(){l()&&d()&&await L()}async function L(){if(l()){m(v,!0),m(g,null);try{const M=await d().loadSpineItems(l());m(h,M)}catch(M){console.error("â SpineSidebar: Error loading spine items:",M),m(g,M instanceof Error?M.message:"Failed to load spine items"),m(h,[])}finally{m(v,!1)}}}function k(M){const Q=new CustomEvent("select-spine-item",{detail:{itemId:M},bubbles:!0});window.dispatchEvent(Q)}async function E(){if(l())try{m(v,!0);const M=await d().addChapter(l(),{title:"New Chapter",linear:!0,createSourceFile:!0});l(M.updatedWorkspace),p()&&p()(l()),await L(),k(M.newChapter.id)}catch(M){m(g,M instanceof Error?M.message:"Failed to create chapter")}finally{m(v,!1)}}async function T(M){if(!(b||M===0||!l())){b=!0;try{const Q=await d().moveChapterUp(l(),M);l(Q.updatedWorkspace),p()&&p()(l()),m(h,Q.newOrder),$(s(h)[M-1].id,M,M-1)}catch{await L()}finally{b=!1}}}async function P(M){if(!(b||M===s(h).length-1||!l())){b=!0;try{const Q=await d().moveChapterDown(l(),M);l(Q.updatedWorkspace),p()&&p()(l()),m(h,Q.newOrder),$(s(h)[M+1].id,M,M+1)}catch{await L()}finally{b=!1}}}function $(M,Q,ce){const be=`${M} moved from position ${Q+1} to position ${ce+1}`,_e=document.createElement("div");_e.setAttribute("role","status"),_e.setAttribute("aria-live","polite"),_e.style.position="absolute",_e.style.left="-10000px",_e.textContent=be,document.body.appendChild(_e),setTimeout(()=>_e.remove(),1e3)}function R(M,Q){s(i)&&(M.dataTransfer.effectAllowed="move",M.dataTransfer.setData("text/plain",Q.toString()))}function z(M){s(i)&&(M.preventDefault(),M.dataTransfer.dropEffect="move")}async function O(M,Q){if(!s(i)||b)return;M.preventDefault();const ce=parseInt(M.dataTransfer.getData("text/plain"),10);if(ce!==Q&&l()){b=!0;try{const be=await d().reorderItems(l(),ce,Q);l(be.updatedWorkspace),p()&&p()(l()),m(h,be.newOrder),$(s(h)[Q].id,ce,Q)}catch{await L()}finally{b=!1}}}async function W(M){if(!(!l()||!window.confirm(n()("Are you sure you want to delete chapter '{name}'? This will permanently delete the chapter and its source file.",{name:M}))))try{m(v,!0);const ce=await d().deleteChapter(l(),M);if(l(ce.updatedWorkspace),p()&&p()(l()),f()===M){const be=new CustomEvent("select-spine-item",{detail:{itemId:null},bubbles:!0});window.dispatchEvent(be)}m(h,await d().loadSpineItems(l()))}catch(ce){console.error("Failed to delete chapter:",ce)}finally{m(v,!1)}}async function N(M){if(!l())return;const Q=window.prompt(n()("Enter new ID for {item}:",{item:M}),M);if(!(!Q||Q===M))try{m(v,!0);const ce=await d().renameChapterId(l(),M,Q);l(ce.updatedWorkspace),p()&&p()(l()),await L(),k(Q)}catch(ce){console.error("Failed to rename chapter ID:",ce),alert(n()("Failed to rename chapter ID: {error}",{error:ce instanceof Error?ce.message:"Unknown error"}))}finally{m(v,!1)}}Rt(()=>Lt(c()),()=>{m(i,c())}),Rt(()=>Lt(l()),()=>{m(o,l()?.id)}),Rt(()=>(s(o),Lt(d()),Lt(l())),()=>{s(o)&&d()?L():l()||(m(h,[]),m(v,!1),m(g,null))}),xn(),Bt();var j=rv(),x=u(j);{var F=M=>{var Q=Jh(),ce=u(Q),be=u(ce);D(_e=>S(be,_e),[()=>n()("Loading spine itemsâ¦")],De),_(M,Q)},q=(M,Q)=>{{var ce=_e=>{var Ue=Zh(),Ce=u(Ue),pe=u(Ce),K=w(Ce,2);K.__click=L;var oe=u(K);D(ie=>{S(pe,s(g)),S(oe,ie)},[()=>n()("Retry")],De),_(_e,Ue)},be=(_e,Ue)=>{{var Ce=K=>{var oe=ev();Ct(oe,7,()=>s(h),ie=>ie.id,(ie,xe,Me)=>{var Ae=Qh(),He=u(Ae);const $e=De(()=>f()===s(xe).id),Ye=De(()=>!c()),Ne=De(()=>s(Me)===0),Ge=De(()=>s(Me)===s(h).length-1);Yh(He,{get item(){return s(xe)},get index(){return s(Me)},get isSelected(){return s($e)},get isExpanded(){return s(i)},get compact(){return s(Ye)},get isFirstItem(){return s(Ne)},get isLastItem(){return s(Ge)},onSelect:()=>k(s(xe).id),onMoveUp:async()=>await T(s(Me)),onMoveDown:async()=>await P(s(Me)),onRenameId:async()=>await N(s(xe).id),onDelete:async()=>await W(s(xe).id),dragHandleProps:{draggable:!0,"data-drag-handle":!0}}),D(()=>de(Ae,"draggable",s(i))),nt("dragstart",Ae,Ke=>R(Ke,s(Me))),nt("dragover",Ae,z),nt("drop",Ae,Ke=>O(Ke,s(Me))),_(ie,Ae)}),_(K,oe)},pe=(K,oe)=>{{var ie=Me=>{var Ae=tv(),He=u(Ae),$e=u(He),Ye=w(He,2);Ye.__click=L;var Ne=u(Ye);D((Ge,Ke)=>{S($e,Ge),S(Ne,Ke)},[()=>n()("No spine items yet"),()=>n()("Refresh")],De),_(Me,Ae)},xe=Me=>{var Ae=nv(),He=u(Ae),$e=u(He);D(Ye=>S($e,Ye),[()=>n()("No project selected")],De),_(Me,Ae)};U(K,Me=>{l()&&!s(v)?Me(ie):Me(xe,!1)},oe)}};U(_e,K=>{s(h).length>0?K(Ce):K(pe,!1)},Ue)}};U(M,_e=>{s(g)?_e(ce):_e(be,!1)},Q)}};U(x,M=>{s(v)?M(F):M(q,!1)})}_(r,j),$n(e,"refreshSpineItems",y);var te=at({refreshSpineItems:y});return a(),te}_t(["click"]);const iv=(r,e)=>{const t=r.target;m(e,t.value)},sv=(r,e)=>{s(e)?.click()},ov=(r,e)=>{e("itemCreate",{mode:"create-text"})},lv=(r,e,t,a)=>{e()&&t()==="manifest"&&a("itemEdit",{item:e()})},cv=(r,e)=>{m(e,"")};var dv=I('<button type="button" class="clear-filter-button svelte-8hsxjr">Ã</button>'),uv=I('<div class="drag-overlay svelte-8hsxjr"><div class="drag-message svelte-8hsxjr"><p class="svelte-8hsxjr"> </p></div></div>'),fv=I('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),pv=I('<p class="svelte-8hsxjr"> </p> <p class="empty-state-subtitle svelte-8hsxjr"> </p>',1),hv=I('<div class="empty-state svelte-8hsxjr"><!></div>'),vv=(r,e)=>e("id"),mv=(r,e)=>e("href"),gv=(r,e)=>e("size"),wv=I('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr"> </span></div></td></tr>'),yv=I('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Source Files</span></div></td></tr>'),bv=I('<tr class="source-separator svelte-8hsxjr"><td colspan="4" class="separator-cell svelte-8hsxjr"><div class="separator-content svelte-8hsxjr"><span class="separator-label svelte-8hsxjr">Package Files</span></div></td></tr>'),_v=(r,e,t,a)=>e(s(t),s(a)),xv=(r,e,t,a)=>e(r,s(t),s(a)),Sv=I('<span class="property-tag svelte-8hsxjr"> </span>'),Ev=I('<div class="properties-list svelte-8hsxjr"></div>'),kv=I('<!> <!> <!> <tr tabindex="0"><td class="id-cell svelte-8hsxjr"><span class="item-id svelte-8hsxjr" dir="ltr"> </span></td><td class="href-cell svelte-8hsxjr"><span class="item-href svelte-8hsxjr" dir="ltr"> </span></td><td class="size-cell svelte-8hsxjr"> </td><td class="properties-cell svelte-8hsxjr"><!></td><!></tr>',1),Tv=I('<table class="manifest-table svelte-8hsxjr"><thead><tr><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"><button type="button" class="sort-button svelte-8hsxjr"> </button></th><th scope="col" class="svelte-8hsxjr"> </th></tr></thead><tbody></tbody></table>'),Cv=I('<div class="manifest-table-container svelte-8hsxjr"><div role="toolbar" tabindex="0"><div class="filter-section svelte-8hsxjr"><label for="manifest-filter" class="filter-label svelte-8hsxjr"> </label> <div class="filter-input-container svelte-8hsxjr"><input id="manifest-filter" type="text" class="filter-input svelte-8hsxjr"/> <!></div></div> <div class="action-buttons svelte-8hsxjr"><button type="button" class="action-button secondary svelte-8hsxjr"> </button> <button type="button" class="action-button primary svelte-8hsxjr"> </button> <button type="button" class="action-button secondary svelte-8hsxjr"> </button></div> <input type="file" multiple accept="*/*" style="display: none;"/> <!></div> <div class="table-container svelte-8hsxjr"><!></div></div>');function Iv(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=st(),o=st(),l=st();let d=V(e,"manifestItems",24,()=>[]),f=V(e,"sourceItems",24,()=>[]),c=V(e,"advancedMode",8,!0),p=V(e,"validationErrors",24,()=>[]),h=V(e,"selectedItem",8,null),v=V(e,"selectedItemType",8,null),g=V(e,"loading",8,!1);const b=cn();let y=st(""),L=st(!1),k=st(),E=st("id"),T=st("asc");const P=se=>{s(E)===se?m(T,s(T)==="asc"?"desc":"asc"):(m(E,se),m(T,"asc"))},$=(se,Ee)=>{b("itemSelect",{item:se,type:Ee==="source-zip"?"source":Ee})},R=(se,Ee,ve)=>{(se.key==="Enter"||se.key===" ")&&(se.preventDefault(),$(Ee,ve))},z=(se,Ee)=>{if(!h())return!1;const ve=Ee==="source-zip"?"source":Ee;return v()!==ve?!1:Ee==="manifest"?se.id===h().id:se.path===h().path},O=se=>p().filter(Ee=>Ee.itemId===se.id),W=se=>O(se).length>0,N=se=>{if(!se)return"-";const Ee=["B","KB","MB","GB"];let ve=se,We=0;for(;ve>=1024&&We<Ee.length-1;)ve/=1024,We++;return`${ve.toFixed(We===0?0:1)} ${Ee[We]}`},j=se=>s(E)!==se?"â":s(T)==="asc"?"â":"â",x=se=>{const Ee=se.target;Ee.files&&Ee.files.length>0&&(b("fileUpload",{files:Ee.files}),Ee.value="")},F=se=>{se.preventDefault(),m(L,!0)},q=se=>{se.preventDefault(),m(L,!1)},te=se=>{se.preventDefault(),m(L,!1),se.dataTransfer?.files&&se.dataTransfer.files.length>0&&b("fileUpload",{files:se.dataTransfer.files})};Rt(()=>(Lt(d()),Lt(c()),Lt(f())),()=>{m(i,[...d().map(se=>({...se,_type:"manifest"})),{name:"content.opf",path:"content.opf",size:void 0,_type:"opf"},...c()?f().map(se=>({...se,_type:"source"})):[],...c()?[]:[{name:"SOURCE.zip",path:"SOURCE.zip",size:void 0,_type:"source-zip",isPlaceholder:!0}]])}),Rt(()=>(s(i),s(y)),()=>{m(o,s(i).filter(se=>{if(!s(y))return!0;const Ee=s(y).toLowerCase();if(se._type==="manifest"){const ve=se;return ve.id.toLowerCase().includes(Ee)||ve.href.toLowerCase().includes(Ee)||ve.properties?.some(We=>We.toLowerCase().includes(Ee))||!1}else if(se._type==="source"){const ve=se;return ve.name.toLowerCase().includes(Ee)||ve.path.toLowerCase().includes(Ee)}else if(se._type==="source-zip"){const ve=se;return ve.name.toLowerCase().includes(Ee)||ve.path.toLowerCase().includes(Ee)}else{const ve=se;return ve.name.toLowerCase().includes(Ee)||ve.path.toLowerCase().includes(Ee)}}))}),Rt(()=>(s(o),s(E),s(T)),()=>{m(l,(()=>{const se=s(o).filter(B=>B._type==="manifest"),Ee=s(o).filter(B=>B._type==="source"),ve=s(o).filter(B=>B._type==="source-zip"),We=s(o).filter(B=>B._type==="opf"),Ve=B=>[...B].sort((H,Z)=>{let ue="",ye="";return s(E)==="id"?(ue=H._type==="manifest"?H.id:(H._type==="source"||H._type==="source-zip",H.name),ye=Z._type==="manifest"?Z.id:(Z._type==="source"||Z._type==="source-zip",Z.name)):s(E)==="href"?(ue=H._type==="manifest"?H.href:(H._type==="source"||H._type==="source-zip",H.path),ye=Z._type==="manifest"?Z.href:(Z._type==="source"||Z._type==="source-zip",Z.path)):s(E)==="size"&&(ue=H.size||0,ye=Z.size||0),ue<ye?s(T)==="asc"?-1:1:ue>ye?s(T)==="asc"?1:-1:0});return[...Ve(se),...Ve(Ee),...Ve(We),...Ve(ve)]})())}),xn(),Bt();var M=Cv(),Q=u(M);let ce;var be=u(Q),_e=u(be),Ue=u(_e),Ce=w(_e,2),pe=u(Ce);pe.__input=[iv,y];var K=w(pe,2);{var oe=se=>{var Ee=dv();Ee.__click=[cv,y],D(ve=>de(Ee,"aria-label",ve),[()=>n()("Clear filter")],De),_(se,Ee)};U(K,se=>{s(y)&&se(oe)})}var ie=w(be,2),xe=u(ie);xe.__click=[lv,h,v,b];var Me=u(xe),Ae=w(xe,2);Ae.__click=[sv,k];var He=u(Ae),$e=w(Ae,2);$e.__click=[ov,b];var Ye=u($e),Ne=w(ie,2);Ne.__change=x,Ut(Ne,se=>m(k,se),()=>s(k));var Ge=w(Ne,2);{var Ke=se=>{var Ee=uv(),ve=u(Ee),We=u(ve),Ve=u(We);D(B=>S(Ve,B),[()=>n()("Drop files here to add them to the manifest")],De),_(se,Ee)};U(Ge,se=>{s(L)&&se(Ke)})}var he=w(Q,2),ke=u(he);{var Te=se=>{var Ee=hv(),ve=u(Ee);{var We=B=>{var H=fv(),Z=et(H),ue=u(Z),ye=w(Z,2),Se=u(ye);D((Fe,Ie)=>{S(ue,Fe),S(Se,Ie)},[()=>n()("No items match your filter"),()=>n()("Try adjusting your search terms")],De),_(B,H)},Ve=B=>{var H=pv(),Z=et(H),ue=u(Z),ye=w(Z,2),Se=u(ye);D((Fe,Ie)=>{S(ue,Fe),S(Se,Ie)},[()=>n()("No manifest items found"),()=>n()("Create your first item using the buttons above")],De),_(B,H)};U(ve,B=>{s(y)?B(We):B(Ve,!1)})}_(se,Ee)},Oe=se=>{var Ee=Tv(),ve=u(Ee),We=u(ve),Ve=u(We),B=u(Ve);B.__click=[vv,P];var H=u(B),Z=w(Ve),ue=u(Z);ue.__click=[mv,P];var ye=u(ue),Se=w(Z),Fe=u(Se);Fe.__click=[gv,P];var Ie=u(Fe),Xe=w(Se),Be=u(Xe),le=w(ve);Ct(le,5,()=>s(l),Pt,(ae,me,Pe)=>{var qe=kv();const Le=De(()=>s(me)._type),re=De(()=>z(s(me),s(Le))),Y=De(()=>s(Le)==="manifest"?W(s(me)):!1),ge=De(()=>Pe>0?s(l)[Pe-1]._type:null),ee=De(()=>s(Le)==="source"&&s(ge)==="manifest"),A=De(()=>s(Le)==="source-zip"&&s(ge)==="opf"),J=De(()=>s(Le)==="opf"&&(s(ge)==="manifest"||s(ge)==="source"));var C=et(qe);{var G=Et=>{var qt=wv(),Ia=u(qt),Fa=u(Ia),Br=u(Fa),Ma=u(Br);D(Po=>S(Ma,Po),[()=>n()("SOURCE.zip")],De),_(Et,qt)};U(C,Et=>{s(ee)&&Et(G)})}var X=w(C,2);{var we=Et=>{var qt=yv();_(Et,qt)};U(X,Et=>{s(A)&&Et(we)})}var Re=w(X,2);{var ze=Et=>{var qt=bv();_(Et,qt)};U(Re,Et=>{s(J)&&Et(ze)})}var je=w(Re,2);let Qe;je.__click=[_v,$,me,Le],je.__keydown=[xv,R,me,Le];var Ze=u(je),Je=u(Ze),ot=u(Je),gt=w(Ze),ut=u(gt),lt=u(ut),xt=w(gt),ft=u(xt),Ot=w(xt),fr=u(Ot);{var Co=Et=>{var qt=Ev();Ct(qt,5,()=>s(me).properties||[],Pt,(Ia,Fa)=>{var Br=Sv(),Ma=u(Br);D(()=>S(Ma,s(Fa))),_(Ia,Br)}),_(Et,qt)},Io=Et=>{var qt=Tt("-");_(Et,qt)};U(fr,Et=>{s(Le)==="manifest"&&s(me).properties&&(s(me).properties?.length??0)>0?Et(Co):Et(Io,!1)})}var Fo=w(Ot);{var Mo=Et=>{};U(Fo,Et=>{s(Le)==="manifest"&&Et(Mo)})}D((Et,qt)=>{Qe=ct(je,1,"manifest-row svelte-8hsxjr",null,Qe,Et),de(je,"aria-selected",s(re)),S(ot,s(Le)==="manifest"?s(me).id:(s(Le)==="source"||s(Le)==="source-zip")&&s(me).name||s(me).name),Je.dir=Je.dir,S(lt,s(Le)==="manifest"?s(me).href:(s(Le)==="source"||s(Le)==="source-zip")&&s(me).path||s(me).path),ut.dir=ut.dir,S(ft,qt)},[()=>({selected:s(re),error:s(Y),"source-item":s(Le)==="source","source-zip-item":s(Le)==="source-zip","opf-item":s(Le)==="opf"}),()=>N(s(me).size)],De),_(ae,qe)}),D((ae,me,Pe,qe,Le,re,Y,ge,ee,A)=>{de(B,"aria-label",ae),S(H,`${me??""}
                ${Pe??""}`),de(ue,"aria-label",qe),S(ye,`${Le??""}
                ${re??""}`),de(Fe,"aria-label",Y),S(Ie,`${ge??""}
                ${ee??""}`),S(Be,A)},[()=>n()("Sort by ID"),()=>n()("ID"),()=>j("id"),()=>n()("Sort by path"),()=>n()("Path"),()=>j("href"),()=>n()("Sort by size"),()=>n()("Size"),()=>j("size"),()=>n()("Properties")],De),_(se,Ee)};U(ke,se=>{s(l).length===0?se(Te):se(Oe,!1)})}D((se,Ee,ve,We,Ve,B,H)=>{ce=ct(Q,1,"manifest-toolbar svelte-8hsxjr",null,ce,se),de(Q,"aria-label",Ee),S(Ue,`${ve??""}:`),de(pe,"placeholder",We),Qt(pe,s(y)),pe.disabled=g(),xe.disabled=!h()||v()!=="manifest",S(Me,`âï¸ ${Ve??""}`),Ae.disabled=g(),S(He,`ð ${B??""}`),$e.disabled=g(),S(Ye,`ð ${H??""}`)},[()=>({"drag-active":s(L)}),()=>n()("Manifest actions"),()=>n()("Filter"),()=>n()("Filter by ID, path, or media type..."),()=>n()("Edit Item"),()=>n()("Load File"),()=>n()("Create Text File")],De),nt("dragover",Q,F),nt("dragleave",Q,q),nt("drop",Q,te),_(r,M),at(),a()}_t(["input","click","change","keydown"]);class So{static generateItemId(e){return!e||e.trim()===""?"item":e.replace(/\.[^/.]+$/,"").toLowerCase().replace(/[^a-z0-9_-]/g,"_").replace(/^[0-9]/,"item_$&").replace(/^[^a-z_]/,"item").replace(/^_+|_+$/g,"")||"item"}static detectMediaType(e,t){const a=this.getFileExtension(e).toLowerCase(),i={xhtml:"application/xhtml+xml",html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",txt:"text/plain",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",bmp:"image/bmp",ico:"image/x-icon",mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",m4a:"audio/mp4",aac:"audio/aac",flac:"audio/flac",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",avi:"video/x-msvideo",mov:"video/quicktime",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2",eot:"application/vnd.ms-fontobject",pdf:"application/pdf",epub:"application/epub+zip",zip:"application/zip"}[a];return i||(t&&t.byteLength>0?this.detectMediaTypeFromContent(t):"application/octet-stream")}static detectMediaTypeFromContent(e){const t=new Uint8Array(e);if(t.length>=8){if(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71)return"image/png";if(t[0]===255&&t[1]===216&&t[2]===255)return"image/jpeg";if(t[0]===71&&t[1]===73&&t[2]===70&&t[3]===56)return"image/gif";if(t[0]===37&&t[1]===80&&t[2]===68&&t[3]===70)return"application/pdf";if(t[0]===80&&t[1]===75&&(t[2]===3||t[2]===5))return"application/zip"}try{const a=new TextDecoder("utf-8",{fatal:!0}).decode(e);return a.includes("<?xml")?"application/xml":a.includes("<html")||a.includes("<!DOCTYPE html")?"text/html":"text/plain"}catch{}return"application/octet-stream"}static getMediaTypeCategories(){return{text:[{mediaType:"application/xhtml+xml",extensions:["xhtml"],description:"XHTML Document",isEpubCore:!0},{mediaType:"text/html",extensions:["html","htm"],description:"HTML Document"},{mediaType:"text/css",extensions:["css"],description:"CSS Stylesheet",isEpubCore:!0},{mediaType:"application/javascript",extensions:["js"],description:"JavaScript"},{mediaType:"application/json",extensions:["json"],description:"JSON Data"},{mediaType:"text/plain",extensions:["txt"],description:"Plain Text"},{mediaType:"application/xml",extensions:["xml"],description:"XML Document"}],image:[{mediaType:"image/jpeg",extensions:["jpg","jpeg"],description:"JPEG Image",isEpubCore:!0},{mediaType:"image/png",extensions:["png"],description:"PNG Image",isEpubCore:!0},{mediaType:"image/gif",extensions:["gif"],description:"GIF Image",isEpubCore:!0},{mediaType:"image/svg+xml",extensions:["svg"],description:"SVG Image",isEpubCore:!0},{mediaType:"image/webp",extensions:["webp"],description:"WebP Image"},{mediaType:"image/bmp",extensions:["bmp"],description:"Bitmap Image"}],audio:[{mediaType:"audio/mpeg",extensions:["mp3"],description:"MP3 Audio",isEpubCore:!0},{mediaType:"audio/mp4",extensions:["m4a"],description:"MP4 Audio",isEpubCore:!0},{mediaType:"audio/ogg",extensions:["ogg"],description:"OGG Audio"},{mediaType:"audio/wav",extensions:["wav"],description:"WAV Audio"},{mediaType:"audio/aac",extensions:["aac"],description:"AAC Audio"}],video:[{mediaType:"video/mp4",extensions:["mp4"],description:"MP4 Video",isEpubCore:!0},{mediaType:"video/webm",extensions:["webm"],description:"WebM Video"},{mediaType:"video/ogg",extensions:["ogv"],description:"OGG Video"},{mediaType:"video/quicktime",extensions:["mov"],description:"QuickTime Video"}],application:[{mediaType:"font/ttf",extensions:["ttf"],description:"TrueType Font",isEpubCore:!0},{mediaType:"font/otf",extensions:["otf"],description:"OpenType Font",isEpubCore:!0},{mediaType:"font/woff",extensions:["woff"],description:"WOFF Font",isEpubCore:!0},{mediaType:"font/woff2",extensions:["woff2"],description:"WOFF2 Font",isEpubCore:!0},{mediaType:"application/pdf",extensions:["pdf"],description:"PDF Document"},{mediaType:"application/zip",extensions:["zip"],description:"ZIP Archive"},{mediaType:"application/octet-stream",extensions:[],description:"Binary Data"}]}}static createBlobUrl(e,t){const a=typeof e=="string"?new Blob([e],{type:t}):new Blob([e],{type:t});return URL.createObjectURL(a)}static revokeBlobUrl(e){URL.revokeObjectURL(e)}static formatFileSize(e){if(e===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+a[n]}static getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1):""}static sanitizeFileName(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}}var Fv=I('<p class="file-info svelte-ziknnq"> </p>'),Mv=I('<div class="form-group svelte-ziknnq"><label for="file-input" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="file-input" type="file" class="file-input svelte-ziknnq" required/> <!></div>'),Pv=I('<p class="error-message svelte-ziknnq"> </p>'),Lv=I('<p class="error-message svelte-ziknnq"> </p>'),Rv=I("<option> </option>"),Dv=I('<p class="error-message svelte-ziknnq"> </p>'),Av=I('<label class="checkbox-label svelte-ziknnq"><input type="checkbox" class="checkbox-input svelte-ziknnq"/> </label>'),Ov=I('<div class="form-group svelte-ziknnq"><label for="text-content" class="form-label svelte-ziknnq"> </label> <textarea id="text-content" class="form-textarea svelte-ziknnq" rows="3"></textarea> <p class="field-help svelte-ziknnq"> </p></div>'),Uv=I('<div class="modal-overlay svelte-ziknnq" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-content svelte-ziknnq"><div class="modal-header svelte-ziknnq"><h2 id="modal-title" class="svelte-ziknnq"><!></h2> <button type="button" class="close-button svelte-ziknnq">Ã</button></div> <form class="modal-form svelte-ziknnq"><div class="form-body svelte-ziknnq"><!> <div class="form-group svelte-ziknnq"><label for="item-id" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-id" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-href" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <input id="item-href" type="text" dir="ltr" required/> <!></div> <div class="form-group svelte-ziknnq"><label for="item-mediatype" class="form-label svelte-ziknnq"> <span class="required svelte-ziknnq">*</span></label> <select id="item-mediatype" required><option> </option><!></select> <!></div> <div class="form-group svelte-ziknnq"><fieldset class="checkbox-fieldset svelte-ziknnq"><legend class="form-label svelte-ziknnq"> </legend> <div class="checkbox-group svelte-ziknnq"></div></fieldset></div> <!></div> <div class="modal-footer svelte-ziknnq"><button type="button" class="cancel-button svelte-ziknnq"> </button> <button type="submit" class="save-button svelte-ziknnq"><!></button></div></form></div></div>');function zv(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"itemEditorMode",8,"create-text"),o=V(e,"item",8,null),l=V(e,"validationErrors",24,()=>[]);const d=cn();let f=st(),c=st({id:"",href:"",mediaType:"",properties:[]}),p=st(""),h=st(),v=st(null);const g=[{value:"application/xhtml+xml",label:"XHTML"},{value:"text/html",label:"HTML"},{value:"text/css",label:"CSS"},{value:"text/javascript",label:"JavaScript"},{value:"text/plain",label:"Plain Text"},{value:"image/jpeg",label:"JPEG Image"},{value:"image/png",label:"PNG Image"},{value:"image/svg+xml",label:"SVG Image"},{value:"audio/mpeg",label:"MP3 Audio"},{value:"audio/ogg",label:"OGG Audio"},{value:"video/mp4",label:"MP4 Video"},{value:"video/webm",label:"WebM Video"},{value:"application/pdf",label:"PDF"},{value:"application/epub+zip",label:"EPUB"}],b=[{value:"cover-image",label:"Cover Image"},{value:"mathml",label:"MathML"},{value:"nav",label:"Navigation"},{value:"remote-resources",label:"Remote Resources"},{value:"scripted",label:"Scripted"},{value:"svg",label:"SVG"}],y=()=>{d("close")},L=re=>{re.target===s(f)&&y()},k=re=>{re.key==="Escape"&&re.target===s(f)&&y()},E=re=>{re.key==="Escape"&&y()},T=re=>{const Y=re.target;if(Y.files&&Y.files.length>0){m(v,Y.files[0]),s(c).id||St(c,s(c).id=s(v).name.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"));const ge=s(v).type,ee=So.detectMediaType(s(v).name),A=!ge||ge==="application/octet-stream",J=ee.startsWith("font/"),C=A||J?ee:ge;s(c).href||St(c,s(c).href=Ja(s(v).name,C)),s(c).mediaType||St(c,s(c).mediaType=C)}},P=re=>{if(re.preventDefault(),!s(c).id||!s(c).href||!s(c).mediaType){alert(n()("Please fill in all required fields"));return}const Y={id:s(c).id,href:s(c).href,mediaType:s(c).mediaType,properties:s(c).properties?.filter(ge=>ge.length>0)};d("save",{item:Y,textContent:s(p),selectedFile:s(v)})},$=(re,Y)=>{Y?St(c,s(c).properties=[...s(c).properties||[],re]):St(c,s(c).properties=(s(c).properties||[]).filter(ge=>ge!==re))},R=()=>{if(s(c).href){const re=s(c).href.split("/").pop()||"";St(c,s(c).id=re.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"))}},z=()=>{if(s(c).id&&!s(c).href){const re=O(s(c).mediaType||""),Y=s(c).id+re;St(c,s(c).href=Ja(Y,s(c).mediaType||""))}},O=re=>({"application/xhtml+xml":".xhtml","text/html":".html","text/css":".css","text/javascript":".js","text/plain":".txt","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/svg+xml":".svg","audio/mpeg":".mp3","audio/ogg":".ogg","video/mp4":".mp4","video/webm":".webm","application/pdf":".pdf"})[re]||".dat",W=re=>{const Y=l().find(ge=>ge.field===re);return Y?Y.message:null},N=re=>l().some(Y=>Y.field===re);Rt(()=>(Lt(i()),Lt(o())),()=>{if(i()==="edit"&&o()&&"id"in o()){const re=o();m(c,{id:re.id,href:re.href,mediaType:re.mediaType,properties:re.properties||[]})}else m(c,{id:"",href:"",mediaType:i()==="create-text"?"text/plain":"",properties:[]})}),xn(),Bt();var j=Uv();nt("keydown",Va,E);var x=u(j),F=u(x),q=u(F),te=u(q);{var M=re=>{var Y=Tt();D(ge=>S(Y,ge),[()=>n()("Create Text File")],De),_(re,Y)},Q=(re,Y)=>{{var ge=A=>{var J=Tt();D(C=>S(J,C),[()=>n()("Upload File")],De),_(A,J)},ee=A=>{var J=Tt();D(C=>S(J,C),[()=>n()("Edit Manifest Item")],De),_(A,J)};U(re,A=>{i()==="create-file"?A(ge):A(ee,!1)},Y)}};U(te,re=>{i()==="create-text"?re(M):re(Q,!1)})}var ce=w(q,2),be=w(F,2),_e=u(be),Ue=u(_e);{var Ce=re=>{var Y=Mv(),ge=u(Y),ee=u(ge),A=w(ge,2);Ut(A,G=>m(h,G),()=>s(h));var J=w(A,2);{var C=G=>{var X=Fv(),we=u(X);D((Re,ze)=>S(we,`${Re??""}: ${s(v).name??""} (${ze??""} KB)`),[()=>n()("Selected"),()=>(s(v).size/1024).toFixed(1)],De),_(G,X)};U(J,G=>{s(v)&&G(C)})}D(G=>S(ee,`${G??""} `),[()=>n()("Select File")],De),nt("change",A,T),_(re,Y)};U(Ue,re=>{i()==="create-file"&&re(Ce)})}var pe=w(Ue,2),K=u(pe),oe=u(K),ie=w(K,2);let xe;var Me=w(ie,2);{var Ae=re=>{var Y=Pv(),ge=u(Y);D(ee=>S(ge,ee),[()=>W("id")],De),_(re,Y)};U(Me,re=>{W("id")&&re(Ae)})}var He=w(pe,2),$e=u(He),Ye=u($e),Ne=w($e,2);let Ge;var Ke=w(Ne,2);{var he=re=>{var Y=Lv(),ge=u(Y);D(ee=>S(ge,ee),[()=>W("href")],De),_(re,Y)};U(Ke,re=>{W("href")&&re(he)})}var ke=w(He,2),Te=u(ke),Oe=u(Te),se=w(Te,2);D(()=>{s(c),Pl(()=>{n()})});let Ee;var ve=u(se);ve.value=ve.__value="";var We=u(ve),Ve=w(ve);Ct(Ve,1,()=>g,Pt,(re,Y)=>{var ge=Rv(),ee={},A=u(ge);D(()=>{ee!==(ee=s(Y).value)&&(ge.value=(ge.__value=s(Y).value)??""),S(A,s(Y).label)}),_(re,ge)});var B=w(se,2);{var H=re=>{var Y=Dv(),ge=u(Y);D(ee=>S(ge,ee),[()=>W("mediaType")],De),_(re,Y)};U(B,re=>{W("mediaType")&&re(H)})}var Z=w(ke,2),ue=u(Z),ye=u(ue),Se=u(ye),Fe=w(ye,2);Ct(Fe,5,()=>b,Pt,(re,Y)=>{var ge=Av(),ee=u(ge),A=w(ee);D(J=>{Ys(ee,J),S(A,` ${s(Y).label??""}`)},[()=>s(c).properties?.includes(s(Y).value)||!1],De),nt("change",ee,J=>$(s(Y).value,J.currentTarget.checked)),_(re,ge)});var Ie=w(Z,2);{var Xe=re=>{var Y=Ov(),ge=u(Y),ee=u(ge),A=w(ge,2),J=w(A,2),C=u(J);D((G,X,we)=>{S(ee,G),de(A,"placeholder",X),S(C,we)},[()=>n()("Initial Content"),()=>n()("Enter the initial content for this text fileâ¦"),()=>n()("You can edit the content later in the main editor")],De),Tr(A,()=>s(p),G=>m(p,G)),_(re,Y)};U(Ie,re=>{i()==="create-text"&&re(Xe)})}var Be=w(_e,2),le=u(Be),ae=u(le),me=w(le,2),Pe=u(me);{var qe=re=>{var Y=Tt();D(ge=>S(Y,ge),[()=>n()("Create Text File")],De),_(re,Y)},Le=(re,Y)=>{{var ge=A=>{var J=Tt();D(C=>S(J,C),[()=>n()("Upload File")],De),_(A,J)},ee=A=>{var J=Tt();D(C=>S(J,C),[()=>n()("Save Changes")],De),_(A,J)};U(re,A=>{i()==="create-file"?A(ge):A(ee,!1)},Y)}};U(Pe,re=>{i()==="create-text"?re(qe):re(Le,!1)})}Ut(j,re=>m(f,re),()=>s(f)),D((re,Y,ge,ee,A,J,C,G,X,we,Re,ze)=>{de(ce,"aria-label",re),S(oe,`${Y??""} `),xe=ct(ie,1,"form-input svelte-ziknnq",null,xe,ge),de(ie,"placeholder",ee),ie.dir=ie.dir,S(Ye,`${A??""} `),Ge=ct(Ne,1,"form-input svelte-ziknnq",null,Ge,J),de(Ne,"placeholder",C),Ne.dir=Ne.dir,S(Oe,`${G??""} `),Ee=ct(se,1,"form-select svelte-ziknnq",null,Ee,X),S(We,we),S(Se,Re),S(ae,ze)},[()=>n()("Close"),()=>n()("ID"),()=>({error:N("id")}),()=>n()("Unique identifier for this item"),()=>n()("File Path"),()=>({error:N("href")}),()=>n()("OEBPS/filename.ext"),()=>n()("Media Type"),()=>({error:N("mediaType")}),()=>n()("Select media typeâ¦"),()=>n()("EPUB Properties"),()=>n()("Cancel")],De),nt("click",ce,y),Tr(ie,()=>s(c).id,re=>St(c,s(c).id=re)),nt("blur",ie,z),Tr(Ne,()=>s(c).href,re=>St(c,s(c).href=re)),nt("blur",Ne,R),Gs(se,()=>s(c).mediaType,re=>St(c,s(c).mediaType=re)),nt("click",le,y),nt("submit",be,P),nt("click",j,L),nt("keydown",j,k),_(r,j),at(),a()}var Wv=I('<div class="loading-state svelte-12tyyls"><p> </p></div>'),Nv=I('<div class="error-state svelte-12tyyls"><p class="error-message svelte-12tyyls"> </p> <button type="button" class="retry-button svelte-12tyyls"> </button></div>'),jv=I("<!> <!>",1);function Bv(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"workspace",7,null),o=V(e,"advancedMode",3,!0),l=fe(It([])),d=fe(It([])),f=fe(null),c=fe(null),p=fe(It([])),h=fe(!0),v=fe(null),g=fe(!1),b=fe("create-text");const y=async()=>{if(i())try{m(h,!0),m(v,null);const F=i().opf.manifest,q=await Promise.all(F.map(async te=>{try{const M=i().pathInfo.basePath?`${i().pathInfo.basePath}/${te.href}`:te.href,Q=await e.workspaceService.getFileInfo(i().id,M);return{...te,size:Q.size}}catch{return te}}));if(m(l,q,!0),o())try{m(d,await e.workspaceService.listSourceFiles(i()),!0)}catch(te){console.warn("Failed to load SOURCE items:",te),m(d,[],!0)}else m(d,[],!0);m(p,[],!0)}catch{m(v,n()("Failed to load manifest"),!0)}finally{m(h,!1)}},L=F=>{m(f,F.detail.item,!0),m(c,F.detail.type,!0),e.onItemSelect?.({item:F.detail.item,type:F.detail.type})},k=F=>{m(b,F.detail.mode,!0),m(g,!0)},E=F=>{m(f,F.detail.item,!0),m(c,"manifest"),m(b,"edit"),m(g,!0)},T=async F=>{if(!(!i()||!confirm(n()("Are you sure you want to delete this item?"))))try{i(await e.workspaceService.removeManifestItem(i(),F.detail.itemId)),await y(),s(f)&&"id"in s(f)&&s(f).id===F.detail.itemId&&(m(f,null),m(c,null))}catch{m(v,n()("Failed to delete item"),!0)}},P=async F=>{if(i())try{const{item:q}=F.detail;if(s(b)==="edit"&&s(f)&&"id"in s(f))i(await e.workspaceService.updateManifestItem(i(),s(f).id,q));else if(s(b)==="create-text"){i(await e.workspaceService.addManifestItem(i(),q));const te=q.href.startsWith(i().pathInfo.basePath+"/")?q.href:`${i().pathInfo.basePath}/${q.href}`;await e.workspaceService.writeFile(i().id,te,"")}m(g,!1),await y()}catch{m(v,n()("Failed to save item"),!0)}},$=async F=>{if(!i())return;const q=F.detail.files,te=[],M=[];for(const Q of q)try{const ce=Q.type,be=So.detectMediaType(Q.name),_e=!ce||ce==="application/octet-stream",Ue=be.startsWith("font/"),pe=_e||Ue||(be==="application/javascript"||be==="text/javascript")?be:ce,K={href:Ja(Q.name,pe),mediaType:pe};i(await e.workspaceService.addManifestItem(i(),K));const oe=`${i().pathInfo.basePath}/${K.href}`;if(Q.type.startsWith("text/")||Q.type.includes("json")||Q.type.includes("xml")){const ie=await Q.text();await e.workspaceService.writeFile(i().id,oe,ie)}else{const ie=await Q.arrayBuffer();await e.workspaceService.writeBinaryFile(i().id,oe,ie)}te.push(Q.name)}catch(ce){console.warn(`Failed to upload ${Q.name}:`,ce),M.push({name:Q.name,error:ce instanceof Error?ce.message:"Unknown error"})}await y(),M.length===0?console.log(`Successfully uploaded ${te.length} files:`,te):te.length===0?(m(v,n()("Failed to upload all files"),!0),console.error("Upload failures:",M)):(console.log(`Uploaded ${te.length} files successfully:`,te),console.warn(`Failed to upload ${M.length} files:`,M),m(v,n()("Some files failed to upload - see console for details"),!0))},R=()=>{m(g,!1)};rn(y),ht(()=>{i()&&y()}),ht(()=>{i()&&(o()?e.workspaceService.listSourceFiles(i()).then(F=>{m(d,F,!0)}).catch(F=>{console.warn("Failed to load SOURCE items:",F),m(d,[],!0)}):m(d,[],!0))}),ht(()=>{i()&&y()});var z=jv(),O=et(z);{var W=F=>{var q=Wv(),te=u(q),M=u(te);D(Q=>S(M,Q),[()=>n()("Loading manifestâ¦")]),_(F,q)},N=(F,q)=>{{var te=Q=>{var ce=Nv(),be=u(ce),_e=u(be),Ue=w(be,2);Ue.__click=y;var Ce=u(Ue);D(pe=>{S(_e,s(v)),S(Ce,pe)},[()=>n()("Retry")]),_(Q,ce)},M=Q=>{Iv(Q,{get manifestItems(){return s(l)},get sourceItems(){return s(d)},get advancedMode(){return o()},get validationErrors(){return s(p)},get selectedItem(){return s(f)},get selectedItemType(){return s(c)},$$events:{itemSelect:L,itemCreate:k,itemEdit:E,itemDelete:T,fileUpload:$}})};U(F,Q=>{s(v)?Q(te):Q(M,!1)},q)}};U(O,F=>{s(h)?F(W):F(N,!1)})}var j=w(O,2);{var x=F=>{const q=ne(()=>s(b)==="edit"?s(f):null);zv(F,{get itemEditorMode(){return s(b)},get item(){return s(q)},get validationErrors(){return s(p)},$$events:{save:P,close:R}})};U(j,F=>{s(g)&&F(x)})}_(r,z),at(),a()}_t(["click"]);var Hv=I('<div class="no-selection svelte-xcscli"><p class="svelte-xcscli"> </p> <p class="no-selection-subtitle svelte-xcscli"> </p></div>'),Vv=I('<div class="loading-state svelte-xcscli"><p> </p></div>'),qv=I('<div class="error-state svelte-xcscli"><p class="error-message svelte-xcscli"> </p> <button type="button" class="retry-button svelte-xcscli"> </button></div>'),$v=I('<button type="button" class="action-button edit-button svelte-xcscli"> </button>'),Gv=I('<button type="button" class="action-button delete-button svelte-xcscli"> </button>'),Xv=I('<div class="preview-error svelte-xcscli"><p> </p></div>'),Kv=I('<div class="text-preview svelte-xcscli"><pre class="text-content svelte-xcscli"> </pre></div>'),Yv=I('<div class="image-preview svelte-xcscli"><img class="preview-image svelte-xcscli"/></div>'),Jv=I('<div class="audio-preview svelte-xcscli"><audio controls class="preview-audio svelte-xcscli"><source/> </audio></div>'),Zv=I('<div class="video-preview svelte-xcscli"><video controls class="preview-video svelte-xcscli"><track kind="captions"/> <source/> </video></div>',2),Qv=I('<div class="binary-preview svelte-xcscli"><p> </p> <p class="binary-info svelte-xcscli"> </p></div>'),em=I('<div class="content-header svelte-xcscli"><span class="content-type-icon svelte-xcscli"> </span> <span class="content-type svelte-xcscli"> </span></div> <!>',1),tm=I('<div class="preview-content svelte-xcscli"><div class="preview-header svelte-xcscli"><div class="preview-actions svelte-xcscli"><!> <button type="button" class="action-button download-button svelte-xcscli"> </button> <!></div></div> <div class="preview-body svelte-xcscli"><!></div></div>'),nm=I('<div class="manifest-preview svelte-xcscli"><!></div>');function rm(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"selectedItem",8,null),o=V(e,"selectedItemType",8,null),l=V(e,"workspace",8,null),d=V(e,"workspaceService",8,void 0);const f=cn();let c=st(null),p=st(!1),h=st(null),v=null;const g=x=>x.startsWith("text/")||x.includes("json")||x.includes("xml")||x.includes("javascript"),b=x=>x.startsWith("image/"),y=x=>x.startsWith("audio/"),L=x=>x.startsWith("video/"),k=x=>x.includes("css")||x.includes("javascript")||x.includes("json")||x.includes("xml")||x.startsWith("text/css")||x.startsWith("text/javascript")||x.startsWith("application/json")||x.startsWith("application/xml")||x.startsWith("application/xhtml+xml"),E=()=>{v&&(URL.revokeObjectURL(v),v=null)};ur(()=>{E()});const T=async()=>{if(!i()||!o()||!d()||!l()){m(c,null),E();return}try{if(m(p,!0),m(h,null),E(),o()==="manifest"){const x=i(),F=x.href.startsWith(l().pathInfo.basePath+"/")?x.href:`${l().pathInfo.basePath}/${x.href}`;try{let q;try{q=await d().readFile(l().id,F)}catch{q=await d().readFile(l().id,x.href)}const te=g(x.mediaType),M=b(x.mediaType),Q=y(x.mediaType),ce=L(x.mediaType);let be,_e,Ue;if(te)be=new TextDecoder("utf-8").decode(q),Ue="text";else if(M){const Ce=new Blob([q],{type:x.mediaType});_e=URL.createObjectURL(Ce),v=_e,Ue="image"}else if(Q){const Ce=new Blob([q],{type:x.mediaType});_e=URL.createObjectURL(Ce),v=_e,Ue="audio"}else if(ce){const Ce=new Blob([q],{type:x.mediaType});_e=URL.createObjectURL(Ce),v=_e,Ue="video"}else Ue="binary";m(c,{itemId:x.id,mediaType:x.mediaType,contentType:Ue,textContent:be,previewUrl:_e,metadata:{characterCount:be?be.length:void 0,lineCount:be?be.split(`
`).length:void 0,wordCount:be?be.split(/\s+/).filter(Ce=>Ce.length>0).length:void 0}})}catch{m(c,{itemId:x.id,mediaType:x.mediaType,contentType:"binary",error:"Failed to load content"})}}else if(o()==="source"){const x=i();try{const F=await d().readFile(l().id,x.path),q=g(x.mediaType||"text/plain");let te;q&&(te=new TextDecoder("utf-8").decode(F)),m(c,{itemId:x.path,mediaType:x.mediaType||"text/plain",contentType:q?"text":"binary",textContent:te,metadata:{characterCount:te?te.length:void 0,lineCount:te?te.split(`
`).length:void 0,wordCount:te?te.split(/\s+/).filter(M=>M.length>0).length:void 0}})}catch{m(c,{itemId:x.path,mediaType:x.mediaType||"text/plain",contentType:"text",error:"Failed to load SOURCE file content"})}}else if(o()==="opf"){const x=i();try{const F=await d().readFile(l().id,l().pathInfo.rootfilePath),te=new TextDecoder("utf-8").decode(F);m(c,{itemId:x.name,mediaType:"application/xml",contentType:"text",textContent:te,metadata:{characterCount:te.length,lineCount:te.split(`
`).length,wordCount:te.split(/\s+/).filter(M=>M.length>0).length}})}catch{m(c,{itemId:x.name,mediaType:"application/xml",contentType:"text",error:"Failed to load content.opf file"})}}}catch{m(h,n()("Failed to load content preview")),m(c,null)}finally{m(p,!1)}},P=()=>{i()&&o()==="manifest"&&f("itemEdit",{item:i()})},$=()=>{i()&&o()==="manifest"&&f("itemDelete",{itemId:i().id})},R=async()=>{if(!(!i()||!d()||!l()))try{let x,F,q;if(o()==="manifest"){const ce=i(),be=ce.href.startsWith(l().pathInfo.basePath+"/")?ce.href:`${l().pathInfo.basePath}/${ce.href}`;try{x=await d().readFile(l().id,be)}catch{x=await d().readFile(l().id,ce.href)}F=ce.href.split("/").pop()||ce.id,q=ce.mediaType}else if(o()==="source"){const ce=i();x=await d().readFile(l().id,ce.path),F=ce.name||ce.path.split("/").pop()||"source-file",q=ce.mediaType||"application/octet-stream"}else if(o()==="opf")x=await d().readFile(l().id,l().pathInfo.rootfilePath),F="content.opf",q="application/xml";else return;const te=new Blob([x],{type:q}),M=URL.createObjectURL(te),Q=document.createElement("a");Q.href=M,Q.download=F,Q.style.display="none",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(M)}catch(x){console.error("Download failed:",x)}},z=x=>{switch(x){case"text":return"ð";case"image":return"ð¼ï¸";case"audio":return"ðµ";case"video":return"ð¥";default:return"ð¦"}};Rt(()=>(Lt(i()),Lt(o()),Lt(d()),Lt(l())),()=>{i()&&o()&&d()&&l()&&T()}),xn(),Bt();var O=nm(),W=u(O);{var N=x=>{var F=Hv(),q=u(F),te=u(q),M=w(q,2),Q=u(M);D((ce,be)=>{S(te,ce),S(Q,be)},[()=>n()("Select an item to preview its content"),()=>n()("Click on any row in the table to see details")],De),_(x,F)},j=(x,F)=>{{var q=M=>{var Q=Vv(),ce=u(Q),be=u(ce);D(_e=>S(be,_e),[()=>n()("Loading previewâ¦")],De),_(M,Q)},te=(M,Q)=>{{var ce=_e=>{var Ue=qv(),Ce=u(Ue),pe=u(Ce),K=w(Ce,2),oe=u(K);D(ie=>{S(pe,s(h)),S(oe,ie)},[()=>n()("Retry")],De),nt("click",K,T),_(_e,Ue)},be=_e=>{var Ue=tm(),Ce=u(Ue),pe=u(Ce),K=u(pe);{var oe=Ne=>{var Ge=$v(),Ke=u(Ge);D(he=>S(Ke,he),[()=>n()("Edit")],De),nt("click",Ge,P),_(Ne,Ge)};U(K,Ne=>{o()==="manifest"&&Ne(oe)})}var ie=w(K,2),xe=u(ie),Me=w(ie,2);{var Ae=Ne=>{var Ge=Gv(),Ke=u(Ge);D(he=>S(Ke,he),[()=>n()("Delete")],De),nt("click",Ge,$),_(Ne,Ge)};U(Me,Ne=>{o()==="manifest"&&Ne(Ae)})}var He=w(Ce,2),$e=u(He);{var Ye=Ne=>{var Ge=em(),Ke=et(Ge),he=u(Ke),ke=u(he),Te=w(he,2),Oe=u(Te),se=w(Ke,2);{var Ee=We=>{var Ve=Xv(),B=u(Ve),H=u(B);D(Z=>S(H,`${Z??""}: ${s(c).error??""}`),[()=>n()("Preview Error")],De),_(We,Ve)},ve=(We,Ve)=>{{var B=Z=>{var ue=Kv(),ye=u(ue),Se=u(ye);D(Fe=>{de(ye,"dir",Fe),S(Se,s(c).textContent),ye.dir=ye.dir},[()=>k(s(c).mediaType)?"ltr":void 0],De),_(Z,ue)},H=(Z,ue)=>{{var ye=Fe=>{var Ie=Yv(),Xe=u(Ie);D(()=>{de(Xe,"src",s(c).previewUrl),de(Xe,"alt",o()==="manifest"?i().id:i().name)}),_(Fe,Ie)},Se=(Fe,Ie)=>{{var Xe=le=>{var ae=Jv(),me=u(ae),Pe=u(me),qe=w(Pe);D(Le=>{de(Pe,"src",s(c).previewUrl),de(Pe,"type",s(c).mediaType),S(qe,` ${Le??""}`)},[()=>n()("Your browser does not support the audio element.")],De),_(le,ae)},Be=(le,ae)=>{{var me=qe=>{var Le=Zv(),re=u(Le),Y=w(u(re),2),ge=w(Y);D(ee=>{de(Y,"src",s(c).previewUrl),de(Y,"type",s(c).mediaType),S(ge,` ${ee??""}`)},[()=>n()("Your browser does not support the video element.")],De),_(qe,Le)},Pe=qe=>{var Le=Qv(),re=u(Le),Y=u(re),ge=w(re,2),ee=u(ge);D((A,J)=>{S(Y,A),S(ee,J)},[()=>n()("Binary file - preview not available"),()=>n()("Use the download button to access the file")],De),_(qe,Le)};U(le,qe=>{s(c).contentType==="video"&&s(c).previewUrl?qe(me):qe(Pe,!1)},ae)}};U(Fe,le=>{s(c).contentType==="audio"&&s(c).previewUrl?le(Xe):le(Be,!1)},Ie)}};U(Z,Fe=>{s(c).contentType==="image"&&s(c).previewUrl?Fe(ye):Fe(Se,!1)},ue)}};U(We,Z=>{s(c).contentType==="text"&&s(c).textContent?Z(B):Z(H,!1)},Ve)}};U(se,We=>{s(c).error?We(Ee):We(ve,!1)})}D(We=>{S(ke,We),S(Oe,s(c).mediaType)},[()=>z(s(c).contentType)],De),_(Ne,Ge)};U($e,Ne=>{s(c)&&Ne(Ye)})}D(Ne=>S(xe,Ne),[()=>n()("Download")],De),nt("click",ie,R),_(_e,Ue)};U(M,_e=>{s(h)?_e(ce):_e(be,!1)},Q)}};U(x,M=>{s(p)?M(q):M(te,!1)},F)}};U(W,x=>{i()?x(j,!1):x(N)})}_(r,O),at(),a()}var am=I(`<div class="outline-editor"><textarea class="outline-editor__textarea" aria-label="Navigation content editor" aria-describedby="editor-help" spellcheck="false" aria-multiline="true"></textarea> <div id="editor-help" class="sr-only">Enter navigation content in plain text. Leave empty to auto-generate from chapter titles. Press
    Ctrl+Enter (Cmd+Enter on Mac) to save navigation content.</div></div>`);function im(r,e){rt(e,!1);const[t,a]=dt(),n=()=>tt(o(),"$editorStore",t),i=st();let o=V(e,"editorStore",8),l=V(e,"placeholder",8,"Navigation content will be auto-generated from your chapters...");const d=cn();let f;function c(v){const g=v.target;clearTimeout(f),f=setTimeout(()=>{o().updateContent(g.value),d("contentChanged",{editorId:"outline-nav",timestamp:Date.now(),isEmpty:g.value.trim()===""})},300)}ur(()=>{clearTimeout(f)}),Rt(()=>n(),()=>{m(i,n().content)}),xn(),Bt();var p=am(),h=u(p);D(()=>{Qt(h,s(i)),de(h,"placeholder",l())}),nt("input",h,c),_(r,p),at(),a()}class br{static async generateFromSpine(e,t,a,n){const i={includeUntitled:!0,titleStrategy:"heading",documentTitle:"Table of Contents",cssClasses:{}},o=[];let l=1;for(const c of e)if(c.href)try{const p=`${n?.basePath}/${c.href}`,h=await t.readFile(a,p),v=new TextDecoder().decode(h),g=this.extractTitleFromXHTML(v,c.href,l,"heading");if(g||i.includeUntitled){const b={href:c.href,title:g||`Chapter ${l}`};o.push(b)}l++}catch(p){if(p instanceof Error&&p.message.includes("Workspace not found"))throw p;continue}return{xhtmlContent:this.generateNavigationXHTML(o,i.documentTitle,i.cssClasses),metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}static async processUserContent(e,t,a,n){const i={documentTitle:"Navigation",...n};let l=(await t.executeTransform(e,2e3,"nav")).html?.replace(/<body.*?>(.*)<\/body>/s,"$1")||"";const d=this.extractTitleFromXHTML(`<?xml version="1.0" encoding="UTF-8"?><html><body>${l}</body></html>`,"nav.xhtml",0,"heading")||i.documentTitle;return l=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
  <title>${this.escapeXML(d)}</title>
  <meta charset="UTF-8"/>
</head>
<body>
  <nav epub:type="toc" role="doc-toc">
    ${l}
  </nav>
</body>
</html>`,{xhtmlContent:l,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}static extractTitleFromXHTML(e,t,a,n){const o=new DOMParser().parseFromString(e,"application/xml");if(o.querySelector("parsererror"))throw new Error("Malformed XHTML");if(!o.querySelector("html"))throw new Error("Invalid XHTML structure");const f=o.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const h of f){const v=h.textContent?.trim();if(v)return v}const p=o.querySelector("title")?.textContent?.trim();return p||this.getFallbackTitle(t,a,n)}static getFallbackTitle(e,t,a){return a==="filename"?(e.split("/").pop()||"").replace(/\.[^/.]+$/,"")||null:a==="fallback"?`Chapter ${t}`:null}static generateNavigationXHTML(e,t="Table of Contents",a={}){const n=e.map(l=>`      <li><a href="${l.href}">${this.escapeXML(l.title)}</a></li>`).join(`
`),i=a.nav?` class="${a.nav}"`:"",o=a.list?` class="${a.list}"`:"";return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
  <title>${this.escapeXML(t)}</title>
  <meta charset="UTF-8"/>
</head>
<body>
  <nav epub:type="toc" role="doc-toc"${i}>
    <h1>${this.escapeXML(t)}</h1>
    <ol${o}>
${n}
    </ol>
  </nav>
</body>
</html>`}static escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}}const sm=`/**
 * Transform Execution Environment Styles
 * 
 * Minimal styling for the iframe transform execution environment.
 * Focus on functionality over appearance since this is primarily
 * for sandboxed script execution.
 */

/* Reset and base styles */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
               'Helvetica Neue', Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: #333;
  background: #fff;
}

/* Status display */
.transform-status {
  padding: 12px 16px;
  margin-bottom: 16px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  display: none;
  border: 1px solid transparent;
}

.transform-status.visible {
  display: block;
}

/* Status variants */
.transform-status.info {
  background: #e3f2fd;
  color: #0d47a1;
  border-color: #bbdefb;
}

.transform-status.success {
  background: #e8f5e8;
  color: #2e7d32;
  border-color: #c8e6c9;
}

.transform-status.error {
  background: #ffebee;
  color: #c62828;
  border-color: #ffcdd2;
}

.transform-status.warning {
  background: #fff8e1;
  color: #f57f17;
  border-color: #ffecb3;
}

/* Debug information (hidden by default) */
.debug-info {
  margin-top: 20px;
  padding: 12px;
  background: #f5f5f5;
  border-radius: 4px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  color: #666;
  display: none;
}

.debug-info.visible {
  display: block;
}

/* Error details */
.error-details {
  margin-top: 8px;
  padding: 8px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 3px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 12px;
  white-space: pre-wrap;
  word-break: break-word;
}

/* Minimal responsive adjustments */
@media (max-width: 480px) {
  body {
    padding: 12px;
  }
  
  .transform-status {
    padding: 8px 12px;
    margin-bottom: 12px;
    font-size: 13px;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .transform-status.info {
    background: #000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.success {
    background: #006600;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.error {
    background: #cc0000;
    color: #fff;
    border-color: #fff;
  }
  
  .transform-status.warning {
    background: #cc6600;
    color: #fff;
    border-color: #fff;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}`,om=`/**
 * Transform Script Execution Engine
 *
 * Provides sandboxed execution of text and DOM transform scripts
 * with timeout protection and comprehensive error handling.
 *
 * This script runs inside the iframe and communicates with the parent
 * window via postMessage for security and isolation.
 */

/**
 * Transform execution environment with sandboxing and error handling
 */
class TransformExecutionEngine {
  constructor() {
    this.textTransformScript = '';
    this.domTransformScripts = [];
    this.loadedExtensionScripts = [];
    this.debugMode = false;
    this.messageHandlers = new Map();

    this.init();
  }

  /**
   * Initialize the execution environment
   */
  init() {
    this.setupMessageHandling();
    this.setupErrorHandling();
    this.signalReady();
  }

  /**
   * Set up message handling from parent window
   */
  setupMessageHandling() {
    window.addEventListener('message', event => {
      this.handleParentMessage(event.data);
    });

    // Register message handlers
    this.messageHandlers.set('SET_TRANSFORM_SCRIPTS', this.setTransformScripts.bind(this));
    this.messageHandlers.set('SET_EXTENSION_SCRIPTS', this.setExtensionScripts.bind(this));
    this.messageHandlers.set('EXECUTE_TRANSFORM', this.executeTransform.bind(this));
    this.messageHandlers.set('SET_DEBUG_MODE', this.setDebugMode.bind(this));
    this.messageHandlers.set('PING', this.handlePing.bind(this));
  }

  /**
   * Set up global error handling
   */
  setupErrorHandling() {
    window.addEventListener('error', event => {
      console.error('Global error in transform iframe:', event.error);
      this.notifyParent('GLOBAL_ERROR', {
        message: event.error?.message || 'Unknown global error',
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack,
      });
    });

    window.addEventListener('unhandledrejection', event => {
      console.error('Unhandled promise rejection in transform iframe:', event.reason);
      this.notifyParent('UNHANDLED_REJECTION', {
        message: event.reason?.message || 'Unhandled promise rejection',
        stack: event.reason?.stack,
      });
    });
  }

  /**
   * Signal ready state to parent window
   */
  signalReady() {
    this.updateStatus('Transform execution environment ready', 'success');
    this.notifyParent('IFRAME_READY');

    if (this.debugMode) {
      this.debugLog('TransformExecutionEngine initialized');
    }
  }

  /**
   * Handle incoming messages from parent window
   */
  handleParentMessage(message) {
    if (!message || typeof message !== 'object') {
      return;
    }

    const { type, payload, messageId } = message;

    if (this.debugMode) {
      this.debugLog(\`Received message: \${type}\`, payload);
    }

    try {
      const handler = this.messageHandlers.get(type);
      if (handler) {
        handler(payload, messageId);
      } else {
        console.warn('Unknown message type received:', type);
        this.respondToParent(messageId, {
          success: false,
          error: { stage: 'communication', message: \`Unknown message type: \${type}\` },
        });
      }
    } catch (error) {
      console.error('Error handling message:', error);
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'communication',
          message: error instanceof Error ? error.message : String(error),
          stack: error instanceof Error ? error.stack : undefined,
        },
      });
    }
  }

  /**
   * Set transform scripts content
   */
  setTransformScripts(scripts, messageId) {
    try {
      this.textTransformScript = scripts.textTransform || '';
      this.domTransformScripts = scripts.domTransforms || [];

      const textScriptLength = this.textTransformScript.length;
      const domScriptCount = this.domTransformScripts.length;

      this.updateStatus(
        \`Loaded text transform (\${textScriptLength} chars) and \${domScriptCount} DOM transforms\`,
        'success'
      );

      if (this.debugMode) {
        this.debugLog('Transform scripts updated', {
          textTransform: textScriptLength > 0,
          domTransformCount: domScriptCount,
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'script-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load extension scripts dynamically into iframe context
   */
  async setExtensionScripts(scripts, messageId) {
    try {
      // Clear any previously loaded extension scripts
      this.clearLoadedExtensions();

      const scriptCount = scripts.length;
      this.updateStatus(\`Loading \${scriptCount} extension scripts...\`, 'info');

      // Load each script sequentially to avoid race conditions
      for (const script of scripts) {
        await this.loadExtensionScript(script.name, script.blobUrl);
      }

      this.updateStatus(\`Successfully loaded \${scriptCount} extension libraries\`, 'success');

      if (this.debugMode) {
        this.debugLog('Extension scripts loaded', {
          scriptCount,
          scripts: scripts.map(s => s.name),
        });
      }

      this.respondToParent(messageId, { success: true });
    } catch (error) {
      this.updateStatus(\`Failed to load extension scripts: \${error.message}\`, 'error');
      this.respondToParent(messageId, {
        success: false,
        error: {
          stage: 'extension-loading',
          message: error instanceof Error ? error.message : String(error),
        },
      });
    }
  }

  /**
   * Load a single extension script
   */
  async loadExtensionScript(name, blobUrl) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = blobUrl;

      // Set ID for easy identification in browser inspector
      // Convert name to valid HTML ID (replace invalid characters)
      const scriptId = \`extension-\${name.replace(/[^a-zA-Z0-9-_]/g, '-')}\`;
      script.id = scriptId;

      script.onload = () => {
        if (this.debugMode) {
          this.debugLog(\`Loaded extension script: \${name} (id: \${scriptId})\`);
        }
        // Clean up blob URL after loading
        URL.revokeObjectURL(blobUrl);
        resolve();
      };
      script.onerror = error => {
        URL.revokeObjectURL(blobUrl);
        reject(new Error(\`Failed to load extension script \${name}: \${error}\`));
      };

      // Add script to head to execute
      document.head.appendChild(script);

      // Store reference for cleanup
      if (!this.loadedExtensionScripts) {
        this.loadedExtensionScripts = [];
      }
      this.loadedExtensionScripts.push(script);
    });
  }

  /**
   * Clear previously loaded extension scripts
   */
  clearLoadedExtensions() {
    if (this.loadedExtensionScripts) {
      for (const script of this.loadedExtensionScripts) {
        if (script.parentNode) {
          script.parentNode.removeChild(script);
        }
      }
      this.loadedExtensionScripts = [];
    }
  }

  /**
   * Execute the complete transform pipeline
   */
  async executeTransform(request, messageId) {
    const { plainText, timeout = 3000, idref } = request;
    const startTime = performance.now();

    try {
      this.updateStatus('Executing transform pipeline...', 'info');

      if (this.debugMode) {
        this.debugLog('Starting transform execution', {
          plainTextLength: plainText.length,
          timeout,
          hasTextTransform: this.textTransformScript.length > 0,
          domTransformCount: this.domTransformScripts.length,
        });
      }

      // Step 1: Execute text transform
      let html = plainText;
      if (this.textTransformScript.trim()) {
        html = await this.executeTextTransformWithTimeout(plainText, timeout, idref);

        if (this.debugMode) {
          this.debugLog('Text transform completed', {
            inputLength: plainText.length,
            outputLength: html.length,
          });
        }
      }

      // Step 2: Execute DOM transforms in sequence
      if (this.domTransformScripts.length > 0) {
        html = await this.executeDOMTransformsWithTimeout(html, timeout, idref);

        if (this.debugMode) {
          this.debugLog('DOM transforms completed', {
            transformCount: this.domTransformScripts.length,
            finalLength: html.length,
          });
        }
      }

      const executionTime = performance.now() - startTime;
      this.updateStatus(\`Transform completed in \${executionTime.toFixed(2)}ms\`, 'success');

      this.respondToParent(messageId, {
        success: true,
        html,
        executionTime: Math.round(executionTime),
      });
    } catch (error) {
      const executionTime = performance.now() - startTime;
      this.updateStatus(
        \`Transform failed: \${error instanceof Error ? error.message : String(error)}\`,
        'error'
      );

      if (this.debugMode) {
        console.error('Transform execution failed', {
          error: error instanceof Error ? error.message : String(error),
          stage: error && typeof error === 'object' && 'stage' in error ? error.stage : 'unknown',
          executionTime: Math.round(executionTime),
        });
      }

      this.respondToParent(messageId, {
        success: false,
        error,
        executionTime: Math.round(executionTime),
      });
    }
  }

  /**
   * Execute text transform with timeout protection
   * @param {any} plainText
   * @param {any} timeout
   * @param {any} idref
   */
  executeTextTransformWithTimeout(plainText, timeout, idref) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`Text transform execution timed out after \${timeout}ms\`);
        error.stage = 'text-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeTextTransformSync(plainText, idref);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'text';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute text transform synchronously
   * @param {any} plainText
   * @param {any} idref
   */
  executeTextTransformSync(plainText, idref) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${this.textTransformScript}

      if (typeof transformText !== 'function') {
        throw new Error('transformText function is not defined in script');
      }

      return transformText;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with input text and idref
    const result = transformFunction(plainText, idref);

    // Ensure result is a string
    return typeof result === 'string' ? result : String(result);
  }

  /**
   * Execute DOM transforms with timeout protection
   * @param {any} html
   * @param {any} timeout
   * @param {any} idref
   */
  executeDOMTransformsWithTimeout(html, timeout, idref) {
    return new Promise((resolve, reject) => {
      const timeoutId = setTimeout(() => {
        const error = new Error(\`DOM transform execution timed out after \${timeout}ms\`);
        error.stage = 'dom-timeout';
        reject(error);
      }, timeout);

      try {
        const result = this.executeDOMTransformsSync(html, idref);
        clearTimeout(timeoutId);
        resolve(result);
      } catch (error) {
        clearTimeout(timeoutId);
        if (error instanceof Error) error.stage = 'dom';
        reject(this.enhanceError(error));
      }
    });
  }

  /**
   * Execute DOM transforms synchronously with direct live DOM when layout is needed
   * @param {any} html
   * @param {any} idref
   */
  executeDOMTransformsSync(html, idref) {
    // Check if any transform scripts need layout calculations
    const needsLayout = this.checkIfLayoutNeeded();

    if (this.debugMode) {
      this.debugLog(\`DOM transform mode decision: needsLayout=\${needsLayout}\`, {
        scriptCount: this.domTransformScripts.length,
        scriptsWithLayout: this.domTransformScripts.filter(script =>
          script.includes('getElementLayout')
        ).length,
      });
    }

    if (needsLayout) {
      // Use live DOM approach for layout-dependent transforms
      return this.executeDOMTransformsWithLiveDOM(html, idref);
    } else {
      // Use standard parsed document approach for simple transforms
      return this.executeDOMTransformsWithParsedDOM(html, idref);
    }
  }

  /**
   * Check if transform scripts need layout calculations
   */
  checkIfLayoutNeeded() {
    // Simple heuristic: check if any scripts mention getElementLayout
    return this.domTransformScripts.some(script => script.includes('getElementLayout'));
  }

  /**
   * Execute DOM transforms using live DOM for layout calculations
   */
  executeDOMTransformsWithLiveDOM(html, idref) {
    const tempContainer = this.createLiveDOMContainer();

    try {
      // Put content directly in live DOM
      tempContainer.innerHTML = html;

      if (this.debugMode) {
        this.debugLog('Live DOM container created:', {
          innerHTML: tempContainer.innerHTML.substring(0, 200) + '...',
          elementCount: tempContainer.querySelectorAll('*').length,
          containerWidth: tempContainer.offsetWidth,
          containerHeight: tempContainer.offsetHeight,
          firstElementInfo: tempContainer.firstElementChild
            ? {
                tagName: tempContainer.firstElementChild.tagName,
                offsetWidth: tempContainer.firstElementChild.offsetWidth,
                offsetHeight: tempContainer.firstElementChild.offsetHeight,
                textContent: tempContainer.firstElementChild.textContent?.substring(0, 50),
              }
            : 'no first element',
        });
      }

      // Execute transforms on live DOM elements
      for (let i = 0; i < this.domTransformScripts.length; i++) {
        try {
          // Pass the live container as a document-like object
          const mockDocument = this.createMockDocument(tempContainer);
          this.executeSingleDOMTransform(mockDocument, this.domTransformScripts[i], i, idref);
        } catch (error) {
          if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
          throw error;
        }
      }

      // Return the transformed HTML from live DOM (including body element and attributes)
      // Create a body element with the container's attributes and content
      const serializer = new XMLSerializer();
      const bodyElement = document.createElement('body');

      // Copy all attributes from container to body
      for (let i = 0; i < tempContainer.attributes.length; i++) {
        const attr = tempContainer.attributes[i];
        bodyElement.setAttribute(attr.name, attr.value);
      }
      bodyElement.innerHTML = tempContainer.innerHTML;

      return serializer.serializeToString(bodyElement);
    } finally {
      this.cleanupTempAttachment(tempContainer);
    }
  }

  /**
   * Execute DOM transforms using parsed DOM (traditional approach)
   */
  executeDOMTransformsWithParsedDOM(html, idref) {
    // Parse HTML to DOM document
    const parser = new DOMParser();
    let document = parser.parseFromString(
      \`<!DOCTYPE html><html><head></head><body>\${html}</body></html>\`,
      'text/html'
    );

    // Execute each DOM transform in sequence
    for (let i = 0; i < this.domTransformScripts.length; i++) {
      try {
        document = this.executeSingleDOMTransform(document, this.domTransformScripts[i], i, idref);
      } catch (error) {
        if (error instanceof Error) error.stage = \`dom-transform-\${i}\`;
        throw error;
      }
    }

    // Return transformed HTML content with XHTML compliance (including body element and attributes)
    const serializer = new XMLSerializer();
    const fullBodySerialization = serializer.serializeToString(document.body);
    return fullBodySerialization;
  }

  /**
   * Create a live DOM container for layout calculations
   */
  createLiveDOMContainer() {
    const container = document.createElement('div');
    container.id = 'transform-live-container';

    // Set styles via JavaScript properties instead of CSS strings
    // This works better in iframe environments
    const style = container.style;
    style.position = 'fixed';
    style.top = '0px';
    style.left = '0px';
    style.width = '800px';
    style.minHeight = '600px';
    style.visibility = 'hidden';
    style.pointerEvents = 'none';
    style.fontFamily = 'Georgia, serif';
    style.fontSize = '16px';
    style.lineHeight = '1.6';
    style.color = 'black';
    style.backgroundColor = 'white';
    style.display = 'block';
    style.boxSizing = 'border-box';
    style.padding = '20px';

    document.body.appendChild(container);

    // Force layout calculation by accessing offsetWidth immediately
    const forceLayout1 = container.offsetWidth;

    // Try a different approach if that didn't work - temporarily make visible
    if (forceLayout1 === 0) {
      style.visibility = 'visible';
      style.opacity = '0';
      const forceLayout2 = container.offsetWidth;
      style.visibility = 'hidden';
      style.opacity = '1';

      if (this.debugMode) {
        this.debugLog('Container had zero width, tried visibility workaround', {
          beforeWorkaround: forceLayout1,
          afterWorkaround: forceLayout2,
        });
      }
    }

    if (this.debugMode) {
      this.debugLog('Created live DOM container for layout calculations', {
        offsetWidth: container.offsetWidth,
        offsetHeight: container.offsetHeight,
        clientWidth: container.clientWidth,
        clientHeight: container.clientHeight,
        computedWidth: window.getComputedStyle(container).width,
        computedDisplay: window.getComputedStyle(container).display,
        parentElement: container.parentElement ? container.parentElement.tagName : 'none',
        documentBody: document.body ? 'exists' : 'missing',
      });
    }

    return container;
  }

  /**
   * Create a mock document object that uses the live container as its body
   */
  createMockDocument(container) {
    return {
      body: container,
      querySelector: selector => container.querySelector(selector),
      querySelectorAll: selector => container.querySelectorAll(selector),
      createElement: tagName => document.createElement(tagName),
      // Add other document methods as needed
    };
  }

  /**
   * Clean up temporary DOM container
   */
  cleanupTempAttachment(container) {
    if (container && container.parentNode) {
      container.parentNode.removeChild(container);

      if (this.debugMode) {
        this.debugLog('Cleaned up temporary DOM container');
      }
    }
  }

  /**
   * Execute a single DOM transform script
   * @param {any} document
   * @param {any} script
   * @param {any} index
   * @param {any} idref
   */
  executeSingleDOMTransform(document, script, index, idref) {
    // Create sandboxed execution environment
    const globals = this.createSafeExecutionEnvironment();
    const globalNames = Object.keys(globals);
    const globalValues = Object.values(globals);

    // Wrap script in function with restricted globals
    const wrappedScript = \`(function(\${globalNames.join(', ')}) {
      \${script}

      if (typeof transformDOM !== 'function') {
        throw new Error('transformDOM function is not defined in script \${index}');
      }

      return transformDOM;
    })\`;

    // Execute wrapped script to get transform function
    const scriptFunction = new Function('return ' + wrappedScript)();
    const transformFunction = scriptFunction(...globalValues);

    // Execute transform with document and idref
    const result = transformFunction(document, idref);

    // Ensure result is a Document, return original if not
    return result instanceof Document ? result : document;
  }

  /**
   * Create safe execution environment with restricted globals
   */
  createSafeExecutionEnvironment() {
    // Start with safe browser APIs
    const safeGlobals = {
      // Safe JavaScript built-ins
      console,
      JSON,
      Math,
      Date,
      RegExp,
      String,
      Number,
      Boolean,
      Array,
      Object,
      parseInt,
      parseFloat,
      isNaN,
      isFinite,

      // Safe DOM APIs (document is special-cased for transforms)
      document: typeof document !== 'undefined' ? document : undefined,
      DOMParser: typeof DOMParser !== 'undefined' ? DOMParser : undefined,

      // Layout calculation utilities for attached DOM elements
      getElementLayout: this.createLayoutUtility(),

      // Extension libraries are available as native window globals after dynamic loading
    };

    // Explicitly remove dangerous globals that could break sandbox
    const dangerousGlobals = [
      'eval',
      'Function',
      'setTimeout',
      'setInterval',
      'clearTimeout',
      'clearInterval',
      'setImmediate',
      'clearImmediate',
      'requestAnimationFrame',
      'XMLHttpRequest',
      'fetch',
      'WebSocket',
      'EventSource',
      'import',
      'require',
      'process',
      'global',
      'globalThis',
      'window',
      'self',
      'parent',
      'top',
      'frames',
      'location',
      'history',
      'navigator',
      'localStorage',
      'sessionStorage',
      'indexedDB',
      'Worker',
      'SharedWorker',
    ];

    dangerousGlobals.forEach(dangerous => {
      delete safeGlobals[dangerous];
    });

    return safeGlobals;
  }

  /**
   * Create layout calculation utility for transform scripts
   */
  createLayoutUtility() {
    return element => {
      // Check if this is a real DOM element in the browser
      if (!element || !element.getBoundingClientRect) {
        if (this.debugMode) {
          this.debugLog('Layout requested for non-live element, returning defaults');
        }
        return {
          width: 0,
          height: 0,
          offsetWidth: 0,
          offsetHeight: 0,
          clientWidth: 0,
          clientHeight: 0,
          scrollWidth: 0,
          scrollHeight: 0,
          isAttached: false,
        };
      }

      // Element is live DOM - calculate real layout information
      const computedStyle = window.getComputedStyle(element);
      const rect = element.getBoundingClientRect();

      const layout = {
        // Dimensions from getBoundingClientRect (actual rendered size)
        width: rect.width,
        height: rect.height,

        // Element properties (includes padding/border/scrollbars)
        offsetWidth: element.offsetWidth,
        offsetHeight: element.offsetHeight,

        // Client dimensions (content + padding, excludes scrollbars/border)
        clientWidth: element.clientWidth,
        clientHeight: element.clientHeight,

        // Scroll dimensions (total content size)
        scrollWidth: element.scrollWidth,
        scrollHeight: element.scrollHeight,

        // Computed styles (useful for layout calculations)
        marginLeft: parseInt(computedStyle.marginLeft, 10) || 0,
        marginRight: parseInt(computedStyle.marginRight, 10) || 0,
        marginTop: parseInt(computedStyle.marginTop, 10) || 0,
        marginBottom: parseInt(computedStyle.marginBottom, 10) || 0,

        paddingLeft: parseInt(computedStyle.paddingLeft, 10) || 0,
        paddingRight: parseInt(computedStyle.paddingRight, 10) || 0,
        paddingTop: parseInt(computedStyle.paddingTop, 10) || 0,
        paddingBottom: parseInt(computedStyle.paddingBottom, 10) || 0,

        borderLeftWidth: parseInt(computedStyle.borderLeftWidth, 10) || 0,
        borderRightWidth: parseInt(computedStyle.borderRightWidth, 10) || 0,
        borderTopWidth: parseInt(computedStyle.borderTopWidth, 10) || 0,
        borderBottomWidth: parseInt(computedStyle.borderBottomWidth, 10) || 0,

        // Position information
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,

        // Attachment status
        isAttached: true,
      };

      if (this.debugMode) {
        this.debugLog('Layout calculated for live DOM element', {
          tagName: element.tagName,
          width: layout.width,
          height: layout.height,
          isAttached: layout.isAttached,
        });
      }

      return layout;
    };
  }

  /**
   * Enhance error object with additional context
   */
  enhanceError(error) {
    const enhanced = {
      message: error && error.message ? error.message : 'Unknown error',
      stage: error && error.stage ? error.stage : 'unknown',
      stack: error && error.stack ? error.stack : undefined,
    };

    // Try to extract line/column information from stack trace
    if (error && error.stack) {
      const lineMatch = error.stack.match(/at.*:(\\d+):(\\d+)/);
      if (lineMatch) {
        enhanced.line = parseInt(lineMatch[1], 10);
        enhanced.column = parseInt(lineMatch[2], 10);
      }
    }

    return enhanced;
  }

  /**
   * Set debug mode
   * @param {any} enabled
   * @param {any} messageId
   */
  setDebugMode(enabled, messageId) {
    this.debugMode = Boolean(enabled);
    this.updateStatus(\`Debug mode \${this.debugMode ? 'enabled' : 'disabled'}\`, 'info');
    this.respondToParent(messageId, { success: true, debugMode: this.debugMode });
  }

  /**
   * Handle ping message for connectivity testing
   * @param {any} payload
   * @param {any} messageId
   */
  handlePing(payload, messageId) {
    const timestamp = Date.now();
    this.respondToParent(messageId, {
      success: true,
      pong: true,
      timestamp,
      payload,
    });
  }

  /**
   * Update status display in iframe
   * @param {any} message
   * @param {string} type
   */
  updateStatus(message, type = 'info') {
    const statusElement = document.getElementById('status');
    if (statusElement) {
      statusElement.textContent = message;
      statusElement.className = \`transform-status visible \${type}\`;
    }

    if (this.debugMode) {
      console.log(\`[\${type.toUpperCase()}] \${message}\`);
    }
  }

  /**
   * Send notification to parent window (no response expected)
   * @param {any} type
   * @param {any} payload
   */
  notifyParent(type, payload = {}) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ type, payload }, '*');
    }
  }

  /**
   * Respond to parent window message
   * @param {any} messageId
   * @param {any} result
   */
  respondToParent(messageId, result) {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage(
        {
          type: 'TRANSFORM_RESULT',
          messageId,
          payload: {
            result: result,
          },
        },
        '*'
      );
    }
  }

  /**
   * Debug logging utility
   * @param {any} message
   * @param {any} data
   */
  debugLog(message, data = null) {
    if (this.debugMode) {
      const timestamp = new Date().toISOString();
      console.log(\`[DEBUG \${timestamp}] \${message}\`, data || '');
    }
  }
}

// Initialize the transform execution engine when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    new TransformExecutionEngine();
  });
} else {
  new TransformExecutionEngine();
}
`;class lm{constructor(e,t){this.extensionManager=t,this.blobURLManager=e}iframe=null;messageId=0;pendingMessages=new Map;blobURLManager;async initialize(){this.iframe=this.createPersistentIframe(),document.body.appendChild(this.iframe),window.addEventListener("message",this.handleMessage.bind(this)),await this.waitForReady()}async setTransformScripts(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_TRANSFORM_SCRIPTS",e)}async executeTransform(e,t=3e3,a){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("EXECUTE_TRANSFORM",{plainText:e,timeout:t,idref:a})}async setDebugMode(e){if(!this.iframe)throw new Error("Transform engine not initialized");await this.sendMessage("SET_DEBUG_MODE",e)}async ping(e){if(!this.iframe)throw new Error("Transform engine not initialized");return await this.sendMessage("PING",e)}async setWorkspaceExtensions(e){if(this.extensionManager)try{const t=await this.loadExtensionScripts(e);await this.sendMessage("SET_EXTENSION_SCRIPTS",t)}catch(t){console.error("Failed to load workspace extensions:",t)}}async loadExtensionScripts(e){if(!this.extensionManager)return[];const t=await this.extensionManager.listWorkspaceExtensions(e),a=[];for(const n of t)try{const i=n.files.filter(o=>o.type==="javascript");for(const o of i){const l=`SOURCE/extensions/${n.name}/${o.filename}`,f=await Wt.getInstance().readFile(e,l),c="application/javascript",p=new Blob([f],{type:c}),h=URL.createObjectURL(p);a.push({name:`${n.name}/${o.filename}`,blobUrl:h})}}catch(i){console.warn(`Failed to load extension ${n.name}:`,i)}return a}cleanup(){for(const[e,t]of this.pendingMessages)clearTimeout(t.timeout),t.reject(new Error("Transform engine shutting down"));this.pendingMessages.clear(),this.iframe&&(this.iframe.remove(),this.iframe=null),window.removeEventListener("message",this.handleMessage.bind(this))}createPersistentIframe(){const e=document.createElement("iframe");e.style.visibility="hidden",e.style.position="absolute",e.style.left="-9999px",e.style.top="0px",e.style.width="800px",e.style.height="600px";const t=this.createIframeDocument(),a=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(a);return e.src=n,e.onload=()=>{URL.revokeObjectURL(n)},e}createIframeDocument(){return`<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Transform Engine</title>
  <style>
${sm}
  </style>
</head>
<body>
  <div id="status" class="transform-status">Transform engine initializing...</div>
  <script>
${om}
  <\/script>
</body>
</html>`}async sendMessage(e,t){const a=++this.messageId;return new Promise((n,i)=>{const o=setTimeout(()=>{this.pendingMessages.delete(a),i(new Error(`Message timeout: ${e}`))},5e3);this.pendingMessages.set(a,{resolve:l=>{clearTimeout(o),n(l)},reject:l=>{clearTimeout(o),i(l)},timeout:o}),this.iframe?.contentWindow?this.iframe.contentWindow.postMessage({type:e,payload:t,messageId:a},"*"):(this.pendingMessages.delete(a),clearTimeout(o),i(new Error("Iframe not available")))})}handleMessage(e){if(e.source!==this.iframe?.contentWindow)return;const{type:t,messageId:a,payload:n}=e.data;if(t==="TRANSFORM_RESULT"&&a){const i=this.pendingMessages.get(a);if(i)if(this.pendingMessages.delete(a),n?.result?.success)i.resolve(n.result);else{const o=n?.result?.error||{message:"Unknown transform error"},l={stage:o.stage||"unknown",message:String(o.message||o||"Transform failed"),line:o.line,column:o.column,stack:o.stack};i.reject(l)}}else t==="IFRAME_READY"||(t==="GLOBAL_ERROR"||t==="UNHANDLED_REJECTION")&&console.error(`Transform engine ${t.toLowerCase()}:`,n)}waitForReady(){return new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("Transform engine initialization timeout"))},1e4),n=i=>{i.source===this.iframe?.contentWindow&&i.data.type==="IFRAME_READY"&&(clearTimeout(a),window.removeEventListener("message",n),e())};window.addEventListener("message",n)})}}var cm=I('<div class="outline-view svelte-vjoxn9" role="group" aria-label="Navigation editor"><div aria-live="polite" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <div aria-live="assertive" aria-atomic="true" class="sr-only svelte-vjoxn9"></div> <!></div>');function dm(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(l,"$outlineStore",t);let i=V(e,"workspace",7);const o=`outline-nav-${Date.now()}-${Math.random().toString(36).substring(2,8)}`,l=xo(o),d=new _o(i().id,e.fileStorage,e.extensionManager,e.blobURLManager,e.transformEngine,e.settingsService);let f=!1,c=null;ht(()=>{n().lastUpdated&&p(n().isEmpty)});async function p(j){try{j?await h():await v()}catch(x){e.error({message:x instanceof Error?x.message:"Unknown error occurred",stage:j?"generation":"transform"})}}async function h(){try{const j=await e.spineService.loadSpineItems(i()),x=await br.generateFromSpine(j,e.workspaceService,i().id,i().pathInfo);e.previewUpdate({xhtml:x.xhtmlContent});const F=`${i().pathInfo.basePath}/nav.xhtml`;await e.workspaceService.writeFile(i().id,F,x.xhtmlContent),await e.workspaceService.writeFile(i().id,"SOURCE/text/nav.txt","")}catch(j){console.error("Failed to generate navigation from spine:",j)}}async function v(){const j=l.getContent();if(!d){console.warn("TransformPipeline not available - falling back to auto-generation"),await h();return}try{const x=await br.processUserContent(j,d,i().id);e.previewUpdate({xhtml:x.xhtmlContent,warnings:[]}),await e.workspaceService.writeFile(i().id,"SOURCE/text/nav.txt",j);const q=`${i().pathInfo.basePath}/nav.xhtml`;try{await e.workspaceService.removeManifestItem(i(),q)}catch{}await e.workspaceService.writeFile(i().id,q,x.xhtmlContent);try{await e.workspaceService.addManifestItem(i(),{href:"nav.xhtml",id:"nav",properties:["nav"]})}catch{}}catch(x){console.error("Failed to process user content:",x)}}async function g(){await $();try{const j="SOURCE/text/nav.txt";if(await e.workspaceService.fileExists(i().id,j)){const F=await e.workspaceService.readFile(i().id,j),q=new TextDecoder().decode(F);l.updateContent(q)}else l.updateContent("")}catch(j){console.error("Failed to load navigation content:",j)}}async function b(){await $();try{const j=l.getContent();await e.workspaceService.writeFile(i().id,"SOURCE/text/nav.txt",j);let F;if(j.trim()===""){const M=await e.spineService.loadSpineItems(i());F=await br.generateFromSpine(M,e.workspaceService,i().id,i().pathInfo)}else if(d)F=await br.processUserContent(j,d,i().id);else{console.warn("TransformPipeline not available - using auto-generation instead of user content");const M=await e.spineService.loadSpineItems(i());F=await br.generateFromSpine(M,e.workspaceService,i().id,i().pathInfo)}await e.workspaceService.writeFile(i().id,"OEBPS/nav.xhtml",F.xhtmlContent);const te=i().opf.manifest.find(M=>M.id==="nav"||M.properties?.includes("nav"));te?te.href!=="nav.xhtml"&&i(await e.workspaceService.updateManifestItem(i(),te.id,{href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]})):i(await e.workspaceService.addManifestItem(i(),{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]}))}catch(j){console.error("Failed to save navigation content:",j)}}function y(j){}let L,k;async function E(j){if(j.key==="Enter"&&(j.ctrlKey||j.metaKey)){j.preventDefault();try{await b(),L&&(L.textContent="Navigation saved successfully",setTimeout(()=>{L.textContent=""},3e3))}catch(x){k&&(k.textContent=`Save failed: ${x instanceof Error?x.message:"Unknown error"}`,setTimeout(()=>{k.textContent=""},5e3))}}}rn(async()=>{c||(c=T()),await c}),ur(()=>{f=!1,c=null,l.destroy()});async function T(){try{f=!0,await g()}catch(j){console.error("Failed to initialize OutlineView:",j)}}function P(){return f}async function $(){if(!f){if(c){await c;return}throw new Error("Component not mounted")}}var R=cm(),z=u(R);Ut(z,j=>L=j,()=>L);var O=w(z,2);Ut(O,j=>k=j,()=>k);var W=w(O,2);im(W,{get editorStore(){return l},placeholder:"Navigation content will be auto-generated from your chapters...",$$events:{contentChanged:y}}),nt("keydown",R,E),_(r,R);var N=at({loadNavigationContent:g,saveNavigationContent:b,isReady:P,waitForReady:$});return a(),N}var um=I('<div><div class="content-preview__container svelte-166aukc"><div class="content-preview__letterbox svelte-166aukc"><iframe class="content-preview__iframe svelte-166aukc" title="Content Preview"></iframe></div></div></div>');function fm(r,e){rt(e,!1);let t=V(e,"content",8),a=V(e,"deviceSize",8,"responsive"),n=V(e,"orientation",8,"portrait"),i=V(e,"fontSizeAdjustment",8,0),o=V(e,"fontFamily",8,"default"),l=V(e,"onNavigate",8,void 0),d=V(e,"class",8,"");const f={"old-iphone":{width:375,height:667,fontSize:16,margin:12,lineHeight:1.4},"recent-iphone":{width:390,height:844,fontSize:17,margin:14,lineHeight:1.4},"large-iphone":{width:430,height:932,fontSize:18,margin:16,lineHeight:1.4},"small-tablet":{width:744,height:1133,fontSize:20,margin:20,lineHeight:1.5},"medium-tablet":{width:820,height:1180,fontSize:22,margin:24,lineHeight:1.5},"large-tablet":{width:1024,height:1366,fontSize:24,margin:28,lineHeight:1.5}};let c=st(),p=st(),h=st();function v(R,z){if(R==="responsive")return null;const O=f[R];return z==="landscape"?{width:O.height,height:O.width}:{width:O.width,height:O.height}}function g(R,z){if(R==="responsive")return"";const O=f[R];return`body {
      font-size: ${O.fontSize+z}px;
      margin: ${O.margin}px;
      line-height: ${O.lineHeight};
    }`}function b(R,z,O,W){if(!R)return;const N=R.contentDocument;if(!N)return;if(N.head){const x=N.head.querySelector(".device-injected-styles");x&&x.remove()}let j="";if(j+=g(z,W),j){const x=N.createElement("style");if(x.className="device-injected-styles",x.textContent=j,N.head){const F=N.head.querySelector('style, link[rel="stylesheet"]');F?N.head.insertBefore(x,F):N.head.appendChild(x)}}}function y(R,z){const O=R.width/z.width,W=R.height/z.height;return Math.min(O,W)}function L(){if(!s(c)||!s(p)||!s(h))return;const R=v(a(),n());if(!R){St(p,s(p).style.transform=""),St(p,s(p).style.width="100%"),St(p,s(p).style.height="100%"),St(h,s(h).style.width="100%"),St(h,s(h).style.height="100%");return}const z=s(c).getBoundingClientRect(),O=y(z,R);St(h,s(h).style.width=`${R.width}px`),St(h,s(h).style.height=`${R.height}px`),St(p,s(p).style.transform=`scale(${O})`),St(p,s(p).style.transformOrigin="center"),St(p,s(p).style.width=`${R.width}px`),St(p,s(p).style.height=`${R.height}px`)}function k(){s(h)&&(b(s(h),a(),o(),i()),l()&&s(h).contentDocument&&s(h).contentDocument.addEventListener("click",R=>{const z=R.target;if(z.tagName==="A"&&z.href){const O=z.getAttribute("href");if(O&&O.includes(".xhtml")){R.preventDefault();const W=O.match(/([^/]+)\.xhtml(#.*)?$/);if(W){const N=W[1];l()(N)}}}}))}rn(()=>{L();let R=null;return typeof ResizeObserver<"u"&&(R=new ResizeObserver(()=>{L()})),s(c)&&R&&R.observe(s(c)),()=>{R&&R.disconnect()}}),Rt(()=>(s(h),Lt(t())),()=>{s(h)&&t()&&St(h,s(h).srcdoc=t())}),Rt(()=>(s(c),s(p),s(h)),()=>{s(c)&&s(p)&&s(h)&&L()}),Rt(()=>(s(h),Lt(a()),Lt(o()),Lt(i())),()=>{s(h)&&b(s(h),a(),o(),i())}),xn(),Bt();var E=um(),T=u(E),P=u(T),$=u(P);Ut($,R=>m(h,R),()=>s(h)),Ut(T,R=>m(p,R),()=>s(p)),Ut(E,R=>m(c,R),()=>s(c)),D(()=>{ct(E,1,`content-preview ${d()??""}`,"svelte-166aukc"),de($,"srcdoc",t())}),nt("load",$,k),_(r,E),at()}const pm=[{field:"title",xmlPattern:"dublin-core",selector:"dc:title",displayName:"Title"},{field:"language",xmlPattern:"dublin-core",selector:"dc:language",displayName:"Language"},{field:"identifier",xmlPattern:"dublin-core",selector:"dc:identifier",displayName:"Identifier"},{field:"publisher",xmlPattern:"dublin-core",selector:"dc:publisher",displayName:"Publisher"},{field:"date",xmlPattern:"dublin-core",selector:"dc:date",displayName:"Date"},{field:"description",xmlPattern:"dublin-core",selector:"dc:description",displayName:"Description"},{field:"rights",xmlPattern:"dublin-core",selector:"dc:rights",displayName:"Rights"},{field:"source",xmlPattern:"dublin-core",selector:"dc:source",displayName:"Source"},{field:"relation",xmlPattern:"dublin-core",selector:"dc:relation",displayName:"Relation"},{field:"coverage",xmlPattern:"dublin-core",selector:"dc:coverage",displayName:"Coverage"},{field:"type",xmlPattern:"dublin-core",selector:"dc:type",displayName:"Type"},{field:"format",xmlPattern:"dublin-core",selector:"dc:format",displayName:"Format"},{field:"creator",xmlPattern:"dublin-core",selector:"dc:creator",displayName:"Creator",isArray:!0},{field:"contributor",xmlPattern:"dublin-core",selector:"dc:contributor",displayName:"Contributor",isArray:!0},{field:"subject",xmlPattern:"dublin-core",selector:"dc:subject",displayName:"Subject",isArray:!0},{field:"renditionLayout",xmlPattern:"meta-property",selector:'meta[property="rendition:layout"]',displayName:"Layout"},{field:"renditionOrientation",xmlPattern:"meta-property",selector:'meta[property="rendition:orientation"]',displayName:"Orientation"},{field:"renditionSpread",xmlPattern:"meta-property",selector:'meta[property="rendition:spread"]',displayName:"Spread"}];class hm{mappings;constructor(){this.mappings=pm}highlightOPFContent(e,t={}){const{focusedField:a,highlightValues:n=!0,highlightTags:i=!0,pageProgressionDirection:o}=t;try{const l=this.formatXML(e);let d=this.escapeHTML(l);for(const f of this.mappings){const c=a===f.field;d=this.highlightFieldInXML(d,f,c,n,i)}return d=this.addStructuralHighlighting(d,o),{highlightedXML:d.trim(),fieldMappings:this.mappings}}catch(l){return console.warn("XML highlighting failed:",l),{highlightedXML:this.escapeHTML(e),fieldMappings:this.mappings}}}highlightFieldInXML(e,t,a,n,i){return t.xmlPattern==="dublin-core"?this.highlightDublinCoreField(e,t,a,n,i):this.highlightMetaPropertyField(e,t,a,n,i)}highlightDublinCoreField(e,t,a,n,i){const o=t.selector.replace("dc:",""),l=new RegExp(`(&lt;dc:${o}[^<]*?&gt;)(.*?)(&lt;/dc:${o}&gt;)`,"gi");return e.replace(l,(d,f,c,p)=>{let h="";return i?h+=`<span class="${a?"metadata-tag-focused":"metadata-tag"}">${f}</span>`:h+=f,n&&c.trim()?h+=`<span class="${a?"metadata-value-focused":"metadata-value"}">${c}</span>`:h+=c,i?h+=`<span class="${a?"metadata-tag-focused":"metadata-tag"}">${p}</span>`:h+=p,h})}highlightMetaPropertyField(e,t,a,n,i){const o=t.selector.match(/property="([^"]+)"/);if(!o)return e;const l=o[1],d=new RegExp(`(&lt;meta[^&]*?property=&quot;${l.replace(":","\\:")}&quot;[^&]*?&gt;)(.*?)(&lt;/meta&gt;)`,"gi");return e.replace(d,(f,c,p,h)=>{let v="";return i?v+=`<span class="${a?"metadata-tag-focused":"metadata-tag"}">${c}</span>`:v+=c,n&&p.trim()?v+=`<span class="${a?"metadata-value-focused":"metadata-value"}">${p}</span>`:v+=p,i?v+=`<span class="${a?"metadata-tag-focused":"metadata-tag"}">${h}</span>`:v+=h,v})}formatXML(e){return e.replace(/^<\?xml[^>]+\?>[\s\n]*/,"").replace(/></g,`>
<`).replace(/^\s*\n/gm,"").trim()}escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}addStructuralHighlighting(e,t){let a=e;return a=a.replace(/(&lt;package[^>]*?&gt;)/g,'<span class="structural-element">$1</span>'),a=a.replace(/(&lt;\/package&gt;)/g,'<span class="structural-element">$1</span>'),a=a.replace(/(&lt;manifest&gt;[\s\S]*?&lt;\/manifest&gt;)/g,'<span class="structural-element">$1</span>'),t&&t!=="default"&&t!==""||(a=a.replace(/(&lt;spine&gt;[\s\S]*?&lt;\/spine&gt;)/g,'<span class="structural-element">$1</span>')),a}getFieldMapping(e){return this.mappings.find(t=>t.field===e)}getAllFieldMappings(){return[...this.mappings]}}const vm=new hm;var mm=I(" <!>",1),gm=I('<div><div class="field-label svelte-uhoge6"> </div> <div class="field-value svelte-uhoge6"></div></div>'),wm=I('<div><div class="field-label svelte-uhoge6"> </div> <div class="field-value description svelte-uhoge6"> </div></div>'),ym=I('<div class="preview-body svelte-uhoge6"><div class="metadata-summary svelte-uhoge6"><div><div class="field-label svelte-uhoge6"> </div> <div class="field-value svelte-uhoge6"> </div></div> <div><div class="field-label svelte-uhoge6"> </div> <div class="field-value svelte-uhoge6"> </div></div> <!> <!> <div><div class="field-label svelte-uhoge6"> </div> <div class="field-value identifier svelte-uhoge6"> </div></div></div></div>'),bm=I('<div class="no-content svelte-uhoge6"><p> </p></div>'),_m=I('<div class="simple-metadata-view svelte-uhoge6"><div class="preview-header svelte-uhoge6"><span class="content-type-icon svelte-uhoge6">ð</span> <span class="file-name svelte-uhoge6"> </span></div> <!></div>');function xm(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"focusedField",3,null),o=ne(()=>e.workspace?.opf?.metadata);var l=_m(),d=u(l),f=w(u(d),2),c=u(f),p=w(d,2);{var h=g=>{var b=ym(),y=u(b),L=u(y);let k;var E=u(L),T=u(E),P=w(E,2),$=u(P),R=w(L,2);let z;var O=u(R),W=u(O),N=w(O,2),j=u(N),x=w(R,2);{var F=Ce=>{var pe=gm();let K;var oe=u(pe),ie=u(oe),xe=w(oe,2);Ct(xe,21,()=>s(o).creator,Pt,(Me,Ae,He)=>{var $e=mm(),Ye=et($e),Ne=w(Ye);{var Ge=Ke=>{var he=Tt(",");_(Ke,he)};U(Ne,Ke=>{He<s(o).creator.length-1&&Ke(Ge)})}D(()=>S(Ye,s(Ae))),_(Me,$e)}),D((Me,Ae)=>{K=ct(pe,1,"field-row svelte-uhoge6",null,K,Me),S(ie,Ae)},[()=>({focused:i()==="creator"}),()=>n()("Authors")]),_(Ce,pe)};U(x,Ce=>{s(o).creator&&s(o).creator.length>0&&Ce(F)})}var q=w(x,2);{var te=Ce=>{var pe=wm();let K;var oe=u(pe),ie=u(oe),xe=w(oe,2),Me=u(xe);D((Ae,He)=>{K=ct(pe,1,"field-row svelte-uhoge6",null,K,Ae),S(ie,He),S(Me,s(o).description)},[()=>({focused:i()==="description"}),()=>n()("Description")]),_(Ce,pe)};U(q,Ce=>{s(o).description&&Ce(te)})}var M=w(q,2);let Q;var ce=u(M),be=u(ce),_e=w(ce,2),Ue=u(_e);D((Ce,pe,K,oe,ie,xe,Me,Ae,He)=>{k=ct(L,1,"field-row svelte-uhoge6",null,k,Ce),S(T,pe),S($,K),z=ct(R,1,"field-row svelte-uhoge6",null,z,oe),S(W,ie),S(j,xe),Q=ct(M,1,"field-row svelte-uhoge6",null,Q,Me),S(be,Ae),S(Ue,He)},[()=>({focused:i()==="title"}),()=>n()("Title"),()=>s(o).title||n()("Untitled"),()=>({focused:i()==="language"}),()=>n()("Language"),()=>s(o).language||n()("Not specified"),()=>({focused:i()==="identifier"}),()=>n()("Identifier"),()=>s(o).identifier||n()("Not specified")]),_(g,b)},v=g=>{var b=bm(),y=u(b),L=u(y);D(k=>S(L,k),[()=>n()("No metadata available")]),_(g,b)};U(p,g=>{s(o)?g(h):g(v,!1)})}D(g=>S(c,g),[()=>n()("Metadata Summary")]),_(r,l),at(),a()}var Sm=I('<div class="error-state svelte-vzuyuw"><p class="error-message svelte-vzuyuw"> </p> <button type="button" class="retry-button svelte-vzuyuw"> </button></div>'),Em=I('<div class="preview-body svelte-vzuyuw"><div class="text-preview svelte-vzuyuw"><pre class="text-content highlighted-xml svelte-vzuyuw" dir="ltr"><!></pre></div></div>'),km=I('<div class="no-content svelte-vzuyuw"><p> </p></div>'),Tm=I('<div class="opf-preview svelte-vzuyuw"><div class="preview-header svelte-vzuyuw"><span class="content-type-icon svelte-vzuyuw">ð</span> <span class="file-name svelte-vzuyuw">content.opf</span></div> <!></div>');function Cm(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t);let i=V(e,"focusedField",3,null),o=V(e,"isAdvancedMode",3,!1),l=fe(""),d=fe(null),f=ne(()=>()=>{if(!e.workspace)return"";try{return kt.generateOPFXML(e.workspace.opf)}catch(b){return console.error("Failed to generate OPF XML:",b),""}});ht(()=>{c()});const c=()=>{if(!s(f)()){m(l,"");return}try{const b=vm.highlightOPFContent(s(f)(),{focusedField:i(),highlightValues:!0,highlightTags:!0,pageProgressionDirection:e.workspace?.opf?.metadata?.pageProgressionDirection});m(l,b.highlightedXML,!0),m(d,null)}catch(b){console.error("Failed to highlight XML:",b),m(d,n()("Failed to generate XML preview"),!0),m(l,"")}};var p=pt(),h=et(p);{var v=b=>{var y=Tm(),L=w(u(y),2);{var k=T=>{var P=Sm(),$=u(P),R=u($),z=w($,2);z.__click=c;var O=u(z);D(W=>{S(R,s(d)),S(O,W)},[()=>n()("Retry")]),_(T,P)},E=(T,P)=>{{var $=z=>{var O=Em(),W=u(O),N=u(W),j=u(N);qs(j,()=>s(l)),D(()=>N.dir=N.dir),_(z,O)},R=z=>{var O=km(),W=u(O),N=u(W);D(j=>S(N,j),[()=>n()("No content available")]),_(z,O)};U(T,z=>{s(l)?z($):z(R,!1)},P)}};U(L,T=>{s(d)?T(k):T(E,!1)})}_(b,y)},g=b=>{xm(b,{get workspace(){return e.workspace},get focusedField(){return i()}})};U(h,b=>{o()?b(v):b(g,!1)})}_(r,p),at(),a()}_t(["click"]);function Im(r,e,t,a){m(e,s(e)==="portrait"?"landscape":"portrait",!0),t(s(a))}function Fm(r,e,t,a,n,i){console.log("ð CLICK EVENT FIRED! toggleSourceView() called"),console.log("ð Current showSource state:",s(e));const o=s(e);m(e,!s(e)),console.log("ð State toggled from",o,"to",s(e)),s(e)||(console.log("ð About to call updatePreviewContent and re-apply device settings"),setTimeout(()=>{console.log("ð updatePreviewContent called"),t(a()),n(s(i))},0)),console.log("ð toggleSourceView completed")}var Mm=I('<button type="button" class="orientation-toggle svelte-32psnf" title="Toggle orientation" aria-label="Toggle device orientation"> </button>'),Pm=(r,e)=>e(r.target.value),Lm=I('<option class="svelte-32psnf"> </option>'),Rm=I('<optgroup class="svelte-32psnf"></optgroup>'),Dm=I('<div class="transform-status transforming svelte-32psnf"><div class="status-spinner svelte-32psnf"></div> <span class="svelte-32psnf">Transforming content...</span></div>'),Am=I('<div class="transform-status error svelte-32psnf"><span class="status-icon svelte-32psnf">ð¨</span> <span class="svelte-32psnf"> </span></div>'),Om=I('<div class="transform-status warning svelte-32psnf"><span class="status-icon svelte-32psnf">â ï¸</span> <span class="svelte-32psnf"> </span></div>'),Um=I('<div class="source-view svelte-32psnf"><pre class="source-code svelte-32psnf" dir="ltr"> </pre></div>'),zm=I('<details class="svelte-32psnf"><summary class="svelte-32psnf">Stack Trace</summary> <pre class="error-stack svelte-32psnf"> </pre></details>'),Wm=I('<div class="preview-error svelte-32psnf"><div class="error-content svelte-32psnf"><h3 class="svelte-32psnf">Transform Error</h3> <p class="svelte-32psnf"><strong class="svelte-32psnf">Stage:</strong> </p> <p class="svelte-32psnf"><strong class="svelte-32psnf">Message:</strong> </p> <!></div></div>'),Nm=I('<iframe class="preview-iframe svelte-32psnf" title="XHTML Preview"></iframe>'),jm=I('<div class="preview-empty svelte-32psnf"><div class="empty-content svelte-32psnf"><span class="empty-icon svelte-32psnf" aria-hidden="true">ð</span> <h3 class="svelte-32psnf">No Content</h3> <p class="svelte-32psnf">Start typing in the editor to see your XHTML preview here.</p></div></div>'),Bm=I('<div class="preview-viewport svelte-32psnf"><div class="preview-frame-wrapper svelte-32psnf"><div><!></div></div></div>'),Hm=I('<span class="update-time svelte-32psnf"> </span>'),Vm=I('<span class="content-size svelte-32psnf"> </span>'),qm=I('<span class="warning-count svelte-32psnf"> </span>'),$m=I('<div class="preview-pane-container svelte-32psnf"><div class="preview-header svelte-32psnf"><div class="preview-title svelte-32psnf"><button title="Toggle source view"> </button></div> <div class="preview-controls svelte-32psnf"><!>  <select class="device-selector svelte-32psnf"></select></div></div> <!> <div class="preview-content svelte-32psnf"><!></div> <div class="preview-footer svelte-32psnf"><div class="meta-info svelte-32psnf"><!> <!> <!></div></div></div>');function Gm(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(mt,"$t",t),i=()=>tt(R,"$lastUpdateTime",t);let o=V(e,"xhtmlContent",3,""),l=V(e,"isTransforming",3,!1),d=V(e,"transformError",3,null),f=V(e,"transformWarnings",19,()=>[]);V(e,"executionTime",3,0);let c=V(e,"onNavigate",3,void 0),p=V(e,"onPreviewClick",3,null);const h=[{id:"desktop",name:"Fill",width:"100%",height:"100%",icon:"ð¥ï¸",category:"responsive"},{id:"galaxy-s23",name:"Pocket",width:"360px",height:"800px",icon:"ð±",category:"commute"},{id:"iphone",name:"Standard",width:"375px",height:"667px",icon:"ð±",category:"commute"},{id:"pixel-7",name:"Large",width:"393px",height:"851px",icon:"ð±",category:"commute"},{id:"iphone-plus",name:"Plus",width:"414px",height:"736px",icon:"ð±",category:"commute"},{id:"ipad",name:"Compact",width:"768px",height:"1024px",icon:"ð±",category:"home"},{id:"galaxy-tab-s9",name:"Large",width:"800px",height:"1280px",icon:"ð±",category:"home"},{id:"ipad-air",name:"Extra Large",width:"820px",height:"1180px",icon:"ð±",category:"home"},{id:"kindle",name:"Standard",width:"600px",height:"800px",icon:"ð",category:"travel"},{id:"kobo-clara-2e",name:"Large",width:"758px",height:"1024px",icon:"ð",category:"travel"}],v=B=>{switch(B){case"responsive":return n()("Responsive");case"commute":return n()("Commute (phone)");case"home":return n()("Home (tablet)");case"travel":return n()("Travel (e-ink)");default:return B}},g=B=>{switch(B.name){case"Fill":return n()("Fill");case"Pocket":return n()("Pocket");case"Standard":return n()("Standard");case"Large":return n()("Large");case"Plus":return n()("Plus");case"Compact":return n()("Compact");case"Extra Large":return n()("Extra Large");default:return B.name}};let b=fe("desktop"),y=fe("portrait"),L=fe(!1),k=fe(void 0),E=fe(void 0),T=fe(void 0),P=fe(1),$=fe(null);const R=Zt(Date.now()),z=ne(()=>{const B={};for(const H of h)B[H.category]||(B[H.category]=[]),B[H.category].push(H);return B});ht(()=>{N(o())});function O(B){try{const H=B.documentElement,Z=H.scrollTop||B.body.scrollTop,ue=H.clientWidth/2,ye=Math.min(100,H.clientHeight/4),Se=B.elementFromPoint(ue,ye);if(!Se||Se===B.body||Se===H)return{element:null,id:null,offset:Z};let Fe=Se;for(;Fe&&Fe!==B.body;){if(Fe.id){const le=Fe.getBoundingClientRect(),ae=Z-(le.top+Z-ye);return{element:Fe,id:Fe.id,offset:ae}}Fe=Fe.parentElement}const Ie=Se.tagName.toLowerCase(),Be=Array.from(B.querySelectorAll(Ie)).indexOf(Se);if(Be>=0){const le=Se.getBoundingClientRect(),ae=Z-(le.top+Z-ye);return{element:Se,id:`${Ie}[${Be}]`,offset:ae}}return{element:null,id:null,offset:Z}}catch(H){return console.warn("Failed to find scroll anchor:",H),null}}function W(B,H,Z){if(!H){B.documentElement.scrollTop=Z,B.body&&(B.body.scrollTop=Z);return}try{let ue=null;if(H.id)if(H.id.includes("[")&&H.id.includes("]")){const[ye,Se]=H.id.split("["),Fe=parseInt(Se.replace("]",""),10);ue=B.querySelectorAll(ye)[Fe]||null}else ue=B.getElementById(H.id);if(ue){if(ue.scrollIntoView({behavior:"instant",block:"start"}),H.offset!==0){const ye=B.documentElement.scrollTop||B.body?.scrollTop||0,Se=Math.max(0,ye+H.offset);B.documentElement.scrollTop=Se,B.body&&(B.body.scrollTop=Se)}}else B.documentElement.scrollTop=Z,B.body&&(B.body.scrollTop=Z)}catch(ue){console.warn("Failed to restore scroll position:",ue),B.documentElement.scrollTop=Z,B.body&&(B.body.scrollTop=Z)}}function N(B){if(!(!s(k)||!B))try{const H=s(k).contentDocument;if(!H)return;const Z=H.documentElement.scrollTop||H.body?.scrollTop||0,ue=Z>0?O(H):null;m($,{anchor:ue,fallbackScrollTop:Z},!0),H.open(),H.write(B),H.close(),R.set(Date.now())}catch(H){console.error("Failed to update preview content:",H)}}function j(B){const H=parseInt(B.width.replace("px","")),Z=parseInt(B.height.replace("px",""));return s(y)==="landscape"?{width:Z,height:H}:{width:H,height:Z}}function x(B){if(B.id==="desktop")return 1;try{if(!s(T))return 1;const H=s(T).getBoundingClientRect(),Z=Math.max(200,H.width-40),ue=Math.max(200,H.height-40),{width:ye,height:Se}=j(B),Fe=Z/ue,Ie=ye/Se;let Xe;return Fe>Ie?Xe=ue/Se:Xe=Z/ye,Math.min(Math.max(Xe,.1),2)}catch(H){return console.warn("Failed to calculate optimal scale:",H),1}}function F(B){m(b,B,!0);const H=h.find(Z=>Z.id===B);if(H&&s(E)){const Z=s(E).parentElement;H.id==="desktop"?(s(E).style.width="100%",s(E).style.height="100%",s(E).style.maxWidth="none",s(E).style.maxHeight="none",Z&&(Z.style.width="100%",Z.style.height="100%"),m(P,1)):setTimeout(()=>{if(s(E)){const ue=x(H),{width:ye,height:Se}=j(H);s(E).style.width=ye+"px",s(E).style.height=Se+"px",s(E).style.maxWidth=ye+"px",s(E).style.maxHeight=Se+"px",Z&&(Z.style.width=Math.round(ye*ue)+"px",Z.style.height=Math.round(Se*ue)+"px"),m(P,ue,!0)}},0)}}function q(B){return new Date(B).toLocaleTimeString()}function te(B){const H=s(k)?.contentDocument;if(!H)return 0;try{const Z=H.createTreeWalker(H.body,NodeFilter.SHOW_TEXT,null);let ue=0,ye;for(;(ye=Z.nextNode())&&!B.contains(ye);)ue+=ye.textContent?.length||0;return ue}catch(Z){return console.warn("Failed to estimate document position:",Z),0}}function M(B){if(!p())return;const H=B.target;if(!H)return;const Z=H.closest("p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th")||H,ue=Z.textContent?.trim();if(!(!ue||ue.length<8)&&!(ue.length>500))try{const ye=te(Z),Se=Z.tagName.toLowerCase();p()({text:ue,documentPosition:ye,elementType:Se})}catch(ye){console.warn("Failed to handle preview click:",ye)}}function Q(B){B.addEventListener("click",M);const H=B.createElement("style");H.textContent=`
      body {
        /* margin: 0; */
        /* padding: 0; */
        /* font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; */
        /* line-height: 1.6; */
      }

      /* Ensure images are responsive */
      img {
        max-width: 100%;
        height: auto;
      }

      /* Add some visual feedback for empty content */
      body:empty::before {
        content: 'No content to preview';
        color: #666;
        font-style: italic;
        display: block;
        text-align: center;
        padding: 2rem;
      }

      /* Indicate clickable text elements */
      p, h1, h2, h3, h4, h5, h6, div, span, li, blockquote, td, th {
        cursor: pointer;
      }

      /* Visual feedback on hover */
      p:hover, h1:hover, h2:hover, h3:hover, h4:hover, h5:hover, h6:hover,
      div:hover, span:hover, li:hover, blockquote:hover, td:hover, th:hover {
        /* background-color: rgba(59, 130, 246, 0.1); */
        outline: 1px solid rgba(59, 130, 246, 0.3);
        outline-offset: 1px;
      }
    `,B.head.appendChild(H)}function ce(){if(s(k)?.contentDocument){const B=s(k).contentDocument;Q(B),c()&&s(k).contentDocument&&s(k).contentDocument.addEventListener("click",H=>{const Z=H.target;if(Z.tagName==="A"&&Z.href){const ue=Z.getAttribute("href");if(ue&&ue.includes(".xhtml")){H.preventDefault();const ye=ue.match(/([^/]+)\.xhtml(#.*)?$/);if(ye){const Se=ye[1];c()(Se)}}}}),s($)&&requestAnimationFrame(()=>{W(B,s($).anchor,s($).fallbackScrollTop),m($,null)})}}let be=null;rn(()=>{F(s(b)),typeof ResizeObserver<"u"&&(be=new ResizeObserver(()=>{setTimeout(()=>{F(s(b))},400)}),s(T)&&be.observe(s(T)));const B=()=>{setTimeout(()=>F(s(b)),400)};return window.addEventListener("resize",B),()=>{be?.disconnect(),window.removeEventListener("resize",B)}});var _e=$m(),Ue=u(_e),Ce=u(Ue),pe=u(Ce);let K;pe.__click=[Fm,L,N,o,F,b];var oe=u(pe),ie=w(Ce,2),xe=u(ie);{var Me=B=>{var H=Mm();H.__click=[Im,y,F,b];var Z=u(H);D(()=>S(Z,s(y)==="portrait"?"â­":"â¯")),_(B,H)};U(xe,B=>{s(b)!=="desktop"&&B(Me)})}var Ae=w(xe,2);Ae.__change=[Pm,F],Ct(Ae,21,()=>Object.entries(s(z)),Pt,(B,H)=>{var Z=ne(()=>Ao(s(H),2));let ue=()=>s(Z)[0],ye=()=>s(Z)[1];var Se=Rm();Ct(Se,21,ye,Pt,(Fe,Ie)=>{var Xe=Lm(),Be={},le=u(Xe);D(ae=>{Be!==(Be=s(Ie).id)&&(Xe.value=(Xe.__value=s(Ie).id)??""),S(le,`${s(Ie).icon??""}
                ${ae??""}`)},[()=>g(s(Ie))]),_(Fe,Xe)}),D(Fe=>de(Se,"label",Fe),[()=>v(ue())]),_(B,Se)});var He=w(Ue,2);{var $e=B=>{var H=Dm();_(B,H)},Ye=(B,H)=>{{var Z=ye=>{var Se=Am(),Fe=w(u(Se),2),Ie=u(Fe);D(()=>S(Ie,`Transform failed: ${d().message??""}`)),_(ye,Se)},ue=(ye,Se)=>{{var Fe=Ie=>{var Xe=Om(),Be=w(u(Xe),2),le=u(Be);D(()=>S(le,`${f().length??""} warnings`)),_(Ie,Xe)};U(ye,Ie=>{f().length>0&&Ie(Fe)},Se)}};U(B,ye=>{d()?ye(Z):ye(ue,!1)},H)}};U(He,B=>{l()?B($e):B(Ye,!1)})}var Ne=w(He,2),Ge=u(Ne);{var Ke=B=>{var H=Um(),Z=u(H),ue=u(Z);D(()=>{S(ue,o()||"\x3C!-- No content generated yet -->"),Z.dir=Z.dir}),_(B,H)},he=B=>{var H=Bm(),Z=u(H),ue=u(Z);let ye,Se;var Fe=u(ue);{var Ie=Be=>{var le=Wm(),ae=u(le),me=w(u(ae),2),Pe=w(u(me)),qe=w(me,2),Le=w(u(qe)),re=w(qe,2);{var Y=ge=>{var ee=zm(),A=w(u(ee),2),J=u(A);D(()=>S(J,d().stack)),_(ge,ee)};U(re,ge=>{d().stack&&ge(Y)})}D(()=>{S(Pe,` ${d().stage??""}`),S(Le,` ${d().message??""}`)}),_(Be,le)},Xe=(Be,le)=>{{var ae=Pe=>{var qe=Nm();Ut(qe,Le=>m(k,Le),()=>s(k)),nt("load",qe,ce),_(Pe,qe)},me=Pe=>{var qe=jm();_(Pe,qe)};U(Be,Pe=>{o()?Pe(ae):Pe(me,!1)},le)}};U(Fe,Be=>{d()?Be(Ie):Be(Xe,!1)})}Ut(ue,Be=>m(E,Be),()=>s(E)),D(Be=>{ye=ct(ue,1,"preview-frame-container svelte-32psnf",null,ye,Be),Se=di(ue,"",Se,{transform:s(b)!=="desktop"?`scale(${s(P)})`:"none","transform-origin":"top left"})},[()=>({"device-frame":s(b)!=="desktop"})]),_(B,H)};U(Ge,B=>{s(L)?B(Ke):B(he,!1)})}Ut(Ne,B=>m(T,B),()=>s(T));var ke=w(Ne,2),Te=u(ke),Oe=u(Te);{var se=B=>{var H=Hm(),Z=u(H);D(ue=>S(Z,`Updated: ${ue??""}`),[()=>q(i())]),_(B,H)};U(Oe,B=>{i()&&B(se)})}var Ee=w(Oe,2);{var ve=B=>{var H=Vm(),Z=u(H);D(ue=>S(Z,`${ue??""}KB`),[()=>Math.round(o().length/1024)]),_(B,H)};U(Ee,B=>{o()&&B(ve)})}var We=w(Ee,2);{var Ve=B=>{var H=qm(),Z=u(H);D(()=>S(Z,`${f().length??""} warnings`)),_(B,H)};U(We,B=>{f().length>0&&B(Ve)})}D((B,H)=>{K=ct(pe,1,"view-toggle svelte-32psnf",null,K,B),S(oe,s(L)?"ðï¸":"ð"),de(Ae,"aria-label",H)},[()=>({active:s(L)}),()=>n()("Select device preset")]),Gs(Ae,()=>s(b),B=>m(b,B)),_(r,_e),at(),a()}_t(["click","change"]);class Jt extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="WorkspaceServiceError"}}class Xm extends Jt{constructor(e){super(`Workspace not found: ${e}. Please check workspace ID.`,"WORKSPACE_NOT_FOUND",e),this.name="WorkspaceNotFoundError"}}class Km extends Jt{constructor(e,t){super(`OPF file corrupted in workspace ${e}: ${t}. Try reimporting the EPUB.`,"OPF_CORRUPTED",e),this.name="OPFCorruptedError"}}class an extends Jt{constructor(e,t){super(e,"VALIDATION_ERROR"),this.context=t,this.name="ValidationError"}}class Eo{constructor(e){this.fileStorage=e,this.extensionManager=new Ci(e)}extensionManager;async createWorkspace(e){const t=this.generateWorkspaceId(),a={...e,language:e.language||po(),modifiedDate:gn()};await this.fileStorage.createWorkspace(t);const n={version:"3.0",metadata:{...a,epubVersion:"3.0"},manifest:[],spine:[],guide:[]};return await this.createEPUBStructure(t,n),{id:t,opf:n,pathInfo:{rootfilePath:"OEBPS/content.opf",basePath:"OEBPS",opfFileName:"content.opf"}}}async populateWithContent(e,t){for(const o of t.assets)await this.fileStorage.writeTextFile(e,o.path,o.content);for(const o of t.chapters)await this.fileStorage.writeTextFile(e,`SOURCE/text/${o.fileName}`,o.content),await this.fileStorage.writeTextFile(e,`OEBPS/Text/${o.id}.xhtml`,o.xhtmlContent);const a=await this.loadWorkspace(e),n={...a.opf,manifest:[...a.opf.manifest,...t.manifestUpdates],spine:[...a.opf.spine,...t.spineUpdates]},i=kt.generateOPFXML(n);return await this.fileStorage.writeTextFile(e,a.pathInfo.rootfilePath,i),{...a,opf:n}}async loadWorkspace(e){try{if(!(await this.fileStorage.listWorkspaces()).includes(e))throw new Xm(e);const a=await this.getWorkspacePathInfo(e),n=await this.fileStorage.readTextFile(e,a.rootfilePath);let i;try{i=kt.parseOPFDocument(n)}catch(o){throw new Km(e,o instanceof Error?o.message:"Unknown parsing error")}return{id:e,opf:i,pathInfo:a}}catch(t){throw t instanceof Jt?t:new Jt(`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e)}}async saveWorkspace(e){const t={...e},a=kt.generateOPFXML(t.opf);return await this.fileStorage.writeTextFile(e.id,e.pathInfo.rootfilePath,a),t}async deleteWorkspace(e){try{await this.fileStorage.deleteWorkspace(e)}catch(t){if(t instanceof Error&&!t.message.includes("not found"))throw new Jt(`Failed to delete workspace: ${t.message}`,"DELETE_ERROR",e)}}async updateMetadata(e,t){return this.validateMetadataUpdates(t),e.opf.metadata={...e.opf.metadata,...t},await this.saveWorkspace(e),e}async addManifestItem(e,t){if(!t.href)throw new an("Manifest item must have href");const a=t.id||this.generateManifestId(t.href,new Set(e.opf.manifest.map(o=>o.id)));if(e.opf.manifest.some(o=>o.id===a))throw new an(`Manifest item with ID '${a}' already exists`);const n={id:a,href:t.href,mediaType:t.mediaType||this.detectMediaType(t.href),properties:t.properties,fallback:t.fallback};let i={...e,opf:{...e.opf,manifest:[...e.opf.manifest,n],metadata:{...e.opf.metadata,modifiedDate:gn()}}};return(n.mediaType==="text/javascript"||n.mediaType==="application/javascript")&&(i=this.addScriptedPropertiesToChapters(i)),await this.saveWorkspace(i)}async removeManifestItem(e,t){const a=e.opf.manifest.findIndex(l=>l.id===t);if(a===-1)throw new an(`Manifest item with ID '${t}' not found`);const n=e.opf.manifest[a],i=n.mediaType==="text/javascript"||n.mediaType==="application/javascript";try{const l=this.resolveManifestPath(n.href,e.pathInfo.basePath);await this.fileStorage.deleteFile(e.id,l)}catch(l){console.warn(`Failed to delete file for manifest item ${t}:`,l)}let o={...e,opf:{...e.opf,manifest:e.opf.manifest.filter(l=>l.id!==t),spine:e.opf.spine.filter(l=>l.idref!==t),metadata:{...e.opf.metadata,modifiedDate:gn()}}};return i&&(o=this.addScriptedPropertiesToChapters(o)),await this.saveWorkspace(o)}async updateManifestItem(e,t,a){const n=e.opf.manifest.findIndex(p=>p.id===t);if(n===-1)throw new an(`Manifest item with ID '${t}' not found`);const i=e.opf.manifest[n];if(a.href&&a.href!==i.href){const p=this.resolveManifestPath(i.href,e.pathInfo.basePath),h=this.resolveManifestPath(a.href,e.pathInfo.basePath);if(await this.fileStorage.fileExists(e.id,p))try{await this.fileStorage.renameFile(e.id,p,h)}catch(v){throw new Jt(`Failed to move file from ${i.href} to ${a.href}: ${v instanceof Error?v.message:"Unknown error"}`,"FILE_MOVE_ERROR",e.id)}}const o=i.mediaType==="text/javascript"||i.mediaType==="application/javascript",l=a.mediaType==="text/javascript"||a.mediaType==="application/javascript",d=[...e.opf.manifest];d[n]={...d[n],...a};let f=e.opf.spine;if(a.id&&a.id!==t){if(e.opf.manifest.some((p,h)=>h!==n&&p.id===a.id))throw new an(`Manifest item with ID '${a.id}' already exists`);f=e.opf.spine.map(p=>p.idref===t?{...p,idref:a.id}:p)}let c={...e,opf:{...e.opf,manifest:d,spine:f,metadata:{...e.opf.metadata,modifiedDate:gn()}}};return o!==l&&(c=this.addScriptedPropertiesToChapters(c)),await this.saveWorkspace(c)}async updateSpineOrder(e,t){const a=new Set(e.opf.manifest.map(l=>l.id)),n=t.filter(l=>!a.has(l));if(n.length>0)throw new an(`Spine items reference missing manifest items: ${n.join(", ")}`);const i=t.map(l=>({idref:l})),o={...e,opf:{...e.opf,spine:i,metadata:{...e.opf.metadata,modifiedDate:gn()}}};return await this.saveWorkspace(o)}async addSpineItem(e,t,a){if(!e.opf.manifest.some(l=>l.id===t.idref))throw new an(`Referenced manifest item not found: ${t.idref}`);if(e.opf.spine.some(l=>l.idref===t.idref))throw new an(`Spine item with idref '${t.idref}' already exists`);const n=[...e.opf.spine],i=a??n.length;n.splice(i,0,t);const o={...e,opf:{...e.opf,spine:n,metadata:{...e.opf.metadata,modifiedDate:gn()}}};return await this.saveWorkspace(o)}async removeSpineItem(e,t){if(e.opf.spine.findIndex(i=>i.idref===t)===-1)throw new an(`Spine item with idref '${t}' not found`);const n={...e,opf:{...e.opf,spine:e.opf.spine.filter(i=>i.idref!==t),metadata:{...e.opf.metadata,modifiedDate:gn()}}};return await this.saveWorkspace(n)}async listWorkspaces(){const e=await this.fileStorage.listWorkspaces(),t=[];for(const a of e)try{const n=await this.loadWorkspace(a),i=await this.fileStorage.listFiles(a),o=0;let l;try{l=(await this.fileStorage.getFileInfo(a,n.pathInfo.rootfilePath)).lastModified}catch{l=n.opf.metadata.modifiedDate?new Date(n.opf.metadata.modifiedDate):new Date}let d;try{const f=await this.extensionManager.listWorkspaceExtensions(a);f.length>0&&(d=f.map(c=>c.name))}catch{}t.push({id:a,title:n.opf.metadata.title,language:n.opf.metadata.language,lastModified:l,fileCount:i.length,totalSize:o,author:n.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0",extensionIds:d})}catch{continue}return t}async workspaceExists(e){try{return(await this.fileStorage.listWorkspaces()).includes(e)}catch{return!1}}async loadChapterContents(e,t){const a=[];for(const n of t){const i=e.opf.manifest.find(l=>l.id===n),o=e.opf.spine.find(l=>l.idref===n);if(!(!i||!o))try{const l=this.resolveManifestPath(i.href,e.pathInfo.basePath),d=await this.fileStorage.readTextFile(e.id,l);a.push({id:n,href:i.href,xhtmlContent:d,linear:o.linear??!0,mediaType:i.mediaType||"application/xhtml+xml"})}catch{continue}}return a}async loadAllLinearChapterContents(e){const t=e.opf.spine.filter(a=>a.linear!==!1).map(a=>a.idref);return this.loadChapterContents(e,t)}generateWorkspaceId(){return"workspace-"+crypto.randomUUID()}async createEPUBStructure(e,t){await this.fileStorage.writeTextFile(e,"mimetype","application/epub+zip");const a=kt.generateContainerXML();await this.fileStorage.writeTextFile(e,"META-INF/container.xml",a);const n=kt.generateOPFXML(t);await this.fileStorage.writeTextFile(e,"OEBPS/content.opf",n)}async getWorkspacePathInfo(e){try{const t=await this.fileStorage.readTextFile(e,"META-INF/container.xml"),a=kt.parseContainerXml(t);if(a.error)throw new Error(a.error);const n=a.rootfilePath,i=n.lastIndexOf("/");if(i===-1)return{rootfilePath:n,basePath:"",opfFileName:n};const o=n.substring(0,i),l=n.substring(i+1);return{rootfilePath:n,basePath:o,opfFileName:l}}catch(t){throw new Jt(`Failed to parse workspace container.xml: ${t instanceof Error?t.message:"Unknown error"}`,"INVALID_CONTAINER_STRUCTURE",e)}}validateMetadataUpdates(e){if(e.title!==void 0&&e.title.trim()==="")throw new an("Title cannot be empty");if(e.language!==void 0&&!/^[a-z]{2}(-[A-Z]{2})?$/.test(e.language))throw new an("Invalid language code format")}addScriptedPropertiesToChapters(e){const t=e.opf.manifest.some(n=>n.mediaType==="text/javascript"||n.mediaType==="application/javascript"),a=e.opf.manifest.map(n=>{if(n.mediaType==="application/xhtml+xml"&&n.id!=="nav"&&!n.properties?.includes("nav")){const i=n.properties||[],o=i.includes("scripted");if(t&&!o)return{...n,properties:[...i,"scripted"]};if(!t&&o){const l=i.filter(d=>d!=="scripted");return{...n,properties:l.length>0?l:void 0}}}return n});return{...e,opf:{...e.opf,manifest:a}}}generateManifestId(e,t){const i=(e.split("/").pop()||"item").replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"-").replace(/^[^a-zA-Z]/,"item-").toLowerCase();let o=i,l=1;for(;t.has(o);)o=`${i}-${l++}`;return o}detectMediaType(e){const t=e.split(".").pop()?.toLowerCase()||"";return{xhtml:"application/xhtml+xml",html:"application/xhtml+xml",css:"text/css",js:"application/javascript",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",mp3:"audio/mpeg",mp4:"video/mp4",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2"}[t]||"application/octet-stream"}resolveManifestPath(e,t){return!t||e.startsWith(t+"/")?e:`${t}/${e}`}async fileExists(e,t){try{return await this.fileStorage.readFile(e,t),!0}catch{return!1}}async renameFile(e,t,a){await this.fileStorage.renameFile(e,t,a)}async readFile(e,t){try{return await this.fileStorage.readFile(e,t)}catch(a){throw new Jt(`Failed to read file ${t}: ${a instanceof Error?a.message:"Unknown error"}`,"READ_FILE_ERROR",e)}}async writeFile(e,t,a){try{const i=new TextEncoder().encode(a),o=new ArrayBuffer(i.length);new Uint8Array(o).set(i),await this.fileStorage.writeFile(e,t,o)}catch(n){throw new Jt(`Failed to write file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_FILE_ERROR",e)}}async writeBinaryFile(e,t,a){try{await this.fileStorage.writeFile(e,t,a)}catch(n){throw new Jt(`Failed to write binary file ${t}: ${n instanceof Error?n.message:"Unknown error"}`,"WRITE_BINARY_FILE_ERROR",e)}}async listSourceFiles(e){try{const a=(await this.fileStorage.listFiles(e.id)).filter(i=>Zn(i)).filter(i=>!i.endsWith(".gitkeep")),n=[];for(const i of a)try{const o=await this.fileStorage.getFileInfo(e.id,i),l={path:i,name:i.split("/").pop()||i,type:"file",size:o.size,modified:o.lastModified,mediaType:this.detectMediaTypeForSource(i)};n.push(l)}catch{continue}return n}catch(t){throw new Jt(`Failed to list SOURCE files: ${t instanceof Error?t.message:"Unknown error"}`,"LIST_SOURCE_FILES_ERROR",e.id)}}detectMediaTypeForSource(e){const t=e.split(".").pop()?.toLowerCase()||"",a=yo(e),n={txt:"text/plain",md:"text/markdown",json:"application/json",js:"application/javascript",ts:"application/typescript",css:"text/css",html:"text/html",xhtml:"application/xhtml+xml",xml:"application/xml",py:"text/x-python",sh:"application/x-sh"};return n[t]||"text/plain"}async getFileInfo(e,t){return await this.fileStorage.getFileInfo(e,t)}}class as{static validateSyntax(e){if(!e.trim())return null;try{const t=new Function(e);try{const a={console:{log:()=>{},warn:()=>{},error:()=>{}},window:{},document:{querySelector:()=>null,createElement:()=>({}),addEventListener:()=>{}},setTimeout:()=>0,setInterval:()=>0,clearTimeout:()=>{},clearInterval:()=>{},fetch:()=>Promise.resolve(),Math,JSON,Date,Array,Object,String,Number,Boolean,RegExp};return t.call(a),null}catch(a){return a instanceof ReferenceError?`JavaScript reference error: ${a.message}`:a instanceof TypeError?`JavaScript type error: ${a.message}`:`JavaScript runtime error: ${a instanceof Error?a.message:String(a)}`}}catch(t){return t instanceof SyntaxError?`JavaScript syntax error: ${t.message}`:`JavaScript validation error: ${t instanceof Error?t.message:String(t)}`}}static shouldValidate(e){return e.includes("javascript")||e.includes("js")}}class ja extends Error{constructor(e,t){super(`Missing translation keys for locale ${e}: ${t.join(", ")}`),this.locale=e,this.missingKeys=t,this.name="TranslationMissingError"}}let _r=class extends Error{constructor(e){super(`Unsupported locale: ${e}`),this.locale=e,this.name="UnsupportedLocaleError"}};class Ym extends Error{constructor(e,t,a){super(`Invalid content for ${e}.${t}: ${a}`),this.locale=e,this.key=t,this.reason=a,this.name="InvalidContentError"}}const Yr=["sample.book.title","sample.book.description","sample.author.name","sample.publisher.name","sample.chapter1.title","sample.chapter1.content"];class Jm{constructor(e){this.catalogs=e}translate(e,t){return this.catalogs[e]?.messages[t]||t}isLocaleSupported(e){return e in this.catalogs}isRTL(e){return["ar","he","fa","ur"].includes(e)}hasTranslation(e,t){const a=this.catalogs[e];if(!a)return!1;const n=a.messages[t];return n!==void 0&&n.trim()!==""}async generateLocalizedContent(e){if(!this.isLocaleSupported(e))throw new _r(e);await this.checkTranslationCompleteness(e);const t={title:this.translate(e,"sample.book.title"),description:this.translate(e,"sample.book.description"),author:this.translate(e,"sample.author.name"),publisher:this.translate(e,"sample.publisher.name")},a=await this.generateLocalizedChapters(e),n=this.isRTL(e);return{locale:e,metadata:t,chapters:a,isRTL:n,pageProgressionDirection:n?"rtl":"ltr"}}async generateLocalizedMetadata(e){if(!this.isLocaleSupported(e))throw new _r(e);const t=["sample.book.title","sample.book.description","sample.author.name","sample.publisher.name"],a=[];for(const c of t)this.hasTranslation(e,c)||a.push(c);if(a.length>0)throw new ja(e,a);const n=Date.now(),i=performance.now(),o=Math.floor(n+i%1*1e3),l=`sample-content-${e}-${o}`,f=this.isRTL(e)?"rtl":"ltr";return{title:this.translate(e,"sample.book.title"),language:e,identifier:l,creator:[this.translate(e,"sample.author.name")],publisher:this.translate(e,"sample.publisher.name"),description:this.translate(e,"sample.book.description"),pageProgressionDirection:f}}async generateLocalizedChapters(e){if(!this.isLocaleSupported(e))throw new _r(e);const t=["sample.chapter1.title","sample.chapter1.content"],a=[];for(const n of t)this.hasTranslation(e,n)||a.push(n);if(a.length>0)throw new ja(e,a);return[{id:"chapter1",title:this.translate(e,"sample.chapter1.title"),content:this.translate(e,"sample.chapter1.content"),linear:!0,mediaType:"application/xhtml+xml"}]}async getAvailableLocales(){const e=[],t=Object.keys(this.catalogs);for(const a of t)Yr.every(i=>this.hasTranslation(a,i))&&e.push(a);return e}async validateLocaleCompleteness(e){if(!this.isLocaleSupported(e))throw new _r(e);const t=[],a=[],n=this.catalogs[e];for(const o of Yr)if(!n||!(o in n.messages))t.push(o);else{const l=n.messages[o];(!l||l.trim()==="")&&a.push(o)}return{isValid:t.length===0&&a.length===0,missingKeys:t,emptyKeys:a,locale:e}}async checkTranslationCompleteness(e){const t=this.catalogs[e];if(!t)throw new _r(e);for(const n of Yr)if(n in t.messages){const i=t.messages[n];if(!i||i.trim()==="")throw new Ym(e,n,"Translation is empty")}const a=[];for(const n of Yr)n in t.messages||a.push(n);if(a.length>0)throw new ja(e,a)}}const Zm=`/* Universal CSS for all locales with EPUB reading system compatibility */

code-sample {
  font-family: monospace;
  font-weight: 700;
  font-size: 0.7rem;
}

.action {
  text-align: center;
  margin: 3em 0 4em;
}

.action a {
  text-decoration: none;
  background-color: #00e;
  color: white;
  padding: 0.6em 1em 0.5em;
  border-radius: 0.5em;
  font-family: sans-serif;
  font-weight: 600;
}

body {
  /* System fonts with enhanced stack for global language support */
  font-family:
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    'Noto Sans',
    'Liberation Sans',
    sans-serif;

  /* Enhanced typography for reading contexts */
  font-size: 1.125rem; /* Slightly larger base for better readability */
  line-height: 1.6;

  /* Progressive enhancement: physical properties first, then logical */
  margin-left: auto;
  margin-right: auto;
  padding: 1em;
  max-width: 65ch;

  /* Modern logical properties with feature query protection */
}

@supports (margin-inline: auto) {
  body {
    margin-left: unset;
    margin-right: unset;
    max-width: unset;
    margin-inline: auto;
    max-inline-size: 65ch;
  }
}

/* Additional language-specific adjustments */
:lang(ja),
:lang(ko),
:lang(zh) {
  line-height: 1.8; /* Better spacing for CJK characters */
}

:lang(ar),
:lang(he) {
  line-height: 1.7; /* Improved RTL script readability */
}

/* Enhanced text flow and hyphenation */
body {
  hyphens: auto;
  -webkit-hyphens: auto;
  -ms-hyphens: auto;
}

/* Headings with progressive enhancement for logical spacing */
h1,
h2,
h3,
h4,
h5,
h6 {
  /* Physical properties first for compatibility */
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  margin-left: 0;
  margin-right: 0;
  font-weight: 600;
  line-height: 1.2;
}

@supports (margin-block-start: 1.5em) {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: unset;
    margin-bottom: unset;
    margin-left: unset;
    margin-right: unset;
    margin-block-start: 1.5em;
    margin-block-end: 0.5em;
    margin-inline: 0;
  }
}

h1 {
  font-size: 2em;
  padding-bottom: 0.25em;
}

h2 {
  font-size: 1.5em;
}

h3 {
  font-size: 1.25em;
}

/* Paragraphs with progressive enhancement */
p {
  /* Physical properties first */
  margin-bottom: 1em;
  text-align: left; /* Will be overridden for RTL */
}

/* RTL-specific physical fallback */
[data-dir='rtl'] p {
  text-align: right;
}

/* Lists with progressive enhancement */
ul,
ol {
  /* Physical properties first */
  margin-top: 1em;
  margin-bottom: 1em;
  padding-left: 2em;
}

li {
  margin-bottom: 0.5em;
}

/* Blockquotes with progressive enhancement */
blockquote {
  /* Physical properties first */
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  margin-left: 2em;
  margin-right: 0;
  padding-left: 1em;
  font-style: italic;
}

/* Code blocks with progressive enhancement */
pre,
code {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
  font-size: 0.875em;
}

pre {
  padding: 1em;
  border-radius: 4px;
  overflow-x: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

code {
  padding-left: 0.25em;
  padding-right: 0.25em;
  border-radius: 2px;
}

/* Images with progressive enhancement */
img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Strong and emphasis with universal styling */
strong {
  font-weight: 600;
}

em {
  font-style: italic;
}
`,is=`/**
 * Convert simple text to well-formed XHTML
 * @param {string} text - plain text
 * @param {string|undefined} idref - Spine item idref for context-aware transforms
 * @returns {string} Valid XHTML output
 */
function transformText(text, idref) {
  // Split content into blocks (separated by double newlines)
  const blocks = text.split(/\\n\\s*\\n/).filter(block => block.trim());
  const htmlBlocks = [];

  for (const block of blocks) {
    const trimmedBlock = block.trim();
    if (!trimmedBlock) continue;

    // Check if block is a header
    const headerMatch = trimmedBlock.match(/^(#{1,6})\\s+(.+)$/);
    if (headerMatch) {
      const level = headerMatch[1].length;
      const text = processInlineFormatting(headerMatch[2]);
      htmlBlocks.push(\`<h\${level}>\${text}</h\${level}>\`);
    } else {
      // Process as paragraph content
      let paragraphContent = processInlineFormatting(trimmedBlock);
      // Convert single newlines to <br/> within paragraphs
      paragraphContent = paragraphContent.replace(/\\n/g, '<br />');
      htmlBlocks.push(\`<p>\${paragraphContent}</p>\`);
    }
  }

  return htmlBlocks.join('\\n');
}

/**
 * Process inline formatting (bold, italic) within text
 * @param {string} text - Text to process
 * @returns {string} Text with inline HTML tags
 */
function processInlineFormatting(text) {
  let result = text;

  // Bold and italic (process bold first to handle overlap correctly)
  result = result.replace(/\\*\\*\\*(.*?)\\*\\*\\*/g, '<strong><em>$1</em></strong>');
  result = result.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');
  result = result.replace(/\\*(.*?)\\*/g, '<em>$1</em>');

  return result;
}
`,Qm=`/**
 * Transform DOM by adding IDs to H2 headings for navigation
 * @param {Document} htmlDocument - HTML document to transform
 * @param {string|undefined} idref - Spine item idref for context-aware transforms
 */
function transformDOM(htmlDocument, idref) {
  try {
    // Find all H2 elements in the document
    const h2Elements = htmlDocument.querySelectorAll('h2');

    h2Elements.forEach((h2, index) => {
      // Skip if already has an ID
      if (h2.getAttribute('id')) {
        return;
      }

      // Generate ID from text content or use fallback
      const text = h2.textContent || '';
      let id = text
        .toLowerCase()
        .replace(/[^a-z0-9\\s-]/g, '') // Remove special characters
        .replace(/\\s+/g, '-') // Replace spaces with hyphens
        .replace(/-+/g, '-') // Collapse multiple hyphens
        .replace(/^-|-$/g, '') // Remove leading/trailing hyphens
        .substring(0, 50); // Limit length

      // Fallback if no usable text
      if (!id) {
        id = \`heading-\${index + 1}\`;
      }

      // Ensure ID is unique in document
      let finalId = id;
      let counter = 1;
      while (htmlDocument.getElementById(finalId)) {
        finalId = \`\${id}-\${counter}\`;
        counter++;
      }

      // Set the ID attribute
      h2.setAttribute('id', finalId);
    });
  } catch (error) {
    console.error('DOM transform error:', error);
  }
}
`;class ko extends Error{constructor(e,t){super(e),this.code=t,this.name="ContentServiceError"}}class eg extends ko{constructor(e){super(`Unsupported locale: ${e}`,"UNSUPPORTED_LOCALE"),this.name="UnsupportedLocaleError"}}class ua{constructor(e,t){this.transformExecutor=e,this.i18nSystem=t}static SUPPORTED_LOCALES=new Set(["en","es","fr","de","it","pt","nl","sv","da","no","fi","ru","pl","cs","hu","ro","bg","hr","sk","sl","et","lv","lt","el","tr","ar","he","fa","ur","hi","bn","ta","te","ml","kn","gu","pa","or","as","ne","si","my","km","lo","vi","th","id","ms","tl","zh","ja","ko"]);static RTL_LOCALES=new Set(["ar","he","fa","ur"]);async generateSampleContentData(e="en"){try{const t=await this.generateLocalizedContent(e),{chapters:a,isRTL:n}=t,i=[];for(const c of a){const p=await this.transformContent(c.content),h=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="${e}"${n?' dir="rtl"':""}>
<head>
  <title>${c.title}</title>
  <link rel="stylesheet" type="text/css" href="../Styles/page.css"/>
</head>
<body>
  ${p.xhtml}
</body>
</html>`;i.push({id:c.id,title:c.title,fileName:`${c.id}.txt`,content:c.content,xhtmlContent:h})}const o=this.generateNavigationContent(a,e,n),l=[{path:"OEBPS/Styles/page.css",content:Zm},{path:"SOURCE/scripts/transformText.js",content:is},{path:"SOURCE/scripts/transformDom.js",content:Qm},{path:"SOURCE/settings.json",content:JSON.stringify({version:"1.0.0",text_transform:"transformText.js",dom_transforms:["transformDom.js"]},null,2)},{path:"OEBPS/nav.xhtml",content:o}],d=[{id:"page-css",href:"Styles/page.css",mediaType:"text/css"},{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"]},...a.map(c=>({id:c.id,href:`Text/${c.id}.xhtml`,mediaType:"application/xhtml+xml"}))],f=a.map(c=>({idref:c.id}));return{chapters:i,assets:l,manifestUpdates:d,spineUpdates:f}}catch(t){throw new ko(`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,"SAMPLE_CONTENT_ERROR")}}generateNavigationContent(e,t,a){const n=this.i18nSystem.translate("navigation.title")||"Navigation",i=this.i18nSystem.translate("navigation.tableOfContents")||"Table of Contents",o=e.map(l=>{const d=this.i18nSystem.translate(`content.${l.id}`)||l.title;return`      <li><a href="${l.id}.xhtml">${this.escapeHtml(d)}</a></li>`}).join(`
`);return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="${t}"${a?' dir="rtl"':""}>
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" id="doc-toc">
    <h1>${this.escapeHtml(i)}</h1>
    <ol>
${o}
    </ol>
  </nav>
</body>
</html>`}async transformContent(e,t,a){const n=Date.now(),i=[];try{const o={...t,idref:a},l=await this.transformExecutor.executeTextTransform(is,"transformText.js",e,o,{timeoutMs:5e3}),d=Date.now()-n;return{xhtml:l,warnings:i,transformTime:d}}catch(o){const l=Date.now()-n,d=o instanceof Error?o.message:"Unknown transform error";return{xhtml:`<p>${this.escapeHtml(e)}</p>`,warnings:[d],transformTime:l}}}async previewContent(e,t){const a=await this.transformContent(e,t);return{previewHtml:a.xhtml,warnings:a.warnings}}generateNavigationFromContent(e){const a=e.filter(o=>o.linear).map(o=>{const l=this.extractTitleFromXHTML(o.xhtmlContent)||o.id;return`    <li><a href="${o.href}">${this.escapeHtml(l)}</a></li>`}).join(`
`),n=this.i18nSystem.translate("navigation.tableOfContents");return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
  <title>${this.escapeHtml(n)}</title>
</head>
<body>
  <nav epub:type="toc" role="doc-toc">
    <h1>${this.escapeHtml(n)}</h1>
    <ol>
${a}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}processUserNavigation(e){const t=this.i18nSystem.translate("navigation.tableOfContents");if(!e.trim())return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="doc-toc">
    <h1>${this.escapeHtml(t)}</h1>
    <ol></ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}};const n=this.parseNavigationEntries(e).map(o=>`    <li><a href="${o.href}">${this.escapeHtml(o.title)}</a></li>`).join(`
`);return{xhtmlContent:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
  <title>${this.escapeHtml(t)}</title>
</head>
<body>
  <nav epub:type="toc" role="doc-toc">
    <h1>${this.escapeHtml(t)}</h1>
    <ol>
${n}
    </ol>
  </nav>
</body>
</html>`,metadata:{id:"nav",href:"nav.xhtml",mediaType:"application/xhtml+xml",properties:["nav"],linear:!1}}}async generateLocalizedContent(e){if(!ua.SUPPORTED_LOCALES.has(e))throw new eg(e);const t=ua.RTL_LOCALES.has(e),a=await this.generateLocalizedMetadata(e),n=await this.generateLocalizedChapters(e);return{locale:e,metadata:a,chapters:n,isRTL:t,pageProgressionDirection:t?"rtl":"ltr"}}async generateLocalizedMetadata(e){const t=this.i18nSystem.translate("sample.title"),a=this.i18nSystem.translate("sample.author"),n=this.i18nSystem.translate("sample.description");return{title:t||"Sample Book",language:e,identifier:`urn:uuid:sample-${Date.now()}`,creator:[a||"Sample Author"],description:n||"A sample book for demonstration purposes",modifiedDate:gn()}}async generateLocalizedChapters(e){const t=this.i18nSystem.getCatalogs();return new Jm(t).generateLocalizedChapters(e)}extractTitleFromXHTML(e){try{const a=new DOMParser().parseFromString(e,"text/xml"),n=["h1","h2","h3","h4","h5","h6"];for(const i of n){const o=a.querySelector(i);if(o&&o.textContent?.trim())return o.textContent.trim()}return null}catch{return null}}parseNavigationEntries(e){const t=[],a=e.split(`
`);for(const n of a){const i=n.trim();if(!i||i.startsWith("#"))continue;const o=i.match(/\[([^\]]+)\]\(([^)]+)\)/);if(o){t.push({title:o[1],href:o[2]});continue}const l=i.match(/^(.+?)\s*-\s*(.+)$/);if(l){t.push({title:l[1].trim(),href:l[2].trim()});continue}const d=i.match(/^-\s*(.+)$/);if(d){const f=d[1].trim();t.push({title:f,href:`Text/${f.toLowerCase().replace(/\s+/g,"_")}.xhtml`})}}return t}generateSampleChapterContent(e,t){return`
${`# ${this.i18nSystem.translate(`content.chapter${t}`)||`Chapter ${t}`}`}

This is sample content for demonstration purposes.

## Section 1

Here is some **bold text** and *italic text*.

## Section 2

Here is more sample content with additional paragraphs to demonstrate the transformation process.

This concludes the sample chapter.
    `.trim()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}validateFileContent(e,t){return as.shouldValidate(t)?as.validateSyntax(e):null}}class To{fileStorage;constructor(){this.fileStorage=Wt.getInstance()}async unpackEPUB(e,t){try{this.fileStorage.isInitialized()||await this.fileStorage.init();const a=await e.arrayBuffer(),n=new Ur(a),i=await this.validateEPUBStructure(n);if(!i.isValid)return{success:!1,error:`Invalid EPUB structure: ${i.errors.join(", ")}`};const o=await this.extractToWorkspace(n,t);return{success:o.success,workspaceId:t,extractedFiles:o.extractedFiles,totalSize:o.totalBytes,processedFiles:o.extractedFiles.length,error:o.errors.length>0?o.errors.join("; "):void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}}async validateEPUBStructure(e){const t=[],a=[];let n,i,o;const l=e.entries.map(d=>d.fileName);if(!l.includes("mimetype"))t.push("Missing required mimetype file");else try{const d=e.entries.find(f=>f.fileName==="mimetype");if(d){const c=await(await d.extract()).text();c.trim()!=="application/epub+zip"&&t.push(`Invalid mimetype content: "${c.trim()}" (expected "application/epub+zip")`)}}catch{t.push("Failed to read mimetype file content")}if(!l.includes("META-INF/container.xml"))t.push("Missing required META-INF/container.xml file");else try{const d=e.entries.find(f=>f.fileName==="META-INF/container.xml");if(d){const c=await(await d.extract()).text(),p=kt.validateXML(c);if(!p.isValid)t.push(`Invalid XML in container.xml: ${p.error}`);else{const h=kt.parseContainerXml(c);if(h.error)t.push(h.error);else if(h.rootfilePath){i=h.rootfilePath;const v=i.split("/");v.length>1&&(o=v.slice(0,-1).join("/")),l.includes(i)||t.push(`Rootfile specified in container.xml not found: ${i}`)}}}}catch{t.push("Failed to parse META-INF/container.xml")}e.entries.length===0&&t.push("Empty ZIP file");for(const d of l)d.includes("..")&&t.push(`Invalid file path with directory traversal: ${d}`),d.startsWith("/")&&a.push(`Absolute path found: ${d}`);if(i&&l.includes(i))try{const d=e.entries.find(f=>f.fileName===i);if(d){const c=await(await d.extract()).text(),p=kt.validateXML(c);p.isValid?(n=kt.detectEPUBVersion(c),n||a.push("Could not detect EPUB version from OPF file")):t.push(`Invalid XML in OPF file (${i}): ${p.error}`)}}catch{t.push(`Failed to read or parse OPF file: ${i}`)}return o&&l.filter(f=>f.startsWith(o+"/")).length===0&&a.push(`No files found in package directory: ${o}/`),{isValid:t.length===0,errors:t,warnings:a,detectedVersion:n,rootfilePath:i,packageDirectory:o}}async extractToWorkspace(e,t){const a=[],n=[],i=[];let o=0;try{await this.fileStorage.createWorkspace(t)}catch(f){if(f instanceof Error&&!f.message.includes("already exists"))return i.push(`Failed to create workspace: ${f.message}`),{success:!1,extractedFiles:a,totalBytes:o,skippedFiles:n,errors:i}}const l=new bo(this.fileStorage);let d=null;for(const f of e.entries)try{if(f.fileName.endsWith("/"))continue;if(f.fileName==="SOURCE.zip"||f.fileName.endsWith("/SOURCE.zip")){d=f;continue}const p=await(await f.extract()).arrayBuffer();await this.fileStorage.writeFile(t,f.fileName,p),a.push(f.fileName),o+=p.byteLength}catch(c){const p=c instanceof Error?c.message:"Unknown error";i.push(`Failed to extract ${f.fileName}: ${p}`),n.push(f.fileName)}if(d)try{const f=await d.extract();await l.extractSourceZip(t,f),a.push("SOURCE.zip (extracted to SOURCE/ directory)"),o+=f.size}catch(f){const c=f instanceof Error?f.message:"Unknown error";i.push(`Failed to extract SOURCE.zip: ${c}`),n.push(d.fileName)}return{success:i.length===0,extractedFiles:a,totalBytes:o,skippedFiles:n,errors:i}}async analyzeEPUB(e){try{const t=await e.arrayBuffer(),a=new Ur(t),n=await this.validateEPUBStructure(a),i=a.entries.map(l=>l.fileName).filter(l=>!l.endsWith("/")).sort(),o=a.entries.reduce((l,d)=>l+d.uncompressedSize,0);return{isValid:n.isValid,fileCount:i.length,totalSize:o,validation:n,fileList:i}}catch(t){return{isValid:!1,fileCount:0,totalSize:0,validation:{isValid:!1,errors:[t instanceof Error?t.message:"Failed to analyze EPUB"],warnings:[]},fileList:[]}}}destroy(){this.fileStorage.destroy()}}class qn extends Error{constructor(e,t){super(e),this.code=t,this.name="EPUBProcessorError"}}class tg{constructor(e){this.fileStorage=e,this.epubUnpacker=new To,this.epubPackager=new ki}epubUnpacker;epubPackager;async unpackEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubUnpacker.unpackEPUB(e,t)}catch(a){throw new qn(`Failed to unpack EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_UNPACK_ERROR")}}async validateEPUBStructure(e){try{const t=new Ur(e);return await this.epubUnpacker.validateEPUBStructure(t)}catch(t){return{isValid:!1,errors:[`Validation failed: ${t instanceof Error?t.message:"Unknown error"}`],warnings:[]}}}async packageEPUB(e,t){try{return this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.epubPackager.packageEPUB(e,t)}catch(a){throw new qn(`Failed to package EPUB: ${a instanceof Error?a.message:"Unknown error"}`,"EPUB_PACKAGE_ERROR")}}parseOPFDocument(e){try{return kt.parseOPFDocument(e)}catch(t){throw new qn(`Failed to parse OPF document: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_PARSE_ERROR")}}generateOPFXML(e){try{return kt.generateOPFXML(e)}catch(t){throw new qn(`Failed to generate OPF XML: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_GENERATE_ERROR")}}validateXML(e){return kt.validateXML(e)}parseOPFMetadata(e){try{if(!globalThis.DOMParser)throw new Error("DOMParser not available");const a=new DOMParser().parseFromString(e,"application/xml");if(a.querySelector("parsererror"))throw new Error("Invalid OPF XML");return kt.parseOPFMetadata(a)}catch(t){throw new qn(`Failed to parse OPF metadata: ${t instanceof Error?t.message:"Unknown error"}`,"OPF_METADATA_PARSE_ERROR")}}parseContainerXML(e){return kt.parseContainerXml(e)}generateContainerXML(e="OEBPS/content.opf"){return kt.generateContainerXML(e)}detectEPUBVersion(e){return kt.detectEPUBVersion(e)}validateManifestSpineConsistency(e,t){return kt.validateManifestSpineConsistency(e,t)}parseRootfilePath(e){try{return kt.parseRootfilePath(e)}catch(t){throw new qn(`Failed to parse rootfile path: ${t instanceof Error?t.message:"Unknown error"}`,"ROOTFILE_PARSE_ERROR")}}}class sn extends Error{constructor(e,t,a){super(e),this.code=t,this.audioHref=a,this.name="AudioClipServiceError"}}class ng{constructor(e,t,a){this.fileStorage=e,this.workspaceService=t,this.settingsService=a}clipRange=null;blobURLManagers=new Map;getBlobURLManager(e){if(this.blobURLManagers.has(e))return this.blobURLManagers.get(e);const t=new Ti({fileStorage:this.fileStorage,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Audio BlobURLManager capacity reached for workspace:",e)}});return t.setActiveWorkspace(e),this.blobURLManagers.set(e,t),t}async getAvailableAudioFiles(e){try{return(await this.workspaceService.loadWorkspace(e)).opf.manifest.filter(n=>n.mediaType&&n.mediaType.startsWith("audio/")&&n.href&&n.href.length>0)}catch(t){throw new sn(`Failed to load audio files: ${t instanceof Error?t.message:"Unknown error"}`,"WORKSPACE_NOT_FOUND",void 0)}}async loadAudioFile(e,t){try{console.log("ðµ Service: Loading audio file - workspaceId:",e,"href:",t);const n=await this.getBlobURLManager(e).createBlobURL(t);return console.log("ðµ Service: BlobURL created:",n),n}catch(a){throw console.error("ðµ Service: Audio loading failed - href:",t,"error:",a),a instanceof Error&&a.message.includes("Blob creation failed")?new sn(`Blob creation failed: ${a.message}`,"BLOB_URL_ERROR",t):new sn(`Audio file not found: ${t}`,"AUDIO_NOT_FOUND",t)}}getAudioMetadata(e){const t=isNaN(e.duration)?0:e.duration;let a="unknown";return e.src&&(e.src.includes("mp3")?a="audio/mpeg":e.src.includes("ogg")?a="audio/ogg":e.src.includes("wav")?a="audio/wav":a="audio/unknown"),{duration:t,format:a}}setClipRange(e,t){if(e<0||t<0)throw new sn(`Clip times must be positive: start=${e}, end=${t}`,"INVALID_CLIP_RANGE");if(e>=t)throw new sn(`Clip start must be less than end: start=${e}, end=${t}`,"INVALID_CLIP_RANGE");this.clipRange={start:e,end:t}}getClipRange(){return this.clipRange}clearClipRange(){this.clipRange=null}parseClipDirective(e){const t=/^:clip\[([^\]]*)\]\{([^}]+)\}$/,a=e.match(t);if(!a)return null;const[,n,i]=a,o={},l=/(\w+)=([^\s]+)/g;let d;for(;(d=l.exec(i))!==null;){const[,c,p]=d;o[c]=p}if(!o.src||!o.begin||!o.end)return null;const f={href:o.src,begin:o.begin,end:o.end,label:n||""};return o.rate&&(f.rate=o.rate),f}formatClipDirective(e,t){let a=t;if(a=a.replace("<href>",e.href),a=a.replace("<begin>",this.formatTimeString(e.startTime)),a=a.replace("<end>",this.formatTimeString(e.endTime)),e.label&&e.label.trim()?a=a.replace("<label>",e.label.trim()):a=a.replace("<label>",""),e.playbackRate&&e.playbackRate!==1)if(t.includes("<rate>")){const n=e.playbackRate.toFixed(1);a=a.replace("<rate>",n)}else{const n=e.playbackRate.toFixed(1);a=a.replace("}",` rate=${n}}`)}else a=a.replace(" speed=<rate>",""),a=a.replace("<rate>","");return a}async getTemplate(e){try{return(await this.settingsService.loadEPUBSettings(e)).audio_clip_template||":clip[<label>]{src=<href> begin=<begin> end=<end>}"}catch{return":clip[<label>]{src=<href> begin=<begin> end=<end>}"}}parseTimeString(e){if(!e||typeof e!="string")throw new sn(`Invalid time format: ${e}. Expected h:mm:ss.dd format`,"INVALID_TIME_FORMAT");const t=/^(\d+):(\d{2}):(\d{2})\.(\d{2})$/,a=e.match(t);if(!a)throw new sn(`Invalid time format: ${e}. Expected h:mm:ss.dd format`,"INVALID_TIME_FORMAT");const[,n,i,o,l]=a,d=parseInt(n,10),f=parseInt(i,10),c=parseInt(o,10),p=parseInt(l,10);if(f>=60||c>=60||p>=100)throw new sn(`Invalid time format: ${e}`,"INVALID_TIME_FORMAT");if(d>=25)throw new sn(`Invalid time format: ${e}`,"INVALID_TIME_FORMAT");return d*3600+f*60+c+p/100}formatTimeString(e){let t;e<.01?t=Math.floor(e*100):t=Math.round(e*100);let a=t%100,n=Math.floor(t/100);a===99&&(n%60===59||n%3600===3599)&&(n+=1,a=0);const i=Math.floor(n/3600),o=Math.floor(n%3600/60),l=n%60;return`${i}:${o.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${a.toString().padStart(2,"0")}`}async playClip(e){if(!this.clipRange)throw new sn("No clip range set","INVALID_STATE");e.currentTime=this.clipRange.start,await e.play()}async playLastSeconds(e,t=2){if(!this.clipRange)throw new sn("No clip range set","INVALID_STATE");const a=Math.max(this.clipRange.start,this.clipRange.end-t);e.currentTime=a,await e.play()}pause(e){e.pause()}stop(e){e.pause(),this.clipRange&&(e.currentTime=this.clipRange.start)}}const Sn={WORKSPACE_ID:"editme_app_workspace_id",SPINE_ITEM_ID:"editme_app_spine_item_id"};class rg{constructor(e,t,a,n,i,o,l,d=!1){this.skipReactiveEffects=d,this.fileStorage=e,this.transformEngine=l,this.extensionManager=n,this.settingsService=new er(e,n,i,o),this.epubProcessor=new tg(e),this.workspaceService=new Eo(e),this.contentService=new ua(t,a),this.audioClipService=new ng(this.fileStorage,this.workspaceService,this.settingsService),this.loadGlobalSettings(),d||this.setupReactiveEffects()}fileStorage;transformEngine;extensionManager;workspaceService;contentService;settingsService;epubProcessor;audioClipService;#e=fe(null);get workspace(){return s(this.#e)}set workspace(e){m(this.#e,e,!0)}#t=fe(null);get selectedChapterId(){return s(this.#t)}set selectedChapterId(e){m(this.#t,e,!0)}#r=fe(null);get selectedManifestItemId(){return s(this.#r)}set selectedManifestItemId(e){m(this.#r,e,!0)}#a=fe(!1);get initialized(){return s(this.#a)}set initialized(e){m(this.#a,e,!0)}#n=fe(!1);get isLoading(){return s(this.#n)}set isLoading(e){m(this.#n,e,!0)}#s=fe(null);get errorMessage(){return s(this.#s)}set errorMessage(e){m(this.#s,e,!0)}#i=fe(null);get globalSettings(){return s(this.#i)}set globalSettings(e){m(this.#i,e,!0)}#o=fe(null);get workspaceSettings(){return s(this.#o)}set workspaceSettings(e){m(this.#o,e,!0)}#l=fe(null);get epubSettings(){return s(this.#l)}set epubSettings(e){m(this.#l,e,!0)}get hasWorkspace(){return this.workspace!==null}get isWorkspaceReady(){return this.initialized&&this.workspace!==null}get currentWorkspaceId(){return this.workspace?.id||null}get workspaceInfo(){return this.workspace?{id:this.workspace.id,title:this.workspace.opf.metadata.title,language:this.workspace.opf.metadata.language,lastModified:new Date,fileCount:this.workspace.opf.manifest.length,totalSize:0,author:this.workspace.opf.metadata.creator?.[0]||void 0,hasError:!1,epubVersion:"3.0"}:null}get selectedChapter(){if(!this.workspace||!this.selectedChapterId)return null;const e=this.workspace.opf.manifest.find(t=>t.id===this.selectedChapterId);return e?{id:e.id,href:e.href,xhtmlContent:"",linear:!0,mediaType:e.mediaType||"application/xhtml+xml"}:null}get navigationItems(){return this.workspace?this.workspace.opf.spine.map((e,t)=>{const a=this.workspace.opf.manifest.find(n=>n.id===e.idref);return{id:e.idref,title:a?.id||`Chapter ${t+1}`,href:a?.href||"",order:t}}):[]}get availableChapters(){return this.workspace?this.workspace.opf.manifest.filter(e=>e.mediaType==="application/xhtml+xml").map(e=>({id:e.id,title:e.id,href:e.href})):[]}get currentTheme(){return this.globalSettings?.theme||"system"}get currentLocale(){return this.globalSettings?.locale||"en"}get editorFontSize(){return this.globalSettings?.editor_font_size||14}get isDraftMode(){return(this.workspaceSettings?.draft_id||0)>0}get currentDraftId(){return this.workspaceSettings?.draft_id||0}get isAdvancedMode(){return this.workspaceSettings?.editor?.advanced_mode??!1}getTransformEngine(){return this.transformEngine}getContentService(){return this.contentService}getSettingsService(){return this.settingsService}getAudioClipService(){return this.audioClipService}getExtensionManager(){return this.extensionManager}setupReactiveEffects(){wl(()=>{ht(()=>{this.workspace?.id?(this.loadWorkspaceSettings(this.workspace.id),this.loadEPUBSettings(this.workspace.id)):(this.workspaceSettings=null,this.epubSettings=null)}),ht(()=>{this.errorMessage&&setTimeout(()=>{this.errorMessage=null},5e3)})})}async initialize(){try{this.isLoading=!0,this.errorMessage=null,this.fileStorage.isInitialized()||await this.fileStorage.init(),await this.restoreWorkspaceState(),this.initialized=!0}catch(e){throw this.errorMessage=`Failed to initialize: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async listWorkspaces(){try{return this.isLoading=!0,this.errorMessage=null,await this.workspaceService.listWorkspaces()}catch(e){throw this.errorMessage=`Failed to list workspaces: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async createWorkspace(e,t="en"){try{this.isLoading=!0,this.errorMessage=null;const a=await this.workspaceService.createWorkspace({title:e,language:t,identifier:`urn:uuid:${crypto.randomUUID()}`}),n=await this.contentService.generateSampleContentData(t),i=await this.workspaceService.populateWithContent(a.id,n);return this.workspace=i,a.id}catch(a){throw this.errorMessage=`Failed to create workspace: ${a instanceof Error?a.message:"Unknown error"}`,a}finally{this.isLoading=!1}}async loadWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.loadWorkspace(e),this.selectedChapterId=null,this.selectedManifestItemId=null,this.persistWorkspaceId(e)}catch(t){throw this.errorMessage=`Failed to load workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async saveWorkspace(){if(!this.workspace)throw new Error("No workspace to save");try{this.isLoading=!0,this.errorMessage=null,this.workspace=await this.workspaceService.saveWorkspace(this.workspace)}catch(e){throw this.errorMessage=`Failed to save workspace: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async deleteWorkspace(e){try{this.isLoading=!0,this.errorMessage=null,await this.workspaceService.deleteWorkspace(e),this.workspace?.id===e&&(this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.clearPersistedState())}catch(t){throw this.errorMessage=`Failed to delete workspace: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}selectChapter(e){this.selectedChapterId=e,this.persistSpineItemId(e)}selectManifestItem(e){this.selectedManifestItemId=e}async generateSampleContent(e="en"){if(!this.workspace)throw new Error("No workspace loaded");try{this.isLoading=!0,this.errorMessage=null;const t=await this.contentService.generateLocalizedContent(e);this.workspace.opf.metadata={...this.workspace.opf.metadata,...t.metadata},t.chapters.forEach((a,n)=>{const i={id:`chapter${n+1}`,href:`Text/${a.title}.xhtml`,mediaType:"application/xhtml+xml"};this.workspace.opf.manifest.push(i),this.workspace.opf.spine.push({idref:i.id,linear:!0})}),await this.saveWorkspace()}catch(t){throw this.errorMessage=`Failed to generate sample content: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}loadGlobalSettings(){try{this.globalSettings=this.settingsService.loadGlobalSettings()}catch(e){console.warn("Failed to load global settings:",e),this.globalSettings=this.settingsService.getDefaultGlobalSettings()}}updateGlobalSettings(e){if(!this.globalSettings)return;const t={...this.globalSettings,...e};try{this.settingsService.saveGlobalSettings(t),this.globalSettings=t}catch(a){this.errorMessage=`Failed to save global settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadWorkspaceSettings(e){try{this.workspaceSettings=await this.settingsService.loadWorkspaceSettings(e)}catch(t){console.warn("Failed to load workspace settings:",t),this.workspaceSettings=this.settingsService.getDefaultWorkspaceSettings()}}async updateWorkspaceSettings(e){if(!this.workspace||!this.workspaceSettings)return;const t={...this.workspaceSettings,...e};try{await this.settingsService.saveWorkspaceSettings(this.workspace.id,t),this.workspaceSettings=t}catch(a){this.errorMessage=`Failed to save workspace settings: ${a instanceof Error?a.message:"Unknown error"}`}}async loadEPUBSettings(e){try{this.epubSettings=await this.settingsService.loadEPUBSettings(e)}catch(t){console.warn("Failed to load EPUB settings:",t),this.epubSettings=this.settingsService.getDefaultEPUBSettings()}}async updateEPUBSettings(e){if(!this.workspace||!this.epubSettings)return;const t={...this.epubSettings,...e};try{await this.settingsService.saveEPUBSettings(this.workspace.id,t),this.epubSettings=t}catch(a){this.errorMessage=`Failed to save EPUB settings: ${a instanceof Error?a.message:"Unknown error"}`}}async incrementDraftId(){if(this.workspace)try{const e=await this.settingsService.incrementDraftId(this.workspace.id);this.workspaceSettings&&(this.workspaceSettings.draft_id=e);const t=this.settingsService.extractDraftInfo(this.workspace.opf.metadata.title).baseTitle;this.workspace.opf.metadata.title=this.settingsService.generateDraftTitle(t,e)}catch(e){this.errorMessage=`Failed to increment draft ID: ${e instanceof Error?e.message:"Unknown error"}`}}async packageEPUB(){if(!this.workspace)throw new Error("No workspace to package");try{this.isLoading=!0,this.errorMessage=null;const e=await this.epubProcessor.packageEPUB(this.workspace.id,{compressionLevel:"balanced",validateStructure:!0,progressCallback:t=>{console.log("Package progress:",t)}});if(!e.success)throw new Error(e.error||"Package failed");return e.blob||null}catch(e){throw this.errorMessage=`Failed to package EPUB: ${e instanceof Error?e.message:"Unknown error"}`,e}finally{this.isLoading=!1}}async unpackEPUB(e){try{this.isLoading=!0,this.errorMessage=null;const t=await this.epubProcessor.unpackEPUB(e,`workspace-${Date.now()}`);if(!t.success)throw new Error(t.error||"Unpack failed");const a=t.workspaceId;return await this.loadWorkspace(a),a}catch(t){throw this.errorMessage=`Failed to unpack EPUB: ${t instanceof Error?t.message:"Unknown error"}`,t}finally{this.isLoading=!1}}async restoreWorkspaceState(){try{const e=localStorage.getItem(Sn.WORKSPACE_ID);if(e){await this.loadWorkspace(e);const t=localStorage.getItem(Sn.SPINE_ITEM_ID);t&&(this.selectedChapterId=t)}}catch(e){console.warn("Failed to restore workspace state:",e),this.clearPersistedState()}}persistWorkspaceId(e){try{e?localStorage.setItem(Sn.WORKSPACE_ID,e):localStorage.removeItem(Sn.WORKSPACE_ID)}catch(t){console.warn("Failed to persist workspace ID:",t)}}persistSpineItemId(e){try{e?localStorage.setItem(Sn.SPINE_ITEM_ID,e):localStorage.removeItem(Sn.SPINE_ITEM_ID)}catch(t){console.warn("Failed to persist spine item ID:",t)}}clearPersistedState(){try{localStorage.removeItem(Sn.WORKSPACE_ID),localStorage.removeItem(Sn.SPINE_ITEM_ID)}catch(e){console.warn("Failed to clear persisted state:",e)}}cleanup(){this.workspace=null,this.selectedChapterId=null,this.selectedManifestItemId=null,this.initialized=!1,this.isLoading=!1,this.errorMessage=null}}class Ba extends Error{stage;scriptName;line;column;hasCustomStack;constructor(e){super(e.message),this.name="TransformError",this.stage=e.stage,this.scriptName=e.scriptName,this.line=e.line,this.column=e.column,this.hasCustomStack=!!e.stack,e.stack&&(this.stack=e.stack)}toUserMessage(){let a=`${{loading:"Script Loading",text:"Text Transform",dom:"DOM Transform",template:"Template Generation"}[this.stage]} Error: ${this.message}`;return this.scriptName&&(a+=`
Script: ${this.scriptName}`),this.line!==void 0&&(a+=`
Line ${this.line}`),this.column!==void 0&&(a+=`
Column ${this.column}`),a}getErrorDetails(){return{stage:this.stage,message:this.message,scriptName:this.scriptName,line:this.line,column:this.column,stack:this.hasCustomStack?this.stack:void 0,userMessage:this.toUserMessage()}}}class fa{static DEFAULT_TIMEOUT_MS=2e3;async executeTextTransform(e,t,a,n,i={}){const o=i.timeoutMs||fa.DEFAULT_TIMEOUT_MS;return new Promise((l,d)=>{const f=setTimeout(()=>{d(new Ba({stage:"text",message:`Transform execution timed out after ${o}ms`,scriptName:t}))},o);try{const c=this.createSandboxedGlobals(i.globals),p=this.executeFunctionInSandbox(e,"transformText",[a,n.idref],c,t);clearTimeout(f),l(typeof p=="string"?p:String(p))}catch(c){clearTimeout(f),d(this.createTransformError(c,"text",t))}})}async executeDOMTransform(e,t,a,n,i={}){const o=i.timeoutMs||fa.DEFAULT_TIMEOUT_MS;return new Promise((l,d)=>{const f=setTimeout(()=>{d(new Ba({stage:"dom",message:`Transform execution timed out after ${o}ms`,scriptName:t}))},o);try{const c=a.cloneNode(!0),p=this.createSandboxedGlobals(i.globals),h=this.executeFunctionInSandbox(e,"transformDOM",[c,n.idref],p,t);clearTimeout(f),h instanceof Document?l(h):l(c)}catch(c){clearTimeout(f),d(this.createTransformError(c,"dom",t))}})}createSandboxedGlobals(e={}){const t={console,JSON,Math,Date,RegExp,String,Number,Boolean,Array,Object,document:typeof document<"u"?document:void 0,...e};return["eval","Function","setTimeout","setInterval","clearTimeout","clearInterval","setImmediate","clearImmediate","XMLHttpRequest","fetch","import","require","process","global","globalThis"].forEach(n=>{delete t[n]}),t}executeFunctionInSandbox(e,t,a,n,i){const o=Object.keys(n),l=Object.values(n),d=`(function(${o.join(", ")}) {
        ${e}

        if (typeof ${t} !== 'function') {
          throw new Error('Function ${t} is not defined or not a function');
        }

        return ${t};
      })`;return new Function("return "+d)()(...l)(...a)}createTransformError(e,t,a){const n=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;let o,l;if(i){const d=i.match(/at.*:(\d+):(\d+)/);d&&(o=parseInt(d[1],10),l=parseInt(d[2],10))}return new Ba({stage:t,message:n,scriptName:a,line:o,column:l,stack:i})}}class Ft extends Error{constructor(e,t,a){super(e),this.code=t,this.workspaceId=a,this.name="SpineServiceError"}}class ag{constructor(e){this.workspaceService=e}async loadSpineItems(e){try{const t=[];for(const a of e.opf.spine){const n=e.opf.manifest.find(l=>l.id===a.idref);if(!n)continue;const i=`SOURCE/text/${n.id}.txt`,o=await this.workspaceService.fileExists(e.id,i);t.push({idref:n.id,linear:a.linear??!0,id:n.id,href:n.href,mediaType:n.mediaType,sourcePath:o?i:void 0,hasSourceFile:o})}return t}catch(t){throw new Ft(`Failed to load spine items: ${t instanceof Error?t.message:"Unknown error"}`,"LOAD_ERROR",e.id)}}async addChapter(e,t){try{const a=this.generateUniqueChapterId(e),n=`Text/${a}.xhtml`,i={id:a,href:n,mediaType:"application/xhtml+xml"};let o=await this.workspaceService.addManifestItem(e,i);const l={idref:a,linear:t.linear??!0};o=await this.workspaceService.addSpineItem(o,l,t.insertIndex);const d=this.generateChapterXHTML(t.title);await this.workspaceService.writeFile(e.id,n,d);let f=!1,c;if(t.createSourceFile){c=`SOURCE/text/${a}.txt`;const h=`# ${t.title}

Your chapter content goes here...`;await this.workspaceService.writeFile(e.id,c,h),f=!0}const p={idref:a,linear:t.linear??!0,id:a,href:n,mediaType:"application/xhtml+xml",sourcePath:f?c:void 0,hasSourceFile:f};return{updatedWorkspace:o,newChapter:p}}catch(a){throw new Ft(`Failed to add chapter: ${a instanceof Error?a.message:"Unknown error"}`,"ADD_CHAPTER_ERROR",e.id)}}async moveChapterUp(e,t){try{if(t<=0)throw new Ft("Cannot move first chapter up","INVALID_MOVE",e.id);const a=await this.loadSpineItems(e);if(t>=a.length)throw new Ft("Invalid chapter index","INVALID_INDEX",e.id);const n=[...a];return[n[t-1],n[t]]=[n[t],n[t-1]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(o=>o.id)),newOrder:n}}catch(a){throw a instanceof Ft?a:new Ft(`Failed to move chapter up: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async moveChapterDown(e,t){try{const a=await this.loadSpineItems(e);if(t<0||t>=a.length-1)throw new Ft("Cannot move last chapter down","INVALID_MOVE",e.id);const n=[...a];return[n[t],n[t+1]]=[n[t+1],n[t]],{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,n.map(o=>o.id)),newOrder:n}}catch(a){throw a instanceof Ft?a:new Ft(`Failed to move chapter down: ${a instanceof Error?a.message:"Unknown error"}`,"MOVE_ERROR",e.id)}}async reorderItems(e,t,a){try{const n=await this.loadSpineItems(e);if(t<0||t>=n.length||a<0||a>=n.length)throw new Ft("Invalid reorder indices","INVALID_INDEX",e.id);const i=[...n],[o]=i.splice(t,1);return i.splice(a,0,o),{updatedWorkspace:await this.workspaceService.updateSpineOrder(e,i.map(d=>d.id)),newOrder:i}}catch(n){throw n instanceof Ft?n:new Ft(`Failed to reorder items: ${n instanceof Error?n.message:"Unknown error"}`,"REORDER_ERROR",e.id)}}generateUniqueChapterId(e){const t=new Set(e.opf.manifest.map(i=>i.id));let a=1,n=`chapter${a.toString().padStart(2,"0")}`;for(;t.has(n);)a++,n=`chapter${a.toString().padStart(2,"0")}`;return n}generateChapterXHTML(e){return`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">
<head>
    <title>${e}</title>
    <link rel="stylesheet" type="text/css" href="../Styles/styles.css"/>
</head>
<body>
    <section class="chapter">
        <h1>${e}</h1>
        <p>Your chapter content goes here...</p>
    </section>
</body>
</html>`}async deleteChapter(e,t){try{if(e.opf.spine.findIndex(l=>l.idref===t)===-1)throw new Ft("Chapter not found in spine","CHAPTER_NOT_FOUND",e.id);const n=e.opf.manifest.findIndex(l=>l.id===t);if(n===-1)throw new Ft("Chapter not found in manifest","MANIFEST_ITEM_NOT_FOUND",e.id);const i=e.opf.manifest[n],o={...e,opf:{...e.opf,spine:e.opf.spine.filter(l=>l.idref!==t),manifest:e.opf.manifest.filter(l=>l.id!==t)}};await this.workspaceService.saveWorkspace(o);try{const l=i.href.startsWith(e.pathInfo.basePath)?i.href:`${e.pathInfo.basePath}/${i.href}`;await this.workspaceService.fileStorage.deleteFile(o.id,l)}catch(l){console.warn("Failed to delete XHTML file:",l)}try{const l=`SOURCE/text/${t}.txt`;await this.workspaceService.fileStorage.deleteFile(o.id,l)}catch(l){console.warn("Failed to delete source file:",l)}return{updatedWorkspace:o}}catch(a){throw a instanceof Ft?a:new Ft(`Failed to delete chapter: ${a instanceof Error?a.message:"Unknown error"}`,"DELETE_ERROR",e.id)}}async renameChapterId(e,t,a){try{if(!/^[a-zA-Z_][a-zA-Z0-9_.-]*$/.test(a))throw new Ft("Invalid ID format. ID must start with a letter or underscore and contain only letters, numbers, hyphens, periods, and underscores.","INVALID_ID_FORMAT",e.id);if(e.opf.manifest.some(f=>f.id===a))throw new Ft(`ID '${a}' already exists`,"DUPLICATE_ID",e.id);const n=e.opf.manifest.find(f=>f.id===t);if(!n)throw new Ft(`Item with ID '${t}' not found`,"ITEM_NOT_FOUND",e.id);const i=n.href.replace(t,a);let o=await this.workspaceService.updateManifestItem(e,t,{id:a,href:i});const l=`SOURCE/text/${t}.txt`,d=`SOURCE/text/${a}.txt`;return await this.workspaceService.fileExists(e.id,l)&&await this.workspaceService.renameFile(e.id,l,d),{updatedWorkspace:o}}catch(n){throw new Ft(`Failed to rename chapter ID: ${n instanceof Error?n.message:"Unknown error"}`,"RENAME_ERROR",e.id)}}}var ig=I('<div class="error-state svelte-141k6tx"><h2 class="svelte-141k6tx">Transform Engine Failed</h2> <p class="svelte-141k6tx"> </p> <p class="svelte-141k6tx">Please refresh the page to try again.</p></div>'),sg=I('<div class="loading-state svelte-141k6tx"><div class="spinner svelte-141k6tx"></div> <p>Initializing transform engine...</p></div>'),og=I('<div class="loading-state svelte-141k6tx"><div class="spinner svelte-141k6tx"></div> <p>Initializing application...</p></div>'),lg=I('<div class="placeholder-content svelte-141k6tx"><p class="svelte-141k6tx"> </p></div>'),cg=I('<div class="placeholder-content svelte-141k6tx"><p class="svelte-141k6tx"> </p></div>'),dg=I('<div class="placeholder-content svelte-141k6tx"><p class="svelte-141k6tx"> </p></div>'),ug=(r,e,t)=>e(s(t).id),fg=I('<div class="package-epub-section svelte-141k6tx"><button class="package-epub-button svelte-141k6tx"> </button></div>'),pg=I('<div class="placeholder-content svelte-141k6tx"><h3 class="svelte-141k6tx"> </h3> <p class="svelte-141k6tx"> </p></div>'),hg=I('<div class="placeholder-content svelte-141k6tx"><h3 class="svelte-141k6tx"> </h3> <p class="svelte-141k6tx"> </p></div>'),vg=I('<div class="placeholder-content svelte-141k6tx"><h3 class="svelte-141k6tx"> </h3> <p class="svelte-141k6tx"> </p></div>'),mg=I('<div class="placeholder-content svelte-141k6tx"><h3 class="svelte-141k6tx"> </h3> <p class="svelte-141k6tx"> </p> <p class="current-view-info svelte-141k6tx"> <strong> </strong></p></div>');function gg(r,e){rt(e,!0);const[t,a]=dt(),n=()=>tt(Mt,"$navigationStore",t),i=()=>tt(Un,"$layoutStore",t),o=()=>tt(mt,"$t",t);let l=fe(void 0);const d={setTheme:()=>{},useSystemPreference:()=>{},getCurrentTheme:()=>"system"},f={setLocale:()=>{},getCurrentLocale:()=>"en"},c=Wt.getInstance(),p=new fa,h=new Eo(c),v=new ag(h),g=new Xf(h),b=new ki,y=new To;let L,k=null,E=fe(!1),T=fe(null),P=fe(null),$=ne(()=>n().currentView),R=ne(()=>i().sidebar.isExpanded),z=ne(()=>s(P)?.currentWorkspaceId),O=ne(()=>s(P)?.selectedChapterId),W=ne(()=>s(P)?.initialized||!1),N=ne(()=>s(P)?.workspace),j=fe(null),x=ne(()=>s(N)?.opf?.metadata),F=ne(()=>s(x)?.title),q=ne(()=>s(F)?`${s(F)}`:"EDITME"),te=fe(null),M=fe(null),Q=fe(null),ce=fe(It({xhtmlContent:"",isTransforming:!1,transformError:null,transformWarnings:[],executionTime:0,spineItemId:null}));const be=he=>{m(te,he.item,!0),m(M,he.type,!0)},_e=async he=>{const{field:ke}=he.detail;(ke==="creator"||ke==="title"||ke==="language")&&window.dispatchEvent(new CustomEvent("workspace-list-refresh"))},Ue=he=>{m(j,he.detail.field,!0)},Ce=he=>{m(Q,he.xhtml,!0)};function pe(he){console.log("handleNavigationClick",he);const ke=s(N)?.opf?.manifest?.find(Te=>Te.href?.includes(`${he}.xhtml`));if(ke){const Te=new CustomEvent("select-spine-item",{detail:{itemId:ke.id},bubbles:!0});window.dispatchEvent(Te)}}const K=he=>{m(ce,{xhtmlContent:he.detail.xhtmlContent,isTransforming:he.detail.isTransforming,transformError:he.detail.transformError,transformWarnings:he.detail.transformWarnings,executionTime:he.detail.executionTime,spineItemId:he.detail.spineItemId},!0)},oe=he=>{const ke=document.querySelector("[data-spine-view]");ke&&(console.log("handlePreviewClick",he),ke.dispatchEvent(new CustomEvent("preview-click",{detail:he,bubbles:!0})))},ie=async he=>{if(!(!s(N)||!s(P)||!confirm(o()("Are you sure you want to delete this item?"))))try{const Te=await h.removeManifestItem(s(N),he.detail.itemId);s(P).workspace=Te,s(te)&&s(te).id===he.detail.itemId&&(m(te,null),m(M,null))}catch(Te){console.error("Failed to delete manifest item:",Te)}},xe=async(he,ke)=>{if(!s(P)){console.error("AppState not initialized");return}try{let Te;if(he)Te=he;else if(ke){console.log(`Downloading EPUB from: ${ke}`);const ve=await fetch(ke);if(!ve.ok)throw new Error(`Failed to download EPUB: ${ve.status} ${ve.statusText}`);const We=await ve.blob(),Ve=Me(ke);Te=new File([We],Ve,{type:"application/epub+zip"})}else Te=await Ae();const Oe="workspace-"+crypto.randomUUID();console.log(`Importing EPUB: ${Te.name} to workspace: ${Oe}`);const se=await y.unpackEPUB(Te,Oe);if(!se.success)throw new Error(se.error||"Failed to unpack EPUB");console.log(`â Successfully imported EPUB: ${se.extractedFiles?.length} files extracted`),await s(P).loadWorkspace(Oe);const Ee=s(P).workspace?.opf?.spine?.[0];Ee?(s(P).selectChapter(Ee.idref),Mt.navigateTo("spine")):Mt.navigateTo("metadata"),location.hash=""}catch(Te){console.error("Failed to import EPUB:",Te);const Oe=Te instanceof Error?Te.message:"Unknown error";alert(`Failed to import EPUB: ${Oe}`)}},Me=he=>{try{const Oe=new URL(he).pathname.split("/").pop()||"imported-epub.epub";return Oe.endsWith(".epub")?Oe:`${Oe}.epub`}catch{return"imported-epub.epub"}},Ae=()=>new Promise((he,ke)=>{const Te=document.createElement("input");Te.type="file",Te.accept=".epub",Te.onchange=Oe=>{const se=Oe.target.files?.[0];se?he(se):ke(new Error("No file selected"))},Te.oncancel=()=>{ke(new Error("File selection cancelled"))},Te.click()}),He=he=>{if(!s(P))return;const ke=s(P).workspace?.opf?.spine?.[0];ke?(s(P).selectChapter(ke.idref),Mt.navigateTo("spine")):Mt.navigateTo("metadata")},$e=async he=>{if(s(N))try{const ke=await h.updateMetadata(s(N),{modifiedDate:gn()});s(P)&&(s(P).workspace=ke);const Te=await b.packageEPUB(he,{progressCallback:Oe=>{console.log(`Packaging progress: ${Oe.phase} - ${Oe.processedFiles}/${Oe.totalFiles} files`)}});if(Te.success&&Te.blob&&Te.filename)b.downloadEPUB(Te.blob,Te.filename),console.log(`â Successfully packaged and downloaded: ${Te.filename}`);else throw new Error(Te.error||"Unknown packaging error")}catch(ke){throw console.error("Failed to package EPUB:",ke),ke}};rn(()=>{(async()=>{try{await c.init(),m(l,new Ci(c),!0),L=new Ti({fileStorage:c,basePath:"OEBPS",maxBlobURLs:100,onCapacityReached:()=>{console.warn("Blob URL capacity reached - consider cleanup")}}),k=new lm(L,s(l)),await k.initialize(),m(E,!0),m(P,new rg(c,p,go,s(l),d,f,k),!0),await s(P).initialize(),window.location.hash&&Te()}catch(Oe){console.error("Failed to initialize app:",Oe),m(T,Oe instanceof Error?Oe.message:"Initialization failed",!0)}})();const he=Oe=>{if(!s(P))return;const se=Oe;s(P).selectChapter(se.detail.itemId),Mt.navigateTo("spine")},ke=()=>{s(P)&&s(P).selectChapter(null)};function Te(){const Oe=window.location.hash.slice(1);if(Oe.startsWith("http"))try{const se=decodeURIComponent(Oe);console.log(`Hash change detected: importing EPUB from ${se}`),xe(void 0,se)}catch(se){console.error("Failed to decode URL from hash:",se),alert("Invalid URL in hash fragment")}}return window.addEventListener("select-spine-item",he),window.addEventListener("clear-spine-selection",ke),window.addEventListener("hashchange",Te),()=>{window.removeEventListener("select-spine-item",he),window.removeEventListener("clear-spine-selection",ke),window.removeEventListener("hashchange",Te),s(P)?.cleanup(),k?.cleanup()}});var Ye=pt();Hl(he=>{D(()=>_s.title=s(q))});var Ne=et(Ye);{var Ge=he=>{var ke=ig(),Te=w(u(ke),2),Oe=u(Te);D(()=>S(Oe,s(T))),_(he,ke)},Ke=(he,ke)=>{{var Te=se=>{var Ee=sg();_(se,Ee)},Oe=(se,Ee)=>{{var ve=Ve=>{var B=og();_(Ve,B)},We=Ve=>{const B=ne(()=>!!s(z));hu(Ve,{get hasWorkspace(){return s(B)},get currentWorkspace(){return s(N)},get workspaceTitle(){return s(F)},get extensionManager(){return s(l)},$$slots:{"sidebar-spine":(H,Z)=>{var ue=pt(),ye=et(ue);{var Se=Ie=>{var Xe=lg(),Be=u(Xe),le=u(Be);D(ae=>S(le,ae),[()=>o()("Loading projectâ¦")]),_(Ie,Xe)},Fe=(Ie,Xe)=>{{var Be=ae=>{var me=cg(),Pe=u(me),qe=u(Pe);D(Le=>S(qe,Le),[()=>o()("No project selected")]),_(ae,me)},le=(ae,me)=>{{var Pe=Le=>{av(Le,{get workspace(){return s(N)},get spineService(){return v},get selectedItemId(){return s(O)},get isExpanded(){return s(R)},onWorkspaceUpdate:re=>{s(P)&&(s(P).workspace=re)}})},qe=Le=>{var re=dg(),Y=u(re),ge=u(Y);D(ee=>S(ge,ee),[()=>o()("Loading projectâ¦")]),_(Le,re)};U(ae,Le=>{s(N)?Le(Pe):Le(qe,!1)},me)}};U(Ie,ae=>{s(N)?ae(le,!1):ae(Be)},Xe)}};U(ye,Ie=>{s(W)?Ie(Fe,!1):Ie(Se)})}_(H,ue)},"sidebar-footer":(H,Z)=>{var ue=pt(),ye=et(ue);{var Se=Fe=>{var Ie=fg(),Xe=u(Ie);Xe.__click=[ug,$e,N];var Be=u(Xe);D((le,ae)=>{de(Xe,"title",le),S(Be,ae)},[()=>o()("Package EPUB"),()=>o()("Package EPUB")]),_(Fe,Ie)};U(ye,Fe=>{s(N)&&Fe(Se)})}_(H,ue)},"left-content":(H,Z)=>{var ue=pt(),ye=et(ue);{var Se=Ie=>{bu(Ie,{})},Fe=(Ie,Xe)=>{{var Be=ae=>{rf(ae,{onListWorkspaces:()=>s(P)?.listWorkspaces()??Promise.resolve([]),onCreateWorkspace:me=>s(P)?.createWorkspace(me.title,me.language)??Promise.resolve(""),onDeleteWorkspace:me=>s(P)?.deleteWorkspace(me)??Promise.resolve(),onLoadWorkspace:me=>s(P)?.loadWorkspace(me)??Promise.resolve(),onEpubImportRequested:xe,get currentWorkspaceId(){return s(z)},onNavigationRequested:me=>{Mt.navigateTo(me)},onSmartNavigationRequested:He,onWorkspaceOpened:()=>{},onWorkspaceChanged:()=>{}})},le=(ae,me)=>{{var Pe=Le=>{var re=pt(),Y=et(re);{var ge=A=>{np(A,{get metadataService(){return g},get workspace(){return s(P).workspace},set workspace(J){s(P).workspace=J},$$events:{metadataChanged:_e,fieldFocus:Ue}})},ee=A=>{const J=ne(()=>o()("EPUB Metadata")),C=ne(()=>o()("Configure publication metadata and details"));Xr(A,{viewType:"metadata",get title(){return s(J)},get description(){return s(C)},icon:"ð"})};U(Y,A=>{s(W)&&s(N)&&s(P)?A(ge):A(ee,!1)})}_(Le,re)},qe=(Le,re)=>{{var Y=ee=>{var A=pt(),J=et(A);{var C=X=>{Bv(X,{get workspace(){return s(N)},get workspaceService(){return h},get advancedMode(){return s(P).isAdvancedMode},onItemSelect:be})},G=X=>{const we=ne(()=>o()("File Manifest")),Re=ne(()=>o()("Manage EPUB files and resources"));Xr(X,{viewType:"manifest",get title(){return s(we)},get description(){return s(Re)},icon:"ð"})};U(J,X=>{s(W)&&s(N)?X(C):X(G,!1)})}_(ee,A)},ge=(ee,A)=>{{var J=G=>{var X=pt(),we=et(X);{var Re=je=>{const Qe=ne(()=>s(P).getTransformEngine()),Ze=ne(()=>s(P).getSettingsService()),Je=ne(()=>s(P).getExtensionManager());dm(je,{get workspace(){return s(N)},get workspaceService(){return h},get spineService(){return v},get transformEngine(){return s(Qe)},get settingsService(){return s(Ze)},get extensionManager(){return s(Je)},get blobURLManager(){return L},get fileStorage(){return c},previewUpdate:Ce})},ze=je=>{const Qe=ne(()=>o()("Table of Contents")),Ze=ne(()=>o()("Loading projectâ¦"));Xr(je,{viewType:"navigation",get title(){return s(Qe)},get description(){return s(Ze)},icon:"ð"})};U(we,je=>{s(W)&&s(N)?je(Re):je(ze,!1)})}_(G,X)},C=(G,X)=>{{var we=ze=>{var je=pt(),Qe=et(je);{var Ze=ot=>{const gt=ne(()=>s(P).getTransformEngine()),ut=ne(()=>s(P).getContentService()),lt=ne(()=>s(P).getAudioClipService());_h(ot,{get workspace(){return s(N)},get workspaceService(){return h},get spineService(){return v},get selectedItemId(){return s(O)},get transformEngine(){return s(gt)},get contentService(){return s(ut)},get audioClipService(){return s(lt)},$$events:{previewUpdate:K}})},Je=ot=>{const gt=ne(()=>o()("Spine Items")),ut=ne(()=>o()("Loading projectâ¦"));Xr(ot,{viewType:"spine",get title(){return s(gt)},get description(){return s(ut)},icon:"ð"})};U(Qe,ot=>{s(W)&&s(N)&&s(P)?ot(Ze):ot(Je,!1)})}_(ze,je)},Re=(ze,je)=>{{var Qe=Je=>{const ot=ne(()=>s(P).getSettingsService()),gt=ne(()=>s(P).getExtensionManager()),ut=ne(()=>s(P).getTransformEngine());zh(Je,{get settingsService(){return s(ot)},get extensionManager(){return s(gt)},get transformEngine(){return s(ut)},get workspaceId(){return s(P).currentWorkspaceId},onSettingsChanged:()=>{s(P)?.currentWorkspaceId&&s(P).loadWorkspaceSettings(s(P).currentWorkspaceId)}})},Ze=Je=>{var ot=pg(),gt=u(ot),ut=u(gt),lt=w(gt,2),xt=u(lt);D((ft,Ot)=>{S(ut,ft),S(xt,`${Ot??""}: ${s($)??""}`)},[()=>o()("Unknown View"),()=>o()("View type")]),_(Je,ot)};U(ze,Je=>{s($)==="settings"?Je(Qe):Je(Ze,!1)},je)}};U(G,ze=>{s($)==="spine"?ze(we):ze(Re,!1)},X)}};U(ee,G=>{s($)==="navigation"?G(J):G(C,!1)},A)}};U(Le,ee=>{s($)==="manifest"?ee(Y):ee(ge,!1)},re)}};U(ae,Le=>{s($)==="metadata"?Le(Pe):Le(qe,!1)},me)}};U(Ie,ae=>{s($)==="workspace"&&s(W)?ae(Be):ae(le,!1)},Xe)}};U(ye,Ie=>{s($)==="about"?Ie(Se):Ie(Fe,!1)})}_(H,ue)},"right-content":(H,Z)=>{var ue=pt(),ye=et(ue);{var Se=Ie=>{Eu(Ie,{})},Fe=(Ie,Xe)=>{{var Be=ae=>{const me=ne(()=>s(P)?.isAdvancedMode??!1);Cm(ae,{get workspace(){return s(N)},get focusedField(){return s(j)},get isAdvancedMode(){return s(me)}})},le=(ae,me)=>{{var Pe=Le=>{rm(Le,{get selectedItem(){return s(te)},get selectedItemType(){return s(M)},get workspace(){return s(N)},get workspaceService(){return h},$$events:{itemDelete:ie}})},qe=(Le,re)=>{{var Y=ee=>{var A=pt(),J=et(A);{var C=X=>{fm(X,{get content(){return s(Q)},onNavigate:pe})},G=X=>{var we=hg(),Re=u(we),ze=u(Re),je=w(Re,2),Qe=u(je);D((Ze,Je)=>{S(ze,Ze),S(Qe,Je)},[()=>o()("Navigation Preview"),()=>o()("Generating navigation from chapters...")]),_(X,we)};U(J,X=>{s(Q)?X(C):X(G,!1)})}_(ee,A)},ge=(ee,A)=>{{var J=G=>{var X=pt(),we=et(X);{var Re=je=>{Gm(je,{get xhtmlContent(){return s(ce).xhtmlContent},get isTransforming(){return s(ce).isTransforming},get transformError(){return s(ce).transformError},get transformWarnings(){return s(ce).transformWarnings},get executionTime(){return s(ce).executionTime},get spineItemId(){return s(ce).spineItemId},onPreviewClick:oe,onNavigate:pe})},ze=je=>{var Qe=vg(),Ze=u(Qe),Je=u(Ze),ot=w(Ze,2),gt=u(ot);D((ut,lt)=>{S(Je,ut),S(gt,lt)},[()=>o()("Spine Preview"),()=>o()("Select a spine item to see the preview here")]),_(je,Qe)};U(we,je=>{s(ce).spineItemId?je(Re):je(ze,!1)})}_(G,X)},C=G=>{var X=mg(),we=u(X),Re=u(we),ze=w(we,2),je=u(ze),Qe=w(ze,2),Ze=u(Qe),Je=w(Ze),ot=u(Je);D((gt,ut,lt)=>{S(Re,gt),S(je,ut),S(Ze,`${lt??""}: `),S(ot,s($))},[()=>o()("Preview Pane"),()=>o()("Content preview will appear here based on the current view"),()=>o()("Current view")]),_(G,X)};U(ee,G=>{s($)==="spine"?G(J):G(C,!1)},A)}};U(Le,ee=>{s($)==="navigation"?ee(Y):ee(ge,!1)},re)}};U(ae,Le=>{s($)==="manifest"&&s(W)&&s(N)?Le(Pe):Le(qe,!1)},me)}};U(Ie,ae=>{s($)==="metadata"&&s(W)&&s(N)?ae(Be):ae(le,!1)},Xe)}};U(ye,Ie=>{s($)==="about"?Ie(Se):Ie(Fe,!1)})}_(H,ue)}}})};U(se,Ve=>{s(P)?Ve(We,!1):Ve(ve)},Ee)}};U(he,se=>{s(E)?se(Oe,!1):se(Te)},ke)}};U(Ne,he=>{s(T)?he(Ge):he(Ke,!1)})}_(r,Ye),at(),a()}_t(["click"]);mo().catch(r=>{console.error("Failed to initialize i18n:",r)});ql(gg,{target:document.getElementById("app")});</script>
    <style rel="stylesheet" crossorigin>:root{--color-neutral-50: #ffffff;--color-neutral-100: #f8f8f8;--color-neutral-200: #f0f0f0;--color-neutral-300: #e0e0e0;--color-neutral-400: #cccccc;--color-neutral-500: #999999;--color-neutral-600: #666666;--color-neutral-700: #444444;--color-neutral-800: #333333;--color-neutral-900: #222222;--color-neutral-950: #000000;--color-primary-50: #f0f0ff;--color-primary-100: #e6e6ff;--color-primary-200: #ccccff;--color-primary-300: #9999ff;--color-primary-400: #6666ff;--color-primary-500: #3333ff;--color-primary-600: #0000ee;--color-primary-700: #0000cc;--color-primary-800: #0000aa;--color-primary-900: #000088;--color-primary-950: #000066;--color-success-50: #f0fdf4;--color-success-100: #e6f5e6;--color-success-200: #cceecc;--color-success-300: #99dd99;--color-success-400: #66cc66;--color-success-500: #33bb33;--color-success-600: #22aa22;--color-success-700: #118811;--color-success-800: #006600;--color-success-900: #005500;--color-success-950: #004400;--color-warning-50: #fffbeb;--color-warning-100: #fef3c7;--color-warning-200: #fde68a;--color-warning-300: #fcd34d;--color-warning-400: #fbbf24;--color-warning-500: #f59e0b;--color-warning-600: #d97706;--color-warning-700: #b45309;--color-warning-800: #92400e;--color-warning-900: #78350f;--color-warning-950: #451a03;--color-error-50: #fef2f2;--color-error-100: #fee2e2;--color-error-200: #fecaca;--color-error-300: #fca5a5;--color-error-400: #f87171;--color-error-500: #ef4444;--color-error-600: #dc2626;--color-error-700: #b91c1c;--color-error-800: #991b1b;--color-error-900: #7f1d1d;--color-error-950: #450a0a;--color-white: #ffffff;--color-black: #000000;--color-transparent: transparent;--color-link-visited: #551a8b;--color-craigslist-bg: #f0f0f0;--color-craigslist-border: #ccc;--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-craigslist-bg);--color-bg-tertiary: var(--color-neutral-100);--color-bg-quaternary: var(--color-neutral-200);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-text-link-visited: var(--color-link-visited);--color-border-default: var(--color-craigslist-border);--color-border-strong: var(--color-neutral-400);--color-border-subtle: var(--color-neutral-300);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-success-600);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-primary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-neutral-100);--color-sidebar-item-active: var(--color-neutral-200);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-neutral-100);--color-button-primary-bg-hover: var(--color-neutral-200);--color-button-primary-text: var(--color-text-primary);--color-button-primary-border: var(--color-neutral-400);--color-button-secondary-bg: var(--color-white);--color-button-secondary-bg-hover: var(--color-neutral-100);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-success-600);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-input-border-active: var(--color-success-600);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-forced-bg: Canvas;--color-forced-text: CanvasText;--color-forced-border: ButtonBorder;--color-forced-link: LinkText;--color-forced-visited: VisitedText;--color-forced-active: ActiveText;--color-forced-button-face: ButtonFace;--color-forced-button-text: ButtonText;--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-forced-text);--color-bg-primary: var(--color-forced-bg);--color-border-default: var(--color-forced-border);--color-text-link: var(--color-forced-link);--color-focus: var(--color-forced-active)}}:root{--space-0: 0;--space-px: 1px;--space-0-5: .125rem;--space-1: .25rem;--space-1-5: .375rem;--space-2: .5rem;--space-2-5: .625rem;--space-3: .75rem;--space-3-5: .875rem;--space-4: 1rem;--space-5: 1.25rem;--space-6: 1.5rem;--space-7: 1.75rem;--space-8: 2rem;--space-9: 2.25rem;--space-10: 2.5rem;--space-11: 2.75rem;--space-12: 3rem;--space-14: 3.5rem;--space-16: 4rem;--space-20: 5rem;--space-24: 6rem;--space-28: 7rem;--space-32: 8rem;--space-36: 9rem;--space-40: 10rem;--space-44: 11rem;--space-48: 12rem;--space-52: 13rem;--space-56: 14rem;--space-60: 15rem;--space-64: 16rem;--space-72: 18rem;--space-80: 20rem;--space-96: 24rem;--spacing-component-xs: var(--space-0-5);--spacing-component-sm: var(--space-1);--spacing-component-md: var(--space-2);--spacing-component-lg: var(--space-3);--spacing-component-xl: var(--space-4);--spacing-layout-xs: var(--space-1);--spacing-layout-sm: var(--space-2);--spacing-layout-md: var(--space-3);--spacing-layout-lg: var(--space-4);--spacing-layout-xl: var(--space-6);--spacing-content-xs: var(--space-2);--spacing-content-sm: var(--space-3);--spacing-content-md: var(--space-4);--spacing-content-lg: var(--space-5);--spacing-content-xl: var(--space-6);--layout-sidebar-width-expanded: 250px;--layout-sidebar-width-collapsed: 40px;--layout-header-height: 60px;--layout-header-padding: var(--space-4);--layout-content-padding: var(--space-3);--layout-content-max-width: 960px;--layout-content-gap: var(--space-2);--layout-panel-padding-block: var(--space-3);--layout-panel-padding-inline: var(--space-3);--layout-panel-gap: var(--space-2);--layout-panel-border-radius: var(--radius-none);--layout-resize-handle-width: 4px;--layout-resize-handle-hover-width: 6px;--form-field-spacing: var(--space-2);--form-group-spacing: var(--space-3);--form-section-spacing: var(--space-4);--list-item-padding-block: var(--space-1);--list-item-padding-inline: var(--space-1);--list-item-gap: var(--space-1);--list-section-gap: var(--space-3);--card-padding-block: var(--space-3);--card-padding-inline: var(--space-3);--card-gap: var(--space-2);--card-header-padding-block: var(--space-2);--card-header-padding-inline: var(--space-2);--button-padding-inline: var(--space-2);--button-padding-block: var(--space-1);--button-gap: var(--space-1);--layout-direction: ltr;--content-align-start: left;--content-align-end: right;--focus-ring-width: 2px;--focus-ring-offset: 2px;--focus-ring-style: solid;--touch-target-min: 44px;--touch-target-spacing: var(--space-2);--sr-only-clip: rect(0, 0, 0, 0);--radius-none: 0;--radius-xs: .0625rem;--radius-sm: .125rem;--radius-md: .1875rem;--radius-lg: .25rem;--radius-xl: .375rem;--radius-2xl: .5rem;--radius-3xl: .75rem;--radius-full: 9999px;--radius-button: var(--radius-sm);--radius-input: var(--radius-xs);--radius-card: var(--radius-none);--radius-panel: var(--radius-none);--radius-modal: var(--radius-sm);--radius-tooltip: var(--radius-none);--breakpoint-sm: 640px;--breakpoint-md: 768px;--breakpoint-lg: 1024px;--breakpoint-xl: 1280px;--breakpoint-2xl: 1536px;--container-sm: 640px;--container-md: 768px;--container-lg: 1024px;--container-xl: 1280px;--container-2xl: 1536px;--container-full: 100%}[data-dir=rtl]{--layout-direction: rtl;--content-align-start: right;--content-align-end: left}:root{--font-sans: Helvetica, Arial, sans-serif;--font-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;--font-serif: Georgia, "Times New Roman", Times, serif;--text-xs: .6875rem;--text-sm: .8125rem;--text-base: .875rem;--text-lg: 1rem;--text-xl: 1.125rem;--text-2xl: 1.25rem;--text-3xl: 1.5rem;--text-4xl: 1.875rem;--text-5xl: 2.25rem;--text-6xl: 3rem;--text-7xl: 3.75rem;--text-8xl: 4.5rem;--text-9xl: 6rem;--font-thin: 100;--font-extralight: 200;--font-light: 300;--font-normal: 400;--font-medium: 500;--font-semibold: 600;--font-bold: 700;--font-extrabold: 800;--font-black: 900;--leading-none: 1;--leading-tight: 1.2;--leading-snug: 1.3;--leading-normal: 1.4;--leading-relaxed: 1.5;--leading-loose: 1.6;--leading-xs: 1rem;--leading-sm: 1.25rem;--leading-base: 1.5rem;--leading-lg: 1.75rem;--leading-xl: 1.75rem;--leading-2xl: 2rem;--leading-3xl: 2.25rem;--leading-4xl: 2.5rem;--leading-5xl: 1;--leading-6xl: 1;--leading-7xl: 1;--leading-8xl: 1;--leading-9xl: 1;--tracking-tighter: -.05em;--tracking-tight: -.025em;--tracking-normal: 0em;--tracking-wide: .025em;--tracking-wider: .05em;--tracking-widest: .1em;--text-display-2xl: var(--text-5xl);--text-display-xl: var(--text-4xl);--text-display-lg: var(--text-3xl);--text-display-md: var(--text-2xl);--text-display-sm: var(--text-xl);--text-heading-2xl: var(--text-4xl);--text-heading-xl: var(--text-3xl);--text-heading-lg: var(--text-2xl);--text-heading-md: var(--text-xl);--text-heading-sm: var(--text-lg);--text-heading-xs: var(--text-base);--text-body-xl: var(--text-xl);--text-body-lg: var(--text-lg);--text-body-md: var(--text-base);--text-body-sm: var(--text-sm);--text-body-xs: var(--text-xs);--text-label-lg: var(--text-sm);--text-label-md: var(--text-xs);--text-label-sm: var(--text-xs);--button-text-lg: var(--text-base);--button-text-md: var(--text-sm);--button-text-sm: var(--text-xs);--button-font-weight: var(--font-normal);--button-letter-spacing: var(--tracking-normal);--input-text-size: var(--text-base);--input-font-weight: var(--font-normal);--input-letter-spacing: var(--tracking-normal);--input-placeholder-weight: var(--font-normal);--nav-text-size: var(--text-base);--nav-font-weight: var(--font-normal);--nav-letter-spacing: var(--tracking-normal);--sidebar-text-size: var(--text-sm);--sidebar-font-weight: var(--font-normal);--sidebar-heading-weight: var(--font-semibold);--sidebar-letter-spacing: var(--tracking-normal);--code-text-size: var(--text-sm);--code-font-family: var(--font-mono);--code-font-weight: var(--font-normal);--code-letter-spacing: var(--tracking-normal);--code-line-height: var(--leading-relaxed);--caption-text-size: var(--text-xs);--caption-font-weight: var(--font-normal);--caption-letter-spacing: var(--tracking-normal);--caption-line-height: var(--leading-normal);--text-decoration-none: none;--text-decoration-underline: underline;--text-decoration-line-through: line-through;--link-text-decoration: underline;--link-text-decoration-hover: underline;--link-underline-offset: .1em;--text-transform-none: none;--text-transform-uppercase: uppercase;--text-transform-lowercase: lowercase;--text-transform-capitalize: capitalize;--editor-font-family: var(--font-serif);--editor-text-size: var(--text-base);--editor-line-height: var(--leading-relaxed);--editor-letter-spacing: var(--tracking-normal);--editor-font-weight: var(--font-normal);--preview-font-family: var(--font-serif);--preview-text-size: var(--text-base);--preview-line-height: var(--leading-relaxed);--preview-letter-spacing: var(--tracking-normal);--metadata-font-family: var(--font-sans);--metadata-text-size: var(--text-sm);--metadata-line-height: var(--leading-normal);--metadata-label-weight: var(--font-medium)}:root{--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-none: none;--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);--z-base: 0;--z-raised: 10;--z-overlay: 20;--z-sticky: 30;--z-fixed: 40;--z-dropdown: 1000;--z-tooltip: 1100;--z-modal-backdrop: 1200;--z-modal: 1300;--z-popover: 1400;--z-toast: 1500;--z-loading: 1600;--z-maximum: 9999;--elevation-card-flat: var(--shadow-none);--elevation-card-raised: var(--shadow-sm);--elevation-card-floating: var(--shadow-md);--elevation-card-elevated: var(--shadow-lg);--elevation-panel-flat: var(--shadow-none);--elevation-panel-inset: var(--shadow-inner);--elevation-panel-raised: var(--shadow-sm);--elevation-panel-floating: var(--shadow-lg);--elevation-button-flat: var(--shadow-none);--elevation-button-raised: var(--shadow-sm);--elevation-button-hover: var(--shadow-md);--elevation-button-active: var(--shadow-xs);--elevation-input-flat: var(--shadow-none);--elevation-input-inset: var(--shadow-inner);--elevation-input-focus: var(--shadow-focus-primary);--elevation-nav-flat: var(--shadow-none);--elevation-nav-floating: var(--shadow-md);--elevation-nav-sticky: var(--shadow-sm);--elevation-modal-backdrop: var(--shadow-none);--elevation-modal: var(--shadow-2xl);--elevation-tooltip: var(--shadow-lg);--elevation-dropdown: var(--shadow-lg);--elevation-sidebar: var(--shadow-sm);--elevation-sidebar-floating: var(--shadow-md);--elevation-header: var(--shadow-sm);--elevation-header-floating: var(--shadow-md);--elevation-content-primary: var(--shadow-none);--elevation-content-secondary: var(--shadow-sm);--elevation-resize-handle: var(--shadow-none);--elevation-resize-handle-hover: var(--shadow-sm);--border-width-0: 0;--border-width-1: 1px;--border-width-2: 2px;--border-width-4: 4px;--border-width-8: 8px;--border-style-solid: solid;--border-style-dashed: dashed;--border-style-dotted: dotted;--border-style-none: none;--border-default: var(--border-width-1) var(--border-style-solid) var(--color-border-default);--border-strong: var(--border-width-1) var(--border-style-solid) var(--color-border-strong);--border-accent: var(--border-width-1) var(--border-style-solid) var(--color-border-accent);--border-focus: var(--border-width-2) var(--border-style-solid) var(--color-border-focus);--opacity-0: 0;--opacity-5: .05;--opacity-10: .1;--opacity-20: .2;--opacity-25: .25;--opacity-30: .3;--opacity-40: .4;--opacity-50: .5;--opacity-60: .6;--opacity-70: .7;--opacity-75: .75;--opacity-80: .8;--opacity-90: .9;--opacity-95: .95;--opacity-100: 1;--opacity-disabled: var(--opacity-50);--opacity-hover: var(--opacity-80);--opacity-loading: var(--opacity-60);--opacity-overlay: var(--opacity-50);--opacity-backdrop: var(--opacity-75)}:root{--duration-instant: 0ms;--duration-fast: .15s;--duration-normal: .25s;--duration-slow: .35s;--duration-slower: .5s;--duration-slowest: .75s;--duration-tooltip: var(--duration-fast);--duration-button-hover: var(--duration-fast);--duration-input-focus: var(--duration-fast);--duration-dropdown: var(--duration-normal);--duration-modal: var(--duration-normal);--duration-sidebar-toggle: var(--duration-normal);--duration-theme-switch: var(--duration-normal);--duration-page-transition: var(--duration-slow);--duration-loading: var(--duration-slower);--ease-linear: linear;--ease-in: cubic-bezier(.4, 0, 1, 1);--ease-out: cubic-bezier(0, 0, .2, 1);--ease-in-out: cubic-bezier(.4, 0, .2, 1);--ease-elastic: cubic-bezier(.68, -.55, .265, 1.55);--ease-bounce: cubic-bezier(.175, .885, .32, 1.275);--ease-smooth: cubic-bezier(.25, .1, .25, 1);--ease-sharp: cubic-bezier(.4, 0, .6, 1);--ease-ui-out: var(--ease-out);--ease-ui-in: var(--ease-in);--ease-ui-in-out: var(--ease-in-out);--ease-ui-smooth: var(--ease-smooth);--transition-colors: color var(--duration-fast) var(--ease-ui-out), background-color var(--duration-fast) var(--ease-ui-out), border-color var(--duration-fast) var(--ease-ui-out);--transition-opacity: opacity var(--duration-fast) var(--ease-ui-out);--transition-transform: transform var(--duration-fast) var(--ease-ui-out);--transition-shadow: box-shadow var(--duration-fast) var(--ease-ui-out);--transition-size: width var(--duration-normal) var(--ease-ui-out), height var(--duration-normal) var(--ease-ui-out);--transition-button: var(--transition-colors), var(--transition-shadow), transform var(--duration-button-hover) var(--ease-ui-out);--transition-input: var(--transition-colors), border-color var(--duration-input-focus) var(--ease-ui-out), box-shadow var(--duration-input-focus) var(--ease-ui-out);--transition-panel: var(--transition-colors), var(--transition-shadow);--transition-modal: opacity var(--duration-modal) var(--ease-ui-out), transform var(--duration-modal) var(--ease-ui-out);--transition-dropdown: opacity var(--duration-dropdown) var(--ease-ui-out), transform var(--duration-dropdown) var(--ease-ui-out);--transition-sidebar: width var(--duration-sidebar-toggle) var(--ease-ui-out);--transition-resize: all var(--duration-fast) var(--ease-ui-out);--transition-theme: background-color var(--duration-theme-switch) var(--ease-ui-out), color var(--duration-theme-switch) var(--ease-ui-out), border-color var(--duration-theme-switch) var(--ease-ui-out), box-shadow var(--duration-theme-switch) var(--ease-ui-out);--animation-spin: spin 1s linear infinite;--animation-ping: ping 1s cubic-bezier(0, 0, .2, 1) infinite;--animation-pulse: pulse 2s cubic-bezier(.4, 0, .6, 1) infinite;--animation-bounce: bounce 1s infinite;--animation-fade-in: fadeIn var(--duration-normal) var(--ease-ui-out);--animation-slide-in-up: slideInUp var(--duration-normal) var(--ease-ui-out);--animation-slide-in-down: slideInDown var(--duration-normal) var(--ease-ui-out);--animation-slide-in-left: slideInLeft var(--duration-normal) var(--ease-ui-out);--animation-slide-in-right: slideInRight var(--duration-normal) var(--ease-ui-out);--animation-scale-in: scaleIn var(--duration-normal) var(--ease-ui-out);--animation-fade-out: fadeOut var(--duration-normal) var(--ease-ui-in);--animation-slide-out-up: slideOutUp var(--duration-normal) var(--ease-ui-in);--animation-slide-out-down: slideOutDown var(--duration-normal) var(--ease-ui-in);--animation-slide-out-left: slideOutLeft var(--duration-normal) var(--ease-ui-in);--animation-slide-out-right: slideOutRight var(--duration-normal) var(--ease-ui-in);--animation-scale-out: scaleOut var(--duration-normal) var(--ease-ui-in);@media (prefers-reduced-motion: reduce){:root{--duration-fast: 50ms;--duration-normal: .1s;--duration-slow: .15s;--duration-slower: .2s;--duration-slowest: .25s;--ease-ui-out: ease;--ease-ui-in: ease;--ease-ui-in-out: ease;--ease-ui-smooth: ease;--animation-spin: none;--animation-ping: none;--animation-pulse: none;--animation-bounce: none}}--layout-transition-duration: var(--duration-normal);--layout-transition-easing: var(--ease-ui-out);--nav-transition-duration: var(--duration-fast);--nav-transition-easing: var(--ease-ui-out);--content-transition-duration: var(--duration-normal);--content-transition-easing: var(--ease-ui-out);--interactive-hover-duration: var(--duration-fast);--interactive-focus-duration: var(--duration-fast);--interactive-active-duration: var(--duration-instant)}*,*:before,*:after{transition:var(--transition-theme)}.theme-initializing *,.theme-initializing *:before,.theme-initializing *:after{transition:none!important}:root{color-scheme:light}[data-theme=dark]{color-scheme:dark}[data-theme=auto]{color-scheme:light dark}::-webkit-scrollbar-track{background:var(--color-bg-secondary)}::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-full)}::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}*{scrollbar-width:thin;scrollbar-color:var(--color-border-strong) var(--color-bg-secondary)}::selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}::-moz-selection{background-color:var(--color-bg-accent);color:var(--color-text-primary)}*:focus{outline:none}*:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex]:focus-visible{box-shadow:var(--shadow-focus-primary)}@media (prefers-contrast: high){:root{--color-text-primary: var(--color-black);--color-text-secondary: var(--color-neutral-800);--color-bg-primary: var(--color-white);--color-border-default: var(--color-neutral-900);--color-border-focus: var(--color-primary-900)}[data-theme=dark]{--color-text-primary: var(--color-white);--color-text-secondary: var(--color-neutral-200);--color-bg-primary: var(--color-black);--color-border-default: var(--color-white);--color-border-focus: var(--color-primary-300)}}@media print{*{color:#000!important;background:#fff!important;box-shadow:none!important}button,.nav,.sidebar,[role=navigation]{display:none!important}}@media (prefers-reduced-motion: reduce){*,*:before,*:after{transition:none!important;animation:none!important}*:focus-visible{transition:box-shadow .1s ease!important}}.theme-loading{visibility:hidden}.theme-loaded{visibility:visible}.theme-ready{transition:var(--transition-theme)}a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible,[role=button]:focus-visible,[tabindex="0"]:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}[data-theme=light]{--color-bg-primary: var(--color-white);--color-bg-secondary: var(--color-neutral-100);--color-bg-tertiary: var(--color-neutral-200);--color-bg-quaternary: var(--color-neutral-300);--color-bg-inverse: var(--color-neutral-900);--color-bg-accent: var(--color-primary-50);--color-bg-success: var(--color-success-50);--color-bg-warning: var(--color-warning-50);--color-bg-error: var(--color-error-50);--color-text-primary: var(--color-neutral-900);--color-text-secondary: var(--color-neutral-600);--color-text-tertiary: var(--color-neutral-500);--color-text-quaternary: var(--color-neutral-400);--color-text-inverse: var(--color-white);--color-text-accent: var(--color-primary-600);--color-text-success: var(--color-success-700);--color-text-warning: var(--color-warning-700);--color-text-error: var(--color-error-700);--color-text-link: var(--color-primary-600);--color-text-link-hover: var(--color-primary-700);--color-border-default: var(--color-neutral-200);--color-border-strong: var(--color-neutral-300);--color-border-subtle: var(--color-neutral-100);--color-border-inverse: var(--color-neutral-700);--color-border-accent: var(--color-primary-300);--color-border-success: var(--color-success-300);--color-border-warning: var(--color-warning-300);--color-border-error: var(--color-error-300);--color-border-focus: var(--color-primary-500);--color-border-hover: var(--color-neutral-300);--color-interactive-primary: var(--color-primary-600);--color-interactive-primary-hover: var(--color-primary-700);--color-interactive-primary-active: var(--color-primary-800);--color-interactive-secondary: var(--color-neutral-100);--color-interactive-secondary-hover: var(--color-neutral-200);--color-interactive-secondary-active: var(--color-neutral-300);--color-interactive-disabled: var(--color-neutral-300);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-white);--color-surface-secondary: var(--color-neutral-50);--color-surface-tertiary: var(--color-neutral-100);--color-surface-overlay: rgba(0, 0, 0, .5);--color-surface-elevated: var(--color-white);--color-sidebar-bg: var(--color-bg-secondary);--color-sidebar-border: var(--color-border-default);--color-sidebar-item-hover: var(--color-bg-tertiary);--color-sidebar-item-active: var(--color-bg-accent);--color-sidebar-text: var(--color-text-primary);--color-sidebar-text-secondary: var(--color-text-secondary);--color-button-primary-bg: var(--color-interactive-primary);--color-button-primary-bg-hover: var(--color-interactive-primary-hover);--color-button-primary-text: var(--color-text-inverse);--color-button-secondary-bg: var(--color-interactive-secondary);--color-button-secondary-bg-hover: var(--color-interactive-secondary-hover);--color-button-secondary-text: var(--color-text-primary);--color-button-secondary-border: var(--color-border-default);--color-input-bg: var(--color-bg-primary);--color-input-border: var(--color-border-default);--color-input-border-focus: var(--color-border-focus);--color-input-text: var(--color-text-primary);--color-input-placeholder: var(--color-text-tertiary);--color-status-success: var(--color-success-600);--color-status-warning: var(--color-warning-600);--color-status-error: var(--color-error-600);--color-status-info: var(--color-primary-600);--color-focus: var(--color-primary-600);--color-focus-ring: var(--color-primary-500);--color-error-text: #dc2626;--color-error-bg: #fef2f2;--color-success-text: #166534;--color-success-bg: #f0fdf4;--color-warning-text: #92400e;--color-warning-bg: #fffbeb;--color-surface-disabled: var(--color-neutral-100);--color-text-disabled: var(--color-neutral-400);--color-surface-hover: var(--color-neutral-50);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px rgba(0, 0, 0, .07), 0 2px 4px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1), 0 4px 6px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .1), 0 10px 10px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .25);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .06);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .25);--shadow-success: 0 4px 14px rgba(34, 197, 94, .25);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .25);--shadow-error: 0 4px 14px rgba(239, 68, 68, .25);--shadow-focus-primary: 0 0 0 3px rgba(59, 130, 246, .1);--shadow-focus-success: 0 0 0 3px rgba(34, 197, 94, .1);--shadow-focus-warning: 0 0 0 3px rgba(245, 158, 11, .1);--shadow-focus-error: 0 0 0 3px rgba(239, 68, 68, .1);color-scheme:light}@media (prefers-color-scheme: light){:root:not([data-theme]){color-scheme:light}}[data-theme=dark]{--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);--color-border-hover: var(--color-neutral-600);--color-interactive-primary: var(--color-primary-500);--color-interactive-primary-hover: var(--color-primary-400);--color-interactive-primary-active: var(--color-primary-600);--color-interactive-secondary: var(--color-neutral-800);--color-interactive-secondary-hover: var(--color-neutral-700);--color-interactive-secondary-active: var(--color-neutral-600);--color-interactive-disabled: var(--color-neutral-700);--color-interactive-disabled-text: var(--color-neutral-500);--color-surface-primary: var(--color-neutral-900);--color-surface-secondary: var(--color-neutral-800);--color-surface-tertiary: var(--color-neutral-700);--color-surface-overlay: rgba(0, 0, 0, .8);--color-surface-elevated: var(--color-neutral-800);--color-sidebar-bg: var(--color-neutral-900);--color-sidebar-border: var(--color-neutral-700);--color-sidebar-item-hover: var(--color-neutral-800);--color-sidebar-item-active: var(--color-neutral-700);--color-sidebar-text: var(--color-neutral-100);--color-sidebar-text-secondary: var(--color-neutral-400);--color-button-primary-bg: var(--color-primary-600);--color-button-primary-bg-hover: var(--color-primary-500);--color-button-primary-text: var(--color-white);--color-button-secondary-bg: var(--color-neutral-800);--color-button-secondary-bg-hover: var(--color-neutral-700);--color-button-secondary-text: var(--color-neutral-100);--color-button-secondary-border: var(--color-neutral-600);--color-input-bg: var(--color-neutral-800);--color-input-border: var(--color-neutral-600);--color-input-border-focus: var(--color-primary-400);--color-input-text: var(--color-neutral-100);--color-input-placeholder: var(--color-neutral-400);--color-status-success: var(--color-success-400);--color-status-warning: var(--color-warning-400);--color-status-error: var(--color-error-400);--color-status-info: var(--color-primary-400);--color-focus: var(--color-primary-400);--color-focus-ring: var(--color-primary-300);--color-error-text: #fca5a5;--color-error-bg: var(--color-error-950);--color-success-text: #86efac;--color-success-bg: var(--color-success-950);--color-warning-text: #fcd34d;--color-warning-bg: var(--color-warning-950);--color-surface-disabled: var(--color-neutral-800);--color-text-disabled: var(--color-neutral-500);--color-surface-hover: var(--color-neutral-700);--shadow-xs: 0 1px 2px rgba(0, 0, 0, .3);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .4), 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .4), 0 2px 4px rgba(0, 0, 0, .3);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4), 0 4px 6px rgba(0, 0, 0, .2);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .4), 0 10px 10px rgba(0, 0, 0, .2);--shadow-2xl: 0 25px 50px rgba(0, 0, 0, .6);--shadow-inner: inset 0 2px 4px rgba(0, 0, 0, .4);--shadow-primary: 0 4px 14px rgba(59, 130, 246, .4);--shadow-success: 0 4px 14px rgba(34, 197, 94, .4);--shadow-warning: 0 4px 14px rgba(245, 158, 11, .4);--shadow-error: 0 4px 14px rgba(239, 68, 68, .4);--shadow-focus-primary: 0 0 0 3px rgba(96, 165, 250, .3);--shadow-focus-success: 0 0 0 3px rgba(74, 222, 128, .3);--shadow-focus-warning: 0 0 0 3px rgba(251, 191, 36, .3);--shadow-focus-error: 0 0 0 3px rgba(248, 113, 113, .3)}@media (prefers-color-scheme: dark){:root:not([data-theme]){--color-bg-primary: var(--color-neutral-900);--color-bg-secondary: var(--color-neutral-800);--color-bg-tertiary: var(--color-neutral-700);--color-bg-quaternary: var(--color-neutral-600);--color-bg-inverse: var(--color-neutral-50);--color-bg-accent: var(--color-primary-950);--color-bg-success: var(--color-success-950);--color-bg-warning: var(--color-warning-950);--color-bg-error: var(--color-error-950);--color-text-primary: var(--color-neutral-50);--color-text-secondary: var(--color-neutral-300);--color-text-tertiary: var(--color-neutral-400);--color-text-quaternary: var(--color-neutral-500);--color-text-inverse: var(--color-neutral-900);--color-text-accent: var(--color-primary-400);--color-text-success: var(--color-success-400);--color-text-warning: var(--color-warning-400);--color-text-error: var(--color-error-400);--color-text-link: var(--color-primary-400);--color-text-link-hover: var(--color-primary-300);--color-border-default: var(--color-neutral-700);--color-border-strong: var(--color-neutral-600);--color-border-subtle: var(--color-neutral-800);--color-border-inverse: var(--color-neutral-300);--color-border-accent: var(--color-primary-600);--color-border-success: var(--color-success-600);--color-border-warning: var(--color-warning-600);--color-border-error: var(--color-error-600);--color-border-focus: var(--color-primary-400);color-scheme:dark}}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.inline-grid{display:inline-grid}.table{display:table}.table-cell{display:table-cell}.table-row{display:table-row}.hidden{display:none}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.inset-auto{inset:auto}.inset-inline-0{inset-inline:0}.inset-inline-auto{inset-inline:auto}.inset-block-0{inset-block:0}.inset-block-auto{inset-block:auto}.start-0{inset-inline-start:0}.start-auto{inset-inline-start:auto}.end-0{inset-inline-end:0}.end-auto{inset-inline-end:auto}.top-0{inset-block-start:0}.top-auto{inset-block-start:auto}.bottom-0{inset-block-end:0}.bottom-auto{inset-block-end:auto}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.flex-wrap-reverse{flex-wrap:wrap-reverse}.flex-nowrap{flex-wrap:nowrap}.flex-1{flex:1 1 0%}.flex-auto{flex:1 1 auto}.flex-initial{flex:0 1 auto}.flex-none{flex:none}.flex-grow{flex-grow:1}.flex-grow-0{flex-grow:0}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.justify-evenly{justify-content:space-evenly}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-evenly{align-content:space-evenly}.self-auto{align-self:auto}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-stretch{align-self:stretch}.self-baseline{align-self:baseline}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.grid-cols-none{grid-template-columns:none}.grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}.grid-rows-3{grid-template-rows:repeat(3,minmax(0,1fr))}.grid-rows-4{grid-template-rows:repeat(4,minmax(0,1fr))}.grid-rows-5{grid-template-rows:repeat(5,minmax(0,1fr))}.grid-rows-6{grid-template-rows:repeat(6,minmax(0,1fr))}.grid-rows-none{grid-template-rows:none}.col-auto{grid-column:auto}.col-span-1{grid-column:span 1 / span 1}.col-span-2{grid-column:span 2 / span 2}.col-span-3{grid-column:span 3 / span 3}.col-span-4{grid-column:span 4 / span 4}.col-span-5{grid-column:span 5 / span 5}.col-span-6{grid-column:span 6 / span 6}.col-span-full{grid-column:1 / -1}.row-auto{grid-row:auto}.row-span-1{grid-row:span 1 / span 1}.row-span-2{grid-row:span 2 / span 2}.row-span-3{grid-row:span 3 / span 3}.row-span-4{grid-row:span 4 / span 4}.row-span-5{grid-row:span 5 / span 5}.row-span-6{grid-row:span 6 / span 6}.row-span-full{grid-row:1 / -1}.gap-0{gap:0}.gap-1{gap:var(--space-1)}.gap-2{gap:var(--space-2)}.gap-3{gap:var(--space-3)}.gap-4{gap:var(--space-4)}.gap-5{gap:var(--space-5)}.gap-6{gap:var(--space-6)}.gap-8{gap:var(--space-8)}.gap-10{gap:var(--space-10)}.gap-12{gap:var(--space-12)}.gap-x-0{column-gap:0}.gap-x-1{column-gap:var(--space-1)}.gap-x-2{column-gap:var(--space-2)}.gap-x-3{column-gap:var(--space-3)}.gap-x-4{column-gap:var(--space-4)}.gap-x-5{column-gap:var(--space-5)}.gap-x-6{column-gap:var(--space-6)}.gap-x-8{column-gap:var(--space-8)}.gap-y-0{row-gap:0}.gap-y-1{row-gap:var(--space-1)}.gap-y-2{row-gap:var(--space-2)}.gap-y-3{row-gap:var(--space-3)}.gap-y-4{row-gap:var(--space-4)}.gap-y-5{row-gap:var(--space-5)}.gap-y-6{row-gap:var(--space-6)}.gap-y-8{row-gap:var(--space-8)}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-clip{overflow:clip}.overflow-visible{overflow:visible}.overflow-scroll{overflow:scroll}.overflow-x-auto{overflow-x:auto}.overflow-x-hidden{overflow-x:hidden}.overflow-x-clip{overflow-x:clip}.overflow-x-visible{overflow-x:visible}.overflow-x-scroll{overflow-x:scroll}.overflow-y-auto{overflow-y:auto}.overflow-y-hidden{overflow-y:hidden}.overflow-y-clip{overflow-y:clip}.overflow-y-visible{overflow-y:visible}.overflow-y-scroll{overflow-y:scroll}.container{width:100%;margin-left:auto;margin-right:auto}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.box-border{box-sizing:border-box}.box-content{box-sizing:content-box}.float-start{float:inline-start}.float-end{float:inline-end}.float-none{float:none}.clear-start{clear:inline-start}.clear-end{clear:inline-end}.clear-both{clear:both}.clear-none{clear:none}.isolate{isolation:isolate}.isolation-auto{isolation:auto}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.object-fill{object-fit:fill}.object-none{object-fit:none}.object-scale-down{object-fit:scale-down}.object-bottom{object-position:bottom}.object-center{object-position:center}.object-start{object-position:left}.object-start-bottom{object-position:left bottom}.object-start-top{object-position:left top}.object-end{object-position:right}.object-end-bottom{object-position:right bottom}.object-end-top{object-position:right top}.object-top{object-position:top}[data-dir=rtl] .object-start{object-position:right}[data-dir=rtl] .object-start-bottom{object-position:right bottom}[data-dir=rtl] .object-start-top{object-position:right top}[data-dir=rtl] .object-end{object-position:left}[data-dir=rtl] .object-end-bottom{object-position:left bottom}[data-dir=rtl] .object-end-top{object-position:left top}.text-start{text-align:start}.text-end{text-align:end}.text-center{text-align:center}.text-justify{text-align:justify}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:var(--sr-only-clip);white-space:nowrap;border:0}.sr-only-focusable:focus,.sr-only-focusable:active{position:static;width:auto;height:auto;padding:inherit;margin:inherit;overflow:visible;clip:auto;white-space:inherit}.focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.touch-target{min-width:var(--touch-target-min);min-height:var(--touch-target-min)}.m-0{margin:0}.m-1{margin:var(--space-1)}.m-2{margin:var(--space-2)}.m-3{margin:var(--space-3)}.m-4{margin:var(--space-4)}.m-5{margin:var(--space-5)}.m-6{margin:var(--space-6)}.m-8{margin:var(--space-8)}.m-auto{margin:auto}.mx-0{margin-inline:0}.mx-1{margin-inline:var(--space-1)}.mx-2{margin-inline:var(--space-2)}.mx-3{margin-inline:var(--space-3)}.mx-4{margin-inline:var(--space-4)}.mx-5{margin-inline:var(--space-5)}.mx-6{margin-inline:var(--space-6)}.mx-8{margin-inline:var(--space-8)}.mx-auto{margin-inline:auto}.my-0{margin-block:0}.my-1{margin-block:var(--space-1)}.my-2{margin-block:var(--space-2)}.my-3{margin-block:var(--space-3)}.my-4{margin-block:var(--space-4)}.my-5{margin-block:var(--space-5)}.my-6{margin-block:var(--space-6)}.my-8{margin-block:var(--space-8)}.my-auto{margin-block:auto}.ms-0{margin-inline-start:0}.ms-1{margin-inline-start:var(--space-1)}.ms-2{margin-inline-start:var(--space-2)}.ms-3{margin-inline-start:var(--space-3)}.ms-4{margin-inline-start:var(--space-4)}.ms-5{margin-inline-start:var(--space-5)}.ms-6{margin-inline-start:var(--space-6)}.ms-8{margin-inline-start:var(--space-8)}.ms-auto{margin-inline-start:auto}.me-0{margin-inline-end:0}.me-1{margin-inline-end:var(--space-1)}.me-2{margin-inline-end:var(--space-2)}.me-3{margin-inline-end:var(--space-3)}.me-4{margin-inline-end:var(--space-4)}.me-5{margin-inline-end:var(--space-5)}.me-6{margin-inline-end:var(--space-6)}.me-8{margin-inline-end:var(--space-8)}.me-auto{margin-inline-end:auto}.mt-0{margin-block-start:0}.mt-1{margin-block-start:var(--space-1)}.mt-2{margin-block-start:var(--space-2)}.mt-3{margin-block-start:var(--space-3)}.mt-4{margin-block-start:var(--space-4)}.mt-5{margin-block-start:var(--space-5)}.mt-6{margin-block-start:var(--space-6)}.mt-8{margin-block-start:var(--space-8)}.mt-auto{margin-block-start:auto}.mb-0{margin-block-end:0}.mb-1{margin-block-end:var(--space-1)}.mb-2{margin-block-end:var(--space-2)}.mb-3{margin-block-end:var(--space-3)}.mb-4{margin-block-end:var(--space-4)}.mb-5{margin-block-end:var(--space-5)}.mb-6{margin-block-end:var(--space-6)}.mb-8{margin-block-end:var(--space-8)}.mb-auto{margin-block-end:auto}.p-0{padding:0}.p-1{padding:var(--space-1)}.p-2{padding:var(--space-2)}.p-3{padding:var(--space-3)}.p-4{padding:var(--space-4)}.p-5{padding:var(--space-5)}.p-6{padding:var(--space-6)}.p-8{padding:var(--space-8)}.px-0{padding-inline:0}.px-1{padding-inline:var(--space-1)}.px-2{padding-inline:var(--space-2)}.px-3{padding-inline:var(--space-3)}.px-4{padding-inline:var(--space-4)}.px-5{padding-inline:var(--space-5)}.px-6{padding-inline:var(--space-6)}.px-8{padding-inline:var(--space-8)}.py-0{padding-block:0}.py-1{padding-block:var(--space-1)}.py-2{padding-block:var(--space-2)}.py-3{padding-block:var(--space-3)}.py-4{padding-block:var(--space-4)}.py-5{padding-block:var(--space-5)}.py-6{padding-block:var(--space-6)}.py-8{padding-block:var(--space-8)}.ps-0{padding-inline-start:0}.ps-1{padding-inline-start:var(--space-1)}.ps-2{padding-inline-start:var(--space-2)}.ps-3{padding-inline-start:var(--space-3)}.ps-4{padding-inline-start:var(--space-4)}.ps-5{padding-inline-start:var(--space-5)}.ps-6{padding-inline-start:var(--space-6)}.ps-8{padding-inline-start:var(--space-8)}.pe-0{padding-inline-end:0}.pe-1{padding-inline-end:var(--space-1)}.pe-2{padding-inline-end:var(--space-2)}.pe-3{padding-inline-end:var(--space-3)}.pe-4{padding-inline-end:var(--space-4)}.pe-5{padding-inline-end:var(--space-5)}.pe-6{padding-inline-end:var(--space-6)}.pe-8{padding-inline-end:var(--space-8)}.pt-0{padding-block-start:0}.pt-1{padding-block-start:var(--space-1)}.pt-2{padding-block-start:var(--space-2)}.pt-3{padding-block-start:var(--space-3)}.pt-4{padding-block-start:var(--space-4)}.pt-5{padding-block-start:var(--space-5)}.pt-6{padding-block-start:var(--space-6)}.pt-8{padding-block-start:var(--space-8)}.pb-0{padding-block-end:0}.pb-1{padding-block-end:var(--space-1)}.pb-2{padding-block-end:var(--space-2)}.pb-3{padding-block-end:var(--space-3)}.pb-4{padding-block-end:var(--space-4)}.pb-5{padding-block-end:var(--space-5)}.pb-6{padding-block-end:var(--space-6)}.pb-8{padding-block-end:var(--space-8)}.input{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);transition:border-color .15s ease-in-out}.input:focus{outline:none;border-color:var(--color-input-border-focus)}.input::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.input-sm{padding:var(--space-0-5) var(--space-1);font-size:var(--text-xs)}.input-lg{padding:var(--space-2) var(--space-3);font-size:var(--text-lg)}.textarea{display:block;width:100%;min-height:120px;padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);border:1px solid var(--color-input-border);border-radius:var(--radius-input);resize:vertical;transition:border-color .15s ease-in-out}.textarea:focus{outline:none;border-color:var(--color-input-border-focus)}.textarea::placeholder{color:var(--color-input-placeholder);font-weight:var(--input-placeholder-weight)}.select{display:block;width:100%;padding:var(--button-padding-block) var(--button-padding-inline);padding-inline-end:var(--space-6);font-family:var(--font-sans);font-size:var(--input-text-size);font-weight:var(--input-font-weight);line-height:var(--leading-normal);color:var(--color-input-text);background-color:var(--color-input-bg);background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right var(--space-2) center;background-size:1em;border:1px solid var(--color-input-border);border-radius:var(--radius-input);appearance:none;cursor:pointer;transition:border-color .15s ease-in-out}.select:focus{outline:none;border-color:var(--color-input-border-focus)}[data-dir=rtl] .select{background-position:left var(--space-2) center}.checkbox,.radio{display:inline-block;width:1rem;height:1rem;margin:0;margin-inline-end:var(--space-1);vertical-align:middle;background-color:var(--color-input-bg);border:1px solid var(--color-input-border);appearance:none;cursor:pointer;transition:all .15s ease-in-out}.checkbox{border-radius:var(--radius-xs)}.radio{border-radius:var(--radius-full)}.checkbox:checked,.radio:checked{background-color:var(--color-primary-600);border-color:var(--color-primary-600)}.checkbox:checked:after{content:"";display:block;width:100%;height:100%;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='20 6 9 17 4 12'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:center;background-size:.75rem}.radio:checked:after{content:"";display:block;width:100%;height:100%;background:#fff;border-radius:var(--radius-full);transform:scale(.4)}.checkbox:focus,.radio:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.label{display:inline-block;margin-block-end:var(--space-1);font-size:var(--text-label-md);font-weight:var(--font-medium);color:var(--color-text-primary)}.label-required:after{content:" *";color:var(--color-error-600)}.form-group{margin-block-end:var(--form-field-spacing)}.form-section{margin-block-end:var(--form-section-spacing);padding-block-end:var(--form-section-spacing);border-block-end:1px solid var(--color-border-default)}.form-section:last-child{margin-block-end:0;padding-block-end:0;border-block-end:none}.field-help{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-text-secondary)}.field-error{margin-block-start:var(--space-1);font-size:var(--text-xs);color:var(--color-error-text)}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--button-gap);padding:var(--button-padding-block) var(--button-padding-inline);font-family:var(--font-sans);font-size:var(--button-text-md);font-weight:var(--button-font-weight);line-height:var(--leading-tight);text-align:center;text-decoration:none;color:var(--color-button-primary-text);background-color:var(--color-button-primary-bg);border:1px solid var(--color-button-primary-border);border-radius:var(--radius-button);cursor:pointer;transition:all .15s ease-in-out;user-select:none}.btn:hover{background-color:var(--color-button-primary-bg-hover)}.btn:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{color:var(--color-text-primary);background-color:var(--color-neutral-100);border-color:var(--color-neutral-400)}.btn-primary:hover{background-color:var(--color-neutral-200)}.btn-secondary{color:var(--color-button-secondary-text);background-color:var(--color-button-secondary-bg);border-color:var(--color-button-secondary-border)}.btn-secondary:hover{background-color:var(--color-button-secondary-bg-hover)}.btn-link{padding:0;color:var(--color-text-link);background-color:transparent;border:none;text-decoration:var(--link-text-decoration)}.btn-link:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover);background-color:transparent}.btn-sm{padding:var(--space-0-5) var(--space-1-5);font-size:var(--button-text-sm)}.btn-lg{padding:var(--space-2) var(--space-4);font-size:var(--button-text-lg)}fieldset{margin:0;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md)}legend{padding-inline:var(--space-1);font-size:var(--text-sm);font-weight:var(--font-medium);color:var(--color-text-primary)}.form-inline{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2)}.form-inline .form-group{margin-block-end:0;flex:1 1 auto}.form-inline .input,.form-inline .select{width:auto}.input-craigslist:focus,.textarea-craigslist:focus,.select-craigslist:focus{border-color:var(--color-success-600)}.btn-minimal{padding:var(--space-1) var(--space-2);color:var(--color-text-primary);background-color:var(--color-neutral-100);border:1px solid var(--color-neutral-400);border-radius:var(--radius-sm)}.btn-minimal:hover{background-color:var(--color-neutral-200)}.btn-text{padding:0;color:var(--color-text-link);background:none;border:none;text-decoration:underline;cursor:pointer}.btn-text:hover{color:var(--color-text-link-hover)}*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:none;text-size-adjust:none}:root[data-dir=rtl]{direction:rtl}:root[data-dir=ltr]{direction:ltr}body{min-height:100vh;line-height:var(--leading-normal);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:var(--font-sans);font-size:var(--text-base);color:var(--color-text-primary);background-color:var(--color-bg-secondary)}img,picture,video,canvas,svg{display:block;max-width:100%;height:auto}input,button,textarea,select{font:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}h1,h2,h3,h4,h5,h6{font-weight:var(--font-bold);line-height:var(--leading-tight);color:var(--color-text-primary)}h1{font-size:var(--text-heading-2xl);margin-block-end:var(--space-4)}h2{font-size:var(--text-heading-xl);margin-block-end:var(--space-3)}h3{font-size:var(--text-heading-lg);margin-block-end:var(--space-3)}h4{font-size:var(--text-heading-md);margin-block-end:var(--space-2)}h5{font-size:var(--text-heading-sm);margin-block-end:var(--space-2)}h6{font-size:var(--text-heading-xs);margin-block-end:var(--space-2)}p{margin-block-end:var(--space-3)}p:last-child{margin-block-end:0}a{color:var(--color-text-link);text-decoration:var(--link-text-decoration);text-underline-offset:var(--link-underline-offset);transition:color .15s ease-in-out}a:hover{color:var(--color-text-link-hover);text-decoration:var(--link-text-decoration-hover)}a:visited{color:var(--color-text-link-visited)}a:focus{outline:2px solid var(--color-focus);outline-offset:2px}ul,ol{margin-block-end:var(--space-3);padding-inline-start:var(--space-5)}ul ul,ul ol,ol ul,ol ol{margin-block-end:0}li{margin-block-end:var(--space-1)}li:last-child{margin-block-end:0}table{width:100%;border-collapse:collapse;margin-block-end:var(--space-4)}th,td{padding:var(--space-2);text-align:start;border-block-end:1px solid var(--color-border-default)}th{font-weight:var(--font-semibold);background-color:var(--color-bg-tertiary)}code,kbd,samp,pre{font-family:var(--font-mono);font-size:var(--code-text-size)}code{padding:var(--space-0-5) var(--space-1);background-color:var(--color-bg-tertiary);border-radius:var(--radius-xs)}pre{overflow-x:auto;padding:var(--space-3);margin-block-end:var(--space-4);background-color:var(--color-bg-tertiary);border-radius:var(--radius-sm)}pre code{padding:0;background-color:transparent}blockquote{padding-inline-start:var(--space-4);margin-block-end:var(--space-4);border-inline-start:3px solid var(--color-border-strong);color:var(--color-text-secondary)}hr{height:0;margin-block:var(--space-6);border:0;border-block-start:1px solid var(--color-border-default)}:focus-visible{outline:2px solid var(--color-focus);outline-offset:2px}::selection{background-color:var(--color-primary-200);color:var(--color-text-primary)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--color-bg-tertiary)}::-webkit-scrollbar-thumb{background:var(--color-neutral-400);border-radius:var(--radius-sm)}::-webkit-scrollbar-thumb:hover{background:var(--color-neutral-500)}.skip-link{position:absolute;top:-40px;left:0;padding:var(--space-2) var(--space-4);background:var(--color-bg-primary);color:var(--color-text-link);text-decoration:none;z-index:100}.skip-link:focus{top:0}@media (prefers-reduced-motion: reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}#app{margin:0;padding:0;width:100vw;height:100vh;overflow:hidden;display:flex;flex-direction:column}body:not(.sb-show-main){overflow:hidden}html{height:100%}html,body{margin:0;padding:0}.theme-toggle.svelte-v7l3jb{display:inline-flex;align-items:center;gap:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-3);background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;outline:none;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.theme-toggle.svelte-v7l3jb:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.theme-toggle.svelte-v7l3jb:active{transform:translateY(0);box-shadow:none}.theme-toggle--small.svelte-v7l3jb{padding-block:var(--space-1);padding-inline:var(--space-2);font-size:var(--text-xs);gap:var(--space-1)}.theme-toggle--large.svelte-v7l3jb{padding-block:var(--space-3);padding-inline:var(--space-4);font-size:var(--text-base);gap:var(--space-3)}.theme-toggle__icon.svelte-v7l3jb{display:flex;align-items:center;justify-content:center;inline-size:1.2em;block-size:1.2em;flex-shrink:0}.theme-toggle__icon.svelte-v7l3jb svg:where(.svelte-v7l3jb){inline-size:100%;block-size:100%}.theme-toggle__label.svelte-v7l3jb{white-space:nowrap}.theme-toggle--small.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1em;block-size:1em}.theme-toggle--large.svelte-v7l3jb .theme-toggle__icon:where(.svelte-v7l3jb){inline-size:1.4em;block-size:1.4em}@media (prefers-contrast: high){.theme-toggle.svelte-v7l3jb{border:2px solid var(--color-forced-border)}.theme-toggle.svelte-v7l3jb:focus-visible{outline:3px solid var(--color-forced-active)}}@media (prefers-reduced-motion: reduce){.theme-toggle.svelte-v7l3jb{transition:none}.theme-toggle.svelte-v7l3jb:hover,.theme-toggle.svelte-v7l3jb:active{transform:none}}.sidebar.svelte-1l16yvq{--sidebar-width: 250px;--sidebar-collapsed-width: 48px;inline-size:100%;background:var(--color-sidebar-bg);display:flex;flex-direction:column;overflow-x:visible;overflow-y:hidden;block-size:100vh;position:relative}.sidebar.collapsed.svelte-1l16yvq{inline-size:100%}.sidebar-header.svelte-1l16yvq{display:flex;align-items:center;padding-block:var(--space-1);padding-inline:var(--space-2);border-block-end:1px solid var(--color-border-default);background:var(--color-bg-primary);flex-shrink:0;min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-1l16yvq{background:none;border:none;font-size:var(--text-lg);cursor:pointer;padding-block:var(--space-2);padding-inline:var(--space-2);border-radius:var(--radius-sm);transition:background-color var(--duration-fast) ease;display:flex;align-items:center;justify-content:center;inline-size:32px;block-size:32px;min-inline-size:var(--touch-target-min);min-block-size:var(--touch-target-min)}.sidebar-toggle.svelte-1l16yvq:hover{background:var(--color-interactive-secondary-hover)}.sidebar-toggle.svelte-1l16yvq:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.sidebar-title.svelte-1l16yvq{margin:0;margin-inline-start:var(--space-2);font-size:var(--text-sm);color:var(--color-text-secondary);flex:1}.header-actions.svelte-1l16yvq{display:flex;align-items:center;gap:var(--space-1);margin-inline-start:var(--space-2)}.header-actions.compact.svelte-1l16yvq{margin-inline-start:0;justify-content:center}.sidebar-main.svelte-1l16yvq{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;background:var(--color-bg-secondary)}.sidebar-nav.svelte-1l16yvq{padding-block:0;padding-inline:0;flex-shrink:0}.sidebar-footer.svelte-1l16yvq{flex-shrink:0;background:var(--color-bg-secondary);border-top:1px solid var(--color-border-default)}.sidebar-section.svelte-1l16yvq{inline-size:100%;background:transparent;border:none;display:flex;align-items:center;padding-block:var(--space-2);padding-inline:var(--space-2);cursor:pointer;transition:background-color .1s ease;text-align:start;color:var(--color-text-link);min-block-size:var(--touch-target-min);font-size:var(--text-sm);outline:none;position:relative}.sidebar-section.svelte-1l16yvq:hover{text-decoration:underline}.sidebar-section.svelte-1l16yvq:hover:not(.active){background:var(--color-bg-tertiary)}.sidebar-section.svelte-1l16yvq:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.sidebar .sidebar-section.active{background:var(--color-bg-primary)!important;color:var(--color-text-primary)!important;font-weight:var(--font-normal)!important;border-top:1px solid var(--color-border-default)!important;border-bottom:1px solid var(--color-border-default)!important;border-right:1px solid var(--color-bg-primary)!important;margin-inline-end:-1px!important;position:relative!important;z-index:1!important}.sidebar .sidebar-section.active .section-label{text-decoration:none!important}.spine-section-header.svelte-1l16yvq{display:flex;align-items:center;justify-content:space-between;padding-block:var(--space-2);padding-inline:var(--space-2);min-block-size:var(--touch-target-min);color:var(--color-text-primary);background:transparent}.spine-section-header.svelte-1l16yvq .section-label:where(.svelte-1l16yvq){font-size:var(--text-sm);font-weight:var(--font-normal)}.spine-section-header.compact.svelte-1l16yvq{justify-content:center;flex-direction:column;gap:var(--space-1);padding-block:var(--space-1)}.spine-section-header.compact.svelte-1l16yvq .section-label:where(.svelte-1l16yvq){font-size:var(--text-xs);text-align:center}.append-button-nav.svelte-1l16yvq{display:flex;align-items:center;justify-content:center;inline-size:var(--touch-target-min);block-size:var(--touch-target-min);border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.append-button-nav.svelte-1l16yvq:hover{background:var(--color-bg-tertiary);color:var(--color-text-primary)}.append-button-nav.svelte-1l16yvq:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);z-index:1}.append-button-nav.compact.svelte-1l16yvq{inline-size:var(--touch-target-min);block-size:var(--touch-target-min);font-size:var(--text-xs)}.append-icon.svelte-1l16yvq{font-size:var(--text-sm);font-weight:var(--font-medium)}.spine-items-container.svelte-1l16yvq{flex:1}.section-label.svelte-1l16yvq{font-size:var(--text-base);font-weight:var(--font-normal)}.sidebar.collapsed.svelte-1l16yvq .section-label:where(.svelte-1l16yvq){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.sidebar.collapsed.svelte-1l16yvq .sidebar-section:where(.svelte-1l16yvq){justify-content:center;padding-inline:var(--space-1)}.sidebar-main.svelte-1l16yvq::-webkit-scrollbar{inline-size:6px}.sidebar-main.svelte-1l16yvq::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.sidebar-main.svelte-1l16yvq::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.sidebar-main.svelte-1l16yvq::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.sidebar.svelte-1l16yvq{--sidebar-width: 250px}.sidebar.collapsed.svelte-1l16yvq{--sidebar-width: 48px}@media (prefers-contrast: high){.sidebar.svelte-1l16yvq{border-inline-end:2px solid var(--color-forced-border)}.sidebar-header.svelte-1l16yvq{border-block-end:2px solid var(--color-forced-border)}.sidebar-section.active.svelte-1l16yvq{border-inline-end:4px solid var(--color-forced-active)}}[dir=rtl] .sidebar-toggle.svelte-1l16yvq{transform:scaleX(-1)}.sidebar-section.svelte-1l16yvq:disabled{opacity:.5;cursor:not-allowed;color:var(--color-text-disabled, var(--color-text-tertiary))}.sidebar-section.svelte-1l16yvq:disabled:hover{text-decoration:none;background:transparent}.append-button-nav.svelte-1l16yvq:disabled{opacity:.5;cursor:not-allowed;background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.append-button-nav.svelte-1l16yvq:disabled:hover{background:var(--color-bg-primary);color:var(--color-text-disabled, var(--color-text-tertiary))}.workspace-title-section.svelte-1l16yvq{border-top:1px solid var(--color-border-default);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary);margin-block:var(--space-2)}.workspace-title-header.svelte-1l16yvq{display:flex;align-items:left;gap:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-2);min-block-size:var(--touch-target-min);flex-direction:column}.workspace-title-header.compact.svelte-1l16yvq{justify-content:center;flex-direction:column;gap:var(--space-1);padding-block:var(--space-2)}.workspace-title.svelte-1l16yvq{margin:0;font-size:var(--text-sm);font-weight:var(--font-bold);color:var(--color-text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.workspace-title-compact.svelte-1l16yvq{font-size:var(--text-xs);font-weight:var(--font-medium);color:var(--color-text-primary);text-align:center}.workspace-extensions.svelte-1l16yvq{font-size:var(--text-xs);color:var(--color-text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1;min-width:0}.extensions-indicator.svelte-1l16yvq{font-size:var(--text-xs);color:var(--color-text-secondary);text-align:center;margin-block-start:var(--space-1)}.app-layout.svelte-4h1481{display:grid;height:100vh;width:100vw;margin:0;padding:0}.main-content.svelte-4h1481{min-inline-size:0;overflow:hidden}.pane-content.svelte-4h1481{flex:1;overflow:auto;background:var(--color-bg-primary);height:100%}.single-pane-container.svelte-4h1481{height:100%;overflow:auto;background:var(--color-bg-primary)}[data-pane-resizer]{background:var(--color-border-default);inline-size:4px;cursor:col-resize;transition:background-color var(--duration-fast) ease}[data-pane-resizer]:hover{background:var(--color-border-strong)}[data-pane-resizer][data-resize-handle-active]{background:var(--color-border-accent)}[data-pane-resizer]:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}@media (prefers-contrast: high){.main-content.svelte-4h1481{border-inline-start:2px solid var(--color-forced-border)}}.about-view.svelte-jmnys0{height:100%;overflow:auto;padding:var(--space-4);background:var(--color-bg-primary)}.about-content.svelte-jmnys0{max-width:800px;margin:0 auto}.about-header.svelte-jmnys0{text-align:center;margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--color-border-default)}.app-title.svelte-jmnys0{font-size:var(--text-3xl);font-weight:var(--font-bold);color:var(--color-text-primary);margin:0 0 var(--space-2) 0}.app-version.svelte-jmnys0{font-size:var(--text-sm);color:var(--color-text-tertiary);margin:0}.about-section.svelte-jmnys0{margin-bottom:var(--space-6)}.about-section.svelte-jmnys0 h2:where(.svelte-jmnys0){font-size:var(--text-xl);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0;border-bottom:1px solid var(--color-border-subtle);padding-bottom:var(--space-1)}.about-section.svelte-jmnys0 p:where(.svelte-jmnys0){font-size:var(--text-base);line-height:1.6;color:var(--color-text-secondary);margin:0 0 var(--space-3) 0}.external-link.svelte-jmnys0{color:var(--color-text-link);text-decoration:underline}.external-link.svelte-jmnys0:hover{color:var(--color-text-link-hover)}.license-text.svelte-jmnys0{background:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-sm);line-height:1.5;color:var(--color-text-primary);white-space:pre-wrap;overflow-x:auto;overflow-y:auto}@media (max-width: 640px){.about-view.svelte-jmnys0{padding:var(--space-3)}.app-title.svelte-jmnys0{font-size:var(--text-2xl)}}@media (prefers-contrast: high){.license-text.svelte-jmnys0{border-width:2px}}@media (prefers-reduced-motion: reduce){.about-view.svelte-jmnys0{scroll-behavior:auto}}.thirdparty-view.svelte-3a2w4e{height:100%;overflow:auto;padding:var(--space-4);background:var(--color-bg-primary)}.thirdparty-content.svelte-3a2w4e{max-width:800px;margin:0 auto}.thirdparty-header.svelte-3a2w4e{text-align:center;margin-bottom:var(--space-6);padding-bottom:var(--space-4);border-bottom:1px solid var(--color-border-default)}.thirdparty-header.svelte-3a2w4e h1:where(.svelte-3a2w4e){font-size:var(--text-2xl);font-weight:var(--font-bold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0}.thirdparty-intro.svelte-3a2w4e{font-size:var(--text-base);line-height:1.6;color:var(--color-text-secondary);margin:0}.libraries-section.svelte-3a2w4e{margin-bottom:var(--space-6)}.external-link.svelte-3a2w4e{color:var(--color-text-link);text-decoration:underline}.external-link.svelte-3a2w4e:hover{color:var(--color-text-link-hover)}.license-text.svelte-3a2w4e{background:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-sm);line-height:1.5;color:var(--color-text-primary);white-space:pre-wrap;overflow-x:auto;overflow-y:auto}.library-list.svelte-3a2w4e{display:flex;flex-direction:column;gap:var(--space-4)}.library-item.svelte-3a2w4e{border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:var(--space-3);background:var(--color-bg-secondary)}.library-name.svelte-3a2w4e{font-size:var(--text-base);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-1) 0;display:flex;align-items:center;gap:var(--space-2)}.library-version.svelte-3a2w4e{font-size:var(--text-sm);font-weight:var(--font-normal);color:var(--color-text-tertiary);background:var(--color-bg-tertiary);padding:var(--space-1) var(--space-2);border-radius:var(--radius-xs)}.library-description.svelte-3a2w4e{font-size:var(--text-sm);color:var(--color-text-secondary);margin:var(--space-1) 0}.library-copyright.svelte-3a2w4e{font-size:var(--text-xs);color:var(--color-text-tertiary);margin:var(--space-1) 0 0 0;font-family:var(--font-mono)}.mit-license-section.svelte-3a2w4e{margin-top:var(--space-5);padding-top:var(--space-4);border-top:1px solid var(--color-border-subtle)}.mit-license-section.svelte-3a2w4e h3:where(.svelte-3a2w4e){font-size:var(--text-lg);font-weight:var(--font-semibold);color:var(--color-text-primary);margin:0 0 var(--space-3) 0}@media (max-width: 640px){.thirdparty-view.svelte-3a2w4e{padding:var(--space-3)}.thirdparty-header.svelte-3a2w4e h1:where(.svelte-3a2w4e){font-size:var(--text-xl)}.library-name.svelte-3a2w4e{flex-direction:column;align-items:flex-start;gap:var(--space-1)}}@media (prefers-contrast: high){.license-text.svelte-3a2w4e,.library-item.svelte-3a2w4e{border-width:2px}}@media (prefers-reduced-motion: reduce){.thirdparty-view.svelte-3a2w4e{scroll-behavior:auto}}.workspace-action-bar.svelte-4wg9d{margin-block-end:var(--space-6)}.section-title.svelte-4wg9d{margin:0 0 var(--space-4) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.action-buttons.svelte-4wg9d{display:grid;grid-template-columns:repeat(auto-fit,minmax(15em,1fr));gap:var(--space-4)}.action-button.svelte-4wg9d{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:2px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-family:inherit;cursor:pointer;transition:all var(--duration-normal) ease;text-align:left;min-height:80px;position:relative}.action-button.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);transform:translateY(-2px);box-shadow:var(--shadow-md)}.action-button.svelte-4wg9d:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.action-button.primary.svelte-4wg9d{border-color:var(--color-primary);background-color:var(--color-primary);color:var(--color-surface)}.action-button.primary.svelte-4wg9d:not(:disabled):hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-hover)}.action-button.svelte-4wg9d:disabled{opacity:.6;cursor:not-allowed;transform:none}.action-button.svelte-4wg9d:disabled:hover{border-color:var(--color-border-default);background-color:var(--color-surface-primary);transform:none;box-shadow:none}.action-button.primary.svelte-4wg9d:disabled:hover{border-color:var(--color-primary);background-color:var(--color-primary)}.button-icon.svelte-4wg9d{font-size:2rem;flex-shrink:0}.button-content.svelte-4wg9d{display:flex;flex-direction:column;gap:var(--space-1);flex:1;min-width:0}.button-title.svelte-4wg9d{font-size:var(--text-base);font-weight:600;line-height:1.2}.button-subtitle.svelte-4wg9d{font-size:var(--text-sm);opacity:.8;line-height:1.2}.action-button.primary.svelte-4wg9d .button-subtitle:where(.svelte-4wg9d){opacity:.9}.action-button.svelte-4wg9d:disabled .button-icon:where(.svelte-4wg9d){opacity:.5}@media (max-width: 768px){.action-buttons.svelte-4wg9d{grid-template-columns:1fr;gap:var(--space-3)}.action-button.svelte-4wg9d{min-height:70px;padding:var(--space-3)}.button-icon.svelte-4wg9d{font-size:1.5rem}}@media (max-width: 480px){.action-button.svelte-4wg9d{flex-direction:column;text-align:center;gap:var(--space-2);min-height:90px}.button-content.svelte-4wg9d{align-items:center}}.workspace-item.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);cursor:pointer;transition:all var(--duration-fast) ease;margin-block-end:var(--space-3);min-height:44px}.workspace-item.svelte-ijd5ei:hover{border-color:var(--color-border-hover);background-color:var(--color-surface-hover);box-shadow:var(--shadow-sm)}.workspace-item.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.workspace-item.current.svelte-ijd5ei{border-color:var(--color-primary);background-color:var(--color-primary-surface)}.workspace-item.current.svelte-ijd5ei:hover{border-color:var(--color-primary-hover);background-color:var(--color-primary-surface-hover)}.workspace-item.error.svelte-ijd5ei{border-color:var(--color-warning);background-color:var(--color-warning-surface)}.workspace-item.error.svelte-ijd5ei:hover{border-color:var(--color-warning-hover)}.workspace-main.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-3);flex:1;min-width:0}.workspace-icon-container.svelte-ijd5ei{flex-shrink:0}.workspace-icon.svelte-ijd5ei{font-size:1.5rem;display:block}.workspace-icon.error.svelte-ijd5ei{font-size:1.25rem;color:var(--color-warning)}.workspace-info.svelte-ijd5ei{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--space-1)}.workspace-header.svelte-ijd5ei{display:flex;align-items:center;justify-content:space-between;gap:var(--space-2)}.workspace-title.svelte-ijd5ei{margin:0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;gap:var(--space-2);flex:1;min-width:0}.current-badge.svelte-ijd5ei{font-size:var(--text-xs);font-weight:500;padding:2px var(--space-1);background-color:var(--color-primary);color:var(--color-surface);border-radius:var(--radius-xs);flex-shrink:0}.workspace-time.svelte-ijd5ei{font-size:var(--text-sm);color:var(--color-text-secondary);flex-shrink:0}.workspace-meta.svelte-ijd5ei{display:flex;align-items:center;gap:var(--space-1);font-size:var(--text-sm);color:var(--color-text-secondary);overflow:hidden}.workspace-author-inline.svelte-ijd5ei{color:var(--color-text-secondary);font-weight:400}.meta-separator.svelte-ijd5ei{flex-shrink:0;opacity:.6}.workspace-language.svelte-ijd5ei{flex-shrink:0;text-transform:uppercase;font-weight:500}.workspace-stats.svelte-ijd5ei{flex-shrink:0}.workspace-actions.svelte-ijd5ei{display:flex;gap:var(--space-2);flex-shrink:0}.delete-button.svelte-ijd5ei{min-width:44px;min-height:44px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-secondary);color:var(--color-text-secondary);font-size:1.25rem;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.delete-button.svelte-ijd5ei:hover{border-color:var(--color-error);background-color:var(--color-error-surface);color:var(--color-error)}.delete-button.svelte-ijd5ei:focus-visible{outline:none;border-color:var(--color-error);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}@media (max-width: 640px){.workspace-item.svelte-ijd5ei{padding:var(--space-3)}.workspace-header.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-1)}.workspace-time.svelte-ijd5ei{order:-1;align-self:flex-end}.workspace-meta.svelte-ijd5ei{flex-wrap:wrap}.workspace-stats.svelte-ijd5ei{flex:1 0 100%;margin-block-start:var(--space-1)}}@media (max-width: 480px){.workspace-main.svelte-ijd5ei{flex-direction:column;align-items:flex-start;gap:var(--space-2)}.workspace-icon-container.svelte-ijd5ei{align-self:center}.workspace-info.svelte-ijd5ei{width:100%}.workspace-actions.svelte-ijd5ei{align-self:center}}.workspace-list.svelte-1juhm6m{display:flex;flex-direction:column;gap:var(--space-4)}.list-header.svelte-1juhm6m{display:flex;flex-direction:column;gap:var(--space-3)}.search-container.svelte-1juhm6m{display:flex;justify-content:flex-end}.search-input-wrapper.svelte-1juhm6m{position:relative;max-width:300px;width:100%}.search-input.svelte-1juhm6m{width:100%;padding:var(--space-2) var(--space-3);padding-inline-end:var(--space-8);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background-color:var(--color-surface-primary);color:var(--color-text-primary);font-size:var(--text-sm);transition:all var(--duration-fast) ease}.search-input.svelte-1juhm6m:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.search-input.svelte-1juhm6m::placeholder{color:var(--color-text-tertiary)}.clear-search.svelte-1juhm6m{position:absolute;top:50%;inset-inline-end:var(--space-2);transform:translateY(-50%);width:24px;height:24px;border:none;border-radius:var(--radius-sm);background-color:var(--color-surface-tertiary);color:var(--color-text-secondary);font-size:1rem;font-weight:700;cursor:pointer;transition:all var(--duration-fast) ease;display:flex;align-items:center;justify-content:center}.clear-search.svelte-1juhm6m:hover{background-color:var(--color-surface-hover);color:var(--color-text-primary)}.list-content.svelte-1juhm6m{min-height:200px}.loading-state.svelte-1juhm6m{display:flex;flex-direction:column;gap:var(--space-3)}.skeleton-item.svelte-1juhm6m{height:80px;background-color:var(--color-surface-tertiary);border-radius:var(--radius-md);animation:svelte-1juhm6m-pulse 2s infinite;opacity:.6}@keyframes svelte-1juhm6m-pulse{0%,to{opacity:.6}50%{opacity:.8}}.loading-text.svelte-1juhm6m{text-align:center;color:var(--color-text-secondary);font-style:italic;margin:var(--space-4) 0 0 0}.empty-state.svelte-1juhm6m{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.empty-tips.svelte-1juhm6m{max-width:400px;margin:0 auto;text-align:left}.tips-title.svelte-1juhm6m{margin:0 0 var(--space-2) 0;font-size:var(--text-base);font-weight:600;color:var(--color-text-primary)}.tips-list.svelte-1juhm6m{margin:0;padding-inline-start:var(--space-4);list-style-type:disc}.tips-list.svelte-1juhm6m li:where(.svelte-1juhm6m){margin-block-end:var(--space-1);font-size:var(--text-sm);line-height:1.5}.no-results.svelte-1juhm6m{text-align:center;padding:var(--space-8) var(--space-4);color:var(--color-text-secondary)}.no-results-icon.svelte-1juhm6m{font-size:3rem;margin-block-end:var(--space-4);display:block;opacity:.6}.no-results-title.svelte-1juhm6m{margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:600;color:var(--color-text-primary)}.no-results-description.svelte-1juhm6m{margin:0 0 var(--space-4) 0;font-size:var(--text-base)}.clear-search-button.svelte-1juhm6m{padding:var(--space-2) var(--space-4);border:1px solid var(--color-primary);border-radius:var(--radius-md);background-color:transparent;color:var(--color-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.clear-search-button.svelte-1juhm6m:hover{background-color:var(--color-primary);color:var(--color-surface)}.workspace-grid.svelte-1juhm6m{display:flex;flex-direction:column;gap:0}.search-results-info.svelte-1juhm6m{margin-block-start:var(--space-4);padding-block-start:var(--space-4);border-block-start:1px solid var(--color-border-default)}.results-text.svelte-1juhm6m{margin:0;text-align:center;font-size:var(--text-sm);color:var(--color-text-secondary);font-style:italic}@media (max-width: 768px){.list-header.svelte-1juhm6m{gap:var(--space-2)}.search-container.svelte-1juhm6m{justify-content:stretch}.search-input-wrapper.svelte-1juhm6m{max-width:none}.empty-state.svelte-1juhm6m{padding:var(--space-6) var(--space-2)}.empty-tips.svelte-1juhm6m{text-align:center}}.workspace-view.svelte-9tke9n{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-content.svelte-9tke9n{flex:1;padding:var(--space-6);overflow-y:auto}.error-banner.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4);margin-block-end:var(--space-6);background-color:var(--color-error-surface);color:var(--color-error);border:1px solid var(--color-error);border-radius:var(--radius-md)}.error-icon.svelte-9tke9n{font-size:1.25rem;flex-shrink:0}.error-text.svelte-9tke9n{flex:1;font-weight:500}.retry-button.svelte-9tke9n{padding:var(--space-2) var(--space-3);border:1px solid var(--color-error);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-error);font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:44px}.retry-button.svelte-9tke9n:hover{background-color:var(--color-error);color:var(--color-surface)}.retry-button.svelte-9tke9n:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.unsaved-indicator.svelte-9tke9n{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);margin-block-start:var(--space-6);background-color:var(--color-warning-surface);color:var(--color-warning);border:1px solid var(--color-warning);border-radius:var(--radius-md);font-size:var(--text-sm)}.indicator-icon.svelte-9tke9n{font-size:var(--text-base);flex-shrink:0}@media (max-width: 768px){.view-content.svelte-9tke9n{padding:var(--space-4)}}.metadata-tab.svelte-z75kp3{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;border:none;border-block-end:2px solid transparent;background-color:transparent;color:var(--color-text-secondary);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;white-space:nowrap}.metadata-tab.svelte-z75kp3:hover:not(.disabled){color:var(--color-text-primary);background-color:var(--color-surface-hover)}.metadata-tab.svelte-z75kp3:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-radius:var(--radius-sm)}.metadata-tab.active.svelte-z75kp3{color:var(--color-primary);border-block-end-color:var(--color-primary);background-color:var(--color-surface-primary)}.metadata-tab.has-errors.svelte-z75kp3{color:var(--color-error)}.metadata-tab.has-errors.active.svelte-z75kp3{border-block-end-color:var(--color-error)}.metadata-tab.disabled.svelte-z75kp3{color:var(--color-text-disabled);cursor:not-allowed}.tab-label.svelte-z75kp3{flex:1}.error-indicator.svelte-z75kp3{display:inline-flex;align-items:center;justify-content:center;width:1.25rem;height:1.25rem;border-radius:50%;background-color:var(--color-error);color:var(--color-surface);font-size:.75rem;font-weight:700;line-height:1}[dir=rtl] .metadata-tab.svelte-z75kp3{flex-direction:row-reverse}.metadata-tab-bar.svelte-1pzcjt6{display:flex;border-block-end:1px solid var(--color-border-default);background-color:var(--color-surface-primary);overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none}.metadata-tab-bar.svelte-1pzcjt6::-webkit-scrollbar{display:none}@media (max-width: 480px){.metadata-tab-bar.svelte-1pzcjt6{flex-wrap:wrap}}.metadata-field.svelte-cp96ig{margin-block-end:1rem}.field-label.svelte-cp96ig{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-cp96ig{color:var(--color-success-600)}.field-input.svelte-cp96ig{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-cp96ig:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-cp96ig:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-cp96ig{border-color:var(--color-error)}.field-input.error.svelte-cp96ig:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-cp96ig{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-cp96ig:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-cp96ig{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-bssb4o{margin-block-end:1rem}.field-label.svelte-bssb4o{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-bssb4o{color:var(--color-success-600)}.field-select.svelte-bssb4o{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;cursor:pointer}.field-select.svelte-bssb4o:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-select.svelte-bssb4o:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-select.error.svelte-bssb4o{border-color:var(--color-error)}.field-select.error.svelte-bssb4o:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-select.needs-attention.svelte-bssb4o{border-color:var(--color-success-600)}.field-select.needs-attention.svelte-bssb4o:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-bssb4o{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.metadata-field.svelte-1c704qf{margin-block-end:1rem}.field-label.svelte-1c704qf{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-1c704qf{color:var(--color-success-600)}.required.svelte-1c704qf{color:var(--color-error);margin-inline-start:.25rem}.field-textarea.svelte-1c704qf{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease;resize:vertical;font-family:inherit;line-height:1.5;field-sizing:content;min-height:calc(4.5em + 1.5rem)}.field-textarea.svelte-1c704qf:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-textarea.svelte-1c704qf:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed;resize:none}.field-textarea.error.svelte-1c704qf{border-color:var(--color-error)}.field-textarea.error.svelte-1c704qf:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-textarea.needs-attention.svelte-1c704qf{border-color:var(--color-success-600)}.field-textarea.needs-attention.svelte-1c704qf:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.field-error.svelte-1c704qf{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.basic-info-fields.svelte-1nofkco{padding:1.5rem}.form-columns.svelte-1nofkco{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-1nofkco{grid-template-columns:1fr 1fr}}.column.svelte-1nofkco{min-width:0}.field-group.svelte-1nofkco{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-1nofkco:last-child{margin-block-end:0}.group-title.svelte-1nofkco{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.identifier-field.svelte-1nofkco{display:flex;gap:.5rem;align-items:flex-end}.identifier-field.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.generate-button.svelte-1nofkco{padding:.75rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap;height:fit-content}.generate-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.generate-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.generate-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.array-field.svelte-1nofkco{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-1nofkco{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-1nofkco .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-1nofkco .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-1nofkco .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-1nofkco .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-1nofkco .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-1nofkco{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-1nofkco:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-1nofkco{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-1nofkco:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-1nofkco:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-1nofkco:disabled{opacity:.6;cursor:not-allowed}.metadata-field.svelte-14vfa0w{margin-block-end:1rem}.field-label.svelte-14vfa0w{display:block;font-weight:500;margin-block-end:.5rem;color:var(--color-text-primary);font-size:.875rem}.field-label.needs-attention.svelte-14vfa0w{color:var(--color-success-600)}.required.svelte-14vfa0w{color:var(--color-error);margin-inline-start:.25rem}.date-input-wrapper.svelte-14vfa0w{display:flex;gap:.5rem;align-items:center}.field-input.svelte-14vfa0w{flex:1;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:1rem;background-color:var(--color-bg-primary);color:var(--color-text-primary);transition:border-color .2s ease}.field-input.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-input.svelte-14vfa0w:disabled{background-color:var(--color-surface-disabled);color:var(--color-text-disabled);cursor:not-allowed}.field-input.error.svelte-14vfa0w{border-color:var(--color-error)}.field-input.error.svelte-14vfa0w:focus{border-color:var(--color-error);box-shadow:0 0 0 2px var(--color-error-300)}.field-input.needs-attention.svelte-14vfa0w{border-color:var(--color-success-600)}.field-input.needs-attention.svelte-14vfa0w:focus{border-color:var(--color-success-600);box-shadow:0 0 0 2px #228b2233}.today-button.svelte-14vfa0w{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface-primary);color:var(--color-text-secondary);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.today-button.svelte-14vfa0w:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.today-button.svelte-14vfa0w:focus{outline:none;border-color:var(--color-focus);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}.field-error.svelte-14vfa0w{margin-block-start:.25rem;color:var(--color-error);font-size:.875rem}.advanced-fields.svelte-fuok1{padding:1.5rem}.form-columns.svelte-fuok1{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width: 768px){.form-columns.svelte-fuok1{grid-template-columns:1fr 1fr}}.column.svelte-fuok1{min-width:0}.field-group.svelte-fuok1{margin-block-end:2rem;background-color:var(--color-bg-tertiary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1.5rem}.field-group.svelte-fuok1:last-child{margin-block-end:0}.group-title.svelte-fuok1{font-size:1.125rem;font-weight:600;color:var(--color-text-primary)}.array-field.svelte-fuok1{display:flex;flex-direction:column;gap:.75rem}.array-item.svelte-fuok1{display:flex;gap:0;align-items:flex-start;background-color:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:0;overflow:hidden;position:relative}.array-item.svelte-fuok1 .metadata-field{flex:1;margin-block-end:0}.array-item.svelte-fuok1 .field-input{border:none;background-color:transparent;border-radius:0}.array-item.svelte-fuok1 .field-input:focus{border:none;box-shadow:inset 0 0 0 2px var(--color-focus)}.array-item.svelte-fuok1 .field-input.error:focus{box-shadow:inset 0 0 0 2px var(--color-error)}.array-item.svelte-fuok1 .field-input.needs-attention:focus{box-shadow:inset 0 0 0 2px var(--color-success-600)}.remove-button.svelte-fuok1{width:2.5rem;height:calc(3rem - 1px);border:none;border-inline-start:1px solid var(--color-border-default);border-radius:0;background-color:var(--color-bg-secondary);color:var(--color-error);font-size:1.25rem;font-weight:700;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;margin-block-start:0;flex-shrink:0}.remove-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600)}.remove-button.svelte-fuok1:focus{outline:none;background-color:var(--color-error-bg);border-inline-start-color:var(--color-error-600);box-shadow:inset 0 0 0 2px var(--color-focus-ring),inset 0 0 0 1px var(--color-error-600)}.remove-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.add-button.svelte-fuok1{padding:.75rem 1rem;border:1px dashed var(--color-border-default);border-radius:var(--radius-sm);background-color:transparent;color:var(--color-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.add-button.svelte-fuok1:hover:not(:disabled){background-color:var(--color-primary-surface);border-color:var(--color-primary);border-style:solid}.add-button.svelte-fuok1:focus{outline:none;border-color:var(--color-primary);box-shadow:inset 0 0 0 2px var(--color-focus-ring);border-style:solid}.add-button.svelte-fuok1:disabled{opacity:.6;cursor:not-allowed}.metadata-editor.svelte-17s3g49{display:flex;flex-direction:column;height:100%;background-color:var(--color-surface-primary)}.pane-header.svelte-17s3g49{flex-shrink:0;border-block-end:1px solid var(--color-border-default)}.pane-content.svelte-17s3g49{flex:1;overflow-y:auto;background-color:var(--color-bg-primary)}.tab-panel.svelte-17s3g49{height:100%}.loading-state.svelte-17s3g49,.error-state.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-17s3g49{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-17s3g49{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-17s3g49:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-17s3g49:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.placeholder-panel.svelte-17s3g49{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.placeholder-panel.svelte-17s3g49 p:where(.svelte-17s3g49):first-child{font-size:1.125rem;font-weight:600;margin-block-end:.5rem}.placeholder-description.svelte-17s3g49{font-size:.875rem;opacity:.8}.placeholder-view.svelte-skhkuy{height:100%;display:flex;flex-direction:column;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.view-header.svelte-skhkuy{display:flex;align-items:center;justify-content:space-between;padding:var(--space-6);border-bottom:1px solid var(--color-border-default);background-color:var(--color-bg-secondary)}.header-content.svelte-skhkuy{display:flex;align-items:center;gap:var(--space-3)}.view-icon.svelte-skhkuy{font-size:var(--text-2xl)}.header-text.svelte-skhkuy h2:where(.svelte-skhkuy){margin:0 0 var(--space-1) 0;font-size:var(--text-xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.header-text.svelte-skhkuy p:where(.svelte-skhkuy){margin:0;font-size:var(--text-sm);color:var(--color-text-secondary)}.coming-soon-badge.svelte-skhkuy{padding:var(--space-1) var(--space-2);background-color:var(--color-accent);color:#fff;border-radius:var(--radius-md);font-size:var(--text-xs);font-weight:var(--font-medium)}.view-content.svelte-skhkuy{flex:1;overflow-y:auto;display:flex;align-items:center;justify-content:center;padding:var(--space-6)}.placeholder-content.svelte-skhkuy{max-width:600px;text-align:center}.placeholder-icon.svelte-skhkuy{margin-bottom:var(--space-6)}.large-icon.svelte-skhkuy{font-size:4rem;opacity:.6}.placeholder-content.svelte-skhkuy h3:where(.svelte-skhkuy){margin:0 0 var(--space-4) 0;font-size:var(--text-2xl);font-weight:var(--font-semibold);color:var(--color-text-primary)}.placeholder-description.svelte-skhkuy{margin:0 0 var(--space-8) 0;font-size:var(--text-base);color:var(--color-text-secondary);line-height:var(--leading-relaxed)}.feature-preview.svelte-skhkuy{margin-bottom:var(--space-8);text-align:left}.feature-preview.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary);text-align:center}.feature-list.svelte-skhkuy{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--space-2)}.feature-list.svelte-skhkuy li:where(.svelte-skhkuy){padding:var(--space-2);background-color:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-size:var(--text-sm);color:var(--color-text-primary)}.demo-actions.svelte-skhkuy{margin-bottom:var(--space-6)}.demo-actions.svelte-skhkuy h4:where(.svelte-skhkuy){margin:0 0 var(--space-3) 0;font-size:var(--text-lg);font-weight:var(--font-medium);color:var(--color-text-primary)}.action-buttons.svelte-skhkuy{display:flex;gap:var(--space-3);justify-content:center;flex-wrap:wrap}.btn.svelte-skhkuy{display:inline-flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-4);border:none;border-radius:var(--radius-md);font-family:var(--font-sans);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;text-decoration:none}.btn-primary.svelte-skhkuy{color:var(--color-text-inverse)}.btn-primary.svelte-skhkuy:hover{background-color:var(--color-accent-dark, var(--color-accent));transform:translateY(-1px);box-shadow:var(--shadow-sm)}.btn-secondary.svelte-skhkuy{background-color:var(--color-bg-secondary);color:var(--color-text-primary);border:1px solid var(--color-border-default)}.btn-secondary.svelte-skhkuy:hover{background-color:var(--color-bg-tertiary);border-color:var(--color-border-hover)}.last-action.svelte-skhkuy{display:flex;align-items:center;justify-content:center;gap:var(--space-2);padding:var(--space-3);background-color:var(--color-success-bg, #d4edda);color:var(--color-success-text, #155724);border:1px solid var(--color-success-border, #c3e6cb);border-radius:var(--radius-md);font-size:var(--text-sm)}.action-icon.svelte-skhkuy{font-size:var(--text-base)}.audio-clip-editor.svelte-1ullway{display:flex;flex-direction:column;gap:var(--space-2);padding:var(--space-2);background:var(--color-bg-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-md);font-size:var(--text-sm)}.error-message.svelte-1ullway{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-3);background:var(--color-error-bg);border:1px solid var(--color-error-border);border-radius:var(--radius-sm);color:var(--color-error-text);font-size:var(--text-sm)}.control-row.svelte-1ullway{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2)}.control-group.svelte-1ullway{display:flex;flex-direction:column;gap:var(--space-1);min-width:0}.control-pair.svelte-1ullway{display:flex;align-items:center;gap:var(--space-2);flex-wrap:nowrap}.audio-select.svelte-1ullway{min-width:120px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer}.audio-select.svelte-1ullway:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.range-group.svelte-1ullway{flex:1;min-width:100px;justify-content:center}.range-slider.svelte-1ullway{width:100%;height:6px;border-radius:3px;background:var(--color-bg-tertiary);outline:none;cursor:pointer}.range-slider.svelte-1ullway::-webkit-slider-thumb{appearance:none;width:16px;height:16px;border-radius:50%;background:var(--color-accent-primary);cursor:pointer;border:2px solid var(--color-bg-primary);box-shadow:0 2px 4px #0003}.range-slider.svelte-1ullway::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:var(--color-accent-primary);cursor:pointer;border:2px solid var(--color-bg-primary);box-shadow:0 2px 4px #0003}.range-slider.svelte-1ullway:focus{box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.time-input.svelte-1ullway{width:80px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);font-family:var(--font-mono);text-align:center}.time-input.svelte-1ullway:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.label-input.svelte-1ullway{width:120px;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm)}.label-input.svelte-1ullway:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.time-input-group.svelte-1ullway{flex-direction:row!important}.control-btn.svelte-1ullway{display:flex;align-items:center;justify-content:center;gap:var(--space-1);padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;white-space:nowrap;height:36px;box-sizing:border-box}.control-btn.svelte-1ullway:hover:not(:disabled){background:var(--color-bg-hover);border-color:var(--color-accent-primary)}.control-btn.svelte-1ullway:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.control-btn.svelte-1ullway:disabled{opacity:.5;cursor:not-allowed}.control-btn.active.svelte-1ullway{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary)}.primary-btn.svelte-1ullway{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary);font-weight:var(--font-semibold)}.primary-btn.svelte-1ullway:hover:not(:disabled){background:var(--color-accent-secondary);border-color:var(--color-accent-secondary)}.jog-group.svelte-1ullway{align-items:center}.jog-controls.svelte-1ullway{display:flex;gap:1px;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);overflow:hidden;height:36px;box-sizing:border-box}.jog-btn.svelte-1ullway{padding:var(--space-2) var(--space-2);border:none;background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-xs);font-family:var(--font-mono);cursor:pointer;transition:background-color var(--duration-fast) ease;min-width:36px;height:36px;box-sizing:border-box}.jog-btn.svelte-1ullway:hover{background:var(--color-bg-hover)}.jog-btn.svelte-1ullway:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:-2px;z-index:1;position:relative}.jog-btn.svelte-1ullway+.jog-btn:where(.svelte-1ullway){border-left:1px solid var(--color-border-default)}.loading-indicator.svelte-1ullway{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2);color:var(--color-text-secondary);font-size:var(--text-sm)}.spinner.svelte-1ullway{width:16px;height:16px;border:2px solid var(--color-border-default);border-top:2px solid var(--color-accent-primary);border-radius:50%;animation:svelte-1ullway-spin 1s linear infinite}@keyframes svelte-1ullway-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.control-row.svelte-1ullway{gap:var(--space-1)}.time-input.svelte-1ullway{width:70px}.audio-select.svelte-1ullway{min-width:100px}}@media (prefers-contrast: high){.control-btn.svelte-1ullway,.audio-select.svelte-1ullway,.time-input.svelte-1ullway{border:2px solid var(--color-forced-border)}.range-slider.svelte-1ullway::-webkit-slider-thumb,.range-slider.svelte-1ullway::-moz-range-thumb{border:2px solid var(--color-forced-border)}}@media (prefers-reduced-motion: reduce){.control-btn.svelte-1ullway,.spinner.svelte-1ullway{transition:none;animation:none}}@media (prefers-color-scheme: dark){.range-slider.svelte-1ullway::-webkit-slider-thumb,.range-slider.svelte-1ullway::-moz-range-thumb{box-shadow:0 2px 4px #0006}}.editor-pane-container.svelte-1o9epl8{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.editor-header.svelte-1o9epl8{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.editor-controls.svelte-1o9epl8{display:flex;gap:var(--space-2)}.pane-toggle-btn.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-2) var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);cursor:pointer;transition:all var(--duration-fast) ease;font-size:var(--text-sm);font-weight:var(--font-medium)}.pane-toggle-btn.svelte-1o9epl8:hover{background:var(--color-bg-hover);border-color:var(--color-accent-primary)}.pane-toggle-btn.svelte-1o9epl8:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.toggle-icon.svelte-1o9epl8{font-size:var(--text-base);font-weight:700}.toggle-label.svelte-1o9epl8{font-size:var(--text-sm)}.editor-status.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-2)}.status-indicator.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:var(--font-medium)}.status-indicator.transforming.svelte-1o9epl8{background:var(--color-info-bg);color:var(--color-info-text)}.status-indicator.error.svelte-1o9epl8{background:var(--color-error-bg);color:var(--color-error-text)}.status-indicator.warning.svelte-1o9epl8{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-indicator.success.svelte-1o9epl8{background:var(--color-success-bg);color:var(--color-success-text)}.status-spinner.svelte-1o9epl8{width:12px;height:12px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-1o9epl8-spin var(--duration-normal) linear infinite}@keyframes svelte-1o9epl8-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.force-update-btn.svelte-1o9epl8{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm);transition:all var(--duration-fast) ease}.force-update-btn.svelte-1o9epl8:hover:not(:disabled){background:var(--color-bg-hover)}.force-update-btn.svelte-1o9epl8:disabled{opacity:.5;cursor:not-allowed}.editor-content.svelte-1o9epl8{flex:1;overflow:hidden}.editor-panes.svelte-1o9epl8{display:flex;flex-direction:column;height:100%}.editor-pane.svelte-1o9epl8{display:flex;flex-direction:column;flex:1;min-height:0}.editor-panes.dual-mode.svelte-1o9epl8 .editor-pane:where(.svelte-1o9epl8){flex:1}.pane-2.svelte-1o9epl8{border-bottom:1px solid var(--color-border-default)}.pane-header.svelte-1o9epl8{background:var(--color-bg-tertiary);border-bottom:1px solid var(--color-border-default)}.pane-header-content.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2)}.file-selector.svelte-1o9epl8{flex:1;padding:var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer}.file-selector.svelte-1o9epl8:focus{outline:none;border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.audio-toggle-btn.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-2) var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);font-size:var(--text-sm);font-weight:var(--font-medium);cursor:pointer;transition:all var(--duration-fast) ease;white-space:nowrap}.audio-toggle-btn.svelte-1o9epl8:hover{background:var(--color-bg-hover);border-color:var(--color-accent-primary)}.audio-toggle-btn.svelte-1o9epl8:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.audio-toggle-btn.active.svelte-1o9epl8{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary)}.audio-editor-panel.svelte-1o9epl8{border-top:1px solid var(--color-border-default)}.textarea-container.svelte-1o9epl8{flex:1;padding:var(--space-2);overflow:hidden;position:relative}.content-textarea.svelte-1o9epl8{width:100%;height:100%;padding:var(--space-3);border:1px solid var(--color-border-default);border-radius:var(--radius-md);background:var(--color-bg-primary);color:var(--color-text-primary);font-family:var(--font-mono);font-size:var(--text-sm);line-height:var(--leading-relaxed);resize:none;outline:none}.content-textarea.svelte-1o9epl8:focus{border-color:var(--color-accent-primary);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus)}.content-textarea.has-error.svelte-1o9epl8{border-color:var(--color-error-border)}.content-textarea.has-error.svelte-1o9epl8:focus{border-color:var(--color-error-border);box-shadow:0 0 0 var(--focus-ring-width) var(--color-error-text)}.pane-error-overlay.svelte-1o9epl8{position:absolute;bottom:var(--space-3);left:var(--space-3);right:var(--space-3);display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-3);background:var(--color-error-bg);border:1px solid var(--color-error-border);border-radius:var(--radius-sm);color:var(--color-error-text);font-size:var(--text-sm);box-shadow:0 2px 8px #00000026;z-index:10}.pane-error-overlay.svelte-1o9epl8 .error-icon:where(.svelte-1o9epl8){font-size:var(--text-base);flex-shrink:0}.pane-error-overlay.svelte-1o9epl8 .error-message:where(.svelte-1o9epl8){flex:1;font-family:var(--font-mono)}.error-display.svelte-1o9epl8,.warnings-display.svelte-1o9epl8{margin:var(--space-2);padding:var(--space-3);border-radius:var(--radius-md)}.error-display.svelte-1o9epl8{background:var(--color-error-bg);border:1px solid var(--color-error-border);color:var(--color-error-text)}.warnings-display.svelte-1o9epl8{background:var(--color-warning-bg);border:1px solid var(--color-warning-border);color:var(--color-warning-text)}.error-header.svelte-1o9epl8,.warnings-header.svelte-1o9epl8{display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2)}.error-message.svelte-1o9epl8{font-family:var(--font-mono);font-size:var(--text-sm)}.error-stack.svelte-1o9epl8{margin-top:var(--space-2)}.error-stack.svelte-1o9epl8 pre:where(.svelte-1o9epl8){font-family:var(--font-mono);font-size:var(--text-xs);overflow-x:auto;margin:var(--space-1) 0 0}.warnings-list.svelte-1o9epl8{margin:0;padding-left:var(--space-4);font-size:var(--text-sm)}.warnings-list.svelte-1o9epl8 li:where(.svelte-1o9epl8){margin-bottom:var(--space-1)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-1o9epl8{animation:none}.pane-toggle-btn.svelte-1o9epl8,.force-update-btn.svelte-1o9epl8{transition:none}}.loading-state.svelte-19lb94x,.error-state.svelte-19lb94x,.empty-state.svelte-19lb94x{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:var(--space-8);background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-19lb94x{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-19lb94x-spin 1s linear infinite;margin-bottom:var(--space-4)}@keyframes svelte-19lb94x-spin{to{transform:rotate(360deg)}}.error-icon.svelte-19lb94x{font-size:var(--text-2xl);margin-bottom:var(--space-3)}.error-state.svelte-19lb94x{color:var(--color-error-text)}.empty-icon.svelte-19lb94x{font-size:3rem;opacity:.5;margin-bottom:var(--space-4)}.empty-state.svelte-19lb94x h3:where(.svelte-19lb94x){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);font-weight:var(--font-medium)}.empty-state.svelte-19lb94x p:where(.svelte-19lb94x){margin:0;color:var(--color-text-secondary);font-size:var(--text-sm)}.spine-editor-wrapper.svelte-19lb94x{height:100%;display:flex;flex-direction:column}@media (prefers-reduced-motion: reduce){.spinner.svelte-19lb94x{animation:none}}.extension-item.svelte-1ksqegs{border:1px solid var(--border-color, #ddd);border-radius:.25rem;margin-bottom:.5rem;background:var(--bg-primary, #fff);overflow:hidden}.extension-header.svelte-1ksqegs{display:flex;align-items:center;justify-content:space-between;padding:.75rem}.extension-name.svelte-1ksqegs{font-weight:500;color:var(--text-primary, #333)}.extension-actions.svelte-1ksqegs{display:flex;gap:.5rem}.license-button.svelte-1ksqegs{background:var(--color-accent-primary, #007acc);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.875rem}.license-button.svelte-1ksqegs:hover:not(:disabled){background:var(--color-accent-primary-hover, #005a9e)}.license-button.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}.remove-button.svelte-1ksqegs{background:var(--error-bg, #dc3545);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.875rem}.remove-button.svelte-1ksqegs:hover:not(:disabled){background:var(--error-hover, #c82333)}.remove-button.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}.license-preview.svelte-1ksqegs{padding:.5rem .75rem 0;border-bottom:1px solid var(--color-border-subtle, #e9ecef)}.license-preview-text.svelte-1ksqegs{font-size:.75rem;color:var(--color-text-tertiary, #6c757d);font-style:italic;line-height:1.3}.license-section.svelte-1ksqegs{border-top:1px solid var(--border-color, #ddd);padding:.75rem;background:var(--color-bg-secondary, #f8f9fa)}.license-textarea.svelte-1ksqegs{width:100%;min-height:120px;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;font-family:var(--font-mono, monospace);font-size:.875rem;line-height:1.4;resize:vertical;background:var(--bg-primary, #fff);color:var(--text-primary, #333)}.license-textarea.svelte-1ksqegs:focus{outline:2px solid var(--focus-color, #007acc);outline-offset:2px;border-color:var(--focus-color, #007acc)}.license-textarea.svelte-1ksqegs:read-only{background:var(--color-bg-tertiary, #f1f3f4);cursor:not-allowed}.license-textarea.svelte-1ksqegs:disabled{opacity:.6;cursor:not-allowed}@media (max-width: 640px){.extension-header.svelte-1ksqegs{flex-direction:column;align-items:flex-start;gap:.5rem}.extension-actions.svelte-1ksqegs{align-self:stretch;justify-content:flex-end}}.settings-view.svelte-zk358{padding:1rem;max-width:100%;width:100%;margin:0}.settings-header.svelte-zk358 h1:where(.svelte-zk358){margin:0 0 .5rem;font-size:1.5rem;font-weight:600}.no-workspace-message.svelte-zk358,.loading-message.svelte-zk358{color:var(--text-muted, #666);font-style:italic}.error-message.svelte-zk358{background:var(--error-bg, #fee);color:var(--error-text, #c33);padding:.75rem;border-radius:.25rem;border:1px solid var(--error-border, #fcc);margin-bottom:1rem}.settings-content.svelte-zk358{display:grid;grid-template-columns:1fr 1fr;gap:2rem;max-width:1000px;margin:0 auto}@media (max-width: 1024px){.settings-content.svelte-zk358{grid-template-columns:1fr}}section.svelte-zk358{border:1px solid var(--border-color, #ddd);border-radius:.5rem;padding:1.5rem}section.svelte-zk358 h2:where(.svelte-zk358){margin:0 0 1rem;font-size:1.25rem;font-weight:500;color:var(--text-primary, #333)}.setting-group.svelte-zk358{margin-bottom:1rem}.setting-label.svelte-zk358{display:flex;align-items:flex-start;gap:.5rem;cursor:pointer}.setting-label.svelte-zk358 input[type=checkbox]:where(.svelte-zk358){margin-top:.125rem;cursor:pointer}.setting-text.svelte-zk358{font-weight:500;color:var(--text-primary, #333)}.setting-description.svelte-zk358{margin:.5rem 0 0 1.75rem;color:var(--text-muted, #666);font-size:.875rem;line-height:1.4}.setting-label-text.svelte-zk358{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary, #333)}.template-input.svelte-zk358{width:100%;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;font-family:var(--font-mono, "Monaco", "Menlo", "Ubuntu Mono", monospace);font-size:.875rem;background:var(--input-bg, #fff);color:var(--text-primary, #333)}.template-input.svelte-zk358:focus{outline:none;border-color:var(--focus-color, #007acc);box-shadow:0 0 0 2px #007acc33}.template-input.svelte-zk358:disabled{opacity:.6;cursor:not-allowed;background:var(--input-disabled-bg, #f5f5f5)}.extension-import.svelte-zk358{margin-bottom:1.5rem}.extension-import.svelte-zk358 label:where(.svelte-zk358){display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary, #333)}.extension-import.svelte-zk358 input[type=file]:where(.svelte-zk358){width:100%;padding:.5rem;border:1px solid var(--border-color, #ddd);border-radius:.25rem;cursor:pointer}.extension-import.svelte-zk358 input[type=file]:where(.svelte-zk358):disabled{opacity:.6;cursor:not-allowed}.extension-import.disabled.svelte-zk358{opacity:.6;pointer-events:none}.advanced-mode-note.svelte-zk358{font-size:var(--text-sm);color:var(--color-text-tertiary);font-style:italic;margin-top:var(--space-2);margin-bottom:0}.extensions-list.svelte-zk358{list-style:none;padding:0;margin:0}.setting-label.svelte-zk358:focus-within .setting-text:where(.svelte-zk358){outline:2px solid var(--focus-color, #007acc);outline-offset:2px}input[type=checkbox].svelte-zk358:focus-visible{outline:2px solid var(--focus-color, #007acc);outline-offset:2px}.spine-item.svelte-1b48bnl{display:flex;align-items:center;gap:var(--space-1);border-top:1px solid transparent;border-bottom:1px solid transparent;padding-block:var(--space-2);padding-inline-start:var(--space-2);padding-inline-end:var(--space-2);border-radius:0;cursor:pointer;transition:background-color var(--duration-fast) ease;min-block-size:var(--touch-target-min);position:relative;background:transparent}.spine-item.svelte-1b48bnl:hover:not(.selected){background:var(--color-bg-tertiary)}.spine-item.svelte-1b48bnl:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset);position:relative;z-index:1}.spine-item.selected.svelte-1b48bnl{background:var(--color-bg-primary);border-top:1px solid var(--color-border-default);border-bottom:1px solid var(--color-border-default);margin-inline-start:calc(var(--space-2) * -1);margin-inline-end:0;padding-inline-start:calc(var(--space-2) * 2);padding-inline-end:var(--space-2)}.spine-item.compact.svelte-1b48bnl{padding-block:2px;padding-inline:var(--space-1);justify-content:center;min-block-size:var( --touch-target-min )}.spine-item.compact.selected.svelte-1b48bnl{margin-inline:0;padding-inline:var(--space-1)}.spine-item.compact.svelte-1b48bnl .chapter-id:where(.svelte-1b48bnl){font-size:var(--text-xs);text-align:center;font-weight:var(--font-medium)}.drag-handle.svelte-1b48bnl{flex-shrink:0;display:flex;align-items:center;justify-content:center;inline-size:20px;block-size:20px;color:var(--color-text-tertiary);cursor:grab}.drag-handle.svelte-1b48bnl:active{cursor:grabbing}.chapter-id.svelte-1b48bnl{flex:1;font-size:var(--text-sm);color:var(--color-text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.error-indicator.svelte-1b48bnl{flex-shrink:0;font-size:var(--text-sm);color:var(--color-status-warning)}.move-buttons.svelte-1b48bnl{display:flex;gap:var(--space-1);margin-inline-start:auto}.move-button.svelte-1b48bnl{display:flex;align-items:center;justify-content:center;inline-size:28px;block-size:28px;border:none;background:var(--color-bg-primary);border-radius:var(--radius-xs);cursor:pointer;font-size:var(--text-sm);color:var(--color-text-secondary);transition:all var(--duration-fast) ease}.move-button.svelte-1b48bnl:hover:not(:disabled){background:var(--color-interactive-secondary-hover);color:var(--color-text-primary)}.move-button.svelte-1b48bnl:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.move-button.svelte-1b48bnl:disabled{opacity:.5;cursor:not-allowed;color:var(--color-text-tertiary)}.delete-button.svelte-1b48bnl:hover:not(:disabled){background:var(--color-danger);color:var(--color-bg-primary)}@media (prefers-contrast: high){.spine-item.selected.svelte-1b48bnl{border:2px solid var(--color-forced-active)}.error-indicator.svelte-1b48bnl{font-weight:700}}.spine-sidebar.svelte-d0f7cr{display:flex;flex-direction:column;block-size:100%;gap:var(--space-2);background:var(--color-bg-secondary);padding:0;padding-inline-end:0}.loading.svelte-d0f7cr,.error.svelte-d0f7cr,.empty-state.svelte-d0f7cr{padding:var(--space-2);text-align:center;color:var(--color-text-secondary);font-size:var(--text-sm)}.error.svelte-d0f7cr{color:var(--color-status-error)}.retry-button.svelte-d0f7cr{margin-block-start:var(--space-2);padding-block:var(--space-2);padding-inline:var(--space-4);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;transition:all var(--duration-fast) ease}.retry-button.svelte-d0f7cr:hover{background:var(--color-interactive-secondary-hover);border-color:var(--color-border-strong)}.retry-button.svelte-d0f7cr:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.spine-list.svelte-d0f7cr{flex:1;overflow-y:auto;overflow-x:visible;display:flex;flex-direction:column;gap:0;list-style:none;padding:0;margin:0}.spine-list.svelte-d0f7cr>*{border:none}.spine-item-wrapper.svelte-d0f7cr{transition:transform var(--duration-fast) ease;border:none;outline:none}.spine-item-wrapper[draggable=true].svelte-d0f7cr:active{opacity:.8;transform:scale(.98)}.spine-list.svelte-d0f7cr::-webkit-scrollbar{inline-size:6px}.spine-list.svelte-d0f7cr::-webkit-scrollbar-track{background:var(--color-bg-secondary)}.spine-list.svelte-d0f7cr::-webkit-scrollbar-thumb{background:var(--color-border-strong);border-radius:var(--radius-xs)}.spine-list.svelte-d0f7cr::-webkit-scrollbar-thumb:hover{background:var(--color-text-tertiary)}.manifest-table-container.svelte-8hsxjr{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.manifest-toolbar.svelte-8hsxjr{display:flex;align-items:center;justify-content:space-between;padding:1rem;background-color:var(--color-surface-primary);border-block-end:1px solid var(--color-border-default);position:relative;min-height:3rem;flex-shrink:0}.filter-section.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;flex:1;max-width:400px}.filter-label.svelte-8hsxjr{font-size:.875rem;font-weight:500;color:var(--color-text-secondary);white-space:nowrap}.filter-input-container.svelte-8hsxjr{position:relative;flex:1}.filter-input.svelte-8hsxjr{width:100%;padding:.5rem .75rem;padding-inline-end:2rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.filter-input.svelte-8hsxjr:focus{outline:none;border-color:var(--color-focus-ring);box-shadow:0 0 0 2px var(--color-focus-ring)}.filter-input.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.filter-input.svelte-8hsxjr::placeholder{color:var(--color-text-placeholder)}.clear-filter-button.svelte-8hsxjr{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.25rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.clear-filter-button.svelte-8hsxjr:hover{color:var(--color-text-primary)}.clear-filter-button.svelte-8hsxjr:focus{outline:none;color:var(--color-text-primary)}.action-buttons.svelte-8hsxjr{display:flex;gap:.5rem}.action-button.svelte-8hsxjr{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);font-size:.875rem;cursor:pointer;transition:all .2s ease;white-space:nowrap}.action-button.svelte-8hsxjr:disabled{opacity:.6;cursor:not-allowed}.action-button.primary.svelte-8hsxjr{background-color:var(--color-primary);color:var(--color-surface);border-color:var(--color-primary)}.action-button.primary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.action-button.secondary.svelte-8hsxjr{background-color:var(--color-surface);color:var(--color-text-primary)}.action-button.secondary.svelte-8hsxjr:hover:not(:disabled){background-color:var(--color-interactive-secondary-hover);border-color:var(--color-interactive-secondary-hover)}.drag-overlay.svelte-8hsxjr{position:absolute;inset:0;background-color:rgba(var(--color-primary-rgb),.1);border:2px dashed var(--color-primary);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;z-index:10}.drag-message.svelte-8hsxjr{padding:1rem;background-color:var(--color-surface);border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.drag-message.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:0;font-size:.875rem;color:var(--color-text-primary);text-align:center}.drag-active.svelte-8hsxjr{background-color:rgba(var(--color-primary-rgb),.05)}.table-container.svelte-8hsxjr{flex:1;overflow:auto}.empty-state.svelte-8hsxjr{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.empty-state.svelte-8hsxjr p:where(.svelte-8hsxjr){margin:.5rem 0}.empty-state-subtitle.svelte-8hsxjr{font-size:.875rem;opacity:.8}.manifest-table.svelte-8hsxjr{width:100%;border-collapse:collapse;font-size:.875rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .75rem;text-align:left;border-bottom:1px solid var(--color-border-default)}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr){background-color:var(--color-surface-secondary);font-weight:600;color:var(--color-text-primary);position:sticky;top:0;z-index:1}.sort-button.svelte-8hsxjr{background:none;border:none;font-size:inherit;font-weight:inherit;color:inherit;cursor:pointer;padding:0;display:flex;align-items:center;gap:.25rem}.sort-button.svelte-8hsxjr:hover{color:var(--color-interactive-primary)}.sort-button.svelte-8hsxjr:focus{outline:none;color:var(--color-interactive-primary)}.manifest-row.svelte-8hsxjr{cursor:pointer;transition:background-color .15s ease;position:relative}.manifest-row.svelte-8hsxjr:hover{background-color:var(--color-surface-hover)}.manifest-row.svelte-8hsxjr:focus:not(.selected){outline:2px solid var(--color-focus-ring);outline-offset:-2px;background-color:var(--color-surface-hover)}.manifest-row.selected.svelte-8hsxjr:focus{outline:2px solid var(--color-focus-ring);outline-offset:-2px}.manifest-row.selected.svelte-8hsxjr{background-color:var(--color-bg-accent)}.manifest-row.error.svelte-8hsxjr{background-color:var(--color-bg-error)}.manifest-row.source-zip-item.svelte-8hsxjr{opacity:.8;font-style:italic;background-color:var(--color-bg-muted, rgba(0, 0, 0, .05))}.manifest-row.source-zip-item.svelte-8hsxjr .item-id:where(.svelte-8hsxjr),.manifest-row.source-zip-item.svelte-8hsxjr .item-href:where(.svelte-8hsxjr){color:var(--color-text-secondary)}.source-separator.svelte-8hsxjr{background-color:var(--color-bg-secondary)}.separator-cell.svelte-8hsxjr{padding:.75rem;border-bottom:2px solid var(--color-border-strong);border-top:1px solid var(--color-border-default)}.separator-content.svelte-8hsxjr{display:flex;align-items:center;justify-content:flex-start}.separator-label.svelte-8hsxjr{font-size:.8125rem;font-weight:600;color:var(--color-text-secondary);letter-spacing:.05em}.id-cell.svelte-8hsxjr{display:flex;align-items:center;gap:.5rem;max-width:200px}.item-id.svelte-8hsxjr{font-weight:500;word-break:break-word}.href-cell.svelte-8hsxjr{max-width:300px}.item-href.svelte-8hsxjr{font-family:var(--font-mono);font-size:.8125rem;word-break:break-all}.size-cell.svelte-8hsxjr{text-align:right;color:var(--color-text-secondary)}.properties-list.svelte-8hsxjr{display:flex;flex-wrap:wrap;gap:.25rem}.property-tag.svelte-8hsxjr{background-color:var(--color-bg-accent);color:var(--color-primary);padding:.125rem .375rem;border-radius:var(--radius-xs);font-size:.75rem;font-weight:500}.action-button.svelte-8hsxjr{padding:.375rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .15s ease;min-width:32px;height:32px;display:flex;align-items:center;justify-content:center}.action-button.svelte-8hsxjr:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-8hsxjr:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}@media (max-width: 768px){.manifest-toolbar.svelte-8hsxjr{flex-direction:column;gap:1rem;align-items:stretch}.filter-section.svelte-8hsxjr{max-width:none}.action-buttons.svelte-8hsxjr{justify-content:center}.manifest-table.svelte-8hsxjr{font-size:.8125rem}.manifest-table.svelte-8hsxjr th:where(.svelte-8hsxjr),.manifest-table.svelte-8hsxjr td:where(.svelte-8hsxjr){padding:.5rem .25rem}.href-cell.svelte-8hsxjr{max-width:150px}.properties-list.svelte-8hsxjr{flex-direction:column}}.modal-overlay.svelte-ziknnq{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content.svelte-ziknnq{background-color:var(--color-surface-primary);border-radius:var(--radius-modal);box-shadow:var(--elevation-modal);max-width:600px;width:90%;max-height:90vh;display:flex;flex-direction:column}.modal-header.svelte-ziknnq{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;border-bottom:1px solid var(--color-border-default)}.modal-header.svelte-ziknnq h2:where(.svelte-ziknnq){margin:0;font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.close-button.svelte-ziknnq{background:none;border:none;font-size:1.5rem;color:var(--color-text-secondary);cursor:pointer;padding:.25rem;line-height:1;transition:color .2s ease}.close-button.svelte-ziknnq:hover{color:var(--color-text-primary)}.close-button.svelte-ziknnq:focus{outline:none;color:var(--color-text-primary)}.modal-form.svelte-ziknnq{display:flex;flex-direction:column;height:100%}.form-body.svelte-ziknnq{flex:1;overflow-y:auto;padding:1.5rem}.form-group.svelte-ziknnq{margin-bottom:1.5rem}.form-label.svelte-ziknnq{display:block;margin-bottom:.5rem;font-weight:500;color:var(--color-text-primary)}.required.svelte-ziknnq{color:var(--color-error-text)}.form-input.svelte-ziknnq,.form-select.svelte-ziknnq,.form-textarea.svelte-ziknnq{width:100%;padding:.75rem;border:1px solid var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-input-bg);color:var(--color-text-primary);font-size:.875rem;transition:border-color .2s ease}.form-input.svelte-ziknnq:focus,.form-select.svelte-ziknnq:focus,.form-textarea.svelte-ziknnq:focus{outline:none;border-color:var(--color-input-border-focus);box-shadow:0 0 0 2px var(--color-focus)}.form-input.error.svelte-ziknnq,.form-select.error.svelte-ziknnq{border-color:var(--color-error-text)}.form-input.svelte-ziknnq::placeholder,.form-textarea.svelte-ziknnq::placeholder{color:var(--color-input-placeholder)}.file-input.svelte-ziknnq{width:100%;padding:.75rem;border:2px dashed var(--color-border-default);border-radius:var(--radius-input);background-color:var(--color-bg-secondary);cursor:pointer;transition:border-color .2s ease}.file-input.svelte-ziknnq:hover{border-color:var(--color-interactive-primary)}.file-input.svelte-ziknnq:focus{outline:none;border-color:var(--color-focus)}.file-info.svelte-ziknnq{margin-top:.5rem;font-size:.875rem;color:var(--color-text-secondary)}.checkbox-fieldset.svelte-ziknnq{border:none;margin:0;padding:0}.checkbox-fieldset.svelte-ziknnq .form-label:where(.svelte-ziknnq){display:block;margin-bottom:.5rem;font-weight:500}.checkbox-group.svelte-ziknnq{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.5rem}.checkbox-label.svelte-ziknnq{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--color-text-primary);cursor:pointer}.checkbox-input.svelte-ziknnq{width:1rem;height:1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-xs);background-color:var(--color-input-bg);cursor:pointer}.checkbox-input.svelte-ziknnq:checked{background-color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.checkbox-input.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}.error-message.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-error-text)}.field-help.svelte-ziknnq{margin-top:.25rem;font-size:.8125rem;color:var(--color-text-secondary)}.modal-footer.svelte-ziknnq{display:flex;gap:.75rem;justify-content:flex-end;padding:1.5rem;border-top:1px solid var(--color-border-default)}.cancel-button.svelte-ziknnq,.save-button.svelte-ziknnq{padding:.75rem 1.5rem;border:1px solid var(--color-border-default);border-radius:var(--radius-button);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-button.svelte-ziknnq{background-color:var(--color-button-secondary-bg);color:var(--color-text-primary)}.cancel-button.svelte-ziknnq:hover{background-color:var(--color-button-secondary-bg-hover);border-color:var(--color-border-default)}.save-button.svelte-ziknnq{background-color:var(--color-interactive-primary);color:var(--color-white);border-color:var(--color-interactive-primary)}.save-button.svelte-ziknnq:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.cancel-button.svelte-ziknnq:focus,.save-button.svelte-ziknnq:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus)}@media (max-width: 768px){.modal-content.svelte-ziknnq{width:95%;max-height:95vh}.modal-header.svelte-ziknnq,.form-body.svelte-ziknnq{padding:1rem}.modal-footer.svelte-ziknnq{padding:1rem;flex-direction:column}.checkbox-group.svelte-ziknnq{grid-template-columns:1fr}}.loading-state.svelte-12tyyls,.error-state.svelte-12tyyls{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-12tyyls{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-12tyyls{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-12tyyls:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-12tyyls:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.manifest-preview.svelte-xcscli{height:100%;display:flex;flex-direction:column;background-color:var(--color-surface)}.no-selection.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--color-text-secondary)}.no-selection.svelte-xcscli p:where(.svelte-xcscli){margin:.5rem 0}.no-selection-subtitle.svelte-xcscli{font-size:.875rem;opacity:.8}.loading-state.svelte-xcscli,.error-state.svelte-xcscli{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.error-message.svelte-xcscli{color:var(--color-error);margin-block-end:1rem}.retry-button.svelte-xcscli{padding:.75rem 1.5rem;border:1px solid var(--color-primary);border-radius:var(--radius-sm);background-color:var(--color-primary);color:var(--color-surface);font-size:.875rem;cursor:pointer;transition:all .2s ease}.retry-button.svelte-xcscli:hover{background-color:var(--color-interactive-primary-hover);border-color:var(--color-interactive-primary-hover)}.retry-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.preview-content.svelte-xcscli{height:100%;display:flex;flex-direction:column}.preview-header.svelte-xcscli{flex-shrink:0;padding:1rem;border-bottom:1px solid var(--color-border-default);background-color:var(--color-surface-secondary);display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.preview-body.svelte-xcscli{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column}.content-header.svelte-xcscli{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.content-type-icon.svelte-xcscli{font-size:1.25rem}.content-type.svelte-xcscli{font-family:var(--font-mono);font-size:.875rem;color:var(--color-text-secondary)}.preview-error.svelte-xcscli{color:var(--color-error);padding:1rem;background-color:var(--color-error-subtle);border-radius:var(--radius-sm);margin-bottom:1rem}.text-preview.svelte-xcscli{flex:1}.text-content.svelte-xcscli{background-color:var(--color-surface-secondary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);padding:1rem;font-family:var(--font-mono);font-size:.8125rem;line-height:1.4;overflow:auto;white-space:pre-wrap;word-wrap:break-word}.image-preview.svelte-xcscli,.audio-preview.svelte-xcscli,.video-preview.svelte-xcscli{margin-bottom:1rem}.preview-image.svelte-xcscli{max-width:100%;height:auto;border-radius:var(--radius-sm);box-shadow:var(--shadow-sm)}.preview-audio.svelte-xcscli{width:100%;max-width:400px}.preview-video.svelte-xcscli{width:100%;max-width:600px;height:auto;border-radius:var(--radius-sm)}.binary-preview.svelte-xcscli{padding:1rem;background-color:var(--color-surface-secondary);border-radius:var(--radius-sm);text-align:center;color:var(--color-text-secondary);margin-bottom:1rem}.binary-info.svelte-xcscli{font-size:.875rem;margin-top:.5rem}.preview-actions.svelte-xcscli{flex-shrink:0;display:flex;gap:.5rem;align-items:flex-start}.action-button.svelte-xcscli{padding:.5rem 1rem;border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background-color:var(--color-surface);color:var(--color-text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease}.action-button.svelte-xcscli:hover{background-color:var(--color-surface-hover);border-color:var(--color-border-hover)}.action-button.svelte-xcscli:focus{outline:none;box-shadow:0 0 0 2px var(--color-focus-ring)}.download-button.svelte-xcscli:hover{color:var(--color-interactive-secondary);border-color:var(--color-interactive-secondary)}.edit-button.svelte-xcscli:hover{color:var(--color-interactive-primary);border-color:var(--color-interactive-primary)}.delete-button.svelte-xcscli:hover{color:var(--color-error);border-color:var(--color-error)}.outline-editor{display:flex;flex-direction:column;height:100%;width:100%}.outline-editor__textarea{flex:1;min-height:200px;padding:var(--spacing-4);font-family:var(--font-family-mono);font-size:var(--font-size-base);line-height:var(--line-height-relaxed);border:1px solid var(--color-border-subtle);border-radius:var(--border-radius-md);background-color:var(--color-surface);color:var(--color-text-primary);resize:none;overflow-y:auto;transition:border-color var(--transition-fast)}.outline-editor__textarea:focus{outline:none;border-color:var(--color-border-focus);box-shadow:0 0 0 var(--focus-ring-width) var(--color-focus-ring)}.outline-editor__textarea::placeholder{color:var(--color-text-subtle);font-style:italic}@media (prefers-contrast: high){.outline-editor__textarea{border-width:2px}.outline-editor__textarea:focus{border-color:var(--color-text-primary);box-shadow:0 0 0 calc(var(--focus-ring-width) + 1px) var(--color-focus-ring)}}@media (prefers-reduced-motion: reduce){.outline-editor__textarea{transition:none}}@media (max-width: 768px){.outline-editor__textarea{min-height:44px;padding:var(--spacing-3);font-size:var(--font-size-lg)}}[data-theme=dark] .outline-editor__textarea{background-color:var(--color-surface-elevated);border-color:var(--color-border-subtle)}[data-theme=dark] .outline-editor__textarea:focus{border-color:var(--color-border-focus)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.outline-view.svelte-vjoxn9{height:100%;width:100%}.sr-only.svelte-vjoxn9{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.content-preview.svelte-166aukc{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:#000;overflow:hidden}.content-preview__container.svelte-166aukc{transform-origin:center;width:100%;height:100%}.content-preview__letterbox.svelte-166aukc{background:#000;display:flex;justify-content:center;align-items:center;width:100%;height:100%}.content-preview__iframe.svelte-166aukc{border:none;background:#fff;min-width:320px;min-height:400px}.simple-metadata-view.svelte-uhoge6{display:flex;flex-direction:column;height:100%;background:var(--color-bg-primary);border-radius:var(--radius-md);overflow:hidden}.preview-header.svelte-uhoge6{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);background:var(--color-bg-secondary);border-bottom:1px solid var(--color-border-default)}.content-type-icon.svelte-uhoge6{font-size:var(--text-lg)}.file-name.svelte-uhoge6{font-family:var(--font-mono);font-weight:var(--font-medium);color:var(--color-text-primary)}.preview-body.svelte-uhoge6{flex:1;overflow:auto;padding:var(--space-4)}.metadata-summary.svelte-uhoge6{display:flex;flex-direction:column;gap:var(--space-4)}.field-row.svelte-uhoge6{display:flex;flex-direction:column;gap:var(--space-1);padding:var(--space-3);border-radius:var(--radius-sm);transition:all var(--duration-fast) ease}.field-row.focused.svelte-uhoge6{background:var(--color-bg-accent);border:1px solid var(--color-interactive-primary)}.field-label.svelte-uhoge6{font-size:var(--text-sm);font-weight:var(--font-medium);color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:var(--tracking-wide)}.field-value.svelte-uhoge6{font-size:var(--text-base);color:var(--color-text-primary);line-height:var(--leading-relaxed)}.field-value.description.svelte-uhoge6{white-space:pre-wrap;word-wrap:break-word}.field-value.identifier.svelte-uhoge6{font-family:var(--font-mono);font-size:var(--text-sm);color:var(--color-text-secondary);word-break:break-all}.no-content.svelte-uhoge6{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;padding:var(--space-4);text-align:center;color:var(--color-text-secondary)}.opf-preview.svelte-vzuyuw{display:flex;flex-direction:column;height:100%;background:var(--color-bg-primary);border-radius:var(--radius-md);overflow:hidden}.preview-header.svelte-vzuyuw{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);background:var(--color-bg-secondary);border-bottom:1px solid var(--color-border-default)}.content-type-icon.svelte-vzuyuw{font-size:var(--text-lg)}.file-name.svelte-vzuyuw{font-family:var(--font-mono);font-weight:var(--font-medium);color:var(--color-text-primary)}.preview-body.svelte-vzuyuw{flex:1;overflow:auto;padding:var(--space-3)}.text-preview.svelte-vzuyuw{height:100%}.text-content.svelte-vzuyuw{font-family:var(--font-mono);font-size:var(--text-sm);line-height:var(--leading-relaxed);color:var(--color-text-primary);background:var(--color-bg-primary);border:none;margin:0;padding:0;height:100%;overflow:auto;white-space:pre;tab-size:2}.error-state.svelte-vzuyuw,.no-content.svelte-vzuyuw{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;padding:var(--space-4);text-align:center;color:var(--color-text-secondary)}.error-state.svelte-vzuyuw{color:var(--color-status-error)}.error-message.svelte-vzuyuw{margin-bottom:var(--space-3)}.retry-button.svelte-vzuyuw{padding:var(--space-2) var(--space-4);background:var(--color-bg-primary);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);color:var(--color-text-primary);cursor:pointer;font-size:var(--text-sm);transition:all var(--duration-fast) ease}.retry-button.svelte-vzuyuw:hover{background:var(--color-interactive-secondary-hover);border-color:var(--color-border-strong)}.retry-button.svelte-vzuyuw:focus-visible{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.highlighted-xml.svelte-vzuyuw .metadata-value{font-weight:var(--font-bold);color:var(--color-text-primary)}.highlighted-xml.svelte-vzuyuw .metadata-value-focused{font-weight:var(--font-bold);color:var(--color-interactive-primary);background:var(--color-bg-accent);border-radius:var(--radius-xs)}.highlighted-xml.svelte-vzuyuw .metadata-tag{color:var(--color-syntax-tag)}.highlighted-xml.svelte-vzuyuw .metadata-tag-focused{color:var(--color-interactive-primary);font-weight:var(--font-medium)}.highlighted-xml.svelte-vzuyuw{font-family:var(--font-mono);line-height:var(--leading-relaxed)}.highlighted-xml.svelte-vzuyuw meta,.highlighted-xml.svelte-vzuyuw dc\\:title,.highlighted-xml.svelte-vzuyuw dc\\:language,.highlighted-xml.svelte-vzuyuw dc\\:identifier,.highlighted-xml.svelte-vzuyuw dc\\:creator,.highlighted-xml.svelte-vzuyuw dc\\:contributor,.highlighted-xml.svelte-vzuyuw dc\\:subject,.highlighted-xml.svelte-vzuyuw dc\\:publisher,.highlighted-xml.svelte-vzuyuw dc\\:date,.highlighted-xml.svelte-vzuyuw dc\\:description,.highlighted-xml.svelte-vzuyuw dc\\:rights{display:inline}.highlighted-xml.svelte-vzuyuw .structural-element{color:var(--color-text-tertiary)}.preview-pane-container.svelte-32psnf{display:flex;flex-direction:column;height:100%;background:var(--color-bg-secondary)}.preview-header.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2);border-bottom:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.preview-title.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);font-weight:var(--font-medium);color:var(--color-text-primary)}.preview-controls.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2)}.orientation-toggle.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);color:var(--color-text-primary);font-size:var(--text-sm);cursor:pointer;margin-right:var(--space-2);min-width:32px;display:inline-flex;align-items:center;justify-content:center}.orientation-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.orientation-toggle.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.device-selector.svelte-32psnf{padding:var(--space-1) var(--space-2);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-primary);color:var(--color-text-primary);font-size:var(--text-xs);cursor:pointer}.device-selector.svelte-32psnf:focus{outline:var(--focus-ring-width) var(--focus-ring-style) var(--color-focus);outline-offset:var(--focus-ring-offset)}.view-toggle.svelte-32psnf{padding:var(--space-1);border:1px solid var(--color-border-default);border-radius:var(--radius-sm);background:var(--color-bg-secondary);cursor:pointer;font-size:var(--text-sm)}.view-toggle.svelte-32psnf:hover{background:var(--color-bg-hover)}.view-toggle.active.svelte-32psnf{background:var(--color-accent-primary);color:var(--color-accent-contrast);border-color:var(--color-accent-primary)}.transform-status.svelte-32psnf{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2);font-size:var(--text-sm);font-weight:var(--font-medium)}.transform-status.transforming.svelte-32psnf{background:var(--color-info-bg);color:var(--color-info-text)}.transform-status.error.svelte-32psnf{background:var(--color-error-bg);color:var(--color-error-text)}.transform-status.warning.svelte-32psnf{background:var(--color-warning-bg);color:var(--color-warning-text)}.status-spinner.svelte-32psnf{width:16px;height:16px;border:2px solid currentColor;border-top:2px solid transparent;border-radius:50%;animation:svelte-32psnf-spin var(--duration-normal) linear infinite}@keyframes svelte-32psnf-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.preview-content.svelte-32psnf{flex:1;overflow:hidden;background:var(--color-bg-primary)}.source-view.svelte-32psnf{height:100%;overflow:auto}.source-code.svelte-32psnf{margin:0;padding:var(--space-3);font-family:var(--font-mono);font-size:var(--text-xs);line-height:var(--leading-relaxed);color:var(--color-text-primary);background:var(--color-bg-primary);white-space:pre-wrap}.preview-viewport.svelte-32psnf{height:100%;display:flex;justify-content:center;align-items:center;background-color:var(--color-bg-tertiary)}.preview-frame-wrapper.svelte-32psnf{position:relative}.preview-frame-container.svelte-32psnf{width:100%;height:100%;border:1px solid var(--color-border-default);border-radius:var(--radius-md);overflow:hidden}.preview-frame-container.device-frame.svelte-32psnf{box-shadow:var(--shadow-lg);border:2px solid var(--color-border-strong)}.preview-iframe.svelte-32psnf{width:100%;height:100%;border:none;background:#fff}.preview-error.svelte-32psnf,.preview-empty.svelte-32psnf{display:flex;align-items:center;justify-content:center;height:100%;padding:var(--space-4)}.error-content.svelte-32psnf,.empty-content.svelte-32psnf{text-align:center;max-width:400px}.error-content.svelte-32psnf{color:var(--color-error-text)}.error-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg)}.error-content.svelte-32psnf p:where(.svelte-32psnf){margin:var(--space-1) 0;font-size:var(--text-sm)}.error-stack.svelte-32psnf{font-family:var(--font-mono);font-size:var(--text-xs);text-align:left;background:var(--color-bg-secondary);padding:var(--space-2);border-radius:var(--radius-sm);margin-top:var(--space-2);overflow-x:auto}.empty-content.svelte-32psnf{color:var(--color-text-secondary)}.empty-icon.svelte-32psnf{font-size:var(--text-4xl);display:block;margin-bottom:var(--space-3)}.empty-content.svelte-32psnf h3:where(.svelte-32psnf){margin:0 0 var(--space-2) 0;font-size:var(--text-lg);color:var(--color-text-primary)}.empty-content.svelte-32psnf p:where(.svelte-32psnf){margin:0;font-size:var(--text-sm)}.preview-footer.svelte-32psnf{padding:var(--space-2);border-top:1px solid var(--color-border-default);background:var(--color-bg-tertiary)}.meta-info.svelte-32psnf{display:flex;justify-content:space-between;align-items:center;font-size:var(--text-xs);color:var(--color-text-tertiary)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf){margin-right:var(--space-3)}.meta-info.svelte-32psnf>span:where(.svelte-32psnf):last-child{margin-right:0}.warning-count.svelte-32psnf{color:var(--color-warning-text);background:var(--color-warning-bg);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm)}@media (prefers-reduced-motion: reduce){.status-spinner.svelte-32psnf{animation:none}.view-toggle.svelte-32psnf{transition:none}}@media (prefers-contrast: high){.preview-frame-container.svelte-32psnf{border:2px solid var(--color-forced-border)}}.loading-state.svelte-141k6tx,.error-state.svelte-141k6tx{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center;padding:2rem;background-color:var(--color-bg-primary);color:var(--color-text-primary)}.spinner.svelte-141k6tx{width:40px;height:40px;border:3px solid var(--color-border-default);border-top-color:var(--color-accent-primary);border-radius:50%;animation:svelte-141k6tx-spin 1s linear infinite;margin-bottom:1rem}@keyframes svelte-141k6tx-spin{to{transform:rotate(360deg)}}.error-state.svelte-141k6tx{color:var(--color-error-text)}.error-state.svelte-141k6tx h2:where(.svelte-141k6tx){margin:0 0 1rem;font-size:1.5rem;font-weight:600}.error-state.svelte-141k6tx p:where(.svelte-141k6tx){margin:.5rem 0;font-size:1rem}@media (prefers-reduced-motion: reduce){.spinner.svelte-141k6tx{animation:none}}.placeholder-content.svelte-141k6tx{padding:1rem;color:var(--color-text-secondary)}.placeholder-content.svelte-141k6tx h3:where(.svelte-141k6tx){margin:0 0 .5rem;font-size:1rem;font-weight:600}.placeholder-content.svelte-141k6tx p:where(.svelte-141k6tx){margin:0;font-size:.875rem;opacity:.8}.current-view-info.svelte-141k6tx{margin-top:1rem!important;padding:.5rem;background:var(--color-bg-secondary);border-radius:4px;font-size:.75rem!important}.package-epub-section.svelte-141k6tx{padding:var(--space-3);border-top:1px solid var(--color-border-default)}.package-epub-button.svelte-141k6tx{width:100%;padding:var(--space-2) var(--space-3);border:1px solid var(--color-button-primary-bg);border-radius:var(--radius-sm);background-color:var(--color-button-primary-bg);color:#fff;font-size:var(--text-sm);font-weight:500;cursor:pointer;transition:all var(--duration-fast) ease;min-height:36px}.package-epub-button.svelte-141k6tx:hover:not(:disabled){background-color:var(--color-button-primary-bg-hover);border-color:var(--color-button-primary-bg-hover)}.package-epub-button.svelte-141k6tx:disabled{opacity:.6;cursor:not-allowed}.package-epub-button.svelte-141k6tx:focus-visible{outline:none;border-color:var(--color-button-primary-bg);box-shadow:inset 0 0 0 2px var(--color-focus-ring)}</style>
  <script>window.__EDITME_I18N_BUNDLE__ = 'data:application/zip;base64,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';</script></head>
  <body>
    <div id="app"></div>
  </body>
</html>
